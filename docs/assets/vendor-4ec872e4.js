function zs(e,t){const r=Object.create(null),n=e.split(",");for(let i=0;i<n.length;i++)r[n[i]]=!0;return t?i=>!!r[i.toLowerCase()]:i=>!!r[i]}function qs(e){if(Ie(e)){const t={};for(let r=0;r<e.length;r++){const n=e[r],i=je(n)?yf(n):qs(n);if(i)for(const u in i)t[u]=i[u]}return t}else{if(je(e))return e;if(Ue(e))return e}}const Tf=/;(?![^(]*\))/g,_f=/:([^]+)/,Af=/\/\*.*?\*\//gs;function yf(e){const t={};return e.replace(Af,"").split(Tf).forEach(r=>{if(r){const n=r.split(_f);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t}function Js(e){let t="";if(je(e))t=e;else if(Ie(e))for(let r=0;r<e.length;r++){const n=Js(e[r]);n&&(t+=n+" ")}else if(Ue(e))for(const r in e)e[r]&&(t+=r+" ");return t.trim()}const bf="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Sf=zs(bf);function Iu(e){return!!e||e===""}const K_=e=>je(e)?e:e==null?"":Ie(e)||Ue(e)&&(e.toString===Du||!Le(e.toString))?JSON.stringify(e,xu,2):String(e),xu=(e,t)=>t&&t.__v_isRef?xu(e,t.value):Fr(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((r,[n,i])=>(r[`${n} =>`]=i,r),{})}:Lu(t)?{[`Set(${t.size})`]:[...t.values()]}:Ue(t)&&!Ie(t)&&!Ru(t)?String(t):t,ke={},Nr=[],xt=()=>{},If=()=>!1,xf=/^on[^a-z]/,bi=e=>xf.test(e),Zs=e=>e.startsWith("onUpdate:"),tt=Object.assign,ea=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},Lf=Object.prototype.hasOwnProperty,Re=(e,t)=>Lf.call(e,t),Ie=Array.isArray,Fr=e=>Si(e)==="[object Map]",Lu=e=>Si(e)==="[object Set]",Le=e=>typeof e=="function",je=e=>typeof e=="string",ta=e=>typeof e=="symbol",Ue=e=>e!==null&&typeof e=="object",Cu=e=>Ue(e)&&Le(e.then)&&Le(e.catch),Du=Object.prototype.toString,Si=e=>Du.call(e),Cf=e=>Si(e).slice(8,-1),Ru=e=>Si(e)==="[object Object]",ra=e=>je(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,qn=zs(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Ii=e=>{const t=Object.create(null);return r=>t[r]||(t[r]=e(r))},Df=/-(\w)/g,Ut=Ii(e=>e.replace(Df,(t,r)=>r?r.toUpperCase():"")),Rf=/\B([A-Z])/g,$r=Ii(e=>e.replace(Rf,"-$1").toLowerCase()),xi=Ii(e=>e.charAt(0).toUpperCase()+e.slice(1)),qi=Ii(e=>e?`on${xi(e)}`:""),_n=(e,t)=>!Object.is(e,t),Jn=(e,t)=>{for(let r=0;r<e.length;r++)e[r](t)},ai=(e,t,r)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:r})},oi=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let Ya;const Of=()=>Ya||(Ya=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Ot;class Pf{constructor(t=!1){this.detached=t,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Ot,!t&&Ot&&(this.index=(Ot.scopes||(Ot.scopes=[])).push(this)-1)}run(t){if(this.active){const r=Ot;try{return Ot=this,t()}finally{Ot=r}}}on(){Ot=this}off(){Ot=this.parent}stop(t){if(this.active){let r,n;for(r=0,n=this.effects.length;r<n;r++)this.effects[r].stop();for(r=0,n=this.cleanups.length;r<n;r++)this.cleanups[r]();if(this.scopes)for(r=0,n=this.scopes.length;r<n;r++)this.scopes[r].stop(!0);if(!this.detached&&this.parent&&!t){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.parent=void 0,this.active=!1}}}function Mf(e,t=Ot){t&&t.active&&t.effects.push(e)}const na=e=>{const t=new Set(e);return t.w=0,t.n=0,t},Ou=e=>(e.w&ir)>0,Pu=e=>(e.n&ir)>0,Nf=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=ir},Ff=e=>{const{deps:t}=e;if(t.length){let r=0;for(let n=0;n<t.length;n++){const i=t[n];Ou(i)&&!Pu(i)?i.delete(e):t[r++]=i,i.w&=~ir,i.n&=~ir}t.length=r}},vs=new WeakMap;let an=0,ir=1;const ps=30;let St;const Tr=Symbol(""),Ts=Symbol("");class ia{constructor(t,r=null,n){this.fn=t,this.scheduler=r,this.active=!0,this.deps=[],this.parent=void 0,Mf(this,n)}run(){if(!this.active)return this.fn();let t=St,r=tr;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=St,St=this,tr=!0,ir=1<<++an,an<=ps?Nf(this):Va(this),this.fn()}finally{an<=ps&&Ff(this),ir=1<<--an,St=this.parent,tr=r,this.parent=void 0,this.deferStop&&this.stop()}}stop(){St===this?this.deferStop=!0:this.active&&(Va(this),this.onStop&&this.onStop(),this.active=!1)}}function Va(e){const{deps:t}=e;if(t.length){for(let r=0;r<t.length;r++)t[r].delete(e);t.length=0}}let tr=!0;const Mu=[];function Qr(){Mu.push(tr),tr=!1}function zr(){const e=Mu.pop();tr=e===void 0?!0:e}function dt(e,t,r){if(tr&&St){let n=vs.get(e);n||vs.set(e,n=new Map);let i=n.get(r);i||n.set(r,i=na()),Nu(i)}}function Nu(e,t){let r=!1;an<=ps?Pu(e)||(e.n|=ir,r=!Ou(e)):r=!e.has(St),r&&(e.add(St),St.deps.push(e))}function jt(e,t,r,n,i,u){const x=vs.get(e);if(!x)return;let b=[];if(t==="clear")b=[...x.values()];else if(r==="length"&&Ie(e)){const s=oi(n);x.forEach((C,g)=>{(g==="length"||g>=s)&&b.push(C)})}else switch(r!==void 0&&b.push(x.get(r)),t){case"add":Ie(e)?ra(r)&&b.push(x.get("length")):(b.push(x.get(Tr)),Fr(e)&&b.push(x.get(Ts)));break;case"delete":Ie(e)||(b.push(x.get(Tr)),Fr(e)&&b.push(x.get(Ts)));break;case"set":Fr(e)&&b.push(x.get(Tr));break}if(b.length===1)b[0]&&_s(b[0]);else{const s=[];for(const C of b)C&&s.push(...C);_s(na(s))}}function _s(e,t){const r=Ie(e)?e:[...e];for(const n of r)n.computed&&ja(n);for(const n of r)n.computed||ja(n)}function ja(e,t){(e!==St||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const kf=zs("__proto__,__v_isRef,__isVue"),Fu=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(ta)),Bf=sa(),wf=sa(!1,!0),Uf=sa(!0),Xa=Hf();function Hf(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...r){const n=Pe(this);for(let u=0,x=this.length;u<x;u++)dt(n,"get",u+"");const i=n[t](...r);return i===-1||i===!1?n[t](...r.map(Pe)):i}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...r){Qr();const n=Pe(this)[t].apply(this,r);return zr(),n}}),e}function sa(e=!1,t=!1){return function(n,i,u){if(i==="__v_isReactive")return!e;if(i==="__v_isReadonly")return e;if(i==="__v_isShallow")return t;if(i==="__v_raw"&&u===(e?t?rd:Hu:t?Uu:wu).get(n))return n;const x=Ie(n);if(!e&&x&&Re(Xa,i))return Reflect.get(Xa,i,u);const b=Reflect.get(n,i,u);return(ta(i)?Fu.has(i):kf(i))||(e||dt(n,"get",i),t)?b:Je(b)?x&&ra(i)?b:b.value:Ue(b)?e?Ku(b):On(b):b}}const Kf=ku(),Wf=ku(!0);function ku(e=!1){return function(r,n,i,u){let x=r[n];if(Kr(x)&&Je(x)&&!Je(i))return!1;if(!e&&(!ui(i)&&!Kr(i)&&(x=Pe(x),i=Pe(i)),!Ie(r)&&Je(x)&&!Je(i)))return x.value=i,!0;const b=Ie(r)&&ra(n)?Number(n)<r.length:Re(r,n),s=Reflect.set(r,n,i,u);return r===Pe(u)&&(b?_n(i,x)&&jt(r,"set",n,i):jt(r,"add",n,i)),s}}function Gf(e,t){const r=Re(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&r&&jt(e,"delete",t,void 0),n}function Yf(e,t){const r=Reflect.has(e,t);return(!ta(t)||!Fu.has(t))&&dt(e,"has",t),r}function Vf(e){return dt(e,"iterate",Ie(e)?"length":Tr),Reflect.ownKeys(e)}const Bu={get:Bf,set:Kf,deleteProperty:Gf,has:Yf,ownKeys:Vf},jf={get:Uf,set(e,t){return!0},deleteProperty(e,t){return!0}},Xf=tt({},Bu,{get:wf,set:Wf}),aa=e=>e,Li=e=>Reflect.getPrototypeOf(e);function Un(e,t,r=!1,n=!1){e=e.__v_raw;const i=Pe(e),u=Pe(t);r||(t!==u&&dt(i,"get",t),dt(i,"get",u));const{has:x}=Li(i),b=n?aa:r?la:An;if(x.call(i,t))return b(e.get(t));if(x.call(i,u))return b(e.get(u));e!==i&&e.get(t)}function Hn(e,t=!1){const r=this.__v_raw,n=Pe(r),i=Pe(e);return t||(e!==i&&dt(n,"has",e),dt(n,"has",i)),e===i?r.has(e):r.has(e)||r.has(i)}function Kn(e,t=!1){return e=e.__v_raw,!t&&dt(Pe(e),"iterate",Tr),Reflect.get(e,"size",e)}function $a(e){e=Pe(e);const t=Pe(this);return Li(t).has.call(t,e)||(t.add(e),jt(t,"add",e,e)),this}function Qa(e,t){t=Pe(t);const r=Pe(this),{has:n,get:i}=Li(r);let u=n.call(r,e);u||(e=Pe(e),u=n.call(r,e));const x=i.call(r,e);return r.set(e,t),u?_n(t,x)&&jt(r,"set",e,t):jt(r,"add",e,t),this}function za(e){const t=Pe(this),{has:r,get:n}=Li(t);let i=r.call(t,e);i||(e=Pe(e),i=r.call(t,e)),n&&n.call(t,e);const u=t.delete(e);return i&&jt(t,"delete",e,void 0),u}function qa(){const e=Pe(this),t=e.size!==0,r=e.clear();return t&&jt(e,"clear",void 0,void 0),r}function Wn(e,t){return function(n,i){const u=this,x=u.__v_raw,b=Pe(x),s=t?aa:e?la:An;return!e&&dt(b,"iterate",Tr),x.forEach((C,g)=>n.call(i,s(C),s(g),u))}}function Gn(e,t,r){return function(...n){const i=this.__v_raw,u=Pe(i),x=Fr(u),b=e==="entries"||e===Symbol.iterator&&x,s=e==="keys"&&x,C=i[e](...n),g=r?aa:t?la:An;return!t&&dt(u,"iterate",s?Ts:Tr),{next(){const{value:w,done:R}=C.next();return R?{value:w,done:R}:{value:b?[g(w[0]),g(w[1])]:g(w),done:R}},[Symbol.iterator](){return this}}}}function Qt(e){return function(...t){return e==="delete"?!1:this}}function $f(){const e={get(u){return Un(this,u)},get size(){return Kn(this)},has:Hn,add:$a,set:Qa,delete:za,clear:qa,forEach:Wn(!1,!1)},t={get(u){return Un(this,u,!1,!0)},get size(){return Kn(this)},has:Hn,add:$a,set:Qa,delete:za,clear:qa,forEach:Wn(!1,!0)},r={get(u){return Un(this,u,!0)},get size(){return Kn(this,!0)},has(u){return Hn.call(this,u,!0)},add:Qt("add"),set:Qt("set"),delete:Qt("delete"),clear:Qt("clear"),forEach:Wn(!0,!1)},n={get(u){return Un(this,u,!0,!0)},get size(){return Kn(this,!0)},has(u){return Hn.call(this,u,!0)},add:Qt("add"),set:Qt("set"),delete:Qt("delete"),clear:Qt("clear"),forEach:Wn(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(u=>{e[u]=Gn(u,!1,!1),r[u]=Gn(u,!0,!1),t[u]=Gn(u,!1,!0),n[u]=Gn(u,!0,!0)}),[e,r,t,n]}const[Qf,zf,qf,Jf]=$f();function oa(e,t){const r=t?e?Jf:qf:e?zf:Qf;return(n,i,u)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?n:Reflect.get(Re(r,i)&&i in n?r:n,i,u)}const Zf={get:oa(!1,!1)},ed={get:oa(!1,!0)},td={get:oa(!0,!1)},wu=new WeakMap,Uu=new WeakMap,Hu=new WeakMap,rd=new WeakMap;function nd(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function id(e){return e.__v_skip||!Object.isExtensible(e)?0:nd(Cf(e))}function On(e){return Kr(e)?e:ua(e,!1,Bu,Zf,wu)}function sd(e){return ua(e,!1,Xf,ed,Uu)}function Ku(e){return ua(e,!0,jf,td,Hu)}function ua(e,t,r,n,i){if(!Ue(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const u=i.get(e);if(u)return u;const x=id(e);if(x===0)return e;const b=new Proxy(e,x===2?n:r);return i.set(e,b),b}function kr(e){return Kr(e)?kr(e.__v_raw):!!(e&&e.__v_isReactive)}function Kr(e){return!!(e&&e.__v_isReadonly)}function ui(e){return!!(e&&e.__v_isShallow)}function Wu(e){return kr(e)||Kr(e)}function Pe(e){const t=e&&e.__v_raw;return t?Pe(t):e}function Gu(e){return ai(e,"__v_skip",!0),e}const An=e=>Ue(e)?On(e):e,la=e=>Ue(e)?Ku(e):e;function Yu(e){tr&&St&&(e=Pe(e),Nu(e.dep||(e.dep=na())))}function Vu(e,t){e=Pe(e),e.dep&&_s(e.dep)}function Je(e){return!!(e&&e.__v_isRef===!0)}function ad(e){return ju(e,!1)}function od(e){return ju(e,!0)}function ju(e,t){return Je(e)?e:new ud(e,t)}class ud{constructor(t,r){this.__v_isShallow=r,this.dep=void 0,this.__v_isRef=!0,this._rawValue=r?t:Pe(t),this._value=r?t:An(t)}get value(){return Yu(this),this._value}set value(t){const r=this.__v_isShallow||ui(t)||Kr(t);t=r?t:Pe(t),_n(t,this._rawValue)&&(this._rawValue=t,this._value=r?t:An(t),Vu(this))}}function Br(e){return Je(e)?e.value:e}const ld={get:(e,t,r)=>Br(Reflect.get(e,t,r)),set:(e,t,r,n)=>{const i=e[t];return Je(i)&&!Je(r)?(i.value=r,!0):Reflect.set(e,t,r,n)}};function Xu(e){return kr(e)?e:new Proxy(e,ld)}var $u;class cd{constructor(t,r,n,i){this._setter=r,this.dep=void 0,this.__v_isRef=!0,this[$u]=!1,this._dirty=!0,this.effect=new ia(t,()=>{this._dirty||(this._dirty=!0,Vu(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=n}get value(){const t=Pe(this);return Yu(t),(t._dirty||!t._cacheable)&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}$u="__v_isReadonly";function fd(e,t,r=!1){let n,i;const u=Le(e);return u?(n=e,i=xt):(n=e.get,i=e.set),new cd(n,i,u||!i,r)}function rr(e,t,r,n){let i;try{i=n?e(...n):e()}catch(u){Ci(u,t,r)}return i}function Lt(e,t,r,n){if(Le(e)){const u=rr(e,t,r,n);return u&&Cu(u)&&u.catch(x=>{Ci(x,t,r)}),u}const i=[];for(let u=0;u<e.length;u++)i.push(Lt(e[u],t,r,n));return i}function Ci(e,t,r,n=!0){const i=t?t.vnode:null;if(t){let u=t.parent;const x=t.proxy,b=r;for(;u;){const C=u.ec;if(C){for(let g=0;g<C.length;g++)if(C[g](e,x,b)===!1)return}u=u.parent}const s=t.appContext.config.errorHandler;if(s){rr(s,null,10,[e,x,b]);return}}dd(e,r,i,n)}function dd(e,t,r,n=!0){console.error(e)}let yn=!1,As=!1;const qe=[];let Nt=0;const wr=[];let Wt=null,dr=0;const Qu=Promise.resolve();let ca=null;function zu(e){const t=ca||Qu;return e?t.then(this?e.bind(this):e):t}function hd(e){let t=Nt+1,r=qe.length;for(;t<r;){const n=t+r>>>1;bn(qe[n])<e?t=n+1:r=n}return t}function fa(e){(!qe.length||!qe.includes(e,yn&&e.allowRecurse?Nt+1:Nt))&&(e.id==null?qe.push(e):qe.splice(hd(e.id),0,e),qu())}function qu(){!yn&&!As&&(As=!0,ca=Qu.then(Zu))}function gd(e){const t=qe.indexOf(e);t>Nt&&qe.splice(t,1)}function md(e){Ie(e)?wr.push(...e):(!Wt||!Wt.includes(e,e.allowRecurse?dr+1:dr))&&wr.push(e),qu()}function Ja(e,t=yn?Nt+1:0){for(;t<qe.length;t++){const r=qe[t];r&&r.pre&&(qe.splice(t,1),t--,r())}}function Ju(e){if(wr.length){const t=[...new Set(wr)];if(wr.length=0,Wt){Wt.push(...t);return}for(Wt=t,Wt.sort((r,n)=>bn(r)-bn(n)),dr=0;dr<Wt.length;dr++)Wt[dr]();Wt=null,dr=0}}const bn=e=>e.id==null?1/0:e.id,Ed=(e,t)=>{const r=bn(e)-bn(t);if(r===0){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return r};function Zu(e){As=!1,yn=!0,qe.sort(Ed);const t=xt;try{for(Nt=0;Nt<qe.length;Nt++){const r=qe[Nt];r&&r.active!==!1&&rr(r,null,14)}}finally{Nt=0,qe.length=0,Ju(),yn=!1,ca=null,(qe.length||wr.length)&&Zu()}}function vd(e,t,...r){if(e.isUnmounted)return;const n=e.vnode.props||ke;let i=r;const u=t.startsWith("update:"),x=u&&t.slice(7);if(x&&x in n){const g=`${x==="modelValue"?"model":x}Modifiers`,{number:w,trim:R}=n[g]||ke;R&&(i=r.map(K=>je(K)?K.trim():K)),w&&(i=r.map(oi))}let b,s=n[b=qi(t)]||n[b=qi(Ut(t))];!s&&u&&(s=n[b=qi($r(t))]),s&&Lt(s,e,6,i);const C=n[b+"Once"];if(C){if(!e.emitted)e.emitted={};else if(e.emitted[b])return;e.emitted[b]=!0,Lt(C,e,6,i)}}function el(e,t,r=!1){const n=t.emitsCache,i=n.get(e);if(i!==void 0)return i;const u=e.emits;let x={},b=!1;if(!Le(e)){const s=C=>{const g=el(C,t,!0);g&&(b=!0,tt(x,g))};!r&&t.mixins.length&&t.mixins.forEach(s),e.extends&&s(e.extends),e.mixins&&e.mixins.forEach(s)}return!u&&!b?(Ue(e)&&n.set(e,null),null):(Ie(u)?u.forEach(s=>x[s]=null):tt(x,u),Ue(e)&&n.set(e,x),x)}function Di(e,t){return!e||!bi(t)?!1:(t=t.slice(2).replace(/Once$/,""),Re(e,t[0].toLowerCase()+t.slice(1))||Re(e,$r(t))||Re(e,t))}let Tt=null,tl=null;function li(e){const t=Tt;return Tt=e,tl=e&&e.type.__scopeId||null,t}function pd(e,t=Tt,r){if(!t||e._n)return e;const n=(...i)=>{n._d&&oo(-1);const u=li(t);let x;try{x=e(...i)}finally{li(u),n._d&&oo(1)}return x};return n._n=!0,n._c=!0,n._d=!0,n}function Ji(e){const{type:t,vnode:r,proxy:n,withProxy:i,props:u,propsOptions:[x],slots:b,attrs:s,emit:C,render:g,renderCache:w,data:R,setupState:K,ctx:k,inheritAttrs:F}=e;let B,P;const M=li(e);try{if(r.shapeFlag&4){const N=i||n;B=Mt(g.call(N,N,w,u,K,R,k)),P=s}else{const N=t;B=Mt(N.length>1?N(u,{attrs:s,slots:b,emit:C}):N(u,null)),P=t.props?s:Td(s)}}catch(N){ln.length=0,Ci(N,e,1),B=lt(Ar)}let m=B;if(P&&F!==!1){const N=Object.keys(P),{shapeFlag:I}=m;N.length&&I&7&&(x&&N.some(Zs)&&(P=_d(P,x)),m=Wr(m,P))}return r.dirs&&(m=Wr(m),m.dirs=m.dirs?m.dirs.concat(r.dirs):r.dirs),r.transition&&(m.transition=r.transition),B=m,li(M),B}const Td=e=>{let t;for(const r in e)(r==="class"||r==="style"||bi(r))&&((t||(t={}))[r]=e[r]);return t},_d=(e,t)=>{const r={};for(const n in e)(!Zs(n)||!(n.slice(9)in t))&&(r[n]=e[n]);return r};function Ad(e,t,r){const{props:n,children:i,component:u}=e,{props:x,children:b,patchFlag:s}=t,C=u.emitsOptions;if(t.dirs||t.transition)return!0;if(r&&s>=0){if(s&1024)return!0;if(s&16)return n?Za(n,x,C):!!x;if(s&8){const g=t.dynamicProps;for(let w=0;w<g.length;w++){const R=g[w];if(x[R]!==n[R]&&!Di(C,R))return!0}}}else return(i||b)&&(!b||!b.$stable)?!0:n===x?!1:n?x?Za(n,x,C):!0:!!x;return!1}function Za(e,t,r){const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!0;for(let i=0;i<n.length;i++){const u=n[i];if(t[u]!==e[u]&&!Di(r,u))return!0}return!1}function yd({vnode:e,parent:t},r){for(;t&&t.subTree===e;)(e=t.vnode).el=r,t=t.parent}const bd=e=>e.__isSuspense;function Sd(e,t){t&&t.pendingBranch?Ie(e)?t.effects.push(...e):t.effects.push(e):md(e)}function Zn(e,t){if(Qe){let r=Qe.provides;const n=Qe.parent&&Qe.parent.provides;n===r&&(r=Qe.provides=Object.create(n)),r[e]=t}}function Yt(e,t,r=!1){const n=Qe||Tt;if(n){const i=n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides;if(i&&e in i)return i[e];if(arguments.length>1)return r&&Le(t)?t.call(n.proxy):t}}const Yn={};function ei(e,t,r){return rl(e,t,r)}function rl(e,t,{immediate:r,deep:n,flush:i,onTrack:u,onTrigger:x}=ke){const b=Qe;let s,C=!1,g=!1;if(Je(e)?(s=()=>e.value,C=ui(e)):kr(e)?(s=()=>e,n=!0):Ie(e)?(g=!0,C=e.some(m=>kr(m)||ui(m)),s=()=>e.map(m=>{if(Je(m))return m.value;if(kr(m))return vr(m);if(Le(m))return rr(m,b,2)})):Le(e)?t?s=()=>rr(e,b,2):s=()=>{if(!(b&&b.isUnmounted))return w&&w(),Lt(e,b,3,[R])}:s=xt,t&&n){const m=s;s=()=>vr(m())}let w,R=m=>{w=P.onStop=()=>{rr(m,b,4)}},K;if(In)if(R=xt,t?r&&Lt(t,b,3,[s(),g?[]:void 0,R]):s(),i==="sync"){const m=_h();K=m.__watcherHandles||(m.__watcherHandles=[])}else return xt;let k=g?new Array(e.length).fill(Yn):Yn;const F=()=>{if(P.active)if(t){const m=P.run();(n||C||(g?m.some((N,I)=>_n(N,k[I])):_n(m,k)))&&(w&&w(),Lt(t,b,3,[m,k===Yn?void 0:g&&k[0]===Yn?[]:k,R]),k=m)}else P.run()};F.allowRecurse=!!t;let B;i==="sync"?B=F:i==="post"?B=()=>st(F,b&&b.suspense):(F.pre=!0,b&&(F.id=b.uid),B=()=>fa(F));const P=new ia(s,B);t?r?F():k=P.run():i==="post"?st(P.run.bind(P),b&&b.suspense):P.run();const M=()=>{P.stop(),b&&b.scope&&ea(b.scope.effects,P)};return K&&K.push(M),M}function Id(e,t,r){const n=this.proxy,i=je(e)?e.includes(".")?nl(n,e):()=>n[e]:e.bind(n,n);let u;Le(t)?u=t:(u=t.handler,r=t);const x=Qe;Gr(this);const b=rl(i,u.bind(n),r);return x?Gr(x):_r(),b}function nl(e,t){const r=t.split(".");return()=>{let n=e;for(let i=0;i<r.length&&n;i++)n=n[r[i]];return n}}function vr(e,t){if(!Ue(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),Je(e))vr(e.value,t);else if(Ie(e))for(let r=0;r<e.length;r++)vr(e[r],t);else if(Lu(e)||Fr(e))e.forEach(r=>{vr(r,t)});else if(Ru(e))for(const r in e)vr(e[r],t);return e}function il(e){return Le(e)?{setup:e,name:e.name}:e}const ti=e=>!!e.type.__asyncLoader,sl=e=>e.type.__isKeepAlive;function xd(e,t){al(e,"a",t)}function Ld(e,t){al(e,"da",t)}function al(e,t,r=Qe){const n=e.__wdc||(e.__wdc=()=>{let i=r;for(;i;){if(i.isDeactivated)return;i=i.parent}return e()});if(Ri(t,n,r),r){let i=r.parent;for(;i&&i.parent;)sl(i.parent.vnode)&&Cd(n,t,r,i),i=i.parent}}function Cd(e,t,r,n){const i=Ri(t,e,n,!0);ol(()=>{ea(n[t],i)},r)}function Ri(e,t,r=Qe,n=!1){if(r){const i=r[e]||(r[e]=[]),u=t.__weh||(t.__weh=(...x)=>{if(r.isUnmounted)return;Qr(),Gr(r);const b=Lt(t,r,e,x);return _r(),zr(),b});return n?i.unshift(u):i.push(u),u}}const $t=e=>(t,r=Qe)=>(!In||e==="sp")&&Ri(e,(...n)=>t(...n),r),Dd=$t("bm"),Rd=$t("m"),Od=$t("bu"),Pd=$t("u"),Md=$t("bum"),ol=$t("um"),Nd=$t("sp"),Fd=$t("rtg"),kd=$t("rtc");function Bd(e,t=Qe){Ri("ec",e,t)}function W_(e,t){const r=Tt;if(r===null)return e;const n=Mi(r)||r.proxy,i=e.dirs||(e.dirs=[]);for(let u=0;u<t.length;u++){let[x,b,s,C=ke]=t[u];x&&(Le(x)&&(x={mounted:x,updated:x}),x.deep&&vr(b),i.push({dir:x,instance:n,value:b,oldValue:void 0,arg:s,modifiers:C}))}return e}function ur(e,t,r,n){const i=e.dirs,u=t&&t.dirs;for(let x=0;x<i.length;x++){const b=i[x];u&&(b.oldValue=u[x].value);let s=b.dir[n];s&&(Qr(),Lt(s,r,8,[e.el,b,e,t]),zr())}}const ul="components",wd="directives";function G_(e,t){return ll(ul,e,!0,t)||e}const Ud=Symbol();function Y_(e){return ll(wd,e)}function ll(e,t,r=!0,n=!1){const i=Tt||Qe;if(i){const u=i.type;if(e===ul){const b=vh(u,!1);if(b&&(b===t||b===Ut(t)||b===xi(Ut(t))))return u}const x=eo(i[e]||u[e],t)||eo(i.appContext[e],t);return!x&&n?u:x}}function eo(e,t){return e&&(e[t]||e[Ut(t)]||e[xi(Ut(t))])}function V_(e,t,r,n){let i;const u=r&&r[n];if(Ie(e)||je(e)){i=new Array(e.length);for(let x=0,b=e.length;x<b;x++)i[x]=t(e[x],x,void 0,u&&u[x])}else if(typeof e=="number"){i=new Array(e);for(let x=0;x<e;x++)i[x]=t(x+1,x,void 0,u&&u[x])}else if(Ue(e))if(e[Symbol.iterator])i=Array.from(e,(x,b)=>t(x,b,void 0,u&&u[b]));else{const x=Object.keys(e);i=new Array(x.length);for(let b=0,s=x.length;b<s;b++){const C=x[b];i[b]=t(e[C],C,b,u&&u[b])}}else i=[];return r&&(r[n]=i),i}const ys=e=>e?Al(e)?Mi(e)||e.proxy:ys(e.parent):null,un=tt(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>ys(e.parent),$root:e=>ys(e.root),$emit:e=>e.emit,$options:e=>da(e),$forceUpdate:e=>e.f||(e.f=()=>fa(e.update)),$nextTick:e=>e.n||(e.n=zu.bind(e.proxy)),$watch:e=>Id.bind(e)}),Zi=(e,t)=>e!==ke&&!e.__isScriptSetup&&Re(e,t),Hd={get({_:e},t){const{ctx:r,setupState:n,data:i,props:u,accessCache:x,type:b,appContext:s}=e;let C;if(t[0]!=="$"){const K=x[t];if(K!==void 0)switch(K){case 1:return n[t];case 2:return i[t];case 4:return r[t];case 3:return u[t]}else{if(Zi(n,t))return x[t]=1,n[t];if(i!==ke&&Re(i,t))return x[t]=2,i[t];if((C=e.propsOptions[0])&&Re(C,t))return x[t]=3,u[t];if(r!==ke&&Re(r,t))return x[t]=4,r[t];bs&&(x[t]=0)}}const g=un[t];let w,R;if(g)return t==="$attrs"&&dt(e,"get",t),g(e);if((w=b.__cssModules)&&(w=w[t]))return w;if(r!==ke&&Re(r,t))return x[t]=4,r[t];if(R=s.config.globalProperties,Re(R,t))return R[t]},set({_:e},t,r){const{data:n,setupState:i,ctx:u}=e;return Zi(i,t)?(i[t]=r,!0):n!==ke&&Re(n,t)?(n[t]=r,!0):Re(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(u[t]=r,!0)},has({_:{data:e,setupState:t,accessCache:r,ctx:n,appContext:i,propsOptions:u}},x){let b;return!!r[x]||e!==ke&&Re(e,x)||Zi(t,x)||(b=u[0])&&Re(b,x)||Re(n,x)||Re(un,x)||Re(i.config.globalProperties,x)},defineProperty(e,t,r){return r.get!=null?e._.accessCache[t]=0:Re(r,"value")&&this.set(e,t,r.value,null),Reflect.defineProperty(e,t,r)}};let bs=!0;function Kd(e){const t=da(e),r=e.proxy,n=e.ctx;bs=!1,t.beforeCreate&&to(t.beforeCreate,e,"bc");const{data:i,computed:u,methods:x,watch:b,provide:s,inject:C,created:g,beforeMount:w,mounted:R,beforeUpdate:K,updated:k,activated:F,deactivated:B,beforeDestroy:P,beforeUnmount:M,destroyed:m,unmounted:N,render:I,renderTracked:h,renderTriggered:E,errorCaptured:d,serverPrefetch:c,expose:S,inheritAttrs:v,components:l,directives:p,filters:y}=t;if(C&&Wd(C,n,null,e.appContext.config.unwrapInjectedRef),x)for(const a in x){const _=x[a];Le(_)&&(n[a]=_.bind(r))}if(i){const a=i.call(r,r);Ue(a)&&(e.data=On(a))}if(bs=!0,u)for(const a in u){const _=u[a],o=Le(_)?_.bind(r,r):Le(_.get)?_.get.bind(r,r):xt,A=!Le(_)&&Le(_.set)?_.set.bind(r):xt,O=pt({get:o,set:A});Object.defineProperty(n,a,{enumerable:!0,configurable:!0,get:()=>O.value,set:L=>O.value=L})}if(b)for(const a in b)cl(b[a],n,r,a);if(s){const a=Le(s)?s.call(r):s;Reflect.ownKeys(a).forEach(_=>{Zn(_,a[_])})}g&&to(g,e,"c");function f(a,_){Ie(_)?_.forEach(o=>a(o.bind(r))):_&&a(_.bind(r))}if(f(Dd,w),f(Rd,R),f(Od,K),f(Pd,k),f(xd,F),f(Ld,B),f(Bd,d),f(kd,h),f(Fd,E),f(Md,M),f(ol,N),f(Nd,c),Ie(S))if(S.length){const a=e.exposed||(e.exposed={});S.forEach(_=>{Object.defineProperty(a,_,{get:()=>r[_],set:o=>r[_]=o})})}else e.exposed||(e.exposed={});I&&e.render===xt&&(e.render=I),v!=null&&(e.inheritAttrs=v),l&&(e.components=l),p&&(e.directives=p)}function Wd(e,t,r=xt,n=!1){Ie(e)&&(e=Ss(e));for(const i in e){const u=e[i];let x;Ue(u)?"default"in u?x=Yt(u.from||i,u.default,!0):x=Yt(u.from||i):x=Yt(u),Je(x)&&n?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>x.value,set:b=>x.value=b}):t[i]=x}}function to(e,t,r){Lt(Ie(e)?e.map(n=>n.bind(t.proxy)):e.bind(t.proxy),t,r)}function cl(e,t,r,n){const i=n.includes(".")?nl(r,n):()=>r[n];if(je(e)){const u=t[e];Le(u)&&ei(i,u)}else if(Le(e))ei(i,e.bind(r));else if(Ue(e))if(Ie(e))e.forEach(u=>cl(u,t,r,n));else{const u=Le(e.handler)?e.handler.bind(r):t[e.handler];Le(u)&&ei(i,u,e)}}function da(e){const t=e.type,{mixins:r,extends:n}=t,{mixins:i,optionsCache:u,config:{optionMergeStrategies:x}}=e.appContext,b=u.get(t);let s;return b?s=b:!i.length&&!r&&!n?s=t:(s={},i.length&&i.forEach(C=>ci(s,C,x,!0)),ci(s,t,x)),Ue(t)&&u.set(t,s),s}function ci(e,t,r,n=!1){const{mixins:i,extends:u}=t;u&&ci(e,u,r,!0),i&&i.forEach(x=>ci(e,x,r,!0));for(const x in t)if(!(n&&x==="expose")){const b=Gd[x]||r&&r[x];e[x]=b?b(e[x],t[x]):t[x]}return e}const Gd={data:ro,props:fr,emits:fr,methods:fr,computed:fr,beforeCreate:et,created:et,beforeMount:et,mounted:et,beforeUpdate:et,updated:et,beforeDestroy:et,beforeUnmount:et,destroyed:et,unmounted:et,activated:et,deactivated:et,errorCaptured:et,serverPrefetch:et,components:fr,directives:fr,watch:Vd,provide:ro,inject:Yd};function ro(e,t){return t?e?function(){return tt(Le(e)?e.call(this,this):e,Le(t)?t.call(this,this):t)}:t:e}function Yd(e,t){return fr(Ss(e),Ss(t))}function Ss(e){if(Ie(e)){const t={};for(let r=0;r<e.length;r++)t[e[r]]=e[r];return t}return e}function et(e,t){return e?[...new Set([].concat(e,t))]:t}function fr(e,t){return e?tt(tt(Object.create(null),e),t):t}function Vd(e,t){if(!e)return t;if(!t)return e;const r=tt(Object.create(null),e);for(const n in t)r[n]=et(e[n],t[n]);return r}function jd(e,t,r,n=!1){const i={},u={};ai(u,Pi,1),e.propsDefaults=Object.create(null),fl(e,t,i,u);for(const x in e.propsOptions[0])x in i||(i[x]=void 0);r?e.props=n?i:sd(i):e.type.props?e.props=i:e.props=u,e.attrs=u}function Xd(e,t,r,n){const{props:i,attrs:u,vnode:{patchFlag:x}}=e,b=Pe(i),[s]=e.propsOptions;let C=!1;if((n||x>0)&&!(x&16)){if(x&8){const g=e.vnode.dynamicProps;for(let w=0;w<g.length;w++){let R=g[w];if(Di(e.emitsOptions,R))continue;const K=t[R];if(s)if(Re(u,R))K!==u[R]&&(u[R]=K,C=!0);else{const k=Ut(R);i[k]=Is(s,b,k,K,e,!1)}else K!==u[R]&&(u[R]=K,C=!0)}}}else{fl(e,t,i,u)&&(C=!0);let g;for(const w in b)(!t||!Re(t,w)&&((g=$r(w))===w||!Re(t,g)))&&(s?r&&(r[w]!==void 0||r[g]!==void 0)&&(i[w]=Is(s,b,w,void 0,e,!0)):delete i[w]);if(u!==b)for(const w in u)(!t||!Re(t,w))&&(delete u[w],C=!0)}C&&jt(e,"set","$attrs")}function fl(e,t,r,n){const[i,u]=e.propsOptions;let x=!1,b;if(t)for(let s in t){if(qn(s))continue;const C=t[s];let g;i&&Re(i,g=Ut(s))?!u||!u.includes(g)?r[g]=C:(b||(b={}))[g]=C:Di(e.emitsOptions,s)||(!(s in n)||C!==n[s])&&(n[s]=C,x=!0)}if(u){const s=Pe(r),C=b||ke;for(let g=0;g<u.length;g++){const w=u[g];r[w]=Is(i,s,w,C[w],e,!Re(C,w))}}return x}function Is(e,t,r,n,i,u){const x=e[r];if(x!=null){const b=Re(x,"default");if(b&&n===void 0){const s=x.default;if(x.type!==Function&&Le(s)){const{propsDefaults:C}=i;r in C?n=C[r]:(Gr(i),n=C[r]=s.call(null,t),_r())}else n=s}x[0]&&(u&&!b?n=!1:x[1]&&(n===""||n===$r(r))&&(n=!0))}return n}function dl(e,t,r=!1){const n=t.propsCache,i=n.get(e);if(i)return i;const u=e.props,x={},b=[];let s=!1;if(!Le(e)){const g=w=>{s=!0;const[R,K]=dl(w,t,!0);tt(x,R),K&&b.push(...K)};!r&&t.mixins.length&&t.mixins.forEach(g),e.extends&&g(e.extends),e.mixins&&e.mixins.forEach(g)}if(!u&&!s)return Ue(e)&&n.set(e,Nr),Nr;if(Ie(u))for(let g=0;g<u.length;g++){const w=Ut(u[g]);no(w)&&(x[w]=ke)}else if(u)for(const g in u){const w=Ut(g);if(no(w)){const R=u[g],K=x[w]=Ie(R)||Le(R)?{type:R}:Object.assign({},R);if(K){const k=ao(Boolean,K.type),F=ao(String,K.type);K[0]=k>-1,K[1]=F<0||k<F,(k>-1||Re(K,"default"))&&b.push(w)}}}const C=[x,b];return Ue(e)&&n.set(e,C),C}function no(e){return e[0]!=="$"}function io(e){const t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:e===null?"null":""}function so(e,t){return io(e)===io(t)}function ao(e,t){return Ie(t)?t.findIndex(r=>so(r,e)):Le(t)&&so(t,e)?0:-1}const hl=e=>e[0]==="_"||e==="$stable",ha=e=>Ie(e)?e.map(Mt):[Mt(e)],$d=(e,t,r)=>{if(t._n)return t;const n=pd((...i)=>ha(t(...i)),r);return n._c=!1,n},gl=(e,t,r)=>{const n=e._ctx;for(const i in e){if(hl(i))continue;const u=e[i];if(Le(u))t[i]=$d(i,u,n);else if(u!=null){const x=ha(u);t[i]=()=>x}}},ml=(e,t)=>{const r=ha(t);e.slots.default=()=>r},Qd=(e,t)=>{if(e.vnode.shapeFlag&32){const r=t._;r?(e.slots=Pe(t),ai(t,"_",r)):gl(t,e.slots={})}else e.slots={},t&&ml(e,t);ai(e.slots,Pi,1)},zd=(e,t,r)=>{const{vnode:n,slots:i}=e;let u=!0,x=ke;if(n.shapeFlag&32){const b=t._;b?r&&b===1?u=!1:(tt(i,t),!r&&b===1&&delete i._):(u=!t.$stable,gl(t,i)),x=t}else t&&(ml(e,t),x={default:1});if(u)for(const b in i)!hl(b)&&!(b in x)&&delete i[b]};function El(){return{app:null,config:{isNativeTag:If,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let qd=0;function Jd(e,t){return function(n,i=null){Le(n)||(n=Object.assign({},n)),i!=null&&!Ue(i)&&(i=null);const u=El(),x=new Set;let b=!1;const s=u.app={_uid:qd++,_component:n,_props:i,_container:null,_context:u,_instance:null,version:Ah,get config(){return u.config},set config(C){},use(C,...g){return x.has(C)||(C&&Le(C.install)?(x.add(C),C.install(s,...g)):Le(C)&&(x.add(C),C(s,...g))),s},mixin(C){return u.mixins.includes(C)||u.mixins.push(C),s},component(C,g){return g?(u.components[C]=g,s):u.components[C]},directive(C,g){return g?(u.directives[C]=g,s):u.directives[C]},mount(C,g,w){if(!b){const R=lt(n,i);return R.appContext=u,g&&t?t(R,C):e(R,C,w),b=!0,s._container=C,C.__vue_app__=s,Mi(R.component)||R.component.proxy}},unmount(){b&&(e(null,s._container),delete s._container.__vue_app__)},provide(C,g){return u.provides[C]=g,s}};return s}}function xs(e,t,r,n,i=!1){if(Ie(e)){e.forEach((R,K)=>xs(R,t&&(Ie(t)?t[K]:t),r,n,i));return}if(ti(n)&&!i)return;const u=n.shapeFlag&4?Mi(n.component)||n.component.proxy:n.el,x=i?null:u,{i:b,r:s}=e,C=t&&t.r,g=b.refs===ke?b.refs={}:b.refs,w=b.setupState;if(C!=null&&C!==s&&(je(C)?(g[C]=null,Re(w,C)&&(w[C]=null)):Je(C)&&(C.value=null)),Le(s))rr(s,b,12,[x,g]);else{const R=je(s),K=Je(s);if(R||K){const k=()=>{if(e.f){const F=R?Re(w,s)?w[s]:g[s]:s.value;i?Ie(F)&&ea(F,u):Ie(F)?F.includes(u)||F.push(u):R?(g[s]=[u],Re(w,s)&&(w[s]=g[s])):(s.value=[u],e.k&&(g[e.k]=s.value))}else R?(g[s]=x,Re(w,s)&&(w[s]=x)):K&&(s.value=x,e.k&&(g[e.k]=x))};x?(k.id=-1,st(k,r)):k()}}}const st=Sd;function Zd(e){return eh(e)}function eh(e,t){const r=Of();r.__VUE__=!0;const{insert:n,remove:i,patchProp:u,createElement:x,createText:b,createComment:s,setText:C,setElementText:g,parentNode:w,nextSibling:R,setScopeId:K=xt,insertStaticContent:k}=e,F=(V,$,ee,Z=null,re=null,ae=null,le=!1,ne=null,ie=!!$.dynamicChildren)=>{if(V===$)return;V&&!en(V,$)&&(Z=Y(V),L(V,re,ae,!0),V=null),$.patchFlag===-2&&(ie=!1,$.dynamicChildren=null);const{type:oe,ref:ge,shapeFlag:he}=$;switch(oe){case Oi:B(V,$,ee,Z);break;case Ar:P(V,$,ee,Z);break;case ri:V==null&&M($,ee,Z,le);break;case Gt:l(V,$,ee,Z,re,ae,le,ne,ie);break;default:he&1?I(V,$,ee,Z,re,ae,le,ne,ie):he&6?p(V,$,ee,Z,re,ae,le,ne,ie):(he&64||he&128)&&oe.process(V,$,ee,Z,re,ae,le,ne,ie,X)}ge!=null&&re&&xs(ge,V&&V.ref,ae,$||V,!$)},B=(V,$,ee,Z)=>{if(V==null)n($.el=b($.children),ee,Z);else{const re=$.el=V.el;$.children!==V.children&&C(re,$.children)}},P=(V,$,ee,Z)=>{V==null?n($.el=s($.children||""),ee,Z):$.el=V.el},M=(V,$,ee,Z)=>{[V.el,V.anchor]=k(V.children,$,ee,Z,V.el,V.anchor)},m=({el:V,anchor:$},ee,Z)=>{let re;for(;V&&V!==$;)re=R(V),n(V,ee,Z),V=re;n($,ee,Z)},N=({el:V,anchor:$})=>{let ee;for(;V&&V!==$;)ee=R(V),i(V),V=ee;i($)},I=(V,$,ee,Z,re,ae,le,ne,ie)=>{le=le||$.type==="svg",V==null?h($,ee,Z,re,ae,le,ne,ie):c(V,$,re,ae,le,ne,ie)},h=(V,$,ee,Z,re,ae,le,ne)=>{let ie,oe;const{type:ge,props:he,shapeFlag:me,transition:Ee,dirs:pe}=V;if(ie=V.el=x(V.type,ae,he&&he.is,he),me&8?g(ie,V.children):me&16&&d(V.children,ie,null,Z,re,ae&&ge!=="foreignObject",le,ne),pe&&ur(V,null,Z,"created"),he){for(const _e in he)_e!=="value"&&!qn(_e)&&u(ie,_e,null,he[_e],ae,V.children,Z,re,G);"value"in he&&u(ie,"value",null,he.value),(oe=he.onVnodeBeforeMount)&&Rt(oe,Z,V)}E(ie,V,V.scopeId,le,Z),pe&&ur(V,null,Z,"beforeMount");const Te=(!re||re&&!re.pendingBranch)&&Ee&&!Ee.persisted;Te&&Ee.beforeEnter(ie),n(ie,$,ee),((oe=he&&he.onVnodeMounted)||Te||pe)&&st(()=>{oe&&Rt(oe,Z,V),Te&&Ee.enter(ie),pe&&ur(V,null,Z,"mounted")},re)},E=(V,$,ee,Z,re)=>{if(ee&&K(V,ee),Z)for(let ae=0;ae<Z.length;ae++)K(V,Z[ae]);if(re){let ae=re.subTree;if($===ae){const le=re.vnode;E(V,le,le.scopeId,le.slotScopeIds,re.parent)}}},d=(V,$,ee,Z,re,ae,le,ne,ie=0)=>{for(let oe=ie;oe<V.length;oe++){const ge=V[oe]=ne?Zt(V[oe]):Mt(V[oe]);F(null,ge,$,ee,Z,re,ae,le,ne)}},c=(V,$,ee,Z,re,ae,le)=>{const ne=$.el=V.el;let{patchFlag:ie,dynamicChildren:oe,dirs:ge}=$;ie|=V.patchFlag&16;const he=V.props||ke,me=$.props||ke;let Ee;ee&&lr(ee,!1),(Ee=me.onVnodeBeforeUpdate)&&Rt(Ee,ee,$,V),ge&&ur($,V,ee,"beforeUpdate"),ee&&lr(ee,!0);const pe=re&&$.type!=="foreignObject";if(oe?S(V.dynamicChildren,oe,ne,ee,Z,pe,ae):le||_(V,$,ne,null,ee,Z,pe,ae,!1),ie>0){if(ie&16)v(ne,$,he,me,ee,Z,re);else if(ie&2&&he.class!==me.class&&u(ne,"class",null,me.class,re),ie&4&&u(ne,"style",he.style,me.style,re),ie&8){const Te=$.dynamicProps;for(let _e=0;_e<Te.length;_e++){const ye=Te[_e],De=he[ye],Be=me[ye];(Be!==De||ye==="value")&&u(ne,ye,De,Be,re,V.children,ee,Z,G)}}ie&1&&V.children!==$.children&&g(ne,$.children)}else!le&&oe==null&&v(ne,$,he,me,ee,Z,re);((Ee=me.onVnodeUpdated)||ge)&&st(()=>{Ee&&Rt(Ee,ee,$,V),ge&&ur($,V,ee,"updated")},Z)},S=(V,$,ee,Z,re,ae,le)=>{for(let ne=0;ne<$.length;ne++){const ie=V[ne],oe=$[ne],ge=ie.el&&(ie.type===Gt||!en(ie,oe)||ie.shapeFlag&70)?w(ie.el):ee;F(ie,oe,ge,null,Z,re,ae,le,!0)}},v=(V,$,ee,Z,re,ae,le)=>{if(ee!==Z){if(ee!==ke)for(const ne in ee)!qn(ne)&&!(ne in Z)&&u(V,ne,ee[ne],null,le,$.children,re,ae,G);for(const ne in Z){if(qn(ne))continue;const ie=Z[ne],oe=ee[ne];ie!==oe&&ne!=="value"&&u(V,ne,oe,ie,le,$.children,re,ae,G)}"value"in Z&&u(V,"value",ee.value,Z.value)}},l=(V,$,ee,Z,re,ae,le,ne,ie)=>{const oe=$.el=V?V.el:b(""),ge=$.anchor=V?V.anchor:b("");let{patchFlag:he,dynamicChildren:me,slotScopeIds:Ee}=$;Ee&&(ne=ne?ne.concat(Ee):Ee),V==null?(n(oe,ee,Z),n(ge,ee,Z),d($.children,ee,ge,re,ae,le,ne,ie)):he>0&&he&64&&me&&V.dynamicChildren?(S(V.dynamicChildren,me,ee,re,ae,le,ne),($.key!=null||re&&$===re.subTree)&&vl(V,$,!0)):_(V,$,ee,ge,re,ae,le,ne,ie)},p=(V,$,ee,Z,re,ae,le,ne,ie)=>{$.slotScopeIds=ne,V==null?$.shapeFlag&512?re.ctx.activate($,ee,Z,le,ie):y($,ee,Z,re,ae,le,ie):T(V,$,ie)},y=(V,$,ee,Z,re,ae,le)=>{const ne=V.component=dh(V,Z,re);if(sl(V)&&(ne.ctx.renderer=X),hh(ne),ne.asyncDep){if(re&&re.registerDep(ne,f),!V.el){const ie=ne.subTree=lt(Ar);P(null,ie,$,ee)}return}f(ne,V,$,ee,re,ae,le)},T=(V,$,ee)=>{const Z=$.component=V.component;if(Ad(V,$,ee))if(Z.asyncDep&&!Z.asyncResolved){a(Z,$,ee);return}else Z.next=$,gd(Z.update),Z.update();else $.el=V.el,Z.vnode=$},f=(V,$,ee,Z,re,ae,le)=>{const ne=()=>{if(V.isMounted){let{next:ge,bu:he,u:me,parent:Ee,vnode:pe}=V,Te=ge,_e;lr(V,!1),ge?(ge.el=pe.el,a(V,ge,le)):ge=pe,he&&Jn(he),(_e=ge.props&&ge.props.onVnodeBeforeUpdate)&&Rt(_e,Ee,ge,pe),lr(V,!0);const ye=Ji(V),De=V.subTree;V.subTree=ye,F(De,ye,w(De.el),Y(De),V,re,ae),ge.el=ye.el,Te===null&&yd(V,ye.el),me&&st(me,re),(_e=ge.props&&ge.props.onVnodeUpdated)&&st(()=>Rt(_e,Ee,ge,pe),re)}else{let ge;const{el:he,props:me}=$,{bm:Ee,m:pe,parent:Te}=V,_e=ti($);if(lr(V,!1),Ee&&Jn(Ee),!_e&&(ge=me&&me.onVnodeBeforeMount)&&Rt(ge,Te,$),lr(V,!0),he&&J){const ye=()=>{V.subTree=Ji(V),J(he,V.subTree,V,re,null)};_e?$.type.__asyncLoader().then(()=>!V.isUnmounted&&ye()):ye()}else{const ye=V.subTree=Ji(V);F(null,ye,ee,Z,V,re,ae),$.el=ye.el}if(pe&&st(pe,re),!_e&&(ge=me&&me.onVnodeMounted)){const ye=$;st(()=>Rt(ge,Te,ye),re)}($.shapeFlag&256||Te&&ti(Te.vnode)&&Te.vnode.shapeFlag&256)&&V.a&&st(V.a,re),V.isMounted=!0,$=ee=Z=null}},ie=V.effect=new ia(ne,()=>fa(oe),V.scope),oe=V.update=()=>ie.run();oe.id=V.uid,lr(V,!0),oe()},a=(V,$,ee)=>{$.component=V;const Z=V.vnode.props;V.vnode=$,V.next=null,Xd(V,$.props,Z,ee),zd(V,$.children,ee),Qr(),Ja(),zr()},_=(V,$,ee,Z,re,ae,le,ne,ie=!1)=>{const oe=V&&V.children,ge=V?V.shapeFlag:0,he=$.children,{patchFlag:me,shapeFlag:Ee}=$;if(me>0){if(me&128){A(oe,he,ee,Z,re,ae,le,ne,ie);return}else if(me&256){o(oe,he,ee,Z,re,ae,le,ne,ie);return}}Ee&8?(ge&16&&G(oe,re,ae),he!==oe&&g(ee,he)):ge&16?Ee&16?A(oe,he,ee,Z,re,ae,le,ne,ie):G(oe,re,ae,!0):(ge&8&&g(ee,""),Ee&16&&d(he,ee,Z,re,ae,le,ne,ie))},o=(V,$,ee,Z,re,ae,le,ne,ie)=>{V=V||Nr,$=$||Nr;const oe=V.length,ge=$.length,he=Math.min(oe,ge);let me;for(me=0;me<he;me++){const Ee=$[me]=ie?Zt($[me]):Mt($[me]);F(V[me],Ee,ee,null,re,ae,le,ne,ie)}oe>ge?G(V,re,ae,!0,!1,he):d($,ee,Z,re,ae,le,ne,ie,he)},A=(V,$,ee,Z,re,ae,le,ne,ie)=>{let oe=0;const ge=$.length;let he=V.length-1,me=ge-1;for(;oe<=he&&oe<=me;){const Ee=V[oe],pe=$[oe]=ie?Zt($[oe]):Mt($[oe]);if(en(Ee,pe))F(Ee,pe,ee,null,re,ae,le,ne,ie);else break;oe++}for(;oe<=he&&oe<=me;){const Ee=V[he],pe=$[me]=ie?Zt($[me]):Mt($[me]);if(en(Ee,pe))F(Ee,pe,ee,null,re,ae,le,ne,ie);else break;he--,me--}if(oe>he){if(oe<=me){const Ee=me+1,pe=Ee<ge?$[Ee].el:Z;for(;oe<=me;)F(null,$[oe]=ie?Zt($[oe]):Mt($[oe]),ee,pe,re,ae,le,ne,ie),oe++}}else if(oe>me)for(;oe<=he;)L(V[oe],re,ae,!0),oe++;else{const Ee=oe,pe=oe,Te=new Map;for(oe=pe;oe<=me;oe++){const Me=$[oe]=ie?Zt($[oe]):Mt($[oe]);Me.key!=null&&Te.set(Me.key,oe)}let _e,ye=0;const De=me-pe+1;let Be=!1,He=0;const Ke=new Array(De);for(oe=0;oe<De;oe++)Ke[oe]=0;for(oe=Ee;oe<=he;oe++){const Me=V[oe];if(ye>=De){L(Me,re,ae,!0);continue}let Ge;if(Me.key!=null)Ge=Te.get(Me.key);else for(_e=pe;_e<=me;_e++)if(Ke[_e-pe]===0&&en(Me,$[_e])){Ge=_e;break}Ge===void 0?L(Me,re,ae,!0):(Ke[Ge-pe]=oe+1,Ge>=He?He=Ge:Be=!0,F(Me,$[Ge],ee,null,re,ae,le,ne,ie),ye++)}const ct=Be?th(Ke):Nr;for(_e=ct.length-1,oe=De-1;oe>=0;oe--){const Me=pe+oe,Ge=$[Me],rt=Me+1<ge?$[Me+1].el:Z;Ke[oe]===0?F(null,Ge,ee,rt,re,ae,le,ne,ie):Be&&(_e<0||oe!==ct[_e]?O(Ge,ee,rt,2):_e--)}}},O=(V,$,ee,Z,re=null)=>{const{el:ae,type:le,transition:ne,children:ie,shapeFlag:oe}=V;if(oe&6){O(V.component.subTree,$,ee,Z);return}if(oe&128){V.suspense.move($,ee,Z);return}if(oe&64){le.move(V,$,ee,X);return}if(le===Gt){n(ae,$,ee);for(let he=0;he<ie.length;he++)O(ie[he],$,ee,Z);n(V.anchor,$,ee);return}if(le===ri){m(V,$,ee);return}if(Z!==2&&oe&1&&ne)if(Z===0)ne.beforeEnter(ae),n(ae,$,ee),st(()=>ne.enter(ae),re);else{const{leave:he,delayLeave:me,afterLeave:Ee}=ne,pe=()=>n(ae,$,ee),Te=()=>{he(ae,()=>{pe(),Ee&&Ee()})};me?me(ae,pe,Te):Te()}else n(ae,$,ee)},L=(V,$,ee,Z=!1,re=!1)=>{const{type:ae,props:le,ref:ne,children:ie,dynamicChildren:oe,shapeFlag:ge,patchFlag:he,dirs:me}=V;if(ne!=null&&xs(ne,null,ee,V,!0),ge&256){$.ctx.deactivate(V);return}const Ee=ge&1&&me,pe=!ti(V);let Te;if(pe&&(Te=le&&le.onVnodeBeforeUnmount)&&Rt(Te,$,V),ge&6)U(V.component,ee,Z);else{if(ge&128){V.suspense.unmount(ee,Z);return}Ee&&ur(V,null,$,"beforeUnmount"),ge&64?V.type.remove(V,$,ee,re,X,Z):oe&&(ae!==Gt||he>0&&he&64)?G(oe,$,ee,!1,!0):(ae===Gt&&he&384||!re&&ge&16)&&G(ie,$,ee),Z&&H(V)}(pe&&(Te=le&&le.onVnodeUnmounted)||Ee)&&st(()=>{Te&&Rt(Te,$,V),Ee&&ur(V,null,$,"unmounted")},ee)},H=V=>{const{type:$,el:ee,anchor:Z,transition:re}=V;if($===Gt){W(ee,Z);return}if($===ri){N(V);return}const ae=()=>{i(ee),re&&!re.persisted&&re.afterLeave&&re.afterLeave()};if(V.shapeFlag&1&&re&&!re.persisted){const{leave:le,delayLeave:ne}=re,ie=()=>le(ee,ae);ne?ne(V.el,ae,ie):ie()}else ae()},W=(V,$)=>{let ee;for(;V!==$;)ee=R(V),i(V),V=ee;i($)},U=(V,$,ee)=>{const{bum:Z,scope:re,update:ae,subTree:le,um:ne}=V;Z&&Jn(Z),re.stop(),ae&&(ae.active=!1,L(le,V,$,ee)),ne&&st(ne,$),st(()=>{V.isUnmounted=!0},$),$&&$.pendingBranch&&!$.isUnmounted&&V.asyncDep&&!V.asyncResolved&&V.suspenseId===$.pendingId&&($.deps--,$.deps===0&&$.resolve())},G=(V,$,ee,Z=!1,re=!1,ae=0)=>{for(let le=ae;le<V.length;le++)L(V[le],$,ee,Z,re)},Y=V=>V.shapeFlag&6?Y(V.component.subTree):V.shapeFlag&128?V.suspense.next():R(V.anchor||V.el),j=(V,$,ee)=>{V==null?$._vnode&&L($._vnode,null,null,!0):F($._vnode||null,V,$,null,null,null,ee),Ja(),Ju(),$._vnode=V},X={p:F,um:L,m:O,r:H,mt:y,mc:d,pc:_,pbc:S,n:Y,o:e};let q,J;return t&&([q,J]=t(X)),{render:j,hydrate:q,createApp:Jd(j,q)}}function lr({effect:e,update:t},r){e.allowRecurse=t.allowRecurse=r}function vl(e,t,r=!1){const n=e.children,i=t.children;if(Ie(n)&&Ie(i))for(let u=0;u<n.length;u++){const x=n[u];let b=i[u];b.shapeFlag&1&&!b.dynamicChildren&&((b.patchFlag<=0||b.patchFlag===32)&&(b=i[u]=Zt(i[u]),b.el=x.el),r||vl(x,b)),b.type===Oi&&(b.el=x.el)}}function th(e){const t=e.slice(),r=[0];let n,i,u,x,b;const s=e.length;for(n=0;n<s;n++){const C=e[n];if(C!==0){if(i=r[r.length-1],e[i]<C){t[n]=i,r.push(n);continue}for(u=0,x=r.length-1;u<x;)b=u+x>>1,e[r[b]]<C?u=b+1:x=b;C<e[r[u]]&&(u>0&&(t[n]=r[u-1]),r[u]=n)}}for(u=r.length,x=r[u-1];u-- >0;)r[u]=x,x=t[x];return r}const rh=e=>e.__isTeleport,Gt=Symbol(void 0),Oi=Symbol(void 0),Ar=Symbol(void 0),ri=Symbol(void 0),ln=[];let It=null;function nh(e=!1){ln.push(It=e?null:[])}function ih(){ln.pop(),It=ln[ln.length-1]||null}let Sn=1;function oo(e){Sn+=e}function pl(e){return e.dynamicChildren=Sn>0?It||Nr:null,ih(),Sn>0&&It&&It.push(e),e}function j_(e,t,r,n,i,u){return pl(_l(e,t,r,n,i,u,!0))}function sh(e,t,r,n,i){return pl(lt(e,t,r,n,i,!0))}function Ls(e){return e?e.__v_isVNode===!0:!1}function en(e,t){return e.type===t.type&&e.key===t.key}const Pi="__vInternal",Tl=({key:e})=>e??null,ni=({ref:e,ref_key:t,ref_for:r})=>e!=null?je(e)||Je(e)||Le(e)?{i:Tt,r:e,k:t,f:!!r}:e:null;function _l(e,t=null,r=null,n=0,i=null,u=e===Gt?0:1,x=!1,b=!1){const s={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Tl(t),ref:t&&ni(t),scopeId:tl,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:u,patchFlag:n,dynamicProps:i,dynamicChildren:null,appContext:null,ctx:Tt};return b?(ga(s,r),u&128&&e.normalize(s)):r&&(s.shapeFlag|=je(r)?8:16),Sn>0&&!x&&It&&(s.patchFlag>0||u&6)&&s.patchFlag!==32&&It.push(s),s}const lt=ah;function ah(e,t=null,r=null,n=0,i=null,u=!1){if((!e||e===Ud)&&(e=Ar),Ls(e)){const b=Wr(e,t,!0);return r&&ga(b,r),Sn>0&&!u&&It&&(b.shapeFlag&6?It[It.indexOf(e)]=b:It.push(b)),b.patchFlag|=-2,b}if(ph(e)&&(e=e.__vccOpts),t){t=oh(t);let{class:b,style:s}=t;b&&!je(b)&&(t.class=Js(b)),Ue(s)&&(Wu(s)&&!Ie(s)&&(s=tt({},s)),t.style=qs(s))}const x=je(e)?1:bd(e)?128:rh(e)?64:Ue(e)?4:Le(e)?2:0;return _l(e,t,r,n,i,x,u,!0)}function oh(e){return e?Wu(e)||Pi in e?tt({},e):e:null}function Wr(e,t,r=!1){const{props:n,ref:i,patchFlag:u,children:x}=e,b=t?lh(n||{},t):n;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:b,key:b&&Tl(b),ref:t&&t.ref?r&&i?Ie(i)?i.concat(ni(t)):[i,ni(t)]:ni(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:x,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Gt?u===-1?16:u|16:u,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Wr(e.ssContent),ssFallback:e.ssFallback&&Wr(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx}}function uh(e=" ",t=0){return lt(Oi,null,e,t)}function X_(e,t){const r=lt(ri,null,e);return r.staticCount=t,r}function $_(e="",t=!1){return t?(nh(),sh(Ar,null,e)):lt(Ar,null,e)}function Mt(e){return e==null||typeof e=="boolean"?lt(Ar):Ie(e)?lt(Gt,null,e.slice()):typeof e=="object"?Zt(e):lt(Oi,null,String(e))}function Zt(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Wr(e)}function ga(e,t){let r=0;const{shapeFlag:n}=e;if(t==null)t=null;else if(Ie(t))r=16;else if(typeof t=="object")if(n&65){const i=t.default;i&&(i._c&&(i._d=!1),ga(e,i()),i._c&&(i._d=!0));return}else{r=32;const i=t._;!i&&!(Pi in t)?t._ctx=Tt:i===3&&Tt&&(Tt.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else Le(t)?(t={default:t,_ctx:Tt},r=32):(t=String(t),n&64?(r=16,t=[uh(t)]):r=8);e.children=t,e.shapeFlag|=r}function lh(...e){const t={};for(let r=0;r<e.length;r++){const n=e[r];for(const i in n)if(i==="class")t.class!==n.class&&(t.class=Js([t.class,n.class]));else if(i==="style")t.style=qs([t.style,n.style]);else if(bi(i)){const u=t[i],x=n[i];x&&u!==x&&!(Ie(u)&&u.includes(x))&&(t[i]=u?[].concat(u,x):x)}else i!==""&&(t[i]=n[i])}return t}function Rt(e,t,r,n=null){Lt(e,t,7,[r,n])}const ch=El();let fh=0;function dh(e,t,r){const n=e.type,i=(t?t.appContext:e.appContext)||ch,u={uid:fh++,vnode:e,type:n,parent:t,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new Pf(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:dl(n,i),emitsOptions:el(n,i),emit:null,emitted:null,propsDefaults:ke,inheritAttrs:n.inheritAttrs,ctx:ke,data:ke,props:ke,attrs:ke,slots:ke,refs:ke,setupState:ke,setupContext:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return u.ctx={_:u},u.root=t?t.root:u,u.emit=vd.bind(null,u),e.ce&&e.ce(u),u}let Qe=null;const Gr=e=>{Qe=e,e.scope.on()},_r=()=>{Qe&&Qe.scope.off(),Qe=null};function Al(e){return e.vnode.shapeFlag&4}let In=!1;function hh(e,t=!1){In=t;const{props:r,children:n}=e.vnode,i=Al(e);jd(e,r,i,t),Qd(e,n);const u=i?gh(e,t):void 0;return In=!1,u}function gh(e,t){const r=e.type;e.accessCache=Object.create(null),e.proxy=Gu(new Proxy(e.ctx,Hd));const{setup:n}=r;if(n){const i=e.setupContext=n.length>1?Eh(e):null;Gr(e),Qr();const u=rr(n,e,0,[e.props,i]);if(zr(),_r(),Cu(u)){if(u.then(_r,_r),t)return u.then(x=>{uo(e,x,t)}).catch(x=>{Ci(x,e,0)});e.asyncDep=u}else uo(e,u,t)}else yl(e,t)}function uo(e,t,r){Le(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:Ue(t)&&(e.setupState=Xu(t)),yl(e,r)}let lo;function yl(e,t,r){const n=e.type;if(!e.render){if(!t&&lo&&!n.render){const i=n.template||da(e).template;if(i){const{isCustomElement:u,compilerOptions:x}=e.appContext.config,{delimiters:b,compilerOptions:s}=n,C=tt(tt({isCustomElement:u,delimiters:b},x),s);n.render=lo(i,C)}}e.render=n.render||xt}Gr(e),Qr(),Kd(e),zr(),_r()}function mh(e){return new Proxy(e.attrs,{get(t,r){return dt(e,"get","$attrs"),t[r]}})}function Eh(e){const t=n=>{e.exposed=n||{}};let r;return{get attrs(){return r||(r=mh(e))},slots:e.slots,emit:e.emit,expose:t}}function Mi(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Xu(Gu(e.exposed)),{get(t,r){if(r in t)return t[r];if(r in un)return un[r](e)},has(t,r){return r in t||r in un}}))}function vh(e,t=!0){return Le(e)?e.displayName||e.name:e.name||t&&e.__name}function ph(e){return Le(e)&&"__vccOpts"in e}const pt=(e,t)=>fd(e,t,In);function bl(e,t,r){const n=arguments.length;return n===2?Ue(t)&&!Ie(t)?Ls(t)?lt(e,null,[t]):lt(e,t):lt(e,null,t):(n>3?r=Array.prototype.slice.call(arguments,2):n===3&&Ls(r)&&(r=[r]),lt(e,t,r))}const Th=Symbol(""),_h=()=>Yt(Th),Ah="3.2.45",yh="http://www.w3.org/2000/svg",hr=typeof document<"u"?document:null,co=hr&&hr.createElement("template"),bh={insert:(e,t,r)=>{t.insertBefore(e,r||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,r,n)=>{const i=t?hr.createElementNS(yh,e):hr.createElement(e,r?{is:r}:void 0);return e==="select"&&n&&n.multiple!=null&&i.setAttribute("multiple",n.multiple),i},createText:e=>hr.createTextNode(e),createComment:e=>hr.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>hr.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,r,n,i,u){const x=r?r.previousSibling:t.lastChild;if(i&&(i===u||i.nextSibling))for(;t.insertBefore(i.cloneNode(!0),r),!(i===u||!(i=i.nextSibling)););else{co.innerHTML=n?`<svg>${e}</svg>`:e;const b=co.content;if(n){const s=b.firstChild;for(;s.firstChild;)b.appendChild(s.firstChild);b.removeChild(s)}t.insertBefore(b,r)}return[x?x.nextSibling:t.firstChild,r?r.previousSibling:t.lastChild]}};function Sh(e,t,r){const n=e._vtc;n&&(t=(t?[t,...n]:[...n]).join(" ")),t==null?e.removeAttribute("class"):r?e.setAttribute("class",t):e.className=t}function Ih(e,t,r){const n=e.style,i=je(r);if(r&&!i){for(const u in r)Cs(n,u,r[u]);if(t&&!je(t))for(const u in t)r[u]==null&&Cs(n,u,"")}else{const u=n.display;i?t!==r&&(n.cssText=r):t&&e.removeAttribute("style"),"_vod"in e&&(n.display=u)}}const fo=/\s*!important$/;function Cs(e,t,r){if(Ie(r))r.forEach(n=>Cs(e,t,n));else if(r==null&&(r=""),t.startsWith("--"))e.setProperty(t,r);else{const n=xh(e,t);fo.test(r)?e.setProperty($r(n),r.replace(fo,""),"important"):e[n]=r}}const ho=["Webkit","Moz","ms"],es={};function xh(e,t){const r=es[t];if(r)return r;let n=Ut(t);if(n!=="filter"&&n in e)return es[t]=n;n=xi(n);for(let i=0;i<ho.length;i++){const u=ho[i]+n;if(u in e)return es[t]=u}return t}const go="http://www.w3.org/1999/xlink";function Lh(e,t,r,n,i){if(n&&t.startsWith("xlink:"))r==null?e.removeAttributeNS(go,t.slice(6,t.length)):e.setAttributeNS(go,t,r);else{const u=Sf(t);r==null||u&&!Iu(r)?e.removeAttribute(t):e.setAttribute(t,u?"":r)}}function Ch(e,t,r,n,i,u,x){if(t==="innerHTML"||t==="textContent"){n&&x(n,i,u),e[t]=r??"";return}if(t==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=r;const s=r??"";(e.value!==s||e.tagName==="OPTION")&&(e.value=s),r==null&&e.removeAttribute(t);return}let b=!1;if(r===""||r==null){const s=typeof e[t];s==="boolean"?r=Iu(r):r==null&&s==="string"?(r="",b=!0):s==="number"&&(r=0,b=!0)}try{e[t]=r}catch{}b&&e.removeAttribute(t)}function Or(e,t,r,n){e.addEventListener(t,r,n)}function Dh(e,t,r,n){e.removeEventListener(t,r,n)}function Rh(e,t,r,n,i=null){const u=e._vei||(e._vei={}),x=u[t];if(n&&x)x.value=n;else{const[b,s]=Oh(t);if(n){const C=u[t]=Nh(n,i);Or(e,b,C,s)}else x&&(Dh(e,b,x,s),u[t]=void 0)}}const mo=/(?:Once|Passive|Capture)$/;function Oh(e){let t;if(mo.test(e)){t={};let n;for(;n=e.match(mo);)e=e.slice(0,e.length-n[0].length),t[n[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):$r(e.slice(2)),t]}let ts=0;const Ph=Promise.resolve(),Mh=()=>ts||(Ph.then(()=>ts=0),ts=Date.now());function Nh(e,t){const r=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=r.attached)return;Lt(Fh(n,r.value),t,5,[n])};return r.value=e,r.attached=Mh(),r}function Fh(e,t){if(Ie(t)){const r=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{r.call(e),e._stopped=!0},t.map(n=>i=>!i._stopped&&n&&n(i))}else return t}const Eo=/^on[a-z]/,kh=(e,t,r,n,i=!1,u,x,b,s)=>{t==="class"?Sh(e,n,i):t==="style"?Ih(e,r,n):bi(t)?Zs(t)||Rh(e,t,r,n,x):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Bh(e,t,n,i))?Ch(e,t,n,u,x,b,s):(t==="true-value"?e._trueValue=n:t==="false-value"&&(e._falseValue=n),Lh(e,t,n,i))};function Bh(e,t,r,n){return n?!!(t==="innerHTML"||t==="textContent"||t in e&&Eo.test(t)&&Le(r)):t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||Eo.test(t)&&je(r)?!1:t in e}const vo=e=>{const t=e.props["onUpdate:modelValue"]||!1;return Ie(t)?r=>Jn(t,r):t};function wh(e){e.target.composing=!0}function po(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Q_={created(e,{modifiers:{lazy:t,trim:r,number:n}},i){e._assign=vo(i);const u=n||i.props&&i.props.type==="number";Or(e,t?"change":"input",x=>{if(x.target.composing)return;let b=e.value;r&&(b=b.trim()),u&&(b=oi(b)),e._assign(b)}),r&&Or(e,"change",()=>{e.value=e.value.trim()}),t||(Or(e,"compositionstart",wh),Or(e,"compositionend",po),Or(e,"change",po))},mounted(e,{value:t}){e.value=t??""},beforeUpdate(e,{value:t,modifiers:{lazy:r,trim:n,number:i}},u){if(e._assign=vo(u),e.composing||document.activeElement===e&&e.type!=="range"&&(r||n&&e.value.trim()===t||(i||e.type==="number")&&oi(e.value)===t))return;const x=t??"";e.value!==x&&(e.value=x)}},Uh=tt({patchProp:kh},bh);let To;function Hh(){return To||(To=Zd(Uh))}const z_=(...e)=>{const t=Hh().createApp(...e),{mount:r}=t;return t.mount=n=>{const i=Kh(n);if(!i)return;const u=t._component;!Le(u)&&!u.render&&!u.template&&(u.template=i.innerHTML),i.innerHTML="";const x=r(i,!1,i instanceof SVGElement);return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),x},t};function Kh(e){return je(e)?document.querySelector(e):e}var Pt=(e=>(e.LOADING="loading",e.LOADED="loaded",e.ERROR="error",e))(Pt||{});const Wh=typeof window<"u"&&window!==null,Gh=Xh(),Yh=Object.prototype.propertyIsEnumerable,_o=Object.getOwnPropertySymbols;function cn(e){return typeof e=="function"||toString.call(e)==="[object Object]"}function Vh(e){return typeof e=="object"?e===null:typeof e!="function"}function jh(e){return e!=="__proto__"&&e!=="constructor"&&e!=="prototype"}function Xh(){return Wh&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0}}),!0):!1}function $h(e,...t){if(!cn(e))throw new TypeError("expected the first argument to be an object");if(t.length===0||typeof Symbol!="function"||typeof _o!="function")return e;for(const r of t){const n=_o(r);for(const i of n)Yh.call(r,i)&&(e[i]=r[i])}return e}function Sl(e,...t){let r=0;for(Vh(e)&&(e=t[r++]),e||(e={});r<t.length;r++)if(cn(t[r])){for(const n of Object.keys(t[r]))jh(n)&&(cn(e[n])&&cn(t[r][n])?Sl(e[n],t[r][n]):e[n]=t[r][n]);$h(e,t[r])}return e}const Ao="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Qh="",zh={rootMargin:"0px",threshold:0},Cr="data-lazy-timeout-id";class qh{constructor(t){this.options={loading:Ao,error:Qh,observerOptions:zh,log:!0,lifecycle:{}},this._images=new WeakMap,this.config(t)}config(t={}){Sl(this.options,t)}mount(t,r){if(!t)return;const{src:n,loading:i,error:u,lifecycle:x,delay:b}=this._valueFormatter(typeof r=="string"?r:r.value);this._lifecycle(Pt.LOADING,x,t),t.setAttribute("src",i||Ao),Gh||(this.loadImages(t,n,u,x),this._log(()=>{throw new Error("Not support IntersectionObserver!")})),this._initIntersectionObserver(t,n,u,x,b)}update(t,r){var b;if(!t)return;(b=this._realObserver(t))==null||b.unobserve(t);const{src:n,error:i,lifecycle:u,delay:x}=this._valueFormatter(typeof r=="string"?r:r.value);this._initIntersectionObserver(t,n,i,u,x)}unmount(t){var r;t&&((r=this._realObserver(t))==null||r.unobserve(t),this._images.delete(t))}loadImages(t,r,n,i){this._setImageSrc(t,r,n,i)}_setImageSrc(t,r,n,i){t.tagName.toLowerCase()==="img"?(r&&t.getAttribute("src")!==r&&t.setAttribute("src",r),this._listenImageStatus(t,()=>{this._lifecycle(Pt.LOADED,i,t)},()=>{var u;t.onload=null,this._lifecycle(Pt.ERROR,i,t),(u=this._realObserver(t))==null||u.disconnect(),n&&t.getAttribute("src")!==n&&t.setAttribute("src",n),this._log(()=>{throw new Error(`Image failed to load!And failed src was: ${r} `)})})):t.style.backgroundImage=`url('${r}')`}_initIntersectionObserver(t,r,n,i,u){var b;const x=this.options.observerOptions;this._images.set(t,new IntersectionObserver(s=>{Array.prototype.forEach.call(s,C=>{u&&u>0?this._delayedIntersectionCallback(t,C,u,r,n,i):this._intersectionCallback(t,C,r,n,i)})},x)),(b=this._realObserver(t))==null||b.observe(t)}_intersectionCallback(t,r,n,i,u){var x;r.isIntersecting&&((x=this._realObserver(t))==null||x.unobserve(r.target),this._setImageSrc(t,n,i,u))}_delayedIntersectionCallback(t,r,n,i,u,x){if(r.isIntersecting){if(r.target.hasAttribute(Cr))return;const b=setTimeout(()=>{this._intersectionCallback(t,r,i,u,x),r.target.removeAttribute(Cr)},n);r.target.setAttribute(Cr,String(b))}else r.target.hasAttribute(Cr)&&(clearTimeout(Number(r.target.getAttribute(Cr))),r.target.removeAttribute(Cr))}_listenImageStatus(t,r,n){t.onload=r,t.onerror=n}_valueFormatter(t){let r=t,n=this.options.loading,i=this.options.error,u=this.options.lifecycle,x=this.options.delay;return cn(t)&&(r=t.src,n=t.loading||this.options.loading,i=t.error||this.options.error,u=t.lifecycle||this.options.lifecycle,x=t.delay||this.options.delay),{src:r,loading:n,error:i,lifecycle:u,delay:x}}_log(t){this.options.log&&t()}_lifecycle(t,r,n){switch(t){case Pt.LOADING:n==null||n.setAttribute("lazy",Pt.LOADING),r!=null&&r.loading&&r.loading(n);break;case Pt.LOADED:n==null||n.setAttribute("lazy",Pt.LOADED),r!=null&&r.loaded&&r.loaded(n);break;case Pt.ERROR:n==null||n.setAttribute("lazy",Pt.ERROR),r!=null&&r.error&&r.error(n);break}}_realObserver(t){return this._images.get(t)}}const q_={install(e,t){const r=new qh(t);e.config.globalProperties.$Lazyload=r,e.provide("Lazyload",r),e.directive("lazy",{mounted:r.mount.bind(r),updated:r.update.bind(r),unmounted:r.unmount.bind(r)})}};/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const Pr=typeof window<"u";function Jh(e){return e.__esModule||e[Symbol.toStringTag]==="Module"}const Ne=Object.assign;function rs(e,t){const r={};for(const n in t){const i=t[n];r[n]=Ct(i)?i.map(e):e(i)}return r}const fn=()=>{},Ct=Array.isArray,Zh=/\/$/,e0=e=>e.replace(Zh,"");function ns(e,t,r="/"){let n,i={},u="",x="";const b=t.indexOf("#");let s=t.indexOf("?");return b<s&&b>=0&&(s=-1),s>-1&&(n=t.slice(0,s),u=t.slice(s+1,b>-1?b:t.length),i=e(u)),b>-1&&(n=n||t.slice(0,b),x=t.slice(b,t.length)),n=i0(n??t,r),{fullPath:n+(u&&"?")+u+x,path:n,query:i,hash:x}}function t0(e,t){const r=t.query?e(t.query):"";return t.path+(r&&"?")+r+(t.hash||"")}function yo(e,t){return!t||!e.toLowerCase().startsWith(t.toLowerCase())?e:e.slice(t.length)||"/"}function r0(e,t,r){const n=t.matched.length-1,i=r.matched.length-1;return n>-1&&n===i&&Yr(t.matched[n],r.matched[i])&&Il(t.params,r.params)&&e(t.query)===e(r.query)&&t.hash===r.hash}function Yr(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function Il(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!n0(e[r],t[r]))return!1;return!0}function n0(e,t){return Ct(e)?bo(e,t):Ct(t)?bo(t,e):e===t}function bo(e,t){return Ct(t)?e.length===t.length&&e.every((r,n)=>r===t[n]):e.length===1&&e[0]===t}function i0(e,t){if(e.startsWith("/"))return e;if(!e)return t;const r=t.split("/"),n=e.split("/");let i=r.length-1,u,x;for(u=0;u<n.length;u++)if(x=n[u],x!==".")if(x==="..")i>1&&i--;else break;return r.slice(0,i).join("/")+"/"+n.slice(u-(u===n.length?1:0)).join("/")}var xn;(function(e){e.pop="pop",e.push="push"})(xn||(xn={}));var dn;(function(e){e.back="back",e.forward="forward",e.unknown=""})(dn||(dn={}));function s0(e){if(!e)if(Pr){const t=document.querySelector("base");e=t&&t.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),e0(e)}const a0=/^[^#]+#/;function o0(e,t){return e.replace(a0,"#")+t}function u0(e,t){const r=document.documentElement.getBoundingClientRect(),n=e.getBoundingClientRect();return{behavior:t.behavior,left:n.left-r.left-(t.left||0),top:n.top-r.top-(t.top||0)}}const Ni=()=>({left:window.pageXOffset,top:window.pageYOffset});function l0(e){let t;if("el"in e){const r=e.el,n=typeof r=="string"&&r.startsWith("#"),i=typeof r=="string"?n?document.getElementById(r.slice(1)):document.querySelector(r):r;if(!i)return;t=u0(i,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(t.left!=null?t.left:window.pageXOffset,t.top!=null?t.top:window.pageYOffset)}function So(e,t){return(history.state?history.state.position-t:-1)+e}const Ds=new Map;function c0(e,t){Ds.set(e,t)}function f0(e){const t=Ds.get(e);return Ds.delete(e),t}let d0=()=>location.protocol+"//"+location.host;function xl(e,t){const{pathname:r,search:n,hash:i}=t,u=e.indexOf("#");if(u>-1){let b=i.includes(e.slice(u))?e.slice(u).length:1,s=i.slice(b);return s[0]!=="/"&&(s="/"+s),yo(s,"")}return yo(r,e)+n+i}function h0(e,t,r,n){let i=[],u=[],x=null;const b=({state:R})=>{const K=xl(e,location),k=r.value,F=t.value;let B=0;if(R){if(r.value=K,t.value=R,x&&x===k){x=null;return}B=F?R.position-F.position:0}else n(K);i.forEach(P=>{P(r.value,k,{delta:B,type:xn.pop,direction:B?B>0?dn.forward:dn.back:dn.unknown})})};function s(){x=r.value}function C(R){i.push(R);const K=()=>{const k=i.indexOf(R);k>-1&&i.splice(k,1)};return u.push(K),K}function g(){const{history:R}=window;R.state&&R.replaceState(Ne({},R.state,{scroll:Ni()}),"")}function w(){for(const R of u)R();u=[],window.removeEventListener("popstate",b),window.removeEventListener("beforeunload",g)}return window.addEventListener("popstate",b),window.addEventListener("beforeunload",g),{pauseListeners:s,listen:C,destroy:w}}function Io(e,t,r,n=!1,i=!1){return{back:e,current:t,forward:r,replaced:n,position:window.history.length,scroll:i?Ni():null}}function g0(e){const{history:t,location:r}=window,n={value:xl(e,r)},i={value:t.state};i.value||u(n.value,{back:null,current:n.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0);function u(s,C,g){const w=e.indexOf("#"),R=w>-1?(r.host&&document.querySelector("base")?e:e.slice(w))+s:d0()+e+s;try{t[g?"replaceState":"pushState"](C,"",R),i.value=C}catch(K){console.error(K),r[g?"replace":"assign"](R)}}function x(s,C){const g=Ne({},t.state,Io(i.value.back,s,i.value.forward,!0),C,{position:i.value.position});u(s,g,!0),n.value=s}function b(s,C){const g=Ne({},i.value,t.state,{forward:s,scroll:Ni()});u(g.current,g,!0);const w=Ne({},Io(n.value,s,null),{position:g.position+1},C);u(s,w,!1),n.value=s}return{location:n,state:i,push:b,replace:x}}function J_(e){e=s0(e);const t=g0(e),r=h0(e,t.state,t.location,t.replace);function n(u,x=!0){x||r.pauseListeners(),history.go(u)}const i=Ne({location:"",base:e,go:n,createHref:o0.bind(null,e)},t,r);return Object.defineProperty(i,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(i,"state",{enumerable:!0,get:()=>t.state.value}),i}function m0(e){return typeof e=="string"||e&&typeof e=="object"}function Ll(e){return typeof e=="string"||typeof e=="symbol"}const zt={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},Cl=Symbol("");var xo;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(xo||(xo={}));function Vr(e,t){return Ne(new Error,{type:e,[Cl]:!0},t)}function Ht(e,t){return e instanceof Error&&Cl in e&&(t==null||!!(e.type&t))}const Lo="[^/]+?",E0={sensitive:!1,strict:!1,start:!0,end:!0},v0=/[.+*?^${}()[\]/\\]/g;function p0(e,t){const r=Ne({},E0,t),n=[];let i=r.start?"^":"";const u=[];for(const C of e){const g=C.length?[]:[90];r.strict&&!C.length&&(i+="/");for(let w=0;w<C.length;w++){const R=C[w];let K=40+(r.sensitive?.25:0);if(R.type===0)w||(i+="/"),i+=R.value.replace(v0,"\\$&"),K+=40;else if(R.type===1){const{value:k,repeatable:F,optional:B,regexp:P}=R;u.push({name:k,repeatable:F,optional:B});const M=P||Lo;if(M!==Lo){K+=10;try{new RegExp(`(${M})`)}catch(N){throw new Error(`Invalid custom RegExp for param "${k}" (${M}): `+N.message)}}let m=F?`((?:${M})(?:/(?:${M}))*)`:`(${M})`;w||(m=B&&C.length<2?`(?:/${m})`:"/"+m),B&&(m+="?"),i+=m,K+=20,B&&(K+=-8),F&&(K+=-20),M===".*"&&(K+=-50)}g.push(K)}n.push(g)}if(r.strict&&r.end){const C=n.length-1;n[C][n[C].length-1]+=.7000000000000001}r.strict||(i+="/?"),r.end?i+="$":r.strict&&(i+="(?:/|$)");const x=new RegExp(i,r.sensitive?"":"i");function b(C){const g=C.match(x),w={};if(!g)return null;for(let R=1;R<g.length;R++){const K=g[R]||"",k=u[R-1];w[k.name]=K&&k.repeatable?K.split("/"):K}return w}function s(C){let g="",w=!1;for(const R of e){(!w||!g.endsWith("/"))&&(g+="/"),w=!1;for(const K of R)if(K.type===0)g+=K.value;else if(K.type===1){const{value:k,repeatable:F,optional:B}=K,P=k in C?C[k]:"";if(Ct(P)&&!F)throw new Error(`Provided param "${k}" is an array but it is not repeatable (* or + modifiers)`);const M=Ct(P)?P.join("/"):P;if(!M)if(B)R.length<2&&(g.endsWith("/")?g=g.slice(0,-1):w=!0);else throw new Error(`Missing required param "${k}"`);g+=M}}return g||"/"}return{re:x,score:n,keys:u,parse:b,stringify:s}}function T0(e,t){let r=0;for(;r<e.length&&r<t.length;){const n=t[r]-e[r];if(n)return n;r++}return e.length<t.length?e.length===1&&e[0]===40+40?-1:1:e.length>t.length?t.length===1&&t[0]===40+40?1:-1:0}function _0(e,t){let r=0;const n=e.score,i=t.score;for(;r<n.length&&r<i.length;){const u=T0(n[r],i[r]);if(u)return u;r++}if(Math.abs(i.length-n.length)===1){if(Co(n))return 1;if(Co(i))return-1}return i.length-n.length}function Co(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const A0={type:0,value:""},y0=/[a-zA-Z0-9_]/;function b0(e){if(!e)return[[]];if(e==="/")return[[A0]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(K){throw new Error(`ERR (${r})/"${C}": ${K}`)}let r=0,n=r;const i=[];let u;function x(){u&&i.push(u),u=[]}let b=0,s,C="",g="";function w(){C&&(r===0?u.push({type:0,value:C}):r===1||r===2||r===3?(u.length>1&&(s==="*"||s==="+")&&t(`A repeatable param (${C}) must be alone in its segment. eg: '/:ids+.`),u.push({type:1,value:C,regexp:g,repeatable:s==="*"||s==="+",optional:s==="*"||s==="?"})):t("Invalid state to consume buffer"),C="")}function R(){C+=s}for(;b<e.length;){if(s=e[b++],s==="\\"&&r!==2){n=r,r=4;continue}switch(r){case 0:s==="/"?(C&&w(),x()):s===":"?(w(),r=1):R();break;case 4:R(),r=n;break;case 1:s==="("?r=2:y0.test(s)?R():(w(),r=0,s!=="*"&&s!=="?"&&s!=="+"&&b--);break;case 2:s===")"?g[g.length-1]=="\\"?g=g.slice(0,-1)+s:r=3:g+=s;break;case 3:w(),r=0,s!=="*"&&s!=="?"&&s!=="+"&&b--,g="";break;default:t("Unknown state");break}}return r===2&&t(`Unfinished custom RegExp for param "${C}"`),w(),x(),i}function S0(e,t,r){const n=p0(b0(e.path),r),i=Ne(n,{record:e,parent:t,children:[],alias:[]});return t&&!i.record.aliasOf==!t.record.aliasOf&&t.children.push(i),i}function I0(e,t){const r=[],n=new Map;t=Oo({strict:!1,end:!0,sensitive:!1},t);function i(g){return n.get(g)}function u(g,w,R){const K=!R,k=x0(g);k.aliasOf=R&&R.record;const F=Oo(t,g),B=[k];if("alias"in g){const m=typeof g.alias=="string"?[g.alias]:g.alias;for(const N of m)B.push(Ne({},k,{components:R?R.record.components:k.components,path:N,aliasOf:R?R.record:k}))}let P,M;for(const m of B){const{path:N}=m;if(w&&N[0]!=="/"){const I=w.record.path,h=I[I.length-1]==="/"?"":"/";m.path=w.record.path+(N&&h+N)}if(P=S0(m,w,F),R?R.alias.push(P):(M=M||P,M!==P&&M.alias.push(P),K&&g.name&&!Ro(P)&&x(g.name)),k.children){const I=k.children;for(let h=0;h<I.length;h++)u(I[h],P,R&&R.children[h])}R=R||P,(P.record.components&&Object.keys(P.record.components).length||P.record.name||P.record.redirect)&&s(P)}return M?()=>{x(M)}:fn}function x(g){if(Ll(g)){const w=n.get(g);w&&(n.delete(g),r.splice(r.indexOf(w),1),w.children.forEach(x),w.alias.forEach(x))}else{const w=r.indexOf(g);w>-1&&(r.splice(w,1),g.record.name&&n.delete(g.record.name),g.children.forEach(x),g.alias.forEach(x))}}function b(){return r}function s(g){let w=0;for(;w<r.length&&_0(g,r[w])>=0&&(g.record.path!==r[w].record.path||!Dl(g,r[w]));)w++;r.splice(w,0,g),g.record.name&&!Ro(g)&&n.set(g.record.name,g)}function C(g,w){let R,K={},k,F;if("name"in g&&g.name){if(R=n.get(g.name),!R)throw Vr(1,{location:g});F=R.record.name,K=Ne(Do(w.params,R.keys.filter(M=>!M.optional).map(M=>M.name)),g.params&&Do(g.params,R.keys.map(M=>M.name))),k=R.stringify(K)}else if("path"in g)k=g.path,R=r.find(M=>M.re.test(k)),R&&(K=R.parse(k),F=R.record.name);else{if(R=w.name?n.get(w.name):r.find(M=>M.re.test(w.path)),!R)throw Vr(1,{location:g,currentLocation:w});F=R.record.name,K=Ne({},w.params,g.params),k=R.stringify(K)}const B=[];let P=R;for(;P;)B.unshift(P.record),P=P.parent;return{name:F,path:k,params:K,matched:B,meta:C0(B)}}return e.forEach(g=>u(g)),{addRoute:u,resolve:C,removeRoute:x,getRoutes:b,getRecordMatcher:i}}function Do(e,t){const r={};for(const n of t)n in e&&(r[n]=e[n]);return r}function x0(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:L0(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}}}function L0(e){const t={},r=e.props||!1;if("component"in e)t.default=r;else for(const n in e.components)t[n]=typeof r=="boolean"?r:r[n];return t}function Ro(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function C0(e){return e.reduce((t,r)=>Ne(t,r.meta),{})}function Oo(e,t){const r={};for(const n in e)r[n]=n in t?t[n]:e[n];return r}function Dl(e,t){return t.children.some(r=>r===e||Dl(e,r))}const Rl=/#/g,D0=/&/g,R0=/\//g,O0=/=/g,P0=/\?/g,Ol=/\+/g,M0=/%5B/g,N0=/%5D/g,Pl=/%5E/g,F0=/%60/g,Ml=/%7B/g,k0=/%7C/g,Nl=/%7D/g,B0=/%20/g;function ma(e){return encodeURI(""+e).replace(k0,"|").replace(M0,"[").replace(N0,"]")}function w0(e){return ma(e).replace(Ml,"{").replace(Nl,"}").replace(Pl,"^")}function Rs(e){return ma(e).replace(Ol,"%2B").replace(B0,"+").replace(Rl,"%23").replace(D0,"%26").replace(F0,"`").replace(Ml,"{").replace(Nl,"}").replace(Pl,"^")}function U0(e){return Rs(e).replace(O0,"%3D")}function H0(e){return ma(e).replace(Rl,"%23").replace(P0,"%3F")}function K0(e){return e==null?"":H0(e).replace(R0,"%2F")}function fi(e){try{return decodeURIComponent(""+e)}catch{}return""+e}function W0(e){const t={};if(e===""||e==="?")return t;const n=(e[0]==="?"?e.slice(1):e).split("&");for(let i=0;i<n.length;++i){const u=n[i].replace(Ol," "),x=u.indexOf("="),b=fi(x<0?u:u.slice(0,x)),s=x<0?null:fi(u.slice(x+1));if(b in t){let C=t[b];Ct(C)||(C=t[b]=[C]),C.push(s)}else t[b]=s}return t}function Po(e){let t="";for(let r in e){const n=e[r];if(r=U0(r),n==null){n!==void 0&&(t+=(t.length?"&":"")+r);continue}(Ct(n)?n.map(u=>u&&Rs(u)):[n&&Rs(n)]).forEach(u=>{u!==void 0&&(t+=(t.length?"&":"")+r,u!=null&&(t+="="+u))})}return t}function G0(e){const t={};for(const r in e){const n=e[r];n!==void 0&&(t[r]=Ct(n)?n.map(i=>i==null?null:""+i):n==null?n:""+n)}return t}const Y0=Symbol(""),Mo=Symbol(""),Ea=Symbol(""),Fl=Symbol(""),Os=Symbol("");function tn(){let e=[];function t(n){return e.push(n),()=>{const i=e.indexOf(n);i>-1&&e.splice(i,1)}}function r(){e=[]}return{add:t,list:()=>e,reset:r}}function er(e,t,r,n,i){const u=n&&(n.enterCallbacks[i]=n.enterCallbacks[i]||[]);return()=>new Promise((x,b)=>{const s=w=>{w===!1?b(Vr(4,{from:r,to:t})):w instanceof Error?b(w):m0(w)?b(Vr(2,{from:t,to:w})):(u&&n.enterCallbacks[i]===u&&typeof w=="function"&&u.push(w),x())},C=e.call(n&&n.instances[i],t,r,s);let g=Promise.resolve(C);e.length<3&&(g=g.then(s)),g.catch(w=>b(w))})}function is(e,t,r,n){const i=[];for(const u of e)for(const x in u.components){let b=u.components[x];if(!(t!=="beforeRouteEnter"&&!u.instances[x]))if(V0(b)){const C=(b.__vccOpts||b)[t];C&&i.push(er(C,r,n,u,x))}else{let s=b();i.push(()=>s.then(C=>{if(!C)return Promise.reject(new Error(`Couldn't resolve component "${x}" at "${u.path}"`));const g=Jh(C)?C.default:C;u.components[x]=g;const R=(g.__vccOpts||g)[t];return R&&er(R,r,n,u,x)()}))}}return i}function V0(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function No(e){const t=Yt(Ea),r=Yt(Fl),n=pt(()=>t.resolve(Br(e.to))),i=pt(()=>{const{matched:s}=n.value,{length:C}=s,g=s[C-1],w=r.matched;if(!g||!w.length)return-1;const R=w.findIndex(Yr.bind(null,g));if(R>-1)return R;const K=Fo(s[C-2]);return C>1&&Fo(g)===K&&w[w.length-1].path!==K?w.findIndex(Yr.bind(null,s[C-2])):R}),u=pt(()=>i.value>-1&&Q0(r.params,n.value.params)),x=pt(()=>i.value>-1&&i.value===r.matched.length-1&&Il(r.params,n.value.params));function b(s={}){return $0(s)?t[Br(e.replace)?"replace":"push"](Br(e.to)).catch(fn):Promise.resolve()}return{route:n,href:pt(()=>n.value.href),isActive:u,isExactActive:x,navigate:b}}const j0=il({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:No,setup(e,{slots:t}){const r=On(No(e)),{options:n}=Yt(Ea),i=pt(()=>({[ko(e.activeClass,n.linkActiveClass,"router-link-active")]:r.isActive,[ko(e.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:r.isExactActive}));return()=>{const u=t.default&&t.default(r);return e.custom?u:bl("a",{"aria-current":r.isExactActive?e.ariaCurrentValue:null,href:r.href,onClick:r.navigate,class:i.value},u)}}}),X0=j0;function $0(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function Q0(e,t){for(const r in t){const n=t[r],i=e[r];if(typeof n=="string"){if(n!==i)return!1}else if(!Ct(i)||i.length!==n.length||n.some((u,x)=>u!==i[x]))return!1}return!0}function Fo(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const ko=(e,t,r)=>e??t??r,z0=il({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:r}){const n=Yt(Os),i=pt(()=>e.route||n.value),u=Yt(Mo,0),x=pt(()=>{let C=Br(u);const{matched:g}=i.value;let w;for(;(w=g[C])&&!w.components;)C++;return C}),b=pt(()=>i.value.matched[x.value]);Zn(Mo,pt(()=>x.value+1)),Zn(Y0,b),Zn(Os,i);const s=ad();return ei(()=>[s.value,b.value,e.name],([C,g,w],[R,K,k])=>{g&&(g.instances[w]=C,K&&K!==g&&C&&C===R&&(g.leaveGuards.size||(g.leaveGuards=K.leaveGuards),g.updateGuards.size||(g.updateGuards=K.updateGuards))),C&&g&&(!K||!Yr(g,K)||!R)&&(g.enterCallbacks[w]||[]).forEach(F=>F(C))},{flush:"post"}),()=>{const C=i.value,g=e.name,w=b.value,R=w&&w.components[g];if(!R)return Bo(r.default,{Component:R,route:C});const K=w.props[g],k=K?K===!0?C.params:typeof K=="function"?K(C):K:null,B=bl(R,Ne({},k,t,{onVnodeUnmounted:P=>{P.component.isUnmounted&&(w.instances[g]=null)},ref:s}));return Bo(r.default,{Component:B,route:C})||B}}});function Bo(e,t){if(!e)return null;const r=e(t);return r.length===1?r[0]:r}const q0=z0;function Z_(e){const t=I0(e.routes,e),r=e.parseQuery||W0,n=e.stringifyQuery||Po,i=e.history,u=tn(),x=tn(),b=tn(),s=od(zt);let C=zt;Pr&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const g=rs.bind(null,U=>""+U),w=rs.bind(null,K0),R=rs.bind(null,fi);function K(U,G){let Y,j;return Ll(U)?(Y=t.getRecordMatcher(U),j=G):j=U,t.addRoute(j,Y)}function k(U){const G=t.getRecordMatcher(U);G&&t.removeRoute(G)}function F(){return t.getRoutes().map(U=>U.record)}function B(U){return!!t.getRecordMatcher(U)}function P(U,G){if(G=Ne({},G||s.value),typeof U=="string"){const V=ns(r,U,G.path),$=t.resolve({path:V.path},G),ee=i.createHref(V.fullPath);return Ne(V,$,{params:R($.params),hash:fi(V.hash),redirectedFrom:void 0,href:ee})}let Y;if("path"in U)Y=Ne({},U,{path:ns(r,U.path,G.path).path});else{const V=Ne({},U.params);for(const $ in V)V[$]==null&&delete V[$];Y=Ne({},U,{params:w(U.params)}),G.params=w(G.params)}const j=t.resolve(Y,G),X=U.hash||"";j.params=g(R(j.params));const q=t0(n,Ne({},U,{hash:w0(X),path:j.path})),J=i.createHref(q);return Ne({fullPath:q,hash:X,query:n===Po?G0(U.query):U.query||{}},j,{redirectedFrom:void 0,href:J})}function M(U){return typeof U=="string"?ns(r,U,s.value.path):Ne({},U)}function m(U,G){if(C!==U)return Vr(8,{from:G,to:U})}function N(U){return E(U)}function I(U){return N(Ne(M(U),{replace:!0}))}function h(U){const G=U.matched[U.matched.length-1];if(G&&G.redirect){const{redirect:Y}=G;let j=typeof Y=="function"?Y(U):Y;return typeof j=="string"&&(j=j.includes("?")||j.includes("#")?j=M(j):{path:j},j.params={}),Ne({query:U.query,hash:U.hash,params:"path"in j?{}:U.params},j)}}function E(U,G){const Y=C=P(U),j=s.value,X=U.state,q=U.force,J=U.replace===!0,V=h(Y);if(V)return E(Ne(M(V),{state:typeof V=="object"?Ne({},X,V.state):X,force:q,replace:J}),G||Y);const $=Y;$.redirectedFrom=G;let ee;return!q&&r0(n,j,Y)&&(ee=Vr(16,{to:$,from:j}),A(j,j,!0,!1)),(ee?Promise.resolve(ee):c($,j)).catch(Z=>Ht(Z)?Ht(Z,2)?Z:o(Z):a(Z,$,j)).then(Z=>{if(Z){if(Ht(Z,2))return E(Ne({replace:J},M(Z.to),{state:typeof Z.to=="object"?Ne({},X,Z.to.state):X,force:q}),G||$)}else Z=v($,j,!0,J,X);return S($,j,Z),Z})}function d(U,G){const Y=m(U,G);return Y?Promise.reject(Y):Promise.resolve()}function c(U,G){let Y;const[j,X,q]=J0(U,G);Y=is(j.reverse(),"beforeRouteLeave",U,G);for(const V of j)V.leaveGuards.forEach($=>{Y.push(er($,U,G))});const J=d.bind(null,U,G);return Y.push(J),Dr(Y).then(()=>{Y=[];for(const V of u.list())Y.push(er(V,U,G));return Y.push(J),Dr(Y)}).then(()=>{Y=is(X,"beforeRouteUpdate",U,G);for(const V of X)V.updateGuards.forEach($=>{Y.push(er($,U,G))});return Y.push(J),Dr(Y)}).then(()=>{Y=[];for(const V of U.matched)if(V.beforeEnter&&!G.matched.includes(V))if(Ct(V.beforeEnter))for(const $ of V.beforeEnter)Y.push(er($,U,G));else Y.push(er(V.beforeEnter,U,G));return Y.push(J),Dr(Y)}).then(()=>(U.matched.forEach(V=>V.enterCallbacks={}),Y=is(q,"beforeRouteEnter",U,G),Y.push(J),Dr(Y))).then(()=>{Y=[];for(const V of x.list())Y.push(er(V,U,G));return Y.push(J),Dr(Y)}).catch(V=>Ht(V,8)?V:Promise.reject(V))}function S(U,G,Y){for(const j of b.list())j(U,G,Y)}function v(U,G,Y,j,X){const q=m(U,G);if(q)return q;const J=G===zt,V=Pr?history.state:{};Y&&(j||J?i.replace(U.fullPath,Ne({scroll:J&&V&&V.scroll},X)):i.push(U.fullPath,X)),s.value=U,A(U,G,Y,J),o()}let l;function p(){l||(l=i.listen((U,G,Y)=>{if(!W.listening)return;const j=P(U),X=h(j);if(X){E(Ne(X,{replace:!0}),j).catch(fn);return}C=j;const q=s.value;Pr&&c0(So(q.fullPath,Y.delta),Ni()),c(j,q).catch(J=>Ht(J,12)?J:Ht(J,2)?(E(J.to,j).then(V=>{Ht(V,20)&&!Y.delta&&Y.type===xn.pop&&i.go(-1,!1)}).catch(fn),Promise.reject()):(Y.delta&&i.go(-Y.delta,!1),a(J,j,q))).then(J=>{J=J||v(j,q,!1),J&&(Y.delta&&!Ht(J,8)?i.go(-Y.delta,!1):Y.type===xn.pop&&Ht(J,20)&&i.go(-1,!1)),S(j,q,J)}).catch(fn)}))}let y=tn(),T=tn(),f;function a(U,G,Y){o(U);const j=T.list();return j.length?j.forEach(X=>X(U,G,Y)):console.error(U),Promise.reject(U)}function _(){return f&&s.value!==zt?Promise.resolve():new Promise((U,G)=>{y.add([U,G])})}function o(U){return f||(f=!U,p(),y.list().forEach(([G,Y])=>U?Y(U):G()),y.reset()),U}function A(U,G,Y,j){const{scrollBehavior:X}=e;if(!Pr||!X)return Promise.resolve();const q=!Y&&f0(So(U.fullPath,0))||(j||!Y)&&history.state&&history.state.scroll||null;return zu().then(()=>X(U,G,q)).then(J=>J&&l0(J)).catch(J=>a(J,U,G))}const O=U=>i.go(U);let L;const H=new Set,W={currentRoute:s,listening:!0,addRoute:K,removeRoute:k,hasRoute:B,getRoutes:F,resolve:P,options:e,push:N,replace:I,go:O,back:()=>O(-1),forward:()=>O(1),beforeEach:u.add,beforeResolve:x.add,afterEach:b.add,onError:T.add,isReady:_,install(U){const G=this;U.component("RouterLink",X0),U.component("RouterView",q0),U.config.globalProperties.$router=G,Object.defineProperty(U.config.globalProperties,"$route",{enumerable:!0,get:()=>Br(s)}),Pr&&!L&&s.value===zt&&(L=!0,N(i.location).catch(X=>{}));const Y={};for(const X in zt)Y[X]=pt(()=>s.value[X]);U.provide(Ea,G),U.provide(Fl,On(Y)),U.provide(Os,s);const j=U.unmount;H.add(U),U.unmount=function(){H.delete(U),H.size<1&&(C=zt,l&&l(),l=null,s.value=zt,L=!1,f=!1),j()}}};return W}function Dr(e){return e.reduce((t,r)=>t.then(()=>r()),Promise.resolve())}function J0(e,t){const r=[],n=[],i=[],u=Math.max(t.matched.length,e.matched.length);for(let x=0;x<u;x++){const b=t.matched[x];b&&(e.matched.find(C=>Yr(C,b))?n.push(b):r.push(b));const s=e.matched[x];s&&(t.matched.find(C=>Yr(C,s))||i.push(s))}return[r,n,i]}function Xt(e){return Array.isArray?Array.isArray(e):wl(e)==="[object Array]"}const Z0=1/0;function eg(e){if(typeof e=="string")return e;let t=e+"";return t=="0"&&1/e==-Z0?"-0":t}function tg(e){return e==null?"":eg(e)}function kt(e){return typeof e=="string"}function kl(e){return typeof e=="number"}function rg(e){return e===!0||e===!1||ng(e)&&wl(e)=="[object Boolean]"}function Bl(e){return typeof e=="object"}function ng(e){return Bl(e)&&e!==null}function ft(e){return e!=null}function ss(e){return!e.trim().length}function wl(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const ig="Incorrect 'index' type",sg=e=>`Invalid value for key ${e}`,ag=e=>`Pattern length exceeds max of ${e}.`,og=e=>`Missing ${e} property in key`,ug=e=>`Property 'weight' in key '${e}' must be a positive integer`,wo=Object.prototype.hasOwnProperty;class lg{constructor(t){this._keys=[],this._keyMap={};let r=0;t.forEach(n=>{let i=Ul(n);r+=i.weight,this._keys.push(i),this._keyMap[i.id]=i,r+=i.weight}),this._keys.forEach(n=>{n.weight/=r})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Ul(e){let t=null,r=null,n=null,i=1,u=null;if(kt(e)||Xt(e))n=e,t=Uo(e),r=Ps(e);else{if(!wo.call(e,"name"))throw new Error(og("name"));const x=e.name;if(n=x,wo.call(e,"weight")&&(i=e.weight,i<=0))throw new Error(ug(x));t=Uo(x),r=Ps(x),u=e.getFn}return{path:t,id:r,weight:i,src:n,getFn:u}}function Uo(e){return Xt(e)?e:e.split(".")}function Ps(e){return Xt(e)?e.join("."):e}function cg(e,t){let r=[],n=!1;const i=(u,x,b)=>{if(ft(u))if(!x[b])r.push(u);else{let s=x[b];const C=u[s];if(!ft(C))return;if(b===x.length-1&&(kt(C)||kl(C)||rg(C)))r.push(tg(C));else if(Xt(C)){n=!0;for(let g=0,w=C.length;g<w;g+=1)i(C[g],x,b+1)}else x.length&&i(C,x,b+1)}};return i(e,kt(t)?t.split("."):t,0),n?r:r[0]}const fg={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},dg={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1},hg={location:0,threshold:.6,distance:100},gg={useExtendedSearch:!1,getFn:cg,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var Se={...dg,...fg,...hg,...gg};const mg=/[^ ]+/g;function Eg(e=1,t=3){const r=new Map,n=Math.pow(10,t);return{get(i){const u=i.match(mg).length;if(r.has(u))return r.get(u);const x=1/Math.pow(u,.5*e),b=parseFloat(Math.round(x*n)/n);return r.set(u,b),b},clear(){r.clear()}}}class va{constructor({getFn:t=Se.getFn,fieldNormWeight:r=Se.fieldNormWeight}={}){this.norm=Eg(r,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((r,n)=>{this._keysMap[r.id]=n})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,kt(this.docs[0])?this.docs.forEach((t,r)=>{this._addString(t,r)}):this.docs.forEach((t,r)=>{this._addObject(t,r)}),this.norm.clear())}add(t){const r=this.size();kt(t)?this._addString(t,r):this._addObject(t,r)}removeAt(t){this.records.splice(t,1);for(let r=t,n=this.size();r<n;r+=1)this.records[r].i-=1}getValueForItemAtKeyId(t,r){return t[this._keysMap[r]]}size(){return this.records.length}_addString(t,r){if(!ft(t)||ss(t))return;let n={v:t,i:r,n:this.norm.get(t)};this.records.push(n)}_addObject(t,r){let n={i:r,$:{}};this.keys.forEach((i,u)=>{let x=i.getFn?i.getFn(t):this.getFn(t,i.path);if(ft(x)){if(Xt(x)){let b=[];const s=[{nestedArrIndex:-1,value:x}];for(;s.length;){const{nestedArrIndex:C,value:g}=s.pop();if(ft(g))if(kt(g)&&!ss(g)){let w={v:g,i:C,n:this.norm.get(g)};b.push(w)}else Xt(g)&&g.forEach((w,R)=>{s.push({nestedArrIndex:R,value:w})})}n.$[u]=b}else if(kt(x)&&!ss(x)){let b={v:x,n:this.norm.get(x)};n.$[u]=b}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function Hl(e,t,{getFn:r=Se.getFn,fieldNormWeight:n=Se.fieldNormWeight}={}){const i=new va({getFn:r,fieldNormWeight:n});return i.setKeys(e.map(Ul)),i.setSources(t),i.create(),i}function vg(e,{getFn:t=Se.getFn,fieldNormWeight:r=Se.fieldNormWeight}={}){const{keys:n,records:i}=e,u=new va({getFn:t,fieldNormWeight:r});return u.setKeys(n),u.setIndexRecords(i),u}function Vn(e,{errors:t=0,currentLocation:r=0,expectedLocation:n=0,distance:i=Se.distance,ignoreLocation:u=Se.ignoreLocation}={}){const x=t/e.length;if(u)return x;const b=Math.abs(n-r);return i?x+b/i:b?1:x}function pg(e=[],t=Se.minMatchCharLength){let r=[],n=-1,i=-1,u=0;for(let x=e.length;u<x;u+=1){let b=e[u];b&&n===-1?n=u:!b&&n!==-1&&(i=u-1,i-n+1>=t&&r.push([n,i]),n=-1)}return e[u-1]&&u-n>=t&&r.push([n,u-1]),r}const gr=32;function Tg(e,t,r,{location:n=Se.location,distance:i=Se.distance,threshold:u=Se.threshold,findAllMatches:x=Se.findAllMatches,minMatchCharLength:b=Se.minMatchCharLength,includeMatches:s=Se.includeMatches,ignoreLocation:C=Se.ignoreLocation}={}){if(t.length>gr)throw new Error(ag(gr));const g=t.length,w=e.length,R=Math.max(0,Math.min(n,w));let K=u,k=R;const F=b>1||s,B=F?Array(w):[];let P;for(;(P=e.indexOf(t,k))>-1;){let E=Vn(t,{currentLocation:P,expectedLocation:R,distance:i,ignoreLocation:C});if(K=Math.min(E,K),k=P+g,F){let d=0;for(;d<g;)B[P+d]=1,d+=1}}k=-1;let M=[],m=1,N=g+w;const I=1<<g-1;for(let E=0;E<g;E+=1){let d=0,c=N;for(;d<c;)Vn(t,{errors:E,currentLocation:R+c,expectedLocation:R,distance:i,ignoreLocation:C})<=K?d=c:N=c,c=Math.floor((N-d)/2+d);N=c;let S=Math.max(1,R-c+1),v=x?w:Math.min(R+c,w)+g,l=Array(v+2);l[v+1]=(1<<E)-1;for(let y=v;y>=S;y-=1){let T=y-1,f=r[e.charAt(T)];if(F&&(B[T]=+!!f),l[y]=(l[y+1]<<1|1)&f,E&&(l[y]|=(M[y+1]|M[y])<<1|1|M[y+1]),l[y]&I&&(m=Vn(t,{errors:E,currentLocation:T,expectedLocation:R,distance:i,ignoreLocation:C}),m<=K)){if(K=m,k=T,k<=R)break;S=Math.max(1,2*R-k)}}if(Vn(t,{errors:E+1,currentLocation:R,expectedLocation:R,distance:i,ignoreLocation:C})>K)break;M=l}const h={isMatch:k>=0,score:Math.max(.001,m)};if(F){const E=pg(B,b);E.length?s&&(h.indices=E):h.isMatch=!1}return h}function _g(e){let t={};for(let r=0,n=e.length;r<n;r+=1){const i=e.charAt(r);t[i]=(t[i]||0)|1<<n-r-1}return t}class Kl{constructor(t,{location:r=Se.location,threshold:n=Se.threshold,distance:i=Se.distance,includeMatches:u=Se.includeMatches,findAllMatches:x=Se.findAllMatches,minMatchCharLength:b=Se.minMatchCharLength,isCaseSensitive:s=Se.isCaseSensitive,ignoreLocation:C=Se.ignoreLocation}={}){if(this.options={location:r,threshold:n,distance:i,includeMatches:u,findAllMatches:x,minMatchCharLength:b,isCaseSensitive:s,ignoreLocation:C},this.pattern=s?t:t.toLowerCase(),this.chunks=[],!this.pattern.length)return;const g=(R,K)=>{this.chunks.push({pattern:R,alphabet:_g(R),startIndex:K})},w=this.pattern.length;if(w>gr){let R=0;const K=w%gr,k=w-K;for(;R<k;)g(this.pattern.substr(R,gr),R),R+=gr;if(K){const F=w-gr;g(this.pattern.substr(F),F)}}else g(this.pattern,0)}searchIn(t){const{isCaseSensitive:r,includeMatches:n}=this.options;if(r||(t=t.toLowerCase()),this.pattern===t){let k={isMatch:!0,score:0};return n&&(k.indices=[[0,t.length-1]]),k}const{location:i,distance:u,threshold:x,findAllMatches:b,minMatchCharLength:s,ignoreLocation:C}=this.options;let g=[],w=0,R=!1;this.chunks.forEach(({pattern:k,alphabet:F,startIndex:B})=>{const{isMatch:P,score:M,indices:m}=Tg(t,k,F,{location:i+B,distance:u,threshold:x,findAllMatches:b,minMatchCharLength:s,includeMatches:n,ignoreLocation:C});P&&(R=!0),w+=M,P&&m&&(g=[...g,...m])});let K={isMatch:R,score:R?w/this.chunks.length:1};return R&&n&&(K.indices=g),K}}class sr{constructor(t){this.pattern=t}static isMultiMatch(t){return Ho(t,this.multiRegex)}static isSingleMatch(t){return Ho(t,this.singleRegex)}search(){}}function Ho(e,t){const r=e.match(t);return r?r[1]:null}class Ag extends sr{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){const r=t===this.pattern;return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}}class yg extends sr{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){const n=t.indexOf(this.pattern)===-1;return{isMatch:n,score:n?0:1,indices:[0,t.length-1]}}}class bg extends sr{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){const r=t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}}class Sg extends sr{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){const r=!t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class Ig extends sr{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){const r=t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[t.length-this.pattern.length,t.length-1]}}}class xg extends sr{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){const r=!t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class Wl extends sr{constructor(t,{location:r=Se.location,threshold:n=Se.threshold,distance:i=Se.distance,includeMatches:u=Se.includeMatches,findAllMatches:x=Se.findAllMatches,minMatchCharLength:b=Se.minMatchCharLength,isCaseSensitive:s=Se.isCaseSensitive,ignoreLocation:C=Se.ignoreLocation}={}){super(t),this._bitapSearch=new Kl(t,{location:r,threshold:n,distance:i,includeMatches:u,findAllMatches:x,minMatchCharLength:b,isCaseSensitive:s,ignoreLocation:C})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}}class Gl extends sr{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let r=0,n;const i=[],u=this.pattern.length;for(;(n=t.indexOf(this.pattern,r))>-1;)r=n+u,i.push([n,r-1]);const x=!!i.length;return{isMatch:x,score:x?0:1,indices:i}}}const Ms=[Ag,Gl,bg,Sg,xg,Ig,yg,Wl],Ko=Ms.length,Lg=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Cg="|";function Dg(e,t={}){return e.split(Cg).map(r=>{let n=r.trim().split(Lg).filter(u=>u&&!!u.trim()),i=[];for(let u=0,x=n.length;u<x;u+=1){const b=n[u];let s=!1,C=-1;for(;!s&&++C<Ko;){const g=Ms[C];let w=g.isMultiMatch(b);w&&(i.push(new g(w,t)),s=!0)}if(!s)for(C=-1;++C<Ko;){const g=Ms[C];let w=g.isSingleMatch(b);if(w){i.push(new g(w,t));break}}}return i})}const Rg=new Set([Wl.type,Gl.type]);class Og{constructor(t,{isCaseSensitive:r=Se.isCaseSensitive,includeMatches:n=Se.includeMatches,minMatchCharLength:i=Se.minMatchCharLength,ignoreLocation:u=Se.ignoreLocation,findAllMatches:x=Se.findAllMatches,location:b=Se.location,threshold:s=Se.threshold,distance:C=Se.distance}={}){this.query=null,this.options={isCaseSensitive:r,includeMatches:n,minMatchCharLength:i,findAllMatches:x,ignoreLocation:u,location:b,threshold:s,distance:C},this.pattern=r?t:t.toLowerCase(),this.query=Dg(this.pattern,this.options)}static condition(t,r){return r.useExtendedSearch}searchIn(t){const r=this.query;if(!r)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:i}=this.options;t=i?t:t.toLowerCase();let u=0,x=[],b=0;for(let s=0,C=r.length;s<C;s+=1){const g=r[s];x.length=0,u=0;for(let w=0,R=g.length;w<R;w+=1){const K=g[w],{isMatch:k,indices:F,score:B}=K.search(t);if(k){if(u+=1,b+=B,n){const P=K.constructor.type;Rg.has(P)?x=[...x,...F]:x.push(F)}}else{b=0,u=0,x.length=0;break}}if(u){let w={isMatch:!0,score:b/u};return n&&(w.indices=x),w}}return{isMatch:!1,score:1}}}const Ns=[];function Pg(...e){Ns.push(...e)}function Fs(e,t){for(let r=0,n=Ns.length;r<n;r+=1){let i=Ns[r];if(i.condition(e,t))return new i(e,t)}return new Kl(e,t)}const di={AND:"$and",OR:"$or"},ks={PATH:"$path",PATTERN:"$val"},Bs=e=>!!(e[di.AND]||e[di.OR]),Mg=e=>!!e[ks.PATH],Ng=e=>!Xt(e)&&Bl(e)&&!Bs(e),Wo=e=>({[di.AND]:Object.keys(e).map(t=>({[t]:e[t]}))});function Yl(e,t,{auto:r=!0}={}){const n=i=>{let u=Object.keys(i);const x=Mg(i);if(!x&&u.length>1&&!Bs(i))return n(Wo(i));if(Ng(i)){const s=x?i[ks.PATH]:u[0],C=x?i[ks.PATTERN]:i[s];if(!kt(C))throw new Error(sg(s));const g={keyId:Ps(s),pattern:C};return r&&(g.searcher=Fs(C,t)),g}let b={children:[],operator:u[0]};return u.forEach(s=>{const C=i[s];Xt(C)&&C.forEach(g=>{b.children.push(n(g))})}),b};return Bs(e)||(e=Wo(e)),n(e)}function Fg(e,{ignoreFieldNorm:t=Se.ignoreFieldNorm}){e.forEach(r=>{let n=1;r.matches.forEach(({key:i,norm:u,score:x})=>{const b=i?i.weight:null;n*=Math.pow(x===0&&b?Number.EPSILON:x,(b||1)*(t?1:u))}),r.score=n})}function kg(e,t){const r=e.matches;t.matches=[],ft(r)&&r.forEach(n=>{if(!ft(n.indices)||!n.indices.length)return;const{indices:i,value:u}=n;let x={indices:i,value:u};n.key&&(x.key=n.key.src),n.idx>-1&&(x.refIndex=n.idx),t.matches.push(x)})}function Bg(e,t){t.score=e.score}function wg(e,t,{includeMatches:r=Se.includeMatches,includeScore:n=Se.includeScore}={}){const i=[];return r&&i.push(kg),n&&i.push(Bg),e.map(u=>{const{idx:x}=u,b={item:t[x],refIndex:x};return i.length&&i.forEach(s=>{s(u,b)}),b})}class Pn{constructor(t,r={},n){this.options={...Se,...r},this.options.useExtendedSearch,this._keyStore=new lg(this.options.keys),this.setCollection(t,n)}setCollection(t,r){if(this._docs=t,r&&!(r instanceof va))throw new Error(ig);this._myIndex=r||Hl(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){ft(t)&&(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){const r=[];for(let n=0,i=this._docs.length;n<i;n+=1){const u=this._docs[n];t(u,n)&&(this.removeAt(n),n-=1,i-=1,r.push(u))}return r}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:r=-1}={}){const{includeMatches:n,includeScore:i,shouldSort:u,sortFn:x,ignoreFieldNorm:b}=this.options;let s=kt(t)?kt(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return Fg(s,{ignoreFieldNorm:b}),u&&s.sort(x),kl(r)&&r>-1&&(s=s.slice(0,r)),wg(s,this._docs,{includeMatches:n,includeScore:i})}_searchStringList(t){const r=Fs(t,this.options),{records:n}=this._myIndex,i=[];return n.forEach(({v:u,i:x,n:b})=>{if(!ft(u))return;const{isMatch:s,score:C,indices:g}=r.searchIn(u);s&&i.push({item:u,idx:x,matches:[{score:C,value:u,norm:b,indices:g}]})}),i}_searchLogical(t){const r=Yl(t,this.options),n=(b,s,C)=>{if(!b.children){const{keyId:w,searcher:R}=b,K=this._findMatches({key:this._keyStore.get(w),value:this._myIndex.getValueForItemAtKeyId(s,w),searcher:R});return K&&K.length?[{idx:C,item:s,matches:K}]:[]}const g=[];for(let w=0,R=b.children.length;w<R;w+=1){const K=b.children[w],k=n(K,s,C);if(k.length)g.push(...k);else if(b.operator===di.AND)return[]}return g},i=this._myIndex.records,u={},x=[];return i.forEach(({$:b,i:s})=>{if(ft(b)){let C=n(r,b,s);C.length&&(u[s]||(u[s]={idx:s,item:b,matches:[]},x.push(u[s])),C.forEach(({matches:g})=>{u[s].matches.push(...g)}))}}),x}_searchObjectList(t){const r=Fs(t,this.options),{keys:n,records:i}=this._myIndex,u=[];return i.forEach(({$:x,i:b})=>{if(!ft(x))return;let s=[];n.forEach((C,g)=>{s.push(...this._findMatches({key:C,value:x[g],searcher:r}))}),s.length&&u.push({idx:b,item:x,matches:s})}),u}_findMatches({key:t,value:r,searcher:n}){if(!ft(r))return[];let i=[];if(Xt(r))r.forEach(({v:u,i:x,n:b})=>{if(!ft(u))return;const{isMatch:s,score:C,indices:g}=n.searchIn(u);s&&i.push({score:C,key:t,value:u,idx:x,norm:b,indices:g})});else{const{v:u,n:x}=r,{isMatch:b,score:s,indices:C}=n.searchIn(u);b&&i.push({score:s,key:t,value:u,norm:x,indices:C})}return i}}Pn.version="6.6.2";Pn.createIndex=Hl;Pn.parseIndex=vg;Pn.config=Se;Pn.parseQuery=Yl;Pg(Og);const pa={xml:!1,decodeEntities:!0},Go={_useHtmlParser2:!0,xmlMode:!0};function ws(e){return e!=null&&e.xml?typeof e.xml=="boolean"?Go:{...Go,...e.xml}:e??void 0}var Oe;(function(e){e.Root="root",e.Text="text",e.Directive="directive",e.Comment="comment",e.Script="script",e.Style="style",e.Tag="tag",e.CDATA="cdata",e.Doctype="doctype"})(Oe||(Oe={}));function Ug(e){return e.type===Oe.Tag||e.type===Oe.Script||e.type===Oe.Style}const Hg=Oe.Root,Kg=Oe.Text,Wg=Oe.Directive,Gg=Oe.Comment,Yg=Oe.Script,Vg=Oe.Style,jg=Oe.Tag,Xg=Oe.CDATA,$g=Oe.Doctype;class Vl{constructor(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}get parentNode(){return this.parent}set parentNode(t){this.parent=t}get previousSibling(){return this.prev}set previousSibling(t){this.prev=t}get nextSibling(){return this.next}set nextSibling(t){this.next=t}cloneNode(t=!1){return hi(this,t)}}class Ta extends Vl{constructor(t){super(),this.data=t}get nodeValue(){return this.data}set nodeValue(t){this.data=t}}class Ln extends Ta{constructor(){super(...arguments),this.type=Oe.Text}get nodeType(){return 3}}class _a extends Ta{constructor(){super(...arguments),this.type=Oe.Comment}get nodeType(){return 8}}class Aa extends Ta{constructor(t,r){super(r),this.name=t,this.type=Oe.Directive}get nodeType(){return 1}}class ya extends Vl{constructor(t){super(),this.children=t}get firstChild(){var t;return(t=this.children[0])!==null&&t!==void 0?t:null}get lastChild(){return this.children.length>0?this.children[this.children.length-1]:null}get childNodes(){return this.children}set childNodes(t){this.children=t}}class jl extends ya{constructor(){super(...arguments),this.type=Oe.CDATA}get nodeType(){return 4}}class yr extends ya{constructor(){super(...arguments),this.type=Oe.Root}get nodeType(){return 9}}let ba=class extends ya{constructor(t,r,n=[],i=t==="script"?Oe.Script:t==="style"?Oe.Style:Oe.Tag){super(n),this.name=t,this.attribs=r,this.type=i}get nodeType(){return 1}get tagName(){return this.name}set tagName(t){this.name=t}get attributes(){return Object.keys(this.attribs).map(t=>{var r,n;return{name:t,value:this.attribs[t],namespace:(r=this["x-attribsNamespace"])===null||r===void 0?void 0:r[t],prefix:(n=this["x-attribsPrefix"])===null||n===void 0?void 0:n[t]}})}};function be(e){return Ug(e)}function Fi(e){return e.type===Oe.CDATA}function Bt(e){return e.type===Oe.Text}function ki(e){return e.type===Oe.Comment}function Us(e){return e.type===Oe.Directive}function Sr(e){return e.type===Oe.Root}function Xe(e){return Object.prototype.hasOwnProperty.call(e,"children")}function hi(e,t=!1){let r;if(Bt(e))r=new Ln(e.data);else if(ki(e))r=new _a(e.data);else if(be(e)){const n=t?as(e.children):[],i=new ba(e.name,{...e.attribs},n);n.forEach(u=>u.parent=i),e.namespace!=null&&(i.namespace=e.namespace),e["x-attribsNamespace"]&&(i["x-attribsNamespace"]={...e["x-attribsNamespace"]}),e["x-attribsPrefix"]&&(i["x-attribsPrefix"]={...e["x-attribsPrefix"]}),r=i}else if(Fi(e)){const n=t?as(e.children):[],i=new jl(n);n.forEach(u=>u.parent=i),r=i}else if(Sr(e)){const n=t?as(e.children):[],i=new yr(n);n.forEach(u=>u.parent=i),e["x-mode"]&&(i["x-mode"]=e["x-mode"]),r=i}else if(Us(e)){const n=new Aa(e.name,e.data);e["x-name"]!=null&&(n["x-name"]=e["x-name"],n["x-publicId"]=e["x-publicId"],n["x-systemId"]=e["x-systemId"]),r=n}else throw new Error(`Not implemented yet: ${e.type}`);return r.startIndex=e.startIndex,r.endIndex=e.endIndex,e.sourceCodeLocation!=null&&(r.sourceCodeLocation=e.sourceCodeLocation),r}function as(e){const t=e.map(r=>hi(r,!0));for(let r=1;r<t.length;r++)t[r].prev=t[r-1],t[r-1].next=t[r];return t}const Yo={withStartIndices:!1,withEndIndices:!1,xmlMode:!1};class Qg{constructor(t,r,n){this.dom=[],this.root=new yr(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof r=="function"&&(n=r,r=Yo),typeof t=="object"&&(r=t,t=void 0),this.callback=t??null,this.options=r??Yo,this.elementCB=n??null}onparserinit(t){this.parser=t}onreset(){this.dom=[],this.root=new yr(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null}onend(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))}onerror(t){this.handleCallback(t)}onclosetag(){this.lastNode=null;const t=this.tagStack.pop();this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(t)}onopentag(t,r){const n=this.options.xmlMode?Oe.Tag:void 0,i=new ba(t,r,void 0,n);this.addNode(i),this.tagStack.push(i)}ontext(t){const{lastNode:r}=this;if(r&&r.type===Oe.Text)r.data+=t,this.options.withEndIndices&&(r.endIndex=this.parser.endIndex);else{const n=new Ln(t);this.addNode(n),this.lastNode=n}}oncomment(t){if(this.lastNode&&this.lastNode.type===Oe.Comment){this.lastNode.data+=t;return}const r=new _a(t);this.addNode(r),this.lastNode=r}oncommentend(){this.lastNode=null}oncdatastart(){const t=new Ln(""),r=new jl([t]);this.addNode(r),t.parent=r,this.lastNode=t}oncdataend(){this.lastNode=null}onprocessinginstruction(t,r){const n=new Aa(t,r);this.addNode(n)}handleCallback(t){if(typeof this.callback=="function")this.callback(t,this.dom);else if(t)throw t}addNode(t){const r=this.tagStack[this.tagStack.length-1],n=r.children[r.children.length-1];this.options.withStartIndices&&(t.startIndex=this.parser.startIndex),this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),r.children.push(t),n&&(t.prev=n,n.next=t),t.parent=r,this.lastNode=null}}const qt=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(e=>e.charCodeAt(0))),zg=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(e=>e.charCodeAt(0)));var os;const qg=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),Vo=(os=String.fromCodePoint)!==null&&os!==void 0?os:function(e){let t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|e&1023),t+=String.fromCharCode(e),t};function Jg(e){var t;return e>=55296&&e<=57343||e>1114111?65533:(t=qg.get(e))!==null&&t!==void 0?t:e}var jo;(function(e){e[e.NUM=35]="NUM",e[e.SEMI=59]="SEMI",e[e.ZERO=48]="ZERO",e[e.NINE=57]="NINE",e[e.LOWER_A=97]="LOWER_A",e[e.LOWER_F=102]="LOWER_F",e[e.LOWER_X=120]="LOWER_X",e[e.To_LOWER_BIT=32]="To_LOWER_BIT"})(jo||(jo={}));var Vt;(function(e){e[e.VALUE_LENGTH=49152]="VALUE_LENGTH",e[e.BRANCH_LENGTH=16256]="BRANCH_LENGTH",e[e.JUMP_TABLE=127]="JUMP_TABLE"})(Vt||(Vt={}));function Xl(e,t,r,n){const i=(t&Vt.BRANCH_LENGTH)>>7,u=t&Vt.JUMP_TABLE;if(i===0)return u!==0&&n===u?r:-1;if(u){const s=n-u;return s<0||s>=i?-1:e[r+s]-1}let x=r,b=x+i-1;for(;x<=b;){const s=x+b>>>1,C=e[s];if(C<n)x=s+1;else if(C>n)b=s-1;else return e[s+i]}return-1}const Xo=/["&'<>$\x80-\uFFFF]/g,Zg=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]),em=String.prototype.codePointAt!=null?(e,t)=>e.codePointAt(t):(e,t)=>(e.charCodeAt(t)&64512)===55296?(e.charCodeAt(t)-55296)*1024+e.charCodeAt(t+1)-56320+65536:e.charCodeAt(t);function $l(e){let t="",r=0,n;for(;(n=Xo.exec(e))!==null;){const i=n.index,u=e.charCodeAt(i),x=Zg.get(u);x!==void 0?(t+=e.substring(r,i)+x,r=i+1):(t+=`${e.substring(r,i)}&#x${em(e,i).toString(16)};`,r=Xo.lastIndex+=Number((u&64512)===55296))}return t+e.substr(r)}function Ql(e,t){return function(n){let i,u=0,x="";for(;i=e.exec(n);)u!==i.index&&(x+=n.substring(u,i.index)),x+=t.get(i[0].charCodeAt(0)),u=i.index+1;return x+n.substring(u)}}const zl=Ql(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),ql=Ql(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]])),tm=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(e=>[e.toLowerCase(),e])),rm=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),nm=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function im(e){return e.replace(/"/g,"&quot;")}function sm(e,t){var r;if(!e)return;const n=((r=t.encodeEntities)!==null&&r!==void 0?r:t.decodeEntities)===!1?im:t.xmlMode||t.encodeEntities!=="utf8"?$l:zl;return Object.keys(e).map(i=>{var u,x;const b=(u=e[i])!==null&&u!==void 0?u:"";return t.xmlMode==="foreign"&&(i=(x=rm.get(i))!==null&&x!==void 0?x:i),!t.emptyAttrs&&!t.xmlMode&&b===""?i:`${i}="${n(b)}"`}).join(" ")}const $o=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function Bi(e,t={}){const r="length"in e?e:[e];let n="";for(let i=0;i<r.length;i++)n+=am(r[i],t);return n}function am(e,t){switch(e.type){case Hg:return Bi(e.children,t);case $g:case Wg:return cm(e);case Gg:return hm(e);case Xg:return dm(e);case Yg:case Vg:case jg:return lm(e,t);case Kg:return fm(e,t)}}const om=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),um=new Set(["svg","math"]);function lm(e,t){var r;t.xmlMode==="foreign"&&(e.name=(r=tm.get(e.name))!==null&&r!==void 0?r:e.name,e.parent&&om.has(e.parent.name)&&(t={...t,xmlMode:!1})),!t.xmlMode&&um.has(e.name)&&(t={...t,xmlMode:"foreign"});let n=`<${e.name}`;const i=sm(e.attribs,t);return i&&(n+=` ${i}`),e.children.length===0&&(t.xmlMode?t.selfClosingTags!==!1:t.selfClosingTags&&$o.has(e.name))?(t.xmlMode||(n+=" "),n+="/>"):(n+=">",e.children.length>0&&(n+=Bi(e.children,t)),(t.xmlMode||!$o.has(e.name))&&(n+=`</${e.name}>`)),n}function cm(e){return`<${e.data}>`}function fm(e,t){var r;let n=e.data||"";return((r=t.encodeEntities)!==null&&r!==void 0?r:t.decodeEntities)!==!1&&!(!t.xmlMode&&e.parent&&nm.has(e.parent.name))&&(n=t.xmlMode||t.encodeEntities!=="utf8"?$l(n):ql(n)),n}function dm(e){return`<![CDATA[${e.children[0].data}]]>`}function hm(e){return`<!--${e.data}-->`}function Jl(e,t){return Bi(e,t)}function gm(e,t){return Xe(e)?e.children.map(r=>Jl(r,t)).join(""):""}function ii(e){return Array.isArray(e)?e.map(ii).join(""):be(e)?e.name==="br"?`
`:ii(e.children):Fi(e)?ii(e.children):Bt(e)?e.data:""}function jr(e){return Array.isArray(e)?e.map(jr).join(""):Xe(e)&&!ki(e)?jr(e.children):Bt(e)?e.data:""}function gi(e){return Array.isArray(e)?e.map(gi).join(""):Xe(e)&&(e.type===Oe.Tag||Fi(e))?gi(e.children):Bt(e)?e.data:""}function wi(e){return Xe(e)?e.children:[]}function Zl(e){return e.parent||null}function ec(e){const t=Zl(e);if(t!=null)return wi(t);const r=[e];let{prev:n,next:i}=e;for(;n!=null;)r.unshift(n),{prev:n}=n;for(;i!=null;)r.push(i),{next:i}=i;return r}function mm(e,t){var r;return(r=e.attribs)===null||r===void 0?void 0:r[t]}function Em(e,t){return e.attribs!=null&&Object.prototype.hasOwnProperty.call(e.attribs,t)&&e.attribs[t]!=null}function vm(e){return e.name}function Sa(e){let{next:t}=e;for(;t!==null&&!be(t);)({next:t}=t);return t}function Ia(e){let{prev:t}=e;for(;t!==null&&!be(t);)({prev:t}=t);return t}function Ir(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){const t=e.parent.children;t.splice(t.lastIndexOf(e),1)}}function pm(e,t){const r=t.prev=e.prev;r&&(r.next=t);const n=t.next=e.next;n&&(n.prev=t);const i=t.parent=e.parent;if(i){const u=i.children;u[u.lastIndexOf(e)]=t,e.parent=null}}function Tm(e,t){if(Ir(t),t.next=null,t.parent=e,e.children.push(t)>1){const r=e.children[e.children.length-2];r.next=t,t.prev=r}else t.prev=null}function _m(e,t){Ir(t);const{parent:r}=e,n=e.next;if(t.next=n,t.prev=e,e.next=t,t.parent=r,n){if(n.prev=t,r){const i=r.children;i.splice(i.lastIndexOf(n),0,t)}}else r&&r.children.push(t)}function Am(e,t){if(Ir(t),t.parent=e,t.prev=null,e.children.unshift(t)!==1){const r=e.children[1];r.prev=t,t.next=r}else t.next=null}function ym(e,t){Ir(t);const{parent:r}=e;if(r){const n=r.children;n.splice(n.indexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=r,t.prev=e.prev,t.next=e,e.prev=t}function Ui(e,t,r=!0,n=1/0){return Array.isArray(t)||(t=[t]),Hi(e,t,r,n)}function Hi(e,t,r,n){const i=[];for(const u of t){if(e(u)&&(i.push(u),--n<=0))break;if(r&&Xe(u)&&u.children.length>0){const x=Hi(e,u.children,r,n);if(i.push(...x),n-=x.length,n<=0)break}}return i}function bm(e,t){return t.find(e)}function xa(e,t,r=!0){let n=null;for(let i=0;i<t.length&&!n;i++){const u=t[i];if(be(u))e(u)?n=u:r&&u.children.length>0&&(n=xa(e,u.children,!0));else continue}return n}function tc(e,t){return t.some(r=>be(r)&&(e(r)||r.children.length>0&&tc(e,r.children)))}function Sm(e,t){var r;const n=[],i=t.filter(be);let u;for(;u=i.shift();){const x=(r=u.children)===null||r===void 0?void 0:r.filter(be);x&&x.length>0&&i.unshift(...x),e(u)&&n.push(u)}return n}const mi={tag_name(e){return typeof e=="function"?t=>be(t)&&e(t.name):e==="*"?be:t=>be(t)&&t.name===e},tag_type(e){return typeof e=="function"?t=>e(t.type):t=>t.type===e},tag_contains(e){return typeof e=="function"?t=>Bt(t)&&e(t.data):t=>Bt(t)&&t.data===e}};function rc(e,t){return typeof t=="function"?r=>be(r)&&t(r.attribs[e]):r=>be(r)&&r.attribs[e]===t}function Im(e,t){return r=>e(r)||t(r)}function nc(e){const t=Object.keys(e).map(r=>{const n=e[r];return Object.prototype.hasOwnProperty.call(mi,r)?mi[r](n):rc(r,n)});return t.length===0?null:t.reduce(Im)}function xm(e,t){const r=nc(e);return r?r(t):!0}function Lm(e,t,r,n=1/0){const i=nc(e);return i?Ui(i,t,r,n):[]}function Cm(e,t,r=!0){return Array.isArray(t)||(t=[t]),xa(rc("id",e),t,r)}function qr(e,t,r=!0,n=1/0){return Ui(mi.tag_name(e),t,r,n)}function Dm(e,t,r=!0,n=1/0){return Ui(mi.tag_type(e),t,r,n)}function Rm(e){let t=e.length;for(;--t>=0;){const r=e[t];if(t>0&&e.lastIndexOf(r,t-1)>=0){e.splice(t,1);continue}for(let n=r.parent;n;n=n.parent)if(e.includes(n)){e.splice(t,1);break}}return e}var vt;(function(e){e[e.DISCONNECTED=1]="DISCONNECTED",e[e.PRECEDING=2]="PRECEDING",e[e.FOLLOWING=4]="FOLLOWING",e[e.CONTAINS=8]="CONTAINS",e[e.CONTAINED_BY=16]="CONTAINED_BY"})(vt||(vt={}));function ic(e,t){const r=[],n=[];if(e===t)return 0;let i=Xe(e)?e:e.parent;for(;i;)r.unshift(i),i=i.parent;for(i=Xe(t)?t:t.parent;i;)n.unshift(i),i=i.parent;const u=Math.min(r.length,n.length);let x=0;for(;x<u&&r[x]===n[x];)x++;if(x===0)return vt.DISCONNECTED;const b=r[x-1],s=b.children,C=r[x],g=n[x];return s.indexOf(C)>s.indexOf(g)?b===t?vt.FOLLOWING|vt.CONTAINED_BY:vt.FOLLOWING:b===e?vt.PRECEDING|vt.CONTAINS:vt.PRECEDING}function Jr(e){return e=e.filter((t,r,n)=>!n.includes(t,r+1)),e.sort((t,r)=>{const n=ic(t,r);return n&vt.PRECEDING?-1:n&vt.FOLLOWING?1:0}),e}function Om(e){const t=Ei(km,e);return t?t.name==="feed"?Pm(t):Mm(t):null}function Pm(e){var t;const r=e.children,n={type:"atom",items:qr("entry",r).map(x=>{var b;const{children:s}=x,C={media:sc(s)};at(C,"id","id",s),at(C,"title","title",s);const g=(b=Ei("link",s))===null||b===void 0?void 0:b.attribs.href;g&&(C.link=g);const w=pr("summary",s)||pr("content",s);w&&(C.description=w);const R=pr("updated",s);return R&&(C.pubDate=new Date(R)),C})};at(n,"id","id",r),at(n,"title","title",r);const i=(t=Ei("link",r))===null||t===void 0?void 0:t.attribs.href;i&&(n.link=i),at(n,"description","subtitle",r);const u=pr("updated",r);return u&&(n.updated=new Date(u)),at(n,"author","email",r,!0),n}function Mm(e){var t,r;const n=(r=(t=Ei("channel",e.children))===null||t===void 0?void 0:t.children)!==null&&r!==void 0?r:[],i={type:e.name.substr(0,3),id:"",items:qr("item",e.children).map(x=>{const{children:b}=x,s={media:sc(b)};at(s,"id","guid",b),at(s,"title","title",b),at(s,"link","link",b),at(s,"description","description",b);const C=pr("pubDate",b);return C&&(s.pubDate=new Date(C)),s})};at(i,"title","title",n),at(i,"link","link",n),at(i,"description","description",n);const u=pr("lastBuildDate",n);return u&&(i.updated=new Date(u)),at(i,"author","managingEditor",n,!0),i}const Nm=["url","type","lang"],Fm=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function sc(e){return qr("media:content",e).map(t=>{const{attribs:r}=t,n={medium:r.medium,isDefault:!!r.isDefault};for(const i of Nm)r[i]&&(n[i]=r[i]);for(const i of Fm)r[i]&&(n[i]=parseInt(r[i],10));return r.expression&&(n.expression=r.expression),n})}function Ei(e,t){return qr(e,t,!0,1)[0]}function pr(e,t,r=!1){return jr(qr(e,t,r,1)).trim()}function at(e,t,r,n,i=!1){const u=pr(r,n,i);u&&(e[t]=u)}function km(e){return e==="rss"||e==="feed"||e==="rdf:RDF"}const Ki=Object.freeze(Object.defineProperty({__proto__:null,get DocumentPosition(){return vt},append:_m,appendChild:Tm,compareDocumentPosition:ic,existsOne:tc,filter:Ui,find:Hi,findAll:Sm,findOne:xa,findOneChild:bm,getAttributeValue:mm,getChildren:wi,getElementById:Cm,getElements:Lm,getElementsByTagName:qr,getElementsByTagType:Dm,getFeed:Om,getInnerHTML:gm,getName:vm,getOuterHTML:Jl,getParent:Zl,getSiblings:ec,getText:ii,hasAttrib:Em,hasChildren:Xe,innerText:gi,isCDATA:Fi,isComment:ki,isDocument:Sr,isTag:be,isText:Bt,nextElementSibling:Sa,prepend:ym,prependChild:Am,prevElementSibling:Ia,removeElement:Ir,removeSubsets:Rm,replaceElement:pm,testElement:xm,textContent:jr,uniqueSort:Jr},Symbol.toStringTag,{value:"Module"}));function ac(e,t,r){return e?e(t??e._root.children,null,void 0,r).toString():""}function Bm(e,t){return!t&&typeof e=="object"&&e!=null&&!("length"in e)&&!("type"in e)}function wm(e,t){const r=Bm(e)?(t=e,void 0):e,n={...pa,...this===null||this===void 0?void 0:this._options,...ws(t??{})};return ac(this,r,n)}function Um(e){const t={...this._options,xmlMode:!0};return ac(this,e,t)}function Cn(e){const t=e||(this?this.root():[]);let r="";for(let n=0;n<t.length;n++)r+=jr(t[n]);return r}function Hm(e,t,r=typeof t=="boolean"?t:!1){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(r=t);const n=this.load(e,pa,!1);return r||n("script").remove(),n.root()[0].children.slice()}function Km(){return this(this._root)}function oc(e,t){if(t===e)return!1;let r=t;for(;r&&r!==r.parent;)if(r=r.parent,r===e)return!0;return!1}function Wm(e,t){if(!Qo(e)||!Qo(t))return;let r=e.length;const n=+t.length;for(let i=0;i<n;i++)e[r++]=t[i];return e.length=r,e}function Qo(e){if(Array.isArray(e))return!0;if(typeof e!="object"||!Object.prototype.hasOwnProperty.call(e,"length")||typeof e.length!="number"||e.length<0)return!1;for(let t=0;t<e.length;t++)if(!(t in e))return!1;return!0}const Gm=Object.freeze(Object.defineProperty({__proto__:null,contains:oc,html:wm,merge:Wm,parseHTML:Hm,root:Km,text:Cn,xml:Um},Symbol.toStringTag,{value:"Module"}));function wt(e){return e.cheerio!=null}function Ym(e){return e.replace(/[_.-](\w|$)/g,(t,r)=>r.toUpperCase())}function Vm(e){return e.replace(/[A-Z]/g,"-$&").toLowerCase()}function We(e,t){const r=e.length;for(let n=0;n<r;n++)t(e[n],n);return e}function Hs(e){const t="length"in e?Array.prototype.map.call(e,n=>hi(n,!0)):[hi(e,!0)],r=new yr(t);return t.forEach(n=>{n.parent=r}),t}var mr;(function(e){e[e.LowerA=97]="LowerA",e[e.LowerZ=122]="LowerZ",e[e.UpperA=65]="UpperA",e[e.UpperZ=90]="UpperZ",e[e.Exclamation=33]="Exclamation"})(mr||(mr={}));function Ks(e){const t=e.indexOf("<");if(t<0||t>e.length-3)return!1;const r=e.charCodeAt(t+1);return(r>=mr.LowerA&&r<=mr.LowerZ||r>=mr.UpperA&&r<=mr.UpperZ||r===mr.Exclamation)&&e.includes(">",t+2)}const Ur=Object.prototype.hasOwnProperty,Dn=/\s+/,us="data-",zo={null:null,true:!0,false:!1},La=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,jm=/^{[^]*}$|^\[[^]*]$/;function vi(e,t,r){var n;if(!(!e||!be(e))){if((n=e.attribs)!==null&&n!==void 0||(e.attribs={}),!t)return e.attribs;if(Ur.call(e.attribs,t))return!r&&La.test(t)?t:e.attribs[t];if(e.name==="option"&&t==="value")return Cn(e.children);if(e.name==="input"&&(e.attribs.type==="radio"||e.attribs.type==="checkbox")&&t==="value")return"on"}}function Hr(e,t,r){r===null?uc(e,t):e.attribs[t]=`${r}`}function Xm(e,t){if(typeof e=="object"||t!==void 0){if(typeof t=="function"){if(typeof e!="string")throw new Error("Bad combination of arguments.");return We(this,(r,n)=>{be(r)&&Hr(r,e,t.call(r,n,r.attribs[e]))})}return We(this,r=>{be(r)&&(typeof e=="object"?Object.keys(e).forEach(n=>{const i=e[n];Hr(r,n,i)}):Hr(r,e,t))})}return arguments.length>1?this:vi(this[0],e,this.options.xmlMode)}function qo(e,t,r){return t in e?e[t]:!r&&La.test(t)?vi(e,t,!1)!==void 0:vi(e,t,r)}function ls(e,t,r,n){t in e?e[t]=r:Hr(e,t,!n&&La.test(t)?r?"":null:`${r}`)}function $m(e,t){var r;if(typeof e=="string"&&t===void 0){const n=this[0];if(!n||!be(n))return;switch(e){case"style":{const i=this.css(),u=Object.keys(i);return u.forEach((x,b)=>{i[b]=x}),i.length=u.length,i}case"tagName":case"nodeName":return n.name.toUpperCase();case"href":case"src":{const i=(r=n.attribs)===null||r===void 0?void 0:r[e];return typeof URL<"u"&&(e==="href"&&(n.tagName==="a"||n.name==="link")||e==="src"&&(n.tagName==="img"||n.tagName==="iframe"||n.tagName==="audio"||n.tagName==="video"||n.tagName==="source"))&&i!==void 0&&this.options.baseURI?new URL(i,this.options.baseURI).href:i}case"innerText":return gi(n);case"textContent":return jr(n);case"outerHTML":return this.clone().wrap("<container />").parent().html();case"innerHTML":return this.html();default:return qo(n,e,this.options.xmlMode)}}if(typeof e=="object"||t!==void 0){if(typeof t=="function"){if(typeof e=="object")throw new Error("Bad combination of arguments.");return We(this,(n,i)=>{be(n)&&ls(n,e,t.call(n,i,qo(n,e,this.options.xmlMode)),this.options.xmlMode)})}return We(this,n=>{be(n)&&(typeof e=="object"?Object.keys(e).forEach(i=>{const u=e[i];ls(n,i,u,this.options.xmlMode)}):ls(n,e,t,this.options.xmlMode))})}}function Jo(e,t,r){var n;const i=e;(n=i.data)!==null&&n!==void 0||(i.data={}),typeof t=="object"?Object.assign(i.data,t):typeof t=="string"&&r!==void 0&&(i.data[t]=r)}function Zo(e,t){let r,n,i;t==null?(r=Object.keys(e.attribs).filter(u=>u.startsWith(us)),n=r.map(u=>Ym(u.slice(us.length)))):(r=[us+Vm(t)],n=[t]);for(let u=0;u<r.length;++u){const x=r[u],b=n[u];if(Ur.call(e.attribs,x)&&!Ur.call(e.data,b)){if(i=e.attribs[x],Ur.call(zo,i))i=zo[i];else if(i===String(Number(i)))i=Number(i);else if(jm.test(i))try{i=JSON.parse(i)}catch{}e.data[b]=i}}return t==null?e.data:i}function Qm(e,t){var r;const n=this[0];if(!n||!be(n))return;const i=n;return(r=i.data)!==null&&r!==void 0||(i.data={}),e?typeof e=="object"||t!==void 0?(We(this,u=>{be(u)&&(typeof e=="object"?Jo(u,e):Jo(u,e,t))}),this):Ur.call(i.data,e)?i.data[e]:Zo(i,e):Zo(i)}function zm(e){const t=arguments.length===0,r=this[0];if(!r||!be(r))return t?void 0:this;switch(r.name){case"textarea":return this.text(e);case"select":{const n=this.find("option:selected");if(!t){if(this.attr("multiple")==null&&typeof e=="object")return this;this.find("option").removeAttr("selected");const i=typeof e!="object"?[e]:e;for(let u=0;u<i.length;u++)this.find(`option[value="${i[u]}"]`).attr("selected","");return this}return this.attr("multiple")?n.toArray().map(i=>Cn(i.children)):n.attr("value")}case"input":case"option":return t?this.attr("value"):this.attr("value",e)}}function uc(e,t){!e.attribs||!Ur.call(e.attribs,t)||delete e.attribs[t]}function pi(e){return e?e.trim().split(Dn):[]}function qm(e){const t=pi(e);for(let r=0;r<t.length;r++)We(this,n=>{be(n)&&uc(n,t[r])});return this}function Jm(e){return this.toArray().some(t=>{const r=be(t)&&t.attribs.class;let n=-1;if(r&&e.length)for(;(n=r.indexOf(e,n+1))>-1;){const i=n+e.length;if((n===0||Dn.test(r[n-1]))&&(i===r.length||Dn.test(r[i])))return!0}return!1})}function lc(e){if(typeof e=="function")return We(this,(n,i)=>{if(be(n)){const u=n.attribs.class||"";lc.call([n],e.call(n,i,u))}});if(!e||typeof e!="string")return this;const t=e.split(Dn),r=this.length;for(let n=0;n<r;n++){const i=this[n];if(!be(i))continue;const u=vi(i,"class",!1);if(!u)Hr(i,"class",t.join(" ").trim());else{let x=` ${u} `;for(let b=0;b<t.length;b++){const s=`${t[b]} `;x.includes(` ${s}`)||(x+=s)}Hr(i,"class",x.trim())}}return this}function cc(e){if(typeof e=="function")return We(this,(i,u)=>{be(i)&&cc.call([i],e.call(i,u,i.attribs.class||""))});const t=pi(e),r=t.length,n=arguments.length===0;return We(this,i=>{if(be(i))if(n)i.attribs.class="";else{const u=pi(i.attribs.class);let x=!1;for(let b=0;b<r;b++){const s=u.indexOf(t[b]);s>=0&&(u.splice(s,1),x=!0,b--)}x&&(i.attribs.class=u.join(" "))}})}function fc(e,t){if(typeof e=="function")return We(this,(x,b)=>{be(x)&&fc.call([x],e.call(x,b,x.attribs.class||"",t),t)});if(!e||typeof e!="string")return this;const r=e.split(Dn),n=r.length,i=typeof t=="boolean"?t?1:-1:0,u=this.length;for(let x=0;x<u;x++){const b=this[x];if(!be(b))continue;const s=pi(b.attribs.class);for(let C=0;C<n;C++){const g=s.indexOf(r[C]);i>=0&&g<0?s.push(r[C]):i<=0&&g>=0&&s.splice(g,1)}b.attribs.class=s.join(" ")}return this}const Zm=Object.freeze(Object.defineProperty({__proto__:null,addClass:lc,attr:Xm,data:Qm,hasClass:Jm,prop:$m,removeAttr:qm,removeClass:cc,toggleClass:fc,val:zm},Symbol.toStringTag,{value:"Module"}));var Ae;(function(e){e.Attribute="attribute",e.Pseudo="pseudo",e.PseudoElement="pseudo-element",e.Tag="tag",e.Universal="universal",e.Adjacent="adjacent",e.Child="child",e.Descendant="descendant",e.Parent="parent",e.Sibling="sibling",e.ColumnCombinator="column-combinator"})(Ae||(Ae={}));var Ve;(function(e){e.Any="any",e.Element="element",e.End="end",e.Equals="equals",e.Exists="exists",e.Hyphen="hyphen",e.Not="not",e.Start="start"})(Ve||(Ve={}));const eu=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,eE=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,tE=new Map([[126,Ve.Element],[94,Ve.Start],[36,Ve.End],[42,Ve.Any],[33,Ve.Not],[124,Ve.Hyphen]]),rE=new Set(["has","not","matches","is","where","host","host-context"]);function hn(e){switch(e.type){case Ae.Adjacent:case Ae.Child:case Ae.Descendant:case Ae.Parent:case Ae.Sibling:case Ae.ColumnCombinator:return!0;default:return!1}}const nE=new Set(["contains","icontains"]);function iE(e,t,r){const n=parseInt(t,16)-65536;return n!==n||r?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)}function rn(e){return e.replace(eE,iE)}function cs(e){return e===39||e===34}function tu(e){return e===32||e===9||e===10||e===12||e===13}function Wi(e){const t=[],r=dc(t,`${e}`,0);if(r<e.length)throw new Error(`Unmatched selector: ${e.slice(r)}`);return t}function dc(e,t,r){let n=[];function i(R){const K=t.slice(r+R).match(eu);if(!K)throw new Error(`Expected name, found ${t.slice(r)}`);const[k]=K;return r+=R+k.length,rn(k)}function u(R){for(r+=R;r<t.length&&tu(t.charCodeAt(r));)r++}function x(){r+=1;const R=r;let K=1;for(;K>0&&r<t.length;r++)t.charCodeAt(r)===40&&!b(r)?K++:t.charCodeAt(r)===41&&!b(r)&&K--;if(K)throw new Error("Parenthesis not matched");return rn(t.slice(R,r-1))}function b(R){let K=0;for(;t.charCodeAt(--R)===92;)K++;return(K&1)===1}function s(){if(n.length>0&&hn(n[n.length-1]))throw new Error("Did not expect successive traversals.")}function C(R){if(n.length>0&&n[n.length-1].type===Ae.Descendant){n[n.length-1].type=R;return}s(),n.push({type:R})}function g(R,K){n.push({type:Ae.Attribute,name:R,action:K,value:i(1),namespace:null,ignoreCase:"quirks"})}function w(){if(n.length&&n[n.length-1].type===Ae.Descendant&&n.pop(),n.length===0)throw new Error("Empty sub-selector");e.push(n)}if(u(0),t.length===r)return r;e:for(;r<t.length;){const R=t.charCodeAt(r);switch(R){case 32:case 9:case 10:case 12:case 13:{(n.length===0||n[0].type!==Ae.Descendant)&&(s(),n.push({type:Ae.Descendant})),u(1);break}case 62:{C(Ae.Child),u(1);break}case 60:{C(Ae.Parent),u(1);break}case 126:{C(Ae.Sibling),u(1);break}case 43:{C(Ae.Adjacent),u(1);break}case 46:{g("class",Ve.Element);break}case 35:{g("id",Ve.Equals);break}case 91:{u(1);let K,k=null;t.charCodeAt(r)===124?K=i(1):t.startsWith("*|",r)?(k="*",K=i(2)):(K=i(0),t.charCodeAt(r)===124&&t.charCodeAt(r+1)!==61&&(k=K,K=i(1))),u(0);let F=Ve.Exists;const B=tE.get(t.charCodeAt(r));if(B){if(F=B,t.charCodeAt(r+1)!==61)throw new Error("Expected `=`");u(2)}else t.charCodeAt(r)===61&&(F=Ve.Equals,u(1));let P="",M=null;if(F!=="exists"){if(cs(t.charCodeAt(r))){const I=t.charCodeAt(r);let h=r+1;for(;h<t.length&&(t.charCodeAt(h)!==I||b(h));)h+=1;if(t.charCodeAt(h)!==I)throw new Error("Attribute value didn't end");P=rn(t.slice(r+1,h)),r=h+1}else{const I=r;for(;r<t.length&&(!tu(t.charCodeAt(r))&&t.charCodeAt(r)!==93||b(r));)r+=1;P=rn(t.slice(I,r))}u(0);const N=t.charCodeAt(r)|32;N===115?(M=!1,u(1)):N===105&&(M=!0,u(1))}if(t.charCodeAt(r)!==93)throw new Error("Attribute selector didn't terminate");r+=1;const m={type:Ae.Attribute,name:K,action:F,value:P,namespace:k,ignoreCase:M};n.push(m);break}case 58:{if(t.charCodeAt(r+1)===58){n.push({type:Ae.PseudoElement,name:i(2).toLowerCase(),data:t.charCodeAt(r)===40?x():null});continue}const K=i(1).toLowerCase();let k=null;if(t.charCodeAt(r)===40)if(rE.has(K)){if(cs(t.charCodeAt(r+1)))throw new Error(`Pseudo-selector ${K} cannot be quoted`);if(k=[],r=dc(k,t,r+1),t.charCodeAt(r)!==41)throw new Error(`Missing closing parenthesis in :${K} (${t})`);r+=1}else{if(k=x(),nE.has(K)){const F=k.charCodeAt(0);F===k.charCodeAt(k.length-1)&&cs(F)&&(k=k.slice(1,-1))}k=rn(k)}n.push({type:Ae.Pseudo,name:K,data:k});break}case 44:{w(),n=[],u(1);break}default:{if(t.startsWith("/*",r)){const F=t.indexOf("*/",r+2);if(F<0)throw new Error("Comment was not terminated");r=F+2,n.length===0&&u(0);break}let K=null,k;if(R===42)r+=1,k="*";else if(R===124){if(k="",t.charCodeAt(r+1)===124){C(Ae.ColumnCombinator),u(2);break}}else if(eu.test(t.slice(r)))k=i(0);else break e;t.charCodeAt(r)===124&&t.charCodeAt(r+1)!==124&&(K=k,t.charCodeAt(r+1)===42?(k="*",r+=2):k=i(1)),n.push(k==="*"?{type:Ae.Universal,namespace:K}:{type:Ae.Tag,name:k,namespace:K})}}}return w(),r}var sE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function aE(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var xe={trueFunc:function(){return!0},falseFunc:function(){return!1}};const hc=new Map([[Ae.Universal,50],[Ae.Tag,30],[Ae.Attribute,1],[Ae.Pseudo,0]]);function Ca(e){return!hc.has(e.type)}const oE=new Map([[Ve.Exists,10],[Ve.Equals,8],[Ve.Not,7],[Ve.Start,6],[Ve.End,6],[Ve.Any,5]]);function uE(e){const t=e.map(gc);for(let r=1;r<e.length;r++){const n=t[r];if(!(n<0))for(let i=r-1;i>=0&&n<t[i];i--){const u=e[i+1];e[i+1]=e[i],e[i]=u,t[i+1]=t[i],t[i]=n}}}function gc(e){var t,r;let n=(t=hc.get(e.type))!==null&&t!==void 0?t:-1;return e.type===Ae.Attribute?(n=(r=oE.get(e.action))!==null&&r!==void 0?r:4,e.action===Ve.Equals&&e.name==="id"&&(n=9),e.ignoreCase&&(n>>=1)):e.type===Ae.Pseudo&&(e.data?e.name==="has"||e.name==="contains"?n=0:Array.isArray(e.data)?(n=Math.min(...e.data.map(i=>Math.min(...i.map(gc)))),n<0&&(n=0)):n=2:n=3),n}const lE=/[-[\]{}()*+?.,\\^$|#\s]/g;function ru(e){return e.replace(lE,"\\$&")}const cE=new Set(["accept","accept-charset","align","alink","axis","bgcolor","charset","checked","clear","codetype","color","compact","declare","defer","dir","direction","disabled","enctype","face","frame","hreflang","http-equiv","lang","language","link","media","method","multiple","nohref","noresize","noshade","nowrap","readonly","rel","rev","rules","scope","scrolling","selected","shape","target","text","type","valign","valuetype","vlink"]);function cr(e,t){return typeof e.ignoreCase=="boolean"?e.ignoreCase:e.ignoreCase==="quirks"?!!t.quirksMode:!t.xmlMode&&cE.has(e.name)}const fE={equals(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:u}=t;return cr(t,r)?(u=u.toLowerCase(),x=>{const b=n.getAttributeValue(x,i);return b!=null&&b.length===u.length&&b.toLowerCase()===u&&e(x)}):x=>n.getAttributeValue(x,i)===u&&e(x)},hyphen(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:u}=t;const x=u.length;return cr(t,r)?(u=u.toLowerCase(),function(s){const C=n.getAttributeValue(s,i);return C!=null&&(C.length===x||C.charAt(x)==="-")&&C.substr(0,x).toLowerCase()===u&&e(s)}):function(s){const C=n.getAttributeValue(s,i);return C!=null&&(C.length===x||C.charAt(x)==="-")&&C.substr(0,x)===u&&e(s)}},element(e,t,r){const{adapter:n}=r,{name:i,value:u}=t;if(/\s/.test(u))return xe.falseFunc;const x=new RegExp(`(?:^|\\s)${ru(u)}(?:$|\\s)`,cr(t,r)?"i":"");return function(s){const C=n.getAttributeValue(s,i);return C!=null&&C.length>=u.length&&x.test(C)&&e(s)}},exists(e,{name:t},{adapter:r}){return n=>r.hasAttrib(n,t)&&e(n)},start(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:u}=t;const x=u.length;return x===0?xe.falseFunc:cr(t,r)?(u=u.toLowerCase(),b=>{const s=n.getAttributeValue(b,i);return s!=null&&s.length>=x&&s.substr(0,x).toLowerCase()===u&&e(b)}):b=>{var s;return!!(!((s=n.getAttributeValue(b,i))===null||s===void 0)&&s.startsWith(u))&&e(b)}},end(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:u}=t;const x=-u.length;return x===0?xe.falseFunc:cr(t,r)?(u=u.toLowerCase(),b=>{var s;return((s=n.getAttributeValue(b,i))===null||s===void 0?void 0:s.substr(x).toLowerCase())===u&&e(b)}):b=>{var s;return!!(!((s=n.getAttributeValue(b,i))===null||s===void 0)&&s.endsWith(u))&&e(b)}},any(e,t,r){const{adapter:n}=r,{name:i,value:u}=t;if(u==="")return xe.falseFunc;if(cr(t,r)){const x=new RegExp(ru(u),"i");return function(s){const C=n.getAttributeValue(s,i);return C!=null&&C.length>=u.length&&x.test(C)&&e(s)}}return x=>{var b;return!!(!((b=n.getAttributeValue(x,i))===null||b===void 0)&&b.includes(u))&&e(x)}},not(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:u}=t;return u===""?x=>!!n.getAttributeValue(x,i)&&e(x):cr(t,r)?(u=u.toLowerCase(),x=>{const b=n.getAttributeValue(x,i);return(b==null||b.length!==u.length||b.toLowerCase()!==u)&&e(x)}):x=>n.getAttributeValue(x,i)!==u&&e(x)}},dE=new Set([9,10,12,13,32]),nu="0".charCodeAt(0),hE="9".charCodeAt(0);function gE(e){if(e=e.trim().toLowerCase(),e==="even")return[2,0];if(e==="odd")return[2,1];let t=0,r=0,n=u(),i=x();if(t<e.length&&e.charAt(t)==="n"&&(t++,r=n*(i??1),b(),t<e.length?(n=u(),b(),i=x()):n=i=0),i===null||t<e.length)throw new Error(`n-th rule couldn't be parsed ('${e}')`);return[r,n*i];function u(){return e.charAt(t)==="-"?(t++,-1):(e.charAt(t)==="+"&&t++,1)}function x(){const s=t;let C=0;for(;t<e.length&&e.charCodeAt(t)>=nu&&e.charCodeAt(t)<=hE;)C=C*10+(e.charCodeAt(t)-nu),t++;return t===s?null:C}function b(){for(;t<e.length&&dE.has(e.charCodeAt(t));)t++}}function mE(e){const t=e[0],r=e[1]-1;if(r<0&&t<=0)return xe.falseFunc;if(t===-1)return u=>u<=r;if(t===0)return u=>u===r;if(t===1)return r<0?xe.trueFunc:u=>u>=r;const n=Math.abs(t),i=(r%n+n)%n;return t>1?u=>u>=r&&u%n===i:u=>u<=r&&u%n===i}function jn(e){return mE(gE(e))}function Xn(e,t){return r=>{const n=t.getParent(r);return n!=null&&t.isTag(n)&&e(r)}}const Ws={contains(e,t,{adapter:r}){return function(i){return e(i)&&r.getText(i).includes(t)}},icontains(e,t,{adapter:r}){const n=t.toLowerCase();return function(u){return e(u)&&r.getText(u).toLowerCase().includes(n)}},"nth-child"(e,t,{adapter:r,equals:n}){const i=jn(t);return i===xe.falseFunc?xe.falseFunc:i===xe.trueFunc?Xn(e,r):function(x){const b=r.getSiblings(x);let s=0;for(let C=0;C<b.length&&!n(x,b[C]);C++)r.isTag(b[C])&&s++;return i(s)&&e(x)}},"nth-last-child"(e,t,{adapter:r,equals:n}){const i=jn(t);return i===xe.falseFunc?xe.falseFunc:i===xe.trueFunc?Xn(e,r):function(x){const b=r.getSiblings(x);let s=0;for(let C=b.length-1;C>=0&&!n(x,b[C]);C--)r.isTag(b[C])&&s++;return i(s)&&e(x)}},"nth-of-type"(e,t,{adapter:r,equals:n}){const i=jn(t);return i===xe.falseFunc?xe.falseFunc:i===xe.trueFunc?Xn(e,r):function(x){const b=r.getSiblings(x);let s=0;for(let C=0;C<b.length;C++){const g=b[C];if(n(x,g))break;r.isTag(g)&&r.getName(g)===r.getName(x)&&s++}return i(s)&&e(x)}},"nth-last-of-type"(e,t,{adapter:r,equals:n}){const i=jn(t);return i===xe.falseFunc?xe.falseFunc:i===xe.trueFunc?Xn(e,r):function(x){const b=r.getSiblings(x);let s=0;for(let C=b.length-1;C>=0;C--){const g=b[C];if(n(x,g))break;r.isTag(g)&&r.getName(g)===r.getName(x)&&s++}return i(s)&&e(x)}},root(e,t,{adapter:r}){return n=>{const i=r.getParent(n);return(i==null||!r.isTag(i))&&e(n)}},scope(e,t,r,n){const{equals:i}=r;return!n||n.length===0?Ws.root(e,t,r):n.length===1?u=>i(n[0],u)&&e(u):u=>n.includes(u)&&e(u)},hover:fs("isHovered"),visited:fs("isVisited"),active:fs("isActive")};function fs(e){return function(r,n,{adapter:i}){const u=i[e];return typeof u!="function"?xe.falseFunc:function(b){return u(b)&&r(b)}}}const iu={empty(e,{adapter:t}){return!t.getChildren(e).some(r=>t.isTag(r)||t.getText(r)!=="")},"first-child"(e,{adapter:t,equals:r}){if(t.prevElementSibling)return t.prevElementSibling(e)==null;const n=t.getSiblings(e).find(i=>t.isTag(i));return n!=null&&r(e,n)},"last-child"(e,{adapter:t,equals:r}){const n=t.getSiblings(e);for(let i=n.length-1;i>=0;i--){if(r(e,n[i]))return!0;if(t.isTag(n[i]))break}return!1},"first-of-type"(e,{adapter:t,equals:r}){const n=t.getSiblings(e),i=t.getName(e);for(let u=0;u<n.length;u++){const x=n[u];if(r(e,x))return!0;if(t.isTag(x)&&t.getName(x)===i)break}return!1},"last-of-type"(e,{adapter:t,equals:r}){const n=t.getSiblings(e),i=t.getName(e);for(let u=n.length-1;u>=0;u--){const x=n[u];if(r(e,x))return!0;if(t.isTag(x)&&t.getName(x)===i)break}return!1},"only-of-type"(e,{adapter:t,equals:r}){const n=t.getName(e);return t.getSiblings(e).every(i=>r(e,i)||!t.isTag(i)||t.getName(i)!==n)},"only-child"(e,{adapter:t,equals:r}){return t.getSiblings(e).every(n=>r(e,n)||!t.isTag(n))}};function su(e,t,r,n){if(r===null){if(e.length>n)throw new Error(`Pseudo-class :${t} requires an argument`)}else if(e.length===n)throw new Error(`Pseudo-class :${t} doesn't have any arguments`)}const EE={"any-link":":is(a, area, link)[href]",link:":any-link:not(:visited)",disabled:`:is(
        :is(button, input, select, textarea, optgroup, option)[disabled],
        optgroup[disabled] > option,
        fieldset[disabled]:not(fieldset[disabled] legend:first-of-type *)
    )`,enabled:":not(:disabled)",checked:":is(:is(input[type=radio], input[type=checkbox])[checked], option:selected)",required:":is(input, select, textarea)[required]",optional:":is(input, select, textarea):not([required])",selected:"option:is([selected], select:not([multiple]):not(:has(> option[selected])) > :first-of-type)",checkbox:"[type=checkbox]",file:"[type=file]",password:"[type=password]",radio:"[type=radio]",reset:"[type=reset]",image:"[type=image]",submit:"[type=submit]",parent:":not(:empty)",header:":is(h1, h2, h3, h4, h5, h6)",button:":is(button, input[type=button])",input:":is(input, textarea, select, button)",text:"input:is(:not([type!='']), [type=text])"},mc={};function vE(e,t){return e===xe.falseFunc?xe.falseFunc:r=>t.isTag(r)&&e(r)}function Ec(e,t){const r=t.getSiblings(e);if(r.length<=1)return[];const n=r.indexOf(e);return n<0||n===r.length-1?[]:r.slice(n+1).filter(t.isTag)}function Gs(e){return{xmlMode:!!e.xmlMode,lowerCaseAttributeNames:!!e.lowerCaseAttributeNames,lowerCaseTags:!!e.lowerCaseTags,quirksMode:!!e.quirksMode,cacheResults:!!e.cacheResults,pseudos:e.pseudos,adapter:e.adapter,equals:e.equals}}const ds=(e,t,r,n,i)=>{const u=i(t,Gs(r),n);return u===xe.trueFunc?e:u===xe.falseFunc?xe.falseFunc:x=>u(x)&&e(x)},hs={is:ds,matches:ds,where:ds,not(e,t,r,n,i){const u=i(t,Gs(r),n);return u===xe.falseFunc?e:u===xe.trueFunc?xe.falseFunc:x=>!u(x)&&e(x)},has(e,t,r,n,i){const{adapter:u}=r,x=Gs(r);x.relativeSelector=!0;const b=t.some(g=>g.some(Ca))?[mc]:void 0,s=i(t,x,b);if(s===xe.falseFunc)return xe.falseFunc;const C=vE(s,u);if(b&&s!==xe.trueFunc){const{shouldTestNextSiblings:g=!1}=s;return w=>{if(!e(w))return!1;b[0]=w;const R=u.getChildren(w),K=g?[...R,...Ec(w,u)]:R;return u.existsOne(C,K)}}return g=>e(g)&&u.existsOne(C,u.getChildren(g))}};function pE(e,t,r,n,i){var u;const{name:x,data:b}=t;if(Array.isArray(b)){if(!(x in hs))throw new Error(`Unknown pseudo-class :${x}(${b})`);return hs[x](e,b,r,n,i)}const s=(u=r.pseudos)===null||u===void 0?void 0:u[x],C=typeof s=="string"?s:EE[x];if(typeof C=="string"){if(b!=null)throw new Error(`Pseudo ${x} doesn't have any arguments`);const g=Wi(C);return hs.is(e,g,r,n,i)}if(typeof s=="function")return su(s,x,b,1),g=>s(g,b)&&e(g);if(x in Ws)return Ws[x](e,b,r,n);if(x in iu){const g=iu[x];return su(g,x,b,2),w=>g(w,r,b)&&e(w)}throw new Error(`Unknown pseudo-class :${x}`)}function gs(e,t){const r=t.getParent(e);return r&&t.isTag(r)?r:null}function TE(e,t,r,n,i){const{adapter:u,equals:x}=r;switch(t.type){case Ae.PseudoElement:throw new Error("Pseudo-elements are not supported by css-select");case Ae.ColumnCombinator:throw new Error("Column combinators are not yet supported by css-select");case Ae.Attribute:{if(t.namespace!=null)throw new Error("Namespaced attributes are not yet supported by css-select");return(!r.xmlMode||r.lowerCaseAttributeNames)&&(t.name=t.name.toLowerCase()),fE[t.action](e,t,r)}case Ae.Pseudo:return pE(e,t,r,n,i);case Ae.Tag:{if(t.namespace!=null)throw new Error("Namespaced tag names are not yet supported by css-select");let{name:b}=t;return(!r.xmlMode||r.lowerCaseTags)&&(b=b.toLowerCase()),function(C){return u.getName(C)===b&&e(C)}}case Ae.Descendant:{if(r.cacheResults===!1||typeof WeakSet>"u")return function(C){let g=C;for(;g=gs(g,u);)if(e(g))return!0;return!1};const b=new WeakSet;return function(C){let g=C;for(;g=gs(g,u);)if(!b.has(g)){if(u.isTag(g)&&e(g))return!0;b.add(g)}return!1}}case"_flexibleDescendant":return function(s){let C=s;do if(e(C))return!0;while(C=gs(C,u));return!1};case Ae.Parent:return function(s){return u.getChildren(s).some(C=>u.isTag(C)&&e(C))};case Ae.Child:return function(s){const C=u.getParent(s);return C!=null&&u.isTag(C)&&e(C)};case Ae.Sibling:return function(s){const C=u.getSiblings(s);for(let g=0;g<C.length;g++){const w=C[g];if(x(s,w))break;if(u.isTag(w)&&e(w))return!0}return!1};case Ae.Adjacent:return u.prevElementSibling?function(s){const C=u.prevElementSibling(s);return C!=null&&e(C)}:function(s){const C=u.getSiblings(s);let g;for(let w=0;w<C.length;w++){const R=C[w];if(x(s,R))break;u.isTag(R)&&(g=R)}return!!g&&e(g)};case Ae.Universal:{if(t.namespace!=null&&t.namespace!=="*")throw new Error("Namespaced universal selectors are not yet supported by css-select");return e}}}function vc(e){return e.type===Ae.Pseudo&&(e.name==="scope"||Array.isArray(e.data)&&e.data.some(t=>t.some(vc)))}const _E={type:Ae.Descendant},AE={type:"_flexibleDescendant"},yE={type:Ae.Pseudo,name:"scope",data:null};function bE(e,{adapter:t},r){const n=!!(r!=null&&r.every(i=>{const u=t.isTag(i)&&t.getParent(i);return i===mc||u&&t.isTag(u)}));for(const i of e){if(!(i.length>0&&Ca(i[0])&&i[0].type!==Ae.Descendant))if(n&&!i.some(vc))i.unshift(_E);else continue;i.unshift(yE)}}function pc(e,t,r){var n;e.forEach(uE),r=(n=t.context)!==null&&n!==void 0?n:r;const i=Array.isArray(r),u=r&&(Array.isArray(r)?r:[r]);if(t.relativeSelector!==!1)bE(e,t,u);else if(e.some(s=>s.length>0&&Ca(s[0])))throw new Error("Relative selectors are not allowed when the `relativeSelector` option is disabled");let x=!1;const b=e.map(s=>{if(s.length>=2){const[C,g]=s;C.type!==Ae.Pseudo||C.name!=="scope"||(i&&g.type===Ae.Descendant?s[1]=AE:(g.type===Ae.Adjacent||g.type===Ae.Sibling)&&(x=!0))}return SE(s,t,u)}).reduce(IE,xe.falseFunc);return b.shouldTestNextSiblings=x,b}function SE(e,t,r){var n;return e.reduce((i,u)=>i===xe.falseFunc?xe.falseFunc:TE(i,u,t,r,pc),(n=t.rootFunc)!==null&&n!==void 0?n:xe.trueFunc)}function IE(e,t){return t===xe.falseFunc||e===xe.trueFunc?e:e===xe.falseFunc||t===xe.trueFunc?t:function(n){return e(n)||t(n)}}const Tc=(e,t)=>e===t,xE={adapter:Ki,equals:Tc};function LE(e){var t,r,n,i;const u=e??xE;return(t=u.adapter)!==null&&t!==void 0||(u.adapter=Ki),(r=u.equals)!==null&&r!==void 0||(u.equals=(i=(n=u.adapter)===null||n===void 0?void 0:n.equals)!==null&&i!==void 0?i:Tc),u}function CE(e){return function(r,n,i){const u=LE(n);return e(r,u,i)}}const Da=CE(pc);function _c(e,t,r=!1){return r&&(e=DE(e,t)),Array.isArray(e)?t.removeSubsets(e):t.getChildren(e)}function DE(e,t){const r=Array.isArray(e)?e.slice(0):[e],n=r.length;for(let i=0;i<n;i++){const u=Ec(r[i],t);r.push(...u)}return r}const RE=new Set(["first","last","eq","gt","nth","lt","even","odd"]);function Ti(e){return e.type!=="pseudo"?!1:RE.has(e.name)?!0:e.name==="not"&&Array.isArray(e.data)?e.data.some(t=>t.some(Ti)):!1}function OE(e,t,r){const n=t!=null?parseInt(t,10):NaN;switch(e){case"first":return 1;case"nth":case"eq":return isFinite(n)?n>=0?n+1:1/0:0;case"lt":return isFinite(n)?n>=0?Math.min(n,r):1/0:0;case"gt":return isFinite(n)?1/0:0;case"odd":return 2*r;case"even":return 2*r-1;case"last":case"not":return 1/0}}function PE(e){for(;e.parent;)e=e.parent;return e}function Ra(e){const t=[],r=[];for(const n of e)n.some(Ti)?t.push(n):r.push(n);return[r,t]}const ME={type:Ae.Universal,namespace:null},NE={type:Ae.Pseudo,name:"scope",data:null};function Ac(e,t,r={}){return yc([e],t,r)}function yc(e,t,r={}){if(typeof t=="function")return e.some(t);const[n,i]=Ra(Wi(t));return n.length>0&&e.some(Da(n,r))||i.some(u=>Ic(u,e,r).length>0)}function FE(e,t,r,n){const i=typeof r=="string"?parseInt(r,10):NaN;switch(e){case"first":case"lt":return t;case"last":return t.length>0?[t[t.length-1]]:t;case"nth":case"eq":return isFinite(i)&&Math.abs(i)<t.length?[i<0?t[t.length+i]:t[i]]:[];case"gt":return isFinite(i)?t.slice(i+1):[];case"even":return t.filter((u,x)=>x%2===0);case"odd":return t.filter((u,x)=>x%2===1);case"not":{const u=new Set(Sc(r,t,n));return t.filter(x=>!u.has(x))}}}function bc(e,t,r={}){return Sc(Wi(e),t,r)}function Sc(e,t,r){if(t.length===0)return[];const[n,i]=Ra(e);let u;if(n.length){const x=Vs(t,n,r);if(i.length===0)return x;x.length&&(u=new Set(x))}for(let x=0;x<i.length&&(u==null?void 0:u.size)!==t.length;x++){const b=i[x];if((u?t.filter(g=>be(g)&&!u.has(g)):t).length===0)break;const C=Ic(b,t,r);if(C.length)if(u)C.forEach(g=>u.add(g));else{if(x===i.length-1)return C;u=new Set(C)}}return typeof u<"u"?u.size===t.length?t:t.filter(x=>u.has(x)):[]}function Ic(e,t,r){var n;if(e.some(hn)){const i=(n=r.root)!==null&&n!==void 0?n:PE(t[0]),u={...r,context:t,relativeSelector:!1};return e.push(NE),_i(i,e,u,!0,t.length)}return _i(t,e,r,!1,t.length)}function kE(e,t,r={},n=1/0){if(typeof e=="function")return xc(t,e);const[i,u]=Ra(Wi(e)),x=u.map(b=>_i(t,b,r,!0,n));return i.length&&x.push(Ys(t,i,r,n)),x.length===0?[]:x.length===1?x[0]:Jr(x.reduce((b,s)=>[...b,...s]))}function _i(e,t,r,n,i){const u=t.findIndex(Ti),x=t.slice(0,u),b=t[u],s=t.length-1===u?i:1/0,C=OE(b.name,b.data,s);if(C===0)return[];const w=(x.length===0&&!Array.isArray(e)?wi(e).filter(be):x.length===0?(Array.isArray(e)?e:[e]).filter(be):n||x.some(hn)?Ys(e,[x],r,C):Vs(e,[x],r)).slice(0,C);let R=FE(b.name,w,b.data,r);if(R.length===0||t.length===u+1)return R;const K=t.slice(u+1),k=K.some(hn);if(k){if(hn(K[0])){const{type:F}=K[0];(F===Ae.Sibling||F===Ae.Adjacent)&&(R=_c(R,Ki,!0)),K.unshift(ME)}r={...r,relativeSelector:!1,rootFunc:F=>R.includes(F)}}else r.rootFunc&&r.rootFunc!==xe.trueFunc&&(r={...r,rootFunc:xe.trueFunc});return K.some(Ti)?_i(R,K,r,!1,i):k?Ys(R,[K],r,i):Vs(R,[K],r)}function Ys(e,t,r,n){const i=Da(t,r,e);return xc(e,i,n)}function xc(e,t,r=1/0){const n=_c(e,Ki,t.shouldTestNextSiblings);return Hi(i=>be(i)&&t(i),n,!0,r)}function Vs(e,t,r){const n=(Array.isArray(e)?e:[e]).filter(be);if(n.length===0)return n;const i=Da(t,r);return i===xe.trueFunc?n:n.filter(i)}const BE=/^\s*[~+]/;function wE(e){var t;if(!e)return this._make([]);const r=this.toArray();if(typeof e!="string"){const u=wt(e)?e.toArray():[e];return this._make(u.filter(x=>r.some(b=>oc(b,x))))}const n=BE.test(e)?r:this.children().toArray(),i={context:r,root:(t=this._root)===null||t===void 0?void 0:t[0],xmlMode:this.options.xmlMode,lowerCaseTags:this.options.lowerCaseTags,lowerCaseAttributeNames:this.options.lowerCaseAttributeNames,pseudos:this.options.pseudos,quirksMode:this.options.quirksMode};return this._make(kE(e,n,i))}function Oa(e){return function(t,...r){return function(n){var i;let u=e(t,this);return n&&(u=Na(u,n,this.options.xmlMode,(i=this._root)===null||i===void 0?void 0:i[0])),this._make(this.length>1&&u.length>1?r.reduce((x,b)=>b(x),u):u)}}}const Mn=Oa((e,t)=>{const r=[];for(let n=0;n<t.length;n++){const i=e(t[n]);r.push(i)}return new Array().concat(...r)}),Pa=Oa((e,t)=>{const r=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i!==null&&r.push(i)}return r});function Ma(e,...t){let r=null;const n=Oa((i,u)=>{const x=[];return We(u,b=>{for(let s;(s=i(b))&&!(r!=null&&r(s,x.length));b=s)x.push(s)}),x})(e,...t);return function(i,u){r=typeof i=="string"?b=>Ac(b,i,this.options):i?Nn(i):null;const x=n.call(this,u);return r=null,x}}function Zr(e){return Array.from(new Set(e))}const UE=Pa(({parent:e})=>e&&!Sr(e)?e:null,Zr),HE=Mn(e=>{const t=[];for(;e.parent&&!Sr(e.parent);)t.push(e.parent),e=e.parent;return t},Jr,e=>e.reverse()),KE=Ma(({parent:e})=>e&&!Sr(e)?e:null,Jr,e=>e.reverse());function WE(e){var t;const r=[];if(!e)return this._make(r);const n={xmlMode:this.options.xmlMode,root:(t=this._root)===null||t===void 0?void 0:t[0]},i=typeof e=="string"?u=>Ac(u,e,n):Nn(e);return We(this,u=>{for(;u&&be(u);){if(i(u,0)){r.includes(u)||r.push(u);break}u=u.parent}}),this._make(r)}const GE=Pa(e=>Sa(e)),YE=Mn(e=>{const t=[];for(;e.next;)e=e.next,be(e)&&t.push(e);return t},Zr),VE=Ma(e=>Sa(e),Zr),jE=Pa(e=>Ia(e)),XE=Mn(e=>{const t=[];for(;e.prev;)e=e.prev,be(e)&&t.push(e);return t},Zr),$E=Ma(e=>Ia(e),Zr),QE=Mn(e=>ec(e).filter(t=>be(t)&&t!==e),Jr),zE=Mn(e=>wi(e).filter(be),Zr);function qE(){const e=this.toArray().reduce((t,r)=>Xe(r)?t.concat(r.children):t,[]);return this._make(e)}function JE(e){let t=0;const r=this.length;for(;t<r&&e.call(this[t],t,this[t])!==!1;)++t;return this}function ZE(e){let t=[];for(let r=0;r<this.length;r++){const n=this[r],i=e.call(n,r,n);i!=null&&(t=t.concat(i))}return this._make(t)}function Nn(e){return typeof e=="function"?(t,r)=>e.call(t,r,t):wt(e)?t=>Array.prototype.includes.call(e,t):function(t){return e===t}}function ev(e){var t;return this._make(Na(this.toArray(),e,this.options.xmlMode,(t=this._root)===null||t===void 0?void 0:t[0]))}function Na(e,t,r,n){return typeof t=="string"?bc(t,e,{xmlMode:r,root:n}):e.filter(Nn(t))}function tv(e){const t=this.toArray();return typeof e=="string"?yc(t.filter(be),e,this.options):e?t.some(Nn(e)):!1}function rv(e){let t=this.toArray();if(typeof e=="string"){const r=new Set(bc(e,t,this.options));t=t.filter(n=>!r.has(n))}else{const r=Nn(e);t=t.filter((n,i)=>!r(n,i))}return this._make(t)}function nv(e){return this.filter(typeof e=="string"?`:has(${e})`:(t,r)=>this._make(r).find(e).length>0)}function iv(){return this.length>1?this._make(this[0]):this}function sv(){return this.length>0?this._make(this[this.length-1]):this}function av(e){var t;return e=+e,e===0&&this.length<=1?this:(e<0&&(e=this.length+e),this._make((t=this[e])!==null&&t!==void 0?t:[]))}function ov(e){return e==null?this.toArray():this[e<0?this.length+e:e]}function uv(){return Array.prototype.slice.call(this)}function lv(e){let t,r;return e==null?(t=this.parent().children(),r=this[0]):typeof e=="string"?(t=this._make(e),r=this[0]):(t=this,r=wt(e)?e[0]:e),Array.prototype.indexOf.call(t,r)}function cv(e,t){return this._make(Array.prototype.slice.call(this,e,t))}function fv(){var e;return(e=this.prevObject)!==null&&e!==void 0?e:this._make([])}function dv(e,t){const r=this._make(e,t),n=Jr([...this.get(),...r.get()]);return this._make(n)}function hv(e){return this.prevObject?this.add(e?this.prevObject.filter(e):this.prevObject):this}const gv=Object.freeze(Object.defineProperty({__proto__:null,add:dv,addBack:hv,children:zE,closest:WE,contents:qE,each:JE,end:fv,eq:av,filter:ev,filterArray:Na,find:wE,first:iv,get:ov,has:nv,index:lv,is:tv,last:sv,map:ZE,next:GE,nextAll:YE,nextUntil:VE,not:rv,parent:UE,parents:HE,parentsUntil:KE,prev:jE,prevAll:XE,prevUntil:$E,siblings:QE,slice:cv,toArray:uv},Symbol.toStringTag,{value:"Module"}));function mv(e){return function(r,n,i,u){if(typeof Buffer<"u"&&Buffer.isBuffer(r)&&(r=r.toString()),typeof r=="string")return e(r,n,i,u);const x=r;if(!Array.isArray(x)&&Sr(x))return x;const b=new yr([]);return br(x,b),b}}function br(e,t){const r=Array.isArray(e)?e:[e];t?t.children=r:t=null;for(let n=0;n<r.length;n++){const i=r[n];i.parent&&i.parent.children!==r&&Ir(i),t?(i.prev=r[n-1]||null,i.next=r[n+1]||null):i.prev=i.next=null,i.parent=t}return t}function Ev(e,t){return e==null?[]:wt(e)?t?Hs(e.get()):e.get():Array.isArray(e)?e.reduce((r,n)=>r.concat(this._makeDomArray(n,t)),[]):typeof e=="string"?this._parse(e,this.options,!1,null).children:t?Hs([e]):[e]}function Lc(e){return function(...t){const r=this.length-1;return We(this,(n,i)=>{if(!Xe(n))return;const u=typeof t[0]=="function"?t[0].call(n,i,this._render(n.children)):t,x=this._makeDomArray(u,i<r);e(x,n.children,n)})}}function ar(e,t,r,n,i){var u,x;const b=[t,r,...n],s=t===0?null:e[t-1],C=t+r>=e.length?null:e[t+r];for(let g=0;g<n.length;++g){const w=n[g],R=w.parent;if(R){const k=R.children.indexOf(w);k>-1&&(R.children.splice(k,1),i===R&&t>k&&b[0]--)}w.parent=i,w.prev&&(w.prev.next=(u=w.next)!==null&&u!==void 0?u:null),w.next&&(w.next.prev=(x=w.prev)!==null&&x!==void 0?x:null),w.prev=g===0?s:n[g-1],w.next=g===n.length-1?C:n[g+1]}return s&&(s.next=n[0]),C&&(C.prev=n[n.length-1]),e.splice(...b)}function vv(e){return(wt(e)?e:this._make(e)).append(this),this}function pv(e){return(wt(e)?e:this._make(e)).prepend(this),this}const Tv=Lc((e,t,r)=>{ar(t,t.length,0,e,r)}),_v=Lc((e,t,r)=>{ar(t,0,0,e,r)});function Cc(e){return function(t){const r=this.length-1,n=this.parents().last();for(let i=0;i<this.length;i++){const u=this[i],x=typeof t=="function"?t.call(u,i,u):typeof t=="string"&&!Ks(t)?n.find(t).clone():t,[b]=this._makeDomArray(x,i<r);if(!b||!Xe(b))continue;let s=b,C=0;for(;C<s.children.length;){const g=s.children[C];be(g)?(s=g,C=0):C++}e(u,s,[b])}return this}}const Av=Cc((e,t,r)=>{const{parent:n}=e;if(!n)return;const i=n.children,u=i.indexOf(e);br([e],t),ar(i,u,0,r,n)}),yv=Cc((e,t,r)=>{Xe(e)&&(br(e.children,t),br(r,e))});function bv(e){return this.parent(e).not("body").each((t,r)=>{this._make(r).replaceWith(r.children)}),this}function Sv(e){const t=this[0];if(t){const r=this._make(typeof e=="function"?e.call(t,0,t):e).insertBefore(t);let n;for(let u=0;u<r.length;u++)r[u].type==="tag"&&(n=r[u]);let i=0;for(;n&&i<n.children.length;){const u=n.children[i];u.type==="tag"?(n=u,i=0):i++}n&&this._make(n).append(this)}return this}function Iv(...e){const t=this.length-1;return We(this,(r,n)=>{const{parent:i}=r;if(!Xe(r)||!i)return;const u=i.children,x=u.indexOf(r);if(x<0)return;const b=typeof e[0]=="function"?e[0].call(r,n,this._render(r.children)):e,s=this._makeDomArray(b,n<t);ar(u,x+1,0,s,i)})}function xv(e){typeof e=="string"&&(e=this._make(e)),this.remove();const t=[];return this._makeDomArray(e).forEach(r=>{const n=this.clone().toArray(),{parent:i}=r;if(!i)return;const u=i.children,x=u.indexOf(r);x<0||(ar(u,x+1,0,n,i),t.push(...n))}),this._make(t)}function Lv(...e){const t=this.length-1;return We(this,(r,n)=>{const{parent:i}=r;if(!Xe(r)||!i)return;const u=i.children,x=u.indexOf(r);if(x<0)return;const b=typeof e[0]=="function"?e[0].call(r,n,this._render(r.children)):e,s=this._makeDomArray(b,n<t);ar(u,x,0,s,i)})}function Cv(e){const t=this._make(e);this.remove();const r=[];return We(t,n=>{const i=this.clone().toArray(),{parent:u}=n;if(!u)return;const x=u.children,b=x.indexOf(n);b<0||(ar(x,b,0,i,u),r.push(...i))}),this._make(r)}function Dv(e){const t=e?this.filter(e):this;return We(t,r=>{Ir(r),r.prev=r.next=r.parent=null}),this}function Rv(e){return We(this,(t,r)=>{const{parent:n}=t;if(!n)return;const i=n.children,u=typeof e=="function"?e.call(t,r,t):e,x=this._makeDomArray(u);br(x,null);const b=i.indexOf(t);ar(i,b,1,x,n),x.includes(t)||(t.parent=t.prev=t.next=null)})}function Ov(){return We(this,e=>{Xe(e)&&(e.children.forEach(t=>{t.next=t.prev=t.parent=null}),e.children.length=0)})}function Pv(e){if(e===void 0){const t=this[0];return!t||!Xe(t)?null:this._render(t.children)}return We(this,t=>{if(!Xe(t))return;t.children.forEach(n=>{n.next=n.prev=n.parent=null});const r=wt(e)?e.toArray():this._parse(`${e}`,this.options,!1,t).children;br(r,t)})}function Mv(){return this._render(this)}function Nv(e){return e===void 0?Cn(this):typeof e=="function"?We(this,(t,r)=>this._make(t).text(e.call(t,r,Cn([t])))):We(this,t=>{if(!Xe(t))return;t.children.forEach(n=>{n.next=n.prev=n.parent=null});const r=new Ln(`${e}`);br(r,t)})}function Fv(){return this._make(Hs(this.get()))}const kv=Object.freeze(Object.defineProperty({__proto__:null,_makeDomArray:Ev,after:Iv,append:Tv,appendTo:vv,before:Lv,clone:Fv,empty:Ov,html:Pv,insertAfter:xv,insertBefore:Cv,prepend:_v,prependTo:pv,remove:Dv,replaceWith:Rv,text:Nv,toString:Mv,unwrap:bv,wrap:Av,wrapAll:Sv,wrapInner:yv},Symbol.toStringTag,{value:"Module"}));function Bv(e,t){if(e!=null&&t!=null||typeof e=="object"&&!Array.isArray(e))return We(this,(r,n)=>{be(r)&&Dc(r,e,t,n)});if(this.length!==0)return Rc(this[0],e)}function Dc(e,t,r,n){if(typeof t=="string"){const i=Rc(e),u=typeof r=="function"?r.call(e,n,i[t]):r;u===""?delete i[t]:u!=null&&(i[t]=u),e.attribs.style=wv(i)}else typeof t=="object"&&Object.keys(t).forEach((i,u)=>{Dc(e,i,t[i],u)})}function Rc(e,t){if(!e||!be(e))return;const r=Uv(e.attribs.style);if(typeof t=="string")return r[t];if(Array.isArray(t)){const n={};return t.forEach(i=>{r[i]!=null&&(n[i]=r[i])}),n}return r}function wv(e){return Object.keys(e).reduce((t,r)=>`${t}${t?" ":""}${r}: ${e[r]};`,"")}function Uv(e){if(e=(e||"").trim(),!e)return{};const t={};let r;for(const n of e.split(";")){const i=n.indexOf(":");if(i<1||i===n.length-1){const u=n.trimEnd();u.length>0&&r!==void 0&&(t[r]+=`;${u}`)}else r=n.slice(0,i).trim(),t[r]=n.slice(i+1).trim()}return t}const Hv=Object.freeze(Object.defineProperty({__proto__:null,css:Bv},Symbol.toStringTag,{value:"Module"})),au="input,select,textarea,keygen",Kv=/%20/g,ou=/\r?\n/g;function Wv(){return this.serializeArray().map(r=>`${encodeURIComponent(r.name)}=${encodeURIComponent(r.value)}`).join("&").replace(Kv,"+")}function Gv(){return this.map((e,t)=>{const r=this._make(t);return be(t)&&t.name==="form"?r.find(au).toArray():r.filter(au).toArray()}).filter('[name!=""]:enabled:not(:submit, :button, :image, :reset, :file):matches([checked], :not(:checkbox, :radio))').map((e,t)=>{var r;const n=this._make(t),i=n.attr("name"),u=(r=n.val())!==null&&r!==void 0?r:"";return Array.isArray(u)?u.map(x=>({name:i,value:x.replace(ou,`\r
`)})):{name:i,value:u.replace(ou,`\r
`)}}).toArray()}const Yv=Object.freeze(Object.defineProperty({__proto__:null,serialize:Wv,serializeArray:Gv},Symbol.toStringTag,{value:"Module"}));class Fn{constructor(t,r,n){if(this.length=0,this.options=n,this._root=r,t){for(let i=0;i<t.length;i++)this[i]=t[i];this.length=t.length}}}Fn.prototype.cheerio="[cheerio object]";Fn.prototype.splice=Array.prototype.splice;Fn.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator];Object.assign(Fn.prototype,Zm,gv,kv,Hv,Yv);function Vv(e,t){return function r(n,i,u=!0){if(n==null)throw new Error("cheerio.load() expects a string");const x={...pa,...ws(i)},b=e(n,x,u,null);class s extends Fn{_make(w,R){const K=C(w,R);return K.prevObject=this,K}_parse(w,R,K,k){return e(w,R,K,k)}_render(w){return t(w,this.options)}}function C(g,w,R=b,K){if(g&&wt(g))return g;const k={...x,...ws(K)},F=typeof R=="string"?[e(R,k,!1,null)]:"length"in R?R:[R],B=wt(F)?F:new s(F,null,k);if(B._root=B,!g)return new s(void 0,B,k);const P=typeof g=="string"&&Ks(g)?e(g,k,!1,null).children:jv(g)?[g]:Array.isArray(g)?g:void 0,M=new s(P,B,k);if(P)return M;if(typeof g!="string")throw new Error("Unexpected type of selector");let m=g;const N=w?typeof w=="string"?Ks(w)?new s([e(w,k,!1,null)],B,k):(m=`${w} ${m}`,B):wt(w)?w:new s(Array.isArray(w)?w:[w],B,k):B;return N?N.find(m):M}return Object.assign(C,Gm,{load:r,_root:b,_options:x,fn:s.prototype,prototype:s.prototype}),C}}function jv(e){return!!e.name||e.type==="root"||e.type==="text"||e.type==="comment"}const Xv=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),we="";var Q;(function(e){e[e.EOF=-1]="EOF",e[e.NULL=0]="NULL",e[e.TABULATION=9]="TABULATION",e[e.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",e[e.LINE_FEED=10]="LINE_FEED",e[e.FORM_FEED=12]="FORM_FEED",e[e.SPACE=32]="SPACE",e[e.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",e[e.QUOTATION_MARK=34]="QUOTATION_MARK",e[e.NUMBER_SIGN=35]="NUMBER_SIGN",e[e.AMPERSAND=38]="AMPERSAND",e[e.APOSTROPHE=39]="APOSTROPHE",e[e.HYPHEN_MINUS=45]="HYPHEN_MINUS",e[e.SOLIDUS=47]="SOLIDUS",e[e.DIGIT_0=48]="DIGIT_0",e[e.DIGIT_9=57]="DIGIT_9",e[e.SEMICOLON=59]="SEMICOLON",e[e.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",e[e.EQUALS_SIGN=61]="EQUALS_SIGN",e[e.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",e[e.LATIN_CAPITAL_F=70]="LATIN_CAPITAL_F",e[e.LATIN_CAPITAL_X=88]="LATIN_CAPITAL_X",e[e.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",e[e.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",e[e.GRAVE_ACCENT=96]="GRAVE_ACCENT",e[e.LATIN_SMALL_A=97]="LATIN_SMALL_A",e[e.LATIN_SMALL_F=102]="LATIN_SMALL_F",e[e.LATIN_SMALL_X=120]="LATIN_SMALL_X",e[e.LATIN_SMALL_Z=122]="LATIN_SMALL_Z",e[e.REPLACEMENT_CHARACTER=65533]="REPLACEMENT_CHARACTER"})(Q=Q||(Q={}));const nt={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function Oc(e){return e>=55296&&e<=57343}function $v(e){return e>=56320&&e<=57343}function Qv(e,t){return(e-55296)*1024+9216+t}function Pc(e){return e!==32&&e!==10&&e!==13&&e!==9&&e!==12&&e>=1&&e<=31||e>=127&&e<=159}function Mc(e){return e>=64976&&e<=65007||Xv.has(e)}var ue;(function(e){e.controlCharacterInInputStream="control-character-in-input-stream",e.noncharacterInInputStream="noncharacter-in-input-stream",e.surrogateInInputStream="surrogate-in-input-stream",e.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",e.endTagWithAttributes="end-tag-with-attributes",e.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",e.unexpectedSolidusInTag="unexpected-solidus-in-tag",e.unexpectedNullCharacter="unexpected-null-character",e.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",e.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",e.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",e.missingEndTagName="missing-end-tag-name",e.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",e.unknownNamedCharacterReference="unknown-named-character-reference",e.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",e.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",e.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",e.eofBeforeTagName="eof-before-tag-name",e.eofInTag="eof-in-tag",e.missingAttributeValue="missing-attribute-value",e.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",e.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",e.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",e.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",e.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",e.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",e.missingDoctypePublicIdentifier="missing-doctype-public-identifier",e.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",e.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",e.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",e.cdataInHtmlContent="cdata-in-html-content",e.incorrectlyOpenedComment="incorrectly-opened-comment",e.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",e.eofInDoctype="eof-in-doctype",e.nestedComment="nested-comment",e.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",e.eofInComment="eof-in-comment",e.incorrectlyClosedComment="incorrectly-closed-comment",e.eofInCdata="eof-in-cdata",e.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",e.nullCharacterReference="null-character-reference",e.surrogateCharacterReference="surrogate-character-reference",e.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",e.controlCharacterReference="control-character-reference",e.noncharacterCharacterReference="noncharacter-character-reference",e.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",e.missingDoctypeName="missing-doctype-name",e.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",e.duplicateAttribute="duplicate-attribute",e.nonConformingDoctype="non-conforming-doctype",e.missingDoctype="missing-doctype",e.misplacedDoctype="misplaced-doctype",e.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",e.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",e.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",e.openElementsLeftAfterEof="open-elements-left-after-eof",e.abandonedHeadElementChild="abandoned-head-element-child",e.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",e.nestedNoscriptInHead="nested-noscript-in-head",e.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(ue=ue||(ue={}));const zv=1<<16;class qv{constructor(t){this.handler=t,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=zv,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+Number(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(t){const{line:r,col:n,offset:i}=this;return{code:t,startLine:r,endLine:r,startCol:n,endCol:n,startOffset:i,endOffset:i}}_err(t){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(t)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(t){if(this.pos!==this.html.length-1){const r=this.html.charCodeAt(this.pos+1);if($v(r))return this.pos++,this._addGap(),Qv(t,r)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,Q.EOF;return this._err(ue.surrogateInInputStream),t}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(t,r){this.html.length>0?this.html+=t:this.html=t,this.endOfChunkHit=!1,this.lastChunkWritten=r}insertHtmlAtCurrentPos(t){this.html=this.html.substring(0,this.pos+1)+t+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(t,r){if(this.pos+t.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(r)return this.html.startsWith(t,this.pos);for(let n=0;n<t.length;n++)if((this.html.charCodeAt(this.pos+n)|32)!==t.charCodeAt(n))return!1;return!0}peek(t){const r=this.pos+t;if(r>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,Q.EOF;const n=this.html.charCodeAt(r);return n===Q.CARRIAGE_RETURN?Q.LINE_FEED:n}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,Q.EOF;let t=this.html.charCodeAt(this.pos);return t===Q.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,Q.LINE_FEED):t===Q.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,Oc(t)&&(t=this._processSurrogate(t)),this.handler.onParseError===null||t>31&&t<127||t===Q.LINE_FEED||t===Q.CARRIAGE_RETURN||t>159&&t<64976||this._checkForProblematicCharacters(t),t)}_checkForProblematicCharacters(t){Pc(t)?this._err(ue.controlCharacterInInputStream):Mc(t)&&this._err(ue.noncharacterInInputStream)}retreat(t){for(this.pos-=t;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var Ce;(function(e){e[e.CHARACTER=0]="CHARACTER",e[e.NULL_CHARACTER=1]="NULL_CHARACTER",e[e.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",e[e.START_TAG=3]="START_TAG",e[e.END_TAG=4]="END_TAG",e[e.COMMENT=5]="COMMENT",e[e.DOCTYPE=6]="DOCTYPE",e[e.EOF=7]="EOF",e[e.HIBERNATION=8]="HIBERNATION"})(Ce=Ce||(Ce={}));function Nc(e,t){for(let r=e.attrs.length-1;r>=0;r--)if(e.attrs[r].name===t)return e.attrs[r].value;return null}var ce;(function(e){e.HTML="http://www.w3.org/1999/xhtml",e.MATHML="http://www.w3.org/1998/Math/MathML",e.SVG="http://www.w3.org/2000/svg",e.XLINK="http://www.w3.org/1999/xlink",e.XML="http://www.w3.org/XML/1998/namespace",e.XMLNS="http://www.w3.org/2000/xmlns/"})(ce=ce||(ce={}));var nr;(function(e){e.TYPE="type",e.ACTION="action",e.ENCODING="encoding",e.PROMPT="prompt",e.NAME="name",e.COLOR="color",e.FACE="face",e.SIZE="size"})(nr=nr||(nr={}));var ot;(function(e){e.NO_QUIRKS="no-quirks",e.QUIRKS="quirks",e.LIMITED_QUIRKS="limited-quirks"})(ot=ot||(ot={}));var se;(function(e){e.A="a",e.ADDRESS="address",e.ANNOTATION_XML="annotation-xml",e.APPLET="applet",e.AREA="area",e.ARTICLE="article",e.ASIDE="aside",e.B="b",e.BASE="base",e.BASEFONT="basefont",e.BGSOUND="bgsound",e.BIG="big",e.BLOCKQUOTE="blockquote",e.BODY="body",e.BR="br",e.BUTTON="button",e.CAPTION="caption",e.CENTER="center",e.CODE="code",e.COL="col",e.COLGROUP="colgroup",e.DD="dd",e.DESC="desc",e.DETAILS="details",e.DIALOG="dialog",e.DIR="dir",e.DIV="div",e.DL="dl",e.DT="dt",e.EM="em",e.EMBED="embed",e.FIELDSET="fieldset",e.FIGCAPTION="figcaption",e.FIGURE="figure",e.FONT="font",e.FOOTER="footer",e.FOREIGN_OBJECT="foreignObject",e.FORM="form",e.FRAME="frame",e.FRAMESET="frameset",e.H1="h1",e.H2="h2",e.H3="h3",e.H4="h4",e.H5="h5",e.H6="h6",e.HEAD="head",e.HEADER="header",e.HGROUP="hgroup",e.HR="hr",e.HTML="html",e.I="i",e.IMG="img",e.IMAGE="image",e.INPUT="input",e.IFRAME="iframe",e.KEYGEN="keygen",e.LABEL="label",e.LI="li",e.LINK="link",e.LISTING="listing",e.MAIN="main",e.MALIGNMARK="malignmark",e.MARQUEE="marquee",e.MATH="math",e.MENU="menu",e.META="meta",e.MGLYPH="mglyph",e.MI="mi",e.MO="mo",e.MN="mn",e.MS="ms",e.MTEXT="mtext",e.NAV="nav",e.NOBR="nobr",e.NOFRAMES="noframes",e.NOEMBED="noembed",e.NOSCRIPT="noscript",e.OBJECT="object",e.OL="ol",e.OPTGROUP="optgroup",e.OPTION="option",e.P="p",e.PARAM="param",e.PLAINTEXT="plaintext",e.PRE="pre",e.RB="rb",e.RP="rp",e.RT="rt",e.RTC="rtc",e.RUBY="ruby",e.S="s",e.SCRIPT="script",e.SECTION="section",e.SELECT="select",e.SOURCE="source",e.SMALL="small",e.SPAN="span",e.STRIKE="strike",e.STRONG="strong",e.STYLE="style",e.SUB="sub",e.SUMMARY="summary",e.SUP="sup",e.TABLE="table",e.TBODY="tbody",e.TEMPLATE="template",e.TEXTAREA="textarea",e.TFOOT="tfoot",e.TD="td",e.TH="th",e.THEAD="thead",e.TITLE="title",e.TR="tr",e.TRACK="track",e.TT="tt",e.U="u",e.UL="ul",e.SVG="svg",e.VAR="var",e.WBR="wbr",e.XMP="xmp"})(se=se||(se={}));var D;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.A=1]="A",e[e.ADDRESS=2]="ADDRESS",e[e.ANNOTATION_XML=3]="ANNOTATION_XML",e[e.APPLET=4]="APPLET",e[e.AREA=5]="AREA",e[e.ARTICLE=6]="ARTICLE",e[e.ASIDE=7]="ASIDE",e[e.B=8]="B",e[e.BASE=9]="BASE",e[e.BASEFONT=10]="BASEFONT",e[e.BGSOUND=11]="BGSOUND",e[e.BIG=12]="BIG",e[e.BLOCKQUOTE=13]="BLOCKQUOTE",e[e.BODY=14]="BODY",e[e.BR=15]="BR",e[e.BUTTON=16]="BUTTON",e[e.CAPTION=17]="CAPTION",e[e.CENTER=18]="CENTER",e[e.CODE=19]="CODE",e[e.COL=20]="COL",e[e.COLGROUP=21]="COLGROUP",e[e.DD=22]="DD",e[e.DESC=23]="DESC",e[e.DETAILS=24]="DETAILS",e[e.DIALOG=25]="DIALOG",e[e.DIR=26]="DIR",e[e.DIV=27]="DIV",e[e.DL=28]="DL",e[e.DT=29]="DT",e[e.EM=30]="EM",e[e.EMBED=31]="EMBED",e[e.FIELDSET=32]="FIELDSET",e[e.FIGCAPTION=33]="FIGCAPTION",e[e.FIGURE=34]="FIGURE",e[e.FONT=35]="FONT",e[e.FOOTER=36]="FOOTER",e[e.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",e[e.FORM=38]="FORM",e[e.FRAME=39]="FRAME",e[e.FRAMESET=40]="FRAMESET",e[e.H1=41]="H1",e[e.H2=42]="H2",e[e.H3=43]="H3",e[e.H4=44]="H4",e[e.H5=45]="H5",e[e.H6=46]="H6",e[e.HEAD=47]="HEAD",e[e.HEADER=48]="HEADER",e[e.HGROUP=49]="HGROUP",e[e.HR=50]="HR",e[e.HTML=51]="HTML",e[e.I=52]="I",e[e.IMG=53]="IMG",e[e.IMAGE=54]="IMAGE",e[e.INPUT=55]="INPUT",e[e.IFRAME=56]="IFRAME",e[e.KEYGEN=57]="KEYGEN",e[e.LABEL=58]="LABEL",e[e.LI=59]="LI",e[e.LINK=60]="LINK",e[e.LISTING=61]="LISTING",e[e.MAIN=62]="MAIN",e[e.MALIGNMARK=63]="MALIGNMARK",e[e.MARQUEE=64]="MARQUEE",e[e.MATH=65]="MATH",e[e.MENU=66]="MENU",e[e.META=67]="META",e[e.MGLYPH=68]="MGLYPH",e[e.MI=69]="MI",e[e.MO=70]="MO",e[e.MN=71]="MN",e[e.MS=72]="MS",e[e.MTEXT=73]="MTEXT",e[e.NAV=74]="NAV",e[e.NOBR=75]="NOBR",e[e.NOFRAMES=76]="NOFRAMES",e[e.NOEMBED=77]="NOEMBED",e[e.NOSCRIPT=78]="NOSCRIPT",e[e.OBJECT=79]="OBJECT",e[e.OL=80]="OL",e[e.OPTGROUP=81]="OPTGROUP",e[e.OPTION=82]="OPTION",e[e.P=83]="P",e[e.PARAM=84]="PARAM",e[e.PLAINTEXT=85]="PLAINTEXT",e[e.PRE=86]="PRE",e[e.RB=87]="RB",e[e.RP=88]="RP",e[e.RT=89]="RT",e[e.RTC=90]="RTC",e[e.RUBY=91]="RUBY",e[e.S=92]="S",e[e.SCRIPT=93]="SCRIPT",e[e.SECTION=94]="SECTION",e[e.SELECT=95]="SELECT",e[e.SOURCE=96]="SOURCE",e[e.SMALL=97]="SMALL",e[e.SPAN=98]="SPAN",e[e.STRIKE=99]="STRIKE",e[e.STRONG=100]="STRONG",e[e.STYLE=101]="STYLE",e[e.SUB=102]="SUB",e[e.SUMMARY=103]="SUMMARY",e[e.SUP=104]="SUP",e[e.TABLE=105]="TABLE",e[e.TBODY=106]="TBODY",e[e.TEMPLATE=107]="TEMPLATE",e[e.TEXTAREA=108]="TEXTAREA",e[e.TFOOT=109]="TFOOT",e[e.TD=110]="TD",e[e.TH=111]="TH",e[e.THEAD=112]="THEAD",e[e.TITLE=113]="TITLE",e[e.TR=114]="TR",e[e.TRACK=115]="TRACK",e[e.TT=116]="TT",e[e.U=117]="U",e[e.UL=118]="UL",e[e.SVG=119]="SVG",e[e.VAR=120]="VAR",e[e.WBR=121]="WBR",e[e.XMP=122]="XMP"})(D=D||(D={}));const Jv=new Map([[se.A,D.A],[se.ADDRESS,D.ADDRESS],[se.ANNOTATION_XML,D.ANNOTATION_XML],[se.APPLET,D.APPLET],[se.AREA,D.AREA],[se.ARTICLE,D.ARTICLE],[se.ASIDE,D.ASIDE],[se.B,D.B],[se.BASE,D.BASE],[se.BASEFONT,D.BASEFONT],[se.BGSOUND,D.BGSOUND],[se.BIG,D.BIG],[se.BLOCKQUOTE,D.BLOCKQUOTE],[se.BODY,D.BODY],[se.BR,D.BR],[se.BUTTON,D.BUTTON],[se.CAPTION,D.CAPTION],[se.CENTER,D.CENTER],[se.CODE,D.CODE],[se.COL,D.COL],[se.COLGROUP,D.COLGROUP],[se.DD,D.DD],[se.DESC,D.DESC],[se.DETAILS,D.DETAILS],[se.DIALOG,D.DIALOG],[se.DIR,D.DIR],[se.DIV,D.DIV],[se.DL,D.DL],[se.DT,D.DT],[se.EM,D.EM],[se.EMBED,D.EMBED],[se.FIELDSET,D.FIELDSET],[se.FIGCAPTION,D.FIGCAPTION],[se.FIGURE,D.FIGURE],[se.FONT,D.FONT],[se.FOOTER,D.FOOTER],[se.FOREIGN_OBJECT,D.FOREIGN_OBJECT],[se.FORM,D.FORM],[se.FRAME,D.FRAME],[se.FRAMESET,D.FRAMESET],[se.H1,D.H1],[se.H2,D.H2],[se.H3,D.H3],[se.H4,D.H4],[se.H5,D.H5],[se.H6,D.H6],[se.HEAD,D.HEAD],[se.HEADER,D.HEADER],[se.HGROUP,D.HGROUP],[se.HR,D.HR],[se.HTML,D.HTML],[se.I,D.I],[se.IMG,D.IMG],[se.IMAGE,D.IMAGE],[se.INPUT,D.INPUT],[se.IFRAME,D.IFRAME],[se.KEYGEN,D.KEYGEN],[se.LABEL,D.LABEL],[se.LI,D.LI],[se.LINK,D.LINK],[se.LISTING,D.LISTING],[se.MAIN,D.MAIN],[se.MALIGNMARK,D.MALIGNMARK],[se.MARQUEE,D.MARQUEE],[se.MATH,D.MATH],[se.MENU,D.MENU],[se.META,D.META],[se.MGLYPH,D.MGLYPH],[se.MI,D.MI],[se.MO,D.MO],[se.MN,D.MN],[se.MS,D.MS],[se.MTEXT,D.MTEXT],[se.NAV,D.NAV],[se.NOBR,D.NOBR],[se.NOFRAMES,D.NOFRAMES],[se.NOEMBED,D.NOEMBED],[se.NOSCRIPT,D.NOSCRIPT],[se.OBJECT,D.OBJECT],[se.OL,D.OL],[se.OPTGROUP,D.OPTGROUP],[se.OPTION,D.OPTION],[se.P,D.P],[se.PARAM,D.PARAM],[se.PLAINTEXT,D.PLAINTEXT],[se.PRE,D.PRE],[se.RB,D.RB],[se.RP,D.RP],[se.RT,D.RT],[se.RTC,D.RTC],[se.RUBY,D.RUBY],[se.S,D.S],[se.SCRIPT,D.SCRIPT],[se.SECTION,D.SECTION],[se.SELECT,D.SELECT],[se.SOURCE,D.SOURCE],[se.SMALL,D.SMALL],[se.SPAN,D.SPAN],[se.STRIKE,D.STRIKE],[se.STRONG,D.STRONG],[se.STYLE,D.STYLE],[se.SUB,D.SUB],[se.SUMMARY,D.SUMMARY],[se.SUP,D.SUP],[se.TABLE,D.TABLE],[se.TBODY,D.TBODY],[se.TEMPLATE,D.TEMPLATE],[se.TEXTAREA,D.TEXTAREA],[se.TFOOT,D.TFOOT],[se.TD,D.TD],[se.TH,D.TH],[se.THEAD,D.THEAD],[se.TITLE,D.TITLE],[se.TR,D.TR],[se.TRACK,D.TRACK],[se.TT,D.TT],[se.U,D.U],[se.UL,D.UL],[se.SVG,D.SVG],[se.VAR,D.VAR],[se.WBR,D.WBR],[se.XMP,D.XMP]]);function Gi(e){var t;return(t=Jv.get(e))!==null&&t!==void 0?t:D.UNKNOWN}const de=D,Zv={[ce.HTML]:new Set([de.ADDRESS,de.APPLET,de.AREA,de.ARTICLE,de.ASIDE,de.BASE,de.BASEFONT,de.BGSOUND,de.BLOCKQUOTE,de.BODY,de.BR,de.BUTTON,de.CAPTION,de.CENTER,de.COL,de.COLGROUP,de.DD,de.DETAILS,de.DIR,de.DIV,de.DL,de.DT,de.EMBED,de.FIELDSET,de.FIGCAPTION,de.FIGURE,de.FOOTER,de.FORM,de.FRAME,de.FRAMESET,de.H1,de.H2,de.H3,de.H4,de.H5,de.H6,de.HEAD,de.HEADER,de.HGROUP,de.HR,de.HTML,de.IFRAME,de.IMG,de.INPUT,de.LI,de.LINK,de.LISTING,de.MAIN,de.MARQUEE,de.MENU,de.META,de.NAV,de.NOEMBED,de.NOFRAMES,de.NOSCRIPT,de.OBJECT,de.OL,de.P,de.PARAM,de.PLAINTEXT,de.PRE,de.SCRIPT,de.SECTION,de.SELECT,de.SOURCE,de.STYLE,de.SUMMARY,de.TABLE,de.TBODY,de.TD,de.TEMPLATE,de.TEXTAREA,de.TFOOT,de.TH,de.THEAD,de.TITLE,de.TR,de.TRACK,de.UL,de.WBR,de.XMP]),[ce.MATHML]:new Set([de.MI,de.MO,de.MN,de.MS,de.MTEXT,de.ANNOTATION_XML]),[ce.SVG]:new Set([de.TITLE,de.FOREIGN_OBJECT,de.DESC]),[ce.XLINK]:new Set,[ce.XML]:new Set,[ce.XMLNS]:new Set};function Fc(e){return e===de.H1||e===de.H2||e===de.H3||e===de.H4||e===de.H5||e===de.H6}const ep=new Set([se.STYLE,se.SCRIPT,se.XMP,se.IFRAME,se.NOEMBED,se.NOFRAMES,se.PLAINTEXT]);function tp(e,t){return ep.has(e)||t&&e===se.NOSCRIPT}const rp=new Map([[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);var z;(function(e){e[e.DATA=0]="DATA",e[e.RCDATA=1]="RCDATA",e[e.RAWTEXT=2]="RAWTEXT",e[e.SCRIPT_DATA=3]="SCRIPT_DATA",e[e.PLAINTEXT=4]="PLAINTEXT",e[e.TAG_OPEN=5]="TAG_OPEN",e[e.END_TAG_OPEN=6]="END_TAG_OPEN",e[e.TAG_NAME=7]="TAG_NAME",e[e.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",e[e.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",e[e.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",e[e.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",e[e.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",e[e.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",e[e.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",e[e.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",e[e.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",e[e.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",e[e.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",e[e.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",e[e.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",e[e.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",e[e.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",e[e.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",e[e.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",e[e.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",e[e.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",e[e.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",e[e.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",e[e.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",e[e.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",e[e.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",e[e.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",e[e.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",e[e.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",e[e.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",e[e.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",e[e.BOGUS_COMMENT=40]="BOGUS_COMMENT",e[e.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",e[e.COMMENT_START=42]="COMMENT_START",e[e.COMMENT_START_DASH=43]="COMMENT_START_DASH",e[e.COMMENT=44]="COMMENT",e[e.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",e[e.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",e[e.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",e[e.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",e[e.COMMENT_END_DASH=49]="COMMENT_END_DASH",e[e.COMMENT_END=50]="COMMENT_END",e[e.COMMENT_END_BANG=51]="COMMENT_END_BANG",e[e.DOCTYPE=52]="DOCTYPE",e[e.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",e[e.DOCTYPE_NAME=54]="DOCTYPE_NAME",e[e.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",e[e.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",e[e.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",e[e.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",e[e.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",e[e.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",e[e.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",e[e.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",e[e.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",e[e.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",e[e.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",e[e.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",e[e.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",e[e.CDATA_SECTION=68]="CDATA_SECTION",e[e.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",e[e.CDATA_SECTION_END=70]="CDATA_SECTION_END",e[e.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",e[e.NAMED_CHARACTER_REFERENCE=72]="NAMED_CHARACTER_REFERENCE",e[e.AMBIGUOUS_AMPERSAND=73]="AMBIGUOUS_AMPERSAND",e[e.NUMERIC_CHARACTER_REFERENCE=74]="NUMERIC_CHARACTER_REFERENCE",e[e.HEXADEMICAL_CHARACTER_REFERENCE_START=75]="HEXADEMICAL_CHARACTER_REFERENCE_START",e[e.HEXADEMICAL_CHARACTER_REFERENCE=76]="HEXADEMICAL_CHARACTER_REFERENCE",e[e.DECIMAL_CHARACTER_REFERENCE=77]="DECIMAL_CHARACTER_REFERENCE",e[e.NUMERIC_CHARACTER_REFERENCE_END=78]="NUMERIC_CHARACTER_REFERENCE_END"})(z||(z={}));const ut={DATA:z.DATA,RCDATA:z.RCDATA,RAWTEXT:z.RAWTEXT,SCRIPT_DATA:z.SCRIPT_DATA,PLAINTEXT:z.PLAINTEXT,CDATA_SECTION:z.CDATA_SECTION};function gn(e){return e>=Q.DIGIT_0&&e<=Q.DIGIT_9}function on(e){return e>=Q.LATIN_CAPITAL_A&&e<=Q.LATIN_CAPITAL_Z}function np(e){return e>=Q.LATIN_SMALL_A&&e<=Q.LATIN_SMALL_Z}function Jt(e){return np(e)||on(e)}function js(e){return Jt(e)||gn(e)}function kc(e){return e>=Q.LATIN_CAPITAL_A&&e<=Q.LATIN_CAPITAL_F}function Bc(e){return e>=Q.LATIN_SMALL_A&&e<=Q.LATIN_SMALL_F}function ip(e){return gn(e)||kc(e)||Bc(e)}function $n(e){return e+32}function wc(e){return e===Q.SPACE||e===Q.LINE_FEED||e===Q.TABULATION||e===Q.FORM_FEED}function sp(e){return e===Q.EQUALS_SIGN||js(e)}function uu(e){return wc(e)||e===Q.SOLIDUS||e===Q.GREATER_THAN_SIGN}let ap=class{constructor(t,r){this.options=t,this.handler=r,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=z.DATA,this.returnState=z.DATA,this.charRefCode=-1,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new qv(r),this.currentLocation=this.getCurrentLocation(-1)}_err(t){var r,n;(n=(r=this.handler).onParseError)===null||n===void 0||n.call(r,this.preprocessor.getError(t))}getCurrentLocation(t){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-t,startOffset:this.preprocessor.offset-t,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const t=this._consume();this._ensureHibernation()||this._callState(t)}this.inLoop=!1}}pause(){this.paused=!0}resume(t){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||t==null||t())}write(t,r,n){this.active=!0,this.preprocessor.write(t,r),this._runParsingLoop(),this.paused||n==null||n()}insertHtmlAtCurrentPos(t){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(t),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this._unconsume(this.consumedAfterSnapshot),this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_unconsume(t){this.consumedAfterSnapshot-=t,this.preprocessor.retreat(t)}_reconsumeInState(t,r){this.state=t,this._callState(r)}_advanceBy(t){this.consumedAfterSnapshot+=t;for(let r=0;r<t;r++)this.preprocessor.advance()}_consumeSequenceIfMatch(t,r){return this.preprocessor.startsWith(t,r)?(this._advanceBy(t.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:Ce.START_TAG,tagName:"",tagID:D.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:Ce.END_TAG,tagName:"",tagID:D.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(t){this.currentToken={type:Ce.COMMENT,data:"",location:this.getCurrentLocation(t)}}_createDoctypeToken(t){this.currentToken={type:Ce.DOCTYPE,name:t,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(t,r){this.currentCharacterToken={type:t,chars:r,location:this.currentLocation}}_createAttr(t){this.currentAttr={name:t,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var t,r;const n=this.currentToken;if(Nc(n,this.currentAttr.name)===null){if(n.attrs.push(this.currentAttr),n.location&&this.currentLocation){const i=(t=(r=n.location).attrs)!==null&&t!==void 0?t:r.attrs=Object.create(null);i[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(ue.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(t){this._emitCurrentCharacterToken(t.location),this.currentToken=null,t.location&&(t.location.endLine=this.preprocessor.line,t.location.endCol=this.preprocessor.col+1,t.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const t=this.currentToken;this.prepareToken(t),t.tagID=Gi(t.tagName),t.type===Ce.START_TAG?(this.lastStartTagName=t.tagName,this.handler.onStartTag(t)):(t.attrs.length>0&&this._err(ue.endTagWithAttributes),t.selfClosing&&this._err(ue.endTagWithTrailingSolidus),this.handler.onEndTag(t)),this.preprocessor.dropParsedChunk()}emitCurrentComment(t){this.prepareToken(t),this.handler.onComment(t),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(t){this.prepareToken(t),this.handler.onDoctype(t),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(t){if(this.currentCharacterToken){switch(t&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=t.startLine,this.currentCharacterToken.location.endCol=t.startCol,this.currentCharacterToken.location.endOffset=t.startOffset),this.currentCharacterToken.type){case Ce.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case Ce.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case Ce.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const t=this.getCurrentLocation(0);t&&(t.endLine=t.startLine,t.endCol=t.startCol,t.endOffset=t.startOffset),this._emitCurrentCharacterToken(t),this.handler.onEof({type:Ce.EOF,location:t}),this.active=!1}_appendCharToCurrentCharacterToken(t,r){if(this.currentCharacterToken)if(this.currentCharacterToken.type!==t)this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();else{this.currentCharacterToken.chars+=r;return}this._createCharacterToken(t,r)}_emitCodePoint(t){const r=wc(t)?Ce.WHITESPACE_CHARACTER:t===Q.NULL?Ce.NULL_CHARACTER:Ce.CHARACTER;this._appendCharToCurrentCharacterToken(r,String.fromCodePoint(t))}_emitChars(t){this._appendCharToCurrentCharacterToken(Ce.CHARACTER,t)}_matchNamedCharacterReference(t){let r=null,n=0,i=!1;for(let u=0,x=qt[0];u>=0&&(u=Xl(qt,x,u+1,t),!(u<0));t=this._consume()){n+=1,x=qt[u];const b=x&Vt.VALUE_LENGTH;if(b){const s=(b>>14)-1;if(t!==Q.SEMICOLON&&this._isCharacterReferenceInAttribute()&&sp(this.preprocessor.peek(1))?(r=[Q.AMPERSAND],u+=s):(r=s===0?[qt[u]&~Vt.VALUE_LENGTH]:s===1?[qt[++u]]:[qt[++u],qt[++u]],n=0,i=t!==Q.SEMICOLON),s===0){this._consume();break}}}return this._unconsume(n),i&&!this.preprocessor.endOfChunkHit&&this._err(ue.missingSemicolonAfterCharacterReference),this._unconsume(1),r}_isCharacterReferenceInAttribute(){return this.returnState===z.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===z.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===z.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(t){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(t):this._emitCodePoint(t)}_callState(t){switch(this.state){case z.DATA:{this._stateData(t);break}case z.RCDATA:{this._stateRcdata(t);break}case z.RAWTEXT:{this._stateRawtext(t);break}case z.SCRIPT_DATA:{this._stateScriptData(t);break}case z.PLAINTEXT:{this._statePlaintext(t);break}case z.TAG_OPEN:{this._stateTagOpen(t);break}case z.END_TAG_OPEN:{this._stateEndTagOpen(t);break}case z.TAG_NAME:{this._stateTagName(t);break}case z.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(t);break}case z.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(t);break}case z.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(t);break}case z.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(t);break}case z.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(t);break}case z.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(t);break}case z.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(t);break}case z.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(t);break}case z.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(t);break}case z.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(t);break}case z.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(t);break}case z.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(t);break}case z.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(t);break}case z.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(t);break}case z.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(t);break}case z.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(t);break}case z.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(t);break}case z.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(t);break}case z.ATTRIBUTE_NAME:{this._stateAttributeName(t);break}case z.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(t);break}case z.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(t);break}case z.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(t);break}case z.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(t);break}case z.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(t);break}case z.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(t);break}case z.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(t);break}case z.BOGUS_COMMENT:{this._stateBogusComment(t);break}case z.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(t);break}case z.COMMENT_START:{this._stateCommentStart(t);break}case z.COMMENT_START_DASH:{this._stateCommentStartDash(t);break}case z.COMMENT:{this._stateComment(t);break}case z.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(t);break}case z.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(t);break}case z.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(t);break}case z.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(t);break}case z.COMMENT_END_DASH:{this._stateCommentEndDash(t);break}case z.COMMENT_END:{this._stateCommentEnd(t);break}case z.COMMENT_END_BANG:{this._stateCommentEndBang(t);break}case z.DOCTYPE:{this._stateDoctype(t);break}case z.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(t);break}case z.DOCTYPE_NAME:{this._stateDoctypeName(t);break}case z.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(t);break}case z.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(t);break}case z.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(t);break}case z.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(t);break}case z.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(t);break}case z.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(t);break}case z.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(t);break}case z.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(t);break}case z.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(t);break}case z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(t);break}case z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(t);break}case z.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(t);break}case z.BOGUS_DOCTYPE:{this._stateBogusDoctype(t);break}case z.CDATA_SECTION:{this._stateCdataSection(t);break}case z.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(t);break}case z.CDATA_SECTION_END:{this._stateCdataSectionEnd(t);break}case z.CHARACTER_REFERENCE:{this._stateCharacterReference(t);break}case z.NAMED_CHARACTER_REFERENCE:{this._stateNamedCharacterReference(t);break}case z.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(t);break}case z.NUMERIC_CHARACTER_REFERENCE:{this._stateNumericCharacterReference(t);break}case z.HEXADEMICAL_CHARACTER_REFERENCE_START:{this._stateHexademicalCharacterReferenceStart(t);break}case z.HEXADEMICAL_CHARACTER_REFERENCE:{this._stateHexademicalCharacterReference(t);break}case z.DECIMAL_CHARACTER_REFERENCE:{this._stateDecimalCharacterReference(t);break}case z.NUMERIC_CHARACTER_REFERENCE_END:{this._stateNumericCharacterReferenceEnd(t);break}default:throw new Error("Unknown state")}}_stateData(t){switch(t){case Q.LESS_THAN_SIGN:{this.state=z.TAG_OPEN;break}case Q.AMPERSAND:{this.returnState=z.DATA,this.state=z.CHARACTER_REFERENCE;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this._emitCodePoint(t);break}case Q.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateRcdata(t){switch(t){case Q.AMPERSAND:{this.returnState=z.RCDATA,this.state=z.CHARACTER_REFERENCE;break}case Q.LESS_THAN_SIGN:{this.state=z.RCDATA_LESS_THAN_SIGN;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this._emitChars(we);break}case Q.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateRawtext(t){switch(t){case Q.LESS_THAN_SIGN:{this.state=z.RAWTEXT_LESS_THAN_SIGN;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this._emitChars(we);break}case Q.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptData(t){switch(t){case Q.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_LESS_THAN_SIGN;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this._emitChars(we);break}case Q.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_statePlaintext(t){switch(t){case Q.NULL:{this._err(ue.unexpectedNullCharacter),this._emitChars(we);break}case Q.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateTagOpen(t){if(Jt(t))this._createStartTagToken(),this.state=z.TAG_NAME,this._stateTagName(t);else switch(t){case Q.EXCLAMATION_MARK:{this.state=z.MARKUP_DECLARATION_OPEN;break}case Q.SOLIDUS:{this.state=z.END_TAG_OPEN;break}case Q.QUESTION_MARK:{this._err(ue.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=z.BOGUS_COMMENT,this._stateBogusComment(t);break}case Q.EOF:{this._err(ue.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(ue.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=z.DATA,this._stateData(t)}}_stateEndTagOpen(t){if(Jt(t))this._createEndTagToken(),this.state=z.TAG_NAME,this._stateTagName(t);else switch(t){case Q.GREATER_THAN_SIGN:{this._err(ue.missingEndTagName),this.state=z.DATA;break}case Q.EOF:{this._err(ue.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(ue.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=z.BOGUS_COMMENT,this._stateBogusComment(t)}}_stateTagName(t){const r=this.currentToken;switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:{this.state=z.BEFORE_ATTRIBUTE_NAME;break}case Q.SOLIDUS:{this.state=z.SELF_CLOSING_START_TAG;break}case Q.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentTagToken();break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),r.tagName+=we;break}case Q.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:r.tagName+=String.fromCodePoint(on(t)?$n(t):t)}}_stateRcdataLessThanSign(t){t===Q.SOLIDUS?this.state=z.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=z.RCDATA,this._stateRcdata(t))}_stateRcdataEndTagOpen(t){Jt(t)?(this.state=z.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(t)):(this._emitChars("</"),this.state=z.RCDATA,this._stateRcdata(t))}handleSpecialEndTag(t){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const r=this.currentToken;switch(r.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=z.BEFORE_ATTRIBUTE_NAME,!1;case Q.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=z.SELF_CLOSING_START_TAG,!1;case Q.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=z.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=z.RCDATA,this._stateRcdata(t))}_stateRawtextLessThanSign(t){t===Q.SOLIDUS?this.state=z.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=z.RAWTEXT,this._stateRawtext(t))}_stateRawtextEndTagOpen(t){Jt(t)?(this.state=z.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(t)):(this._emitChars("</"),this.state=z.RAWTEXT,this._stateRawtext(t))}_stateRawtextEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=z.RAWTEXT,this._stateRawtext(t))}_stateScriptDataLessThanSign(t){switch(t){case Q.SOLIDUS:{this.state=z.SCRIPT_DATA_END_TAG_OPEN;break}case Q.EXCLAMATION_MARK:{this.state=z.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=z.SCRIPT_DATA,this._stateScriptData(t)}}_stateScriptDataEndTagOpen(t){Jt(t)?(this.state=z.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(t)):(this._emitChars("</"),this.state=z.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=z.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscapeStart(t){t===Q.HYPHEN_MINUS?(this.state=z.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=z.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscapeStartDash(t){t===Q.HYPHEN_MINUS?(this.state=z.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=z.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscaped(t){switch(t){case Q.HYPHEN_MINUS:{this.state=z.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case Q.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this._emitChars(we);break}case Q.EOF:{this._err(ue.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptDataEscapedDash(t){switch(t){case Q.HYPHEN_MINUS:{this.state=z.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case Q.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this.state=z.SCRIPT_DATA_ESCAPED,this._emitChars(we);break}case Q.EOF:{this._err(ue.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=z.SCRIPT_DATA_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataEscapedDashDash(t){switch(t){case Q.HYPHEN_MINUS:{this._emitChars("-");break}case Q.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case Q.GREATER_THAN_SIGN:{this.state=z.SCRIPT_DATA,this._emitChars(">");break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this.state=z.SCRIPT_DATA_ESCAPED,this._emitChars(we);break}case Q.EOF:{this._err(ue.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=z.SCRIPT_DATA_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataEscapedLessThanSign(t){t===Q.SOLIDUS?this.state=z.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:Jt(t)?(this._emitChars("<"),this.state=z.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(t)):(this._emitChars("<"),this.state=z.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataEscapedEndTagOpen(t){Jt(t)?(this.state=z.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(t)):(this._emitChars("</"),this.state=z.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataEscapedEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=z.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataDoubleEscapeStart(t){if(this.preprocessor.startsWith(nt.SCRIPT,!1)&&uu(this.preprocessor.peek(nt.SCRIPT.length))){this._emitCodePoint(t);for(let r=0;r<nt.SCRIPT.length;r++)this._emitCodePoint(this._consume());this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=z.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataDoubleEscaped(t){switch(t){case Q.HYPHEN_MINUS:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case Q.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this._emitChars(we);break}case Q.EOF:{this._err(ue.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedDash(t){switch(t){case Q.HYPHEN_MINUS:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case Q.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(we);break}case Q.EOF:{this._err(ue.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedDashDash(t){switch(t){case Q.HYPHEN_MINUS:{this._emitChars("-");break}case Q.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case Q.GREATER_THAN_SIGN:{this.state=z.SCRIPT_DATA,this._emitChars(">");break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(we);break}case Q.EOF:{this._err(ue.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedLessThanSign(t){t===Q.SOLIDUS?(this.state=z.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(t))}_stateScriptDataDoubleEscapeEnd(t){if(this.preprocessor.startsWith(nt.SCRIPT,!1)&&uu(this.preprocessor.peek(nt.SCRIPT.length))){this._emitCodePoint(t);for(let r=0;r<nt.SCRIPT.length;r++)this._emitCodePoint(this._consume());this.state=z.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(t))}_stateBeforeAttributeName(t){switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:break;case Q.SOLIDUS:case Q.GREATER_THAN_SIGN:case Q.EOF:{this.state=z.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(t);break}case Q.EQUALS_SIGN:{this._err(ue.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=z.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=z.ATTRIBUTE_NAME,this._stateAttributeName(t)}}_stateAttributeName(t){switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:case Q.SOLIDUS:case Q.GREATER_THAN_SIGN:case Q.EOF:{this._leaveAttrName(),this.state=z.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(t);break}case Q.EQUALS_SIGN:{this._leaveAttrName(),this.state=z.BEFORE_ATTRIBUTE_VALUE;break}case Q.QUOTATION_MARK:case Q.APOSTROPHE:case Q.LESS_THAN_SIGN:{this._err(ue.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(t);break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this.currentAttr.name+=we;break}default:this.currentAttr.name+=String.fromCodePoint(on(t)?$n(t):t)}}_stateAfterAttributeName(t){switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:break;case Q.SOLIDUS:{this.state=z.SELF_CLOSING_START_TAG;break}case Q.EQUALS_SIGN:{this.state=z.BEFORE_ATTRIBUTE_VALUE;break}case Q.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentTagToken();break}case Q.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=z.ATTRIBUTE_NAME,this._stateAttributeName(t)}}_stateBeforeAttributeValue(t){switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:break;case Q.QUOTATION_MARK:{this.state=z.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case Q.APOSTROPHE:{this.state=z.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case Q.GREATER_THAN_SIGN:{this._err(ue.missingAttributeValue),this.state=z.DATA,this.emitCurrentTagToken();break}default:this.state=z.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(t)}}_stateAttributeValueDoubleQuoted(t){switch(t){case Q.QUOTATION_MARK:{this.state=z.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case Q.AMPERSAND:{this.returnState=z.ATTRIBUTE_VALUE_DOUBLE_QUOTED,this.state=z.CHARACTER_REFERENCE;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this.currentAttr.value+=we;break}case Q.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAttributeValueSingleQuoted(t){switch(t){case Q.APOSTROPHE:{this.state=z.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case Q.AMPERSAND:{this.returnState=z.ATTRIBUTE_VALUE_SINGLE_QUOTED,this.state=z.CHARACTER_REFERENCE;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this.currentAttr.value+=we;break}case Q.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAttributeValueUnquoted(t){switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:{this._leaveAttrValue(),this.state=z.BEFORE_ATTRIBUTE_NAME;break}case Q.AMPERSAND:{this.returnState=z.ATTRIBUTE_VALUE_UNQUOTED,this.state=z.CHARACTER_REFERENCE;break}case Q.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=z.DATA,this.emitCurrentTagToken();break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),this.currentAttr.value+=we;break}case Q.QUOTATION_MARK:case Q.APOSTROPHE:case Q.LESS_THAN_SIGN:case Q.EQUALS_SIGN:case Q.GRAVE_ACCENT:{this._err(ue.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(t);break}case Q.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAfterAttributeValueQuoted(t){switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:{this._leaveAttrValue(),this.state=z.BEFORE_ATTRIBUTE_NAME;break}case Q.SOLIDUS:{this._leaveAttrValue(),this.state=z.SELF_CLOSING_START_TAG;break}case Q.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=z.DATA,this.emitCurrentTagToken();break}case Q.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:this._err(ue.missingWhitespaceBetweenAttributes),this.state=z.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(t)}}_stateSelfClosingStartTag(t){switch(t){case Q.GREATER_THAN_SIGN:{const r=this.currentToken;r.selfClosing=!0,this.state=z.DATA,this.emitCurrentTagToken();break}case Q.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:this._err(ue.unexpectedSolidusInTag),this.state=z.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(t)}}_stateBogusComment(t){const r=this.currentToken;switch(t){case Q.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentComment(r);break}case Q.EOF:{this.emitCurrentComment(r),this._emitEOFToken();break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),r.data+=we;break}default:r.data+=String.fromCodePoint(t)}}_stateMarkupDeclarationOpen(t){this._consumeSequenceIfMatch(nt.DASH_DASH,!0)?(this._createCommentToken(nt.DASH_DASH.length+1),this.state=z.COMMENT_START):this._consumeSequenceIfMatch(nt.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(nt.DOCTYPE.length+1),this.state=z.DOCTYPE):this._consumeSequenceIfMatch(nt.CDATA_START,!0)?this.inForeignNode?this.state=z.CDATA_SECTION:(this._err(ue.cdataInHtmlContent),this._createCommentToken(nt.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=z.BOGUS_COMMENT):this._ensureHibernation()||(this._err(ue.incorrectlyOpenedComment),this._createCommentToken(2),this.state=z.BOGUS_COMMENT,this._stateBogusComment(t))}_stateCommentStart(t){switch(t){case Q.HYPHEN_MINUS:{this.state=z.COMMENT_START_DASH;break}case Q.GREATER_THAN_SIGN:{this._err(ue.abruptClosingOfEmptyComment),this.state=z.DATA;const r=this.currentToken;this.emitCurrentComment(r);break}default:this.state=z.COMMENT,this._stateComment(t)}}_stateCommentStartDash(t){const r=this.currentToken;switch(t){case Q.HYPHEN_MINUS:{this.state=z.COMMENT_END;break}case Q.GREATER_THAN_SIGN:{this._err(ue.abruptClosingOfEmptyComment),this.state=z.DATA,this.emitCurrentComment(r);break}case Q.EOF:{this._err(ue.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+="-",this.state=z.COMMENT,this._stateComment(t)}}_stateComment(t){const r=this.currentToken;switch(t){case Q.HYPHEN_MINUS:{this.state=z.COMMENT_END_DASH;break}case Q.LESS_THAN_SIGN:{r.data+="<",this.state=z.COMMENT_LESS_THAN_SIGN;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),r.data+=we;break}case Q.EOF:{this._err(ue.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+=String.fromCodePoint(t)}}_stateCommentLessThanSign(t){const r=this.currentToken;switch(t){case Q.EXCLAMATION_MARK:{r.data+="!",this.state=z.COMMENT_LESS_THAN_SIGN_BANG;break}case Q.LESS_THAN_SIGN:{r.data+="<";break}default:this.state=z.COMMENT,this._stateComment(t)}}_stateCommentLessThanSignBang(t){t===Q.HYPHEN_MINUS?this.state=z.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=z.COMMENT,this._stateComment(t))}_stateCommentLessThanSignBangDash(t){t===Q.HYPHEN_MINUS?this.state=z.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=z.COMMENT_END_DASH,this._stateCommentEndDash(t))}_stateCommentLessThanSignBangDashDash(t){t!==Q.GREATER_THAN_SIGN&&t!==Q.EOF&&this._err(ue.nestedComment),this.state=z.COMMENT_END,this._stateCommentEnd(t)}_stateCommentEndDash(t){const r=this.currentToken;switch(t){case Q.HYPHEN_MINUS:{this.state=z.COMMENT_END;break}case Q.EOF:{this._err(ue.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+="-",this.state=z.COMMENT,this._stateComment(t)}}_stateCommentEnd(t){const r=this.currentToken;switch(t){case Q.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentComment(r);break}case Q.EXCLAMATION_MARK:{this.state=z.COMMENT_END_BANG;break}case Q.HYPHEN_MINUS:{r.data+="-";break}case Q.EOF:{this._err(ue.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+="--",this.state=z.COMMENT,this._stateComment(t)}}_stateCommentEndBang(t){const r=this.currentToken;switch(t){case Q.HYPHEN_MINUS:{r.data+="--!",this.state=z.COMMENT_END_DASH;break}case Q.GREATER_THAN_SIGN:{this._err(ue.incorrectlyClosedComment),this.state=z.DATA,this.emitCurrentComment(r);break}case Q.EOF:{this._err(ue.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+="--!",this.state=z.COMMENT,this._stateComment(t)}}_stateDoctype(t){switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:{this.state=z.BEFORE_DOCTYPE_NAME;break}case Q.GREATER_THAN_SIGN:{this.state=z.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(t);break}case Q.EOF:{this._err(ue.eofInDoctype),this._createDoctypeToken(null);const r=this.currentToken;r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingWhitespaceBeforeDoctypeName),this.state=z.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(t)}}_stateBeforeDoctypeName(t){if(on(t))this._createDoctypeToken(String.fromCharCode($n(t))),this.state=z.DOCTYPE_NAME;else switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:break;case Q.NULL:{this._err(ue.unexpectedNullCharacter),this._createDoctypeToken(we),this.state=z.DOCTYPE_NAME;break}case Q.GREATER_THAN_SIGN:{this._err(ue.missingDoctypeName),this._createDoctypeToken(null);const r=this.currentToken;r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case Q.EOF:{this._err(ue.eofInDoctype),this._createDoctypeToken(null);const r=this.currentToken;r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(t)),this.state=z.DOCTYPE_NAME}}_stateDoctypeName(t){const r=this.currentToken;switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:{this.state=z.AFTER_DOCTYPE_NAME;break}case Q.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentDoctype(r);break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),r.name+=we;break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.name+=String.fromCodePoint(on(t)?$n(t):t)}}_stateAfterDoctypeName(t){const r=this.currentToken;switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:break;case Q.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentDoctype(r);break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(nt.PUBLIC,!1)?this.state=z.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(nt.SYSTEM,!1)?this.state=z.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(ue.invalidCharacterSequenceAfterDoctypeName),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t))}}_stateAfterDoctypePublicKeyword(t){const r=this.currentToken;switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:{this.state=z.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case Q.QUOTATION_MARK:{this._err(ue.missingWhitespaceAfterDoctypePublicKeyword),r.publicId="",this.state=z.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case Q.APOSTROPHE:{this._err(ue.missingWhitespaceAfterDoctypePublicKeyword),r.publicId="",this.state=z.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case Q.GREATER_THAN_SIGN:{this._err(ue.missingDoctypePublicIdentifier),r.forceQuirks=!0,this.state=z.DATA,this.emitCurrentDoctype(r);break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingQuoteBeforeDoctypePublicIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBeforeDoctypePublicIdentifier(t){const r=this.currentToken;switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:break;case Q.QUOTATION_MARK:{r.publicId="",this.state=z.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case Q.APOSTROPHE:{r.publicId="",this.state=z.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case Q.GREATER_THAN_SIGN:{this._err(ue.missingDoctypePublicIdentifier),r.forceQuirks=!0,this.state=z.DATA,this.emitCurrentDoctype(r);break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingQuoteBeforeDoctypePublicIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateDoctypePublicIdentifierDoubleQuoted(t){const r=this.currentToken;switch(t){case Q.QUOTATION_MARK:{this.state=z.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),r.publicId+=we;break}case Q.GREATER_THAN_SIGN:{this._err(ue.abruptDoctypePublicIdentifier),r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.publicId+=String.fromCodePoint(t)}}_stateDoctypePublicIdentifierSingleQuoted(t){const r=this.currentToken;switch(t){case Q.APOSTROPHE:{this.state=z.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),r.publicId+=we;break}case Q.GREATER_THAN_SIGN:{this._err(ue.abruptDoctypePublicIdentifier),r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.publicId+=String.fromCodePoint(t)}}_stateAfterDoctypePublicIdentifier(t){const r=this.currentToken;switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:{this.state=z.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case Q.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentDoctype(r);break}case Q.QUOTATION_MARK:{this._err(ue.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case Q.APOSTROPHE:{this._err(ue.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingQuoteBeforeDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBetweenDoctypePublicAndSystemIdentifiers(t){const r=this.currentToken;switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:break;case Q.GREATER_THAN_SIGN:{this.emitCurrentDoctype(r),this.state=z.DATA;break}case Q.QUOTATION_MARK:{r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case Q.APOSTROPHE:{r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingQuoteBeforeDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateAfterDoctypeSystemKeyword(t){const r=this.currentToken;switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:{this.state=z.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case Q.QUOTATION_MARK:{this._err(ue.missingWhitespaceAfterDoctypeSystemKeyword),r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case Q.APOSTROPHE:{this._err(ue.missingWhitespaceAfterDoctypeSystemKeyword),r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case Q.GREATER_THAN_SIGN:{this._err(ue.missingDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.DATA,this.emitCurrentDoctype(r);break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingQuoteBeforeDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBeforeDoctypeSystemIdentifier(t){const r=this.currentToken;switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:break;case Q.QUOTATION_MARK:{r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case Q.APOSTROPHE:{r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case Q.GREATER_THAN_SIGN:{this._err(ue.missingDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.DATA,this.emitCurrentDoctype(r);break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingQuoteBeforeDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateDoctypeSystemIdentifierDoubleQuoted(t){const r=this.currentToken;switch(t){case Q.QUOTATION_MARK:{this.state=z.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),r.systemId+=we;break}case Q.GREATER_THAN_SIGN:{this._err(ue.abruptDoctypeSystemIdentifier),r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.systemId+=String.fromCodePoint(t)}}_stateDoctypeSystemIdentifierSingleQuoted(t){const r=this.currentToken;switch(t){case Q.APOSTROPHE:{this.state=z.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter),r.systemId+=we;break}case Q.GREATER_THAN_SIGN:{this._err(ue.abruptDoctypeSystemIdentifier),r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.systemId+=String.fromCodePoint(t)}}_stateAfterDoctypeSystemIdentifier(t){const r=this.currentToken;switch(t){case Q.SPACE:case Q.LINE_FEED:case Q.TABULATION:case Q.FORM_FEED:break;case Q.GREATER_THAN_SIGN:{this.emitCurrentDoctype(r),this.state=z.DATA;break}case Q.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBogusDoctype(t){const r=this.currentToken;switch(t){case Q.GREATER_THAN_SIGN:{this.emitCurrentDoctype(r),this.state=z.DATA;break}case Q.NULL:{this._err(ue.unexpectedNullCharacter);break}case Q.EOF:{this.emitCurrentDoctype(r),this._emitEOFToken();break}}}_stateCdataSection(t){switch(t){case Q.RIGHT_SQUARE_BRACKET:{this.state=z.CDATA_SECTION_BRACKET;break}case Q.EOF:{this._err(ue.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateCdataSectionBracket(t){t===Q.RIGHT_SQUARE_BRACKET?this.state=z.CDATA_SECTION_END:(this._emitChars("]"),this.state=z.CDATA_SECTION,this._stateCdataSection(t))}_stateCdataSectionEnd(t){switch(t){case Q.GREATER_THAN_SIGN:{this.state=z.DATA;break}case Q.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=z.CDATA_SECTION,this._stateCdataSection(t)}}_stateCharacterReference(t){t===Q.NUMBER_SIGN?this.state=z.NUMERIC_CHARACTER_REFERENCE:js(t)?(this.state=z.NAMED_CHARACTER_REFERENCE,this._stateNamedCharacterReference(t)):(this._flushCodePointConsumedAsCharacterReference(Q.AMPERSAND),this._reconsumeInState(this.returnState,t))}_stateNamedCharacterReference(t){const r=this._matchNamedCharacterReference(t);if(!this._ensureHibernation())if(r){for(let n=0;n<r.length;n++)this._flushCodePointConsumedAsCharacterReference(r[n]);this.state=this.returnState}else this._flushCodePointConsumedAsCharacterReference(Q.AMPERSAND),this.state=z.AMBIGUOUS_AMPERSAND}_stateAmbiguousAmpersand(t){js(t)?this._flushCodePointConsumedAsCharacterReference(t):(t===Q.SEMICOLON&&this._err(ue.unknownNamedCharacterReference),this._reconsumeInState(this.returnState,t))}_stateNumericCharacterReference(t){this.charRefCode=0,t===Q.LATIN_SMALL_X||t===Q.LATIN_CAPITAL_X?this.state=z.HEXADEMICAL_CHARACTER_REFERENCE_START:gn(t)?(this.state=z.DECIMAL_CHARACTER_REFERENCE,this._stateDecimalCharacterReference(t)):(this._err(ue.absenceOfDigitsInNumericCharacterReference),this._flushCodePointConsumedAsCharacterReference(Q.AMPERSAND),this._flushCodePointConsumedAsCharacterReference(Q.NUMBER_SIGN),this._reconsumeInState(this.returnState,t))}_stateHexademicalCharacterReferenceStart(t){ip(t)?(this.state=z.HEXADEMICAL_CHARACTER_REFERENCE,this._stateHexademicalCharacterReference(t)):(this._err(ue.absenceOfDigitsInNumericCharacterReference),this._flushCodePointConsumedAsCharacterReference(Q.AMPERSAND),this._flushCodePointConsumedAsCharacterReference(Q.NUMBER_SIGN),this._unconsume(2),this.state=this.returnState)}_stateHexademicalCharacterReference(t){kc(t)?this.charRefCode=this.charRefCode*16+t-55:Bc(t)?this.charRefCode=this.charRefCode*16+t-87:gn(t)?this.charRefCode=this.charRefCode*16+t-48:t===Q.SEMICOLON?this.state=z.NUMERIC_CHARACTER_REFERENCE_END:(this._err(ue.missingSemicolonAfterCharacterReference),this.state=z.NUMERIC_CHARACTER_REFERENCE_END,this._stateNumericCharacterReferenceEnd(t))}_stateDecimalCharacterReference(t){gn(t)?this.charRefCode=this.charRefCode*10+t-48:t===Q.SEMICOLON?this.state=z.NUMERIC_CHARACTER_REFERENCE_END:(this._err(ue.missingSemicolonAfterCharacterReference),this.state=z.NUMERIC_CHARACTER_REFERENCE_END,this._stateNumericCharacterReferenceEnd(t))}_stateNumericCharacterReferenceEnd(t){if(this.charRefCode===Q.NULL)this._err(ue.nullCharacterReference),this.charRefCode=Q.REPLACEMENT_CHARACTER;else if(this.charRefCode>1114111)this._err(ue.characterReferenceOutsideUnicodeRange),this.charRefCode=Q.REPLACEMENT_CHARACTER;else if(Oc(this.charRefCode))this._err(ue.surrogateCharacterReference),this.charRefCode=Q.REPLACEMENT_CHARACTER;else if(Mc(this.charRefCode))this._err(ue.noncharacterCharacterReference);else if(Pc(this.charRefCode)||this.charRefCode===Q.CARRIAGE_RETURN){this._err(ue.controlCharacterReference);const r=rp.get(this.charRefCode);r!==void 0&&(this.charRefCode=r)}this._flushCodePointConsumedAsCharacterReference(this.charRefCode),this._reconsumeInState(this.returnState,t)}};const Uc=new Set([D.DD,D.DT,D.LI,D.OPTGROUP,D.OPTION,D.P,D.RB,D.RP,D.RT,D.RTC]),lu=new Set([...Uc,D.CAPTION,D.COLGROUP,D.TBODY,D.TD,D.TFOOT,D.TH,D.THEAD,D.TR]),Qn=new Map([[D.APPLET,ce.HTML],[D.CAPTION,ce.HTML],[D.HTML,ce.HTML],[D.MARQUEE,ce.HTML],[D.OBJECT,ce.HTML],[D.TABLE,ce.HTML],[D.TD,ce.HTML],[D.TEMPLATE,ce.HTML],[D.TH,ce.HTML],[D.ANNOTATION_XML,ce.MATHML],[D.MI,ce.MATHML],[D.MN,ce.MATHML],[D.MO,ce.MATHML],[D.MS,ce.MATHML],[D.MTEXT,ce.MATHML],[D.DESC,ce.SVG],[D.FOREIGN_OBJECT,ce.SVG],[D.TITLE,ce.SVG]]),op=[D.H1,D.H2,D.H3,D.H4,D.H5,D.H6],up=[D.TR,D.TEMPLATE,D.HTML],lp=[D.TBODY,D.TFOOT,D.THEAD,D.TEMPLATE,D.HTML],cp=[D.TABLE,D.TEMPLATE,D.HTML],fp=[D.TD,D.TH];class dp{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(t,r,n){this.treeAdapter=r,this.handler=n,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=D.UNKNOWN,this.current=t}_indexOf(t){return this.items.lastIndexOf(t,this.stackTop)}_isInTemplate(){return this.currentTagId===D.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===ce.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(t,r){this.stackTop++,this.items[this.stackTop]=t,this.current=t,this.tagIDs[this.stackTop]=r,this.currentTagId=r,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(t,r,!0)}pop(){const t=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,!0)}replace(t,r){const n=this._indexOf(t);this.items[n]=r,n===this.stackTop&&(this.current=r)}insertAfter(t,r,n){const i=this._indexOf(t)+1;this.items.splice(i,0,r),this.tagIDs.splice(i,0,n),this.stackTop++,i===this.stackTop&&this._updateCurrentElement(),this.handler.onItemPush(this.current,this.currentTagId,i===this.stackTop)}popUntilTagNamePopped(t){let r=this.stackTop+1;do r=this.tagIDs.lastIndexOf(t,r-1);while(r>0&&this.treeAdapter.getNamespaceURI(this.items[r])!==ce.HTML);this.shortenToLength(r<0?0:r)}shortenToLength(t){for(;this.stackTop>=t;){const r=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(r,this.stackTop<t)}}popUntilElementPopped(t){const r=this._indexOf(t);this.shortenToLength(r<0?0:r)}popUntilPopped(t,r){const n=this._indexOfTagNames(t,r);this.shortenToLength(n<0?0:n)}popUntilNumberedHeaderPopped(){this.popUntilPopped(op,ce.HTML)}popUntilTableCellPopped(){this.popUntilPopped(fp,ce.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(t,r){for(let n=this.stackTop;n>=0;n--)if(t.includes(this.tagIDs[n])&&this.treeAdapter.getNamespaceURI(this.items[n])===r)return n;return-1}clearBackTo(t,r){const n=this._indexOfTagNames(t,r);this.shortenToLength(n+1)}clearBackToTableContext(){this.clearBackTo(cp,ce.HTML)}clearBackToTableBodyContext(){this.clearBackTo(lp,ce.HTML)}clearBackToTableRowContext(){this.clearBackTo(up,ce.HTML)}remove(t){const r=this._indexOf(t);r>=0&&(r===this.stackTop?this.pop():(this.items.splice(r,1),this.tagIDs.splice(r,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===D.BODY?this.items[1]:null}contains(t){return this._indexOf(t)>-1}getCommonAncestor(t){const r=this._indexOf(t)-1;return r>=0?this.items[r]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===D.HTML}hasInScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r],i=this.treeAdapter.getNamespaceURI(this.items[r]);if(n===t&&i===ce.HTML)return!0;if(Qn.get(n)===i)return!1}return!0}hasNumberedHeaderInScope(){for(let t=this.stackTop;t>=0;t--){const r=this.tagIDs[t],n=this.treeAdapter.getNamespaceURI(this.items[t]);if(Fc(r)&&n===ce.HTML)return!0;if(Qn.get(r)===n)return!1}return!0}hasInListItemScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r],i=this.treeAdapter.getNamespaceURI(this.items[r]);if(n===t&&i===ce.HTML)return!0;if((n===D.UL||n===D.OL)&&i===ce.HTML||Qn.get(n)===i)return!1}return!0}hasInButtonScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r],i=this.treeAdapter.getNamespaceURI(this.items[r]);if(n===t&&i===ce.HTML)return!0;if(n===D.BUTTON&&i===ce.HTML||Qn.get(n)===i)return!1}return!0}hasInTableScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r];if(this.treeAdapter.getNamespaceURI(this.items[r])===ce.HTML){if(n===t)return!0;if(n===D.TABLE||n===D.TEMPLATE||n===D.HTML)return!1}}return!0}hasTableBodyContextInTableScope(){for(let t=this.stackTop;t>=0;t--){const r=this.tagIDs[t];if(this.treeAdapter.getNamespaceURI(this.items[t])===ce.HTML){if(r===D.TBODY||r===D.THEAD||r===D.TFOOT)return!0;if(r===D.TABLE||r===D.HTML)return!1}}return!0}hasInSelectScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r];if(this.treeAdapter.getNamespaceURI(this.items[r])===ce.HTML){if(n===t)return!0;if(n!==D.OPTION&&n!==D.OPTGROUP)return!1}}return!0}generateImpliedEndTags(){for(;Uc.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;lu.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(t){for(;this.currentTagId!==t&&lu.has(this.currentTagId);)this.pop()}}const ms=3;var bt;(function(e){e[e.Marker=0]="Marker",e[e.Element=1]="Element"})(bt=bt||(bt={}));const cu={type:bt.Marker};class hp{constructor(t){this.treeAdapter=t,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(t,r){const n=[],i=r.length,u=this.treeAdapter.getTagName(t),x=this.treeAdapter.getNamespaceURI(t);for(let b=0;b<this.entries.length;b++){const s=this.entries[b];if(s.type===bt.Marker)break;const{element:C}=s;if(this.treeAdapter.getTagName(C)===u&&this.treeAdapter.getNamespaceURI(C)===x){const g=this.treeAdapter.getAttrList(C);g.length===i&&n.push({idx:b,attrs:g})}}return n}_ensureNoahArkCondition(t){if(this.entries.length<ms)return;const r=this.treeAdapter.getAttrList(t),n=this._getNoahArkConditionCandidates(t,r);if(n.length<ms)return;const i=new Map(r.map(x=>[x.name,x.value]));let u=0;for(let x=0;x<n.length;x++){const b=n[x];b.attrs.every(s=>i.get(s.name)===s.value)&&(u+=1,u>=ms&&this.entries.splice(b.idx,1))}}insertMarker(){this.entries.unshift(cu)}pushElement(t,r){this._ensureNoahArkCondition(t),this.entries.unshift({type:bt.Element,element:t,token:r})}insertElementAfterBookmark(t,r){const n=this.entries.indexOf(this.bookmark);this.entries.splice(n,0,{type:bt.Element,element:t,token:r})}removeEntry(t){const r=this.entries.indexOf(t);r>=0&&this.entries.splice(r,1)}clearToLastMarker(){const t=this.entries.indexOf(cu);t>=0?this.entries.splice(0,t+1):this.entries.length=0}getElementEntryInScopeWithTagName(t){const r=this.entries.find(n=>n.type===bt.Marker||this.treeAdapter.getTagName(n.element)===t);return r&&r.type===bt.Element?r:null}getElementEntry(t){return this.entries.find(r=>r.type===bt.Element&&r.element===t)}}function fu(e){return{nodeName:"#text",value:e,parentNode:null}}const Er={createDocument(){return{nodeName:"#document",mode:ot.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(e,t,r){return{nodeName:e,tagName:e,attrs:r,namespaceURI:t,childNodes:[],parentNode:null}},createCommentNode(e){return{nodeName:"#comment",data:e,parentNode:null}},appendChild(e,t){e.childNodes.push(t),t.parentNode=e},insertBefore(e,t,r){const n=e.childNodes.indexOf(r);e.childNodes.splice(n,0,t),t.parentNode=e},setTemplateContent(e,t){e.content=t},getTemplateContent(e){return e.content},setDocumentType(e,t,r,n){const i=e.childNodes.find(u=>u.nodeName==="#documentType");if(i)i.name=t,i.publicId=r,i.systemId=n;else{const u={nodeName:"#documentType",name:t,publicId:r,systemId:n,parentNode:null};Er.appendChild(e,u)}},setDocumentMode(e,t){e.mode=t},getDocumentMode(e){return e.mode},detachNode(e){if(e.parentNode){const t=e.parentNode.childNodes.indexOf(e);e.parentNode.childNodes.splice(t,1),e.parentNode=null}},insertText(e,t){if(e.childNodes.length>0){const r=e.childNodes[e.childNodes.length-1];if(Er.isTextNode(r)){r.value+=t;return}}Er.appendChild(e,fu(t))},insertTextBefore(e,t,r){const n=e.childNodes[e.childNodes.indexOf(r)-1];n&&Er.isTextNode(n)?n.value+=t:Er.insertBefore(e,fu(t),r)},adoptAttributes(e,t){const r=new Set(e.attrs.map(n=>n.name));for(let n=0;n<t.length;n++)r.has(t[n].name)||e.attrs.push(t[n])},getFirstChild(e){return e.childNodes[0]},getChildNodes(e){return e.childNodes},getParentNode(e){return e.parentNode},getAttrList(e){return e.attrs},getTagName(e){return e.tagName},getNamespaceURI(e){return e.namespaceURI},getTextNodeContent(e){return e.value},getCommentNodeContent(e){return e.data},getDocumentTypeNodeName(e){return e.name},getDocumentTypeNodePublicId(e){return e.publicId},getDocumentTypeNodeSystemId(e){return e.systemId},isTextNode(e){return e.nodeName==="#text"},isCommentNode(e){return e.nodeName==="#comment"},isDocumentTypeNode(e){return e.nodeName==="#documentType"},isElementNode(e){return Object.prototype.hasOwnProperty.call(e,"tagName")},setNodeSourceCodeLocation(e,t){e.sourceCodeLocation=t},getNodeSourceCodeLocation(e){return e.sourceCodeLocation},updateNodeSourceCodeLocation(e,t){e.sourceCodeLocation={...e.sourceCodeLocation,...t}}},Hc="html",gp="about:legacy-compat",mp="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",Kc=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],Ep=[...Kc,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],vp=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),Wc=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],pp=[...Wc,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function du(e,t){return t.some(r=>e.startsWith(r))}function Tp(e){return e.name===Hc&&e.publicId===null&&(e.systemId===null||e.systemId===gp)}function _p(e){if(e.name!==Hc)return ot.QUIRKS;const{systemId:t}=e;if(t&&t.toLowerCase()===mp)return ot.QUIRKS;let{publicId:r}=e;if(r!==null){if(r=r.toLowerCase(),vp.has(r))return ot.QUIRKS;let n=t===null?Ep:Kc;if(du(r,n))return ot.QUIRKS;if(n=t===null?Wc:pp,du(r,n))return ot.LIMITED_QUIRKS}return ot.NO_QUIRKS}const hu={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},Ap="definitionurl",yp="definitionURL",bp=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),Sp=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:ce.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:ce.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:ce.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:ce.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:ce.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:ce.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:ce.XLINK}],["xml:base",{prefix:"xml",name:"base",namespace:ce.XML}],["xml:lang",{prefix:"xml",name:"lang",namespace:ce.XML}],["xml:space",{prefix:"xml",name:"space",namespace:ce.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:ce.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:ce.XMLNS}]]),Ip=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(e=>[e.toLowerCase(),e])),xp=new Set([D.B,D.BIG,D.BLOCKQUOTE,D.BODY,D.BR,D.CENTER,D.CODE,D.DD,D.DIV,D.DL,D.DT,D.EM,D.EMBED,D.H1,D.H2,D.H3,D.H4,D.H5,D.H6,D.HEAD,D.HR,D.I,D.IMG,D.LI,D.LISTING,D.MENU,D.META,D.NOBR,D.OL,D.P,D.PRE,D.RUBY,D.S,D.SMALL,D.SPAN,D.STRONG,D.STRIKE,D.SUB,D.SUP,D.TABLE,D.TT,D.U,D.UL,D.VAR]);function Lp(e){const t=e.tagID;return t===D.FONT&&e.attrs.some(({name:n})=>n===nr.COLOR||n===nr.SIZE||n===nr.FACE)||xp.has(t)}function Gc(e){for(let t=0;t<e.attrs.length;t++)if(e.attrs[t].name===Ap){e.attrs[t].name=yp;break}}function Yc(e){for(let t=0;t<e.attrs.length;t++){const r=bp.get(e.attrs[t].name);r!=null&&(e.attrs[t].name=r)}}function Fa(e){for(let t=0;t<e.attrs.length;t++){const r=Sp.get(e.attrs[t].name);r&&(e.attrs[t].prefix=r.prefix,e.attrs[t].name=r.name,e.attrs[t].namespace=r.namespace)}}function Cp(e){const t=Ip.get(e.tagName);t!=null&&(e.tagName=t,e.tagID=Gi(e.tagName))}function Dp(e,t){return t===ce.MATHML&&(e===D.MI||e===D.MO||e===D.MN||e===D.MS||e===D.MTEXT)}function Rp(e,t,r){if(t===ce.MATHML&&e===D.ANNOTATION_XML){for(let n=0;n<r.length;n++)if(r[n].name===nr.ENCODING){const i=r[n].value.toLowerCase();return i===hu.TEXT_HTML||i===hu.APPLICATION_XML}}return t===ce.SVG&&(e===D.FOREIGN_OBJECT||e===D.DESC||e===D.TITLE)}function Op(e,t,r,n){return(!n||n===ce.HTML)&&Rp(e,t,r)||(!n||n===ce.MATHML)&&Dp(e,t)}const Pp="hidden",Mp=8,Np=3;var te;(function(e){e[e.INITIAL=0]="INITIAL",e[e.BEFORE_HTML=1]="BEFORE_HTML",e[e.BEFORE_HEAD=2]="BEFORE_HEAD",e[e.IN_HEAD=3]="IN_HEAD",e[e.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",e[e.AFTER_HEAD=5]="AFTER_HEAD",e[e.IN_BODY=6]="IN_BODY",e[e.TEXT=7]="TEXT",e[e.IN_TABLE=8]="IN_TABLE",e[e.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",e[e.IN_CAPTION=10]="IN_CAPTION",e[e.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",e[e.IN_TABLE_BODY=12]="IN_TABLE_BODY",e[e.IN_ROW=13]="IN_ROW",e[e.IN_CELL=14]="IN_CELL",e[e.IN_SELECT=15]="IN_SELECT",e[e.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",e[e.IN_TEMPLATE=17]="IN_TEMPLATE",e[e.AFTER_BODY=18]="AFTER_BODY",e[e.IN_FRAMESET=19]="IN_FRAMESET",e[e.AFTER_FRAMESET=20]="AFTER_FRAMESET",e[e.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",e[e.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(te||(te={}));const Fp={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},Vc=new Set([D.TABLE,D.TBODY,D.TFOOT,D.THEAD,D.TR]),gu={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:Er,onParseError:null};let jc=class{constructor(t,r,n=null,i=null){this.fragmentContext=n,this.scriptHandler=i,this.currentToken=null,this.stopped=!1,this.insertionMode=te.INITIAL,this.originalInsertionMode=te.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...gu,...t},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=r??this.treeAdapter.createDocument(),this.tokenizer=new ap(this.options,this),this.activeFormattingElements=new hp(this.treeAdapter),this.fragmentContextID=n?Gi(this.treeAdapter.getTagName(n)):D.UNKNOWN,this._setContextModes(n??this.document,this.fragmentContextID),this.openElements=new dp(this.document,this.treeAdapter,this)}static parse(t,r){const n=new this(r);return n.tokenizer.write(t,!0),n.document}static getFragmentParser(t,r){const n={...gu,...r};t??(t=n.treeAdapter.createElement(se.TEMPLATE,ce.HTML,[]));const i=n.treeAdapter.createElement("documentmock",ce.HTML,[]),u=new this(n,i,t);return u.fragmentContextID===D.TEMPLATE&&u.tmplInsertionModeStack.unshift(te.IN_TEMPLATE),u._initTokenizerForFragmentParsing(),u._insertFakeRootElement(),u._resetInsertionMode(),u._findFormInFragmentContext(),u}getFragment(){const t=this.treeAdapter.getFirstChild(this.document),r=this.treeAdapter.createDocumentFragment();return this._adoptNodes(t,r),r}_err(t,r,n){var i;if(!this.onParseError)return;const u=(i=t.location)!==null&&i!==void 0?i:Fp,x={code:r,startLine:u.startLine,startCol:u.startCol,startOffset:u.startOffset,endLine:n?u.startLine:u.endLine,endCol:n?u.startCol:u.endCol,endOffset:n?u.startOffset:u.endOffset};this.onParseError(x)}onItemPush(t,r,n){var i,u;(u=(i=this.treeAdapter).onItemPush)===null||u===void 0||u.call(i,t),n&&this.openElements.stackTop>0&&this._setContextModes(t,r)}onItemPop(t,r){var n,i;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(t,this.currentToken),(i=(n=this.treeAdapter).onItemPop)===null||i===void 0||i.call(n,t,this.openElements.current),r){let u,x;this.openElements.stackTop===0&&this.fragmentContext?(u=this.fragmentContext,x=this.fragmentContextID):{current:u,currentTagId:x}=this.openElements,this._setContextModes(u,x)}}_setContextModes(t,r){const n=t===this.document||this.treeAdapter.getNamespaceURI(t)===ce.HTML;this.currentNotInHTML=!n,this.tokenizer.inForeignNode=!n&&!this._isIntegrationPoint(r,t)}_switchToTextParsing(t,r){this._insertElement(t,ce.HTML),this.tokenizer.state=r,this.originalInsertionMode=this.insertionMode,this.insertionMode=te.TEXT}switchToPlaintextParsing(){this.insertionMode=te.TEXT,this.originalInsertionMode=te.IN_BODY,this.tokenizer.state=ut.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let t=this.fragmentContext;for(;t;){if(this.treeAdapter.getTagName(t)===se.FORM){this.formElement=t;break}t=this.treeAdapter.getParentNode(t)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==ce.HTML))switch(this.fragmentContextID){case D.TITLE:case D.TEXTAREA:{this.tokenizer.state=ut.RCDATA;break}case D.STYLE:case D.XMP:case D.IFRAME:case D.NOEMBED:case D.NOFRAMES:case D.NOSCRIPT:{this.tokenizer.state=ut.RAWTEXT;break}case D.SCRIPT:{this.tokenizer.state=ut.SCRIPT_DATA;break}case D.PLAINTEXT:{this.tokenizer.state=ut.PLAINTEXT;break}}}_setDocumentType(t){const r=t.name||"",n=t.publicId||"",i=t.systemId||"";if(this.treeAdapter.setDocumentType(this.document,r,n,i),t.location){const x=this.treeAdapter.getChildNodes(this.document).find(b=>this.treeAdapter.isDocumentTypeNode(b));x&&this.treeAdapter.setNodeSourceCodeLocation(x,t.location)}}_attachElementToTree(t,r){if(this.options.sourceCodeLocationInfo){const n=r&&{...r,startTag:r};this.treeAdapter.setNodeSourceCodeLocation(t,n)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(t);else{const n=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(n,t)}}_appendElement(t,r){const n=this.treeAdapter.createElement(t.tagName,r,t.attrs);this._attachElementToTree(n,t.location)}_insertElement(t,r){const n=this.treeAdapter.createElement(t.tagName,r,t.attrs);this._attachElementToTree(n,t.location),this.openElements.push(n,t.tagID)}_insertFakeElement(t,r){const n=this.treeAdapter.createElement(t,ce.HTML,[]);this._attachElementToTree(n,null),this.openElements.push(n,r)}_insertTemplate(t){const r=this.treeAdapter.createElement(t.tagName,ce.HTML,t.attrs),n=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(r,n),this._attachElementToTree(r,t.location),this.openElements.push(r,t.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(n,null)}_insertFakeRootElement(){const t=this.treeAdapter.createElement(se.HTML,ce.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(t,null),this.treeAdapter.appendChild(this.openElements.current,t),this.openElements.push(t,D.HTML)}_appendCommentNode(t,r){const n=this.treeAdapter.createCommentNode(t.data);this.treeAdapter.appendChild(r,n),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(n,t.location)}_insertCharacters(t){let r,n;if(this._shouldFosterParentOnInsertion()?({parent:r,beforeElement:n}=this._findFosterParentingLocation(),n?this.treeAdapter.insertTextBefore(r,t.chars,n):this.treeAdapter.insertText(r,t.chars)):(r=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(r,t.chars)),!t.location)return;const i=this.treeAdapter.getChildNodes(r),u=n?i.lastIndexOf(n):i.length,x=i[u-1];if(this.treeAdapter.getNodeSourceCodeLocation(x)){const{endLine:s,endCol:C,endOffset:g}=t.location;this.treeAdapter.updateNodeSourceCodeLocation(x,{endLine:s,endCol:C,endOffset:g})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(x,t.location)}_adoptNodes(t,r){for(let n=this.treeAdapter.getFirstChild(t);n;n=this.treeAdapter.getFirstChild(t))this.treeAdapter.detachNode(n),this.treeAdapter.appendChild(r,n)}_setEndLocation(t,r){if(this.treeAdapter.getNodeSourceCodeLocation(t)&&r.location){const n=r.location,i=this.treeAdapter.getTagName(t),u=r.type===Ce.END_TAG&&i===r.tagName?{endTag:{...n},endLine:n.endLine,endCol:n.endCol,endOffset:n.endOffset}:{endLine:n.startLine,endCol:n.startCol,endOffset:n.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(t,u)}}shouldProcessStartTagTokenInForeignContent(t){if(!this.currentNotInHTML)return!1;let r,n;return this.openElements.stackTop===0&&this.fragmentContext?(r=this.fragmentContext,n=this.fragmentContextID):{current:r,currentTagId:n}=this.openElements,t.tagID===D.SVG&&this.treeAdapter.getTagName(r)===se.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(r)===ce.MATHML?!1:this.tokenizer.inForeignNode||(t.tagID===D.MGLYPH||t.tagID===D.MALIGNMARK)&&!this._isIntegrationPoint(n,r,ce.HTML)}_processToken(t){switch(t.type){case Ce.CHARACTER:{this.onCharacter(t);break}case Ce.NULL_CHARACTER:{this.onNullCharacter(t);break}case Ce.COMMENT:{this.onComment(t);break}case Ce.DOCTYPE:{this.onDoctype(t);break}case Ce.START_TAG:{this._processStartTag(t);break}case Ce.END_TAG:{this.onEndTag(t);break}case Ce.EOF:{this.onEof(t);break}case Ce.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(t);break}}}_isIntegrationPoint(t,r,n){const i=this.treeAdapter.getNamespaceURI(r),u=this.treeAdapter.getAttrList(r);return Op(t,i,u,n)}_reconstructActiveFormattingElements(){const t=this.activeFormattingElements.entries.length;if(t){const r=this.activeFormattingElements.entries.findIndex(i=>i.type===bt.Marker||this.openElements.contains(i.element)),n=r<0?t-1:r-1;for(let i=n;i>=0;i--){const u=this.activeFormattingElements.entries[i];this._insertElement(u.token,this.treeAdapter.getNamespaceURI(u.element)),u.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=te.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(D.P),this.openElements.popUntilTagNamePopped(D.P)}_resetInsertionMode(){for(let t=this.openElements.stackTop;t>=0;t--)switch(t===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[t]){case D.TR:{this.insertionMode=te.IN_ROW;return}case D.TBODY:case D.THEAD:case D.TFOOT:{this.insertionMode=te.IN_TABLE_BODY;return}case D.CAPTION:{this.insertionMode=te.IN_CAPTION;return}case D.COLGROUP:{this.insertionMode=te.IN_COLUMN_GROUP;return}case D.TABLE:{this.insertionMode=te.IN_TABLE;return}case D.BODY:{this.insertionMode=te.IN_BODY;return}case D.FRAMESET:{this.insertionMode=te.IN_FRAMESET;return}case D.SELECT:{this._resetInsertionModeForSelect(t);return}case D.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case D.HTML:{this.insertionMode=this.headElement?te.AFTER_HEAD:te.BEFORE_HEAD;return}case D.TD:case D.TH:{if(t>0){this.insertionMode=te.IN_CELL;return}break}case D.HEAD:{if(t>0){this.insertionMode=te.IN_HEAD;return}break}}this.insertionMode=te.IN_BODY}_resetInsertionModeForSelect(t){if(t>0)for(let r=t-1;r>0;r--){const n=this.openElements.tagIDs[r];if(n===D.TEMPLATE)break;if(n===D.TABLE){this.insertionMode=te.IN_SELECT_IN_TABLE;return}}this.insertionMode=te.IN_SELECT}_isElementCausesFosterParenting(t){return Vc.has(t)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let t=this.openElements.stackTop;t>=0;t--){const r=this.openElements.items[t];switch(this.openElements.tagIDs[t]){case D.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(r)===ce.HTML)return{parent:this.treeAdapter.getTemplateContent(r),beforeElement:null};break}case D.TABLE:{const n=this.treeAdapter.getParentNode(r);return n?{parent:n,beforeElement:r}:{parent:this.openElements.items[t-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(t){const r=this._findFosterParentingLocation();r.beforeElement?this.treeAdapter.insertBefore(r.parent,t,r.beforeElement):this.treeAdapter.appendChild(r.parent,t)}_isSpecialElement(t,r){const n=this.treeAdapter.getNamespaceURI(t);return Zv[n].has(r)}onCharacter(t){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){f_(this,t);return}switch(this.insertionMode){case te.INITIAL:{nn(this,t);break}case te.BEFORE_HTML:{mn(this,t);break}case te.BEFORE_HEAD:{En(this,t);break}case te.IN_HEAD:{vn(this,t);break}case te.IN_HEAD_NO_SCRIPT:{pn(this,t);break}case te.AFTER_HEAD:{Tn(this,t);break}case te.IN_BODY:case te.IN_CAPTION:case te.IN_CELL:case te.IN_TEMPLATE:{$c(this,t);break}case te.TEXT:case te.IN_SELECT:case te.IN_SELECT_IN_TABLE:{this._insertCharacters(t);break}case te.IN_TABLE:case te.IN_TABLE_BODY:case te.IN_ROW:{Es(this,t);break}case te.IN_TABLE_TEXT:{ef(this,t);break}case te.IN_COLUMN_GROUP:{Ai(this,t);break}case te.AFTER_BODY:{yi(this,t);break}case te.AFTER_AFTER_BODY:{si(this,t);break}}}onNullCharacter(t){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){c_(this,t);return}switch(this.insertionMode){case te.INITIAL:{nn(this,t);break}case te.BEFORE_HTML:{mn(this,t);break}case te.BEFORE_HEAD:{En(this,t);break}case te.IN_HEAD:{vn(this,t);break}case te.IN_HEAD_NO_SCRIPT:{pn(this,t);break}case te.AFTER_HEAD:{Tn(this,t);break}case te.TEXT:{this._insertCharacters(t);break}case te.IN_TABLE:case te.IN_TABLE_BODY:case te.IN_ROW:{Es(this,t);break}case te.IN_COLUMN_GROUP:{Ai(this,t);break}case te.AFTER_BODY:{yi(this,t);break}case te.AFTER_AFTER_BODY:{si(this,t);break}}}onComment(t){if(this.skipNextNewLine=!1,this.currentNotInHTML){Xs(this,t);return}switch(this.insertionMode){case te.INITIAL:case te.BEFORE_HTML:case te.BEFORE_HEAD:case te.IN_HEAD:case te.IN_HEAD_NO_SCRIPT:case te.AFTER_HEAD:case te.IN_BODY:case te.IN_TABLE:case te.IN_CAPTION:case te.IN_COLUMN_GROUP:case te.IN_TABLE_BODY:case te.IN_ROW:case te.IN_CELL:case te.IN_SELECT:case te.IN_SELECT_IN_TABLE:case te.IN_TEMPLATE:case te.IN_FRAMESET:case te.AFTER_FRAMESET:{Xs(this,t);break}case te.IN_TABLE_TEXT:{sn(this,t);break}case te.AFTER_BODY:{Wp(this,t);break}case te.AFTER_AFTER_BODY:case te.AFTER_AFTER_FRAMESET:{Gp(this,t);break}}}onDoctype(t){switch(this.skipNextNewLine=!1,this.insertionMode){case te.INITIAL:{Yp(this,t);break}case te.BEFORE_HEAD:case te.IN_HEAD:case te.IN_HEAD_NO_SCRIPT:case te.AFTER_HEAD:{this._err(t,ue.misplacedDoctype);break}case te.IN_TABLE_TEXT:{sn(this,t);break}}}onStartTag(t){this.skipNextNewLine=!1,this.currentToken=t,this._processStartTag(t),t.selfClosing&&!t.ackSelfClosing&&this._err(t,ue.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(t){this.shouldProcessStartTagTokenInForeignContent(t)?d_(this,t):this._startTagOutsideForeignContent(t)}_startTagOutsideForeignContent(t){switch(this.insertionMode){case te.INITIAL:{nn(this,t);break}case te.BEFORE_HTML:{Vp(this,t);break}case te.BEFORE_HEAD:{Xp(this,t);break}case te.IN_HEAD:{Dt(this,t);break}case te.IN_HEAD_NO_SCRIPT:{zp(this,t);break}case te.AFTER_HEAD:{Jp(this,t);break}case te.IN_BODY:{Ze(this,t);break}case te.IN_TABLE:{Xr(this,t);break}case te.IN_TABLE_TEXT:{sn(this,t);break}case te.IN_CAPTION:{$T(this,t);break}case te.IN_COLUMN_GROUP:{wa(this,t);break}case te.IN_TABLE_BODY:{ji(this,t);break}case te.IN_ROW:{Xi(this,t);break}case te.IN_CELL:{qT(this,t);break}case te.IN_SELECT:{nf(this,t);break}case te.IN_SELECT_IN_TABLE:{ZT(this,t);break}case te.IN_TEMPLATE:{t_(this,t);break}case te.AFTER_BODY:{n_(this,t);break}case te.IN_FRAMESET:{i_(this,t);break}case te.AFTER_FRAMESET:{a_(this,t);break}case te.AFTER_AFTER_BODY:{u_(this,t);break}case te.AFTER_AFTER_FRAMESET:{l_(this,t);break}}}onEndTag(t){this.skipNextNewLine=!1,this.currentToken=t,this.currentNotInHTML?h_(this,t):this._endTagOutsideForeignContent(t)}_endTagOutsideForeignContent(t){switch(this.insertionMode){case te.INITIAL:{nn(this,t);break}case te.BEFORE_HTML:{jp(this,t);break}case te.BEFORE_HEAD:{$p(this,t);break}case te.IN_HEAD:{Qp(this,t);break}case te.IN_HEAD_NO_SCRIPT:{qp(this,t);break}case te.AFTER_HEAD:{Zp(this,t);break}case te.IN_BODY:{Vi(this,t);break}case te.TEXT:{wT(this,t);break}case te.IN_TABLE:{Rn(this,t);break}case te.IN_TABLE_TEXT:{sn(this,t);break}case te.IN_CAPTION:{QT(this,t);break}case te.IN_COLUMN_GROUP:{zT(this,t);break}case te.IN_TABLE_BODY:{$s(this,t);break}case te.IN_ROW:{rf(this,t);break}case te.IN_CELL:{JT(this,t);break}case te.IN_SELECT:{sf(this,t);break}case te.IN_SELECT_IN_TABLE:{e_(this,t);break}case te.IN_TEMPLATE:{r_(this,t);break}case te.AFTER_BODY:{of(this,t);break}case te.IN_FRAMESET:{s_(this,t);break}case te.AFTER_FRAMESET:{o_(this,t);break}case te.AFTER_AFTER_BODY:{si(this,t);break}}}onEof(t){switch(this.insertionMode){case te.INITIAL:{nn(this,t);break}case te.BEFORE_HTML:{mn(this,t);break}case te.BEFORE_HEAD:{En(this,t);break}case te.IN_HEAD:{vn(this,t);break}case te.IN_HEAD_NO_SCRIPT:{pn(this,t);break}case te.AFTER_HEAD:{Tn(this,t);break}case te.IN_BODY:case te.IN_TABLE:case te.IN_CAPTION:case te.IN_COLUMN_GROUP:case te.IN_TABLE_BODY:case te.IN_ROW:case te.IN_CELL:case te.IN_SELECT:case te.IN_SELECT_IN_TABLE:{Jc(this,t);break}case te.TEXT:{UT(this,t);break}case te.IN_TABLE_TEXT:{sn(this,t);break}case te.IN_TEMPLATE:{af(this,t);break}case te.AFTER_BODY:case te.IN_FRAMESET:case te.AFTER_FRAMESET:case te.AFTER_AFTER_BODY:case te.AFTER_AFTER_FRAMESET:{Ba(this,t);break}}}onWhitespaceCharacter(t){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,t.chars.charCodeAt(0)===Q.LINE_FEED)){if(t.chars.length===1)return;t.chars=t.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(t);return}switch(this.insertionMode){case te.IN_HEAD:case te.IN_HEAD_NO_SCRIPT:case te.AFTER_HEAD:case te.TEXT:case te.IN_COLUMN_GROUP:case te.IN_SELECT:case te.IN_SELECT_IN_TABLE:case te.IN_FRAMESET:case te.AFTER_FRAMESET:{this._insertCharacters(t);break}case te.IN_BODY:case te.IN_CAPTION:case te.IN_CELL:case te.IN_TEMPLATE:case te.AFTER_BODY:case te.AFTER_AFTER_BODY:case te.AFTER_AFTER_FRAMESET:{Xc(this,t);break}case te.IN_TABLE:case te.IN_TABLE_BODY:case te.IN_ROW:{Es(this,t);break}case te.IN_TABLE_TEXT:{Zc(this,t);break}}}};function kp(e,t){let r=e.activeFormattingElements.getElementEntryInScopeWithTagName(t.tagName);return r?e.openElements.contains(r.element)?e.openElements.hasInScope(t.tagID)||(r=null):(e.activeFormattingElements.removeEntry(r),r=null):qc(e,t),r}function Bp(e,t){let r=null,n=e.openElements.stackTop;for(;n>=0;n--){const i=e.openElements.items[n];if(i===t.element)break;e._isSpecialElement(i,e.openElements.tagIDs[n])&&(r=i)}return r||(e.openElements.shortenToLength(n<0?0:n),e.activeFormattingElements.removeEntry(t)),r}function wp(e,t,r){let n=t,i=e.openElements.getCommonAncestor(t);for(let u=0,x=i;x!==r;u++,x=i){i=e.openElements.getCommonAncestor(x);const b=e.activeFormattingElements.getElementEntry(x),s=b&&u>=Np;!b||s?(s&&e.activeFormattingElements.removeEntry(b),e.openElements.remove(x)):(x=Up(e,b),n===t&&(e.activeFormattingElements.bookmark=b),e.treeAdapter.detachNode(n),e.treeAdapter.appendChild(x,n),n=x)}return n}function Up(e,t){const r=e.treeAdapter.getNamespaceURI(t.element),n=e.treeAdapter.createElement(t.token.tagName,r,t.token.attrs);return e.openElements.replace(t.element,n),t.element=n,n}function Hp(e,t,r){const n=e.treeAdapter.getTagName(t),i=Gi(n);if(e._isElementCausesFosterParenting(i))e._fosterParentElement(r);else{const u=e.treeAdapter.getNamespaceURI(t);i===D.TEMPLATE&&u===ce.HTML&&(t=e.treeAdapter.getTemplateContent(t)),e.treeAdapter.appendChild(t,r)}}function Kp(e,t,r){const n=e.treeAdapter.getNamespaceURI(r.element),{token:i}=r,u=e.treeAdapter.createElement(i.tagName,n,i.attrs);e._adoptNodes(t,u),e.treeAdapter.appendChild(t,u),e.activeFormattingElements.insertElementAfterBookmark(u,i),e.activeFormattingElements.removeEntry(r),e.openElements.remove(r.element),e.openElements.insertAfter(t,u,i.tagID)}function ka(e,t){for(let r=0;r<Mp;r++){const n=kp(e,t);if(!n)break;const i=Bp(e,n);if(!i)break;e.activeFormattingElements.bookmark=n;const u=wp(e,i,n.element),x=e.openElements.getCommonAncestor(n.element);e.treeAdapter.detachNode(u),x&&Hp(e,x,u),Kp(e,i,n)}}function Xs(e,t){e._appendCommentNode(t,e.openElements.currentTmplContentOrNode)}function Wp(e,t){e._appendCommentNode(t,e.openElements.items[0])}function Gp(e,t){e._appendCommentNode(t,e.document)}function Ba(e,t){if(e.stopped=!0,t.location){const r=e.fragmentContext?0:2;for(let n=e.openElements.stackTop;n>=r;n--)e._setEndLocation(e.openElements.items[n],t);if(!e.fragmentContext&&e.openElements.stackTop>=0){const n=e.openElements.items[0],i=e.treeAdapter.getNodeSourceCodeLocation(n);if(i&&!i.endTag&&(e._setEndLocation(n,t),e.openElements.stackTop>=1)){const u=e.openElements.items[1],x=e.treeAdapter.getNodeSourceCodeLocation(u);x&&!x.endTag&&e._setEndLocation(u,t)}}}}function Yp(e,t){e._setDocumentType(t);const r=t.forceQuirks?ot.QUIRKS:_p(t);Tp(t)||e._err(t,ue.nonConformingDoctype),e.treeAdapter.setDocumentMode(e.document,r),e.insertionMode=te.BEFORE_HTML}function nn(e,t){e._err(t,ue.missingDoctype,!0),e.treeAdapter.setDocumentMode(e.document,ot.QUIRKS),e.insertionMode=te.BEFORE_HTML,e._processToken(t)}function Vp(e,t){t.tagID===D.HTML?(e._insertElement(t,ce.HTML),e.insertionMode=te.BEFORE_HEAD):mn(e,t)}function jp(e,t){const r=t.tagID;(r===D.HTML||r===D.HEAD||r===D.BODY||r===D.BR)&&mn(e,t)}function mn(e,t){e._insertFakeRootElement(),e.insertionMode=te.BEFORE_HEAD,e._processToken(t)}function Xp(e,t){switch(t.tagID){case D.HTML:{Ze(e,t);break}case D.HEAD:{e._insertElement(t,ce.HTML),e.headElement=e.openElements.current,e.insertionMode=te.IN_HEAD;break}default:En(e,t)}}function $p(e,t){const r=t.tagID;r===D.HEAD||r===D.BODY||r===D.HTML||r===D.BR?En(e,t):e._err(t,ue.endTagWithoutMatchingOpenElement)}function En(e,t){e._insertFakeElement(se.HEAD,D.HEAD),e.headElement=e.openElements.current,e.insertionMode=te.IN_HEAD,e._processToken(t)}function Dt(e,t){switch(t.tagID){case D.HTML:{Ze(e,t);break}case D.BASE:case D.BASEFONT:case D.BGSOUND:case D.LINK:case D.META:{e._appendElement(t,ce.HTML),t.ackSelfClosing=!0;break}case D.TITLE:{e._switchToTextParsing(t,ut.RCDATA);break}case D.NOSCRIPT:{e.options.scriptingEnabled?e._switchToTextParsing(t,ut.RAWTEXT):(e._insertElement(t,ce.HTML),e.insertionMode=te.IN_HEAD_NO_SCRIPT);break}case D.NOFRAMES:case D.STYLE:{e._switchToTextParsing(t,ut.RAWTEXT);break}case D.SCRIPT:{e._switchToTextParsing(t,ut.SCRIPT_DATA);break}case D.TEMPLATE:{e._insertTemplate(t),e.activeFormattingElements.insertMarker(),e.framesetOk=!1,e.insertionMode=te.IN_TEMPLATE,e.tmplInsertionModeStack.unshift(te.IN_TEMPLATE);break}case D.HEAD:{e._err(t,ue.misplacedStartTagForHeadElement);break}default:vn(e,t)}}function Qp(e,t){switch(t.tagID){case D.HEAD:{e.openElements.pop(),e.insertionMode=te.AFTER_HEAD;break}case D.BODY:case D.BR:case D.HTML:{vn(e,t);break}case D.TEMPLATE:{xr(e,t);break}default:e._err(t,ue.endTagWithoutMatchingOpenElement)}}function xr(e,t){e.openElements.tmplCount>0?(e.openElements.generateImpliedEndTagsThoroughly(),e.openElements.currentTagId!==D.TEMPLATE&&e._err(t,ue.closingOfElementWithOpenChildElements),e.openElements.popUntilTagNamePopped(D.TEMPLATE),e.activeFormattingElements.clearToLastMarker(),e.tmplInsertionModeStack.shift(),e._resetInsertionMode()):e._err(t,ue.endTagWithoutMatchingOpenElement)}function vn(e,t){e.openElements.pop(),e.insertionMode=te.AFTER_HEAD,e._processToken(t)}function zp(e,t){switch(t.tagID){case D.HTML:{Ze(e,t);break}case D.BASEFONT:case D.BGSOUND:case D.HEAD:case D.LINK:case D.META:case D.NOFRAMES:case D.STYLE:{Dt(e,t);break}case D.NOSCRIPT:{e._err(t,ue.nestedNoscriptInHead);break}default:pn(e,t)}}function qp(e,t){switch(t.tagID){case D.NOSCRIPT:{e.openElements.pop(),e.insertionMode=te.IN_HEAD;break}case D.BR:{pn(e,t);break}default:e._err(t,ue.endTagWithoutMatchingOpenElement)}}function pn(e,t){const r=t.type===Ce.EOF?ue.openElementsLeftAfterEof:ue.disallowedContentInNoscriptInHead;e._err(t,r),e.openElements.pop(),e.insertionMode=te.IN_HEAD,e._processToken(t)}function Jp(e,t){switch(t.tagID){case D.HTML:{Ze(e,t);break}case D.BODY:{e._insertElement(t,ce.HTML),e.framesetOk=!1,e.insertionMode=te.IN_BODY;break}case D.FRAMESET:{e._insertElement(t,ce.HTML),e.insertionMode=te.IN_FRAMESET;break}case D.BASE:case D.BASEFONT:case D.BGSOUND:case D.LINK:case D.META:case D.NOFRAMES:case D.SCRIPT:case D.STYLE:case D.TEMPLATE:case D.TITLE:{e._err(t,ue.abandonedHeadElementChild),e.openElements.push(e.headElement,D.HEAD),Dt(e,t),e.openElements.remove(e.headElement);break}case D.HEAD:{e._err(t,ue.misplacedStartTagForHeadElement);break}default:Tn(e,t)}}function Zp(e,t){switch(t.tagID){case D.BODY:case D.HTML:case D.BR:{Tn(e,t);break}case D.TEMPLATE:{xr(e,t);break}default:e._err(t,ue.endTagWithoutMatchingOpenElement)}}function Tn(e,t){e._insertFakeElement(se.BODY,D.BODY),e.insertionMode=te.IN_BODY,Yi(e,t)}function Yi(e,t){switch(t.type){case Ce.CHARACTER:{$c(e,t);break}case Ce.WHITESPACE_CHARACTER:{Xc(e,t);break}case Ce.COMMENT:{Xs(e,t);break}case Ce.START_TAG:{Ze(e,t);break}case Ce.END_TAG:{Vi(e,t);break}case Ce.EOF:{Jc(e,t);break}}}function Xc(e,t){e._reconstructActiveFormattingElements(),e._insertCharacters(t)}function $c(e,t){e._reconstructActiveFormattingElements(),e._insertCharacters(t),e.framesetOk=!1}function eT(e,t){e.openElements.tmplCount===0&&e.treeAdapter.adoptAttributes(e.openElements.items[0],t.attrs)}function tT(e,t){const r=e.openElements.tryPeekProperlyNestedBodyElement();r&&e.openElements.tmplCount===0&&(e.framesetOk=!1,e.treeAdapter.adoptAttributes(r,t.attrs))}function rT(e,t){const r=e.openElements.tryPeekProperlyNestedBodyElement();e.framesetOk&&r&&(e.treeAdapter.detachNode(r),e.openElements.popAllUpToHtmlElement(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_FRAMESET)}function nT(e,t){e.openElements.hasInButtonScope(D.P)&&e._closePElement(),e._insertElement(t,ce.HTML)}function iT(e,t){e.openElements.hasInButtonScope(D.P)&&e._closePElement(),Fc(e.openElements.currentTagId)&&e.openElements.pop(),e._insertElement(t,ce.HTML)}function sT(e,t){e.openElements.hasInButtonScope(D.P)&&e._closePElement(),e._insertElement(t,ce.HTML),e.skipNextNewLine=!0,e.framesetOk=!1}function aT(e,t){const r=e.openElements.tmplCount>0;(!e.formElement||r)&&(e.openElements.hasInButtonScope(D.P)&&e._closePElement(),e._insertElement(t,ce.HTML),r||(e.formElement=e.openElements.current))}function oT(e,t){e.framesetOk=!1;const r=t.tagID;for(let n=e.openElements.stackTop;n>=0;n--){const i=e.openElements.tagIDs[n];if(r===D.LI&&i===D.LI||(r===D.DD||r===D.DT)&&(i===D.DD||i===D.DT)){e.openElements.generateImpliedEndTagsWithExclusion(i),e.openElements.popUntilTagNamePopped(i);break}if(i!==D.ADDRESS&&i!==D.DIV&&i!==D.P&&e._isSpecialElement(e.openElements.items[n],i))break}e.openElements.hasInButtonScope(D.P)&&e._closePElement(),e._insertElement(t,ce.HTML)}function uT(e,t){e.openElements.hasInButtonScope(D.P)&&e._closePElement(),e._insertElement(t,ce.HTML),e.tokenizer.state=ut.PLAINTEXT}function lT(e,t){e.openElements.hasInScope(D.BUTTON)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(D.BUTTON)),e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.framesetOk=!1}function cT(e,t){const r=e.activeFormattingElements.getElementEntryInScopeWithTagName(se.A);r&&(ka(e,t),e.openElements.remove(r.element),e.activeFormattingElements.removeEntry(r)),e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function fT(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function dT(e,t){e._reconstructActiveFormattingElements(),e.openElements.hasInScope(D.NOBR)&&(ka(e,t),e._reconstructActiveFormattingElements()),e._insertElement(t,ce.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function hT(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.activeFormattingElements.insertMarker(),e.framesetOk=!1}function gT(e,t){e.treeAdapter.getDocumentMode(e.document)!==ot.QUIRKS&&e.openElements.hasInButtonScope(D.P)&&e._closePElement(),e._insertElement(t,ce.HTML),e.framesetOk=!1,e.insertionMode=te.IN_TABLE}function Qc(e,t){e._reconstructActiveFormattingElements(),e._appendElement(t,ce.HTML),e.framesetOk=!1,t.ackSelfClosing=!0}function zc(e){const t=Nc(e,nr.TYPE);return t!=null&&t.toLowerCase()===Pp}function mT(e,t){e._reconstructActiveFormattingElements(),e._appendElement(t,ce.HTML),zc(t)||(e.framesetOk=!1),t.ackSelfClosing=!0}function ET(e,t){e._appendElement(t,ce.HTML),t.ackSelfClosing=!0}function vT(e,t){e.openElements.hasInButtonScope(D.P)&&e._closePElement(),e._appendElement(t,ce.HTML),e.framesetOk=!1,t.ackSelfClosing=!0}function pT(e,t){t.tagName=se.IMG,t.tagID=D.IMG,Qc(e,t)}function TT(e,t){e._insertElement(t,ce.HTML),e.skipNextNewLine=!0,e.tokenizer.state=ut.RCDATA,e.originalInsertionMode=e.insertionMode,e.framesetOk=!1,e.insertionMode=te.TEXT}function _T(e,t){e.openElements.hasInButtonScope(D.P)&&e._closePElement(),e._reconstructActiveFormattingElements(),e.framesetOk=!1,e._switchToTextParsing(t,ut.RAWTEXT)}function AT(e,t){e.framesetOk=!1,e._switchToTextParsing(t,ut.RAWTEXT)}function mu(e,t){e._switchToTextParsing(t,ut.RAWTEXT)}function yT(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.framesetOk=!1,e.insertionMode=e.insertionMode===te.IN_TABLE||e.insertionMode===te.IN_CAPTION||e.insertionMode===te.IN_TABLE_BODY||e.insertionMode===te.IN_ROW||e.insertionMode===te.IN_CELL?te.IN_SELECT_IN_TABLE:te.IN_SELECT}function bT(e,t){e.openElements.currentTagId===D.OPTION&&e.openElements.pop(),e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML)}function ST(e,t){e.openElements.hasInScope(D.RUBY)&&e.openElements.generateImpliedEndTags(),e._insertElement(t,ce.HTML)}function IT(e,t){e.openElements.hasInScope(D.RUBY)&&e.openElements.generateImpliedEndTagsWithExclusion(D.RTC),e._insertElement(t,ce.HTML)}function xT(e,t){e._reconstructActiveFormattingElements(),Gc(t),Fa(t),t.selfClosing?e._appendElement(t,ce.MATHML):e._insertElement(t,ce.MATHML),t.ackSelfClosing=!0}function LT(e,t){e._reconstructActiveFormattingElements(),Yc(t),Fa(t),t.selfClosing?e._appendElement(t,ce.SVG):e._insertElement(t,ce.SVG),t.ackSelfClosing=!0}function Eu(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML)}function Ze(e,t){switch(t.tagID){case D.I:case D.S:case D.B:case D.U:case D.EM:case D.TT:case D.BIG:case D.CODE:case D.FONT:case D.SMALL:case D.STRIKE:case D.STRONG:{fT(e,t);break}case D.A:{cT(e,t);break}case D.H1:case D.H2:case D.H3:case D.H4:case D.H5:case D.H6:{iT(e,t);break}case D.P:case D.DL:case D.OL:case D.UL:case D.DIV:case D.DIR:case D.NAV:case D.MAIN:case D.MENU:case D.ASIDE:case D.CENTER:case D.FIGURE:case D.FOOTER:case D.HEADER:case D.HGROUP:case D.DIALOG:case D.DETAILS:case D.ADDRESS:case D.ARTICLE:case D.SECTION:case D.SUMMARY:case D.FIELDSET:case D.BLOCKQUOTE:case D.FIGCAPTION:{nT(e,t);break}case D.LI:case D.DD:case D.DT:{oT(e,t);break}case D.BR:case D.IMG:case D.WBR:case D.AREA:case D.EMBED:case D.KEYGEN:{Qc(e,t);break}case D.HR:{vT(e,t);break}case D.RB:case D.RTC:{ST(e,t);break}case D.RT:case D.RP:{IT(e,t);break}case D.PRE:case D.LISTING:{sT(e,t);break}case D.XMP:{_T(e,t);break}case D.SVG:{LT(e,t);break}case D.HTML:{eT(e,t);break}case D.BASE:case D.LINK:case D.META:case D.STYLE:case D.TITLE:case D.SCRIPT:case D.BGSOUND:case D.BASEFONT:case D.TEMPLATE:{Dt(e,t);break}case D.BODY:{tT(e,t);break}case D.FORM:{aT(e,t);break}case D.NOBR:{dT(e,t);break}case D.MATH:{xT(e,t);break}case D.TABLE:{gT(e,t);break}case D.INPUT:{mT(e,t);break}case D.PARAM:case D.TRACK:case D.SOURCE:{ET(e,t);break}case D.IMAGE:{pT(e,t);break}case D.BUTTON:{lT(e,t);break}case D.APPLET:case D.OBJECT:case D.MARQUEE:{hT(e,t);break}case D.IFRAME:{AT(e,t);break}case D.SELECT:{yT(e,t);break}case D.OPTION:case D.OPTGROUP:{bT(e,t);break}case D.NOEMBED:{mu(e,t);break}case D.FRAMESET:{rT(e,t);break}case D.TEXTAREA:{TT(e,t);break}case D.NOSCRIPT:{e.options.scriptingEnabled?mu(e,t):Eu(e,t);break}case D.PLAINTEXT:{uT(e,t);break}case D.COL:case D.TH:case D.TD:case D.TR:case D.HEAD:case D.FRAME:case D.TBODY:case D.TFOOT:case D.THEAD:case D.CAPTION:case D.COLGROUP:break;default:Eu(e,t)}}function CT(e,t){if(e.openElements.hasInScope(D.BODY)&&(e.insertionMode=te.AFTER_BODY,e.options.sourceCodeLocationInfo)){const r=e.openElements.tryPeekProperlyNestedBodyElement();r&&e._setEndLocation(r,t)}}function DT(e,t){e.openElements.hasInScope(D.BODY)&&(e.insertionMode=te.AFTER_BODY,of(e,t))}function RT(e,t){const r=t.tagID;e.openElements.hasInScope(r)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(r))}function OT(e){const t=e.openElements.tmplCount>0,{formElement:r}=e;t||(e.formElement=null),(r||t)&&e.openElements.hasInScope(D.FORM)&&(e.openElements.generateImpliedEndTags(),t?e.openElements.popUntilTagNamePopped(D.FORM):r&&e.openElements.remove(r))}function PT(e){e.openElements.hasInButtonScope(D.P)||e._insertFakeElement(se.P,D.P),e._closePElement()}function MT(e){e.openElements.hasInListItemScope(D.LI)&&(e.openElements.generateImpliedEndTagsWithExclusion(D.LI),e.openElements.popUntilTagNamePopped(D.LI))}function NT(e,t){const r=t.tagID;e.openElements.hasInScope(r)&&(e.openElements.generateImpliedEndTagsWithExclusion(r),e.openElements.popUntilTagNamePopped(r))}function FT(e){e.openElements.hasNumberedHeaderInScope()&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilNumberedHeaderPopped())}function kT(e,t){const r=t.tagID;e.openElements.hasInScope(r)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(r),e.activeFormattingElements.clearToLastMarker())}function BT(e){e._reconstructActiveFormattingElements(),e._insertFakeElement(se.BR,D.BR),e.openElements.pop(),e.framesetOk=!1}function qc(e,t){const r=t.tagName,n=t.tagID;for(let i=e.openElements.stackTop;i>0;i--){const u=e.openElements.items[i],x=e.openElements.tagIDs[i];if(n===x&&(n!==D.UNKNOWN||e.treeAdapter.getTagName(u)===r)){e.openElements.generateImpliedEndTagsWithExclusion(n),e.openElements.stackTop>=i&&e.openElements.shortenToLength(i);break}if(e._isSpecialElement(u,x))break}}function Vi(e,t){switch(t.tagID){case D.A:case D.B:case D.I:case D.S:case D.U:case D.EM:case D.TT:case D.BIG:case D.CODE:case D.FONT:case D.NOBR:case D.SMALL:case D.STRIKE:case D.STRONG:{ka(e,t);break}case D.P:{PT(e);break}case D.DL:case D.UL:case D.OL:case D.DIR:case D.DIV:case D.NAV:case D.PRE:case D.MAIN:case D.MENU:case D.ASIDE:case D.BUTTON:case D.CENTER:case D.FIGURE:case D.FOOTER:case D.HEADER:case D.HGROUP:case D.DIALOG:case D.ADDRESS:case D.ARTICLE:case D.DETAILS:case D.SECTION:case D.SUMMARY:case D.LISTING:case D.FIELDSET:case D.BLOCKQUOTE:case D.FIGCAPTION:{RT(e,t);break}case D.LI:{MT(e);break}case D.DD:case D.DT:{NT(e,t);break}case D.H1:case D.H2:case D.H3:case D.H4:case D.H5:case D.H6:{FT(e);break}case D.BR:{BT(e);break}case D.BODY:{CT(e,t);break}case D.HTML:{DT(e,t);break}case D.FORM:{OT(e);break}case D.APPLET:case D.OBJECT:case D.MARQUEE:{kT(e,t);break}case D.TEMPLATE:{xr(e,t);break}default:qc(e,t)}}function Jc(e,t){e.tmplInsertionModeStack.length>0?af(e,t):Ba(e,t)}function wT(e,t){var r;t.tagID===D.SCRIPT&&((r=e.scriptHandler)===null||r===void 0||r.call(e,e.openElements.current)),e.openElements.pop(),e.insertionMode=e.originalInsertionMode}function UT(e,t){e._err(t,ue.eofInElementThatCanContainOnlyText),e.openElements.pop(),e.insertionMode=e.originalInsertionMode,e.onEof(t)}function Es(e,t){if(Vc.has(e.openElements.currentTagId))switch(e.pendingCharacterTokens.length=0,e.hasNonWhitespacePendingCharacterToken=!1,e.originalInsertionMode=e.insertionMode,e.insertionMode=te.IN_TABLE_TEXT,t.type){case Ce.CHARACTER:{ef(e,t);break}case Ce.WHITESPACE_CHARACTER:{Zc(e,t);break}}else kn(e,t)}function HT(e,t){e.openElements.clearBackToTableContext(),e.activeFormattingElements.insertMarker(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_CAPTION}function KT(e,t){e.openElements.clearBackToTableContext(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_COLUMN_GROUP}function WT(e,t){e.openElements.clearBackToTableContext(),e._insertFakeElement(se.COLGROUP,D.COLGROUP),e.insertionMode=te.IN_COLUMN_GROUP,wa(e,t)}function GT(e,t){e.openElements.clearBackToTableContext(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_TABLE_BODY}function YT(e,t){e.openElements.clearBackToTableContext(),e._insertFakeElement(se.TBODY,D.TBODY),e.insertionMode=te.IN_TABLE_BODY,ji(e,t)}function VT(e,t){e.openElements.hasInTableScope(D.TABLE)&&(e.openElements.popUntilTagNamePopped(D.TABLE),e._resetInsertionMode(),e._processStartTag(t))}function jT(e,t){zc(t)?e._appendElement(t,ce.HTML):kn(e,t),t.ackSelfClosing=!0}function XT(e,t){!e.formElement&&e.openElements.tmplCount===0&&(e._insertElement(t,ce.HTML),e.formElement=e.openElements.current,e.openElements.pop())}function Xr(e,t){switch(t.tagID){case D.TD:case D.TH:case D.TR:{YT(e,t);break}case D.STYLE:case D.SCRIPT:case D.TEMPLATE:{Dt(e,t);break}case D.COL:{WT(e,t);break}case D.FORM:{XT(e,t);break}case D.TABLE:{VT(e,t);break}case D.TBODY:case D.TFOOT:case D.THEAD:{GT(e,t);break}case D.INPUT:{jT(e,t);break}case D.CAPTION:{HT(e,t);break}case D.COLGROUP:{KT(e,t);break}default:kn(e,t)}}function Rn(e,t){switch(t.tagID){case D.TABLE:{e.openElements.hasInTableScope(D.TABLE)&&(e.openElements.popUntilTagNamePopped(D.TABLE),e._resetInsertionMode());break}case D.TEMPLATE:{xr(e,t);break}case D.BODY:case D.CAPTION:case D.COL:case D.COLGROUP:case D.HTML:case D.TBODY:case D.TD:case D.TFOOT:case D.TH:case D.THEAD:case D.TR:break;default:kn(e,t)}}function kn(e,t){const r=e.fosterParentingEnabled;e.fosterParentingEnabled=!0,Yi(e,t),e.fosterParentingEnabled=r}function Zc(e,t){e.pendingCharacterTokens.push(t)}function ef(e,t){e.pendingCharacterTokens.push(t),e.hasNonWhitespacePendingCharacterToken=!0}function sn(e,t){let r=0;if(e.hasNonWhitespacePendingCharacterToken)for(;r<e.pendingCharacterTokens.length;r++)kn(e,e.pendingCharacterTokens[r]);else for(;r<e.pendingCharacterTokens.length;r++)e._insertCharacters(e.pendingCharacterTokens[r]);e.insertionMode=e.originalInsertionMode,e._processToken(t)}const tf=new Set([D.CAPTION,D.COL,D.COLGROUP,D.TBODY,D.TD,D.TFOOT,D.TH,D.THEAD,D.TR]);function $T(e,t){const r=t.tagID;tf.has(r)?e.openElements.hasInTableScope(D.CAPTION)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(D.CAPTION),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=te.IN_TABLE,Xr(e,t)):Ze(e,t)}function QT(e,t){const r=t.tagID;switch(r){case D.CAPTION:case D.TABLE:{e.openElements.hasInTableScope(D.CAPTION)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(D.CAPTION),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=te.IN_TABLE,r===D.TABLE&&Rn(e,t));break}case D.BODY:case D.COL:case D.COLGROUP:case D.HTML:case D.TBODY:case D.TD:case D.TFOOT:case D.TH:case D.THEAD:case D.TR:break;default:Vi(e,t)}}function wa(e,t){switch(t.tagID){case D.HTML:{Ze(e,t);break}case D.COL:{e._appendElement(t,ce.HTML),t.ackSelfClosing=!0;break}case D.TEMPLATE:{Dt(e,t);break}default:Ai(e,t)}}function zT(e,t){switch(t.tagID){case D.COLGROUP:{e.openElements.currentTagId===D.COLGROUP&&(e.openElements.pop(),e.insertionMode=te.IN_TABLE);break}case D.TEMPLATE:{xr(e,t);break}case D.COL:break;default:Ai(e,t)}}function Ai(e,t){e.openElements.currentTagId===D.COLGROUP&&(e.openElements.pop(),e.insertionMode=te.IN_TABLE,e._processToken(t))}function ji(e,t){switch(t.tagID){case D.TR:{e.openElements.clearBackToTableBodyContext(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_ROW;break}case D.TH:case D.TD:{e.openElements.clearBackToTableBodyContext(),e._insertFakeElement(se.TR,D.TR),e.insertionMode=te.IN_ROW,Xi(e,t);break}case D.CAPTION:case D.COL:case D.COLGROUP:case D.TBODY:case D.TFOOT:case D.THEAD:{e.openElements.hasTableBodyContextInTableScope()&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE,Xr(e,t));break}default:Xr(e,t)}}function $s(e,t){const r=t.tagID;switch(t.tagID){case D.TBODY:case D.TFOOT:case D.THEAD:{e.openElements.hasInTableScope(r)&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE);break}case D.TABLE:{e.openElements.hasTableBodyContextInTableScope()&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE,Rn(e,t));break}case D.BODY:case D.CAPTION:case D.COL:case D.COLGROUP:case D.HTML:case D.TD:case D.TH:case D.TR:break;default:Rn(e,t)}}function Xi(e,t){switch(t.tagID){case D.TH:case D.TD:{e.openElements.clearBackToTableRowContext(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_CELL,e.activeFormattingElements.insertMarker();break}case D.CAPTION:case D.COL:case D.COLGROUP:case D.TBODY:case D.TFOOT:case D.THEAD:case D.TR:{e.openElements.hasInTableScope(D.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE_BODY,ji(e,t));break}default:Xr(e,t)}}function rf(e,t){switch(t.tagID){case D.TR:{e.openElements.hasInTableScope(D.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE_BODY);break}case D.TABLE:{e.openElements.hasInTableScope(D.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE_BODY,$s(e,t));break}case D.TBODY:case D.TFOOT:case D.THEAD:{(e.openElements.hasInTableScope(t.tagID)||e.openElements.hasInTableScope(D.TR))&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE_BODY,$s(e,t));break}case D.BODY:case D.CAPTION:case D.COL:case D.COLGROUP:case D.HTML:case D.TD:case D.TH:break;default:Rn(e,t)}}function qT(e,t){const r=t.tagID;tf.has(r)?(e.openElements.hasInTableScope(D.TD)||e.openElements.hasInTableScope(D.TH))&&(e._closeTableCell(),Xi(e,t)):Ze(e,t)}function JT(e,t){const r=t.tagID;switch(r){case D.TD:case D.TH:{e.openElements.hasInTableScope(r)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(r),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=te.IN_ROW);break}case D.TABLE:case D.TBODY:case D.TFOOT:case D.THEAD:case D.TR:{e.openElements.hasInTableScope(r)&&(e._closeTableCell(),rf(e,t));break}case D.BODY:case D.CAPTION:case D.COL:case D.COLGROUP:case D.HTML:break;default:Vi(e,t)}}function nf(e,t){switch(t.tagID){case D.HTML:{Ze(e,t);break}case D.OPTION:{e.openElements.currentTagId===D.OPTION&&e.openElements.pop(),e._insertElement(t,ce.HTML);break}case D.OPTGROUP:{e.openElements.currentTagId===D.OPTION&&e.openElements.pop(),e.openElements.currentTagId===D.OPTGROUP&&e.openElements.pop(),e._insertElement(t,ce.HTML);break}case D.INPUT:case D.KEYGEN:case D.TEXTAREA:case D.SELECT:{e.openElements.hasInSelectScope(D.SELECT)&&(e.openElements.popUntilTagNamePopped(D.SELECT),e._resetInsertionMode(),t.tagID!==D.SELECT&&e._processStartTag(t));break}case D.SCRIPT:case D.TEMPLATE:{Dt(e,t);break}}}function sf(e,t){switch(t.tagID){case D.OPTGROUP:{e.openElements.stackTop>0&&e.openElements.currentTagId===D.OPTION&&e.openElements.tagIDs[e.openElements.stackTop-1]===D.OPTGROUP&&e.openElements.pop(),e.openElements.currentTagId===D.OPTGROUP&&e.openElements.pop();break}case D.OPTION:{e.openElements.currentTagId===D.OPTION&&e.openElements.pop();break}case D.SELECT:{e.openElements.hasInSelectScope(D.SELECT)&&(e.openElements.popUntilTagNamePopped(D.SELECT),e._resetInsertionMode());break}case D.TEMPLATE:{xr(e,t);break}}}function ZT(e,t){const r=t.tagID;r===D.CAPTION||r===D.TABLE||r===D.TBODY||r===D.TFOOT||r===D.THEAD||r===D.TR||r===D.TD||r===D.TH?(e.openElements.popUntilTagNamePopped(D.SELECT),e._resetInsertionMode(),e._processStartTag(t)):nf(e,t)}function e_(e,t){const r=t.tagID;r===D.CAPTION||r===D.TABLE||r===D.TBODY||r===D.TFOOT||r===D.THEAD||r===D.TR||r===D.TD||r===D.TH?e.openElements.hasInTableScope(r)&&(e.openElements.popUntilTagNamePopped(D.SELECT),e._resetInsertionMode(),e.onEndTag(t)):sf(e,t)}function t_(e,t){switch(t.tagID){case D.BASE:case D.BASEFONT:case D.BGSOUND:case D.LINK:case D.META:case D.NOFRAMES:case D.SCRIPT:case D.STYLE:case D.TEMPLATE:case D.TITLE:{Dt(e,t);break}case D.CAPTION:case D.COLGROUP:case D.TBODY:case D.TFOOT:case D.THEAD:{e.tmplInsertionModeStack[0]=te.IN_TABLE,e.insertionMode=te.IN_TABLE,Xr(e,t);break}case D.COL:{e.tmplInsertionModeStack[0]=te.IN_COLUMN_GROUP,e.insertionMode=te.IN_COLUMN_GROUP,wa(e,t);break}case D.TR:{e.tmplInsertionModeStack[0]=te.IN_TABLE_BODY,e.insertionMode=te.IN_TABLE_BODY,ji(e,t);break}case D.TD:case D.TH:{e.tmplInsertionModeStack[0]=te.IN_ROW,e.insertionMode=te.IN_ROW,Xi(e,t);break}default:e.tmplInsertionModeStack[0]=te.IN_BODY,e.insertionMode=te.IN_BODY,Ze(e,t)}}function r_(e,t){t.tagID===D.TEMPLATE&&xr(e,t)}function af(e,t){e.openElements.tmplCount>0?(e.openElements.popUntilTagNamePopped(D.TEMPLATE),e.activeFormattingElements.clearToLastMarker(),e.tmplInsertionModeStack.shift(),e._resetInsertionMode(),e.onEof(t)):Ba(e,t)}function n_(e,t){t.tagID===D.HTML?Ze(e,t):yi(e,t)}function of(e,t){var r;if(t.tagID===D.HTML){if(e.fragmentContext||(e.insertionMode=te.AFTER_AFTER_BODY),e.options.sourceCodeLocationInfo&&e.openElements.tagIDs[0]===D.HTML){e._setEndLocation(e.openElements.items[0],t);const n=e.openElements.items[1];n&&!(!((r=e.treeAdapter.getNodeSourceCodeLocation(n))===null||r===void 0)&&r.endTag)&&e._setEndLocation(n,t)}}else yi(e,t)}function yi(e,t){e.insertionMode=te.IN_BODY,Yi(e,t)}function i_(e,t){switch(t.tagID){case D.HTML:{Ze(e,t);break}case D.FRAMESET:{e._insertElement(t,ce.HTML);break}case D.FRAME:{e._appendElement(t,ce.HTML),t.ackSelfClosing=!0;break}case D.NOFRAMES:{Dt(e,t);break}}}function s_(e,t){t.tagID===D.FRAMESET&&!e.openElements.isRootHtmlElementCurrent()&&(e.openElements.pop(),!e.fragmentContext&&e.openElements.currentTagId!==D.FRAMESET&&(e.insertionMode=te.AFTER_FRAMESET))}function a_(e,t){switch(t.tagID){case D.HTML:{Ze(e,t);break}case D.NOFRAMES:{Dt(e,t);break}}}function o_(e,t){t.tagID===D.HTML&&(e.insertionMode=te.AFTER_AFTER_FRAMESET)}function u_(e,t){t.tagID===D.HTML?Ze(e,t):si(e,t)}function si(e,t){e.insertionMode=te.IN_BODY,Yi(e,t)}function l_(e,t){switch(t.tagID){case D.HTML:{Ze(e,t);break}case D.NOFRAMES:{Dt(e,t);break}}}function c_(e,t){t.chars=we,e._insertCharacters(t)}function f_(e,t){e._insertCharacters(t),e.framesetOk=!1}function uf(e){for(;e.treeAdapter.getNamespaceURI(e.openElements.current)!==ce.HTML&&!e._isIntegrationPoint(e.openElements.currentTagId,e.openElements.current);)e.openElements.pop()}function d_(e,t){if(Lp(t))uf(e),e._startTagOutsideForeignContent(t);else{const r=e._getAdjustedCurrentElement(),n=e.treeAdapter.getNamespaceURI(r);n===ce.MATHML?Gc(t):n===ce.SVG&&(Cp(t),Yc(t)),Fa(t),t.selfClosing?e._appendElement(t,n):e._insertElement(t,n),t.ackSelfClosing=!0}}function h_(e,t){if(t.tagID===D.P||t.tagID===D.BR){uf(e),e._endTagOutsideForeignContent(t);return}for(let r=e.openElements.stackTop;r>0;r--){const n=e.openElements.items[r];if(e.treeAdapter.getNamespaceURI(n)===ce.HTML){e._endTagOutsideForeignContent(t);break}const i=e.treeAdapter.getTagName(n);if(i.toLowerCase()===t.tagName){t.tagName=i,e.openElements.shortenToLength(r);break}}}const g_=new Set([se.AREA,se.BASE,se.BASEFONT,se.BGSOUND,se.BR,se.COL,se.EMBED,se.FRAME,se.HR,se.IMG,se.INPUT,se.KEYGEN,se.LINK,se.META,se.PARAM,se.SOURCE,se.TRACK,se.WBR]);function m_(e,t){return t.treeAdapter.isElementNode(e)&&t.treeAdapter.getNamespaceURI(e)===ce.HTML&&g_.has(t.treeAdapter.getTagName(e))}const E_={treeAdapter:Er,scriptingEnabled:!0};function v_(e,t){const r={...E_,...t};return lf(e,r)}function p_(e,t){let r="";const n=t.treeAdapter.isElementNode(e)&&t.treeAdapter.getTagName(e)===se.TEMPLATE&&t.treeAdapter.getNamespaceURI(e)===ce.HTML?t.treeAdapter.getTemplateContent(e):e,i=t.treeAdapter.getChildNodes(n);if(i)for(const u of i)r+=lf(u,t);return r}function lf(e,t){return t.treeAdapter.isElementNode(e)?T_(e,t):t.treeAdapter.isTextNode(e)?A_(e,t):t.treeAdapter.isCommentNode(e)?y_(e,t):t.treeAdapter.isDocumentTypeNode(e)?b_(e,t):""}function T_(e,t){const r=t.treeAdapter.getTagName(e);return`<${r}${__(e,t)}>${m_(e,t)?"":`${p_(e,t)}</${r}>`}`}function __(e,{treeAdapter:t}){let r="";for(const n of t.getAttrList(e)){if(r+=" ",!n.namespace)r+=n.name;else switch(n.namespace){case ce.XML:{r+=`xml:${n.name}`;break}case ce.XMLNS:{n.name!=="xmlns"&&(r+="xmlns:"),r+=n.name;break}case ce.XLINK:{r+=`xlink:${n.name}`;break}default:r+=`${n.prefix}:${n.name}`}r+=`="${zl(n.value)}"`}return r}function A_(e,t){const{treeAdapter:r}=t,n=r.getTextNodeContent(e),i=r.getParentNode(e),u=i&&r.isElementNode(i)&&r.getTagName(i);return u&&r.getNamespaceURI(i)===ce.HTML&&tp(u,t.scriptingEnabled)?n:ql(n)}function y_(e,{treeAdapter:t}){return`<!--${t.getCommentNodeContent(e)}-->`}function b_(e,{treeAdapter:t}){return`<!DOCTYPE ${t.getDocumentTypeNodeName(e)}>`}function S_(e,t){return jc.parse(e,t)}function I_(e,t,r){typeof e=="string"&&(r=t,t=e,e=null);const n=jc.getFragmentParser(e,r);return n.tokenizer.write(t,!0),n.getFragment()}function vu(e){return new Ln(e)}function pu(e){const t=e.includes('"')?"'":'"';return t+e+t}function x_(e,t,r){let n="!DOCTYPE ";return e&&(n+=e),t?n+=` PUBLIC ${pu(t)}`:r&&(n+=" SYSTEM"),r&&(n+=` ${pu(r)}`),n}const Mr={isCommentNode:ki,isElementNode:be,isTextNode:Bt,createDocument(){const e=new yr([]);return e["x-mode"]=ot.NO_QUIRKS,e},createDocumentFragment(){return new yr([])},createElement(e,t,r){const n=Object.create(null),i=Object.create(null),u=Object.create(null);for(let b=0;b<r.length;b++){const s=r[b].name;n[s]=r[b].value,i[s]=r[b].namespace,u[s]=r[b].prefix}const x=new ba(e,n,[]);return x.namespace=t,x["x-attribsNamespace"]=i,x["x-attribsPrefix"]=u,x},createCommentNode(e){return new _a(e)},appendChild(e,t){const r=e.children[e.children.length-1];r&&(r.next=t,t.prev=r),e.children.push(t),t.parent=e},insertBefore(e,t,r){const n=e.children.indexOf(r),{prev:i}=r;i&&(i.next=t,t.prev=i),r.prev=t,t.next=r,e.children.splice(n,0,t),t.parent=e},setTemplateContent(e,t){Mr.appendChild(e,t)},getTemplateContent(e){return e.children[0]},setDocumentType(e,t,r,n){const i=x_(t,r,n);let u=e.children.find(x=>Us(x)&&x.name==="!doctype");u?u.data=i??null:(u=new Aa("!doctype",i),Mr.appendChild(e,u)),u["x-name"]=t??void 0,u["x-publicId"]=r??void 0,u["x-systemId"]=n??void 0},setDocumentMode(e,t){e["x-mode"]=t},getDocumentMode(e){return e["x-mode"]},detachNode(e){if(e.parent){const t=e.parent.children.indexOf(e),{prev:r,next:n}=e;e.prev=null,e.next=null,r&&(r.next=n),n&&(n.prev=r),e.parent.children.splice(t,1),e.parent=null}},insertText(e,t){const r=e.children[e.children.length-1];r&&Bt(r)?r.data+=t:Mr.appendChild(e,vu(t))},insertTextBefore(e,t,r){const n=e.children[e.children.indexOf(r)-1];n&&Bt(n)?n.data+=t:Mr.insertBefore(e,vu(t),r)},adoptAttributes(e,t){for(let r=0;r<t.length;r++){const n=t[r].name;typeof e.attribs[n]>"u"&&(e.attribs[n]=t[r].value,e["x-attribsNamespace"][n]=t[r].namespace,e["x-attribsPrefix"][n]=t[r].prefix)}},getFirstChild(e){return e.children[0]},getChildNodes(e){return e.children},getParentNode(e){return e.parent},getAttrList(e){return e.attributes},getTagName(e){return e.name},getNamespaceURI(e){return e.namespace},getTextNodeContent(e){return e.data},getCommentNodeContent(e){return e.data},getDocumentTypeNodeName(e){var t;return(t=e["x-name"])!==null&&t!==void 0?t:""},getDocumentTypeNodePublicId(e){var t;return(t=e["x-publicId"])!==null&&t!==void 0?t:""},getDocumentTypeNodeSystemId(e){var t;return(t=e["x-systemId"])!==null&&t!==void 0?t:""},isDocumentTypeNode(e){return Us(e)&&e.name==="!doctype"},setNodeSourceCodeLocation(e,t){t&&(e.startIndex=t.startOffset,e.endIndex=t.endOffset),e.sourceCodeLocation=t},getNodeSourceCodeLocation(e){return e.sourceCodeLocation},updateNodeSourceCodeLocation(e,t){t.endOffset!=null&&(e.endIndex=t.endOffset),e.sourceCodeLocation={...e.sourceCodeLocation,...t}}};function L_(e,t,r,n){const i={scriptingEnabled:typeof t.scriptingEnabled=="boolean"?t.scriptingEnabled:!0,treeAdapter:Mr,sourceCodeLocationInfo:t.sourceCodeLocationInfo};return r?S_(e,i):I_(n,e,i)}const C_={treeAdapter:Mr};function D_(e){const t="length"in e?e:[e];for(let n=0;n<t.length;n+=1){const i=t[n];Sr(i)&&Array.prototype.splice.call(t,n,1,...i.children)}let r="";for(let n=0;n<t.length;n+=1){const i=t[n];r+=v_(i,C_)}return r}var ve;(function(e){e[e.Tab=9]="Tab",e[e.NewLine=10]="NewLine",e[e.FormFeed=12]="FormFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.Num=35]="Num",e[e.Amp=38]="Amp",e[e.SingleQuote=39]="SingleQuote",e[e.DoubleQuote=34]="DoubleQuote",e[e.Dash=45]="Dash",e[e.Slash=47]="Slash",e[e.Zero=48]="Zero",e[e.Nine=57]="Nine",e[e.Semi=59]="Semi",e[e.Lt=60]="Lt",e[e.Eq=61]="Eq",e[e.Gt=62]="Gt",e[e.Questionmark=63]="Questionmark",e[e.UpperA=65]="UpperA",e[e.LowerA=97]="LowerA",e[e.UpperF=70]="UpperF",e[e.LowerF=102]="LowerF",e[e.UpperZ=90]="UpperZ",e[e.LowerZ=122]="LowerZ",e[e.LowerX=120]="LowerX",e[e.OpeningSquareBracket=91]="OpeningSquareBracket"})(ve||(ve={}));var fe;(function(e){e[e.Text=1]="Text",e[e.BeforeTagName=2]="BeforeTagName",e[e.InTagName=3]="InTagName",e[e.InSelfClosingTag=4]="InSelfClosingTag",e[e.BeforeClosingTagName=5]="BeforeClosingTagName",e[e.InClosingTagName=6]="InClosingTagName",e[e.AfterClosingTagName=7]="AfterClosingTagName",e[e.BeforeAttributeName=8]="BeforeAttributeName",e[e.InAttributeName=9]="InAttributeName",e[e.AfterAttributeName=10]="AfterAttributeName",e[e.BeforeAttributeValue=11]="BeforeAttributeValue",e[e.InAttributeValueDq=12]="InAttributeValueDq",e[e.InAttributeValueSq=13]="InAttributeValueSq",e[e.InAttributeValueNq=14]="InAttributeValueNq",e[e.BeforeDeclaration=15]="BeforeDeclaration",e[e.InDeclaration=16]="InDeclaration",e[e.InProcessingInstruction=17]="InProcessingInstruction",e[e.BeforeComment=18]="BeforeComment",e[e.CDATASequence=19]="CDATASequence",e[e.InSpecialComment=20]="InSpecialComment",e[e.InCommentLike=21]="InCommentLike",e[e.BeforeSpecialS=22]="BeforeSpecialS",e[e.SpecialStartSequence=23]="SpecialStartSequence",e[e.InSpecialTag=24]="InSpecialTag",e[e.BeforeEntity=25]="BeforeEntity",e[e.BeforeNumericEntity=26]="BeforeNumericEntity",e[e.InNamedEntity=27]="InNamedEntity",e[e.InNumericEntity=28]="InNumericEntity",e[e.InHexEntity=29]="InHexEntity"})(fe||(fe={}));function Kt(e){return e===ve.Space||e===ve.NewLine||e===ve.Tab||e===ve.FormFeed||e===ve.CarriageReturn}function zn(e){return e===ve.Slash||e===ve.Gt||Kt(e)}function Tu(e){return e>=ve.Zero&&e<=ve.Nine}function R_(e){return e>=ve.LowerA&&e<=ve.LowerZ||e>=ve.UpperA&&e<=ve.UpperZ}function O_(e){return e>=ve.UpperA&&e<=ve.UpperF||e>=ve.LowerA&&e<=ve.LowerF}var Ft;(function(e){e[e.NoValue=0]="NoValue",e[e.Unquoted=1]="Unquoted",e[e.Single=2]="Single",e[e.Double=3]="Double"})(Ft||(Ft={}));const it={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])};class P_{constructor({xmlMode:t=!1,decodeEntities:r=!0},n){this.cbs=n,this.state=fe.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=fe.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=t,this.decodeEntities=r,this.entityTrie=t?zg:qt}reset(){this.state=fe.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=fe.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(t){this.offset+=this.buffer.length,this.buffer=t,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}getIndex(){return this.index}getSectionStart(){return this.sectionStart}stateText(t){t===ve.Lt||!this.decodeEntities&&this.fastForwardTo(ve.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=fe.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&t===ve.Amp&&(this.state=fe.BeforeEntity)}stateSpecialStartSequence(t){const r=this.sequenceIndex===this.currentSequence.length;if(!(r?zn(t):(t|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!r){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=fe.InTagName,this.stateInTagName(t)}stateInSpecialTag(t){if(this.sequenceIndex===this.currentSequence.length){if(t===ve.Gt||Kt(t)){const r=this.index-this.currentSequence.length;if(this.sectionStart<r){const n=this.index;this.index=r,this.cbs.ontext(this.sectionStart,r),this.index=n}this.isSpecial=!1,this.sectionStart=r+2,this.stateInClosingTagName(t);return}this.sequenceIndex=0}(t|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===it.TitleEnd?this.decodeEntities&&t===ve.Amp&&(this.state=fe.BeforeEntity):this.fastForwardTo(ve.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=Number(t===ve.Lt)}stateCDATASequence(t){t===it.Cdata[this.sequenceIndex]?++this.sequenceIndex===it.Cdata.length&&(this.state=fe.InCommentLike,this.currentSequence=it.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=fe.InDeclaration,this.stateInDeclaration(t))}fastForwardTo(t){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===t)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(t){t===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===it.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=fe.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):t!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(t){return this.xmlMode?!zn(t):R_(t)}startSpecial(t,r){this.isSpecial=!0,this.currentSequence=t,this.sequenceIndex=r,this.state=fe.SpecialStartSequence}stateBeforeTagName(t){if(t===ve.ExclamationMark)this.state=fe.BeforeDeclaration,this.sectionStart=this.index+1;else if(t===ve.Questionmark)this.state=fe.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(t)){const r=t|32;this.sectionStart=this.index,!this.xmlMode&&r===it.TitleEnd[2]?this.startSpecial(it.TitleEnd,3):this.state=!this.xmlMode&&r===it.ScriptEnd[2]?fe.BeforeSpecialS:fe.InTagName}else t===ve.Slash?this.state=fe.BeforeClosingTagName:(this.state=fe.Text,this.stateText(t))}stateInTagName(t){zn(t)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=fe.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateBeforeClosingTagName(t){Kt(t)||(t===ve.Gt?this.state=fe.Text:(this.state=this.isTagStartChar(t)?fe.InClosingTagName:fe.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(t){(t===ve.Gt||Kt(t))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=fe.AfterClosingTagName,this.stateAfterClosingTagName(t))}stateAfterClosingTagName(t){(t===ve.Gt||this.fastForwardTo(ve.Gt))&&(this.state=fe.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(t){t===ve.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=fe.InSpecialTag,this.sequenceIndex=0):this.state=fe.Text,this.baseState=this.state,this.sectionStart=this.index+1):t===ve.Slash?this.state=fe.InSelfClosingTag:Kt(t)||(this.state=fe.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(t){t===ve.Gt?(this.cbs.onselfclosingtag(this.index),this.state=fe.Text,this.baseState=fe.Text,this.sectionStart=this.index+1,this.isSpecial=!1):Kt(t)||(this.state=fe.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateInAttributeName(t){(t===ve.Eq||zn(t))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=fe.AfterAttributeName,this.stateAfterAttributeName(t))}stateAfterAttributeName(t){t===ve.Eq?this.state=fe.BeforeAttributeValue:t===ve.Slash||t===ve.Gt?(this.cbs.onattribend(Ft.NoValue,this.index),this.state=fe.BeforeAttributeName,this.stateBeforeAttributeName(t)):Kt(t)||(this.cbs.onattribend(Ft.NoValue,this.index),this.state=fe.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(t){t===ve.DoubleQuote?(this.state=fe.InAttributeValueDq,this.sectionStart=this.index+1):t===ve.SingleQuote?(this.state=fe.InAttributeValueSq,this.sectionStart=this.index+1):Kt(t)||(this.sectionStart=this.index,this.state=fe.InAttributeValueNq,this.stateInAttributeValueNoQuotes(t))}handleInAttributeValue(t,r){t===r||!this.decodeEntities&&this.fastForwardTo(r)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(r===ve.DoubleQuote?Ft.Double:Ft.Single,this.index),this.state=fe.BeforeAttributeName):this.decodeEntities&&t===ve.Amp&&(this.baseState=this.state,this.state=fe.BeforeEntity)}stateInAttributeValueDoubleQuotes(t){this.handleInAttributeValue(t,ve.DoubleQuote)}stateInAttributeValueSingleQuotes(t){this.handleInAttributeValue(t,ve.SingleQuote)}stateInAttributeValueNoQuotes(t){Kt(t)||t===ve.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(Ft.Unquoted,this.index),this.state=fe.BeforeAttributeName,this.stateBeforeAttributeName(t)):this.decodeEntities&&t===ve.Amp&&(this.baseState=this.state,this.state=fe.BeforeEntity)}stateBeforeDeclaration(t){t===ve.OpeningSquareBracket?(this.state=fe.CDATASequence,this.sequenceIndex=0):this.state=t===ve.Dash?fe.BeforeComment:fe.InDeclaration}stateInDeclaration(t){(t===ve.Gt||this.fastForwardTo(ve.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=fe.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(t){(t===ve.Gt||this.fastForwardTo(ve.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=fe.Text,this.sectionStart=this.index+1)}stateBeforeComment(t){t===ve.Dash?(this.state=fe.InCommentLike,this.currentSequence=it.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=fe.InDeclaration}stateInSpecialComment(t){(t===ve.Gt||this.fastForwardTo(ve.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=fe.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(t){const r=t|32;r===it.ScriptEnd[3]?this.startSpecial(it.ScriptEnd,4):r===it.StyleEnd[3]?this.startSpecial(it.StyleEnd,4):(this.state=fe.InTagName,this.stateInTagName(t))}stateBeforeEntity(t){this.entityExcess=1,this.entityResult=0,t===ve.Num?this.state=fe.BeforeNumericEntity:t===ve.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=fe.InNamedEntity,this.stateInNamedEntity(t))}stateInNamedEntity(t){if(this.entityExcess+=1,this.trieIndex=Xl(this.entityTrie,this.trieCurrent,this.trieIndex+1,t),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];const r=this.trieCurrent&Vt.VALUE_LENGTH;if(r){const n=(r>>14)-1;if(!this.allowLegacyEntity()&&t!==ve.Semi)this.trieIndex+=n;else{const i=this.index-this.entityExcess+1;i>this.sectionStart&&this.emitPartial(this.sectionStart,i),this.entityResult=this.trieIndex,this.trieIndex+=n,this.entityExcess=0,this.sectionStart=this.index+1,n===0&&this.emitNamedEntity()}}}emitNamedEntity(){if(this.state=this.baseState,this.entityResult===0)return;switch((this.entityTrie[this.entityResult]&Vt.VALUE_LENGTH)>>14){case 1:this.emitCodePoint(this.entityTrie[this.entityResult]&~Vt.VALUE_LENGTH);break;case 2:this.emitCodePoint(this.entityTrie[this.entityResult+1]);break;case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}stateBeforeNumericEntity(t){(t|32)===ve.LowerX?(this.entityExcess++,this.state=fe.InHexEntity):(this.state=fe.InNumericEntity,this.stateInNumericEntity(t))}emitNumericEntity(t){const r=this.index-this.entityExcess-1;r+2+Number(this.state===fe.InHexEntity)!==this.index&&(r>this.sectionStart&&this.emitPartial(this.sectionStart,r),this.sectionStart=this.index+Number(t),this.emitCodePoint(Jg(this.entityResult))),this.state=this.baseState}stateInNumericEntity(t){t===ve.Semi?this.emitNumericEntity(!0):Tu(t)?(this.entityResult=this.entityResult*10+(t-ve.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}stateInHexEntity(t){t===ve.Semi?this.emitNumericEntity(!0):Tu(t)?(this.entityResult=this.entityResult*16+(t-ve.Zero),this.entityExcess++):O_(t)?(this.entityResult=this.entityResult*16+((t|32)-ve.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}allowLegacyEntity(){return!this.xmlMode&&(this.baseState===fe.Text||this.baseState===fe.InSpecialTag)}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===fe.Text||this.state===fe.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===fe.InAttributeValueDq||this.state===fe.InAttributeValueSq||this.state===fe.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const t=this.buffer.charCodeAt(this.index-this.offset);this.state===fe.Text?this.stateText(t):this.state===fe.SpecialStartSequence?this.stateSpecialStartSequence(t):this.state===fe.InSpecialTag?this.stateInSpecialTag(t):this.state===fe.CDATASequence?this.stateCDATASequence(t):this.state===fe.InAttributeValueDq?this.stateInAttributeValueDoubleQuotes(t):this.state===fe.InAttributeName?this.stateInAttributeName(t):this.state===fe.InCommentLike?this.stateInCommentLike(t):this.state===fe.InSpecialComment?this.stateInSpecialComment(t):this.state===fe.BeforeAttributeName?this.stateBeforeAttributeName(t):this.state===fe.InTagName?this.stateInTagName(t):this.state===fe.InClosingTagName?this.stateInClosingTagName(t):this.state===fe.BeforeTagName?this.stateBeforeTagName(t):this.state===fe.AfterAttributeName?this.stateAfterAttributeName(t):this.state===fe.InAttributeValueSq?this.stateInAttributeValueSingleQuotes(t):this.state===fe.BeforeAttributeValue?this.stateBeforeAttributeValue(t):this.state===fe.BeforeClosingTagName?this.stateBeforeClosingTagName(t):this.state===fe.AfterClosingTagName?this.stateAfterClosingTagName(t):this.state===fe.BeforeSpecialS?this.stateBeforeSpecialS(t):this.state===fe.InAttributeValueNq?this.stateInAttributeValueNoQuotes(t):this.state===fe.InSelfClosingTag?this.stateInSelfClosingTag(t):this.state===fe.InDeclaration?this.stateInDeclaration(t):this.state===fe.BeforeDeclaration?this.stateBeforeDeclaration(t):this.state===fe.BeforeComment?this.stateBeforeComment(t):this.state===fe.InProcessingInstruction?this.stateInProcessingInstruction(t):this.state===fe.InNamedEntity?this.stateInNamedEntity(t):this.state===fe.BeforeEntity?this.stateBeforeEntity(t):this.state===fe.InHexEntity?this.stateInHexEntity(t):this.state===fe.InNumericEntity?this.stateInNumericEntity(t):this.stateBeforeNumericEntity(t),this.index++}this.cleanup()}finish(){this.state===fe.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const t=this.buffer.length+this.offset;this.state===fe.InCommentLike?this.currentSequence===it.CdataEnd?this.cbs.oncdata(this.sectionStart,t,0):this.cbs.oncomment(this.sectionStart,t,0):this.state===fe.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===fe.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===fe.InTagName||this.state===fe.BeforeAttributeName||this.state===fe.BeforeAttributeValue||this.state===fe.AfterAttributeName||this.state===fe.InAttributeName||this.state===fe.InAttributeValueSq||this.state===fe.InAttributeValueDq||this.state===fe.InAttributeValueNq||this.state===fe.InClosingTagName||this.cbs.ontext(this.sectionStart,t)}emitPartial(t,r){this.baseState!==fe.Text&&this.baseState!==fe.InSpecialTag?this.cbs.onattribdata(t,r):this.cbs.ontext(t,r)}emitCodePoint(t){this.baseState!==fe.Text&&this.baseState!==fe.InSpecialTag?this.cbs.onattribentity(t):this.cbs.ontextentity(t)}}const Rr=new Set(["input","option","optgroup","select","button","datalist","textarea"]),Fe=new Set(["p"]),_u=new Set(["thead","tbody"]),Au=new Set(["dd","dt"]),yu=new Set(["rt","rp"]),M_=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",Fe],["h1",Fe],["h2",Fe],["h3",Fe],["h4",Fe],["h5",Fe],["h6",Fe],["select",Rr],["input",Rr],["output",Rr],["button",Rr],["datalist",Rr],["textarea",Rr],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",Au],["dt",Au],["address",Fe],["article",Fe],["aside",Fe],["blockquote",Fe],["details",Fe],["div",Fe],["dl",Fe],["fieldset",Fe],["figcaption",Fe],["figure",Fe],["footer",Fe],["form",Fe],["header",Fe],["hr",Fe],["main",Fe],["nav",Fe],["ol",Fe],["pre",Fe],["section",Fe],["table",Fe],["ul",Fe],["rt",yu],["rp",yu],["tbody",_u],["tfoot",_u]]),N_=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),bu=new Set(["math","svg"]),Su=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),F_=/\s|\//;class k_{constructor(t,r={}){var n,i,u,x,b;this.options=r,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=t??{},this.lowerCaseTagNames=(n=r.lowerCaseTags)!==null&&n!==void 0?n:!r.xmlMode,this.lowerCaseAttributeNames=(i=r.lowerCaseAttributeNames)!==null&&i!==void 0?i:!r.xmlMode,this.tokenizer=new((u=r.Tokenizer)!==null&&u!==void 0?u:P_)(this.options,this),(b=(x=this.cbs).onparserinit)===null||b===void 0||b.call(x,this)}ontext(t,r){var n,i;const u=this.getSlice(t,r);this.endIndex=r-1,(i=(n=this.cbs).ontext)===null||i===void 0||i.call(n,u),this.startIndex=r}ontextentity(t){var r,n;const i=this.tokenizer.getSectionStart();this.endIndex=i-1,(n=(r=this.cbs).ontext)===null||n===void 0||n.call(r,Vo(t)),this.startIndex=i}isVoidElement(t){return!this.options.xmlMode&&N_.has(t)}onopentagname(t,r){this.endIndex=r;let n=this.getSlice(t,r);this.lowerCaseTagNames&&(n=n.toLowerCase()),this.emitOpenTag(n)}emitOpenTag(t){var r,n,i,u;this.openTagStart=this.startIndex,this.tagname=t;const x=!this.options.xmlMode&&M_.get(t);if(x)for(;this.stack.length>0&&x.has(this.stack[this.stack.length-1]);){const b=this.stack.pop();(n=(r=this.cbs).onclosetag)===null||n===void 0||n.call(r,b,!0)}this.isVoidElement(t)||(this.stack.push(t),bu.has(t)?this.foreignContext.push(!0):Su.has(t)&&this.foreignContext.push(!1)),(u=(i=this.cbs).onopentagname)===null||u===void 0||u.call(i,t),this.cbs.onopentag&&(this.attribs={})}endOpenTag(t){var r,n;this.startIndex=this.openTagStart,this.attribs&&((n=(r=this.cbs).onopentag)===null||n===void 0||n.call(r,this.tagname,this.attribs,t),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(t){this.endIndex=t,this.endOpenTag(!1),this.startIndex=t+1}onclosetag(t,r){var n,i,u,x,b,s;this.endIndex=r;let C=this.getSlice(t,r);if(this.lowerCaseTagNames&&(C=C.toLowerCase()),(bu.has(C)||Su.has(C))&&this.foreignContext.pop(),this.isVoidElement(C))!this.options.xmlMode&&C==="br"&&((i=(n=this.cbs).onopentagname)===null||i===void 0||i.call(n,"br"),(x=(u=this.cbs).onopentag)===null||x===void 0||x.call(u,"br",{},!0),(s=(b=this.cbs).onclosetag)===null||s===void 0||s.call(b,"br",!1));else{const g=this.stack.lastIndexOf(C);if(g!==-1)if(this.cbs.onclosetag){let w=this.stack.length-g;for(;w--;)this.cbs.onclosetag(this.stack.pop(),w!==0)}else this.stack.length=g;else!this.options.xmlMode&&C==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=r+1}onselfclosingtag(t){this.endIndex=t,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=t+1):this.onopentagend(t)}closeCurrentTag(t){var r,n;const i=this.tagname;this.endOpenTag(t),this.stack[this.stack.length-1]===i&&((n=(r=this.cbs).onclosetag)===null||n===void 0||n.call(r,i,!t),this.stack.pop())}onattribname(t,r){this.startIndex=t;const n=this.getSlice(t,r);this.attribname=this.lowerCaseAttributeNames?n.toLowerCase():n}onattribdata(t,r){this.attribvalue+=this.getSlice(t,r)}onattribentity(t){this.attribvalue+=Vo(t)}onattribend(t,r){var n,i;this.endIndex=r,(i=(n=this.cbs).onattribute)===null||i===void 0||i.call(n,this.attribname,this.attribvalue,t===Ft.Double?'"':t===Ft.Single?"'":t===Ft.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(t){const r=t.search(F_);let n=r<0?t:t.substr(0,r);return this.lowerCaseTagNames&&(n=n.toLowerCase()),n}ondeclaration(t,r){this.endIndex=r;const n=this.getSlice(t,r);if(this.cbs.onprocessinginstruction){const i=this.getInstructionName(n);this.cbs.onprocessinginstruction(`!${i}`,`!${n}`)}this.startIndex=r+1}onprocessinginstruction(t,r){this.endIndex=r;const n=this.getSlice(t,r);if(this.cbs.onprocessinginstruction){const i=this.getInstructionName(n);this.cbs.onprocessinginstruction(`?${i}`,`?${n}`)}this.startIndex=r+1}oncomment(t,r,n){var i,u,x,b;this.endIndex=r,(u=(i=this.cbs).oncomment)===null||u===void 0||u.call(i,this.getSlice(t,r-n)),(b=(x=this.cbs).oncommentend)===null||b===void 0||b.call(x),this.startIndex=r+1}oncdata(t,r,n){var i,u,x,b,s,C,g,w,R,K;this.endIndex=r;const k=this.getSlice(t,r-n);this.options.xmlMode||this.options.recognizeCDATA?((u=(i=this.cbs).oncdatastart)===null||u===void 0||u.call(i),(b=(x=this.cbs).ontext)===null||b===void 0||b.call(x,k),(C=(s=this.cbs).oncdataend)===null||C===void 0||C.call(s)):((w=(g=this.cbs).oncomment)===null||w===void 0||w.call(g,`[CDATA[${k}]]`),(K=(R=this.cbs).oncommentend)===null||K===void 0||K.call(R)),this.startIndex=r+1}onend(){var t,r;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let n=this.stack.length;n>0;this.cbs.onclosetag(this.stack[--n],!0));}(r=(t=this.cbs).onend)===null||r===void 0||r.call(t)}reset(){var t,r,n,i;(r=(t=this.cbs).onreset)===null||r===void 0||r.call(t),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(i=(n=this.cbs).onparserinit)===null||i===void 0||i.call(n,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(t){this.reset(),this.end(t)}getSlice(t,r){for(;t-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let n=this.buffers[0].slice(t-this.bufferOffset,r-this.bufferOffset);for(;r-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),n+=this.buffers[0].slice(0,r-this.bufferOffset);return n}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(t){var r,n;if(this.ended){(n=(r=this.cbs).onerror)===null||n===void 0||n.call(r,new Error(".write() after done!"));return}this.buffers.push(t),this.tokenizer.running&&(this.tokenizer.write(t),this.writeIndex++)}end(t){var r,n;if(this.ended){(n=(r=this.cbs).onerror)===null||n===void 0||n.call(r,Error(".end() after done!"));return}t&&this.write(t),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(t){this.write(t)}done(t){this.end(t)}}function B_(e,t){const r=new Qg(void 0,t);return new k_(r,t).end(e),r.root}const w_=mv((e,t,r,n)=>t.xmlMode||t._useHtmlParser2?B_(e,t):L_(e,t,r,n)),U_=Vv(w_,(e,t)=>t.xmlMode||t._useHtmlParser2?Bi(e,t):D_(e));U_([]);var Qs={},H_={get exports(){return Qs},set exports(e){Qs=e}};(function(e,t){typeof window<"u"&&function(n,i){e.exports=i()}(sE,()=>(()=>{var r={"./src/config.ts":(x,b,s)=>{s.r(b),s.d(b,{enableStreamingMode:()=>_,hlsDefaultConfig:()=>T,mergeConfig:()=>a});var C=s("./src/controller/abr-controller.ts"),g=s("./src/controller/audio-stream-controller.ts"),w=s("./src/controller/audio-track-controller.ts"),R=s("./src/controller/subtitle-stream-controller.ts"),K=s("./src/controller/subtitle-track-controller.ts"),k=s("./src/controller/buffer-controller.ts"),F=s("./src/controller/timeline-controller.ts"),B=s("./src/controller/cap-level-controller.ts"),P=s("./src/controller/fps-controller.ts"),M=s("./src/controller/eme-controller.ts"),m=s("./src/controller/cmcd-controller.ts"),N=s("./src/utils/xhr-loader.ts"),I=s("./src/utils/fetch-loader.ts"),h=s("./src/utils/cues.ts"),E=s("./src/utils/mediakeys-helper.ts"),d=s("./src/utils/logger.ts");function c(){return c=Object.assign?Object.assign.bind():function(o){for(var A=1;A<arguments.length;A++){var O=arguments[A];for(var L in O)Object.prototype.hasOwnProperty.call(O,L)&&(o[L]=O[L])}return o},c.apply(this,arguments)}function S(o,A){var O=Object.keys(o);if(Object.getOwnPropertySymbols){var L=Object.getOwnPropertySymbols(o);A&&(L=L.filter(function(H){return Object.getOwnPropertyDescriptor(o,H).enumerable})),O.push.apply(O,L)}return O}function v(o){for(var A=1;A<arguments.length;A++){var O=arguments[A]!=null?arguments[A]:{};A%2?S(Object(O),!0).forEach(function(L){l(o,L,O[L])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(O)):S(Object(O)).forEach(function(L){Object.defineProperty(o,L,Object.getOwnPropertyDescriptor(O,L))})}return o}function l(o,A,O){return A=p(A),A in o?Object.defineProperty(o,A,{value:O,enumerable:!0,configurable:!0,writable:!0}):o[A]=O,o}function p(o){var A=y(o,"string");return typeof A=="symbol"?A:String(A)}function y(o,A){if(typeof o!="object"||o===null)return o;var O=o[Symbol.toPrimitive];if(O!==void 0){var L=O.call(o,A||"default");if(typeof L!="object")return L;throw new TypeError("@@toPrimitive must return a primitive value.")}return(A==="string"?String:Number)(o)}var T=v(v({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:N.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:C.default,bufferController:k.default,capLevelController:B.default,fpsController:P.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:E.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},f()),{},{subtitleStreamController:R.SubtitleStreamController,subtitleTrackController:K.default,timelineController:F.TimelineController,audioStreamController:g.default,audioTrackController:w.default,emeController:M.default,cmcdController:m.default});function f(){return{cueHandler:h.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function a(o,A){if((A.liveSyncDurationCount||A.liveMaxLatencyDurationCount)&&(A.liveSyncDuration||A.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(A.liveMaxLatencyDurationCount!==void 0&&(A.liveSyncDurationCount===void 0||A.liveMaxLatencyDurationCount<=A.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(A.liveMaxLatencyDuration!==void 0&&(A.liveSyncDuration===void 0||A.liveMaxLatencyDuration<=A.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return c({},o,A)}function _(o){var A=o.loader;if(A!==I.default&&A!==N.default)d.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),o.progressive=!1;else{var O=(0,I.fetchSupported)();O&&(o.loader=I.default,o.progressive=!0,o.enableSoftwareAES=!0,d.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>N});var C=s("./src/polyfills/number.ts"),g=s("./src/utils/ewma-bandwidth-estimator.ts"),w=s("./src/events.ts"),R=s("./src/errors.ts"),K=s("./src/types/loader.ts"),k=s("./src/utils/logger.ts");function F(I,h){for(var E=0;E<h.length;E++){var d=h[E];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(I,P(d.key),d)}}function B(I,h,E){return h&&F(I.prototype,h),E&&F(I,E),Object.defineProperty(I,"prototype",{writable:!1}),I}function P(I){var h=M(I,"string");return typeof h=="symbol"?h:String(h)}function M(I,h){if(typeof I!="object"||I===null)return I;var E=I[Symbol.toPrimitive];if(E!==void 0){var d=E.call(I,h||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(I)}var m=function(){function I(E){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=E;var d=E.config;this.bwEstimator=new g.default(d.abrEwmaSlowVoD,d.abrEwmaFastVoD,d.abrEwmaDefaultEstimate),this.registerListeners()}var h=I.prototype;return h.registerListeners=function(){var d=this.hls;d.on(w.Events.FRAG_LOADING,this.onFragLoading,this),d.on(w.Events.FRAG_LOADED,this.onFragLoaded,this),d.on(w.Events.FRAG_BUFFERED,this.onFragBuffered,this),d.on(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.on(w.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var d=this.hls;d.off(w.Events.FRAG_LOADING,this.onFragLoading,this),d.off(w.Events.FRAG_LOADED,this.onFragLoaded,this),d.off(w.Events.FRAG_BUFFERED,this.onFragBuffered,this),d.off(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.off(w.Events.ERROR,this.onError,this)},h.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},h.onFragLoading=function(d,c){var S=c.frag;if(S.type===K.PlaylistLevelType.MAIN&&!this.timer){var v;this.fragCurrent=S,this.partCurrent=(v=c.part)!=null?v:null,this.timer=self.setInterval(this.onCheck,100)}},h.onLevelLoaded=function(d,c){var S=this.hls.config;c.details.live?this.bwEstimator.update(S.abrEwmaSlowLive,S.abrEwmaFastLive):this.bwEstimator.update(S.abrEwmaSlowVoD,S.abrEwmaFastVoD)},h._abandonRulesCheck=function(){var d=this.fragCurrent,c=this.partCurrent,S=this.hls,v=S.autoLevelEnabled,l=S.media;if(!(!d||!l)){var p=c?c.stats:d.stats,y=c?c.duration:d.duration;if(p.aborted||p.loaded&&p.loaded===p.total||d.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!v||l.paused||!l.playbackRate||!l.readyState)){var T=S.mainForwardBufferInfo;if(T!==null){var f=performance.now()-p.loading.start,a=Math.abs(l.playbackRate);if(!(f<=500*y/a)){var _=p.loaded&&p.loading.first,o=this.bwEstimator.getEstimate(),A=S.levels,O=S.minAutoLevel,L=A[d.level],H=p.total||Math.max(p.loaded,Math.round(y*L.maxBitrate/8)),W=_?p.loaded*1e3/f:0,U=W?(H-p.loaded)/W:H*8/o,G=T.len/a;if(!(U<=G)){var Y=Number.POSITIVE_INFINITY,j;for(j=d.level-1;j>O;j--){var X=A[j].maxBitrate;if(Y=W?y*X/(8*.8*W):y*X/o,Y<G)break}Y>=U||(k.logger.warn("Fragment "+d.sn+(c?" part "+c.index:"")+" of level "+d.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+j+`
      Current BW estimate: `+((0,C.isFiniteNumber)(o)?(o/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+U.toFixed(3)+` s
      Estimated load time for the next fragment: `+Y.toFixed(3)+` s
      Time to underbuffer: `+G.toFixed(3)+" s"),S.nextLoadLevel=j,_&&this.bwEstimator.sample(f,p.loaded),this.clearTimer(),(d.loader||d.keyLoader)&&(this.fragCurrent=this.partCurrent=null,d.abortRequests()),S.trigger(w.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:d,part:c,stats:p}))}}}}}},h.onFragLoaded=function(d,c){var S=c.frag,v=c.part;if(S.type===K.PlaylistLevelType.MAIN&&(0,C.isFiniteNumber)(S.sn)){var l=v?v.stats:S.stats,p=v?v.duration:S.duration;if(this.clearTimer(),this.lastLoadedFragLevel=S.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var y=this.hls.levels[S.level],T=(y.loaded?y.loaded.bytes:0)+l.loaded,f=(y.loaded?y.loaded.duration:0)+p;y.loaded={bytes:T,duration:f},y.realBitrate=Math.round(8*T/f)}if(S.bitrateTest){var a={stats:l,frag:S,part:v,id:S.type};this.onFragBuffered(w.Events.FRAG_BUFFERED,a)}}},h.onFragBuffered=function(d,c){var S=c.frag,v=c.part,l=v?v.stats:S.stats;if(!l.aborted&&!(S.type!==K.PlaylistLevelType.MAIN||S.sn==="initSegment")){var p=l.parsing.end-l.loading.start;this.bwEstimator.sample(p,l.loaded),l.bwEstimate=this.bwEstimator.getEstimate(),S.bitrateTest?this.bitrateTestDelay=p/1e3:this.bitrateTestDelay=0}},h.onError=function(d,c){var S;if(((S=c.frag)===null||S===void 0?void 0:S.type)===K.PlaylistLevelType.MAIN){if(c.type===R.ErrorTypes.KEY_SYSTEM_ERROR){this.clearTimer();return}switch(c.details){case R.ErrorDetails.FRAG_LOAD_ERROR:case R.ErrorDetails.FRAG_LOAD_TIMEOUT:case R.ErrorDetails.KEY_LOAD_ERROR:case R.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer();break}}},h.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},h.getNextABRAutoLevel=function(){var d=this.fragCurrent,c=this.partCurrent,S=this.hls,v=S.maxAutoLevel,l=S.config,p=S.minAutoLevel,y=S.media,T=c?c.duration:d?d.duration:0,f=y&&y.playbackRate!==0?Math.abs(y.playbackRate):1,a=this.bwEstimator?this.bwEstimator.getEstimate():l.abrEwmaDefaultEstimate,_=S.mainForwardBufferInfo,o=(_?_.len:0)/f,A=this.findBestLevel(a,p,v,o,l.abrBandWidthFactor,l.abrBandWidthUpFactor);if(A>=0)return A;k.logger.trace((o?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var O=T?Math.min(T,l.maxStarvationDelay):l.maxStarvationDelay,L=l.abrBandWidthFactor,H=l.abrBandWidthUpFactor;if(!o){var W=this.bitrateTestDelay;if(W){var U=T?Math.min(T,l.maxLoadingDelay):l.maxLoadingDelay;O=U-W,k.logger.trace("bitrate test took "+Math.round(1e3*W)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*O)+" ms"),L=H=1}}return A=this.findBestLevel(a,p,v,o+O,L,H),Math.max(A,0)},h.findBestLevel=function(d,c,S,v,l,p){for(var y,T=this.fragCurrent,f=this.partCurrent,a=this.lastLoadedFragLevel,_=this.hls.levels,o=_[a],A=!!(o!=null&&(y=o.details)!==null&&y!==void 0&&y.live),O=o==null?void 0:o.codecSet,L=f?f.duration:T?T.duration:0,H=S;H>=c;H--){var W=_[H];if(!(!W||O&&W.codecSet!==O)){var U=W.details,G=(f?U==null?void 0:U.partTarget:U==null?void 0:U.averagetargetduration)||L,Y=void 0;H<=a?Y=l*d:Y=p*d;var j=_[H].maxBitrate,X=j*G/Y;if(k.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+H+"/"+Math.round(Y)+"/"+j+"/"+G+"/"+v+"/"+X),Y>j&&(X===0||!(0,C.isFiniteNumber)(X)||A&&!this.bitrateTestDelay||X<v))return H}}return-1},B(I,[{key:"nextAutoLevel",get:function(){var d=this._nextAutoLevel,c=this.bwEstimator;if(d!==-1&&!c.canEstimate())return d;var S=this.getNextABRAutoLevel();return d!==-1&&this.hls.levels[S].loadError?d:(d!==-1&&(S=Math.min(d,S)),S)},set:function(d){this._nextAutoLevel=d}}]),I}();const N=m},"./src/controller/audio-stream-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>l});var C=s("./src/polyfills/number.ts"),g=s("./src/controller/base-stream-controller.ts"),w=s("./src/events.ts"),R=s("./src/utils/buffer-helper.ts"),K=s("./src/controller/fragment-tracker.ts"),k=s("./src/types/level.ts"),F=s("./src/types/loader.ts"),B=s("./src/loader/fragment.ts"),P=s("./src/demux/chunk-cache.ts"),M=s("./src/demux/transmuxer-interface.ts"),m=s("./src/types/transmuxer.ts"),N=s("./src/controller/fragment-finders.ts"),I=s("./src/utils/discontinuities.ts"),h=s("./src/errors.ts");function E(){return E=Object.assign?Object.assign.bind():function(p){for(var y=1;y<arguments.length;y++){var T=arguments[y];for(var f in T)Object.prototype.hasOwnProperty.call(T,f)&&(p[f]=T[f])}return p},E.apply(this,arguments)}function d(p,y){p.prototype=Object.create(y.prototype),p.prototype.constructor=p,c(p,y)}function c(p,y){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,a){return f.__proto__=a,f},c(p,y)}var S=100,v=function(p){d(y,p);function y(f,a,_){var o;return o=p.call(this,f,a,_,"[audio-stream-controller]")||this,o.videoBuffer=null,o.videoTrackCC=-1,o.waitingVideoCC=-1,o.audioSwitch=!1,o.trackId=-1,o.waitingData=null,o.mainDetails=null,o.bufferFlushed=!1,o.cachedTrackLoadedData=null,o._registerListeners(),o}var T=y.prototype;return T.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},T._registerListeners=function(){var a=this.hls;a.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(w.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.on(w.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(w.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(w.Events.ERROR,this.onError,this),a.on(w.Events.BUFFER_RESET,this.onBufferReset,this),a.on(w.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(w.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(w.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(w.Events.FRAG_BUFFERED,this.onFragBuffered,this)},T._unregisterListeners=function(){var a=this.hls;a.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(w.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.off(w.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(w.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(w.Events.ERROR,this.onError,this),a.off(w.Events.BUFFER_RESET,this.onBufferReset,this),a.off(w.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(w.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(w.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(w.Events.FRAG_BUFFERED,this.onFragBuffered,this)},T.onInitPtsFound=function(a,_){var o=_.frag,A=_.id,O=_.initPTS;if(A==="main"){var L=o.cc;this.initPTS[o.cc]=O,this.log("InitPTS for cc: "+L+" found from main: "+O),this.videoTrackCC=L,this.state===g.State.WAITING_INIT_PTS&&this.tick()}},T.startLoad=function(a){if(!this.levels){this.startPosition=a,this.state=g.State.STOPPED;return}var _=this.lastCurrentTime;this.stopLoad(),this.setInterval(S),this.fragLoadError=0,_>0&&a===-1?(this.log("Override startPosition with lastCurrentTime @"+_.toFixed(3)),a=_,this.state=g.State.IDLE):(this.loadedmetadata=!1,this.state=g.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()},T.doTick=function(){switch(this.state){case g.State.IDLE:this.doTickIdle();break;case g.State.WAITING_TRACK:{var a,_=this.levels,o=this.trackId,A=_==null||(a=_[o])===null||a===void 0?void 0:a.details;if(A){if(this.waitForCdnTuneIn(A))break;this.state=g.State.WAITING_INIT_PTS}break}case g.State.FRAG_LOADING_WAITING_RETRY:{var O,L=performance.now(),H=this.retryDate;(!H||L>=H||(O=this.media)!==null&&O!==void 0&&O.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=g.State.IDLE);break}case g.State.WAITING_INIT_PTS:{var W=this.waitingData;if(W){var U=W.frag,G=W.part,Y=W.cache,j=W.complete;if(this.initPTS[U.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=g.State.FRAG_LOADING;var X=Y.flush(),q={frag:U,part:G,payload:X,networkDetails:null};this._handleFragmentLoadProgress(q),j&&p.prototype._handleFragmentLoadComplete.call(this,q)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+U.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var J=this.getLoadPosition(),V=R.BufferHelper.bufferInfo(this.mediaBuffer,J,this.config.maxBufferHole),$=(0,N.fragmentWithinToleranceTest)(V.end,this.config.maxFragLookUpTolerance,U);$<0&&(this.log("Waiting fragment cc ("+U.cc+") @ "+U.start+" cancelled because another fragment at "+V.end+" is needed"),this.clearWaitingFragment())}}else this.state=g.State.IDLE}}this.onTickEnd()},T.clearWaitingFragment=function(){var a=this.waitingData;a&&(this.fragmentTracker.removeFragment(a.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=g.State.IDLE)},T.resetLoadingState=function(){this.clearWaitingFragment(),p.prototype.resetLoadingState.call(this)},T.onTickEnd=function(){var a=this.media;!a||!a.readyState||(this.lastCurrentTime=a.currentTime)},T.doTickIdle=function(){var a=this.hls,_=this.levels,o=this.media,A=this.trackId,O=a.config;if(!(!_||!_[A])&&!(!o&&(this.startFragRequested||!O.startFragPrefetch))){var L=_[A],H=L.details;if(!H||H.live&&this.levelLastLoaded!==A||this.waitForCdnTuneIn(H)){this.state=g.State.WAITING_TRACK;return}var W=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&W&&(this.bufferFlushed=!1,this.afterBufferFlushed(W,B.ElementaryStreamTypes.AUDIO,F.PlaylistLevelType.AUDIO));var U=this.getFwdBufferInfo(W,F.PlaylistLevelType.AUDIO);if(U!==null){var G=this.audioSwitch;if(!G&&this._streamEnded(U,H)){a.trigger(w.Events.BUFFER_EOS,{type:"audio"}),this.state=g.State.ENDED;return}var Y=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,F.PlaylistLevelType.MAIN),j=U.len,X=this.getMaxBufferLength(Y==null?void 0:Y.len);if(!(j>=X&&!G)){var q=H.fragments,J=q[0].start,V=U.end;if(G&&o){var $=this.getLoadPosition();V=$,H.PTSKnown&&$<J&&(U.end>J||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),o.currentTime=J+.05)}if(!(Y&&V>Y.end+H.targetduration)&&!((!Y||!Y.len)&&U.len)){var ee=this.getNextFragment(V,H);if(!ee){this.bufferFlushed=!0;return}this.loadFragment(ee,H,V)}}}}},T.getMaxBufferLength=function(a){var _=p.prototype.getMaxBufferLength.call(this);return a?Math.max(_,a):_},T.onMediaDetaching=function(){this.videoBuffer=null,p.prototype.onMediaDetaching.call(this)},T.onAudioTracksUpdated=function(a,_){var o=_.audioTracks;this.resetTransmuxer(),this.levels=o.map(function(A){return new k.Level(A)})},T.onAudioTrackSwitching=function(a,_){var o=!!_.url;this.trackId=_.id;var A=this.fragCurrent;A&&A.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),o?this.setInterval(S):this.resetTransmuxer(),o?(this.audioSwitch=!0,this.state=g.State.IDLE):this.state=g.State.STOPPED,this.tick()},T.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},T.onLevelLoaded=function(a,_){this.mainDetails=_.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(w.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},T.onAudioTrackLoaded=function(a,_){var o;if(this.mainDetails==null){this.cachedTrackLoadedData=_;return}var A=this.levels,O=_.details,L=_.id;if(!A){this.warn("Audio tracks were reset while loading level "+L);return}this.log("Track "+L+" loaded ["+O.startSN+","+O.endSN+"],duration:"+O.totalduration);var H=A[L],W=0;if(O.live||(o=H.details)!==null&&o!==void 0&&o.live){var U=this.mainDetails;if(O.fragments[0]||(O.deltaUpdateFailed=!0),O.deltaUpdateFailed||!U)return;!H.details&&O.hasProgramDateTime&&U.hasProgramDateTime?((0,I.alignMediaPlaylistByPDT)(O,U),W=O.fragments[0].start):W=this.alignPlaylists(O,H.details)}H.details=O,this.levelLastLoaded=L,!this.startFragRequested&&(this.mainDetails||!O.live)&&this.setStartPosition(H.details,W),this.state===g.State.WAITING_TRACK&&!this.waitForCdnTuneIn(O)&&(this.state=g.State.IDLE),this.tick()},T._handleFragmentLoadProgress=function(a){var _,o=a.frag,A=a.part,O=a.payload,L=this.config,H=this.trackId,W=this.levels;if(!W){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+o.sn+" of level "+o.level+" will not be buffered");return}var U=W[H];console.assert(U,"Audio track is defined on fragment load progress");var G=U.details;console.assert(G,"Audio track details are defined on fragment load progress");var Y=L.defaultAudioCodec||U.audioCodec||"mp4a.40.2",j=this.transmuxer;j||(j=this.transmuxer=new M.default(this.hls,F.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var X=this.initPTS[o.cc],q=(_=o.initSegment)===null||_===void 0?void 0:_.data;if(X!==void 0){var J=!1,V=A?A.index:-1,$=V!==-1,ee=new m.ChunkMetadata(o.level,o.sn,o.stats.chunkCount,O.byteLength,V,$);j.push(O,q,Y,"",o,A,G.totalduration,J,ee,X)}else{this.log("Unknown video PTS for cc "+o.cc+", waiting for video PTS before demuxing audio frag "+o.sn+" of ["+G.startSN+" ,"+G.endSN+"],track "+H);var Z=this.waitingData=this.waitingData||{frag:o,part:A,cache:new P.default,complete:!1},re=Z.cache;re.push(new Uint8Array(O)),this.waitingVideoCC=this.videoTrackCC,this.state=g.State.WAITING_INIT_PTS}},T._handleFragmentLoadComplete=function(a){if(this.waitingData){this.waitingData.complete=!0;return}p.prototype._handleFragmentLoadComplete.call(this,a)},T.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},T.onBufferCreated=function(a,_){var o=_.tracks.audio;o&&(this.mediaBuffer=o.buffer||null),_.tracks.video&&(this.videoBuffer=_.tracks.video.buffer||null)},T.onFragBuffered=function(a,_){var o=_.frag,A=_.part;if(o.type!==F.PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&o.type===F.PlaylistLevelType.MAIN){var O;(O=this.videoBuffer||this.media)!==null&&O!==void 0&&O.buffered.length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(o)){this.warn("Fragment "+o.sn+(A?" p: "+A.index:"")+" of level "+o.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}o.sn!=="initSegment"&&(this.fragPrevious=o,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(w.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(o,A)},T.onError=function(a,_){if(_.type===h.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(F.PlaylistLevelType.AUDIO,_);return}switch(_.details){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:case h.ErrorDetails.FRAG_PARSING_ERROR:case h.ErrorDetails.KEY_LOAD_ERROR:case h.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(F.PlaylistLevelType.AUDIO,_);break;case h.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case h.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==g.State.ERROR&&this.state!==g.State.STOPPED&&(this.state=_.fatal?g.State.ERROR:g.State.IDLE,this.warn(_.details+" while loading frag, switching to "+this.state+" state"));break;case h.ErrorDetails.BUFFER_FULL_ERROR:if(_.parent==="audio"&&(this.state===g.State.PARSING||this.state===g.State.PARSED)){var o=!0,A=this.getFwdBufferInfo(this.mediaBuffer,F.PlaylistLevelType.AUDIO);A&&A.len>.5&&(o=!this.reduceMaxBufferLength(A.len)),o&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,p.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},T.onBufferFlushed=function(a,_){var o=_.type;o===B.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===g.State.ENDED&&(this.state=g.State.IDLE))},T._handleTransmuxComplete=function(a){var _,o="audio",A=this.hls,O=a.remuxResult,L=a.chunkMeta,H=this.getCurrentContext(L);if(!H){this.warn("The loading context changed while buffering fragment "+L.sn+" of level "+L.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(L.level);return}var W=H.frag,U=H.part,G=H.level.details,Y=O.audio,j=O.text,X=O.id3,q=O.initSegment;if(!(this.fragContextChanged(W)||!G)){if(this.state=g.State.PARSING,this.audioSwitch&&Y&&this.completeAudioSwitch(),q!=null&&q.tracks&&(this._bufferInitSegment(q.tracks,W,L),A.trigger(w.Events.FRAG_PARSING_INIT_SEGMENT,{frag:W,id:o,tracks:q.tracks})),Y){var J=Y.startPTS,V=Y.endPTS,$=Y.startDTS,ee=Y.endDTS;U&&(U.elementaryStreams[B.ElementaryStreamTypes.AUDIO]={startPTS:J,endPTS:V,startDTS:$,endDTS:ee}),W.setElementaryStreamInfo(B.ElementaryStreamTypes.AUDIO,J,V,$,ee),this.bufferFragmentData(Y,W,U,L)}if(X!=null&&(_=X.samples)!==null&&_!==void 0&&_.length){var Z=E({id:o,frag:W,details:G},X);A.trigger(w.Events.FRAG_PARSING_METADATA,Z)}if(j){var re=E({id:o,frag:W,details:G},j);A.trigger(w.Events.FRAG_PARSING_USERDATA,re)}}},T._bufferInitSegment=function(a,_,o){if(this.state===g.State.PARSING){a.video&&delete a.video;var A=a.audio;if(A){A.levelCodec=A.codec,A.id="audio",this.log("Init audio buffer, container:"+A.container+", codecs[parsed]=["+A.codec+"]"),this.hls.trigger(w.Events.BUFFER_CODECS,a);var O=A.initSegment;if(O!=null&&O.byteLength){var L={type:"audio",frag:_,part:null,chunkMeta:o,parent:_.type,data:O};this.hls.trigger(w.Events.BUFFER_APPENDING,L)}this.tick()}}},T.loadFragment=function(a,_,o){var A=this.fragmentTracker.getState(a);this.fragCurrent=a,(this.audioSwitch||A===K.FragmentState.NOT_LOADED||A===K.FragmentState.PARTIAL)&&(a.sn==="initSegment"?this._loadInitSegment(a,_):_.live&&!(0,C.isFiniteNumber)(this.initPTS[a.cc])?(this.log("Waiting for video PTS in continuity counter "+a.cc+" of live stream before loading audio fragment "+a.sn+" of level "+this.trackId),this.state=g.State.WAITING_INIT_PTS):(this.startFragRequested=!0,p.prototype.loadFragment.call(this,a,_,o)))},T.completeAudioSwitch=function(){var a=this.hls,_=this.media,o=this.trackId;_&&(this.log("Switching audio track : flushing all audio"),p.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,a.trigger(w.Events.AUDIO_TRACK_SWITCHED,{id:o})},y}(g.default);const l=v},"./src/controller/audio-track-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>N});var C=s("./src/events.ts"),g=s("./src/errors.ts"),w=s("./src/controller/base-playlist-controller.ts"),R=s("./src/types/loader.ts");function K(I,h){for(var E=0;E<h.length;E++){var d=h[E];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(I,F(d.key),d)}}function k(I,h,E){return h&&K(I.prototype,h),E&&K(I,E),Object.defineProperty(I,"prototype",{writable:!1}),I}function F(I){var h=B(I,"string");return typeof h=="symbol"?h:String(h)}function B(I,h){if(typeof I!="object"||I===null)return I;var E=I[Symbol.toPrimitive];if(E!==void 0){var d=E.call(I,h||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(I)}function P(I,h){I.prototype=Object.create(h.prototype),I.prototype.constructor=I,M(I,h)}function M(I,h){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,c){return d.__proto__=c,d},M(I,h)}var m=function(I){P(h,I);function h(d){var c;return c=I.call(this,d,"[audio-track-controller]")||this,c.tracks=[],c.groupId=null,c.tracksInGroup=[],c.trackId=-1,c.trackName="",c.selectDefaultTrack=!0,c.registerListeners(),c}var E=h.prototype;return E.registerListeners=function(){var c=this.hls;c.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.on(C.Events.LEVEL_LOADING,this.onLevelLoading,this),c.on(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),c.on(C.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),c.on(C.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){var c=this.hls;c.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.off(C.Events.LEVEL_LOADING,this.onLevelLoading,this),c.off(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),c.off(C.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),c.off(C.Events.ERROR,this.onError,this)},E.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,I.prototype.destroy.call(this)},E.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},E.onManifestParsed=function(c,S){this.tracks=S.audioTracks||[]},E.onAudioTrackLoaded=function(c,S){var v=S.id,l=S.details,p=this.tracksInGroup[v];if(!p){this.warn("Invalid audio track id "+v);return}var y=p.details;p.details=S.details,this.log("audioTrack "+v+" loaded ["+l.startSN+"-"+l.endSN+"]"),v===this.trackId&&(this.retryCount=0,this.playlistLoaded(v,S,y))},E.onLevelLoading=function(c,S){this.switchLevel(S.level)},E.onLevelSwitching=function(c,S){this.switchLevel(S.level)},E.switchLevel=function(c){var S=this.hls.levels[c];if(S!=null&&S.audioGroupIds){var v=S.audioGroupIds[S.urlId];if(this.groupId!==v){this.groupId=v;var l=this.tracks.filter(function(y){return!v||y.groupId===v});this.selectDefaultTrack&&!l.some(function(y){return y.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=l;var p={audioTracks:l};this.log("Updating audio tracks, "+l.length+' track(s) found in "'+v+'" group-id'),this.hls.trigger(C.Events.AUDIO_TRACKS_UPDATED,p),this.selectInitialTrack()}}},E.onError=function(c,S){I.prototype.onError.call(this,c,S),!(S.fatal||!S.context)&&S.context.type===R.PlaylistContextType.AUDIO_TRACK&&S.context.id===this.trackId&&S.context.groupId===this.groupId&&this.retryLoadingOrFail(S)},E.setAudioTrack=function(c){var S=this.tracksInGroup;if(c<0||c>=S.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var v=S[this.trackId];this.log("Now switching to audio-track index "+c);var l=S[c],p=l.id,y=l.groupId,T=y===void 0?"":y,f=l.name,a=l.type,_=l.url;if(this.trackId=c,this.trackName=f,this.selectDefaultTrack=!1,this.hls.trigger(C.Events.AUDIO_TRACK_SWITCHING,{id:p,groupId:T,name:f,type:a,url:_}),!(l.details&&!l.details.live)){var o=this.switchParams(l.url,v==null?void 0:v.details);this.loadPlaylist(o)}},E.selectInitialTrack=function(){var c=this.tracksInGroup;console.assert(c.length,"Initial audio track should be selected when tracks are known");var S=this.trackName,v=this.findTrackId(S)||this.findTrackId();v!==-1?this.setAudioTrack(v):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(C.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},E.findTrackId=function(c){for(var S=this.tracksInGroup,v=0;v<S.length;v++){var l=S[v];if((!this.selectDefaultTrack||l.default)&&(!c||c===l.name))return l.id}return-1},E.loadPlaylist=function(c){I.prototype.loadPlaylist.call(this);var S=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(S)){var v=S.id,l=S.groupId,p=S.url;if(c)try{p=c.addDirectives(p)}catch(y){this.warn("Could not construct new URL with HLS Delivery Directives: "+y)}this.log("loading audio-track playlist for id: "+v),this.clearTimer(),this.hls.trigger(C.Events.AUDIO_TRACK_LOADING,{url:p,id:v,groupId:l,deliveryDirectives:c||null})}},k(h,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(c){this.selectDefaultTrack=!1,this.setAudioTrack(c)}}]),h}(w.default);const N=m},"./src/controller/base-playlist-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>K});var C=s("./src/types/level.ts"),g=s("./src/controller/level-helper.ts"),w=s("./src/utils/logger.ts"),R=s("./src/errors.ts"),K=function(){function k(B,P){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=w.logger.log.bind(w.logger,P+":"),this.warn=w.logger.warn.bind(w.logger,P+":"),this.hls=B}var F=k.prototype;return F.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},F.onError=function(P,M){M.fatal&&(M.type===R.ErrorTypes.NETWORK_ERROR||M.type===R.ErrorTypes.KEY_SYSTEM_ERROR)&&this.stopLoad()},F.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},F.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},F.stopLoad=function(){this.canLoad=!1,this.clearTimer()},F.switchParams=function(P,M){var m=M==null?void 0:M.renditionReports;if(m)for(var N=0;N<m.length;N++){var I=m[N],h=void 0;try{h=new self.URL(I.URI,M.url).href}catch(S){w.logger.warn("Could not construct new URL for Rendition Report: "+S),h=I.URI||""}if(h===P.slice(-h.length)){var E=parseInt(I["LAST-MSN"])||(M==null?void 0:M.lastPartSn),d=parseInt(I["LAST-PART"])||(M==null?void 0:M.lastPartIndex);if(this.hls.config.lowLatencyMode){var c=Math.min(M.age-M.partTarget,M.targetduration);d>=0&&c>M.partTarget&&(d+=1)}return new C.HlsUrlParameters(E,d>=0?d:void 0,C.HlsSkip.No)}}},F.loadPlaylist=function(P){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},F.shouldLoadTrack=function(P){return this.canLoad&&P&&!!P.url&&(!P.details||P.details.live)},F.playlistLoaded=function(P,M,m){var N=this,I=M.details,h=M.stats,E=self.performance.now(),d=h.loading.first?Math.max(0,E-h.loading.first):0;if(I.advancedDateTime=Date.now()-d,I.live||m!=null&&m.live){if(I.reloaded(m),m&&this.log("live playlist "+P+" "+(I.advanced?"REFRESHED "+I.lastPartSn+"-"+I.lastPartIndex:"MISSED")),m&&I.fragments.length>0&&(0,g.mergeDetails)(m,I),!this.canLoad||!I.live)return;var c,S=void 0,v=void 0;if(I.canBlockReload&&I.endSN&&I.advanced){var l=this.hls.config.lowLatencyMode,p=I.lastPartSn,y=I.endSN,T=I.lastPartIndex,f=T!==-1,a=p===y,_=l?0:T;f?(S=a?y+1:p,v=a?_:T+1):S=y+1;var o=I.age,A=o+I.ageHeader,O=Math.min(A-I.partTarget,I.targetduration*1.5);if(O>0){if(m&&O>m.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+m.tuneInGoal+" to: "+O+" with playlist age: "+I.age),O=0;else{var L=Math.floor(O/I.targetduration);if(S+=L,v!==void 0){var H=Math.round(O%I.targetduration/I.partTarget);v+=H}this.log("CDN Tune-in age: "+I.ageHeader+"s last advanced "+o.toFixed(2)+"s goal: "+O+" skip sn "+L+" to part "+v)}I.tuneInGoal=O}if(c=this.getDeliveryDirectives(I,M.deliveryDirectives,S,v),l||!a){this.loadPlaylist(c);return}}else c=this.getDeliveryDirectives(I,M.deliveryDirectives,S,v);var W=this.hls.mainForwardBufferInfo,U=W?W.end-W.len:0,G=(I.edge-U)*1e3,Y=(0,g.computeReloadInterval)(I,G);I.updated?E>this.requestScheduled+Y&&(this.requestScheduled=h.loading.start):this.requestScheduled=-1,S!==void 0&&I.canBlockReload?this.requestScheduled=h.loading.first+Y-(I.partTarget*1e3||1e3):this.requestScheduled=(this.requestScheduled===-1?E:this.requestScheduled)+Y;var j=this.requestScheduled-E;j=Math.max(0,j),this.log("reload live playlist "+P+" in "+Math.round(j)+" ms"),this.timer=self.setTimeout(function(){return N.loadPlaylist(c)},j)}else this.clearTimer()},F.getDeliveryDirectives=function(P,M,m,N){var I=(0,C.getSkipValue)(P,m);return M!=null&&M.skip&&P.deltaUpdateFailed&&(m=M.msn,N=M.part,I=C.HlsSkip.No),new C.HlsUrlParameters(m,N,I)},F.retryLoadingOrFail=function(P){var M=this,m=this.hls.config,N=this.retryCount<m.levelLoadingMaxRetry;if(N){var I;if(this.requestScheduled=-1,this.retryCount++,P.details.indexOf("LoadTimeOut")>-1&&(I=P.context)!==null&&I!==void 0&&I.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+P.details+'"'),this.loadPlaylist();else{var h=Math.min(Math.pow(2,this.retryCount)*m.levelLoadingRetryDelay,m.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return M.loadPlaylist()},h),this.warn("retry playlist loading #"+this.retryCount+" in "+h+' ms after "'+P.details+'"')}}else this.warn('cannot recover from error "'+P.details+'"'),this.clearTimer(),P.fatal=!0;return N},k}()},"./src/controller/base-stream-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{State:()=>f,default:()=>a});var C=s("./src/polyfills/number.ts"),g=s("./src/task-loop.ts"),w=s("./src/controller/fragment-tracker.ts"),R=s("./src/utils/buffer-helper.ts"),K=s("./src/utils/logger.ts"),k=s("./src/events.ts"),F=s("./src/errors.ts"),B=s("./src/types/transmuxer.ts"),P=s("./src/utils/mp4-tools.ts"),M=s("./src/utils/discontinuities.ts"),m=s("./src/controller/fragment-finders.ts"),N=s("./src/controller/level-helper.ts"),I=s("./src/loader/fragment-loader.ts"),h=s("./src/crypt/decrypter.ts"),E=s("./src/utils/time-ranges.ts"),d=s("./src/types/loader.ts");function c(_,o){for(var A=0;A<o.length;A++){var O=o[A];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(_,v(O.key),O)}}function S(_,o,A){return o&&c(_.prototype,o),A&&c(_,A),Object.defineProperty(_,"prototype",{writable:!1}),_}function v(_){var o=l(_,"string");return typeof o=="symbol"?o:String(o)}function l(_,o){if(typeof _!="object"||_===null)return _;var A=_[Symbol.toPrimitive];if(A!==void 0){var O=A.call(_,o||"default");if(typeof O!="object")return O;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(_)}function p(_){if(_===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _}function y(_,o){_.prototype=Object.create(o.prototype),_.prototype.constructor=_,T(_,o)}function T(_,o){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(O,L){return O.__proto__=L,O},T(_,o)}var f={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},a=function(_){y(o,_);function o(O,L,H,W){var U;return U=_.call(this)||this,U.hls=void 0,U.fragPrevious=null,U.fragCurrent=null,U.fragmentTracker=void 0,U.transmuxer=null,U._state=f.STOPPED,U.media=null,U.mediaBuffer=null,U.config=void 0,U.bitrateTest=!1,U.lastCurrentTime=0,U.nextLoadPosition=0,U.startPosition=0,U.loadedmetadata=!1,U.fragLoadError=0,U.retryDate=0,U.levels=null,U.fragmentLoader=void 0,U.keyLoader=void 0,U.levelLastLoaded=null,U.startFragRequested=!1,U.decrypter=void 0,U.initPTS=[],U.onvseeking=null,U.onvended=null,U.logPrefix="",U.log=void 0,U.warn=void 0,U.logPrefix=W,U.log=K.logger.log.bind(K.logger,W+":"),U.warn=K.logger.warn.bind(K.logger,W+":"),U.hls=O,U.fragmentLoader=new I.default(O.config),U.keyLoader=H,U.fragmentTracker=L,U.config=O.config,U.decrypter=new h.default(O.config),O.on(k.Events.LEVEL_SWITCHING,U.onLevelSwitching,p(U)),U}var A=o.prototype;return A.doTick=function(){this.onTickEnd()},A.onTickEnd=function(){},A.startLoad=function(L){},A.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var L=this.fragCurrent;L&&(L.abortRequests(),this.fragmentTracker.removeFragment(L)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=f.STOPPED},A._streamEnded=function(L,H){if(H.live||L.nextStart||!L.end||!this.media)return!1;var W=H.partList;if(W!=null&&W.length){var U=W[W.length-1],G=R.BufferHelper.isBuffered(this.media,U.start+U.duration/2);return G}var Y=H.fragments[H.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(Y)},A.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var L;return(L=this.levels[this.levelLastLoaded])===null||L===void 0?void 0:L.details}},A.onMediaAttached=function(L,H){var W=this.media=this.mediaBuffer=H.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),W.addEventListener("seeking",this.onvseeking),W.addEventListener("ended",this.onvended);var U=this.config;this.levels&&U.autoStartLoad&&this.state===f.STOPPED&&this.startLoad(U.startPosition)},A.onMediaDetaching=function(){var L=this.media;L!=null&&L.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),L&&this.onvseeking&&this.onvended&&(L.removeEventListener("seeking",this.onvseeking),L.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},A.onMediaSeeking=function(){var L=this.config,H=this.fragCurrent,W=this.media,U=this.mediaBuffer,G=this.state,Y=W?W.currentTime:0,j=R.BufferHelper.bufferInfo(U||W,Y,L.maxBufferHole);if(this.log("media seeking to "+((0,C.isFiniteNumber)(Y)?Y.toFixed(3):Y)+", state: "+G),this.state===f.ENDED)this.resetLoadingState();else if(H){var X=L.maxFragLookUpTolerance,q=H.start-X,J=H.start+H.duration+X;if(!j.len||J<j.start||q>j.end){var V=Y>J;(Y<q||V)&&(V&&H.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),H.abortRequests()),this.resetLoadingState())}}W&&(this.lastCurrentTime=Y),!this.loadedmetadata&&!j.len&&(this.nextLoadPosition=this.startPosition=Y),this.tickImmediate()},A.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},A.onLevelSwitching=function(L,H){this.fragLoadError=0},A.onHandlerDestroying=function(){this.stopLoad(),_.prototype.onHandlerDestroying.call(this)},A.onHandlerDestroyed=function(){this.state=f.STOPPED,this.hls.off(k.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,_.prototype.onHandlerDestroyed.call(this)},A.loadFragment=function(L,H,W){this._loadFragForPlayback(L,H,W)},A._loadFragForPlayback=function(L,H,W){var U=this,G=function(j){if(U.fragContextChanged(L)){U.warn("Fragment "+L.sn+(j.part?" p: "+j.part.index:"")+" of level "+L.level+" was dropped during download."),U.fragmentTracker.removeFragment(L);return}L.stats.chunkCount++,U._handleFragmentLoadProgress(j)};this._doFragLoad(L,H,W,G).then(function(Y){if(Y){U.fragLoadError=0;var j=U.state;if(U.fragContextChanged(L)){(j===f.FRAG_LOADING||!U.fragCurrent&&j===f.PARSING)&&(U.fragmentTracker.removeFragment(L),U.state=f.IDLE);return}"payload"in Y&&(U.log("Loaded fragment "+L.sn+" of level "+L.level),U.hls.trigger(k.Events.FRAG_LOADED,Y)),U._handleFragmentLoadComplete(Y)}}).catch(function(Y){U.state===f.STOPPED||U.state===f.ERROR||(U.warn(Y),U.resetFragmentLoading(L))})},A.flushMainBuffer=function(L,H,W){if(W===void 0&&(W=null),!!(L-H)){var U={startOffset:L,endOffset:H,type:W};this.fragLoadError=0,this.hls.trigger(k.Events.BUFFER_FLUSHING,U)}},A._loadInitSegment=function(L,H){var W=this;this._doFragLoad(L,H).then(function(U){if(!U||W.fragContextChanged(L)||!W.levels)throw new Error("init load aborted");return U}).then(function(U){var G=W.hls,Y=U.payload,j=L.decryptdata;if(Y&&Y.byteLength>0&&j&&j.key&&j.iv&&j.method==="AES-128"){var X=self.performance.now();return W.decrypter.decrypt(new Uint8Array(Y),j.key.buffer,j.iv.buffer).then(function(q){var J=self.performance.now();return G.trigger(k.Events.FRAG_DECRYPTED,{frag:L,payload:q,stats:{tstart:X,tdecrypt:J}}),U.payload=q,U})}return U}).then(function(U){var G=W.fragCurrent,Y=W.hls,j=W.levels;if(!j)throw new Error("init load aborted, missing levels");var X=j[L.level].details;console.assert(X,"Level details are defined when init segment is loaded");var q=L.stats;W.state=f.IDLE,W.fragLoadError=0,L.data=new Uint8Array(U.payload),q.parsing.start=q.buffering.start=self.performance.now(),q.parsing.end=q.buffering.end=self.performance.now(),U.frag===G&&Y.trigger(k.Events.FRAG_BUFFERED,{stats:q,frag:G,part:null,id:L.type}),W.tick()}).catch(function(U){W.state===f.STOPPED||W.state===f.ERROR||(W.warn(U),W.resetFragmentLoading(L))})},A.fragContextChanged=function(L){var H=this.fragCurrent;return!L||!H||L.level!==H.level||L.sn!==H.sn||L.urlId!==H.urlId},A.fragBufferedComplete=function(L,H){var W,U,G=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+L.type+" sn: "+L.sn+(H?" part: "+H.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+L.level+" "+(G?E.default.toString(R.BufferHelper.getBuffered(G)):"(detached)")),this.state=f.IDLE,G&&(!this.loadedmetadata&&L.type==d.PlaylistLevelType.MAIN&&G.buffered.length&&((W=this.fragCurrent)===null||W===void 0?void 0:W.sn)===((U=this.fragPrevious)===null||U===void 0?void 0:U.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},A.seekToStartPos=function(){},A._handleFragmentLoadComplete=function(L){var H=this.transmuxer;if(H){var W=L.frag,U=L.part,G=L.partsLoaded,Y=!G||G.length===0||G.some(function(X){return!X}),j=new B.ChunkMetadata(W.level,W.sn,W.stats.chunkCount+1,0,U?U.index:-1,!Y);H.flush(j)}},A._handleFragmentLoadProgress=function(L){},A._doFragLoad=function(L,H,W,U){var G,Y=this;if(W===void 0&&(W=null),!this.levels)throw new Error("frag load aborted, missing levels");var j=null;if(L.encrypted&&!((G=L.decryptdata)!==null&&G!==void 0&&G.key)?(this.log("Loading key for "+L.sn+" of ["+H.startSN+"-"+H.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+L.level),this.state=f.KEY_LOADING,this.fragCurrent=L,j=this.keyLoader.load(L).then(function($){if(!Y.fragContextChanged($.frag))return Y.hls.trigger(k.Events.KEY_LOADED,$),$}),this.hls.trigger(k.Events.KEY_LOADING,{frag:L}),this.throwIfFragContextChanged("KEY_LOADING")):!L.encrypted&&H.encryptedFragments.length&&this.keyLoader.loadClear(L,H.encryptedFragments),W=Math.max(L.start,W||0),this.config.lowLatencyMode&&H){var X=H.partList;if(X&&U){W>L.end&&H.fragmentHint&&(L=H.fragmentHint);var q=this.getNextPart(X,L,W);if(q>-1){var J=X[q];return this.log("Loading part sn: "+L.sn+" p: "+J.index+" cc: "+L.cc+" of playlist ["+H.startSN+"-"+H.endSN+"] parts [0-"+q+"-"+(X.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+L.level+", target: "+parseFloat(W.toFixed(3))),this.nextLoadPosition=J.start+J.duration,this.state=f.FRAG_LOADING,this.hls.trigger(k.Events.FRAG_LOADING,{frag:L,part:X[q],targetBufferTime:W}),this.throwIfFragContextChanged("FRAG_LOADING parts"),j?j.then(function($){return!$||Y.fragContextChanged($.frag)?null:Y.doFragPartsLoad(L,X,q,U)}).catch(function($){return Y.handleFragLoadError($)}):this.doFragPartsLoad(L,X,q,U).catch(function($){return Y.handleFragLoadError($)})}else if(!L.url||this.loadedEndOfParts(X,W))return Promise.resolve(null)}}this.log("Loading fragment "+L.sn+" cc: "+L.cc+" "+(H?"of ["+H.startSN+"-"+H.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+L.level+", target: "+parseFloat(W.toFixed(3))),(0,C.isFiniteNumber)(L.sn)&&!this.bitrateTest&&(this.nextLoadPosition=L.start+L.duration),this.state=f.FRAG_LOADING,this.hls.trigger(k.Events.FRAG_LOADING,{frag:L,targetBufferTime:W}),this.throwIfFragContextChanged("FRAG_LOADING");var V=this.config.progressive;return V&&j?j.then(function($){return!$||Y.fragContextChanged($==null?void 0:$.frag)?null:Y.fragmentLoader.load(L,U)}).catch(function($){return Y.handleFragLoadError($)}):Promise.all([this.fragmentLoader.load(L,V?U:void 0),j]).then(function($){var ee=$[0];return!V&&ee&&U&&U(ee),ee}).catch(function($){return Y.handleFragLoadError($)})},A.throwIfFragContextChanged=function(L){if(this.fragCurrent===null)throw new Error("frag load aborted, context changed in "+L)},A.doFragPartsLoad=function(L,H,W,U){var G=this;return new Promise(function(Y,j){var X=[],q=function J(V){var $=H[V];G.fragmentLoader.loadPart(L,$,U).then(function(ee){X[$.index]=ee;var Z=ee.part;G.hls.trigger(k.Events.FRAG_LOADED,ee);var re=H[V+1];if(re&&re.fragment===L)J(V+1);else return Y({frag:L,part:Z,partsLoaded:X})}).catch(j)};q(W)})},A.handleFragLoadError=function(L){if("data"in L){var H=L.data;L.data&&H.details===F.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(H.frag,H.part):this.hls.trigger(k.Events.ERROR,H)}else this.hls.trigger(k.Events.ERROR,{type:F.ErrorTypes.OTHER_ERROR,details:F.ErrorDetails.INTERNAL_EXCEPTION,err:L,fatal:!0});return null},A._handleTransmuxerFlush=function(L){var H=this.getCurrentContext(L);if(!H||this.state!==f.PARSING){!this.fragCurrent&&this.state!==f.STOPPED&&this.state!==f.ERROR&&(this.state=f.IDLE);return}var W=H.frag,U=H.part,G=H.level,Y=self.performance.now();W.stats.parsing.end=Y,U&&(U.stats.parsing.end=Y),this.updateLevelTiming(W,U,G,L.partial)},A.getCurrentContext=function(L){var H=this.levels,W=L.level,U=L.sn,G=L.part;if(!H||!H[W])return this.warn("Levels object was unset while buffering fragment "+U+" of level "+W+". The current chunk will not be buffered."),null;var Y=H[W],j=G>-1?(0,N.getPartWith)(Y,U,G):null,X=j?j.fragment:(0,N.getFragmentWithSN)(Y,U,this.fragCurrent);return X?{frag:X,part:j,level:Y}:null},A.bufferFragmentData=function(L,H,W,U){if(!(!L||this.state!==f.PARSING)){var G=L.data1,Y=L.data2,j=G;if(G&&Y&&(j=(0,P.appendUint8Array)(G,Y)),!(!j||!j.length)){var X={type:L.type,frag:H,part:W,chunkMeta:U,parent:H.type,data:j};this.hls.trigger(k.Events.BUFFER_APPENDING,X),L.dropped&&L.independent&&!W&&this.flushBufferGap(H)}}},A.flushBufferGap=function(L){var H=this.media;if(H){if(!R.BufferHelper.isBuffered(H,H.currentTime)){this.flushMainBuffer(0,L.start);return}var W=H.currentTime,U=R.BufferHelper.bufferInfo(H,W,0),G=L.duration,Y=Math.min(this.config.maxFragLookUpTolerance*2,G*.25),j=Math.max(Math.min(L.start-Y,U.end-Y),W+Y);L.start-j>Y&&this.flushMainBuffer(j,L.start)}},A.getFwdBufferInfo=function(L,H){var W=this.config,U=this.getLoadPosition();if(!(0,C.isFiniteNumber)(U))return null;var G=R.BufferHelper.bufferInfo(L,U,W.maxBufferHole);if(G.len===0&&G.nextStart!==void 0){var Y=this.fragmentTracker.getBufferedFrag(U,H);if(Y&&G.nextStart<Y.end)return R.BufferHelper.bufferInfo(L,U,Math.max(G.nextStart,W.maxBufferHole))}return G},A.getMaxBufferLength=function(L){var H=this.config,W;return L?W=Math.max(8*H.maxBufferSize/L,H.maxBufferLength):W=H.maxBufferLength,Math.min(W,H.maxMaxBufferLength)},A.reduceMaxBufferLength=function(L){var H=this.config,W=L||H.maxBufferLength;return H.maxMaxBufferLength>=W?(H.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+H.maxMaxBufferLength+"s"),!0):!1},A.getNextFragment=function(L,H){var W=H.fragments,U=W.length;if(!U)return null;var G=this.config,Y=W[0].start,j;if(H.live){var X=G.initialLiveManifestSize;if(U<X)return this.warn("Not enough fragments to start playback (have: "+U+", need: "+X+")"),null;!H.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(j=this.getInitialLiveFragment(H,W),this.startPosition=j?this.hls.liveSyncPosition||j.start:L)}else L<=Y&&(j=W[0]);if(!j){var q=G.lowLatencyMode?H.partEnd:H.fragmentEnd;j=this.getFragmentAtPosition(L,q,H)}return this.mapToInitFragWhenRequired(j)},A.mapToInitFragWhenRequired=function(L){return L!=null&&L.initSegment&&!(L!=null&&L.initSegment.data)&&!this.bitrateTest?L.initSegment:L},A.getNextPart=function(L,H,W){for(var U=-1,G=!1,Y=!0,j=0,X=L.length;j<X;j++){var q=L[j];if(Y=Y&&!q.independent,U>-1&&W<q.start)break;var J=q.loaded;J?U=-1:(G||q.independent||Y)&&q.fragment===H&&(U=j),G=J}return U},A.loadedEndOfParts=function(L,H){var W=L[L.length-1];return W&&H>W.start&&W.loaded},A.getInitialLiveFragment=function(L,H){var W=this.fragPrevious,U=null;if(W){if(L.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+W.programDateTime),U=(0,m.findFragmentByPDT)(H,W.endProgramDateTime,this.config.maxFragLookUpTolerance)),!U){var G=W.sn+1;if(G>=L.startSN&&G<=L.endSN){var Y=H[G-L.startSN];W.cc===Y.cc&&(U=Y,this.log("Live playlist, switching playlist, load frag with next SN: "+U.sn))}U||(U=(0,m.findFragWithCC)(H,W.cc),U&&this.log("Live playlist, switching playlist, load frag with same CC: "+U.sn))}}else{var j=this.hls.liveSyncPosition;j!==null&&(U=this.getFragmentAtPosition(j,this.bitrateTest?L.fragmentEnd:L.edge,L))}return U},A.getFragmentAtPosition=function(L,H,W){var U=this.config,G=this.fragPrevious,Y=W.fragments,j=W.endSN,X=W.fragmentHint,q=U.maxFragLookUpTolerance,J=!!(U.lowLatencyMode&&W.partList&&X);J&&X&&!this.bitrateTest&&(Y=Y.concat(X),j=X.sn);var V;if(L<H){var $=L>H-q?0:q;V=(0,m.findFragmentByPTS)(G,Y,L,$)}else V=Y[Y.length-1];if(V){var ee=V.sn-W.startSN;if(this.fragmentTracker.getState(V)===w.FragmentState.OK&&(G=V),G&&V.sn===G.sn&&!J){var Z=G&&V.level===G.level;if(Z){var re=Y[ee+1];V.sn<j&&this.fragmentTracker.getState(re)!==w.FragmentState.OK?(this.log("SN "+V.sn+" just loaded, load next one: "+re.sn),V=re):V=null}}}return V},A.synchronizeToLiveEdge=function(L){var H=this.config,W=this.media;if(W){var U=this.hls.liveSyncPosition,G=W.currentTime,Y=L.fragments[0].start,j=L.edge,X=G>=Y-H.maxFragLookUpTolerance&&G<=j;if(U!==null&&W.duration>U&&(G<U||!X)){var q=H.liveMaxLatencyDuration!==void 0?H.liveMaxLatencyDuration:H.liveMaxLatencyDurationCount*L.targetduration;(!X&&W.readyState<4||G<j-q)&&(this.loadedmetadata||(this.nextLoadPosition=U),W.readyState&&(this.warn("Playback: "+G.toFixed(3)+" is located too far from the end of live sliding playlist: "+j+", reset currentTime to : "+U.toFixed(3)),W.currentTime=U))}}},A.alignPlaylists=function(L,H){var W=this.levels,U=this.levelLastLoaded,G=this.fragPrevious,Y=U!==null?W[U]:null,j=L.fragments.length;if(!j)return this.warn("No fragments in live playlist"),0;var X=L.fragments[0].start,q=!H,J=L.alignedSliding&&(0,C.isFiniteNumber)(X);if(q||!J&&!X){(0,M.alignStream)(G,Y,L);var V=L.fragments[0].start;return this.log("Live playlist sliding: "+V.toFixed(2)+" start-sn: "+(H?H.startSN:"na")+"->"+L.startSN+" prev-sn: "+(G?G.sn:"na")+" fragments: "+j),V}return X},A.waitForCdnTuneIn=function(L){var H=3;return L.live&&L.canBlockReload&&L.partTarget&&L.tuneInGoal>Math.max(L.partHoldBack,L.partTarget*H)},A.setStartPosition=function(L,H){var W=this.startPosition;if(W<H&&(W=-1),W===-1||this.lastCurrentTime===-1){var U=L.startTimeOffset;(0,C.isFiniteNumber)(U)?(W=H+U,U<0&&(W+=L.totalduration),W=Math.min(Math.max(H,W),H+L.totalduration),this.log("Start time offset "+U+" found in playlist, adjust startPosition to "+W),this.startPosition=W):L.live?W=this.hls.liveSyncPosition||H:this.startPosition=W=0,this.lastCurrentTime=W}this.nextLoadPosition=W},A.getLoadPosition=function(){var L=this.media,H=0;return this.loadedmetadata&&L?H=L.currentTime:this.nextLoadPosition&&(H=this.nextLoadPosition),H},A.handleFragLoadAborted=function(L,H){this.transmuxer&&L.sn!=="initSegment"&&L.stats.aborted&&(this.warn("Fragment "+L.sn+(H?" part"+H.index:"")+" of level "+L.level+" was aborted"),this.resetFragmentLoading(L))},A.resetFragmentLoading=function(L){(!this.fragCurrent||!this.fragContextChanged(L)&&this.state!==f.FRAG_LOADING_WAITING_RETRY)&&(this.state=f.IDLE)},A.onFragmentOrKeyLoadError=function(L,H){if(H.fatal){this.stopLoad(),this.state=f.ERROR;return}var W=this.config;if(H.chunkMeta){var U=this.getCurrentContext(H.chunkMeta);U&&(H.frag=U.frag,H.levelRetry=!0,this.fragLoadError=W.fragLoadingMaxRetry)}var G=H.frag;if(!(!G||G.type!==L)){var Y=this.fragCurrent;if(console.assert(Y&&G.sn===Y.sn&&G.level===Y.level&&G.urlId===Y.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=W.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var j=Math.min(Math.pow(2,this.fragLoadError)*W.fragLoadingRetryDelay,W.fragLoadingMaxRetryTimeout);this.warn("Fragment "+G.sn+" of "+L+" "+G.level+" failed to load, retrying in "+j+"ms"),this.retryDate=self.performance.now()+j,this.fragLoadError++,this.state=f.FRAG_LOADING_WAITING_RETRY}else H.levelRetry?(L===d.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=f.IDLE):(K.logger.error(H.details+" reaches max retry, redispatch as fatal ..."),H.fatal=!0,this.hls.stopLoad(),this.state=f.ERROR)}},A.afterBufferFlushed=function(L,H,W){if(L){var U=R.BufferHelper.getBuffered(L);this.fragmentTracker.detectEvictedFragments(H,U,W),this.state===f.ENDED&&this.resetLoadingState()}},A.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=f.IDLE},A.resetStartWhenNotLoaded=function(L){if(!this.loadedmetadata){this.startFragRequested=!1;var H=this.levels?this.levels[L].details:null;H!=null&&H.live?(this.startPosition=-1,this.setStartPosition(H,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},A.updateLevelTiming=function(L,H,W,U){var G=this,Y=W.details;console.assert(!!Y,"level.details must be defined");var j=Object.keys(L.elementaryStreams).reduce(function(X,q){var J=L.elementaryStreams[q];if(J){var V=J.endPTS-J.startPTS;if(V<=0)return G.warn("Could not parse fragment "+L.sn+" "+q+" duration reliably ("+V+")"),X||!1;var $=U?0:(0,N.updateFragPTSDTS)(Y,L,J.startPTS,J.endPTS,J.startDTS,J.endDTS);return G.hls.trigger(k.Events.LEVEL_PTS_UPDATED,{details:Y,level:W,drift:$,type:q,frag:L,start:J.startPTS,end:J.endPTS}),!0}return X},!1);j||(this.warn("Found no media in fragment "+L.sn+" of level "+W.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=f.PARSED,this.hls.trigger(k.Events.FRAG_PARSED,{frag:L,part:H})},A.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},S(o,[{key:"state",get:function(){return this._state},set:function(L){var H=this._state;H!==L&&(this._state=L,this.log(H+"->"+L))}}]),o}(g.default)},"./src/controller/buffer-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>m});var C=s("./src/polyfills/number.ts"),g=s("./src/events.ts"),w=s("./src/utils/logger.ts"),R=s("./src/errors.ts"),K=s("./src/utils/buffer-helper.ts"),k=s("./src/utils/mediasource-helper.ts"),F=s("./src/loader/fragment.ts"),B=s("./src/controller/buffer-operation-queue.ts"),P=(0,k.getMediaSource)(),M=/([ha]vc.)(?:\.[^.,]+)+/,m=function(){function N(h){var E=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var d=E.hls,c=E.media,S=E.mediaSource;w.logger.log("[buffer-controller]: Media source opened"),c&&(E.updateMediaElementDuration(),d.trigger(g.Events.MEDIA_ATTACHED,{media:c})),S&&S.removeEventListener("sourceopen",E._onMediaSourceOpen),E.checkPendingTracks()},this._onMediaSourceClose=function(){w.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){w.logger.log("[buffer-controller]: Media source ended")},this.hls=h,this._initSourceBuffer(),this.registerListeners()}var I=N.prototype;return I.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},I.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},I.registerListeners=function(){var E=this.hls;E.on(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),E.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.on(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),E.on(g.Events.BUFFER_RESET,this.onBufferReset,this),E.on(g.Events.BUFFER_APPENDING,this.onBufferAppending,this),E.on(g.Events.BUFFER_CODECS,this.onBufferCodecs,this),E.on(g.Events.BUFFER_EOS,this.onBufferEos,this),E.on(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),E.on(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this),E.on(g.Events.FRAG_PARSED,this.onFragParsed,this),E.on(g.Events.FRAG_CHANGED,this.onFragChanged,this)},I.unregisterListeners=function(){var E=this.hls;E.off(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),E.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.off(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),E.off(g.Events.BUFFER_RESET,this.onBufferReset,this),E.off(g.Events.BUFFER_APPENDING,this.onBufferAppending,this),E.off(g.Events.BUFFER_CODECS,this.onBufferCodecs,this),E.off(g.Events.BUFFER_EOS,this.onBufferEos,this),E.off(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),E.off(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this),E.off(g.Events.FRAG_PARSED,this.onFragParsed,this),E.off(g.Events.FRAG_CHANGED,this.onFragChanged,this)},I._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new B.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},I.onManifestParsed=function(E,d){var c=2;(d.audio&&!d.video||!d.altAudio)&&(c=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=c,this.details=null,w.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},I.onMediaAttaching=function(E,d){var c=this.media=d.media;if(c&&P){var S=this.mediaSource=new P;S.addEventListener("sourceopen",this._onMediaSourceOpen),S.addEventListener("sourceended",this._onMediaSourceEnded),S.addEventListener("sourceclose",this._onMediaSourceClose),c.src=self.URL.createObjectURL(S),this._objectUrl=c.src}},I.onMediaDetaching=function(){var E=this.media,d=this.mediaSource,c=this._objectUrl;if(d){if(w.logger.log("[buffer-controller]: media source detaching"),d.readyState==="open")try{d.endOfStream()}catch(S){w.logger.warn("[buffer-controller]: onMediaDetaching: "+S.message+" while calling endOfStream")}this.onBufferReset(),d.removeEventListener("sourceopen",this._onMediaSourceOpen),d.removeEventListener("sourceended",this._onMediaSourceEnded),d.removeEventListener("sourceclose",this._onMediaSourceClose),E&&(c&&self.URL.revokeObjectURL(c),E.src===c?(E.removeAttribute("src"),E.load()):w.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(g.Events.MEDIA_DETACHED,void 0)},I.onBufferReset=function(){var E=this;this.getSourceBufferTypes().forEach(function(d){var c=E.sourceBuffer[d];try{c&&(E.removeBufferListeners(d),E.mediaSource&&E.mediaSource.removeSourceBuffer(c),E.sourceBuffer[d]=void 0)}catch(S){w.logger.warn("[buffer-controller]: Failed to reset the "+d+" buffer",S)}}),this._initSourceBuffer()},I.onBufferCodecs=function(E,d){var c=this,S=this.getSourceBufferTypes().length;Object.keys(d).forEach(function(v){if(S){var l=c.tracks[v];if(l&&typeof l.buffer.changeType=="function"){var p=d[v],y=p.id,T=p.codec,f=p.levelCodec,a=p.container,_=p.metadata,o=(l.levelCodec||l.codec).replace(M,"$1"),A=(f||T).replace(M,"$1");if(o!==A){var O=a+";codecs="+(f||T);c.appendChangeType(v,O),w.logger.log("[buffer-controller]: switching codec "+o+" to "+A),c.tracks[v]={buffer:l.buffer,codec:T,container:a,levelCodec:f,metadata:_,id:y}}}}else c.pendingTracks[v]=d[v]}),!S&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},I.appendChangeType=function(E,d){var c=this,S=this.operationQueue,v={execute:function(){var p=c.sourceBuffer[E];p&&(w.logger.log("[buffer-controller]: changing "+E+" sourceBuffer type to "+d),p.changeType(d)),S.shiftAndExecuteNext(E)},onStart:function(){},onComplete:function(){},onError:function(p){w.logger.warn("[buffer-controller]: Failed to change "+E+" SourceBuffer type",p)}};S.append(v,E)},I.onBufferAppending=function(E,d){var c=this,S=this.hls,v=this.operationQueue,l=this.tracks,p=d.data,y=d.type,T=d.frag,f=d.part,a=d.chunkMeta,_=a.buffering[y],o=self.performance.now();_.start=o;var A=T.stats.buffering,O=f?f.stats.buffering:null;A.start===0&&(A.start=o),O&&O.start===0&&(O.start=o);var L=l.audio,H=!1;y==="audio"&&(L==null?void 0:L.container)==="audio/mpeg"&&(H=!this.lastMpegAudioChunk||a.id===1||this.lastMpegAudioChunk.sn!==a.sn,this.lastMpegAudioChunk=a);var W=T.start,U={execute:function(){if(_.executeStart=self.performance.now(),H){var Y=c.sourceBuffer[y];if(Y){var j=W-Y.timestampOffset;Math.abs(j)>=.1&&(w.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+W+" (delta: "+j+") sn: "+T.sn+")"),Y.timestampOffset=W)}}c.appendExecutor(p,y)},onStart:function(){},onComplete:function(){var Y=self.performance.now();_.executeEnd=_.end=Y,A.first===0&&(A.first=Y),O&&O.first===0&&(O.first=Y);var j=c.sourceBuffer,X={};for(var q in j)X[q]=K.BufferHelper.getBuffered(j[q]);c.appendError=0,c.hls.trigger(g.Events.BUFFER_APPENDED,{type:y,frag:T,part:f,chunkMeta:a,parent:T.type,timeRanges:X})},onError:function(Y){w.logger.error("[buffer-controller]: Error encountered while trying to append to the "+y+" SourceBuffer",Y);var j={type:R.ErrorTypes.MEDIA_ERROR,parent:T.type,details:R.ErrorDetails.BUFFER_APPEND_ERROR,err:Y,fatal:!1};Y.code===DOMException.QUOTA_EXCEEDED_ERR?j.details=R.ErrorDetails.BUFFER_FULL_ERROR:(c.appendError++,j.details=R.ErrorDetails.BUFFER_APPEND_ERROR,c.appendError>S.config.appendErrorMaxRetry&&(w.logger.error("[buffer-controller]: Failed "+S.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),j.fatal=!0,S.stopLoad())),S.trigger(g.Events.ERROR,j)}};v.append(U,y)},I.onBufferFlushing=function(E,d){var c=this,S=this.operationQueue,v=function(p){return{execute:c.removeExecutor.bind(c,p,d.startOffset,d.endOffset),onStart:function(){},onComplete:function(){c.hls.trigger(g.Events.BUFFER_FLUSHED,{type:p})},onError:function(T){w.logger.warn("[buffer-controller]: Failed to remove from "+p+" SourceBuffer",T)}}};d.type?S.append(v(d.type),d.type):this.getSourceBufferTypes().forEach(function(l){S.append(v(l),l)})},I.onFragParsed=function(E,d){var c=this,S=d.frag,v=d.part,l=[],p=v?v.elementaryStreams:S.elementaryStreams;p[F.ElementaryStreamTypes.AUDIOVIDEO]?l.push("audiovideo"):(p[F.ElementaryStreamTypes.AUDIO]&&l.push("audio"),p[F.ElementaryStreamTypes.VIDEO]&&l.push("video"));var y=function(){var f=self.performance.now();S.stats.buffering.end=f,v&&(v.stats.buffering.end=f);var a=v?v.stats:S.stats;c.hls.trigger(g.Events.FRAG_BUFFERED,{frag:S,part:v,stats:a,id:S.type})};l.length===0&&w.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+S.type+" level: "+S.level+" sn: "+S.sn),this.blockBuffers(y,l)},I.onFragChanged=function(E,d){this.flushBackBuffer()},I.onBufferEos=function(E,d){var c=this,S=this.getSourceBufferTypes().reduce(function(v,l){var p=c.sourceBuffer[l];return p&&(!d.type||d.type===l)&&(p.ending=!0,p.ended||(p.ended=!0,w.logger.log("[buffer-controller]: "+l+" sourceBuffer now EOS"))),v&&!!(!p||p.ended)},!0);S&&(w.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){c.getSourceBufferTypes().forEach(function(l){var p=c.sourceBuffer[l];p&&(p.ending=!1)});var v=c.mediaSource;if(!v||v.readyState!=="open"){v&&w.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+v.readyState);return}w.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),v.endOfStream()}))},I.onLevelUpdated=function(E,d){var c=d.details;c.fragments.length&&(this.details=c,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},I.flushBackBuffer=function(){var E=this.hls,d=this.details,c=this.media,S=this.sourceBuffer;if(!(!c||d===null)){var v=this.getSourceBufferTypes();if(v.length){var l=d.live&&E.config.liveBackBufferLength!==null?E.config.liveBackBufferLength:E.config.backBufferLength;if(!(!(0,C.isFiniteNumber)(l)||l<0)){var p=c.currentTime,y=d.levelTargetDuration,T=Math.max(l,y),f=Math.floor(p/y)*y-T;v.forEach(function(a){var _=S[a];if(_){var o=K.BufferHelper.getBuffered(_);if(o.length>0&&f>o.start(0)){if(E.trigger(g.Events.BACK_BUFFER_REACHED,{bufferEnd:f}),d.live)E.trigger(g.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:f});else if(_.ended&&o.end(o.length-1)-p<y*2){w.logger.info("[buffer-controller]: Cannot flush "+a+" back buffer while SourceBuffer is in ended state");return}E.trigger(g.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:f,type:a})}}})}}}},I.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var E=this.details,d=this.hls,c=this.media,S=this.mediaSource,v=E.fragments[0].start+E.totalduration,l=c.duration,p=(0,C.isFiniteNumber)(S.duration)?S.duration:0;E.live&&d.config.liveDurationInfinity?(w.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),S.duration=1/0,this.updateSeekableRange(E)):(v>p&&v>l||!(0,C.isFiniteNumber)(l))&&(w.logger.log("[buffer-controller]: Updating Media Source duration to "+v.toFixed(3)),S.duration=v)}},I.updateSeekableRange=function(E){var d=this.mediaSource,c=E.fragments,S=c.length;if(S&&E.live&&d!==null&&d!==void 0&&d.setLiveSeekableRange){var v=Math.max(0,c[0].start),l=Math.max(v,v+E.totalduration);d.setLiveSeekableRange(v,l)}},I.checkPendingTracks=function(){var E=this.bufferCodecEventsExpected,d=this.operationQueue,c=this.pendingTracks,S=Object.keys(c).length;if(S&&!E||S===2){this.createSourceBuffers(c),this.pendingTracks={};var v=this.getSourceBufferTypes();if(v.length===0){this.hls.trigger(g.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}v.forEach(function(l){d.executeNext(l)})}},I.createSourceBuffers=function(E){var d=this.sourceBuffer,c=this.mediaSource;if(!c)throw Error("createSourceBuffers called when mediaSource was null");var S=0;for(var v in E)if(!d[v]){var l=E[v];if(!l)throw Error("source buffer exists for track "+v+", however track does not");var p=l.levelCodec||l.codec,y=l.container+";codecs="+p;w.logger.log("[buffer-controller]: creating sourceBuffer("+y+")");try{var T=d[v]=c.addSourceBuffer(y),f=v;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.tracks[v]={buffer:T,codec:p,container:l.container,levelCodec:l.levelCodec,metadata:l.metadata,id:l.id},S++}catch(a){w.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+a.message),this.hls.trigger(g.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:a,mimeType:y})}}S&&this.hls.trigger(g.Events.BUFFER_CREATED,{tracks:this.tracks})},I._onSBUpdateStart=function(E){var d=this.operationQueue,c=d.current(E);c.onStart()},I._onSBUpdateEnd=function(E){var d=this.operationQueue,c=d.current(E);c.onComplete(),d.shiftAndExecuteNext(E)},I._onSBUpdateError=function(E,d){w.logger.error("[buffer-controller]: "+E+" SourceBuffer error",d),this.hls.trigger(g.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var c=this.operationQueue.current(E);c&&c.onError(d)},I.removeExecutor=function(E,d,c){var S=this.media,v=this.mediaSource,l=this.operationQueue,p=this.sourceBuffer,y=p[E];if(!S||!v||!y){w.logger.warn("[buffer-controller]: Attempting to remove from the "+E+" SourceBuffer, but it does not exist"),l.shiftAndExecuteNext(E);return}var T=(0,C.isFiniteNumber)(S.duration)?S.duration:1/0,f=(0,C.isFiniteNumber)(v.duration)?v.duration:1/0,a=Math.max(0,d),_=Math.min(c,T,f);_>a&&!y.ending?(y.ended=!1,w.logger.log("[buffer-controller]: Removing ["+a+","+_+"] from the "+E+" SourceBuffer"),console.assert(!y.updating,E+" sourceBuffer must not be updating"),y.remove(a,_)):l.shiftAndExecuteNext(E)},I.appendExecutor=function(E,d){var c=this.operationQueue,S=this.sourceBuffer,v=S[d];if(!v){w.logger.warn("[buffer-controller]: Attempting to append to the "+d+" SourceBuffer, but it does not exist"),c.shiftAndExecuteNext(d);return}v.ended=!1,console.assert(!v.updating,d+" sourceBuffer must not be updating"),v.appendBuffer(E)},I.blockBuffers=function(E,d){var c=this;if(d===void 0&&(d=this.getSourceBufferTypes()),!d.length){w.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(E);return}var S=this.operationQueue,v=d.map(function(l){return S.appendBlocker(l)});Promise.all(v).then(function(){E(),d.forEach(function(l){var p=c.sourceBuffer[l];(!p||!p.updating)&&S.shiftAndExecuteNext(l)})})},I.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},I.addBufferListener=function(E,d,c){var S=this.sourceBuffer[E];if(S){var v=c.bind(this,E);this.listeners[E].push({event:d,listener:v}),S.addEventListener(d,v)}},I.removeBufferListeners=function(E){var d=this.sourceBuffer[E];d&&this.listeners[E].forEach(function(c){d.removeEventListener(c.event,c.listener)})},N}()},"./src/controller/buffer-operation-queue.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>g});var C=s("./src/utils/logger.ts"),g=function(){function w(K){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=K}var R=w.prototype;return R.append=function(k,F){var B=this.queues[F];B.push(k),B.length===1&&this.buffers[F]&&this.executeNext(F)},R.insertAbort=function(k,F){var B=this.queues[F];B.unshift(k),this.executeNext(F)},R.appendBlocker=function(k){var F,B=new Promise(function(M){F=M}),P={execute:F,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(P,k),B},R.executeNext=function(k){var F=this.buffers,B=this.queues,P=F[k],M=B[k];if(M.length){var m=M[0];try{m.execute()}catch(N){C.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),m.onError(N),(!P||!P.updating)&&(M.shift(),this.executeNext(k))}}},R.shiftAndExecuteNext=function(k){this.queues[k].shift(),this.executeNext(k)},R.current=function(k){return this.queues[k][0]},w}()},"./src/controller/cap-level-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>F});var C=s("./src/events.ts");function g(B,P){for(var M=0;M<P.length;M++){var m=P[M];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(B,R(m.key),m)}}function w(B,P,M){return P&&g(B.prototype,P),M&&g(B,M),Object.defineProperty(B,"prototype",{writable:!1}),B}function R(B){var P=K(B,"string");return typeof P=="symbol"?P:String(P)}function K(B,P){if(typeof B!="object"||B===null)return B;var M=B[Symbol.toPrimitive];if(M!==void 0){var m=M.call(B,P||"default");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return(P==="string"?String:Number)(B)}var k=function(){function B(M){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=M,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var P=B.prototype;return P.setStreamController=function(m){this.streamController=m},P.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},P.registerListeners=function(){var m=this.hls;m.on(C.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.on(C.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(C.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},P.unregisterListener=function(){var m=this.hls;m.off(C.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.off(C.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(C.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},P.onFpsDropLevelCapping=function(m,N){B.isLevelAllowed(N.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(N.droppedLevel)},P.onMediaAttaching=function(m,N){this.media=N.media instanceof HTMLVideoElement?N.media:null,this.clientRect=null},P.onManifestParsed=function(m,N){var I=this.hls;this.restrictedLevels=[],this.firstLevel=N.firstLevel,I.config.capLevelToPlayerSize&&N.video&&this.startCapping()},P.onBufferCodecs=function(m,N){var I=this.hls;I.config.capLevelToPlayerSize&&N.video&&this.startCapping()},P.onMediaDetaching=function(){this.stopCapping()},P.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var m=this.hls.levels;if(m.length){var N=this.hls;N.autoLevelCapping=this.getMaxLevel(m.length-1),N.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=N.autoLevelCapping}}},P.getMaxLevel=function(m){var N=this,I=this.hls.levels;if(!I.length)return-1;var h=I.filter(function(E,d){return B.isLevelAllowed(d,N.restrictedLevels)&&d<=m});return this.clientRect=null,B.getMaxLevelByMediaSize(h,this.mediaWidth,this.mediaHeight)},P.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},P.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},P.getDimensions=function(){if(this.clientRect)return this.clientRect;var m=this.media,N={width:0,height:0};if(m){var I=m.getBoundingClientRect();N.width=I.width,N.height=I.height,!N.width&&!N.height&&(N.width=I.right-I.left||m.width||0,N.height=I.bottom-I.top||m.height||0)}return this.clientRect=N,N},B.isLevelAllowed=function(m,N){return N===void 0&&(N=[]),N.indexOf(m)===-1},B.getMaxLevelByMediaSize=function(m,N,I){if(!m||!m.length)return-1;for(var h=function(v,l){return l?v.width!==l.width||v.height!==l.height:!0},E=m.length-1,d=0;d<m.length;d+=1){var c=m[d];if((c.width>=N||c.height>=I)&&h(c,m[d+1])){E=d;break}}return E},w(B,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var m=1;if(!this.hls.config.ignoreDevicePixelRatio)try{m=self.devicePixelRatio}catch{}return m}}]),B}();const F=k},"./src/controller/cmcd-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>I});var C=s("./src/events.ts"),g=s("./src/types/cmcd.ts"),w=s("./src/utils/buffer-helper.ts"),R=s("./src/utils/logger.ts");function K(h,E){for(var d=0;d<E.length;d++){var c=E[d];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(h,F(c.key),c)}}function k(h,E,d){return E&&K(h.prototype,E),d&&K(h,d),Object.defineProperty(h,"prototype",{writable:!1}),h}function F(h){var E=B(h,"string");return typeof E=="symbol"?E:String(E)}function B(h,E){if(typeof h!="object"||h===null)return h;var d=h[Symbol.toPrimitive];if(d!==void 0){var c=d.call(h,E||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(E==="string"?String:Number)(h)}function P(h,E){var d=typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"];if(d)return(d=d.call(h)).next.bind(d);if(Array.isArray(h)||(d=M(h))||E&&h&&typeof h.length=="number"){d&&(h=d);var c=0;return function(){return c>=h.length?{done:!0}:{done:!1,value:h[c++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function M(h,E){if(h){if(typeof h=="string")return m(h,E);var d=Object.prototype.toString.call(h).slice(8,-1);if(d==="Object"&&h.constructor&&(d=h.constructor.name),d==="Map"||d==="Set")return Array.from(h);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return m(h,E)}}function m(h,E){(E==null||E>h.length)&&(E=h.length);for(var d=0,c=new Array(E);d<E;d++)c[d]=h[d];return c}function N(){return N=Object.assign?Object.assign.bind():function(h){for(var E=1;E<arguments.length;E++){var d=arguments[E];for(var c in d)Object.prototype.hasOwnProperty.call(d,c)&&(h[c]=d[c])}return h},N.apply(this,arguments)}var I=function(){function h(d){var c=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){c.initialized&&(c.starved=!0),c.buffering=!0},this.onPlaying=function(){c.initialized||(c.initialized=!0),c.buffering=!1},this.applyPlaylistData=function(l){try{c.apply(l,{ot:g.CMCDObjectType.MANIFEST,su:!c.initialized})}catch(p){R.logger.warn("Could not generate manifest CMCD data.",p)}},this.applyFragmentData=function(l){try{var p=l.frag,y=c.hls.levels[p.level],T=c.getObjectType(p),f={d:p.duration*1e3,ot:T};(T===g.CMCDObjectType.VIDEO||T===g.CMCDObjectType.AUDIO||T==g.CMCDObjectType.MUXED)&&(f.br=y.bitrate/1e3,f.tb=c.getTopBandwidth(T)/1e3,f.bl=c.getBufferLength(T)),c.apply(l,f)}catch(a){R.logger.warn("Could not generate segment CMCD data.",a)}},this.hls=d;var S=this.config=d.config,v=S.cmcd;v!=null&&(S.pLoader=this.createPlaylistLoader(),S.fLoader=this.createFragmentLoader(),this.sid=v.sessionId||h.uuid(),this.cid=v.contentId,this.useHeaders=v.useHeaders===!0,this.registerListeners())}var E=h.prototype;return E.registerListeners=function(){var c=this.hls;c.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),c.on(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),c.on(C.Events.BUFFER_CREATED,this.onBufferCreated,this)},E.unregisterListeners=function(){var c=this.hls;c.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),c.off(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),c.off(C.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},E.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},E.onMediaAttached=function(c,S){this.media=S.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},E.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},E.onBufferCreated=function(c,S){var v,l;this.audioBuffer=(v=S.tracks.audio)===null||v===void 0?void 0:v.buffer,this.videoBuffer=(l=S.tracks.video)===null||l===void 0?void 0:l.buffer},E.createData=function(){var c;return{v:g.CMCDVersion,sf:g.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(c=this.media)===null||c===void 0?void 0:c.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},E.apply=function(c,S){S===void 0&&(S={}),N(S,this.createData());var v=S.ot===g.CMCDObjectType.INIT||S.ot===g.CMCDObjectType.VIDEO||S.ot===g.CMCDObjectType.MUXED;if(this.starved&&v&&(S.bs=!0,S.su=!0,this.starved=!1),S.su==null&&(S.su=this.buffering),this.useHeaders){var l=h.toHeaders(S);if(!Object.keys(l).length)return;c.headers||(c.headers={}),N(c.headers,l)}else{var p=h.toQuery(S);if(!p)return;c.url=h.appendQueryToUri(c.url,p)}},E.getObjectType=function(c){var S=c.type;if(S==="subtitle")return g.CMCDObjectType.TIMED_TEXT;if(c.sn==="initSegment")return g.CMCDObjectType.INIT;if(S==="audio")return g.CMCDObjectType.AUDIO;if(S==="main")return this.hls.audioTracks.length?g.CMCDObjectType.VIDEO:g.CMCDObjectType.MUXED},E.getTopBandwidth=function(c){var S=0,v,l=this.hls;if(c===g.CMCDObjectType.AUDIO)v=l.audioTracks;else{var p=l.maxAutoLevel,y=p>-1?p+1:l.levels.length;v=l.levels.slice(0,y)}for(var T=P(v),f;!(f=T()).done;){var a=f.value;a.bitrate>S&&(S=a.bitrate)}return S>0?S:NaN},E.getBufferLength=function(c){var S=this.hls.media,v=c===g.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!v||!S)return NaN;var l=w.BufferHelper.bufferInfo(v,S.currentTime,this.config.maxBufferHole);return l.len*1e3},E.createPlaylistLoader=function(){var c=this.config.pLoader,S=this.applyPlaylistData,v=c||this.config.loader;return function(){function l(y){this.loader=void 0,this.loader=new v(y)}var p=l.prototype;return p.destroy=function(){this.loader.destroy()},p.abort=function(){this.loader.abort()},p.load=function(T,f,a){S(T),this.loader.load(T,f,a)},k(l,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),l}()},E.createFragmentLoader=function(){var c=this.config.fLoader,S=this.applyFragmentData,v=c||this.config.loader;return function(){function l(y){this.loader=void 0,this.loader=new v(y)}var p=l.prototype;return p.destroy=function(){this.loader.destroy()},p.abort=function(){this.loader.abort()},p.load=function(T,f,a){S(T),this.loader.load(T,f,a)},k(l,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),l}()},h.uuid=function(){var c=URL.createObjectURL(new Blob),S=c.toString();return URL.revokeObjectURL(c),S.slice(S.lastIndexOf("/")+1)},h.serialize=function(c){for(var S=[],v=function(U){return!Number.isNaN(U)&&U!=null&&U!==""&&U!==!1},l=function(U){return Math.round(U)},p=function(U){return l(U/100)*100},y=function(U){return encodeURIComponent(U)},T={br:l,d:l,bl:p,dl:p,mtp:p,nor:y,rtp:p,tb:l},f=Object.keys(c||{}).sort(),a=P(f),_;!(_=a()).done;){var o=_.value,A=c[o];if(v(A)&&!(o==="v"&&A===1)&&!(o=="pr"&&A===1)){var O=T[o];O&&(A=O(A));var L=typeof A,H=void 0;o==="ot"||o==="sf"||o==="st"?H=o+"="+A:L==="boolean"?H=o:L==="number"?H=o+"="+A:H=o+"="+JSON.stringify(A),S.push(H)}}return S.join(",")},h.toHeaders=function(c){for(var S=Object.keys(c),v={},l=["Object","Request","Session","Status"],p=[{},{},{},{}],y={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},T=0,f=S;T<f.length;T++){var a=f[T],_=y[a]!=null?y[a]:1;p[_][a]=c[a]}for(var o=0;o<p.length;o++){var A=h.serialize(p[o]);A&&(v["CMCD-"+l[o]]=A)}return v},h.toQuery=function(c){return"CMCD="+encodeURIComponent(h.serialize(c))},h.appendQueryToUri=function(c,S){if(!S)return c;var v=c.includes("?")?"&":"?";return""+c+v+S},h}()},"./src/controller/eme-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>T});var C=s("./src/events.ts"),g=s("./src/errors.ts"),w=s("./src/utils/logger.ts"),R=s("./src/utils/mediakeys-helper.ts"),K=s("./src/utils/keysystem-util.ts"),k=s("./src/utils/numeric-encoding-utils.ts"),F=s("./src/loader/level-key.ts"),B=s("./src/utils/hex.ts"),P=s("./src/utils/mp4-tools.ts"),M=s("./node_modules/eventemitter3/index.js"),m=s.n(M);function N(f,a){f.prototype=Object.create(a.prototype),f.prototype.constructor=f,c(f,a)}function I(f){var a=typeof Map=="function"?new Map:void 0;return I=function(o){if(o===null||!d(o))return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a<"u"){if(a.has(o))return a.get(o);a.set(o,A)}function A(){return h(o,arguments,S(this).constructor)}return A.prototype=Object.create(o.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),c(A,o)},I(f)}function h(f,a,_){return E()?h=Reflect.construct.bind():h=function(A,O,L){var H=[null];H.push.apply(H,O);var W=Function.bind.apply(A,H),U=new W;return L&&c(U,L.prototype),U},h.apply(null,arguments)}function E(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function d(f){return Function.toString.call(f).indexOf("[native code]")!==-1}function c(f,a){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,A){return o.__proto__=A,o},c(f,a)}function S(f){return S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(_){return _.__proto__||Object.getPrototypeOf(_)},S(f)}var v=3,l="[eme]",p=function(){function f(_){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=f.CDMCleanupPromise?[f.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=w.logger.debug.bind(w.logger,l),this.log=w.logger.log.bind(w.logger,l),this.warn=w.logger.warn.bind(w.logger,l),this.error=w.logger.error.bind(w.logger,l),this.hls=_,this.config=_.config,this.registerListeners()}var a=f.prototype;return a.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},a.registerListeners=function(){this.hls.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(C.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},a.unregisterListeners=function(){this.hls.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(C.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},a.getLicenseServerUrl=function(o){var A=this.config,O=A.drmSystems,L=A.widevineLicenseUrl,H=O[o];if(H)return H.licenseUrl;if(o===R.KeySystems.WIDEVINE&&L)return L;throw new Error('no license server URL configured for key-system "'+o+'"')},a.getServerCertificateUrl=function(o){var A=this.config.drmSystems,O=A[o];if(O)return O.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+o+'"]')},a.attemptKeySystemAccess=function(o){var A=this,O=this.hls.levels,L=function(G,Y,j){return!!G&&j.indexOf(G)===Y},H=O.map(function(U){return U.audioCodec}).filter(L),W=O.map(function(U){return U.videoCodec}).filter(L);return H.length+W.length===0&&W.push("avc1.42e01e"),new Promise(function(U,G){var Y=function j(X){var q=X.shift();A.getMediaKeysPromise(q,H,W).then(function(J){return U({keySystem:q,mediaKeys:J})}).catch(function(J){X.length?j(X):J instanceof y?G(J):G(new y({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:J,fatal:!0},J.message))})};Y(o)})},a.requestMediaKeySystemAccess=function(o,A){var O=this.config.requestMediaKeySystemAccessFunc;if(typeof O!="function"){var L="Configured requestMediaKeySystemAccess is not a function "+O;return R.requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(L="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(L))}return O(o,A)},a.getMediaKeysPromise=function(o,A,O){var L=this,H=(0,R.getSupportedMediaKeySystemConfigurations)(o,A,O,this.config.drmSystemOptions),W=this.keySystemAccessPromises[o],U=W==null?void 0:W.keySystemAccess;if(!U){this.log('Requesting encrypted media "'+o+'" key-system access with config: '+JSON.stringify(H)),U=this.requestMediaKeySystemAccess(o,H);var G=this.keySystemAccessPromises[o]={keySystemAccess:U};return U.catch(function(Y){L.log('Failed to obtain access to key-system "'+o+'": '+Y)}),U.then(function(Y){L.log('Access for key-system "'+Y.keySystem+'" obtained');var j=L.fetchServerCertificate(o);return L.log('Create media-keys for "'+o+'"'),G.mediaKeys=Y.createMediaKeys().then(function(X){return L.log('Media-keys created for "'+o+'"'),j.then(function(q){return q?L.setMediaKeysServerCertificate(X,o,q):X})}),G.mediaKeys.catch(function(X){L.error('Failed to create media-keys for "'+o+'"}: '+X)}),G.mediaKeys})}return U.then(function(){return W.mediaKeys})},a.createMediaKeySessionContext=function(o){var A=o.decryptdata,O=o.keySystem,L=o.mediaKeys;console.assert(!!L,"mediaKeys is defined"),this.log('Creating key-system session "'+O+'" keyId: '+B.default.hexDump(A.keyId||[]));var H=L.createSession(),W={decryptdata:A,keySystem:O,mediaKeys:L,mediaKeysSession:H,keyStatus:"status-pending"};return this.mediaKeySessions.push(W),W},a.renewKeySession=function(o){var A=o.decryptdata;if(A.pssh){var O=this.createMediaKeySessionContext(o),L=this.getKeyIdString(A),H="cenc";this.keyIdToKeySessionPromise[L]=this.generateRequestWithPreferredKeySession(O,H,A.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(o)},a.getKeyIdString=function(o){if(!o)throw new Error("Could not read keyId of undefined decryptdata");if(o.keyId===null)throw new Error("keyId is null");return B.default.hexDump(o.keyId)},a.updateKeySession=function(o,A){var O,L=o.mediaKeysSession;return this.log('Updating key-session "'+L.sessionId+'" for keyID '+B.default.hexDump(((O=o.decryptdata)===null||O===void 0?void 0:O.keyId)||[])+`
      } (data length: `+(A&&A.byteLength)+")"),L.update(A)},a.selectKeySystemFormat=function(o){var A=Object.keys(o.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+o.sn+" "+o.type+": "+o.level+") key formats "+A.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(A)),this.keyFormatPromise},a.getKeyFormatPromise=function(o){var A=this;return new Promise(function(O,L){var H=(0,R.getKeySystemsForConfig)(A.config),W=o.map(R.keySystemFormatToKeySystemDomain).filter(function(U){return!!U&&H.indexOf(U)!==-1});return A.getKeySystemSelectionPromise(W).then(function(U){var G=U.keySystem,Y=(0,R.keySystemDomainToKeySystemFormat)(G);Y?O(Y):L(new Error('Unable to find format for key-system "'+G+'"'))}).catch(L)})},a.loadKey=function(o){var A=this,O=o.keyInfo.decryptdata,L=this.getKeyIdString(O),H="(keyId: "+L+' format: "'+O.keyFormat+'" method: '+O.method+" uri: "+O.uri+")";this.log("Starting session for key "+H);var W=this.keyIdToKeySessionPromise[L];return W||(W=this.keyIdToKeySessionPromise[L]=this.getKeySystemForKeyPromise(O).then(function(U){var G=U.keySystem,Y=U.mediaKeys;return A.throwIfDestroyed(),A.log("Handle encrypted media sn: "+o.frag.sn+" "+o.frag.type+": "+o.frag.level+" using key "+H),A.attemptSetMediaKeys(G,Y).then(function(){A.throwIfDestroyed();var j=A.createMediaKeySessionContext({keySystem:G,mediaKeys:Y,decryptdata:O}),X="cenc";return A.generateRequestWithPreferredKeySession(j,X,O.pssh,"playlist-key")})}),W.catch(function(U){return A.handleError(U)})),W},a.throwIfDestroyed=function(o){if(!this.hls)throw new Error("invalid state")},a.handleError=function(o){this.hls&&(this.error(o.message),o instanceof y?this.hls.trigger(C.Events.ERROR,o.data):this.hls.trigger(C.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:o,fatal:!0}))},a.getKeySystemForKeyPromise=function(o){var A=this.getKeyIdString(o),O=this.keyIdToKeySessionPromise[A];if(!O){var L=(0,R.keySystemFormatToKeySystemDomain)(o.keyFormat),H=L?[L]:(0,R.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(H)}return O},a.getKeySystemSelectionPromise=function(o){if(o.length||(o=(0,R.getKeySystemsForConfig)(this.config)),o.length===0)throw new y({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(o)},a._onMediaEncrypted=function(o){var A=this,O=o.initDataType,L=o.initData;if(this.debug('"'+o.type+'" event: init data type: "'+O+'"'),L!==null){var H,W;if(O==="sinf"&&this.config.drmSystems[R.KeySystems.FAIRPLAY]){var U=(0,P.bin2str)(new Uint8Array(L));try{var G=(0,k.base64Decode)(JSON.parse(U).sinf),Y=(0,P.parseSinf)(new Uint8Array(G));if(!Y)return;H=Y.subarray(8,24),W=R.KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{var j=(0,P.parsePssh)(L);if(j===null)return;j.version===0&&j.systemId===R.KeySystemIds.WIDEVINE&&j.data&&(H=j.data.subarray(8,24)),W=(0,R.keySystemIdToKeySystemDomain)(j.systemId)}if(!(!W||!H)){for(var X=B.default.hexDump(H),q=this.keyIdToKeySessionPromise,J=this.mediaKeySessions,V=q[X],$=function(ae){var le=J[ae],ne=le.decryptdata;if(ne.pssh||!ne.keyId)return"continue";var ie=B.default.hexDump(ne.keyId);if(X===ie||ne.uri.replace(/-/g,"").indexOf(X)!==-1)return V=q[ie],delete q[ie],ne.pssh=new Uint8Array(L),ne.keyId=H,V=q[X]=V.then(function(){return A.generateRequestWithPreferredKeySession(le,O,L,"encrypted-event-key-match")}),"break"},ee=0;ee<J.length;ee++){var Z=$(ee);if(Z!=="continue"&&Z==="break")break}V||(V=q[X]=this.getKeySystemSelectionPromise([W]).then(function(re){var ae,le=re.keySystem,ne=re.mediaKeys;A.throwIfDestroyed();var ie=new F.LevelKey("ISO-23001-7",X,(ae=(0,R.keySystemDomainToKeySystemFormat)(le))!=null?ae:"");return ie.pssh=new Uint8Array(L),ie.keyId=H,A.attemptSetMediaKeys(le,ne).then(function(){A.throwIfDestroyed();var oe=A.createMediaKeySessionContext({decryptdata:ie,keySystem:le,mediaKeys:ne});return A.generateRequestWithPreferredKeySession(oe,O,L,"encrypted-event-no-match")})})),V.catch(function(re){return A.handleError(re)})}}},a._onWaitingForKey=function(o){this.log('"'+o.type+'" event')},a.attemptSetMediaKeys=function(o,A){var O=this,L=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+o+'"');var H=Promise.all(L).then(function(){if(!O.media)throw new Error("Attempted to set mediaKeys without media element attached");return O.media.setMediaKeys(A)});return this.setMediaKeysQueue.push(H),H.then(function(){O.log('Media-keys set for "'+o+'"'),L.push(H),O.setMediaKeysQueue=O.setMediaKeysQueue.filter(function(W){return L.indexOf(W)===-1})})},a.generateRequestWithPreferredKeySession=function(o,A,O,L){var H,W,U=this,G=(H=this.config.drmSystems)===null||H===void 0||(W=H[o.keySystem])===null||W===void 0?void 0:W.generateRequest;if(G)try{var Y=G.call(this.hls,A,O,o);if(!Y)throw new Error("Invalid response from configured generateRequest filter");A=Y.initDataType,O=o.decryptdata.pssh=Y.initData?new Uint8Array(Y.initData):null}catch(V){var j;if(this.warn(V.message),(j=this.hls)!==null&&j!==void 0&&j.config.debug)throw V}if(O===null)return this.log('Skipping key-session request for "'+L+'" (no initData)'),Promise.resolve(o);var X=this.getKeyIdString(o.decryptdata);this.log('Generating key-session request for "'+L+'": '+X+" (init data type: "+A+" length: "+(O?O.byteLength:null)+")");var q=new(m());o.mediaKeysSession.onmessage=function(V){var $=o.mediaKeysSession;if(!$){q.emit("error",new Error("invalid state"));return}var ee=V.messageType,Z=V.message;U.log('"'+ee+'" message event for session "'+$.sessionId+'" message size: '+Z.byteLength),ee==="license-request"||ee==="license-renewal"?U.renewLicense(o,Z).catch(function(re){U.handleError(re),q.emit("error",re)}):ee==="license-release"?o.keySystem===R.KeySystems.FAIRPLAY&&(U.updateKeySession(o,(0,K.strToUtf8array)("acknowledged")),U.removeSession(o)):U.warn('unhandled media key message type "'+ee+'"')},o.mediaKeysSession.onkeystatuseschange=function(V){var $=o.mediaKeysSession;if(!$){q.emit("error",new Error("invalid state"));return}U.onKeyStatusChange(o);var ee=o.keyStatus;q.emit("keyStatus",ee),ee==="expired"&&(U.warn(o.keySystem+" expired for key "+X),U.renewKeySession(o))};var J=new Promise(function(V,$){q.on("error",$),q.on("keyStatus",function(ee){ee.startsWith("usable")?V():ee==="output-restricted"?$(new y({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):ee==="internal-error"?$(new y({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+ee+'"')):ee==="expired"?$(new Error("key expired while generating request")):U.warn('unhandled key status change "'+ee+'"')})});return o.mediaKeysSession.generateRequest(A,O).then(function(){var V;U.log('Request generated for key-session "'+((V=o.mediaKeysSession)===null||V===void 0?void 0:V.sessionId)+'" keyId: '+X)}).catch(function(V){throw new y({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:V,fatal:!1},"Error generating key-session request: "+V)}).then(function(){return J}).catch(function(V){throw q.removeAllListeners(),U.removeSession(o),V}).then(function(){return q.removeAllListeners(),o})},a.onKeyStatusChange=function(o){var A=this;o.mediaKeysSession.keyStatuses.forEach(function(O,L){A.log('key status change "'+O+'" for keyStatuses keyId: '+B.default.hexDump("buffer"in L?new Uint8Array(L.buffer,L.byteOffset,L.byteLength):new Uint8Array(L))+" session keyId: "+B.default.hexDump(new Uint8Array(o.decryptdata.keyId||[]))+" uri: "+o.decryptdata.uri),o.keyStatus=O})},a.fetchServerCertificate=function(o){var A=this;return new Promise(function(O,L){var H=A.getServerCertificateUrl(o);if(!H)return O();A.log('Fetching serverCertificate for "'+o+'"');var W=new XMLHttpRequest;W.open("GET",H,!0),W.responseType="arraybuffer",W.onreadystatechange=function(){W.readyState===XMLHttpRequest.DONE&&(W.status===200?O(W.response):L(new y({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:W},'"'+o+'" certificate request XHR failed ('+H+"). Status: "+W.status+" ("+W.statusText+")")))},W.send()})},a.setMediaKeysServerCertificate=function(o,A,O){var L=this;return new Promise(function(H,W){o.setServerCertificate(O).then(function(U){L.log("setServerCertificate "+(U?"success":"not supported by CDM")+" ("+(O==null?void 0:O.byteLength)+') on "'+A+'"'),H(o)}).catch(function(U){W(new y({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:U,fatal:!0},U.message))})})},a.renewLicense=function(o,A){var O=this;return this.requestLicense(o,new Uint8Array(A)).then(function(L){return O.updateKeySession(o,new Uint8Array(L)).catch(function(H){throw new y({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:H,fatal:!0},H.message)})})},a.setupLicenseXHR=function(o,A,O,L){var H=this,W=this.config.licenseXhrSetup;return W?Promise.resolve().then(function(){if(!O.decryptdata)throw new Error("Key removed");return W.call(H.hls,o,A,O,L)}).catch(function(U){if(!O.decryptdata)throw U;return o.open("POST",A,!0),W.call(H.hls,o,A,O,L)}).then(function(U){o.readyState||o.open("POST",A,!0);var G=U||L;return{xhr:o,licenseChallenge:G}}):(o.open("POST",A,!0),Promise.resolve({xhr:o,licenseChallenge:L}))},a.requestLicense=function(o,A){var O=this;return new Promise(function(L,H){var W=O.getLicenseServerUrl(o.keySystem);O.log("Sending license request to URL: "+W);var U=new XMLHttpRequest;U.responseType="arraybuffer",U.onreadystatechange=function(){if(!O.hls||!o.mediaKeysSession)return H(new Error("invalid state"));if(U.readyState===4)if(U.status===200){O._requestLicenseFailureCount=0;var G=U.response;O.log("License received "+(G instanceof ArrayBuffer?G.byteLength:G));var Y=O.config.licenseResponseCallback;if(Y)try{G=Y.call(O.hls,U,W,o)}catch(X){O.error(X)}L(G)}else if(O._requestLicenseFailureCount++,O._requestLicenseFailureCount>v||U.status>=400&&U.status<500)H(new y({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:U},"License Request XHR failed ("+W+"). Status: "+U.status+" ("+U.statusText+")"));else{var j=v-O._requestLicenseFailureCount+1;O.warn("Retrying license request, "+j+" attempts left"),O.requestLicense(o,A).then(L,H)}},o.licenseXhr&&o.licenseXhr.readyState!==XMLHttpRequest.DONE&&o.licenseXhr.abort(),o.licenseXhr=U,O.setupLicenseXHR(U,W,o,A).then(function(G){var Y=G.xhr,j=G.licenseChallenge;Y.send(j)})})},a.onMediaAttached=function(o,A){if(this.config.emeEnabled){var O=A.media;this.media=O,O.addEventListener("encrypted",this.onMediaEncrypted),O.addEventListener("waitingforkey",this.onWaitingForKey)}},a.onMediaDetached=function(){var o=this,A=this.media,O=this.mediaKeySessions;A&&(A.removeEventListener("encrypted",this.onMediaEncrypted),A.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},F.LevelKey.clearKeyUriToKeyIdMap();var L=O.length;f.CDMCleanupPromise=Promise.all(O.map(function(H){return o.removeSession(H)}).concat(A==null?void 0:A.setMediaKeys(null).catch(function(H){o.log("Could not clear media keys: "+H+". media.src: "+(A==null?void 0:A.src))}))).then(function(){L&&(o.log("finished closing key sessions and clearing media keys"),O.length=0)}).catch(function(H){o.log("Could not close sessions and clear media keys: "+H+". media.src: "+(A==null?void 0:A.src))})},a.onManifestLoaded=function(o,A){var O=A.sessionKeys;if(!(!O||!this.config.emeEnabled)&&!this.keyFormatPromise){var L=O.reduce(function(H,W){return H.indexOf(W.keyFormat)===-1&&H.push(W.keyFormat),H},[]);this.log("Selecting key-system from session-keys "+L.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(L)}},a.removeSession=function(o){var A=this,O=o.mediaKeysSession,L=o.licenseXhr;if(O){this.log("Remove licenses and keys and close session "+O.sessionId),O.onmessage=null,O.onkeystatuseschange=null,L&&L.readyState!==XMLHttpRequest.DONE&&L.abort(),o.mediaKeysSession=o.decryptdata=o.licenseXhr=void 0;var H=this.mediaKeySessions.indexOf(o);return H>-1&&this.mediaKeySessions.splice(H,1),O.remove().catch(function(W){A.log("Could not remove session: "+W)}).then(function(){return O.close()}).catch(function(W){A.log("Could not close session: "+W)})}},f}();p.CDMCleanupPromise=void 0;var y=function(f){N(a,f);function a(_,o){var A;return A=f.call(this,o)||this,A.data=void 0,A.data=_,_.err=_.error,A}return a}(I(Error));const T=p},"./src/controller/fps-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>R});var C=s("./src/events.ts"),g=s("./src/utils/logger.ts"),w=function(){function K(F){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=F,this.registerListeners()}var k=K.prototype;return k.setStreamController=function(B){this.streamController=B},k.registerListeners=function(){this.hls.on(C.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},k.unregisterListeners=function(){this.hls.off(C.Events.MEDIA_ATTACHING,this.onMediaAttaching)},k.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},k.onMediaAttaching=function(B,P){var M=this.hls.config;if(M.capLevelOnFPSDrop){var m=P.media instanceof self.HTMLVideoElement?P.media:null;this.media=m,m&&typeof m.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),M.fpsDroppedMonitoringPeriod)}},k.checkFPS=function(B,P,M){var m=performance.now();if(P){if(this.lastTime){var N=m-this.lastTime,I=M-this.lastDroppedFrames,h=P-this.lastDecodedFrames,E=1e3*I/N,d=this.hls;if(d.trigger(C.Events.FPS_DROP,{currentDropped:I,currentDecoded:h,totalDroppedFrames:M}),E>0&&I>d.config.fpsDroppedMonitoringThreshold*h){var c=d.currentLevel;g.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=c)&&(c=c-1,d.trigger(C.Events.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:d.currentLevel}),d.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=m,this.lastDroppedFrames=M,this.lastDecodedFrames=P}},k.checkFPSInterval=function(){var B=this.media;if(B)if(this.isVideoPlaybackQualityAvailable){var P=B.getVideoPlaybackQuality();this.checkFPS(B,P.totalVideoFrames,P.droppedVideoFrames)}else this.checkFPS(B,B.webkitDecodedFrameCount,B.webkitDroppedFrameCount)},K}();const R=w},"./src/controller/fragment-finders.ts":(x,b,s)=>{s.r(b),s.d(b,{findFragWithCC:()=>F,findFragmentByPDT:()=>w,findFragmentByPTS:()=>R,fragmentWithinToleranceTest:()=>K,pdtWithinToleranceTest:()=>k});var C=s("./src/polyfills/number.ts"),g=s("./src/utils/binary-search.ts");function w(B,P,M){if(P===null||!Array.isArray(B)||!B.length||!(0,C.isFiniteNumber)(P))return null;var m=B[0].programDateTime;if(P<(m||0))return null;var N=B[B.length-1].endProgramDateTime;if(P>=(N||0))return null;M=M||0;for(var I=0;I<B.length;++I){var h=B[I];if(k(P,M,h))return h}return null}function R(B,P,M,m){M===void 0&&(M=0),m===void 0&&(m=0);var N=null;if(B?N=P[B.sn-P[0].sn+1]||null:M===0&&P[0].start===0&&(N=P[0]),N&&K(M,m,N)===0)return N;var I=g.default.search(P,K.bind(null,M,m));return I&&(I!==B||!N)?I:N}function K(B,P,M){if(B===void 0&&(B=0),P===void 0&&(P=0),M.start<=B&&M.start+M.duration>B)return 0;var m=Math.min(P,M.duration+(M.deltaPTS?M.deltaPTS:0));return M.start+M.duration-m<=B?1:M.start-m>B&&M.start?-1:0}function k(B,P,M){var m=Math.min(P,M.duration+(M.deltaPTS?M.deltaPTS:0))*1e3,N=M.endProgramDateTime||0;return N-m>B}function F(B,P){return g.default.search(B,function(M){return M.cc<P?1:M.cc>P?-1:0})}},"./src/controller/fragment-tracker.ts":(x,b,s)=>{s.r(b),s.d(b,{FragmentState:()=>w,FragmentTracker:()=>R});var C=s("./src/events.ts"),g=s("./src/types/loader.ts"),w;(function(F){F.NOT_LOADED="NOT_LOADED",F.APPENDING="APPENDING",F.PARTIAL="PARTIAL",F.OK="OK"})(w||(w={}));var R=function(){function F(P){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=P,this._registerListeners()}var B=F.prototype;return B._registerListeners=function(){var M=this.hls;M.on(C.Events.BUFFER_APPENDED,this.onBufferAppended,this),M.on(C.Events.FRAG_BUFFERED,this.onFragBuffered,this),M.on(C.Events.FRAG_LOADED,this.onFragLoaded,this)},B._unregisterListeners=function(){var M=this.hls;M.off(C.Events.BUFFER_APPENDED,this.onBufferAppended,this),M.off(C.Events.FRAG_BUFFERED,this.onFragBuffered,this),M.off(C.Events.FRAG_LOADED,this.onFragLoaded,this)},B.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},B.getAppendedFrag=function(M,m){if(m===g.PlaylistLevelType.MAIN){var N=this.activeFragment,I=this.activeParts;if(!N)return null;if(I)for(var h=I.length;h--;){var E=I[h],d=E?E.end:N.appendedPTS;if(E.start<=M&&d!==void 0&&M<=d)return h>9&&(this.activeParts=I.slice(h-9)),E}else if(N.start<=M&&N.appendedPTS!==void 0&&M<=N.appendedPTS)return N}return this.getBufferedFrag(M,m)},B.getBufferedFrag=function(M,m){for(var N=this.fragments,I=Object.keys(N),h=I.length;h--;){var E=N[I[h]];if((E==null?void 0:E.body.type)===m&&E.buffered){var d=E.body;if(d.start<=M&&M<=d.end)return d}}return null},B.detectEvictedFragments=function(M,m,N){var I=this;this.timeRanges&&(this.timeRanges[M]=m),Object.keys(this.fragments).forEach(function(h){var E=I.fragments[h];if(E){if(!E.buffered&&!E.loaded){E.body.type===N&&I.removeFragment(E.body);return}var d=E.range[M];d&&d.time.some(function(c){var S=!I.isTimeBuffered(c.startPTS,c.endPTS,m);return S&&I.removeFragment(E.body),S})}})},B.detectPartialFragments=function(M){var m=this,N=this.timeRanges,I=M.frag,h=M.part;if(!(!N||I.sn==="initSegment")){var E=k(I),d=this.fragments[E];d&&(Object.keys(N).forEach(function(c){var S=I.elementaryStreams[c];if(S){var v=N[c],l=h!==null||S.partial===!0;d.range[c]=m.getBufferedTimes(I,h,l,v)}}),d.loaded=null,Object.keys(d.range).length?(d.buffered=!0,d.body.endList&&(this.endListFragments[d.body.type]=d)):this.removeFragment(d.body))}},B.fragBuffered=function(M){var m=k(M),N=this.fragments[m];N&&(N.loaded=null,N.buffered=!0)},B.getBufferedTimes=function(M,m,N,I){for(var h={time:[],partial:N},E=m?m.start:M.start,d=m?m.end:M.end,c=M.minEndPTS||d,S=M.maxStartPTS||E,v=0;v<I.length;v++){var l=I.start(v)-this.bufferPadding,p=I.end(v)+this.bufferPadding;if(S>=l&&c<=p){h.time.push({startPTS:Math.max(E,I.start(v)),endPTS:Math.min(d,I.end(v))});break}else if(E<p&&d>l)h.partial=!0,h.time.push({startPTS:Math.max(E,I.start(v)),endPTS:Math.min(d,I.end(v))});else if(d<=l)break}return h},B.getPartialFragment=function(M){var m=null,N,I,h,E=0,d=this.bufferPadding,c=this.fragments;return Object.keys(c).forEach(function(S){var v=c[S];v&&K(v)&&(I=v.body.start-d,h=v.body.end+d,M>=I&&M<=h&&(N=Math.min(M-I,h-M),E<=N&&(m=v.body,E=N)))}),m},B.isEndListAppended=function(M){var m=this.endListFragments[M];return m!==void 0&&(m.buffered||K(m))},B.getState=function(M){var m=k(M),N=this.fragments[m];return N?N.buffered?K(N)?w.PARTIAL:w.OK:w.APPENDING:w.NOT_LOADED},B.isTimeBuffered=function(M,m,N){for(var I,h,E=0;E<N.length;E++){if(I=N.start(E)-this.bufferPadding,h=N.end(E)+this.bufferPadding,M>=I&&m<=h)return!0;if(m<=I)return!1}return!1},B.onFragLoaded=function(M,m){var N=m.frag,I=m.part;if(!(N.sn==="initSegment"||N.bitrateTest||I)){var h=k(N);this.fragments[h]={body:N,loaded:m,buffered:!1,range:Object.create(null)}}},B.onBufferAppended=function(M,m){var N=this,I=m.frag,h=m.part,E=m.timeRanges;if(I.type===g.PlaylistLevelType.MAIN)if(this.activeFragment!==I&&(this.activeFragment=I,I.appendedPTS=void 0),h){var d=this.activeParts;d||(this.activeParts=d=[]),d.push(h)}else this.activeParts=null;this.timeRanges=E,Object.keys(E).forEach(function(c){var S=E[c];if(N.detectEvictedFragments(c,S),!h&&I.type===g.PlaylistLevelType.MAIN){var v=I.elementaryStreams[c];if(!v)return;for(var l=0;l<S.length;l++){var p=S.end(l);p<=v.endPTS&&p>v.startPTS?I.appendedPTS=Math.max(p,I.appendedPTS||0):I.appendedPTS=v.endPTS}}})},B.onFragBuffered=function(M,m){this.detectPartialFragments(m)},B.hasFragment=function(M){var m=k(M);return!!this.fragments[m]},B.removeFragmentsInRange=function(M,m,N){var I=this;Object.keys(this.fragments).forEach(function(h){var E=I.fragments[h];if(E&&E.buffered){var d=E.body;d.type===N&&d.start<m&&d.end>M&&I.removeFragment(d)}})},B.removeFragment=function(M){var m=k(M);M.stats.loaded=0,M.clearElementaryStreamInfo(),M.appendedPTS=void 0,delete this.fragments[m],M.endList&&delete this.endListFragments[M.type]},B.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},F}();function K(F){var B,P;return F.buffered&&(((B=F.range.video)===null||B===void 0?void 0:B.partial)||((P=F.range.audio)===null||P===void 0?void 0:P.partial))}function k(F){return F.type+"_"+F.level+"_"+F.urlId+"_"+F.sn}},"./src/controller/gap-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{MAX_START_GAP_JUMP:()=>k,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>F,SKIP_BUFFER_RANGE_START:()=>B,STALL_MINIMUM_DURATION_MS:()=>K,default:()=>P});var C=s("./src/utils/buffer-helper.ts"),g=s("./src/errors.ts"),w=s("./src/events.ts"),R=s("./src/utils/logger.ts"),K=250,k=2,F=.1,B=.05,P=function(){function M(N,I,h,E){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=N,this.media=I,this.fragmentTracker=h,this.hls=E}var m=M.prototype;return m.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},m.poll=function(I,h){var E=this.config,d=this.media,c=this.stalled;if(d!==null){var S=d.currentTime,v=d.seeking,l=this.seeking&&!v,p=!this.seeking&&v;if(this.seeking=v,S!==I){if(this.moved=!0,c!==null){if(this.stallReported){var y=self.performance.now()-c;R.logger.warn("playback not stuck anymore @"+S+", after "+Math.round(y)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((p||l)&&(this.stalled=null),!(d.paused&&!v||d.ended||d.playbackRate===0||!C.BufferHelper.getBuffered(d).length)){var T=C.BufferHelper.bufferInfo(d,S,0),f=T.len>0,a=T.nextStart||0;if(!(!f&&!a)){if(v){var _=T.len>k,o=!a||h&&h.start<=S||a-S>k&&!this.fragmentTracker.getPartialFragment(S);if(_||o)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var A,O=Math.max(a,T.start||0)-S,L=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,H=L==null||(A=L.details)===null||A===void 0?void 0:A.live,W=H?L.details.targetduration*2:k;if(O>0&&O<=W){this._trySkipBufferHole(null);return}}var U=self.performance.now();if(c===null){this.stalled=U;return}var G=U-c;if(!(!v&&G>=K&&(this._reportStall(T),!this.media))){var Y=C.BufferHelper.bufferInfo(d,S,E.maxBufferHole);this._tryFixBufferStall(Y,G)}}}}},m._tryFixBufferStall=function(I,h){var E=this.config,d=this.fragmentTracker,c=this.media;if(c!==null){var S=c.currentTime,v=d.getPartialFragment(S);if(v){var l=this._trySkipBufferHole(v);if(l||!this.media)return}I.len>E.maxBufferHole&&h>E.highBufferWatchdogPeriod*1e3&&(R.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},m._reportStall=function(I){var h=this.hls,E=this.media,d=this.stallReported;!d&&E&&(this.stallReported=!0,R.logger.warn("Playback stalling at @"+E.currentTime+" due to low buffer ("+JSON.stringify(I)+")"),h.trigger(w.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:I.len}))},m._trySkipBufferHole=function(I){var h=this.config,E=this.hls,d=this.media;if(d===null)return 0;for(var c=d.currentTime,S=0,v=C.BufferHelper.getBuffered(d),l=0;l<v.length;l++){var p=v.start(l);if(c+h.maxBufferHole>=S&&c<p){var y=Math.max(p+B,d.currentTime+F);return R.logger.warn("skipping hole, adjusting currentTime from "+c+" to "+y),this.moved=!0,this.stalled=null,d.currentTime=y,I&&E.trigger(w.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+c+" to "+y,frag:I}),y}S=v.end(l)}return 0},m._tryNudgeBuffer=function(){var I=this.config,h=this.hls,E=this.media,d=this.nudgeRetry;if(E!==null){var c=E.currentTime;if(this.nudgeRetry++,d<I.nudgeMaxRetry){var S=c+(d+1)*I.nudgeOffset;R.logger.warn("Nudging 'currentTime' from "+c+" to "+S),E.currentTime=S,h.trigger(w.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else R.logger.error("Playhead still not moving while enough data buffered @"+c+" after "+I.nudgeMaxRetry+" nudges"),h.trigger(w.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},M}()},"./src/controller/id3-track-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>I});var C=s("./src/polyfills/number.ts"),g=s("./src/events.ts"),w=s("./src/utils/texttrack-utils.ts"),R=s("./src/demux/id3.ts"),K=s("./src/loader/date-range.ts"),k=s("./src/types/demuxer.ts"),F=.25;function B(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var P=function(){var h=B();try{new h(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function M(h,E){return h.getTime()/1e3-E}function m(h){return Uint8Array.from(h.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var N=function(){function h(d){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=d,this._registerListeners()}var E=h.prototype;return E.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},E._registerListeners=function(){var c=this.hls;c.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),c.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.on(g.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),c.on(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),c.on(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},E._unregisterListeners=function(){var c=this.hls;c.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),c.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.off(g.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),c.off(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),c.off(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},E.onMediaAttached=function(c,S){this.media=S.media},E.onMediaDetaching=function(){this.id3Track&&((0,w.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},E.onManifestLoading=function(){this.dateRangeCuesAppended={}},E.createTrack=function(c){var S=this.getID3Track(c.textTracks);return S.mode="hidden",S},E.getID3Track=function(c){if(this.media){for(var S=0;S<c.length;S++){var v=c[S];if(v.kind==="metadata"&&v.label==="id3")return(0,w.sendAddTrackEvent)(v,this.media),v}return this.media.addTextTrack("metadata","id3")}},E.onFragParsingMetadata=function(c,S){if(this.media){var v=this.hls.config,l=v.enableEmsgMetadataCues,p=v.enableID3MetadataCues;if(!(!l&&!p)){var y=S.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var T=B(),f=0;f<y.length;f++){var a=y[f].type;if(!(a===k.MetadataSchema.emsg&&!l||!p)){var _=R.getID3Frames(y[f].data);if(_){var o=y[f].pts,A=o+y[f].duration;A>P&&(A=P);var O=A-o;O<=0&&(A=o+F);for(var L=0;L<_.length;L++){var H=_[L];if(!R.isTimeStampFrame(H)){this.updateId3CueEnds(o);var W=new T(o,A,"");W.value=H,a&&(W.type=a),this.id3Track.addCue(W)}}}}}}}},E.updateId3CueEnds=function(c){var S,v=(S=this.id3Track)===null||S===void 0?void 0:S.cues;if(v)for(var l=v.length;l--;){var p=v[l];p.startTime<c&&p.endTime===P&&(p.endTime=c)}},E.onBufferFlushing=function(c,S){var v=S.startOffset,l=S.endOffset,p=S.type,y=this.id3Track,T=this.hls;if(T){var f=T.config,a=f.enableEmsgMetadataCues,_=f.enableID3MetadataCues;if(y&&(a||_)){var o;p==="audio"?o=function(O){return O.type===k.MetadataSchema.audioId3&&_}:p==="video"?o=function(O){return O.type===k.MetadataSchema.emsg&&a}:o=function(O){return O.type===k.MetadataSchema.audioId3&&_||O.type===k.MetadataSchema.emsg&&a},(0,w.removeCuesInRange)(y,v,l,o)}}},E.onLevelUpdated=function(c,S){var v=this,l=S.details;if(!(!this.media||!l.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var p=this.dateRangeCuesAppended,y=this.id3Track,T=l.dateRanges,f=Object.keys(T);if(y)for(var a=Object.keys(p).filter(function(U){return!f.includes(U)}),_=function(G){var Y=a[G];Object.keys(p[Y].cues).forEach(function(j){y.removeCue(p[Y].cues[j])}),delete p[Y]},o=a.length;o--;)_(o);var A=l.fragments[l.fragments.length-1];if(!(f.length===0||!(0,C.isFiniteNumber)(A==null?void 0:A.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var O=A.programDateTime/1e3-A.start,L=B(),H=function(G){var Y=f[G],j=T[Y],X=p[Y],q=(X==null?void 0:X.cues)||{},J=(X==null?void 0:X.durationKnown)||!1,V=M(j.startDate,O),$=P,ee=j.endDate;if(ee)$=M(ee,O),J=!0;else if(j.endOnNext&&!J){var Z=f.reduce(function(oe,ge){var he=T[ge];return he.class===j.class&&he.id!==ge&&he.startDate>j.startDate&&oe.push(he),oe},[]).sort(function(oe,ge){return oe.startDate.getTime()-ge.startDate.getTime()})[0];Z&&($=M(Z.startDate,O),J=!0)}for(var re=Object.keys(j.attr),ae=0;ae<re.length;ae++){var le=re[ae];if(!(le===K.DateRangeAttribute.ID||le===K.DateRangeAttribute.CLASS||le===K.DateRangeAttribute.START_DATE||le===K.DateRangeAttribute.DURATION||le===K.DateRangeAttribute.END_DATE||le===K.DateRangeAttribute.END_ON_NEXT)){var ne=q[le];if(ne)J&&!X.durationKnown&&(ne.endTime=$);else{var ie=j.attr[le];ne=new L(V,$,""),(le===K.DateRangeAttribute.SCTE35_OUT||le===K.DateRangeAttribute.SCTE35_IN)&&(ie=m(ie)),ne.value={key:le,data:ie},ne.type=k.MetadataSchema.dateRange,v.id3Track.addCue(ne),q[le]=ne}}}p[Y]={cues:q,dateRange:j,durationKnown:J}},W=0;W<f.length;W++)H(W)}}},h}();const I=N},"./src/controller/latency-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>B});var C=s("./src/errors.ts"),g=s("./src/events.ts"),w=s("./src/utils/logger.ts");function R(P,M){for(var m=0;m<M.length;m++){var N=M[m];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(P,k(N.key),N)}}function K(P,M,m){return M&&R(P.prototype,M),m&&R(P,m),Object.defineProperty(P,"prototype",{writable:!1}),P}function k(P){var M=F(P,"string");return typeof M=="symbol"?M:String(M)}function F(P,M){if(typeof P!="object"||P===null)return P;var m=P[Symbol.toPrimitive];if(m!==void 0){var N=m.call(P,M||"default");if(typeof N!="object")return N;throw new TypeError("@@toPrimitive must return a primitive value.")}return(M==="string"?String:Number)(P)}var B=function(){function P(m){var N=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return N.timeupdate()},this.hls=m,this.config=m.config,this.registerListeners()}var M=P.prototype;return M.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},M.registerListeners=function(){this.hls.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(g.Events.ERROR,this.onError,this)},M.unregisterListeners=function(){this.hls.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(g.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(g.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(g.Events.ERROR,this.onError)},M.onMediaAttached=function(N,I){this.media=I.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},M.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},M.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},M.onLevelUpdated=function(N,I){var h=I.details;this.levelDetails=h,h.advanced&&this.timeupdate(),!h.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},M.onError=function(N,I){I.details===C.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,w.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},M.timeupdate=function(){var N=this.media,I=this.levelDetails;if(!(!N||!I)){this.currentTime=N.currentTime;var h=this.computeLatency();if(h!==null){this._latency=h;var E=this.config,d=E.lowLatencyMode,c=E.maxLiveSyncPlaybackRate;if(!(!d||c===1)){var S=this.targetLatency;if(S!==null){var v=h-S,l=Math.min(this.maxLatency,S+I.targetduration),p=v<l;if(I.live&&p&&v>.05&&this.forwardBufferLength>1){var y=Math.min(2,Math.max(1,c)),T=Math.round(2/(1+Math.exp(-.75*v-this.edgeStalled))*20)/20;N.playbackRate=Math.min(y,Math.max(1,T))}else N.playbackRate!==1&&N.playbackRate!==0&&(N.playbackRate=1)}}}}},M.estimateLiveEdge=function(){var N=this.levelDetails;return N===null?null:N.edge+N.age},M.computeLatency=function(){var N=this.estimateLiveEdge();return N===null?null:N-this.currentTime},K(P,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var N=this.config,I=this.levelDetails;return N.liveMaxLatencyDuration!==void 0?N.liveMaxLatencyDuration:I?N.liveMaxLatencyDurationCount*I.targetduration:0}},{key:"targetLatency",get:function(){var N=this.levelDetails;if(N===null)return null;var I=N.holdBack,h=N.partHoldBack,E=N.targetduration,d=this.config,c=d.liveSyncDuration,S=d.liveSyncDurationCount,v=d.lowLatencyMode,l=this.hls.userConfig,p=v&&h||I;(l.liveSyncDuration||l.liveSyncDurationCount||p===0)&&(p=c!==void 0?c:S*E);var y=E,T=1;return p+Math.min(this.stallCount*T,y)}},{key:"liveSyncPosition",get:function(){var N=this.estimateLiveEdge(),I=this.targetLatency,h=this.levelDetails;if(N===null||I===null||h===null)return null;var E=h.edge,d=N-I-this.edgeStalled,c=E-h.totalduration,S=E-(this.config.lowLatencyMode&&h.partTarget||h.targetduration);return Math.min(Math.max(c,d),S)}},{key:"drift",get:function(){var N=this.levelDetails;return N===null?1:N.drift}},{key:"edgeStalled",get:function(){var N=this.levelDetails;if(N===null)return 0;var I=(this.config.lowLatencyMode&&N.partTarget||N.targetduration)*3;return Math.max(N.age-I,0)}},{key:"forwardBufferLength",get:function(){var N=this.media,I=this.levelDetails;if(!N||!I)return 0;var h=N.buffered.length;return(h?N.buffered.end(h-1):I.edge)-this.currentTime}}]),P}()},"./src/controller/level-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>d});var C=s("./src/types/level.ts"),g=s("./src/events.ts"),w=s("./src/errors.ts"),R=s("./src/utils/codecs.ts"),K=s("./src/controller/level-helper.ts"),k=s("./src/controller/base-playlist-controller.ts"),F=s("./src/types/loader.ts");function B(){return B=Object.assign?Object.assign.bind():function(c){for(var S=1;S<arguments.length;S++){var v=arguments[S];for(var l in v)Object.prototype.hasOwnProperty.call(v,l)&&(c[l]=v[l])}return c},B.apply(this,arguments)}function P(c,S){for(var v=0;v<S.length;v++){var l=S[v];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(c,m(l.key),l)}}function M(c,S,v){return S&&P(c.prototype,S),v&&P(c,v),Object.defineProperty(c,"prototype",{writable:!1}),c}function m(c){var S=N(c,"string");return typeof S=="symbol"?S:String(S)}function N(c,S){if(typeof c!="object"||c===null)return c;var v=c[Symbol.toPrimitive];if(v!==void 0){var l=v.call(c,S||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(S==="string"?String:Number)(c)}function I(c,S){c.prototype=Object.create(S.prototype),c.prototype.constructor=c,h(c,S)}function h(c,S){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,p){return l.__proto__=p,l},h(c,S)}var E=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),d=function(c){I(S,c);function S(l){var p;return p=c.call(this,l,"[level-controller]")||this,p._levels=[],p._firstLevel=-1,p._startLevel=void 0,p.currentLevelIndex=-1,p.manualLevelIndex=-1,p.onParsedComplete=void 0,p._registerListeners(),p}var v=S.prototype;return v._registerListeners=function(){var p=this.hls;p.on(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),p.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),p.on(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),p.on(g.Events.FRAG_LOADED,this.onFragLoaded,this),p.on(g.Events.ERROR,this.onError,this)},v._unregisterListeners=function(){var p=this.hls;p.off(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),p.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),p.off(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),p.off(g.Events.FRAG_LOADED,this.onFragLoaded,this),p.off(g.Events.ERROR,this.onError,this)},v.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,c.prototype.destroy.call(this)},v.startLoad=function(){var p=this._levels;p.forEach(function(y){y.loadError=0}),c.prototype.startLoad.call(this)},v.onManifestLoaded=function(p,y){var T=[],f=[],a=[],_,o={},A,O=!1,L=!1,H=!1;if(y.levels.forEach(function(Y){var j=Y.attrs;O=O||!!(Y.width&&Y.height),L=L||!!Y.videoCodec,H=H||!!Y.audioCodec,E&&Y.audioCodec&&Y.audioCodec.indexOf("mp4a.40.34")!==-1&&(Y.audioCodec=void 0);var X=Y.bitrate+"-"+Y.attrs.RESOLUTION+"-"+Y.attrs.CODECS;A=o[X],A?A.url.push(Y.url):(A=new C.Level(Y),o[X]=A,T.push(A)),j&&(j.AUDIO&&(0,K.addGroupId)(A,"audio",j.AUDIO),j.SUBTITLES&&(0,K.addGroupId)(A,"text",j.SUBTITLES))}),(O||L)&&H&&(T=T.filter(function(Y){var j=Y.videoCodec,X=Y.width,q=Y.height;return!!j||!!(X&&q)})),T=T.filter(function(Y){var j=Y.audioCodec,X=Y.videoCodec;return(!j||(0,R.isCodecSupportedInMp4)(j,"audio"))&&(!X||(0,R.isCodecSupportedInMp4)(X,"video"))}),y.audioTracks&&(f=y.audioTracks.filter(function(Y){return!Y.audioCodec||(0,R.isCodecSupportedInMp4)(Y.audioCodec,"audio")}),(0,K.assignTrackIdsByGroup)(f)),y.subtitles&&(a=y.subtitles,(0,K.assignTrackIdsByGroup)(a)),T.length>0){_=T[0].bitrate,T.sort(function(Y,j){return Y.attrs["HDCP-LEVEL"]!==j.attrs["HDCP-LEVEL"]?(Y.attrs["HDCP-LEVEL"]||"")>(j.attrs["HDCP-LEVEL"]||"")?1:-1:Y.bitrate!==j.bitrate?Y.bitrate-j.bitrate:Y.attrs.SCORE!==j.attrs.SCORE?Y.attrs.decimalFloatingPoint("SCORE")-j.attrs.decimalFloatingPoint("SCORE"):O&&Y.height!==j.height?Y.height-j.height:0}),this._levels=T;for(var W=0;W<T.length;W++)if(T[W].bitrate===_){this._firstLevel=W,this.log("manifest loaded, "+T.length+" level(s) found, first bitrate: "+_);break}var U=H&&!L,G={levels:T,audioTracks:f,subtitleTracks:a,sessionData:y.sessionData,sessionKeys:y.sessionKeys,firstLevel:this._firstLevel,stats:y.stats,audio:H,video:L,altAudio:!U&&f.some(function(Y){return!!Y.url})};this.hls.trigger(g.Events.MANIFEST_PARSED,G),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(g.Events.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:y.url,reason:"no level with compatible codecs found in manifest"})},v.onError=function(p,y){var T,f;if(c.prototype.onError.call(this,p,y),!y.fatal){var a=y.context,_=this._levels[this.currentLevelIndex];if(a&&(a.type===F.PlaylistContextType.AUDIO_TRACK&&_.audioGroupIds&&a.groupId===_.audioGroupIds[_.urlId]||a.type===F.PlaylistContextType.SUBTITLE_TRACK&&_.textGroupIds&&a.groupId===_.textGroupIds[_.urlId])){this.redundantFailover(this.currentLevelIndex);return}var o=!1,A=!0,O;switch(y.details){case w.ErrorDetails.FRAG_LOAD_ERROR:case w.ErrorDetails.FRAG_LOAD_TIMEOUT:case w.ErrorDetails.KEY_LOAD_ERROR:case w.ErrorDetails.KEY_LOAD_TIMEOUT:if(y.frag){var L=y.frag.type===F.PlaylistLevelType.MAIN?y.frag.level:this.currentLevelIndex,H=this._levels[L];H?(H.fragmentError++,H.fragmentError>this.hls.config.fragLoadingMaxRetry&&(O=L)):O=L}break;case w.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var W=_.attrs["HDCP-LEVEL"];W&&(this.hls.maxHdcpLevel=C.HdcpLevels[C.HdcpLevels.indexOf(W)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'))}case w.ErrorDetails.FRAG_PARSING_ERROR:case w.ErrorDetails.KEY_SYSTEM_NO_SESSION:O=((T=y.frag)===null||T===void 0?void 0:T.type)===F.PlaylistLevelType.MAIN?y.frag.level:this.currentLevelIndex,y.levelRetry=!1;break;case w.ErrorDetails.LEVEL_LOAD_ERROR:case w.ErrorDetails.LEVEL_LOAD_TIMEOUT:a&&(a.deliveryDirectives&&(A=!1),O=a.level),o=!0;break;case w.ErrorDetails.REMUX_ALLOC_ERROR:O=(f=y.level)!=null?f:this.currentLevelIndex,o=!0;break}O!==void 0&&this.recoverLevel(y,O,o,A)}},v.recoverLevel=function(p,y,T,f){var a=p.details,_=this._levels[y];if(_.loadError++,T){var o=this.retryLoadingOrFail(p);if(o)p.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(f){var A=_.url.length;if(A>1&&_.loadError<A)p.levelRetry=!0,this.redundantFailover(y);else if(this.manualLevelIndex===-1){for(var O=-1,L=this._levels,H=L.length;H--;){var W=(H+this.currentLevelIndex)%L.length;if(W!==this.currentLevelIndex&&L[W].loadError===0){O=W;break}}O>-1&&this.currentLevelIndex!==O?(this.warn(a+": switch to "+O),p.levelRetry=!0,this.hls.nextAutoLevel=O):p.levelRetry===!1&&(p.fatal=!0)}}},v.redundantFailover=function(p){var y=this._levels[p],T=y.url.length;if(T>1){var f=(y.urlId+1)%T;this.warn("Switching to redundant URL-id "+f),this._levels.forEach(function(a){a.urlId=f}),this.level=p}},v.onFragLoaded=function(p,y){var T=y.frag;if(T!==void 0&&T.type===F.PlaylistLevelType.MAIN){var f=this._levels[T.level];f!==void 0&&(f.fragmentError=0,f.loadError=0)}},v.onLevelLoaded=function(p,y){var T,f=y.level,a=y.details,_=this._levels[f];if(!_){var o;this.warn("Invalid level index "+f),(o=y.deliveryDirectives)!==null&&o!==void 0&&o.skip&&(a.deltaUpdateFailed=!0);return}f===this.currentLevelIndex?(_.fragmentError===0&&(_.loadError=0,this.retryCount=0),this.playlistLoaded(f,y,_.details)):(T=y.deliveryDirectives)!==null&&T!==void 0&&T.skip&&(a.deltaUpdateFailed=!0)},v.onAudioTrackSwitched=function(p,y){var T=this.hls.levels[this.currentLevelIndex];if(T&&T.audioGroupIds){for(var f=-1,a=this.hls.audioTracks[y.id].groupId,_=0;_<T.audioGroupIds.length;_++)if(T.audioGroupIds[_]===a){f=_;break}f!==T.urlId&&(T.urlId=f,this.startLoad())}},v.loadPlaylist=function(p){c.prototype.loadPlaylist.call(this);var y=this.currentLevelIndex,T=this._levels[y];if(this.canLoad&&T&&T.url.length>0){var f=T.urlId,a=T.url[f];if(p)try{a=p.addDirectives(a)}catch(_){this.warn("Could not construct new URL with HLS Delivery Directives: "+_)}this.log("Attempt loading level index "+y+(p?" at sn "+p.msn+" part "+p.part:"")+" with URL-id "+f+" "+a),this.clearTimer(),this.hls.trigger(g.Events.LEVEL_LOADING,{url:a,level:y,id:f,deliveryDirectives:p||null})}},v.removeLevel=function(p,y){var T=function(_,o){return o!==y},f=this._levels.filter(function(a,_){return _!==p?!0:a.url.length>1&&y!==void 0?(a.url=a.url.filter(T),a.audioGroupIds&&(a.audioGroupIds=a.audioGroupIds.filter(T)),a.textGroupIds&&(a.textGroupIds=a.textGroupIds.filter(T)),a.urlId=0,!0):!1}).map(function(a,_){var o=a.details;return o!=null&&o.fragments&&o.fragments.forEach(function(A){A.level=_}),a});this._levels=f,this.hls.trigger(g.Events.LEVELS_UPDATED,{levels:f})},M(S,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(p){var y,T=this._levels;if(T.length!==0&&!(this.currentLevelIndex===p&&(y=T[p])!==null&&y!==void 0&&y.details)){if(p<0||p>=T.length){var f=p<0;if(this.hls.trigger(g.Events.ERROR,{type:w.ErrorTypes.OTHER_ERROR,details:w.ErrorDetails.LEVEL_SWITCH_ERROR,level:p,fatal:f,reason:"invalid level idx"}),f)return;p=Math.min(p,T.length-1)}this.clearTimer();var a=this.currentLevelIndex,_=T[a],o=T[p];this.log("switching to level "+p+" from "+a),this.currentLevelIndex=p;var A=B({},o,{level:p,maxBitrate:o.maxBitrate,uri:o.uri,urlId:o.urlId});delete A._urlId,this.hls.trigger(g.Events.LEVEL_SWITCHING,A);var O=o.details;if(!O||O.live){var L=this.switchParams(o.uri,_==null?void 0:_.details);this.loadPlaylist(L)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(p){this.manualLevelIndex=p,this._startLevel===void 0&&(this._startLevel=p),p!==-1&&(this.level=p)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(p){this._firstLevel=p}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var p=this.hls.config.startLevel;return p!==void 0?p:this._firstLevel}else return this._startLevel},set:function(p){this._startLevel=p}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(p){this.level=p,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=p)}}]),S}(k.default)},"./src/controller/level-helper.ts":(x,b,s)=>{s.r(b),s.d(b,{addGroupId:()=>K,addSliding:()=>E,adjustSliding:()=>h,assignTrackIdsByGroup:()=>k,computeReloadInterval:()=>d,getFragmentWithSN:()=>c,getPartWith:()=>S,mapFragmentIntersection:()=>I,mapPartIntersection:()=>N,mergeDetails:()=>M,updateFragPTSDTS:()=>P,updatePTS:()=>F});var C=s("./src/polyfills/number.ts"),g=s("./src/utils/logger.ts"),w=s("./src/loader/date-range.ts");function R(){return R=Object.assign?Object.assign.bind():function(v){for(var l=1;l<arguments.length;l++){var p=arguments[l];for(var y in p)Object.prototype.hasOwnProperty.call(p,y)&&(v[y]=p[y])}return v},R.apply(this,arguments)}function K(v,l,p){switch(l){case"audio":v.audioGroupIds||(v.audioGroupIds=[]),v.audioGroupIds.push(p);break;case"text":v.textGroupIds||(v.textGroupIds=[]),v.textGroupIds.push(p);break}}function k(v){var l={};v.forEach(function(p){var y=p.groupId||"";p.id=l[y]=l[y]||0,l[y]++})}function F(v,l,p){var y=v[l],T=v[p];B(y,T)}function B(v,l){var p=l.startPTS;if((0,C.isFiniteNumber)(p)){var y=0,T;l.sn>v.sn?(y=p-v.start,T=v):(y=v.start-p,T=l),T.duration!==y&&(T.duration=y)}else if(l.sn>v.sn){var f=v.cc===l.cc;f&&v.minEndPTS?l.start=v.start+(v.minEndPTS-v.start):l.start=v.start+v.duration}else l.start=Math.max(v.start-l.duration,0)}function P(v,l,p,y,T,f){var a=y-p;a<=0&&(g.logger.warn("Fragment should have a positive duration",l),y=p+l.duration,f=T+l.duration);var _=p,o=y,A=l.startPTS,O=l.endPTS;if((0,C.isFiniteNumber)(A)){var L=Math.abs(A-p);(0,C.isFiniteNumber)(l.deltaPTS)?l.deltaPTS=Math.max(L,l.deltaPTS):l.deltaPTS=L,_=Math.max(p,A),p=Math.min(p,A),T=Math.min(T,l.startDTS),o=Math.min(y,O),y=Math.max(y,O),f=Math.max(f,l.endDTS)}l.duration=y-p;var H=p-l.start;l.start=l.startPTS=p,l.maxStartPTS=_,l.startDTS=T,l.endPTS=y,l.minEndPTS=o,l.endDTS=f;var W=l.sn;if(!v||W<v.startSN||W>v.endSN)return 0;var U,G=W-v.startSN,Y=v.fragments;for(Y[G]=l,U=G;U>0;U--)B(Y[U],Y[U-1]);for(U=G;U<Y.length-1;U++)B(Y[U],Y[U+1]);return v.fragmentHint&&B(Y[Y.length-1],v.fragmentHint),v.PTSKnown=v.alignedSliding=!0,H}function M(v,l){for(var p=null,y=v.fragments,T=y.length-1;T>=0;T--){var f=y[T].initSegment;if(f){p=f;break}}v.fragmentHint&&delete v.fragmentHint.endPTS;var a=0,_;if(I(v,l,function(U,G){U.relurl&&(a=U.cc-G.cc),(0,C.isFiniteNumber)(U.startPTS)&&(0,C.isFiniteNumber)(U.endPTS)&&(G.start=G.startPTS=U.startPTS,G.startDTS=U.startDTS,G.appendedPTS=U.appendedPTS,G.maxStartPTS=U.maxStartPTS,G.endPTS=U.endPTS,G.endDTS=U.endDTS,G.minEndPTS=U.minEndPTS,G.duration=U.endPTS-U.startPTS,G.duration&&(_=G),l.PTSKnown=l.alignedSliding=!0),G.elementaryStreams=U.elementaryStreams,G.loader=U.loader,G.stats=U.stats,G.urlId=U.urlId,U.initSegment&&(G.initSegment=U.initSegment,p=U.initSegment)}),p){var o=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments;o.forEach(function(U){var G;(!U.initSegment||U.initSegment.relurl===((G=p)===null||G===void 0?void 0:G.relurl))&&(U.initSegment=p)})}if(l.skippedSegments)if(l.deltaUpdateFailed=l.fragments.some(function(U){return!U}),l.deltaUpdateFailed){g.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var A=l.skippedSegments;A--;)l.fragments.shift();l.startSN=l.fragments[0].sn,l.startCC=l.fragments[0].cc}else l.canSkipDateRanges&&(l.dateRanges=m(v.dateRanges,l.dateRanges,l.recentlyRemovedDateranges));var O=l.fragments;if(a){g.logger.warn("discontinuity sliding from playlist, take drift into account");for(var L=0;L<O.length;L++)O[L].cc+=a}l.skippedSegments&&(l.startCC=l.fragments[0].cc),N(v.partList,l.partList,function(U,G){G.elementaryStreams=U.elementaryStreams,G.stats=U.stats}),_?P(l,_,_.startPTS,_.endPTS,_.startDTS,_.endDTS):h(v,l),O.length&&(l.totalduration=l.edge-O[0].start),l.driftStartTime=v.driftStartTime,l.driftStart=v.driftStart;var H=l.advancedDateTime;if(l.advanced&&H){var W=l.edge;l.driftStart||(l.driftStartTime=H,l.driftStart=W),l.driftEndTime=H,l.driftEnd=W}else l.driftEndTime=v.driftEndTime,l.driftEnd=v.driftEnd,l.advancedDateTime=v.advancedDateTime}function m(v,l,p){var y=R({},v);return p&&p.forEach(function(T){delete y[T]}),Object.keys(l).forEach(function(T){var f=new w.DateRange(l[T].attr,y[T]);f.isValid?y[T]=f:g.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(l[T].attr)+'"')}),y}function N(v,l,p){if(v&&l)for(var y=0,T=0,f=v.length;T<=f;T++){var a=v[T],_=l[T+y];a&&_&&a.index===_.index&&a.fragment.sn===_.fragment.sn?p(a,_):y--}}function I(v,l,p){for(var y=l.skippedSegments,T=Math.max(v.startSN,l.startSN)-l.startSN,f=(v.fragmentHint?1:0)+(y?l.endSN:Math.min(v.endSN,l.endSN))-l.startSN,a=l.startSN-v.startSN,_=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments,o=v.fragmentHint?v.fragments.concat(v.fragmentHint):v.fragments,A=T;A<=f;A++){var O=o[a+A],L=_[A];y&&!L&&A<y&&(L=l.fragments[A]=O),O&&L&&p(O,L)}}function h(v,l){var p=l.startSN+l.skippedSegments-v.startSN,y=v.fragments;p<0||p>=y.length||E(l,y[p].start)}function E(v,l){if(l){for(var p=v.fragments,y=v.skippedSegments;y<p.length;y++)p[y].start+=l;v.fragmentHint&&(v.fragmentHint.start+=l)}}function d(v,l){l===void 0&&(l=1/0);var p=1e3*v.targetduration;if(v.updated){var y=v.fragments,T=4;if(y.length&&p*T>l){var f=y[y.length-1].duration*1e3;f<p&&(p=f)}}else p/=2;return Math.round(p)}function c(v,l,p){if(!v||!v.details)return null;var y=v.details,T=y.fragments[l-y.startSN];return T||(T=y.fragmentHint,T&&T.sn===l)?T:l<y.startSN&&p&&p.sn===l?p:null}function S(v,l,p){if(!v||!v.details)return null;var y=v.details.partList;if(y)for(var T=y.length;T--;){var f=y[T];if(f.index===p&&f.fragment.sn===l)return f}return null}},"./src/controller/stream-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>l});var C=s("./src/polyfills/number.ts"),g=s("./src/controller/base-stream-controller.ts"),w=s("./src/is-supported.ts"),R=s("./src/events.ts"),K=s("./src/utils/buffer-helper.ts"),k=s("./src/controller/fragment-tracker.ts"),F=s("./src/types/loader.ts"),B=s("./src/loader/fragment.ts"),P=s("./src/demux/transmuxer-interface.ts"),M=s("./src/types/transmuxer.ts"),m=s("./src/controller/gap-controller.ts"),N=s("./src/errors.ts");function I(p,y){for(var T=0;T<y.length;T++){var f=y[T];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(p,E(f.key),f)}}function h(p,y,T){return y&&I(p.prototype,y),T&&I(p,T),Object.defineProperty(p,"prototype",{writable:!1}),p}function E(p){var y=d(p,"string");return typeof y=="symbol"?y:String(y)}function d(p,y){if(typeof p!="object"||p===null)return p;var T=p[Symbol.toPrimitive];if(T!==void 0){var f=T.call(p,y||"default");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(p)}function c(p,y){p.prototype=Object.create(y.prototype),p.prototype.constructor=p,S(p,y)}function S(p,y){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,a){return f.__proto__=a,f},S(p,y)}var v=100,l=function(p){c(y,p);function y(f,a,_){var o;return o=p.call(this,f,a,_,"[stream-controller]")||this,o.audioCodecSwap=!1,o.gapController=null,o.level=-1,o._forceStartLoad=!1,o.altAudio=!1,o.audioOnly=!1,o.fragPlaying=null,o.onvplaying=null,o.onvseeked=null,o.fragLastKbps=0,o.couldBacktrack=!1,o.backtrackFragment=null,o.audioCodecSwitch=!1,o.videoBuffer=null,o._registerListeners(),o}var T=y.prototype;return T._registerListeners=function(){var a=this.hls;a.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),a.on(R.Events.ERROR,this.onError,this),a.on(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(R.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),a.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},T._unregisterListeners=function(){var a=this.hls;a.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),a.off(R.Events.ERROR,this.onError,this),a.off(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(R.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),a.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},T.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},T.startLoad=function(a){if(this.levels){var _=this.lastCurrentTime,o=this.hls;if(this.stopLoad(),this.setInterval(v),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var A=o.startLevel;A===-1&&(o.config.testBandwidth&&this.levels.length>1?(A=0,this.bitrateTest=!0):A=o.nextAutoLevel),this.level=o.nextLoadLevel=A,this.loadedmetadata=!1}_>0&&a===-1&&(this.log("Override startPosition with lastCurrentTime @"+_.toFixed(3)),a=_),this.state=g.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this._forceStartLoad=!0,this.state=g.State.STOPPED},T.stopLoad=function(){this._forceStartLoad=!1,p.prototype.stopLoad.call(this)},T.doTick=function(){switch(this.state){case g.State.IDLE:this.doTickIdle();break;case g.State.WAITING_LEVEL:{var a,_=this.levels,o=this.level,A=_==null||(a=_[o])===null||a===void 0?void 0:a.details;if(A&&(!A.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(A))break;this.state=g.State.IDLE;break}break}case g.State.FRAG_LOADING_WAITING_RETRY:{var O,L=self.performance.now(),H=this.retryDate;(!H||L>=H||(O=this.media)!==null&&O!==void 0&&O.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=g.State.IDLE)}break}this.onTickEnd()},T.onTickEnd=function(){p.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},T.doTickIdle=function(){var a=this.hls,_=this.levelLastLoaded,o=this.levels,A=this.media,O=a.config,L=a.nextLoadLevel;if(!(_===null||!A&&(this.startFragRequested||!O.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!o||!o[L])){var H=o[L],W=this.getMainFwdBufferInfo();if(W!==null){var U=this.getLevelDetails();if(U&&this._streamEnded(W,U)){var G={};this.altAudio&&(G.type="video"),this.hls.trigger(R.Events.BUFFER_EOS,G),this.state=g.State.ENDED;return}this.level=a.nextLoadLevel=L;var Y=H.details;if(!Y||this.state===g.State.WAITING_LEVEL||Y.live&&this.levelLastLoaded!==L){this.level=L,this.state=g.State.WAITING_LEVEL;return}var j=W.len,X=this.getMaxBufferLength(H.maxBitrate);if(!(j>=X)){this.backtrackFragment&&this.backtrackFragment.start>W.end&&(this.backtrackFragment=null);var q=this.backtrackFragment?this.backtrackFragment.start:W.end,J=this.getNextFragment(q,Y);if(this.couldBacktrack&&!this.fragPrevious&&J&&J.sn!=="initSegment"&&this.fragmentTracker.getState(J)!==k.FragmentState.OK){var V,$=((V=this.backtrackFragment)!=null?V:J).sn,ee=$-Y.startSN,Z=Y.fragments[ee-1];Z&&J.cc===Z.cc&&(J=Z,this.fragmentTracker.removeFragment(Z))}else this.backtrackFragment&&W.len&&(this.backtrackFragment=null);if(J&&this.fragmentTracker.getState(J)===k.FragmentState.OK&&this.nextLoadPosition>q){var re=this.audioOnly&&!this.altAudio?B.ElementaryStreamTypes.AUDIO:B.ElementaryStreamTypes.VIDEO,ae=(re===B.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;ae&&this.afterBufferFlushed(ae,re,F.PlaylistLevelType.MAIN),J=this.getNextFragment(this.nextLoadPosition,Y)}J&&(J.initSegment&&!J.initSegment.data&&!this.bitrateTest&&(J=J.initSegment),this.loadFragment(J,Y,q))}}}},T.loadFragment=function(a,_,o){var A,O=this.fragmentTracker.getState(a);this.fragCurrent=a,O===k.FragmentState.NOT_LOADED?a.sn==="initSegment"?this._loadInitSegment(a,_):this.bitrateTest?(this.log("Fragment "+a.sn+" of level "+a.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(a,_)):(this.startFragRequested=!0,p.prototype.loadFragment.call(this,a,_,o)):O===k.FragmentState.APPENDING?this.reduceMaxBufferLength(a.duration)&&this.fragmentTracker.removeFragment(a):((A=this.media)===null||A===void 0?void 0:A.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},T.getAppendedFrag=function(a){var _=this.fragmentTracker.getAppendedFrag(a,F.PlaylistLevelType.MAIN);return _&&"fragment"in _?_.fragment:_},T.getBufferedFrag=function(a){return this.fragmentTracker.getBufferedFrag(a,F.PlaylistLevelType.MAIN)},T.followingBufferedFrag=function(a){return a?this.getBufferedFrag(a.end+.5):null},T.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},T.nextLevelSwitch=function(){var a=this.levels,_=this.media;if(_!=null&&_.readyState){var o,A=this.getAppendedFrag(_.currentTime);if(A&&A.start>1&&this.flushMainBuffer(0,A.start-1),!_.paused&&a){var O=this.hls.nextLoadLevel,L=a[O],H=this.fragLastKbps;H&&this.fragCurrent?o=this.fragCurrent.duration*L.maxBitrate/(1e3*H)+1:o=0}else o=0;var W=this.getBufferedFrag(_.currentTime+o);if(W){var U=this.followingBufferedFrag(W);if(U){this.abortCurrentFrag();var G=U.maxStartPTS?U.maxStartPTS:U.start,Y=U.duration,j=Math.max(W.end,G+Math.min(Math.max(Y-this.config.maxFragLookUpTolerance,Y*.5),Y*.75));this.flushMainBuffer(j,Number.POSITIVE_INFINITY)}}}},T.abortCurrentFrag=function(){var a=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,a&&a.abortRequests(),this.state){case g.State.KEY_LOADING:case g.State.FRAG_LOADING:case g.State.FRAG_LOADING_WAITING_RETRY:case g.State.PARSING:case g.State.PARSED:this.state=g.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},T.flushMainBuffer=function(a,_){p.prototype.flushMainBuffer.call(this,a,_,this.altAudio?"video":null)},T.onMediaAttached=function(a,_){p.prototype.onMediaAttached.call(this,a,_);var o=_.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),o.addEventListener("playing",this.onvplaying),o.addEventListener("seeked",this.onvseeked),this.gapController=new m.default(this.config,o,this.fragmentTracker,this.hls)},T.onMediaDetaching=function(){var a=this.media;a&&this.onvplaying&&this.onvseeked&&(a.removeEventListener("playing",this.onvplaying),a.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),p.prototype.onMediaDetaching.call(this)},T.onMediaPlaying=function(){this.tick()},T.onMediaSeeked=function(){var a=this.media,_=a?a.currentTime:null;(0,C.isFiniteNumber)(_)&&this.log("Media seeked to "+_.toFixed(3)),this.tick()},T.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(R.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},T.onManifestParsed=function(a,_){var o=!1,A=!1,O;_.levels.forEach(function(L){O=L.audioCodec,O&&(O.indexOf("mp4a.40.2")!==-1&&(o=!0),O.indexOf("mp4a.40.5")!==-1&&(A=!0))}),this.audioCodecSwitch=o&&A&&!(0,w.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=_.levels,this.startFragRequested=!1},T.onLevelLoading=function(a,_){var o=this.levels;if(!(!o||this.state!==g.State.IDLE)){var A=o[_.level];(!A.details||A.details.live&&this.levelLastLoaded!==_.level||this.waitForCdnTuneIn(A.details))&&(this.state=g.State.WAITING_LEVEL)}},T.onLevelLoaded=function(a,_){var o,A=this.levels,O=_.level,L=_.details,H=L.totalduration;if(!A){this.warn("Levels were reset while loading level "+O);return}this.log("Level "+O+" loaded ["+L.startSN+","+L.endSN+"], cc ["+L.startCC+", "+L.endCC+"] duration:"+H);var W=this.fragCurrent;W&&(this.state===g.State.FRAG_LOADING||this.state===g.State.FRAG_LOADING_WAITING_RETRY)&&W.level!==_.level&&W.loader&&(this.state=g.State.IDLE,this.backtrackFragment=null,W.abortRequests());var U=A[O],G=0;if(L.live||(o=U.details)!==null&&o!==void 0&&o.live){if(L.fragments[0]||(L.deltaUpdateFailed=!0),L.deltaUpdateFailed)return;G=this.alignPlaylists(L,U.details)}if(U.details=L,this.levelLastLoaded=O,this.hls.trigger(R.Events.LEVEL_UPDATED,{details:L,level:O}),this.state===g.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(L))return;this.state=g.State.IDLE}this.startFragRequested?L.live&&this.synchronizeToLiveEdge(L):this.setStartPosition(L,G),this.tick()},T._handleFragmentLoadProgress=function(a){var _,o=a.frag,A=a.part,O=a.payload,L=this.levels;if(!L){this.warn("Levels were reset while fragment load was in progress. Fragment "+o.sn+" of level "+o.level+" will not be buffered");return}var H=L[o.level],W=H.details;if(!W){this.warn("Dropping fragment "+o.sn+" of level "+o.level+" after level details were reset");return}var U=H.videoCodec,G=W.PTSKnown||!W.live,Y=(_=o.initSegment)===null||_===void 0?void 0:_.data,j=this._getAudioCodec(H),X=this.transmuxer=this.transmuxer||new P.default(this.hls,F.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),q=A?A.index:-1,J=q!==-1,V=new M.ChunkMetadata(o.level,o.sn,o.stats.chunkCount,O.byteLength,q,J),$=this.initPTS[o.cc];X.push(O,Y,j,U,o,A,W.totalduration,G,V,$)},T.onAudioTrackSwitching=function(a,_){var o=this.altAudio,A=!!_.url,O=_.id;if(!A){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var L=this.fragCurrent;L&&(this.log("Switching to main audio track, cancel main fragment load"),L.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var H=this.hls;o&&H.trigger(R.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),H.trigger(R.Events.AUDIO_TRACK_SWITCHED,{id:O})}},T.onAudioTrackSwitched=function(a,_){var o=_.id,A=!!this.hls.audioTracks[o].url;if(A){var O=this.videoBuffer;O&&this.mediaBuffer!==O&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=O)}this.altAudio=A,this.tick()},T.onBufferCreated=function(a,_){var o=_.tracks,A,O,L=!1;for(var H in o){var W=o[H];if(W.id==="main"){if(O=H,A=W,H==="video"){var U=o[H];U&&(this.videoBuffer=U.buffer)}}else L=!0}L&&A?(this.log("Alternate track found, use "+O+".buffered to schedule main fragment loading"),this.mediaBuffer=A.buffer):this.mediaBuffer=this.media},T.onFragBuffered=function(a,_){var o=_.frag,A=_.part;if(!(o&&o.type!==F.PlaylistLevelType.MAIN)){if(this.fragContextChanged(o)){this.warn("Fragment "+o.sn+(A?" p: "+A.index:"")+" of level "+o.level+" finished buffering, but was aborted. state: "+this.state),this.state===g.State.PARSED&&(this.state=g.State.IDLE);return}var O=A?A.stats:o.stats;this.fragLastKbps=Math.round(8*O.total/(O.buffering.end-O.loading.first)),o.sn!=="initSegment"&&(this.fragPrevious=o),this.fragBufferedComplete(o,A)}},T.onError=function(a,_){if(_.type===N.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(F.PlaylistLevelType.MAIN,_);return}switch(_.details){case N.ErrorDetails.FRAG_LOAD_ERROR:case N.ErrorDetails.FRAG_LOAD_TIMEOUT:case N.ErrorDetails.FRAG_PARSING_ERROR:case N.ErrorDetails.KEY_LOAD_ERROR:case N.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(F.PlaylistLevelType.MAIN,_);break;case N.ErrorDetails.LEVEL_LOAD_ERROR:case N.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==g.State.ERROR&&(_.fatal?(this.warn(""+_.details),this.state=g.State.ERROR):!_.levelRetry&&this.state===g.State.WAITING_LEVEL&&(this.state=g.State.IDLE));break;case N.ErrorDetails.BUFFER_FULL_ERROR:if(_.parent==="main"&&(this.state===g.State.PARSING||this.state===g.State.PARSED)){var o=!0,A=this.getFwdBufferInfo(this.media,F.PlaylistLevelType.MAIN);A&&A.len>.5&&(o=!this.reduceMaxBufferLength(A.len)),o&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},T.checkBuffer=function(){var a=this.media,_=this.gapController;if(!(!a||!_||!a.readyState)){if(this.loadedmetadata||!K.BufferHelper.getBuffered(a).length){var o=this.state!==g.State.IDLE?this.fragCurrent:null;_.poll(this.lastCurrentTime,o)}this.lastCurrentTime=a.currentTime}},T.onFragLoadEmergencyAborted=function(){this.state=g.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},T.onBufferFlushed=function(a,_){var o=_.type;if(o!==B.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var A=(o===B.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(A,o,F.PlaylistLevelType.MAIN)}},T.onLevelsUpdated=function(a,_){this.levels=_.levels},T.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},T.seekToStartPos=function(){var a=this.media;if(a){var _=a.currentTime,o=this.startPosition;if(o>=0&&_<o){if(a.seeking){this.log("could not seek to "+o+", already seeking at "+_);return}var A=K.BufferHelper.getBuffered(a),O=A.length?A.start(0):0,L=O-o;L>0&&(L<this.config.maxBufferHole||L<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+L+" to match buffer start"),o+=L,this.startPosition=o),this.log("seek to target start position "+o+" from current time "+_),a.currentTime=o}}},T._getAudioCodec=function(a){var _=this.config.defaultAudioCodec||a.audioCodec;return this.audioCodecSwap&&_&&(this.log("Swapping audio codec"),_.indexOf("mp4a.40.5")!==-1?_="mp4a.40.2":_="mp4a.40.5"),_},T._loadBitrateTestFrag=function(a,_){var o=this;a.bitrateTest=!0,this._doFragLoad(a,_).then(function(A){var O=o.hls;if(!(!A||O.nextLoadLevel||o.fragContextChanged(a))){o.fragLoadError=0,o.state=g.State.IDLE,o.startFragRequested=!1,o.bitrateTest=!1;var L=a.stats;L.parsing.start=L.parsing.end=L.buffering.start=L.buffering.end=self.performance.now(),O.trigger(R.Events.FRAG_LOADED,A),a.bitrateTest=!1}})},T._handleTransmuxComplete=function(a){var _,o="main",A=this.hls,O=a.remuxResult,L=a.chunkMeta,H=this.getCurrentContext(L);if(!H){this.warn("The loading context changed while buffering fragment "+L.sn+" of level "+L.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(L.level);return}var W=H.frag,U=H.part,G=H.level,Y=O.video,j=O.text,X=O.id3,q=O.initSegment,J=G.details,V=this.altAudio?void 0:O.audio;if(!this.fragContextChanged(W)){if(this.state=g.State.PARSING,q){q.tracks&&(this._bufferInitSegment(G,q.tracks,W,L),A.trigger(R.Events.FRAG_PARSING_INIT_SEGMENT,{frag:W,id:o,tracks:q.tracks}));var $=q.initPTS,ee=q.timescale;(0,C.isFiniteNumber)($)&&(this.initPTS[W.cc]=$,A.trigger(R.Events.INIT_PTS_FOUND,{frag:W,id:o,initPTS:$,timescale:ee}))}if(Y&&O.independent!==!1){if(J){var Z=Y.startPTS,re=Y.endPTS,ae=Y.startDTS,le=Y.endDTS;if(U)U.elementaryStreams[Y.type]={startPTS:Z,endPTS:re,startDTS:ae,endDTS:le};else if(Y.firstKeyFrame&&Y.independent&&L.id===1&&(this.couldBacktrack=!0),Y.dropped&&Y.independent){var ne=this.getMainFwdBufferInfo(),ie=(ne?ne.end:this.getLoadPosition())+this.config.maxBufferHole,oe=Y.firstKeyFramePTS?Y.firstKeyFramePTS:Z;if(ie<oe-this.config.maxBufferHole){this.backtrack(W);return}W.setElementaryStreamInfo(Y.type,W.start,re,W.start,le,!0)}W.setElementaryStreamInfo(Y.type,Z,re,ae,le),this.backtrackFragment&&(this.backtrackFragment=W),this.bufferFragmentData(Y,W,U,L)}}else if(O.independent===!1){this.backtrack(W);return}if(V){var ge=V.startPTS,he=V.endPTS,me=V.startDTS,Ee=V.endDTS;U&&(U.elementaryStreams[B.ElementaryStreamTypes.AUDIO]={startPTS:ge,endPTS:he,startDTS:me,endDTS:Ee}),W.setElementaryStreamInfo(B.ElementaryStreamTypes.AUDIO,ge,he,me,Ee),this.bufferFragmentData(V,W,U,L)}if(J&&X!==null&&X!==void 0&&(_=X.samples)!==null&&_!==void 0&&_.length){var pe={id:o,frag:W,details:J,samples:X.samples};A.trigger(R.Events.FRAG_PARSING_METADATA,pe)}if(J&&j){var Te={id:o,frag:W,details:J,samples:j.samples};A.trigger(R.Events.FRAG_PARSING_USERDATA,Te)}}},T._bufferInitSegment=function(a,_,o,A){var O=this;if(this.state===g.State.PARSING){this.audioOnly=!!_.audio&&!_.video,this.altAudio&&!this.audioOnly&&delete _.audio;var L=_.audio,H=_.video,W=_.audiovideo;if(L){var U=a.audioCodec,G=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(U&&(U.indexOf("mp4a.40.5")!==-1?U="mp4a.40.2":U="mp4a.40.5"),L.metadata.channelCount!==1&&G.indexOf("firefox")===-1&&(U="mp4a.40.5")),G.indexOf("android")!==-1&&L.container!=="audio/mpeg"&&(U="mp4a.40.2",this.log("Android: force audio codec to "+U)),a.audioCodec&&a.audioCodec!==U&&this.log('Swapping manifest audio codec "'+a.audioCodec+'" for "'+U+'"'),L.levelCodec=U,L.id="main",this.log("Init audio buffer, container:"+L.container+", codecs[selected/level/parsed]=["+(U||"")+"/"+(a.audioCodec||"")+"/"+L.codec+"]")}H&&(H.levelCodec=a.videoCodec,H.id="main",this.log("Init video buffer, container:"+H.container+", codecs[level/parsed]=["+(a.videoCodec||"")+"/"+H.codec+"]")),W&&this.log("Init audiovideo buffer, container:"+W.container+", codecs[level/parsed]=["+(a.attrs.CODECS||"")+"/"+W.codec+"]"),this.hls.trigger(R.Events.BUFFER_CODECS,_),Object.keys(_).forEach(function(Y){var j=_[Y],X=j.initSegment;X!=null&&X.byteLength&&O.hls.trigger(R.Events.BUFFER_APPENDING,{type:Y,data:X,frag:o,part:null,chunkMeta:A,parent:o.type})}),this.tick()}},T.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,F.PlaylistLevelType.MAIN)},T.backtrack=function(a){this.couldBacktrack=!0,this.backtrackFragment=a,this.resetTransmuxer(),this.flushBufferGap(a),this.fragmentTracker.removeFragment(a),this.fragPrevious=null,this.nextLoadPosition=a.start,this.state=g.State.IDLE},T.checkFragmentChanged=function(){var a=this.media,_=null;if(a&&a.readyState>1&&a.seeking===!1){var o=a.currentTime;if(K.BufferHelper.isBuffered(a,o)?_=this.getAppendedFrag(o):K.BufferHelper.isBuffered(a,o+.1)&&(_=this.getAppendedFrag(o+.1)),_){this.backtrackFragment=null;var A=this.fragPlaying,O=_.level;(!A||_.sn!==A.sn||A.level!==O||_.urlId!==A.urlId)&&(this.fragPlaying=_,this.hls.trigger(R.Events.FRAG_CHANGED,{frag:_}),(!A||A.level!==O)&&this.hls.trigger(R.Events.LEVEL_SWITCHED,{level:O}))}}},h(y,[{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"currentFrag",get:function(){var a=this.media;return a?this.fragPlaying||this.getAppendedFrag(a.currentTime):null}},{key:"currentProgramDateTime",get:function(){var a=this.media;if(a){var _=a.currentTime,o=this.currentFrag;if(o&&(0,C.isFiniteNumber)(_)&&(0,C.isFiniteNumber)(o.programDateTime)){var A=o.programDateTime+(_-o.start)*1e3;return new Date(A)}}return null}},{key:"currentLevel",get:function(){var a=this.currentFrag;return a?a.level:-1}},{key:"nextBufferedFrag",get:function(){var a=this.currentFrag;return a?this.followingBufferedFrag(a):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),y}(g.default)},"./src/controller/subtitle-stream-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{SubtitleStreamController:()=>c});var C=s("./src/events.ts"),g=s("./src/utils/buffer-helper.ts"),w=s("./src/controller/fragment-finders.ts"),R=s("./src/utils/discontinuities.ts"),K=s("./src/controller/level-helper.ts"),k=s("./src/controller/fragment-tracker.ts"),F=s("./src/controller/base-stream-controller.ts"),B=s("./src/types/loader.ts"),P=s("./src/types/level.ts");function M(v,l){for(var p=0;p<l.length;p++){var y=l[p];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,N(y.key),y)}}function m(v,l,p){return l&&M(v.prototype,l),p&&M(v,p),Object.defineProperty(v,"prototype",{writable:!1}),v}function N(v){var l=I(v,"string");return typeof l=="symbol"?l:String(l)}function I(v,l){if(typeof v!="object"||v===null)return v;var p=v[Symbol.toPrimitive];if(p!==void 0){var y=p.call(v,l||"default");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(v)}function h(v,l){v.prototype=Object.create(l.prototype),v.prototype.constructor=v,E(v,l)}function E(v,l){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,T){return y.__proto__=T,y},E(v,l)}var d=500,c=function(v){h(l,v);function l(y,T,f){var a;return a=v.call(this,y,T,f,"[subtitle-stream-controller]")||this,a.levels=[],a.currentTrackId=-1,a.tracksBuffered=[],a.mainDetails=null,a._registerListeners(),a}var p=l.prototype;return p.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},p._registerListeners=function(){var T=this.hls;T.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),T.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),T.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),T.on(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),T.on(C.Events.ERROR,this.onError,this),T.on(C.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),T.on(C.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),T.on(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),T.on(C.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),T.on(C.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),T.on(C.Events.FRAG_BUFFERED,this.onFragBuffered,this)},p._unregisterListeners=function(){var T=this.hls;T.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),T.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),T.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),T.off(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),T.off(C.Events.ERROR,this.onError,this),T.off(C.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),T.off(C.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),T.off(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),T.off(C.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),T.off(C.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),T.off(C.Events.FRAG_BUFFERED,this.onFragBuffered,this)},p.startLoad=function(T){this.stopLoad(),this.state=F.State.IDLE,this.setInterval(d),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=T,this.tick()},p.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},p.onLevelLoaded=function(T,f){this.mainDetails=f.details},p.onSubtitleFragProcessed=function(T,f){var a=f.frag,_=f.success;if(this.fragPrevious=a,this.state=F.State.IDLE,!!_){var o=this.tracksBuffered[this.currentTrackId];if(o){for(var A,O=a.start,L=0;L<o.length;L++)if(O>=o[L].start&&O<=o[L].end){A=o[L];break}var H=a.start+a.duration;A?A.end=H:(A={start:O,end:H},o.push(A)),this.fragmentTracker.fragBuffered(a)}}},p.onBufferFlushing=function(T,f){var a=f.startOffset,_=f.endOffset;if(a===0&&_!==Number.POSITIVE_INFINITY){var o=this.currentTrackId,A=this.levels;if(!A.length||!A[o]||!A[o].details)return;var O=A[o].details,L=O.targetduration,H=_-L;if(H<=0)return;f.endOffsetSubtitles=Math.max(0,H),this.tracksBuffered.forEach(function(W){for(var U=0;U<W.length;){if(W[U].end<=H){W.shift();continue}else if(W[U].start<H)W[U].start=H;else break;U++}}),this.fragmentTracker.removeFragmentsInRange(a,H,B.PlaylistLevelType.SUBTITLE)}},p.onFragBuffered=function(T,f){if(!this.loadedmetadata&&f.frag.type===B.PlaylistLevelType.MAIN){var a;(a=this.media)!==null&&a!==void 0&&a.buffered.length&&(this.loadedmetadata=!0)}},p.onError=function(T,f){var a=f.frag;!a||a.type!==B.PlaylistLevelType.SUBTITLE||(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=F.State.IDLE)},p.onSubtitleTracksUpdated=function(T,f){var a=this,_=f.subtitleTracks;this.tracksBuffered=[],this.levels=_.map(function(o){return new P.Level(o)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(o){a.tracksBuffered[o.id]=[]}),this.mediaBuffer=null},p.onSubtitleTrackSwitch=function(T,f){if(this.currentTrackId=f.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var a=this.levels[this.currentTrackId];a!=null&&a.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,a&&this.setInterval(d)},p.onSubtitleTrackLoaded=function(T,f){var a,_=f.details,o=f.id,A=this.currentTrackId,O=this.levels;if(O.length){var L=O[A];if(!(o>=O.length||o!==A||!L)){this.mediaBuffer=this.mediaBufferTimeRanges;var H=0;if(_.live||(a=L.details)!==null&&a!==void 0&&a.live){var W=this.mainDetails;if(_.deltaUpdateFailed||!W)return;var U=W.fragments[0];L.details?(H=this.alignPlaylists(_,L.details),H===0&&U&&(H=U.start,(0,K.addSliding)(_,H))):_.hasProgramDateTime&&W.hasProgramDateTime?((0,R.alignMediaPlaylistByPDT)(_,W),H=_.fragments[0].start):U&&(H=U.start,(0,K.addSliding)(_,H))}if(L.details=_,this.levelLastLoaded=o,!this.startFragRequested&&(this.mainDetails||!_.live)&&this.setStartPosition(L.details,H),this.tick(),_.live&&!this.fragCurrent&&this.media&&this.state===F.State.IDLE){var G=(0,w.findFragmentByPTS)(null,_.fragments,this.media.currentTime,0);G||(this.warn("Subtitle playlist not aligned with playback"),L.details=void 0)}}}},p._handleFragmentLoadComplete=function(T){var f=this,a=T.frag,_=T.payload,o=a.decryptdata,A=this.hls;if(!this.fragContextChanged(a)&&_&&_.byteLength>0&&o&&o.key&&o.iv&&o.method==="AES-128"){var O=performance.now();this.decrypter.decrypt(new Uint8Array(_),o.key.buffer,o.iv.buffer).then(function(L){var H=performance.now();A.trigger(C.Events.FRAG_DECRYPTED,{frag:a,payload:L,stats:{tstart:O,tdecrypt:H}})}).catch(function(L){f.warn(L.name+": "+L.message),f.state=F.State.IDLE})}},p.doTick=function(){if(!this.media){this.state=F.State.IDLE;return}if(this.state===F.State.IDLE){var T=this.currentTrackId,f=this.levels;if(!f.length||!f[T]||!f[T].details)return;var a=f[T].details,_=a.targetduration,o=this.config,A=this.getLoadPosition(),O=g.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],A-_,o.maxBufferHole),L=O.end,H=O.len,W=this.getFwdBufferInfo(this.media,B.PlaylistLevelType.MAIN),U=this.getMaxBufferLength(W==null?void 0:W.len)+_;if(H>U)return;console.assert(a,"Subtitle track details are defined on idle subtitle stream controller tick");var G=a.fragments,Y=G.length,j=a.edge,X=null,q=this.fragPrevious;if(L<j){var J=o.maxFragLookUpTolerance;X=(0,w.findFragmentByPTS)(q,G,Math.max(G[0].start,L),J),!X&&q&&q.start<G[0].start&&(X=G[0])}else X=G[Y-1];if(!X)return;X=this.mapToInitFragWhenRequired(X),this.fragmentTracker.getState(X)===k.FragmentState.NOT_LOADED&&this.loadFragment(X,a,L)}},p.getMaxBufferLength=function(T){var f=v.prototype.getMaxBufferLength.call(this);return T?Math.max(f,T):f},p.loadFragment=function(T,f,a){this.fragCurrent=T,T.sn==="initSegment"?this._loadInitSegment(T,f):(this.startFragRequested=!0,v.prototype.loadFragment.call(this,T,f,a))},m(l,[{key:"mediaBufferTimeRanges",get:function(){return new S(this.tracksBuffered[this.currentTrackId]||[])}}]),l}(F.default),S=function(l){this.buffered=void 0;var p=function(T,f,a){if(f=f>>>0,f>a-1)throw new DOMException("Failed to execute '"+T+"' on 'TimeRanges': The index provided ("+f+") is greater than the maximum bound ("+a+")");return l[f][T]};this.buffered={get length(){return l.length},end:function(T){return p("end",T,l.length)},start:function(T){return p("start",T,l.length)}}}},"./src/controller/subtitle-track-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>I});var C=s("./src/events.ts"),g=s("./src/utils/texttrack-utils.ts"),w=s("./src/controller/base-playlist-controller.ts"),R=s("./src/types/loader.ts");function K(h,E){for(var d=0;d<E.length;d++){var c=E[d];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(h,F(c.key),c)}}function k(h,E,d){return E&&K(h.prototype,E),d&&K(h,d),Object.defineProperty(h,"prototype",{writable:!1}),h}function F(h){var E=B(h,"string");return typeof E=="symbol"?E:String(E)}function B(h,E){if(typeof h!="object"||h===null)return h;var d=h[Symbol.toPrimitive];if(d!==void 0){var c=d.call(h,E||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(E==="string"?String:Number)(h)}function P(h,E){h.prototype=Object.create(E.prototype),h.prototype.constructor=h,M(h,E)}function M(h,E){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,S){return c.__proto__=S,c},M(h,E)}var m=function(h){P(E,h);function E(c){var S;return S=h.call(this,c,"[subtitle-track-controller]")||this,S.media=null,S.tracks=[],S.groupId=null,S.tracksInGroup=[],S.trackId=-1,S.selectDefaultTrack=!0,S.queuedDefaultTrack=-1,S.trackChangeListener=function(){return S.onTextTracksChanged()},S.asyncPollTrackChange=function(){return S.pollTrackChange(0)},S.useTextTrackPolling=!1,S.subtitlePollingInterval=-1,S._subtitleDisplay=!0,S.registerListeners(),S}var d=E.prototype;return d.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,h.prototype.destroy.call(this)},d.registerListeners=function(){var S=this.hls;S.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),S.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),S.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),S.on(C.Events.LEVEL_LOADING,this.onLevelLoading,this),S.on(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),S.on(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),S.on(C.Events.ERROR,this.onError,this)},d.unregisterListeners=function(){var S=this.hls;S.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),S.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),S.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),S.off(C.Events.LEVEL_LOADING,this.onLevelLoading,this),S.off(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),S.off(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),S.off(C.Events.ERROR,this.onError,this)},d.onMediaAttached=function(S,v){this.media=v.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},d.pollTrackChange=function(S){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,S)},d.onMediaDetaching=function(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var S=N(this.media.textTracks);S.forEach(function(v){(0,g.clearCurrentCues)(v)}),this.subtitleTrack=-1,this.media=null}},d.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},d.onManifestParsed=function(S,v){this.tracks=v.subtitleTracks},d.onSubtitleTrackLoaded=function(S,v){var l=v.id,p=v.details,y=this.trackId,T=this.tracksInGroup[y];if(!T){this.warn("Invalid subtitle track id "+l);return}var f=T.details;T.details=v.details,this.log("subtitle track "+l+" loaded ["+p.startSN+"-"+p.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,v,f))},d.onLevelLoading=function(S,v){this.switchLevel(v.level)},d.onLevelSwitching=function(S,v){this.switchLevel(v.level)},d.switchLevel=function(S){var v=this.hls.levels[S];if(v!=null&&v.textGroupIds){var l=v.textGroupIds[v.urlId];if(this.groupId!==l){var p=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,y=this.tracks.filter(function(a){return!l||a.groupId===l});this.tracksInGroup=y;var T=this.findTrackId(p==null?void 0:p.name)||this.findTrackId();this.groupId=l;var f={subtitleTracks:y};this.log("Updating subtitle tracks, "+y.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(C.Events.SUBTITLE_TRACKS_UPDATED,f),T!==-1&&this.setSubtitleTrack(T,p)}}},d.findTrackId=function(S){for(var v=this.tracksInGroup,l=0;l<v.length;l++){var p=v[l];if((!this.selectDefaultTrack||p.default)&&(!S||S===p.name))return p.id}return-1},d.onError=function(S,v){h.prototype.onError.call(this,S,v),!(v.fatal||!v.context)&&v.context.type===R.PlaylistContextType.SUBTITLE_TRACK&&v.context.id===this.trackId&&v.context.groupId===this.groupId&&this.retryLoadingOrFail(v)},d.loadPlaylist=function(S){h.prototype.loadPlaylist.call(this);var v=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(v)){var l=v.id,p=v.groupId,y=v.url;if(S)try{y=S.addDirectives(y)}catch(T){this.warn("Could not construct new URL with HLS Delivery Directives: "+T)}this.log("Loading subtitle playlist for id "+l),this.hls.trigger(C.Events.SUBTITLE_TRACK_LOADING,{url:y,id:l,groupId:p,deliveryDirectives:S||null})}},d.toggleTrackModes=function(S){var v=this,l=this.media,p=this.trackId;if(l){var y=N(l.textTracks),T=y.filter(function(_){return _.groupId===v.groupId});if(S===-1)[].slice.call(y).forEach(function(_){_.mode="disabled"});else{var f=T[p];f&&(f.mode="disabled")}var a=T[S];a&&(a.mode=this.subtitleDisplay?"showing":"hidden")}},d.setSubtitleTrack=function(S,v){var l,p=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=S;return}if(this.trackId!==S&&this.toggleTrackModes(S),!(this.trackId===S&&(S===-1||(l=p[S])!==null&&l!==void 0&&l.details)||S<-1||S>=p.length)){this.clearTimer();var y=p[S];if(this.log("Switching to subtitle track "+S),this.trackId=S,y){var T=y.id,f=y.groupId,a=f===void 0?"":f,_=y.name,o=y.type,A=y.url;this.hls.trigger(C.Events.SUBTITLE_TRACK_SWITCH,{id:T,groupId:a,name:_,type:o,url:A});var O=this.switchParams(y.url,v==null?void 0:v.details);this.loadPlaylist(O)}else this.hls.trigger(C.Events.SUBTITLE_TRACK_SWITCH,{id:S})}},d.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var S=-1,v=N(this.media.textTracks),l=0;l<v.length;l++)if(v[l].mode==="hidden")S=l;else if(v[l].mode==="showing"){S=l;break}this.subtitleTrack!==S&&(this.subtitleTrack=S)}},k(E,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(S){this._subtitleDisplay=S,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(S){this.selectDefaultTrack=!1;var v=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(S,v)}}]),E}(w.default);function N(h){for(var E=[],d=0;d<h.length;d++){var c=h[d];c.kind==="subtitles"&&c.label&&E.push(h[d])}return E}const I=m},"./src/controller/timeline-controller.ts":(x,b,s)=>{s.r(b),s.d(b,{TimelineController:()=>m});var C=s("./src/polyfills/number.ts"),g=s("./src/events.ts"),w=s("./src/utils/cea-608-parser.ts"),R=s("./src/utils/output-filter.ts"),K=s("./src/utils/webvtt-parser.ts"),k=s("./src/utils/texttrack-utils.ts"),F=s("./src/utils/imsc1-ttml-parser.ts"),B=s("./src/utils/mp4-tools.ts"),P=s("./src/types/loader.ts"),M=s("./src/utils/logger.ts"),m=function(){function E(c){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=h(),this.captionsProperties=void 0,this.hls=c,this.config=c.config,this.Cues=c.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var S=new R.default(this,"textTrack1"),v=new R.default(this,"textTrack2"),l=new R.default(this,"textTrack3"),p=new R.default(this,"textTrack4");this.cea608Parser1=new w.default(1,S,v),this.cea608Parser2=new w.default(3,l,p)}c.on(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.on(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.on(g.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),c.on(g.Events.FRAG_LOADING,this.onFragLoading,this),c.on(g.Events.FRAG_LOADED,this.onFragLoaded,this),c.on(g.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),c.on(g.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),c.on(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),c.on(g.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),c.on(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var d=E.prototype;return d.destroy=function(){var S=this.hls;S.off(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),S.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),S.off(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),S.off(g.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),S.off(g.Events.FRAG_LOADING,this.onFragLoading,this),S.off(g.Events.FRAG_LOADED,this.onFragLoaded,this),S.off(g.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),S.off(g.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),S.off(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),S.off(g.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),S.off(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},d.addCues=function(S,v,l,p,y){for(var T=!1,f=y.length;f--;){var a=y[f],_=I(a[0],a[1],v,l);if(_>=0&&(a[0]=Math.min(a[0],v),a[1]=Math.max(a[1],l),T=!0,_/(l-v)>.5))return}if(T||y.push([v,l]),this.config.renderTextTracksNatively){var o=this.captionsTracks[S];this.Cues.newCue(o,v,l,p)}else{var A=this.Cues.newCue(null,v,l,p);this.hls.trigger(g.Events.CUES_PARSED,{type:"captions",cues:A,track:S})}},d.onInitPtsFound=function(S,v){var l=this,p=v.frag,y=v.id,T=v.initPTS,f=v.timescale,a=this.unparsedVttFrags;y==="main"&&(this.initPTS[p.cc]=T,this.timescale[p.cc]=f),a.length&&(this.unparsedVttFrags=[],a.forEach(function(_){l.onFragLoaded(g.Events.FRAG_LOADED,_)}))},d.getExistingTrack=function(S){var v=this.media;if(v)for(var l=0;l<v.textTracks.length;l++){var p=v.textTracks[l];if(p[S])return p}return null},d.createCaptionsTrack=function(S){this.config.renderTextTracksNatively?this.createNativeTrack(S):this.createNonNativeTrack(S)},d.createNativeTrack=function(S){if(!this.captionsTracks[S]){var v=this.captionsProperties,l=this.captionsTracks,p=this.media,y=v[S],T=y.label,f=y.languageCode,a=this.getExistingTrack(S);if(a)l[S]=a,(0,k.clearCurrentCues)(l[S]),(0,k.sendAddTrackEvent)(l[S],p);else{var _=this.createTextTrack("captions",T,f);_&&(_[S]=!0,l[S]=_)}}},d.createNonNativeTrack=function(S){if(!this.nonNativeCaptionsTracks[S]){var v=this.captionsProperties[S];if(v){var l=v.label,p={_id:S,label:l,kind:"captions",default:v.media?!!v.media.default:!1,closedCaptions:v.media};this.nonNativeCaptionsTracks[S]=p,this.hls.trigger(g.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[p]})}}},d.createTextTrack=function(S,v,l){var p=this.media;if(p)return p.addTextTrack(S,v,l)},d.onMediaAttaching=function(S,v){this.media=v.media,this._cleanTracks()},d.onMediaDetaching=function(){var S=this.captionsTracks;Object.keys(S).forEach(function(v){(0,k.clearCurrentCues)(S[v]),delete S[v]}),this.nonNativeCaptionsTracks={}},d.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=h(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},d._cleanTracks=function(){var S=this.media;if(S){var v=S.textTracks;if(v)for(var l=0;l<v.length;l++)(0,k.clearCurrentCues)(v[l])}},d.onSubtitleTracksUpdated=function(S,v){var l=this;this.textTracks=[];var p=v.subtitleTracks||[],y=p.some(function(_){return _.textCodec===F.IMSC1_CODEC});if(this.config.enableWebVTT||y&&this.config.enableIMSC1){var T=this.tracks&&p&&this.tracks.length===p.length;if(this.tracks=p||[],this.config.renderTextTracksNatively){var f=this.media?this.media.textTracks:[];this.tracks.forEach(function(_,o){var A;if(o<f.length){for(var O=null,L=0;L<f.length;L++)if(N(f[L],_)){O=f[L];break}O&&(A=O)}if(A)(0,k.clearCurrentCues)(A);else{var H=l._captionsOrSubtitlesFromCharacteristics(_);A=l.createTextTrack(H,_.name,_.lang),A&&(A.mode="disabled")}A&&(A.groupId=_.groupId,l.textTracks.push(A))})}else if(!T&&this.tracks&&this.tracks.length){var a=this.tracks.map(function(_){return{label:_.name,kind:_.type.toLowerCase(),default:_.default,subtitleTrack:_}});this.hls.trigger(g.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}},d._captionsOrSubtitlesFromCharacteristics=function(S){var v;if((v=S.attrs)!==null&&v!==void 0&&v.CHARACTERISTICS){var l=/transcribes-spoken-dialog/gi.test(S.attrs.CHARACTERISTICS),p=/describes-music-and-sound/gi.test(S.attrs.CHARACTERISTICS);if(l&&p)return"captions"}return"subtitles"},d.onManifestLoaded=function(S,v){var l=this;this.config.enableCEA708Captions&&v.captions&&v.captions.forEach(function(p){var y=/(?:CC|SERVICE)([1-4])/.exec(p.instreamId);if(y){var T="textTrack"+y[1],f=l.captionsProperties[T];f&&(f.label=p.name,p.lang&&(f.languageCode=p.lang),f.media=p)}})},d.closedCaptionsForLevel=function(S){var v=this.hls.levels[S.level];return v==null?void 0:v.attrs["CLOSED-CAPTIONS"]},d.onFragLoading=function(S,v){var l=this.cea608Parser1,p=this.cea608Parser2,y=this.lastSn,T=this.lastPartIndex;if(!(!this.enabled||!(l&&p))&&v.frag.type===P.PlaylistLevelType.MAIN){var f,a,_=v.frag.sn,o=(f=v==null||(a=v.part)===null||a===void 0?void 0:a.index)!=null?f:-1;_===y+1||_===y&&o===T+1||(l.reset(),p.reset()),this.lastSn=_,this.lastPartIndex=o}},d.onFragLoaded=function(S,v){var l=v.frag,p=v.payload,y=this.initPTS,T=this.unparsedVttFrags;if(l.type===P.PlaylistLevelType.SUBTITLE)if(p.byteLength){if(!(0,C.isFiniteNumber)(y[l.cc])){T.push(v),y.length&&this.hls.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:new Error("Missing initial subtitle PTS")});return}var f=l.decryptdata,a="stats"in v;if(f==null||!f.encrypted||a){var _=this.tracks[l.level],o=this.vttCCs;o[l.cc]||(o[l.cc]={start:l.start,prevCC:this.prevCC,new:!0},this.prevCC=l.cc),_&&_.textCodec===F.IMSC1_CODEC?this._parseIMSC1(l,p):this._parseVTTs(l,p,o)}}else this.hls.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:new Error("Empty subtitle payload")})},d._parseIMSC1=function(S,v){var l=this,p=this.hls;(0,F.parseIMSC1)(v,this.initPTS[S.cc],this.timescale[S.cc],function(y){l._appendCues(y,S.level),p.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:S})},function(y){M.logger.log("Failed to parse IMSC1: "+y),p.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:S,error:y})})},d._parseVTTs=function(S,v,l){var p,y=this,T=this.hls,f=(p=S.initSegment)!==null&&p!==void 0&&p.data?(0,B.appendUint8Array)(S.initSegment.data,new Uint8Array(v)):v;(0,K.parseWebVTT)(f,this.initPTS[S.cc],this.timescale[S.cc],l,S.cc,S.start,function(a){y._appendCues(a,S.level),T.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:S})},function(a){y._fallbackToIMSC1(S,v),M.logger.log("Failed to parse VTT cue: "+a),T.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:S,error:a})})},d._fallbackToIMSC1=function(S,v){var l=this,p=this.tracks[S.level];p.textCodec||(0,F.parseIMSC1)(v,this.initPTS[S.cc],this.timescale[S.cc],function(){p.textCodec=F.IMSC1_CODEC,l._parseIMSC1(S,v)},function(){p.textCodec="wvtt"})},d._appendCues=function(S,v){var l=this.hls;if(this.config.renderTextTracksNatively){var p=this.textTracks[v];if(!p||p.mode==="disabled")return;S.forEach(function(f){return(0,k.addCueToTrack)(p,f)})}else{var y=this.tracks[v];if(!y)return;var T=y.default?"default":"subtitles"+v;l.trigger(g.Events.CUES_PARSED,{type:"subtitles",cues:S,track:T})}},d.onFragDecrypted=function(S,v){var l=v.frag;if(l.type===P.PlaylistLevelType.SUBTITLE){if(!(0,C.isFiniteNumber)(this.initPTS[l.cc])){this.unparsedVttFrags.push(v);return}this.onFragLoaded(g.Events.FRAG_LOADED,v)}},d.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},d.onFragParsingUserdata=function(S,v){var l=this.cea608Parser1,p=this.cea608Parser2;if(!(!this.enabled||!(l&&p))){var y=v.frag,T=v.samples;if(!(y.type===P.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(y)==="NONE"))for(var f=0;f<T.length;f++){var a=T[f].bytes;if(a){var _=this.extractCea608Data(a);l.addData(T[f].pts,_[0]),p.addData(T[f].pts,_[1])}}}},d.onBufferFlushing=function(S,v){var l=v.startOffset,p=v.endOffset,y=v.endOffsetSubtitles,T=v.type,f=this.media;if(!(!f||f.currentTime<p)){if(!T||T==="video"){var a=this.captionsTracks;Object.keys(a).forEach(function(o){return(0,k.removeCuesInRange)(a[o],l,p)})}if(this.config.renderTextTracksNatively&&l===0&&y!==void 0){var _=this.textTracks;Object.keys(_).forEach(function(o){return(0,k.removeCuesInRange)(_[o],l,y)})}}},d.extractCea608Data=function(S){for(var v=[[],[]],l=S[0]&31,p=2,y=0;y<l;y++){var T=S[p++],f=127&S[p++],a=127&S[p++];if(!(f===0&&a===0)){var _=(4&T)!==0;if(_){var o=3&T;(o===0||o===1)&&(v[o].push(f),v[o].push(a))}}}return v},E}();function N(E,d){return E&&E.label===d.name&&!(E.textTrack1||E.textTrack2)}function I(E,d,c,S){return Math.min(d,S)-Math.max(E,c)}function h(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>C});var C=function(){function g(R,K){this.subtle=void 0,this.aesIV=void 0,this.subtle=R,this.aesIV=K}var w=g.prototype;return w.decrypt=function(K,k){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},k,K)},g}()},"./src/crypt/aes-decryptor.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>w,removePadding:()=>g});var C=s("./src/utils/typed-array.ts");function g(R){var K=R.byteLength,k=K&&new DataView(R.buffer).getUint8(K-1);return k?(0,C.sliceUint8)(R,0,K-k):R}var w=function(){function R(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var K=R.prototype;return K.uint8ArrayToUint32Array_=function(F){for(var B=new DataView(F),P=new Uint32Array(4),M=0;M<4;M++)P[M]=B.getUint32(M*4);return P},K.initTable=function(){var F=this.sBox,B=this.invSBox,P=this.subMix,M=P[0],m=P[1],N=P[2],I=P[3],h=this.invSubMix,E=h[0],d=h[1],c=h[2],S=h[3],v=new Uint32Array(256),l=0,p=0,y=0;for(y=0;y<256;y++)y<128?v[y]=y<<1:v[y]=y<<1^283;for(y=0;y<256;y++){var T=p^p<<1^p<<2^p<<3^p<<4;T=T>>>8^T&255^99,F[l]=T,B[T]=l;var f=v[l],a=v[f],_=v[a],o=v[T]*257^T*16843008;M[l]=o<<24|o>>>8,m[l]=o<<16|o>>>16,N[l]=o<<8|o>>>24,I[l]=o,o=_*16843009^a*65537^f*257^l*16843008,E[T]=o<<24|o>>>8,d[T]=o<<16|o>>>16,c[T]=o<<8|o>>>24,S[T]=o,l?(l=f^v[v[v[_^f]]],p^=v[v[p]]):l=p=1}},K.expandKey=function(F){for(var B=this.uint8ArrayToUint32Array_(F),P=!0,M=0;M<B.length&&P;)P=B[M]===this.key[M],M++;if(!P){this.key=B;var m=this.keySize=B.length;if(m!==4&&m!==6&&m!==8)throw new Error("Invalid aes key size="+m);var N=this.ksRows=(m+6+1)*4,I,h,E=this.keySchedule=new Uint32Array(N),d=this.invKeySchedule=new Uint32Array(N),c=this.sBox,S=this.rcon,v=this.invSubMix,l=v[0],p=v[1],y=v[2],T=v[3],f,a;for(I=0;I<N;I++){if(I<m){f=E[I]=B[I];continue}a=f,I%m===0?(a=a<<8|a>>>24,a=c[a>>>24]<<24|c[a>>>16&255]<<16|c[a>>>8&255]<<8|c[a&255],a^=S[I/m|0]<<24):m>6&&I%m===4&&(a=c[a>>>24]<<24|c[a>>>16&255]<<16|c[a>>>8&255]<<8|c[a&255]),E[I]=f=(E[I-m]^a)>>>0}for(h=0;h<N;h++)I=N-h,h&3?a=E[I]:a=E[I-4],h<4||I<=4?d[h]=a:d[h]=l[c[a>>>24]]^p[c[a>>>16&255]]^y[c[a>>>8&255]]^T[c[a&255]],d[h]=d[h]>>>0}},K.networkToHostOrderSwap=function(F){return F<<24|(F&65280)<<8|(F&16711680)>>8|F>>>24},K.decrypt=function(F,B,P){for(var M=this.keySize+6,m=this.invKeySchedule,N=this.invSBox,I=this.invSubMix,h=I[0],E=I[1],d=I[2],c=I[3],S=this.uint8ArrayToUint32Array_(P),v=S[0],l=S[1],p=S[2],y=S[3],T=new Int32Array(F),f=new Int32Array(T.length),a,_,o,A,O,L,H,W,U,G,Y,j,X,q,J=this.networkToHostOrderSwap;B<T.length;){for(U=J(T[B]),G=J(T[B+1]),Y=J(T[B+2]),j=J(T[B+3]),O=U^m[0],L=j^m[1],H=Y^m[2],W=G^m[3],X=4,q=1;q<M;q++)a=h[O>>>24]^E[L>>16&255]^d[H>>8&255]^c[W&255]^m[X],_=h[L>>>24]^E[H>>16&255]^d[W>>8&255]^c[O&255]^m[X+1],o=h[H>>>24]^E[W>>16&255]^d[O>>8&255]^c[L&255]^m[X+2],A=h[W>>>24]^E[O>>16&255]^d[L>>8&255]^c[H&255]^m[X+3],O=a,L=_,H=o,W=A,X=X+4;a=N[O>>>24]<<24^N[L>>16&255]<<16^N[H>>8&255]<<8^N[W&255]^m[X],_=N[L>>>24]<<24^N[H>>16&255]<<16^N[W>>8&255]<<8^N[O&255]^m[X+1],o=N[H>>>24]<<24^N[W>>16&255]<<16^N[O>>8&255]<<8^N[L&255]^m[X+2],A=N[W>>>24]<<24^N[O>>16&255]<<16^N[L>>8&255]<<8^N[H&255]^m[X+3],f[B]=J(a^v),f[B+1]=J(A^l),f[B+2]=J(o^p),f[B+3]=J(_^y),v=U,l=G,p=Y,y=j,B=B+4}return f.buffer},R}()},"./src/crypt/decrypter.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>B});var C=s("./src/crypt/aes-crypto.ts"),g=s("./src/crypt/fast-aes-key.ts"),w=s("./src/crypt/aes-decryptor.ts"),R=s("./src/utils/logger.ts"),K=s("./src/utils/mp4-tools.ts"),k=s("./src/utils/typed-array.ts"),F=16,B=function(){function P(m,N){var I=N===void 0?{}:N,h=I.removePKCS7Padding,E=h===void 0?!0:h;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=m.enableSoftwareAES,this.removePKCS7Padding=E,E)try{var d=self.crypto;d&&(this.subtle=d.subtle||d.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}var M=P.prototype;return M.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},M.isSync=function(){return this.useSoftware},M.flush=function(){var N=this.currentResult,I=this.remainderData;if(!N||I)return R.logger.error("[softwareDecrypt] "+(I?"overflow bytes: "+I.byteLength:"no result")),this.reset(),null;var h=new Uint8Array(N);return this.reset(),this.removePKCS7Padding?(0,w.removePadding)(h):h},M.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},M.decrypt=function(N,I,h){var E=this;return this.useSoftware?new Promise(function(d,c){E.softwareDecrypt(new Uint8Array(N),I,h);var S=E.flush();S?d(S.buffer):c(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(N),I,h)},M.softwareDecrypt=function(N,I,h){var E=this.currentIV,d=this.currentResult,c=this.remainderData;this.logOnce("JS AES decrypt"),c&&(N=(0,K.appendUint8Array)(c,N),this.remainderData=null);var S=this.getValidChunk(N);if(!S.length)return null;E&&(h=E);var v=this.softwareDecrypter;v||(v=this.softwareDecrypter=new w.default),v.expandKey(I);var l=d;return this.currentResult=v.decrypt(S.buffer,0,h),this.currentIV=(0,k.sliceUint8)(S,-16).buffer,l||null},M.webCryptoDecrypt=function(N,I,h){var E=this,d=this.subtle;return(this.key!==I||!this.fastAesKey)&&(this.key=I,this.fastAesKey=new g.default(d,I)),this.fastAesKey.expandKey().then(function(c){if(!d)return Promise.reject(new Error("web crypto not initialized"));E.logOnce("WebCrypto AES decrypt");var S=new C.default(d,new Uint8Array(h));return S.decrypt(N.buffer,c)}).catch(function(c){return R.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+c.name+": "+c.message),E.onWebCryptoError(N,I,h)})},M.onWebCryptoError=function(N,I,h){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(N,I,h);var E=this.flush();if(E)return E.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},M.getValidChunk=function(N){var I=N,h=N.length-N.length%F;return h!==N.length&&(I=(0,k.sliceUint8)(N,0,h),this.remainderData=(0,k.sliceUint8)(N,h)),I},M.logOnce=function(N){this.logEnabled&&(R.logger.log("[decrypter]: "+N),this.logEnabled=!1)},P}()},"./src/crypt/fast-aes-key.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>C});var C=function(){function g(R,K){this.subtle=void 0,this.key=void 0,this.subtle=R,this.key=K}var w=g.prototype;return w.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},g}()},"./src/demux/aacdemuxer.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>B});var C=s("./src/demux/base-audio-demuxer.ts"),g=s("./src/demux/adts.ts"),w=s("./src/utils/logger.ts"),R=s("./src/demux/id3.ts");function K(P,M){P.prototype=Object.create(M.prototype),P.prototype.constructor=P,k(P,M)}function k(P,M){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(N,I){return N.__proto__=I,N},k(P,M)}var F=function(P){K(M,P);function M(N,I){var h;return h=P.call(this)||this,h.observer=void 0,h.config=void 0,h.observer=N,h.config=I,h}var m=M.prototype;return m.resetInitSegment=function(I,h,E,d){P.prototype.resetInitSegment.call(this,I,h,E,d),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:h,duration:d,inputTimeScale:9e4,dropped:0}},M.probe=function(I){if(!I)return!1;for(var h=R.getID3Data(I,0)||[],E=h.length,d=I.length;E<d;E++)if(g.probe(I,E))return w.logger.log("ADTS sync word found !"),!0;return!1},m.canParse=function(I,h){return g.canParse(I,h)},m.appendFrame=function(I,h,E){g.initTrackConfig(I,this.observer,h,E,I.manifestCodec);var d=g.appendFrame(I,h,E,this.basePTS,this.frameIndex);if(d&&d.missing===0)return d},M}(C.default);const B=F},"./src/demux/adts.ts":(x,b,s)=>{s.r(b),s.d(b,{appendFrame:()=>E,canGetFrameLength:()=>B,canParse:()=>M,getAudioConfig:()=>R,getFrameDuration:()=>I,getFullFrameLength:()=>F,getHeaderLength:()=>k,initTrackConfig:()=>N,isHeader:()=>P,isHeaderPattern:()=>K,parseFrameHeader:()=>h,probe:()=>m});var C=s("./src/utils/logger.ts"),g=s("./src/errors.ts"),w=s("./src/events.ts");function R(d,c,S,v){var l,p,y,T,f=navigator.userAgent.toLowerCase(),a=v,_=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];l=((c[S+2]&192)>>>6)+1;var o=(c[S+2]&60)>>>2;if(o>_.length-1){d.trigger(w.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o});return}return y=(c[S+2]&1)<<2,y|=(c[S+3]&192)>>>6,C.logger.log("manifest codec:"+v+", ADTS type:"+l+", samplingIndex:"+o),/firefox/i.test(f)?o>=6?(l=5,T=new Array(4),p=o-3):(l=2,T=new Array(2),p=o):f.indexOf("android")!==-1?(l=2,T=new Array(2),p=o):(l=5,T=new Array(4),v&&(v.indexOf("mp4a.40.29")!==-1||v.indexOf("mp4a.40.5")!==-1)||!v&&o>=6?p=o-3:((v&&v.indexOf("mp4a.40.2")!==-1&&(o>=6&&y===1||/vivaldi/i.test(f))||!v&&y===1)&&(l=2,T=new Array(2)),p=o)),T[0]=l<<3,T[0]|=(o&14)>>1,T[1]|=(o&1)<<7,T[1]|=y<<3,l===5&&(T[1]|=(p&14)>>1,T[2]=(p&1)<<7,T[2]|=8,T[3]=0),{config:T,samplerate:_[o],channelCount:y,codec:"mp4a.40."+l,manifestCodec:a}}function K(d,c){return d[c]===255&&(d[c+1]&246)===240}function k(d,c){return d[c+1]&1?7:9}function F(d,c){return(d[c+3]&3)<<11|d[c+4]<<3|(d[c+5]&224)>>>5}function B(d,c){return c+5<d.length}function P(d,c){return c+1<d.length&&K(d,c)}function M(d,c){return B(d,c)&&K(d,c)&&F(d,c)<=d.length-c}function m(d,c){if(P(d,c)){var S=k(d,c);if(c+S>=d.length)return!1;var v=F(d,c);if(v<=S)return!1;var l=c+v;return l===d.length||P(d,l)}return!1}function N(d,c,S,v,l){if(!d.samplerate){var p=R(c,S,v,l);if(!p)return;d.config=p.config,d.samplerate=p.samplerate,d.channelCount=p.channelCount,d.codec=p.codec,d.manifestCodec=p.manifestCodec,C.logger.log("parsed codec:"+d.codec+", rate:"+p.samplerate+", channels:"+p.channelCount)}}function I(d){return 9216e4/d}function h(d,c){var S=k(d,c);if(c+S<=d.length){var v=F(d,c)-S;if(v>0)return{headerLength:S,frameLength:v}}}function E(d,c,S,v,l){var p=I(d.samplerate),y=v+l*p,T=h(c,S),f;if(T){var a=T.frameLength,_=T.headerLength,o=_+a,A=Math.max(0,S+o-c.length);A?(f=new Uint8Array(o-_),f.set(c.subarray(S+_,c.length),0)):f=c.subarray(S+_,S+o);var O={unit:f,pts:y};return A||d.samples.push(O),{sample:O,length:o,missing:A}}var L=c.length-S;f=new Uint8Array(L),f.set(c.subarray(S,c.length),0);var H={unit:f,pts:y};return{sample:H,length:L,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>P,initPTSFn:()=>B});var C=s("./src/polyfills/number.ts"),g=s("./src/demux/id3.ts"),w=s("./src/types/demuxer.ts"),R=s("./src/demux/dummy-demuxed-track.ts"),K=s("./src/utils/mp4-tools.ts"),k=s("./src/utils/typed-array.ts"),F=function(){function M(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var m=M.prototype;return m.resetInitSegment=function(I,h,E,d){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},m.resetTimeStamp=function(I){this.initPTS=I,this.resetContiguity()},m.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},m.canParse=function(I,h){return!1},m.appendFrame=function(I,h,E){},m.demux=function(I,h){this.cachedData&&(I=(0,K.appendUint8Array)(this.cachedData,I),this.cachedData=null);var E=g.getID3Data(I,0),d=E?E.length:0,c,S=this._audioTrack,v=this._id3Track,l=E?g.getTimeStamp(E):void 0,p=I.length;for((this.basePTS===null||this.frameIndex===0&&(0,C.isFiniteNumber)(l))&&(this.basePTS=B(l,h,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),E&&E.length>0&&v.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:E,type:w.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});d<p;){if(this.canParse(I,d)){var y=this.appendFrame(S,I,d);y?(this.frameIndex++,this.lastPTS=y.sample.pts,d+=y.length,c=d):d=p}else g.canParse(I,d)?(E=g.getID3Data(I,d),v.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:E,type:w.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),d+=E.length,c=d):d++;if(d===p&&c!==p){var T=(0,k.sliceUint8)(I,c);this.cachedData?this.cachedData=(0,K.appendUint8Array)(this.cachedData,T):this.cachedData=T}}return{audioTrack:S,videoTrack:(0,R.dummyTrack)(),id3Track:v,textTrack:(0,R.dummyTrack)()}},m.demuxSampleAes=function(I,h,E){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},m.flush=function(I){var h=this.cachedData;return h&&(this.cachedData=null,this.demux(h,0)),{audioTrack:this._audioTrack,videoTrack:(0,R.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,R.dummyTrack)()}},m.destroy=function(){},M}(),B=function(m,N,I){return(0,C.isFiniteNumber)(m)?m*90:N*9e4+(I||0)};const P=F},"./src/demux/chunk-cache.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>C});var C=function(){function w(){this.chunks=[],this.dataLength=0}var R=w.prototype;return R.push=function(k){this.chunks.push(k),this.dataLength+=k.length},R.flush=function(){var k=this.chunks,F=this.dataLength,B;if(k.length)k.length===1?B=k[0]:B=g(k,F);else return new Uint8Array(0);return this.reset(),B},R.reset=function(){this.chunks.length=0,this.dataLength=0},w}();function g(w,R){for(var K=new Uint8Array(R),k=0,F=0;F<w.length;F++){var B=w[F];K.set(B,k),k+=B.length}return K}},"./src/demux/dummy-demuxed-track.ts":(x,b,s)=>{s.r(b),s.d(b,{dummyTrack:()=>C});function C(g,w){return g===void 0&&(g=""),w===void 0&&(w=9e4),{type:g,id:-1,pid:-1,inputTimeScale:w,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>w});var C=s("./src/utils/logger.ts"),g=function(){function R(k){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=k,this.bytesAvailable=k.byteLength,this.word=0,this.bitsAvailable=0}var K=R.prototype;return K.loadWord=function(){var F=this.data,B=this.bytesAvailable,P=F.byteLength-B,M=new Uint8Array(4),m=Math.min(4,B);if(m===0)throw new Error("no bytes available");M.set(F.subarray(P,P+m)),this.word=new DataView(M.buffer).getUint32(0),this.bitsAvailable=m*8,this.bytesAvailable-=m},K.skipBits=function(F){var B;F=Math.min(F,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>F?(this.word<<=F,this.bitsAvailable-=F):(F-=this.bitsAvailable,B=F>>3,F-=B<<3,this.bytesAvailable-=B,this.loadWord(),this.word<<=F,this.bitsAvailable-=F)},K.readBits=function(F){var B=Math.min(this.bitsAvailable,F),P=this.word>>>32-B;if(F>32&&C.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=B,this.bitsAvailable>0)this.word<<=B;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return B=F-B,B>0&&this.bitsAvailable?P<<B|this.readBits(B):P},K.skipLZ=function(){var F;for(F=0;F<this.bitsAvailable;++F)if(this.word&2147483648>>>F)return this.word<<=F,this.bitsAvailable-=F,F;return this.loadWord(),F+this.skipLZ()},K.skipUEG=function(){this.skipBits(1+this.skipLZ())},K.skipEG=function(){this.skipBits(1+this.skipLZ())},K.readUEG=function(){var F=this.skipLZ();return this.readBits(F+1)-1},K.readEG=function(){var F=this.readUEG();return 1&F?1+F>>>1:-1*(F>>>1)},K.readBoolean=function(){return this.readBits(1)===1},K.readUByte=function(){return this.readBits(8)},K.readUShort=function(){return this.readBits(16)},K.readUInt=function(){return this.readBits(32)},K.skipScalingList=function(F){for(var B=8,P=8,M,m=0;m<F;m++)P!==0&&(M=this.readEG(),P=(B+M+256)%256),B=P===0?B:P},K.readSPS=function(){var F=0,B=0,P=0,M=0,m,N,I,h=this.readUByte.bind(this),E=this.readBits.bind(this),d=this.readUEG.bind(this),c=this.readBoolean.bind(this),S=this.skipBits.bind(this),v=this.skipEG.bind(this),l=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);h();var y=h();if(E(5),S(3),h(),l(),y===100||y===110||y===122||y===244||y===44||y===83||y===86||y===118||y===128){var T=d();if(T===3&&S(1),l(),l(),S(1),c())for(N=T!==3?8:12,I=0;I<N;I++)c()&&(I<6?p(16):p(64))}l();var f=d();if(f===0)d();else if(f===1)for(S(1),v(),v(),m=d(),I=0;I<m;I++)v();l(),S(1);var a=d(),_=d(),o=E(1);o===0&&S(1),S(1),c()&&(F=d(),B=d(),P=d(),M=d());var A=[1,1];if(c()&&c()){var O=h();switch(O){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[h()<<8|h(),h()<<8|h()];break}}}return{width:Math.ceil((a+1)*16-F*2-B*2),height:(2-o)*(_+1)*16-(o?2:4)*(P+M),pixelRatio:A}},K.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},R}();const w=g},"./src/demux/id3.ts":(x,b,s)=>{s.r(b),s.d(b,{canParse:()=>K,decodeFrame:()=>M,getID3Data:()=>w,getID3Frames:()=>P,getTimeStamp:()=>k,isFooter:()=>g,isHeader:()=>C,isTimeStampFrame:()=>F,testables:()=>d,utf8ArrayToStr:()=>E});var C=function(l,p){return p+10<=l.length&&l[p]===73&&l[p+1]===68&&l[p+2]===51&&l[p+3]<255&&l[p+4]<255&&l[p+6]<128&&l[p+7]<128&&l[p+8]<128&&l[p+9]<128},g=function(l,p){return p+10<=l.length&&l[p]===51&&l[p+1]===68&&l[p+2]===73&&l[p+3]<255&&l[p+4]<255&&l[p+6]<128&&l[p+7]<128&&l[p+8]<128&&l[p+9]<128},w=function(l,p){for(var y=p,T=0;C(l,p);){T+=10;var f=R(l,p+6);T+=f,g(l,p+10)&&(T+=10),p+=T}if(T>0)return l.subarray(y,y+T)},R=function(l,p){var y=0;return y=(l[p]&127)<<21,y|=(l[p+1]&127)<<14,y|=(l[p+2]&127)<<7,y|=l[p+3]&127,y},K=function(l,p){return C(l,p)&&R(l,p+6)+10<=l.length-p},k=function(l){for(var p=P(l),y=0;y<p.length;y++){var T=p[y];if(F(T))return h(T)}},F=function(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"},B=function(l){var p=String.fromCharCode(l[0],l[1],l[2],l[3]),y=R(l,4),T=10;return{type:p,size:y,data:l.subarray(T,T+y)}},P=function(l){for(var p=0,y=[];C(l,p);){var T=R(l,p+6);p+=10;for(var f=p+T;p+8<f;){var a=B(l.subarray(p)),_=M(a);_&&y.push(_),p+=a.size+10}g(l,p)&&(p+=10)}return y},M=function(l){return l.type==="PRIV"?m(l):l.type[0]==="W"?I(l):N(l)},m=function(l){if(!(l.size<2)){var p=E(l.data,!0),y=new Uint8Array(l.data.subarray(p.length+1));return{key:l.type,info:p,data:y.buffer}}},N=function(l){if(!(l.size<2)){if(l.type==="TXXX"){var p=1,y=E(l.data.subarray(p),!0);p+=y.length+1;var T=E(l.data.subarray(p));return{key:l.type,info:y,data:T}}var f=E(l.data.subarray(1));return{key:l.type,data:f}}},I=function(l){if(l.type==="WXXX"){if(l.size<2)return;var p=1,y=E(l.data.subarray(p),!0);p+=y.length+1;var T=E(l.data.subarray(p));return{key:l.type,info:y,data:T}}var f=E(l.data);return{key:l.type,data:f}},h=function(l){if(l.data.byteLength===8){var p=new Uint8Array(l.data),y=p[3]&1,T=(p[4]<<23)+(p[5]<<15)+(p[6]<<7)+p[7];return T/=45,y&&(T+=4772185884e-2),Math.round(T)}},E=function(l,p){p===void 0&&(p=!1);var y=S();if(y){var T=y.decode(l);if(p){var f=T.indexOf("\0");return f!==-1?T.substring(0,f):T}return T.replace(/\0/g,"")}for(var a=l.length,_,o,A,O="",L=0;L<a;){if(_=l[L++],_===0&&p)return O;if(_===0||_===3)continue;switch(_>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:O+=String.fromCharCode(_);break;case 12:case 13:o=l[L++],O+=String.fromCharCode((_&31)<<6|o&63);break;case 14:o=l[L++],A=l[L++],O+=String.fromCharCode((_&15)<<12|(o&63)<<6|(A&63)<<0);break}}return O},d={decodeTextFrame:N},c;function S(){return!c&&typeof self.TextDecoder<"u"&&(c=new self.TextDecoder("utf-8")),c}},"./src/demux/mp3demuxer.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>B});var C=s("./src/demux/base-audio-demuxer.ts"),g=s("./src/demux/id3.ts"),w=s("./src/utils/logger.ts"),R=s("./src/demux/mpegaudio.ts");function K(P,M){P.prototype=Object.create(M.prototype),P.prototype.constructor=P,k(P,M)}function k(P,M){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(N,I){return N.__proto__=I,N},k(P,M)}var F=function(P){K(M,P);function M(){return P.apply(this,arguments)||this}var m=M.prototype;return m.resetInitSegment=function(I,h,E,d){P.prototype.resetInitSegment.call(this,I,h,E,d),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:h,duration:d,inputTimeScale:9e4,dropped:0}},M.probe=function(I){if(!I)return!1;for(var h=g.getID3Data(I,0)||[],E=h.length,d=I.length;E<d;E++)if(R.probe(I,E))return w.logger.log("MPEG Audio sync word found !"),!0;return!1},m.canParse=function(I,h){return R.canParse(I,h)},m.appendFrame=function(I,h,E){if(this.basePTS!==null)return R.appendFrame(I,h,E,this.basePTS,this.frameIndex)},M}(C.default);const B=F},"./src/demux/mp4demuxer.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>F});var C=s("./src/polyfills/number.ts"),g=s("./src/types/demuxer.ts"),w=s("./src/utils/mp4-tools.ts"),R=s("./src/demux/dummy-demuxed-track.ts"),K=/\/emsg[-/]ID3/i,k=function(){function B(M,m){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=m}var P=B.prototype;return P.resetTimeStamp=function(){},P.resetInitSegment=function(m,N,I,h){var E=this.videoTrack=(0,R.dummyTrack)("video",1),d=this.audioTrack=(0,R.dummyTrack)("audio",1),c=this.txtTrack=(0,R.dummyTrack)("text",1);if(this.id3Track=(0,R.dummyTrack)("id3",1),this.timeOffset=0,!(!m||!m.byteLength)){var S=(0,w.parseInitSegment)(m);if(S.video){var v=S.video,l=v.id,p=v.timescale,y=v.codec;E.id=l,E.timescale=c.timescale=p,E.codec=y}if(S.audio){var T=S.audio,f=T.id,a=T.timescale,_=T.codec;d.id=f,d.timescale=a,d.codec=_}c.id=w.RemuxerTrackIdConfig.text,E.sampleDuration=0,E.duration=d.duration=h}},P.resetContiguity=function(){},B.probe=function(m){return m=m.length>16384?m.subarray(0,16384):m,(0,w.findBox)(m,["moof"]).length>0},P.demux=function(m,N){this.timeOffset=N;var I=m,h=this.videoTrack,E=this.txtTrack;if(this.config.progressive){this.remainderData&&(I=(0,w.appendUint8Array)(this.remainderData,m));var d=(0,w.segmentValidRange)(I);this.remainderData=d.remainder,h.samples=d.valid||new Uint8Array}else h.samples=I;var c=this.extractID3Track(h,N);return E.samples=(0,w.parseSamples)(N,h),{videoTrack:h,audioTrack:this.audioTrack,id3Track:c,textTrack:this.txtTrack}},P.flush=function(){var m=this.timeOffset,N=this.videoTrack,I=this.txtTrack;N.samples=this.remainderData||new Uint8Array,this.remainderData=null;var h=this.extractID3Track(N,this.timeOffset);return I.samples=(0,w.parseSamples)(m,N),{videoTrack:N,audioTrack:(0,R.dummyTrack)(),id3Track:h,textTrack:(0,R.dummyTrack)()}},P.extractID3Track=function(m,N){var I=this.id3Track;if(m.samples.length){var h=(0,w.findBox)(m.samples,["emsg"]);h&&h.forEach(function(E){var d=(0,w.parseEmsg)(E);if(K.test(d.schemeIdUri)){var c=(0,C.isFiniteNumber)(d.presentationTime)?d.presentationTime/d.timeScale:N+d.presentationTimeDelta/d.timeScale,S=d.eventDuration===4294967295?Number.POSITIVE_INFINITY:d.eventDuration/d.timeScale;S<=.001&&(S=Number.POSITIVE_INFINITY);var v=d.payload;I.samples.push({data:v,len:v.byteLength,dts:c,pts:c,type:g.MetadataSchema.emsg,duration:S})}})}return I},P.demuxSampleAes=function(m,N,I){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},P.destroy=function(){},B}();const F=k},"./src/demux/mpegaudio.ts":(x,b,s)=>{s.r(b),s.d(b,{appendFrame:()=>k,canParse:()=>M,isHeader:()=>P,isHeaderPattern:()=>B,parseHeader:()=>F,probe:()=>m});var C=null,g=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],w=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],R=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],K=[0,1,1,4];function k(N,I,h,E,d){if(!(h+24>I.length)){var c=F(I,h);if(c&&h+c.frameLength<=I.length){var S=c.samplesPerFrame*9e4/c.sampleRate,v=E+d*S,l={unit:I.subarray(h,h+c.frameLength),pts:v,dts:v};return N.config=[],N.channelCount=c.channelCount,N.samplerate=c.sampleRate,N.samples.push(l),{sample:l,length:c.frameLength,missing:0}}}}function F(N,I){var h=N[I+1]>>3&3,E=N[I+1]>>1&3,d=N[I+2]>>4&15,c=N[I+2]>>2&3;if(h!==1&&d!==0&&d!==15&&c!==3){var S=N[I+2]>>1&1,v=N[I+3]>>6,l=h===3?3-E:E===3?3:4,p=g[l*14+d-1]*1e3,y=h===3?0:h===2?1:2,T=w[y*3+c],f=v===3?1:2,a=R[h][E],_=K[E],o=a*8*_,A=Math.floor(a*p/T+S)*_;if(C===null){var O=navigator.userAgent||"",L=O.match(/Chrome\/(\d+)/i);C=L?parseInt(L[1]):0}var H=!!C&&C<=87;return H&&E===2&&p>=224e3&&v===0&&(N[I+3]=N[I+3]|128),{sampleRate:T,channelCount:f,frameLength:A,samplesPerFrame:o}}}function B(N,I){return N[I]===255&&(N[I+1]&224)===224&&(N[I+1]&6)!==0}function P(N,I){return I+1<N.length&&B(N,I)}function M(N,I){var h=4;return B(N,I)&&h<=N.length-I}function m(N,I){if(I+1<N.length&&B(N,I)){var h=4,E=F(N,I),d=h;E!=null&&E.frameLength&&(d=E.frameLength);var c=I+d;return c===N.length||P(N,c)}return!1}},"./src/demux/sample-aes.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>R});var C=s("./src/crypt/decrypter.ts"),g=s("./src/utils/mp4-tools.ts"),w=function(){function K(F,B,P){this.keyData=void 0,this.decrypter=void 0,this.keyData=P,this.decrypter=new C.default(B,{removePKCS7Padding:!1})}var k=K.prototype;return k.decryptBuffer=function(B){return this.decrypter.decrypt(B,this.keyData.key.buffer,this.keyData.iv.buffer)},k.decryptAacSample=function(B,P,M){var m=this,N=B[P].unit;if(!(N.length<=16)){var I=N.subarray(16,N.length-N.length%16),h=I.buffer.slice(I.byteOffset,I.byteOffset+I.length);this.decryptBuffer(h).then(function(E){var d=new Uint8Array(E);N.set(d,16),m.decrypter.isSync()||m.decryptAacSamples(B,P+1,M)})}},k.decryptAacSamples=function(B,P,M){for(;;P++){if(P>=B.length){M();return}if(!(B[P].unit.length<32)&&(this.decryptAacSample(B,P,M),!this.decrypter.isSync()))return}},k.getAvcEncryptedData=function(B){for(var P=Math.floor((B.length-48)/160)*16+16,M=new Int8Array(P),m=0,N=32;N<B.length-16;N+=160,m+=16)M.set(B.subarray(N,N+16),m);return M},k.getAvcDecryptedUnit=function(B,P){for(var M=new Uint8Array(P),m=0,N=32;N<B.length-16;N+=160,m+=16)B.set(M.subarray(m,m+16),N);return B},k.decryptAvcSample=function(B,P,M,m,N){var I=this,h=(0,g.discardEPB)(N.data),E=this.getAvcEncryptedData(h);this.decryptBuffer(E.buffer).then(function(d){N.data=I.getAvcDecryptedUnit(h,d),I.decrypter.isSync()||I.decryptAvcSamples(B,P,M+1,m)})},k.decryptAvcSamples=function(B,P,M,m){if(B instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;P++,M=0){if(P>=B.length){m();return}for(var N=B[P].units;!(M>=N.length);M++){var I=N[M];if(!(I.data.length<=48||I.type!==1&&I.type!==5)&&(this.decryptAvcSample(B,P,M,m,I),!this.decrypter.isSync()))return}}},K}();const R=w},"./src/demux/transmuxer-interface.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>P});var C=s("./src/demux/webworkify-webpack.js"),g=s("./src/events.ts"),w=s("./src/demux/transmuxer.ts"),R=s("./src/utils/logger.ts"),K=s("./src/errors.ts"),k=s("./src/utils/mediasource-helper.ts"),F=s("./node_modules/eventemitter3/index.js"),B=(0,k.getMediaSource)()||{isTypeSupported:function(){return!1}},P=function(){function M(N,I,h,E){var d=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var c=N.config;this.hls=N,this.id=I,this.useWorker=!!c.enableWorker,this.onTransmuxComplete=h,this.onFlush=E;var S=function(T,f){f=f||{},f.frag=d.frag,f.id=d.id,d.hls.trigger(T,f)};this.observer=new F.EventEmitter,this.observer.on(g.Events.FRAG_DECRYPTED,S),this.observer.on(g.Events.ERROR,S);var v={mp4:B.isTypeSupported("video/mp4"),mpeg:B.isTypeSupported("audio/mpeg"),mp3:B.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){R.logger.log("demuxing in webworker");var p;try{p=this.worker=(0,C.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),p.addEventListener("message",this.onwmsg),p.onerror=function(y){d.useWorker=!1,R.logger.warn("Exception in webworker, fallback to inline"),d.hls.trigger(g.Events.ERROR,{type:K.ErrorTypes.OTHER_ERROR,details:K.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(y.message+"  ("+y.filename+":"+y.lineno+")")})},p.postMessage({cmd:"init",typeSupported:v,vendor:l,id:I,config:JSON.stringify(c)})}catch(y){R.logger.warn("Error in worker:",y),R.logger.error("Error while initializing DemuxerWorker, fallback to inline"),p&&self.URL.revokeObjectURL(p.objectURL),this.transmuxer=new w.default(this.observer,v,c,l,I),this.worker=null}}else this.transmuxer=new w.default(this.observer,v,c,l,I)}var m=M.prototype;return m.destroy=function(){var I=this.worker;if(I)I.removeEventListener("message",this.onwmsg),I.terminate(),this.worker=null,this.onwmsg=void 0;else{var h=this.transmuxer;h&&(h.destroy(),this.transmuxer=null)}var E=this.observer;E&&E.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},m.push=function(I,h,E,d,c,S,v,l,p,y){var T,f,a=this;p.transmuxing.start=self.performance.now();var _=this.transmuxer,o=this.worker,A=S?S.start:c.start,O=c.decryptdata,L=this.frag,H=!(L&&c.cc===L.cc),W=!(L&&p.level===L.level),U=L?p.sn-L.sn:-1,G=this.part?p.part-this.part.index:-1,Y=U===0&&p.id>1&&p.id===(L==null?void 0:L.stats.chunkCount),j=!W&&(U===1||U===0&&(G===1||Y&&G<=0)),X=self.performance.now();(W||U||c.stats.parsing.start===0)&&(c.stats.parsing.start=X),S&&(G||!j)&&(S.stats.parsing.start=X);var q=!(L&&((T=c.initSegment)===null||T===void 0?void 0:T.url)===((f=L.initSegment)===null||f===void 0?void 0:f.url)),J=new w.TransmuxState(H,j,l,W,A,q);if(!j||H||q){R.logger.log("[transmuxer-interface, "+c.type+"]: Starting new transmux session for sn: "+p.sn+" p: "+p.part+" level: "+p.level+" id: "+p.id+`
        discontinuity: `+H+`
        trackSwitch: `+W+`
        contiguous: `+j+`
        accurateTimeOffset: `+l+`
        timeOffset: `+A+`
        initSegmentChange: `+q);var V=new w.TransmuxConfig(E,d,h,v,y);this.configureTransmuxer(V)}if(this.frag=c,this.part=S,o)o.postMessage({cmd:"demux",data:I,decryptdata:O,chunkMeta:p,state:J},I instanceof ArrayBuffer?[I]:[]);else if(_){var $=_.push(I,O,p,J);(0,w.isPromise)($)?(_.async=!0,$.then(function(ee){a.handleTransmuxComplete(ee)}).catch(function(ee){a.transmuxerError(ee,p,"transmuxer-interface push error")})):(_.async=!1,this.handleTransmuxComplete($))}},m.flush=function(I){var h=this;I.transmuxing.start=self.performance.now();var E=this.transmuxer,d=this.worker;if(d)d.postMessage({cmd:"flush",chunkMeta:I});else if(E){var c=E.flush(I),S=(0,w.isPromise)(c);S||E.async?((0,w.isPromise)(c)||(c=Promise.resolve(c)),c.then(function(v){h.handleFlushResult(v,I)}).catch(function(v){h.transmuxerError(v,I,"transmuxer-interface flush error")})):this.handleFlushResult(c,I)}},m.transmuxerError=function(I,h,E){this.hls&&this.hls.trigger(g.Events.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:h,fatal:!1,error:I,err:I,reason:E})},m.handleFlushResult=function(I,h){var E=this;I.forEach(function(d){E.handleTransmuxComplete(d)}),this.onFlush(h)},m.onWorkerMessage=function(I){var h=I.data,E=this.hls;switch(h.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(h.data);break}case"flush":{this.onFlush(h.data);break}case"workerLog":R.logger[h.data.logType]&&R.logger[h.data.logType](h.data.message);break;default:{h.data=h.data||{},h.data.frag=this.frag,h.data.id=this.id,E.trigger(h.event,h.data);break}}},m.configureTransmuxer=function(I){var h=this.worker,E=this.transmuxer;h?h.postMessage({cmd:"configure",config:I}):E&&E.configure(I)},m.handleTransmuxComplete=function(I){I.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(I)},M}()},"./src/demux/transmuxer-worker.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>k});var C=s("./src/demux/transmuxer.ts"),g=s("./src/events.ts"),w=s("./src/utils/logger.ts"),R=s("./node_modules/eventemitter3/index.js"),K=s("./src/errors.ts");function k(m){var N=new R.EventEmitter,I=function(d,c){m.postMessage({event:d,data:c})};N.on(g.Events.FRAG_DECRYPTED,I),N.on(g.Events.ERROR,I);var h=function(){var d=function(v){var l=function(y){I("workerLog",{logType:v,message:y})};w.logger[v]=l};for(var c in w.logger)d(c)};m.addEventListener("message",function(E){var d=E.data;switch(d.cmd){case"init":{var c=JSON.parse(d.config);m.transmuxer=new C.default(N,d.typeSupported,c,d.vendor,d.id),(0,w.enableLogs)(c.debug,d.id),h(),I("init",null);break}case"configure":{m.transmuxer.configure(d.config);break}case"demux":{var S=m.transmuxer.push(d.data,d.decryptdata,d.chunkMeta,d.state);(0,C.isPromise)(S)?(m.transmuxer.async=!0,S.then(function(y){F(m,y)}).catch(function(y){I(g.Events.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:d.chunkMeta,fatal:!1,error:y,err:y,reason:"transmuxer-worker push error"})})):(m.transmuxer.async=!1,F(m,S));break}case"flush":{var v=d.chunkMeta,l=m.transmuxer.flush(v),p=(0,C.isPromise)(l);p||m.transmuxer.async?((0,C.isPromise)(l)||(l=Promise.resolve(l)),l.then(function(y){P(m,y,v)}).catch(function(y){I(g.Events.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:d.chunkMeta,fatal:!1,error:y,err:y,reason:"transmuxer-worker flush error"})})):P(m,l,v);break}}})}function F(m,N){if(M(N.remuxResult))return!1;var I=[],h=N.remuxResult,E=h.audio,d=h.video;return E&&B(I,E),d&&B(I,d),m.postMessage({event:"transmuxComplete",data:N},I),!0}function B(m,N){N.data1&&m.push(N.data1.buffer),N.data2&&m.push(N.data2.buffer)}function P(m,N,I){var h=N.reduce(function(E,d){return F(m,d)||E},!1);h||m.postMessage({event:"transmuxComplete",data:N[0]}),m.postMessage({event:"flush",data:I})}function M(m){return!m.audio&&!m.video&&!m.text&&!m.id3&&!m.initSegment}},"./src/demux/transmuxer.ts":(x,b,s)=>{s.r(b),s.d(b,{TransmuxConfig:()=>c,TransmuxState:()=>S,default:()=>I,isPromise:()=>d});var C=s("./src/events.ts"),g=s("./src/errors.ts"),w=s("./src/crypt/decrypter.ts"),R=s("./src/demux/aacdemuxer.ts"),K=s("./src/demux/mp4demuxer.ts"),k=s("./src/demux/tsdemuxer.ts"),F=s("./src/demux/mp3demuxer.ts"),B=s("./src/remux/mp4-remuxer.ts"),P=s("./src/remux/passthrough-remuxer.ts"),M=s("./src/utils/logger.ts"),m;try{m=self.performance.now.bind(self.performance)}catch{M.logger.debug("Unable to use Performance API on this environment"),m=self.Date.now}var N=[{demux:K.default,remux:P.default},{demux:k.default,remux:B.default},{demux:R.default,remux:B.default},{demux:F.default,remux:B.default}],I=function(){function v(p,y,T,f,a){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=p,this.typeSupported=y,this.config=T,this.vendor=f,this.id=a}var l=v.prototype;return l.configure=function(y){this.transmuxConfig=y,this.decrypter&&this.decrypter.reset()},l.push=function(y,T,f,a){var _=this,o=f.transmuxing;o.executeStart=m();var A=new Uint8Array(y),O=this.currentTransmuxState,L=this.transmuxConfig;a&&(this.currentTransmuxState=a);var H=a||O,W=H.contiguous,U=H.discontinuity,G=H.trackSwitch,Y=H.accurateTimeOffset,j=H.timeOffset,X=H.initSegmentChange,q=L.audioCodec,J=L.videoCodec,V=L.defaultInitPts,$=L.duration,ee=L.initSegmentData,Z=h(A,T);if(Z&&Z.method==="AES-128"){var re=this.getDecrypter();if(re.isSync()){var ae=re.softwareDecrypt(A,Z.key.buffer,Z.iv.buffer);if(!ae)return o.executeEnd=m(),E(f);A=new Uint8Array(ae)}else return this.decryptionPromise=re.webCryptoDecrypt(A,Z.key.buffer,Z.iv.buffer).then(function(oe){var ge=_.push(oe,null,f);return _.decryptionPromise=null,ge}),this.decryptionPromise}var le=this.needsProbing(U,G);le&&this.configureTransmuxer(A),(U||G||X||le)&&this.resetInitSegment(ee,q,J,$,T),(U||X||le)&&this.resetInitialTimestamp(V),W||this.resetContiguity();var ne=this.transmux(A,Z,j,Y,f),ie=this.currentTransmuxState;return ie.contiguous=!0,ie.discontinuity=!1,ie.trackSwitch=!1,o.executeEnd=m(),ne},l.flush=function(y){var T=this,f=y.transmuxing;f.executeStart=m();var a=this.decrypter,_=this.currentTransmuxState,o=this.decryptionPromise;if(o)return o.then(function(){return T.flush(y)});var A=[],O=_.timeOffset;if(a){var L=a.flush();L&&A.push(this.push(L,null,y))}var H=this.demuxer,W=this.remuxer;if(!H||!W)return this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),f.executeEnd=m(),[E(y)];var U=H.flush(O);return d(U)?U.then(function(G){return T.flushRemux(A,G,y),A}):(this.flushRemux(A,U,y),A)},l.flushRemux=function(y,T,f){var a=T.audioTrack,_=T.videoTrack,o=T.id3Track,A=T.textTrack,O=this.currentTransmuxState,L=O.accurateTimeOffset,H=O.timeOffset;M.logger.log("[transmuxer.ts]: Flushed fragment "+f.sn+(f.part>-1?" p: "+f.part:"")+" of level "+f.level);var W=this.remuxer.remux(a,_,o,A,H,L,!0,this.id);y.push({remuxResult:W,chunkMeta:f}),f.transmuxing.executeEnd=m()},l.resetInitialTimestamp=function(y){var T=this.demuxer,f=this.remuxer;!T||!f||(T.resetTimeStamp(y),f.resetTimeStamp(y))},l.resetContiguity=function(){var y=this.demuxer,T=this.remuxer;!y||!T||(y.resetContiguity(),T.resetNextTimestamp())},l.resetInitSegment=function(y,T,f,a,_){var o=this.demuxer,A=this.remuxer;!o||!A||(o.resetInitSegment(y,T,f,a),A.resetInitSegment(y,T,f,_))},l.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},l.transmux=function(y,T,f,a,_){var o;return T&&T.method==="SAMPLE-AES"?o=this.transmuxSampleAes(y,T,f,a,_):o=this.transmuxUnencrypted(y,f,a,_),o},l.transmuxUnencrypted=function(y,T,f,a){var _=this.demuxer.demux(y,T,!1,!this.config.progressive),o=_.audioTrack,A=_.videoTrack,O=_.id3Track,L=_.textTrack,H=this.remuxer.remux(o,A,O,L,T,f,!1,this.id);return{remuxResult:H,chunkMeta:a}},l.transmuxSampleAes=function(y,T,f,a,_){var o=this;return this.demuxer.demuxSampleAes(y,T,f).then(function(A){var O=o.remuxer.remux(A.audioTrack,A.videoTrack,A.id3Track,A.textTrack,f,a,!1,o.id);return{remuxResult:O,chunkMeta:_}})},l.configureTransmuxer=function(y){for(var T=this.config,f=this.observer,a=this.typeSupported,_=this.vendor,o,A=0,O=N.length;A<O;A++)if(N[A].demux.probe(y)){o=N[A];break}o||(M.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),o={demux:K.default,remux:P.default});var L=this.demuxer,H=this.remuxer,W=o.remux,U=o.demux;(!H||!(H instanceof W))&&(this.remuxer=new W(f,T,a,_)),(!L||!(L instanceof U))&&(this.demuxer=new U(f,T,a),this.probe=U.probe)},l.needsProbing=function(y,T){return!this.demuxer||!this.remuxer||y||T},l.getDecrypter=function(){var y=this.decrypter;return y||(y=this.decrypter=new w.default(this.config)),y},v}();function h(v,l){var p=null;return v.byteLength>0&&l!=null&&l.key!=null&&l.iv!==null&&l.method!=null&&(p=l),p}var E=function(l){return{remuxResult:{},chunkMeta:l}};function d(v){return"then"in v&&v.then instanceof Function}var c=function(l,p,y,T,f){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=l,this.videoCodec=p,this.initSegmentData=y,this.duration=T,this.defaultInitPts=f},S=function(l,p,y,T,f,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=l,this.contiguous=p,this.accurateTimeOffset=y,this.trackSwitch=T,this.timeOffset=f,this.initSegmentChange=a}},"./src/demux/tsdemuxer.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>S});var C=s("./src/demux/adts.ts"),g=s("./src/demux/mpegaudio.ts"),w=s("./src/demux/exp-golomb.ts"),R=s("./src/demux/sample-aes.ts"),K=s("./src/events.ts"),k=s("./src/utils/mp4-tools.ts"),F=s("./src/utils/logger.ts"),B=s("./src/errors.ts"),P=s("./src/types/demuxer.ts");function M(){return M=Object.assign?Object.assign.bind():function(v){for(var l=1;l<arguments.length;l++){var p=arguments[l];for(var y in p)Object.prototype.hasOwnProperty.call(p,y)&&(v[y]=p[y])}return v},M.apply(this,arguments)}var m=188,N=function(){function v(p,y,T){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=p,this.config=y,this.typeSupported=T}v.probe=function(y){var T=v.syncOffset(y);return T>0&&F.logger.warn("MPEG2-TS detected but first sync word found @ offset "+T),T!==-1},v.syncOffset=function(y){for(var T=Math.min(m*5,y.length-m*2)+1,f=0;f<T;){if(y[f]===71&&y[f+m]===71)return f;f++}return-1},v.createTrack=function(y,T){return{container:y==="video"||y==="audio"?"video/mp2t":void 0,type:y,id:k.RemuxerTrackIdConfig[y],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:y==="audio"?T:void 0}};var l=v.prototype;return l.resetInitSegment=function(y,T,f,a){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=v.createTrack("video"),this._audioTrack=v.createTrack("audio",a),this._id3Track=v.createTrack("id3"),this._txtTrack=v.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=T,this.videoCodec=f,this._duration=a},l.resetTimeStamp=function(){},l.resetContiguity=function(){var y=this._audioTrack,T=this._avcTrack,f=this._id3Track;y&&(y.pesData=null),T&&(T.pesData=null),f&&(f.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},l.demux=function(y,T,f,a){f===void 0&&(f=!1),a===void 0&&(a=!1),f||(this.sampleAes=null);var _,o=this._avcTrack,A=this._audioTrack,O=this._id3Track,L=this._txtTrack,H=o.pid,W=o.pesData,U=A.pid,G=O.pid,Y=A.pesData,j=O.pesData,X=null,q=this.pmtParsed,J=this._pmtId,V=y.length;if(this.remainderData&&(y=(0,k.appendUint8Array)(this.remainderData,y),V=y.length,this.remainderData=null),V<m&&!a)return this.remainderData=y,{audioTrack:A,videoTrack:o,id3Track:O,textTrack:L};var $=Math.max(0,v.syncOffset(y));V-=(V-$)%m,V<y.byteLength&&!a&&(this.remainderData=new Uint8Array(y.buffer,V,y.buffer.byteLength-V));for(var ee=0,Z=$;Z<V;Z+=m)if(y[Z]===71){var re=!!(y[Z+1]&64),ae=((y[Z+1]&31)<<8)+y[Z+2],le=(y[Z+3]&48)>>4,ne=void 0;if(le>1){if(ne=Z+5+y[Z+4],ne===Z+m)continue}else ne=Z+4;switch(ae){case H:re&&(W&&(_=d(W))&&this.parseAVCPES(o,L,_,!1),W={data:[],size:0}),W&&(W.data.push(y.subarray(ne,Z+m)),W.size+=Z+m-ne);break;case U:if(re){if(Y&&(_=d(Y)))switch(A.segmentCodec){case"aac":this.parseAACPES(A,_);break;case"mp3":this.parseMPEGPES(A,_);break}Y={data:[],size:0}}Y&&(Y.data.push(y.subarray(ne,Z+m)),Y.size+=Z+m-ne);break;case G:re&&(j&&(_=d(j))&&this.parseID3PES(O,_),j={data:[],size:0}),j&&(j.data.push(y.subarray(ne,Z+m)),j.size+=Z+m-ne);break;case 0:re&&(ne+=y[ne]+1),J=this._pmtId=h(y,ne);break;case J:{re&&(ne+=y[ne]+1);var ie=E(y,ne,this.typeSupported,f);H=ie.avc,H>0&&(o.pid=H),U=ie.audio,U>0&&(A.pid=U,A.segmentCodec=ie.segmentCodec),G=ie.id3,G>0&&(O.pid=G),X!==null&&!q&&(F.logger.log("unknown PID '"+X+"' in TS found"),X=null,Z=$-188),q=this.pmtParsed=!0;break}case 17:case 8191:break;default:X=ae;break}}else ee++;ee>0&&this.observer.emit(K.Events.ERROR,K.Events.ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+ee+" TS packet/s that do not start with 0x47"}),o.pesData=W,A.pesData=Y,O.pesData=j;var oe={audioTrack:A,videoTrack:o,id3Track:O,textTrack:L};return a&&this.extractRemainingSamples(oe),oe},l.flush=function(){var y=this.remainderData;this.remainderData=null;var T;return y?T=this.demux(y,-1,!1,!0):T={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(T),this.sampleAes?this.decrypt(T,this.sampleAes):T},l.extractRemainingSamples=function(y){var T=y.audioTrack,f=y.videoTrack,a=y.id3Track,_=y.textTrack,o=f.pesData,A=T.pesData,O=a.pesData,L;if(o&&(L=d(o))?(this.parseAVCPES(f,_,L,!0),f.pesData=null):f.pesData=o,A&&(L=d(A))){switch(T.segmentCodec){case"aac":this.parseAACPES(T,L);break;case"mp3":this.parseMPEGPES(T,L);break}T.pesData=null}else A!=null&&A.size&&F.logger.log("last AAC PES packet truncated,might overlap between fragments"),T.pesData=A;O&&(L=d(O))?(this.parseID3PES(a,L),a.pesData=null):a.pesData=O},l.demuxSampleAes=function(y,T,f){var a=this.demux(y,f,!0,!this.config.progressive),_=this.sampleAes=new R.default(this.observer,this.config,T);return this.decrypt(a,_)},l.decrypt=function(y,T){return new Promise(function(f){var a=y.audioTrack,_=y.videoTrack;a.samples&&a.segmentCodec==="aac"?T.decryptAacSamples(a.samples,0,function(){_.samples?T.decryptAvcSamples(_.samples,0,0,function(){f(y)}):f(y)}):_.samples&&T.decryptAvcSamples(_.samples,0,0,function(){f(y)})})},l.destroy=function(){this._duration=0},l.parseAVCPES=function(y,T,f,a){var _=this,o=this.parseAVCNALu(y,f.data),A=this.avcSample,O,L=!1;f.data=null,A&&o.length&&!y.audFound&&(c(A,y),A=this.avcSample=I(!1,f.pts,f.dts,"")),o.forEach(function(H){switch(H.type){case 1:{O=!0,A||(A=_.avcSample=I(!0,f.pts,f.dts,"")),A.frame=!0;var W=H.data;if(L&&W.length>4){var U=new w.default(W).readSliceType();(U===2||U===4||U===7||U===9)&&(A.key=!0)}break}case 5:O=!0,A||(A=_.avcSample=I(!0,f.pts,f.dts,"")),A.key=!0,A.frame=!0;break;case 6:{O=!0,(0,k.parseSEIMessageFromNALu)(H.data,1,f.pts,T.samples);break}case 7:if(O=!0,L=!0,!y.sps){var G=new w.default(H.data),Y=G.readSPS();y.width=Y.width,y.height=Y.height,y.pixelRatio=Y.pixelRatio,y.sps=[H.data],y.duration=_._duration;for(var j=H.data.subarray(1,4),X="avc1.",q=0;q<3;q++){var J=j[q].toString(16);J.length<2&&(J="0"+J),X+=J}y.codec=X}break;case 8:O=!0,y.pps||(y.pps=[H.data]);break;case 9:O=!1,y.audFound=!0,A&&c(A,y),A=_.avcSample=I(!1,f.pts,f.dts,"");break;case 12:O=!0;break;default:O=!1,A&&(A.debug+="unknown NAL "+H.type+" ");break}if(A&&O){var V=A.units;V.push(H)}}),a&&A&&(c(A,y),this.avcSample=null)},l.getLastNalUnit=function(y){var T,f=this.avcSample,a;if((!f||f.units.length===0)&&(f=y[y.length-1]),(T=f)!==null&&T!==void 0&&T.units){var _=f.units;a=_[_.length-1]}return a},l.parseAVCNALu=function(y,T){var f=T.byteLength,a=y.naluState||0,_=a,o=[],A=0,O,L,H,W=-1,U=0;for(a===-1&&(W=0,U=T[0]&31,a=0,A=1);A<f;){if(O=T[A++],!a){a=O?0:1;continue}if(a===1){a=O?0:2;continue}if(!O)a=3;else if(O===1){if(W>=0){var G={data:T.subarray(W,A-a-1),type:U};o.push(G)}else{var Y=this.getLastNalUnit(y.samples);if(Y&&(_&&A<=4-_&&Y.state&&(Y.data=Y.data.subarray(0,Y.data.byteLength-_)),L=A-a-1,L>0)){var j=new Uint8Array(Y.data.byteLength+L);j.set(Y.data,0),j.set(T.subarray(0,L),Y.data.byteLength),Y.data=j,Y.state=0}}A<f?(H=T[A]&31,W=A,U=H,a=0):a=-1}else a=0}if(W>=0&&a>=0){var X={data:T.subarray(W,f),type:U,state:a};o.push(X)}if(o.length===0){var q=this.getLastNalUnit(y.samples);if(q){var J=new Uint8Array(q.data.byteLength+T.byteLength);J.set(q.data,0),J.set(T,q.data.byteLength),q.data=J}}return y.naluState=a,o},l.parseAACPES=function(y,T){var f=0,a=this.aacOverFlow,_=T.data;if(a){this.aacOverFlow=null;var o=a.missing,A=a.sample.unit.byteLength;if(o===-1){var O=new Uint8Array(A+_.byteLength);O.set(a.sample.unit,0),O.set(_,A),_=O}else{var L=A-o;a.sample.unit.set(_.subarray(0,o),L),y.samples.push(a.sample),f=a.missing}}var H,W;for(H=f,W=_.length;H<W-1&&!C.isHeader(_,H);H++);if(H!==f){var U,G;if(H<W-1?(U="AAC PES did not start with ADTS header,offset:"+H,G=!1):(U="no ADTS header found in AAC PES",G=!0),F.logger.warn("parsing error:"+U),this.observer.emit(K.Events.ERROR,K.Events.ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.FRAG_PARSING_ERROR,fatal:G,reason:U}),G)return}C.initTrackConfig(y,this.observer,_,H,this.audioCodec);var Y;if(T.pts!==void 0)Y=T.pts;else if(a){var j=C.getFrameDuration(y.samplerate);Y=a.sample.pts+j}else{F.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var X=0,q;H<W;)if(q=C.appendFrame(y,_,H,Y,X),H+=q.length,q.missing){this.aacOverFlow=q;break}else for(X++;H<W-1&&!C.isHeader(_,H);H++);},l.parseMPEGPES=function(y,T){var f=T.data,a=f.length,_=0,o=0,A=T.pts;if(A===void 0){F.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<a;)if(g.isHeader(f,o)){var O=g.appendFrame(y,f,o,A,_);if(O)o+=O.length,_++;else break}else o++},l.parseID3PES=function(y,T){if(T.pts===void 0){F.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var f=M({},T,{type:this._avcTrack?P.MetadataSchema.emsg:P.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});y.samples.push(f)},v}();function I(v,l,p,y){return{key:v,frame:!1,pts:l,dts:p,units:[],debug:y,length:0}}function h(v,l){return(v[l+10]&31)<<8|v[l+11]}function E(v,l,p,y){var T={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},f=(v[l+1]&15)<<8|v[l+2],a=l+3+f-4,_=(v[l+10]&15)<<8|v[l+11];for(l+=12+_;l<a;){var o=(v[l+1]&31)<<8|v[l+2];switch(v[l]){case 207:if(!y){F.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:T.audio===-1&&(T.audio=o);break;case 21:T.id3===-1&&(T.id3=o);break;case 219:if(!y){F.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:T.avc===-1&&(T.avc=o);break;case 3:case 4:p.mpeg!==!0&&p.mp3!==!0?F.logger.log("MPEG audio found, not supported in this browser"):T.audio===-1&&(T.audio=o,T.segmentCodec="mp3");break;case 36:F.logger.warn("Unsupported HEVC stream type found");break}l+=((v[l+3]&15)<<8|v[l+4])+5}return T}function d(v){var l=0,p,y,T,f,a,_=v.data;if(!v||v.size===0)return null;for(;_[0].length<19&&_.length>1;){var o=new Uint8Array(_[0].length+_[1].length);o.set(_[0]),o.set(_[1],_[0].length),_[0]=o,_.splice(1,1)}p=_[0];var A=(p[0]<<16)+(p[1]<<8)+p[2];if(A===1){if(y=(p[4]<<8)+p[5],y&&y>v.size-6)return null;var O=p[7];O&192&&(f=(p[9]&14)*536870912+(p[10]&255)*4194304+(p[11]&254)*16384+(p[12]&255)*128+(p[13]&254)/2,O&64?(a=(p[14]&14)*536870912+(p[15]&255)*4194304+(p[16]&254)*16384+(p[17]&255)*128+(p[18]&254)/2,f-a>54e5&&(F.logger.warn(Math.round((f-a)/9e4)+"s delta between PTS and DTS, align them"),f=a)):a=f),T=p[8];var L=T+9;if(v.size<=L)return null;v.size-=L;for(var H=new Uint8Array(v.size),W=0,U=_.length;W<U;W++){p=_[W];var G=p.byteLength;if(L)if(L>G){L-=G;continue}else p=p.subarray(L),G-=L,L=0;H.set(p,l),l+=G}return y&&(y-=T+3),{data:H,pts:f,dts:a,len:y}}return null}function c(v,l){if(v.units.length&&v.frame){if(v.pts===void 0){var p=l.samples,y=p.length;if(y){var T=p[y-1];v.pts=T.pts,v.dts=T.dts}else{l.dropped++;return}}l.samples.push(v)}v.debug.length&&F.logger.log(v.pts+"/"+v.dts+":"+v.debug)}const S=N},"./src/demux/webworkify-webpack.js":(x,b,s)=>{s.r(b),s.d(b,{default:()=>m});var C=function(){var I=ENTRY_MODULE,h={},E=function c(S){var v=h[S];if(v!==void 0)return v.exports;var l=h[S]={exports:{}};return I[S].call(l.exports,l,l.exports,c),l.exports};E.m=I,function(){E.n=function(c){var S=c&&c.__esModule?function(){return c.default}:function(){return c};return E.d(S,{a:S}),S}}(),function(){E.d=function(c,S){for(var v in S)E.o(S,v)&&!E.o(c,v)&&Object.defineProperty(c,v,{enumerable:!0,get:S[v]})}}(),function(){E.o=function(c,S){return Object.prototype.hasOwnProperty.call(c,S)}}(),function(){E.r=function(c){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})}}();var d=E(ENTRY_MODULE);return d.default||d},g=C.toString().split("ENTRY_MODULE"),w="[\\.|\\-|\\+|\\w|/|@]+",R="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+w+").*?\\)";function K(N){return(N+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function k(N){return!isNaN(1*N)}function F(N,I,h){var E={};E[h]=[];var d=I.toString().replace(/^"[^"]+"/,"function"),c=d.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||d.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!c)return E;for(var S=c[1],v=new RegExp("(\\\\n|\\W)"+K(S)+R,"g"),l;l=v.exec(d);)l[3]!=="dll-reference"&&E[h].push(l[3]);for(v=new RegExp("\\("+K(S)+'\\("(dll-reference\\s('+w+'))"\\)\\)'+R,"g");l=v.exec(d);)N[l[2]]||(E[h].push(l[1]),N[l[2]]=s(l[1]).m),E[l[2]]=E[l[2]]||[],E[l[2]].push(l[4]);for(var p=Object.keys(E),y=0;y<p.length;y++)for(var T=0;T<E[p[y]].length;T++)k(E[p[y]][T])&&(E[p[y]][T]=1*E[p[y]][T]);return E}function B(N){var I=Object.keys(N);return I.reduce(function(h,E){return h||N[E].length>0},!1)}function P(N,I){for(var h={main:[I]},E={main:[]},d={main:{}};B(h);)for(var c=Object.keys(h),S=0;S<c.length;S++){var v=c[S],l=h[v],p=l.pop();if(d[v]=d[v]||{},!(d[v][p]||!N[v][p])){d[v][p]=!0,E[v]=E[v]||[],E[v].push(p);for(var y=F(N,N[v][p],v),T=Object.keys(y),f=0;f<T.length;f++)h[T[f]]=h[T[f]]||[],h[T[f]]=h[T[f]].concat(y[T[f]])}}return E}function M(N,I,h,E){var d=N[E].map(function(c){return'"'+c+'": '+I[E][c].toString().replace(/^"[^"]+"/,"function")}).join(",");return g[0]+"{"+d+"}"+g[1]+'"'+h+'"'+g[2]}function m(N,I){I=I||{};var h={main:s.m},E=I.all?{main:Object.keys(h.main)}:P(h,N),d="";Object.keys(E).filter(function(p){return p!=="main"}).forEach(function(p){for(var y=0;E[p][y];)y++;E[p].push(y),h[p][y]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",d=d+("var "+p+" = ("+M(E,h,y,modules)+`)();
`)}),d=d+("new (("+M(E,h,N,"main")+")())(self);");var c=new window.Blob([d],{type:"text/javascript"}),S=window.URL||window.webkitURL||window.mozURL||window.msURL,v=S.createObjectURL(c),l=new window.Worker(v);return l.objectURL=v,l}},"./src/errors.ts":(x,b,s)=>{s.r(b),s.d(b,{ErrorDetails:()=>g,ErrorTypes:()=>C});var C;(function(w){w.NETWORK_ERROR="networkError",w.MEDIA_ERROR="mediaError",w.KEY_SYSTEM_ERROR="keySystemError",w.MUX_ERROR="muxError",w.OTHER_ERROR="otherError"})(C||(C={}));var g;(function(w){w.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",w.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",w.KEY_SYSTEM_NO_SESSION="keySystemNoSession",w.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",w.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",w.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",w.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",w.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",w.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",w.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",w.MANIFEST_LOAD_ERROR="manifestLoadError",w.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",w.MANIFEST_PARSING_ERROR="manifestParsingError",w.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",w.LEVEL_EMPTY_ERROR="levelEmptyError",w.LEVEL_LOAD_ERROR="levelLoadError",w.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",w.LEVEL_SWITCH_ERROR="levelSwitchError",w.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",w.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",w.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",w.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",w.FRAG_LOAD_ERROR="fragLoadError",w.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",w.FRAG_DECRYPT_ERROR="fragDecryptError",w.FRAG_PARSING_ERROR="fragParsingError",w.REMUX_ALLOC_ERROR="remuxAllocError",w.KEY_LOAD_ERROR="keyLoadError",w.KEY_LOAD_TIMEOUT="keyLoadTimeOut",w.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",w.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",w.BUFFER_APPEND_ERROR="bufferAppendError",w.BUFFER_APPENDING_ERROR="bufferAppendingError",w.BUFFER_STALLED_ERROR="bufferStalledError",w.BUFFER_FULL_ERROR="bufferFullError",w.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",w.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",w.INTERNAL_EXCEPTION="internalException",w.INTERNAL_ABORTED="aborted",w.UNKNOWN="unknown"})(g||(g={}))},"./src/events.ts":(x,b,s)=>{s.r(b),s.d(b,{Events:()=>C});var C;(function(g){g.MEDIA_ATTACHING="hlsMediaAttaching",g.MEDIA_ATTACHED="hlsMediaAttached",g.MEDIA_DETACHING="hlsMediaDetaching",g.MEDIA_DETACHED="hlsMediaDetached",g.BUFFER_RESET="hlsBufferReset",g.BUFFER_CODECS="hlsBufferCodecs",g.BUFFER_CREATED="hlsBufferCreated",g.BUFFER_APPENDING="hlsBufferAppending",g.BUFFER_APPENDED="hlsBufferAppended",g.BUFFER_EOS="hlsBufferEos",g.BUFFER_FLUSHING="hlsBufferFlushing",g.BUFFER_FLUSHED="hlsBufferFlushed",g.MANIFEST_LOADING="hlsManifestLoading",g.MANIFEST_LOADED="hlsManifestLoaded",g.MANIFEST_PARSED="hlsManifestParsed",g.LEVEL_SWITCHING="hlsLevelSwitching",g.LEVEL_SWITCHED="hlsLevelSwitched",g.LEVEL_LOADING="hlsLevelLoading",g.LEVEL_LOADED="hlsLevelLoaded",g.LEVEL_UPDATED="hlsLevelUpdated",g.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",g.LEVELS_UPDATED="hlsLevelsUpdated",g.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",g.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",g.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",g.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",g.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",g.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",g.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",g.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",g.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",g.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",g.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",g.CUES_PARSED="hlsCuesParsed",g.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",g.INIT_PTS_FOUND="hlsInitPtsFound",g.FRAG_LOADING="hlsFragLoading",g.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",g.FRAG_LOADED="hlsFragLoaded",g.FRAG_DECRYPTED="hlsFragDecrypted",g.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",g.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",g.FRAG_PARSING_METADATA="hlsFragParsingMetadata",g.FRAG_PARSED="hlsFragParsed",g.FRAG_BUFFERED="hlsFragBuffered",g.FRAG_CHANGED="hlsFragChanged",g.FPS_DROP="hlsFpsDrop",g.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",g.ERROR="hlsError",g.DESTROYING="hlsDestroying",g.KEY_LOADING="hlsKeyLoading",g.KEY_LOADED="hlsKeyLoaded",g.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",g.BACK_BUFFER_REACHED="hlsBackBufferReached"})(C||(C={}))},"./src/hls.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>l});var C=s("./node_modules/url-toolkit/src/url-toolkit.js"),g=s("./src/loader/playlist-loader.ts"),w=s("./src/controller/id3-track-controller.ts"),R=s("./src/controller/latency-controller.ts"),K=s("./src/controller/level-controller.ts"),k=s("./src/controller/fragment-tracker.ts"),F=s("./src/loader/key-loader.ts"),B=s("./src/controller/stream-controller.ts"),P=s("./src/is-supported.ts"),M=s("./src/utils/logger.ts"),m=s("./src/config.ts"),N=s("./node_modules/eventemitter3/index.js"),I=s("./src/events.ts"),h=s("./src/errors.ts"),E=s("./src/types/level.ts");function d(p,y){for(var T=0;T<y.length;T++){var f=y[T];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(p,S(f.key),f)}}function c(p,y,T){return y&&d(p.prototype,y),T&&d(p,T),Object.defineProperty(p,"prototype",{writable:!1}),p}function S(p){var y=v(p,"string");return typeof y=="symbol"?y:String(y)}function v(p,y){if(typeof p!="object"||p===null)return p;var T=p[Symbol.toPrimitive];if(T!==void 0){var f=T.call(p,y||"default");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(p)}var l=function(){p.isSupported=function(){return(0,P.isSupported)()};function p(T){T===void 0&&(T={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new N.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var f=this.config=(0,m.mergeConfig)(p.DefaultConfig,T);this.userConfig=T,(0,M.enableLogs)(f.debug,"Hls instance"),this._autoLevelCapping=-1,f.progressive&&(0,m.enableStreamingMode)(f);var a=f.abrController,_=f.bufferController,o=f.capLevelController,A=f.fpsController,O=this.abrController=new a(this),L=this.bufferController=new _(this),H=this.capLevelController=new o(this),W=new A(this),U=new g.default(this),G=new w.default(this),Y=this.levelController=new K.default(this),j=new k.FragmentTracker(this),X=new F.default(this.config),q=this.streamController=new B.default(this,j,X);H.setStreamController(q),W.setStreamController(q);var J=[U,Y,q];this.networkControllers=J;var V=[O,L,H,W,G,j];this.audioTrackController=this.createController(f.audioTrackController,J);var $=f.audioStreamController;$&&J.push(new $(this,j,X)),this.subtitleTrackController=this.createController(f.subtitleTrackController,J);var ee=f.subtitleStreamController;ee&&J.push(new ee(this,j,X)),this.createController(f.timelineController,V),X.emeController=this.emeController=this.createController(f.emeController,V),this.cmcdController=this.createController(f.cmcdController,V),this.latencyController=this.createController(R.default,V),this.coreComponents=V}var y=p.prototype;return y.createController=function(f,a){if(f){var _=new f(this);return a&&a.push(_),_}return null},y.on=function(f,a,_){_===void 0&&(_=this),this._emitter.on(f,a,_)},y.once=function(f,a,_){_===void 0&&(_=this),this._emitter.once(f,a,_)},y.removeAllListeners=function(f){this._emitter.removeAllListeners(f)},y.off=function(f,a,_,o){_===void 0&&(_=this),this._emitter.off(f,a,_,o)},y.listeners=function(f){return this._emitter.listeners(f)},y.emit=function(f,a,_){return this._emitter.emit(f,a,_)},y.trigger=function(f,a){if(this.config.debug)return this.emit(f,f,a);try{return this.emit(f,f,a)}catch(_){M.logger.error("An internal error happened while handling event "+f+'. Error message: "'+_.message+'". Here is a stacktrace:',_),this.trigger(I.Events.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:f,error:_})}return!1},y.listenerCount=function(f){return this._emitter.listenerCount(f)},y.destroy=function(){M.logger.log("destroy"),this.trigger(I.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(f){return f.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(f){return f.destroy()}),this.coreComponents.length=0},y.attachMedia=function(f){M.logger.log("attachMedia"),this._media=f,this.trigger(I.Events.MEDIA_ATTACHING,{media:f})},y.detachMedia=function(){M.logger.log("detachMedia"),this.trigger(I.Events.MEDIA_DETACHING,void 0),this._media=null},y.loadSource=function(f){this.stopLoad();var a=this.media,_=this.url,o=this.url=C.buildAbsoluteURL(self.location.href,f,{alwaysNormalize:!0});M.logger.log("loadSource:"+o),a&&_&&_!==o&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(a)),this.trigger(I.Events.MANIFEST_LOADING,{url:f})},y.startLoad=function(f){f===void 0&&(f=-1),M.logger.log("startLoad("+f+")"),this.networkControllers.forEach(function(a){a.startLoad(f)})},y.stopLoad=function(){M.logger.log("stopLoad"),this.networkControllers.forEach(function(f){f.stopLoad()})},y.swapAudioCodec=function(){M.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},y.recoverMediaError=function(){M.logger.log("recoverMediaError");var f=this._media;this.detachMedia(),f&&this.attachMedia(f)},y.removeLevel=function(f,a){a===void 0&&(a=0),this.levelController.removeLevel(f,a)},c(p,[{key:"levels",get:function(){var f=this.levelController.levels;return f||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(f){M.logger.log("set currentLevel:"+f),this.loadLevel=f,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(f){M.logger.log("set nextLevel:"+f),this.levelController.manualLevel=f,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(f){M.logger.log("set loadLevel:"+f),this.levelController.manualLevel=f}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(f){this.levelController.nextLoadLevel=f}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(f){M.logger.log("set firstLevel:"+f),this.levelController.firstLevel=f}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(f){M.logger.log("set startLevel:"+f),f!==-1&&(f=Math.max(f,this.minAutoLevel)),this.levelController.startLevel=f}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(f){var a=!!f;a!==this.config.capLevelToPlayerSize&&(a?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=a)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(f){this._autoLevelCapping!==f&&(M.logger.log("set autoLevelCapping:"+f),this._autoLevelCapping=f)}},{key:"bandwidthEstimate",get:function(){var f=this.abrController.bwEstimator;return f?f.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(f){E.HdcpLevels.indexOf(f)>-1&&(this._maxHdcpLevel=f)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var f=this.levels,a=this.config.minAutoBitrate;if(!f)return 0;for(var _=f.length,o=0;o<_;o++)if(f[o].maxBitrate>=a)return o;return 0}},{key:"maxAutoLevel",get:function(){var f=this.levels,a=this.autoLevelCapping,_=this.maxHdcpLevel,o;if(a===-1&&f&&f.length?o=f.length-1:o=a,_)for(var A=o;A--;){var O=f[A].attrs["HDCP-LEVEL"];if(O&&O<=_)return A}return o}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(f){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,f)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var f=this.audioTrackController;return f?f.audioTracks:[]}},{key:"audioTrack",get:function(){var f=this.audioTrackController;return f?f.audioTrack:-1},set:function(f){var a=this.audioTrackController;a&&(a.audioTrack=f)}},{key:"subtitleTracks",get:function(){var f=this.subtitleTrackController;return f?f.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var f=this.subtitleTrackController;return f?f.subtitleTrack:-1},set:function(f){var a=this.subtitleTrackController;a&&(a.subtitleTrack=f)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var f=this.subtitleTrackController;return f?f.subtitleDisplay:!1},set:function(f){var a=this.subtitleTrackController;a&&(a.subtitleDisplay=f)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(f){this.config.lowLatencyMode=f}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.3.1"}},{key:"Events",get:function(){return I.Events}},{key:"ErrorTypes",get:function(){return h.ErrorTypes}},{key:"ErrorDetails",get:function(){return h.ErrorDetails}},{key:"DefaultConfig",get:function(){return p.defaultConfig?p.defaultConfig:m.hlsDefaultConfig},set:function(f){p.defaultConfig=f}}]),p}();l.defaultConfig=void 0},"./src/is-supported.ts":(x,b,s)=>{s.r(b),s.d(b,{changeTypeSupported:()=>R,isSupported:()=>w});var C=s("./src/utils/mediasource-helper.ts");function g(){return self.SourceBuffer||self.WebKitSourceBuffer}function w(){var K=(0,C.getMediaSource)();if(!K)return!1;var k=g(),F=K&&typeof K.isTypeSupported=="function"&&K.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),B=!k||k.prototype&&typeof k.prototype.appendBuffer=="function"&&typeof k.prototype.remove=="function";return!!F&&!!B}function R(){var K,k=g();return typeof(k==null||(K=k.prototype)===null||K===void 0?void 0:K.changeType)=="function"}},"./src/loader/date-range.ts":(x,b,s)=>{s.r(b),s.d(b,{DateRange:()=>M,DateRangeAttribute:()=>P});var C=s("./src/polyfills/number.ts"),g=s("./src/utils/attr-list.ts"),w=s("./src/utils/logger.ts");function R(){return R=Object.assign?Object.assign.bind():function(m){for(var N=1;N<arguments.length;N++){var I=arguments[N];for(var h in I)Object.prototype.hasOwnProperty.call(I,h)&&(m[h]=I[h])}return m},R.apply(this,arguments)}function K(m,N){for(var I=0;I<N.length;I++){var h=N[I];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(m,F(h.key),h)}}function k(m,N,I){return N&&K(m.prototype,N),I&&K(m,I),Object.defineProperty(m,"prototype",{writable:!1}),m}function F(m){var N=B(m,"string");return typeof N=="symbol"?N:String(N)}function B(m,N){if(typeof m!="object"||m===null)return m;var I=m[Symbol.toPrimitive];if(I!==void 0){var h=I.call(m,N||"default");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(N==="string"?String:Number)(m)}var P;(function(m){m.ID="ID",m.CLASS="CLASS",m.START_DATE="START-DATE",m.DURATION="DURATION",m.END_DATE="END-DATE",m.END_ON_NEXT="END-ON-NEXT",m.PLANNED_DURATION="PLANNED-DURATION",m.SCTE35_OUT="SCTE35-OUT",m.SCTE35_IN="SCTE35-IN"})(P||(P={}));var M=function(){function m(N,I){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,I){var h=I.attr;for(var E in h)if(Object.prototype.hasOwnProperty.call(N,E)&&N[E]!==h[E]){w.logger.warn('DATERANGE tag attribute: "'+E+'" does not match for tags with ID: "'+N.ID+'"'),this._badValueForSameId=E;break}N=R(new g.AttrList({}),h,N)}if(this.attr=N,this._startDate=new Date(N[P.START_DATE]),P.END_DATE in this.attr){var d=new Date(this.attr[P.END_DATE]);(0,C.isFiniteNumber)(d.getTime())&&(this._endDate=d)}}return k(m,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var I=this.duration;return I!==null?new Date(this._startDate.getTime()+I*1e3):null}},{key:"duration",get:function(){if(P.DURATION in this.attr){var I=this.attr.decimalFloatingPoint(P.DURATION);if((0,C.isFiniteNumber)(I))return I}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return P.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(P.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(P.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,C.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),m}()},"./src/loader/fragment-loader.ts":(x,b,s)=>{s.r(b),s.d(b,{LoadError:()=>I,default:()=>m});var C=s("./src/polyfills/number.ts"),g=s("./src/errors.ts");function w(h,E){h.prototype=Object.create(E.prototype),h.prototype.constructor=h,B(h,E)}function R(h){var E=typeof Map=="function"?new Map:void 0;return R=function(c){if(c===null||!F(c))return c;if(typeof c!="function")throw new TypeError("Super expression must either be null or a function");if(typeof E<"u"){if(E.has(c))return E.get(c);E.set(c,S)}function S(){return K(c,arguments,P(this).constructor)}return S.prototype=Object.create(c.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}),B(S,c)},R(h)}function K(h,E,d){return k()?K=Reflect.construct.bind():K=function(S,v,l){var p=[null];p.push.apply(p,v);var y=Function.bind.apply(S,p),T=new y;return l&&B(T,l.prototype),T},K.apply(null,arguments)}function k(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function F(h){return Function.toString.call(h).indexOf("[native code]")!==-1}function B(h,E){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,S){return c.__proto__=S,c},B(h,E)}function P(h){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},P(h)}var M=Math.pow(2,17),m=function(){function h(d){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=d}var E=h.prototype;return E.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},E.abort=function(){this.loader&&this.loader.abort()},E.load=function(c,S){var v=this,l=c.url;if(!l)return Promise.reject(new I({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:c,networkDetails:null},"Fragment does not have a "+(l?"part list":"url")));this.abort();var p=this.config,y=p.fLoader,T=p.loader;return new Promise(function(f,a){v.loader&&v.loader.destroy();var _=v.loader=c.loader=y?new y(p):new T(p),o=N(c),A={timeout:p.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:p.fragLoadingMaxRetryTimeout,highWaterMark:c.sn==="initSegment"?1/0:M};c.stats=_.stats,_.load(o,A,{onSuccess:function(L,H,W,U){v.resetLoader(c,_);var G=L.data;W.resetIV&&c.decryptdata&&(c.decryptdata.iv=new Uint8Array(G.slice(0,16)),G=G.slice(16)),f({frag:c,part:null,payload:G,networkDetails:U})},onError:function(L,H,W){v.resetLoader(c,_),a(new I({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:c,response:L,networkDetails:W}))},onAbort:function(L,H,W){v.resetLoader(c,_),a(new I({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:c,networkDetails:W}))},onTimeout:function(L,H,W){v.resetLoader(c,_),a(new I({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:c,networkDetails:W}))},onProgress:function(L,H,W,U){S&&S({frag:c,part:null,payload:W,networkDetails:U})}})})},E.loadPart=function(c,S,v){var l=this;this.abort();var p=this.config,y=p.fLoader,T=p.loader;return new Promise(function(f,a){l.loader&&l.loader.destroy();var _=l.loader=c.loader=y?new y(p):new T(p),o=N(c,S),A={timeout:p.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:p.fragLoadingMaxRetryTimeout,highWaterMark:M};S.stats=_.stats,_.load(o,A,{onSuccess:function(L,H,W,U){l.resetLoader(c,_),l.updateStatsFromPart(c,S);var G={frag:c,part:S,payload:L.data,networkDetails:U};v(G),f(G)},onError:function(L,H,W){l.resetLoader(c,_),a(new I({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:c,part:S,response:L,networkDetails:W}))},onAbort:function(L,H,W){c.stats.aborted=S.stats.aborted,l.resetLoader(c,_),a(new I({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:c,part:S,networkDetails:W}))},onTimeout:function(L,H,W){l.resetLoader(c,_),a(new I({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:c,part:S,networkDetails:W}))}})})},E.updateStatsFromPart=function(c,S){var v=c.stats,l=S.stats,p=l.total;if(v.loaded+=l.loaded,p){var y=Math.round(c.duration/S.duration),T=Math.min(Math.round(v.loaded/p),y),f=y-T,a=f*Math.round(v.loaded/T);v.total=v.loaded+a}else v.total=Math.max(v.loaded,v.total);var _=v.loading,o=l.loading;_.start?_.first+=o.first-o.start:(_.start=o.start,_.first=o.first),_.end=o.end},E.resetLoader=function(c,S){c.loader=null,this.loader===S&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),S.destroy()},h}();function N(h,E){E===void 0&&(E=null);var d=E||h,c={frag:h,part:E,responseType:"arraybuffer",url:d.url,headers:{},rangeStart:0,rangeEnd:0},S=d.byteRangeStartOffset,v=d.byteRangeEndOffset;if((0,C.isFiniteNumber)(S)&&(0,C.isFiniteNumber)(v)){var l,p=S,y=v;if(h.sn==="initSegment"&&((l=h.decryptdata)===null||l===void 0?void 0:l.method)==="AES-128"){var T=v-S;T%16&&(y=v+(16-T%16)),S!==0&&(c.resetIV=!0,p=S-16)}c.rangeStart=p,c.rangeEnd=y}return c}var I=function(h){w(E,h);function E(d){for(var c,S=arguments.length,v=new Array(S>1?S-1:0),l=1;l<S;l++)v[l-1]=arguments[l];return c=h.call.apply(h,[this].concat(v))||this,c.data=void 0,c.data=d,c}return E}(R(Error))},"./src/loader/fragment.ts":(x,b,s)=>{s.r(b),s.d(b,{BaseSegment:()=>m,ElementaryStreamTypes:()=>M,Fragment:()=>N,Part:()=>I});var C=s("./src/polyfills/number.ts"),g=s("./node_modules/url-toolkit/src/url-toolkit.js"),w=s("./src/loader/load-stats.ts");function R(h,E){h.prototype=Object.create(E.prototype),h.prototype.constructor=h,K(h,E)}function K(h,E){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,S){return c.__proto__=S,c},K(h,E)}function k(h,E){for(var d=0;d<E.length;d++){var c=E[d];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(h,B(c.key),c)}}function F(h,E,d){return E&&k(h.prototype,E),d&&k(h,d),Object.defineProperty(h,"prototype",{writable:!1}),h}function B(h){var E=P(h,"string");return typeof E=="symbol"?E:String(E)}function P(h,E){if(typeof h!="object"||h===null)return h;var d=h[Symbol.toPrimitive];if(d!==void 0){var c=d.call(h,E||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(E==="string"?String:Number)(h)}var M;(function(h){h.AUDIO="audio",h.VIDEO="video",h.AUDIOVIDEO="audiovideo"})(M||(M={}));var m=function(){function h(d){var c;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(c={},c[M.AUDIO]=null,c[M.VIDEO]=null,c[M.AUDIOVIDEO]=null,c),this.baseurl=d}var E=h.prototype;return E.setByteRange=function(c,S){var v=c.split("@",2),l=[];v.length===1?l[0]=S?S.byteRangeEndOffset:0:l[0]=parseInt(v[1]),l[1]=parseInt(v[0])+l[0],this._byteRange=l},F(h,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,g.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(c){this._url=c}}]),h}(),N=function(h){R(E,h);function E(c,S){var v;return v=h.call(this,S)||this,v._decryptdata=null,v.rawProgramDateTime=null,v.programDateTime=null,v.tagList=[],v.duration=0,v.sn=0,v.levelkeys=void 0,v.type=void 0,v.loader=null,v.keyLoader=null,v.level=-1,v.cc=0,v.startPTS=void 0,v.endPTS=void 0,v.appendedPTS=void 0,v.startDTS=void 0,v.endDTS=void 0,v.start=0,v.deltaPTS=void 0,v.maxStartPTS=void 0,v.minEndPTS=void 0,v.stats=new w.LoadStats,v.urlId=0,v.data=void 0,v.bitrateTest=!1,v.title=null,v.initSegment=null,v.endList=void 0,v.type=c,v}var d=E.prototype;return d.setKeyFormat=function(S){if(this.levelkeys){var v=this.levelkeys[S];v&&!this._decryptdata&&(this._decryptdata=v.getDecryptData(this.sn))}},d.abortRequests=function(){var S,v;(S=this.loader)===null||S===void 0||S.abort(),(v=this.keyLoader)===null||v===void 0||v.abort()},d.setElementaryStreamInfo=function(S,v,l,p,y,T){T===void 0&&(T=!1);var f=this.elementaryStreams,a=f[S];if(!a){f[S]={startPTS:v,endPTS:l,startDTS:p,endDTS:y,partial:T};return}a.startPTS=Math.min(a.startPTS,v),a.endPTS=Math.max(a.endPTS,l),a.startDTS=Math.min(a.startDTS,p),a.endDTS=Math.max(a.endDTS,y)},d.clearElementaryStreamInfo=function(){var S=this.elementaryStreams;S[M.AUDIO]=null,S[M.VIDEO]=null,S[M.AUDIOVIDEO]=null},F(E,[{key:"decryptdata",get:function(){var S=this.levelkeys;if(!S&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var v=this.levelkeys.identity;if(v)this._decryptdata=v.getDecryptData(this.sn);else{var l=Object.keys(this.levelkeys);if(l.length===1)return this._decryptdata=this.levelkeys[l[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,C.isFiniteNumber)(this.programDateTime))return null;var S=(0,C.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+S*1e3}},{key:"encrypted",get:function(){var S;if((S=this._decryptdata)!==null&&S!==void 0&&S.encrypted)return!0;if(this.levelkeys){var v=Object.keys(this.levelkeys),l=v.length;if(l>1||l===1&&this.levelkeys[v[0]].encrypted)return!0}return!1}}]),E}(m),I=function(h){R(E,h);function E(d,c,S,v,l){var p;p=h.call(this,S)||this,p.fragOffset=0,p.duration=0,p.gap=!1,p.independent=!1,p.relurl=void 0,p.fragment=void 0,p.index=void 0,p.stats=new w.LoadStats,p.duration=d.decimalFloatingPoint("DURATION"),p.gap=d.bool("GAP"),p.independent=d.bool("INDEPENDENT"),p.relurl=d.enumeratedString("URI"),p.fragment=c,p.index=v;var y=d.enumeratedString("BYTERANGE");return y&&p.setByteRange(y,l),l&&(p.fragOffset=l.fragOffset+l.duration),p}return F(E,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var c=this.elementaryStreams;return!!(c.audio||c.video||c.audiovideo)}}]),E}(m)},"./src/loader/key-loader.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>w});var C=s("./src/errors.ts"),g=s("./src/loader/fragment-loader.ts"),w=function(){function R(k){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=k}var K=R.prototype;return K.abort=function(){for(var F in this.keyUriToKeyInfo){var B=this.keyUriToKeyInfo[F].loader;B&&B.abort()}},K.detach=function(){for(var F in this.keyUriToKeyInfo){var B=this.keyUriToKeyInfo[F];(B.mediaKeySessionContext||B.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[F]}},K.destroy=function(){this.detach();for(var F in this.keyUriToKeyInfo){var B=this.keyUriToKeyInfo[F].loader;B&&B.destroy()}this.keyUriToKeyInfo={}},K.createKeyLoadError=function(F,B,P,M){return B===void 0&&(B=C.ErrorDetails.KEY_LOAD_ERROR),new g.LoadError({type:C.ErrorTypes.NETWORK_ERROR,details:B,fatal:!1,frag:F,networkDetails:P})},K.loadClear=function(F,B){var P=this;if(this.emeController&&this.config.emeEnabled)for(var M=F.sn,m=F.cc,N=function(d){var c=B[d];if(m<=c.cc&&(M==="initSegment"||M<c.sn))return P.emeController.selectKeySystemFormat(c).then(function(S){c.setKeyFormat(S)}),"break"},I=0;I<B.length;I++){var h=N(I);if(h==="break")break}},K.load=function(F){var B=this;return!F.decryptdata&&F.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(F).then(function(P){return B.loadInternal(F,P)}):this.loadInternal(F)},K.loadInternal=function(F,B){var P,M;B&&F.setKeyFormat(B);var m=F.decryptdata;if(!m){var N=B?"Expected frag.decryptdata to be defined after setting format "+B:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(F,C.ErrorDetails.KEY_LOAD_ERROR,null,N))}var I=m.uri;if(!I)return Promise.reject(this.createKeyLoadError(F,C.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+I+'"'));var h=this.keyUriToKeyInfo[I];if((P=h)!==null&&P!==void 0&&P.decryptdata.key)return m.key=h.decryptdata.key,Promise.resolve({frag:F,keyInfo:h});if((M=h)!==null&&M!==void 0&&M.keyLoadPromise){var E;switch((E=h.mediaKeySessionContext)===null||E===void 0?void 0:E.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return h.keyLoadPromise}}switch(h=this.keyUriToKeyInfo[I]={decryptdata:m,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},m.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return m.keyFormat==="identity"?this.loadKeyHTTP(h,F):this.loadKeyEME(h,F);case"AES-128":return this.loadKeyHTTP(h,F);default:return Promise.reject(this.createKeyLoadError(F,C.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+m.method+'"'))}},K.loadKeyEME=function(F,B){var P={frag:B,keyInfo:F};if(this.emeController&&this.config.emeEnabled){var M=this.emeController.loadKey(P);if(M)return(F.keyLoadPromise=M.then(function(m){return F.mediaKeySessionContext=m,P})).catch(function(m){throw F.keyLoadPromise=null,m})}return Promise.resolve(P)},K.loadKeyHTTP=function(F,B){var P=this,M=this.config,m=M.loader,N=new m(M);return B.keyLoader=F.loader=N,F.keyLoadPromise=new Promise(function(I,h){var E={keyInfo:F,frag:B,responseType:"arraybuffer",url:F.decryptdata.uri},d={timeout:M.fragLoadingTimeOut,maxRetry:0,retryDelay:M.fragLoadingRetryDelay,maxRetryDelay:M.fragLoadingMaxRetryTimeout,highWaterMark:0},c={onSuccess:function(v,l,p,y){var T=p.frag,f=p.keyInfo,a=p.url;if(!T.decryptdata||f!==P.keyUriToKeyInfo[a])return h(P.createKeyLoadError(T,C.ErrorDetails.KEY_LOAD_ERROR,y,"after key load, decryptdata unset or changed"));f.decryptdata.key=T.decryptdata.key=new Uint8Array(v.data),T.keyLoader=null,f.loader=null,I({frag:T,keyInfo:f})},onError:function(v,l,p){P.resetLoader(l),h(P.createKeyLoadError(B,C.ErrorDetails.KEY_LOAD_ERROR,p))},onTimeout:function(v,l,p){P.resetLoader(l),h(P.createKeyLoadError(B,C.ErrorDetails.KEY_LOAD_TIMEOUT,p))},onAbort:function(v,l,p){P.resetLoader(l),h(P.createKeyLoadError(B,C.ErrorDetails.INTERNAL_ABORTED,p))}};N.load(E,d,c)})},K.resetLoader=function(F){var B=F.frag,P=F.keyInfo,M=F.url,m=P.loader;B.keyLoader===m&&(B.keyLoader=null,P.loader=null),delete this.keyUriToKeyInfo[M],m&&m.destroy()},R}()},"./src/loader/level-details.ts":(x,b,s)=>{s.r(b),s.d(b,{LevelDetails:()=>F});var C=s("./src/polyfills/number.ts");function g(B,P){for(var M=0;M<P.length;M++){var m=P[M];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(B,R(m.key),m)}}function w(B,P,M){return P&&g(B.prototype,P),M&&g(B,M),Object.defineProperty(B,"prototype",{writable:!1}),B}function R(B){var P=K(B,"string");return typeof P=="symbol"?P:String(P)}function K(B,P){if(typeof B!="object"||B===null)return B;var M=B[Symbol.toPrimitive];if(M!==void 0){var m=M.call(B,P||"default");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return(P==="string"?String:Number)(B)}var k=10,F=function(){function B(M){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=M}var P=B.prototype;return P.reloaded=function(m){if(!m){this.advanced=!0,this.updated=!0;return}var N=this.lastPartSn-m.lastPartSn,I=this.lastPartIndex-m.lastPartIndex;this.updated=this.endSN!==m.endSN||!!I||!!N,this.advanced=this.endSN>m.endSN||N>0||N===0&&I>0,this.updated||this.advanced?this.misses=Math.floor(m.misses*.6):this.misses=m.misses+1,this.availabilityDelay=m.availabilityDelay},w(B,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,C.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||k}},{key:"drift",get:function(){var m=this.driftEndTime-this.driftStartTime;if(m>0){var N=this.driftEnd-this.driftStart;return N*1e3/m}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var m;return(m=this.partList)!==null&&m!==void 0&&m.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var m;return(m=this.fragments)!==null&&m!==void 0&&m.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var m;return(m=this.partList)!==null&&m!==void 0&&m.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var m;return(m=this.partList)!==null&&m!==void 0&&m.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),B}()},"./src/loader/level-key.ts":(x,b,s)=>{s.r(b),s.d(b,{LevelKey:()=>F});var C=s("./src/utils/keysystem-util.ts"),g=s("./src/utils/mediakeys-helper.ts"),w=s("./src/utils/mp4-tools.ts"),R=s("./src/utils/logger.ts"),K=s("./src/utils/numeric-encoding-utils.ts"),k={},F=function(){P.clearKeyUriToKeyIdMap=function(){k={}};function P(m,N,I,h,E){h===void 0&&(h=[1]),E===void 0&&(E=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=m,this.uri=N,this.keyFormat=I,this.keyFormatVersions=h,this.iv=E,this.encrypted=m?m!=="NONE":!1,this.isCommonEncryption=this.encrypted&&m!=="AES-128"}var M=P.prototype;return M.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;switch(this.keyFormat){case"identity":return this.method==="SAMPLE-AES";case g.KeySystemFormats.FAIRPLAY:case g.KeySystemFormats.WIDEVINE:case g.KeySystemFormats.PLAYREADY:case g.KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},M.getDecryptData=function(N){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof N!="number"&&(this.method==="AES-128"&&!this.iv&&R.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),N=0);var I=B(N),h=new P(this.method,this.uri,"identity",this.keyFormatVersions,I);return h}var E=(0,C.convertDataUriToArrayBytes)(this.uri);if(E)switch(this.keyFormat){case g.KeySystemFormats.WIDEVINE:this.pssh=E,E.length>=22&&(this.keyId=E.subarray(E.length-22,E.length-6));break;case g.KeySystemFormats.PLAYREADY:{var d=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,w.mp4pssh)(d,null,E);var c=new Uint16Array(E.buffer,E.byteOffset,E.byteLength/2),S=String.fromCharCode.apply(null,Array.from(c)),v=S.substring(S.indexOf("<"),S.length),l=new DOMParser,p=l.parseFromString(v,"text/xml"),y=p.getElementsByTagName("KID")[0];if(y){var T=y.childNodes[0]?y.childNodes[0].nodeValue:y.getAttribute("VALUE");if(T){var f=(0,K.base64Decode)(T).subarray(0,16);(0,C.changeEndianness)(f),this.keyId=f}}break}default:{var a=E.subarray(0,16);if(a.length!==16){var _=new Uint8Array(16);_.set(a,16-a.length),a=_}this.keyId=a;break}}if(!this.keyId||this.keyId.byteLength!==16){var o=k[this.uri];if(!o){var A=Object.keys(k).length%Number.MAX_SAFE_INTEGER;o=new Uint8Array(16);var O=new DataView(o.buffer,12,4);O.setUint32(0,A),k[this.uri]=o}this.keyId=o}return this},P}();function B(P){for(var M=new Uint8Array(16),m=12;m<16;m++)M[m]=P>>8*(15-m)&255;return M}},"./src/loader/load-stats.ts":(x,b,s)=>{s.r(b),s.d(b,{LoadStats:()=>C});var C=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>E});var C=s("./src/polyfills/number.ts"),g=s("./node_modules/url-toolkit/src/url-toolkit.js"),w=s("./src/loader/date-range.ts"),R=s("./src/loader/fragment.ts"),K=s("./src/loader/level-details.ts"),k=s("./src/loader/level-key.ts"),F=s("./src/utils/attr-list.ts"),B=s("./src/utils/logger.ts"),P=s("./src/utils/codecs.ts");function M(){return M=Object.assign?Object.assign.bind():function(y){for(var T=1;T<arguments.length;T++){var f=arguments[T];for(var a in f)Object.prototype.hasOwnProperty.call(f,a)&&(y[a]=f[a])}return y},M.apply(this,arguments)}var m=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,N=/#EXT-X-MEDIA:(.*)/g,I=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),h=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),E=function(){function y(){}return y.findGroup=function(f,a){for(var _=0;_<f.length;_++){var o=f[_];if(o.id===a)return o}},y.convertAVC1ToAVCOTI=function(f){var a=f.split(".");if(a.length>2){var _=a.shift()+".";return _+=parseInt(a.shift()).toString(16),_+=("000"+parseInt(a.shift()).toString(16)).slice(-4),_}return f},y.resolve=function(f,a){return(0,g.buildAbsoluteURL)(a,f,{alwaysNormalize:!0})},y.parseMasterPlaylist=function(f,a){var _=[],o=[],A={},O=[],L=!1;m.lastIndex=0;for(var H;(H=m.exec(f))!=null;)if(H[1]){var W,U=new F.AttrList(H[1]),G={attrs:U,bitrate:U.decimalInteger("AVERAGE-BANDWIDTH")||U.decimalInteger("BANDWIDTH"),name:U.NAME,url:y.resolve(H[2],a)},Y=U.decimalResolution("RESOLUTION");Y&&(G.width=Y.width,G.height=Y.height),c((U.CODECS||"").split(/[ ,]+/).filter(function(V){return V}),G),G.videoCodec&&G.videoCodec.indexOf("avc1")!==-1&&(G.videoCodec=y.convertAVC1ToAVCOTI(G.videoCodec)),(W=G.unknownCodecs)!==null&&W!==void 0&&W.length||o.push(G),_.push(G)}else if(H[3]){var j=new F.AttrList(H[3]);j["DATA-ID"]&&(L=!0,A[j["DATA-ID"]]=j)}else if(H[4]){var X=H[4],q=d(X,a);q.encrypted&&q.isSupported()?O.push(q):B.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+X+'"')}var J=o.length>0&&o.length<_.length;return{levels:J?o:_,sessionData:L?A:null,sessionKeys:O.length?O:null}},y.parseMasterPlaylistMedia=function(f,a,_,o){o===void 0&&(o=[]);var A,O=[],L=0;for(N.lastIndex=0;(A=N.exec(f))!==null;){var H=new F.AttrList(A[1]);if(H.TYPE===_){var W={attrs:H,bitrate:0,id:L++,groupId:H["GROUP-ID"],instreamId:H["INSTREAM-ID"],name:H.NAME||H.LANGUAGE||"",type:_,default:H.bool("DEFAULT"),autoselect:H.bool("AUTOSELECT"),forced:H.bool("FORCED"),lang:H.LANGUAGE,url:H.URI?y.resolve(H.URI,a):""};if(o.length){var U=y.findGroup(o,W.groupId)||o[0];S(W,U,"audioCodec"),S(W,U,"textCodec")}O.push(W)}}return O},y.parseLevelPlaylist=function(f,a,_,o,A){var O=new K.LevelDetails(a),L=O.fragments,H=null,W=0,U=0,G=0,Y=0,j=null,X=new R.Fragment(o,a),q,J,V,$=-1,ee=!1;for(I.lastIndex=0,O.m3u8=f;(q=I.exec(f))!==null;){ee&&(ee=!1,X=new R.Fragment(o,a),X.start=G,X.sn=W,X.cc=Y,X.level=_,H&&(X.initSegment=H,X.rawProgramDateTime=H.rawProgramDateTime,H.rawProgramDateTime=null));var Z=q[1];if(Z){X.duration=parseFloat(Z);var re=(" "+q[2]).slice(1);X.title=re||null,X.tagList.push(re?["INF",Z,re]:["INF",Z])}else if(q[3]){if((0,C.isFiniteNumber)(X.duration)){if(X.start=G,V){X.levelkeys=V;var ae=O.encryptedFragments;X.levelkeys&&Object.keys(X.levelkeys).some(function(Et){return X.levelkeys[Et].isCommonEncryption})&&(!ae.length||ae[ae.length-1].levelkeys!==V)&&ae.push(X)}X.sn=W,X.level=_,X.cc=Y,X.urlId=A,L.push(X),X.relurl=(" "+q[3]).slice(1),l(X,j),j=X,G+=X.duration,W++,U=0,ee=!0}}else if(q[4]){var le=(" "+q[4]).slice(1);j?X.setByteRange(le,j):X.setByteRange(le)}else if(q[5])X.rawProgramDateTime=(" "+q[5]).slice(1),X.tagList.push(["PROGRAM-DATE-TIME",X.rawProgramDateTime]),$===-1&&($=L.length);else{if(q=q[0].match(h),!q){B.logger.warn("No matches on slow regex match for level playlist!");continue}for(J=1;J<q.length&&!(typeof q[J]<"u");J++);var ne=(" "+q[J]).slice(1),ie=(" "+q[J+1]).slice(1),oe=q[J+2]?(" "+q[J+2]).slice(1):"";switch(ne){case"PLAYLIST-TYPE":O.type=ie.toUpperCase();break;case"MEDIA-SEQUENCE":W=O.startSN=parseInt(ie);break;case"SKIP":{var ge=new F.AttrList(ie),he=ge.decimalInteger("SKIPPED-SEGMENTS");if((0,C.isFiniteNumber)(he)){O.skippedSegments=he;for(var me=he;me--;)L.unshift(null);W+=he}var Ee=ge.enumeratedString("RECENTLY-REMOVED-DATERANGES");Ee&&(O.recentlyRemovedDateranges=Ee.split("	"));break}case"TARGETDURATION":O.targetduration=parseFloat(ie);break;case"VERSION":O.version=parseInt(ie);break;case"EXTM3U":break;case"ENDLIST":O.live=!1;break;case"#":(ie||oe)&&X.tagList.push(oe?[ie,oe]:[ie]);break;case"DISCONTINUITY":Y++,X.tagList.push(["DIS"]);break;case"GAP":X.tagList.push([ne]);break;case"BITRATE":X.tagList.push([ne,ie]);break;case"DATERANGE":{var pe=new F.AttrList(ie),Te=new w.DateRange(pe,O.dateRanges[pe.ID]);Te.isValid||O.skippedSegments?O.dateRanges[Te.id]=Te:B.logger.warn('Ignoring invalid DATERANGE tag: "'+ie+'"'),X.tagList.push(["EXT-X-DATERANGE",ie]);break}case"DISCONTINUITY-SEQUENCE":Y=parseInt(ie);break;case"KEY":{var _e=d(ie,a);if(_e.isSupported()){if(_e.method==="NONE"){V=void 0;break}V||(V={}),V[_e.keyFormat]&&(V=M({},V)),V[_e.keyFormat]=_e}else B.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+ie+'"');break}case"START":{var ye=new F.AttrList(ie),De=ye.decimalFloatingPoint("TIME-OFFSET");(0,C.isFiniteNumber)(De)&&(O.startTimeOffset=De);break}case"MAP":{var Be=new F.AttrList(ie);if(X.duration){var He=new R.Fragment(o,a);p(He,Be,_,V),H=He,X.initSegment=H,H.rawProgramDateTime&&!X.rawProgramDateTime&&(X.rawProgramDateTime=H.rawProgramDateTime)}else p(X,Be,_,V),H=X,ee=!0;break}case"SERVER-CONTROL":{var Ke=new F.AttrList(ie);O.canBlockReload=Ke.bool("CAN-BLOCK-RELOAD"),O.canSkipUntil=Ke.optionalFloat("CAN-SKIP-UNTIL",0),O.canSkipDateRanges=O.canSkipUntil>0&&Ke.bool("CAN-SKIP-DATERANGES"),O.partHoldBack=Ke.optionalFloat("PART-HOLD-BACK",0),O.holdBack=Ke.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var ct=new F.AttrList(ie);O.partTarget=ct.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Me=O.partList;Me||(Me=O.partList=[]);var Ge=U>0?Me[Me.length-1]:void 0,rt=U++,ht=new R.Part(new F.AttrList(ie),X,a,rt,Ge);Me.push(ht),X.duration+=ht.duration;break}case"PRELOAD-HINT":{var gt=new F.AttrList(ie);O.preloadHint=gt;break}case"RENDITION-REPORT":{var ze=new F.AttrList(ie);O.renditionReports=O.renditionReports||[],O.renditionReports.push(ze);break}default:B.logger.warn("line parsed but not handled: "+q);break}}}j&&!j.relurl?(L.pop(),G-=j.duration,O.partList&&(O.fragmentHint=j)):O.partList&&(l(X,j),X.cc=Y,O.fragmentHint=X);var $e=L.length,mt=L[0],_t=L[$e-1];if(G+=O.skippedSegments*O.targetduration,G>0&&$e&&_t){O.averagetargetduration=G/$e;var Ye=_t.sn;O.endSN=Ye!=="initSegment"?Ye:0,O.live||(_t.endList=!0),mt&&(O.startCC=mt.cc)}else O.endSN=0,O.startCC=0;return O.fragmentHint&&(G+=O.fragmentHint.duration),O.totalduration=G,O.endCC=Y,$>0&&v(L,$),O},y}();function d(y,T){var f,a,_=new F.AttrList(y),o=(f=_.enumeratedString("METHOD"))!=null?f:"",A=_.URI,O=_.hexadecimalInteger("IV"),L=_.enumeratedString("KEYFORMATVERSIONS"),H=(a=_.enumeratedString("KEYFORMAT"))!=null?a:"identity";A&&_.IV&&!O&&B.logger.error("Invalid IV: "+_.IV);var W=A?E.resolve(A,T):"",U=(L||"1").split("/").map(Number).filter(Number.isFinite);return new k.LevelKey(o,W,H,U,O)}function c(y,T){["video","audio","text"].forEach(function(f){var a=y.filter(function(o){return(0,P.isCodecType)(o,f)});if(a.length){var _=a.filter(function(o){return o.lastIndexOf("avc1",0)===0||o.lastIndexOf("mp4a",0)===0});T[f+"Codec"]=_.length>0?_[0]:a[0],y=y.filter(function(o){return a.indexOf(o)===-1})}}),T.unknownCodecs=y}function S(y,T,f){var a=T[f];a&&(y[f]=a)}function v(y,T){for(var f=y[T],a=T;a--;){var _=y[a];if(!_)return;_.programDateTime=f.programDateTime-_.duration*1e3,f=_}}function l(y,T){y.rawProgramDateTime?y.programDateTime=Date.parse(y.rawProgramDateTime):T!=null&&T.programDateTime&&(y.programDateTime=T.endProgramDateTime),(0,C.isFiniteNumber)(y.programDateTime)||(y.programDateTime=null,y.rawProgramDateTime=null)}function p(y,T,f,a){y.relurl=T.URI,T.BYTERANGE&&y.setByteRange(T.BYTERANGE),y.level=f,y.sn="initSegment",a&&(y.levelkeys=a),y.initSegment=null}},"./src/loader/playlist-loader.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>m});var C=s("./src/polyfills/number.ts"),g=s("./src/events.ts"),w=s("./src/errors.ts"),R=s("./src/utils/logger.ts"),K=s("./src/loader/m3u8-parser.ts"),k=s("./src/types/loader.ts"),F=s("./src/utils/attr-list.ts");function B(N){var I=N.type;switch(I){case k.PlaylistContextType.AUDIO_TRACK:return k.PlaylistLevelType.AUDIO;case k.PlaylistContextType.SUBTITLE_TRACK:return k.PlaylistLevelType.SUBTITLE;default:return k.PlaylistLevelType.MAIN}}function P(N,I){var h=N.url;return(h===void 0||h.indexOf("data:")===0)&&(h=I.url),h}var M=function(){function N(h){this.hls=void 0,this.loaders=Object.create(null),this.hls=h,this.registerListeners()}var I=N.prototype;return I.startLoad=function(E){},I.stopLoad=function(){this.destroyInternalLoaders()},I.registerListeners=function(){var E=this.hls;E.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.on(g.Events.LEVEL_LOADING,this.onLevelLoading,this),E.on(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),E.on(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},I.unregisterListeners=function(){var E=this.hls;E.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.off(g.Events.LEVEL_LOADING,this.onLevelLoading,this),E.off(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),E.off(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},I.createInternalLoader=function(E){var d=this.hls.config,c=d.pLoader,S=d.loader,v=c||S,l=new v(d);return E.loader=l,this.loaders[E.type]=l,l},I.getInternalLoader=function(E){return this.loaders[E.type]},I.resetInternalLoader=function(E){this.loaders[E]&&delete this.loaders[E]},I.destroyInternalLoaders=function(){for(var E in this.loaders){var d=this.loaders[E];d&&d.destroy(),this.resetInternalLoader(E)}},I.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},I.onManifestLoading=function(E,d){var c=d.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:k.PlaylistContextType.MANIFEST,url:c,deliveryDirectives:null})},I.onLevelLoading=function(E,d){var c=d.id,S=d.level,v=d.url,l=d.deliveryDirectives;this.load({id:c,groupId:null,level:S,responseType:"text",type:k.PlaylistContextType.LEVEL,url:v,deliveryDirectives:l})},I.onAudioTrackLoading=function(E,d){var c=d.id,S=d.groupId,v=d.url,l=d.deliveryDirectives;this.load({id:c,groupId:S,level:null,responseType:"text",type:k.PlaylistContextType.AUDIO_TRACK,url:v,deliveryDirectives:l})},I.onSubtitleTrackLoading=function(E,d){var c=d.id,S=d.groupId,v=d.url,l=d.deliveryDirectives;this.load({id:c,groupId:S,level:null,responseType:"text",type:k.PlaylistContextType.SUBTITLE_TRACK,url:v,deliveryDirectives:l})},I.load=function(E){var d,c=this.hls.config,S=this.getInternalLoader(E);if(S){var v=S.context;if(v&&v.url===E.url){R.logger.trace("[playlist-loader]: playlist request ongoing");return}R.logger.log("[playlist-loader]: aborting previous loader for type: "+E.type),S.abort()}var l,p,y,T;switch(E.type){case k.PlaylistContextType.MANIFEST:l=c.manifestLoadingMaxRetry,p=c.manifestLoadingTimeOut,y=c.manifestLoadingRetryDelay,T=c.manifestLoadingMaxRetryTimeout;break;case k.PlaylistContextType.LEVEL:case k.PlaylistContextType.AUDIO_TRACK:case k.PlaylistContextType.SUBTITLE_TRACK:l=0,p=c.levelLoadingTimeOut;break;default:l=c.levelLoadingMaxRetry,p=c.levelLoadingTimeOut,y=c.levelLoadingRetryDelay,T=c.levelLoadingMaxRetryTimeout;break}if(S=this.createInternalLoader(E),(d=E.deliveryDirectives)!==null&&d!==void 0&&d.part){var f;if(E.type===k.PlaylistContextType.LEVEL&&E.level!==null?f=this.hls.levels[E.level].details:E.type===k.PlaylistContextType.AUDIO_TRACK&&E.id!==null?f=this.hls.audioTracks[E.id].details:E.type===k.PlaylistContextType.SUBTITLE_TRACK&&E.id!==null&&(f=this.hls.subtitleTracks[E.id].details),f){var a=f.partTarget,_=f.targetduration;a&&_&&(p=Math.min(Math.max(a*3,_*.8)*1e3,p))}}var o={timeout:p,maxRetry:l,retryDelay:y,maxRetryDelay:T,highWaterMark:0},A={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};S.load(E,o,A)},I.loadsuccess=function(E,d,c,S){S===void 0&&(S=null),this.resetInternalLoader(c.type);var v=E.data;if(v.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(E,c,"no EXTM3U delimiter",S);return}d.parsing.start=performance.now(),v.indexOf("#EXTINF:")>0||v.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(E,d,c,S):this.handleMasterPlaylist(E,d,c,S)},I.loaderror=function(E,d,c){c===void 0&&(c=null),this.handleNetworkError(d,c,!1,E)},I.loadtimeout=function(E,d,c){c===void 0&&(c=null),this.handleNetworkError(d,c,!0)},I.handleMasterPlaylist=function(E,d,c,S){var v=this.hls,l=E.data,p=P(E,c),y=K.default.parseMasterPlaylist(l,p),T=y.levels,f=y.sessionData,a=y.sessionKeys;if(!T.length){this.handleManifestParsingError(E,c,"no level found in manifest",S);return}var _=T.map(function(W){return{id:W.attrs.AUDIO,audioCodec:W.audioCodec}}),o=T.map(function(W){return{id:W.attrs.SUBTITLES,textCodec:W.textCodec}}),A=K.default.parseMasterPlaylistMedia(l,p,"AUDIO",_),O=K.default.parseMasterPlaylistMedia(l,p,"SUBTITLES",o),L=K.default.parseMasterPlaylistMedia(l,p,"CLOSED-CAPTIONS");if(A.length){var H=A.some(function(W){return!W.url});!H&&T[0].audioCodec&&!T[0].attrs.AUDIO&&(R.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),A.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new F.AttrList({}),bitrate:0,url:""}))}v.trigger(g.Events.MANIFEST_LOADED,{levels:T,audioTracks:A,subtitles:O,captions:L,url:p,stats:d,networkDetails:S,sessionData:f,sessionKeys:a})},I.handleTrackOrLevelPlaylist=function(E,d,c,S){var v=this.hls,l=c.id,p=c.level,y=c.type,T=P(E,c),f=(0,C.isFiniteNumber)(l)?l:0,a=(0,C.isFiniteNumber)(p)?p:f,_=B(c),o=K.default.parseLevelPlaylist(E.data,T,a,_,f);if(!o.fragments.length){v.trigger(g.Events.ERROR,{type:w.ErrorTypes.NETWORK_ERROR,details:w.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:T,reason:"no fragments found in level",level:typeof c.level=="number"?c.level:void 0});return}if(y===k.PlaylistContextType.MANIFEST){var A={attrs:new F.AttrList({}),bitrate:0,details:o,name:"",url:T};v.trigger(g.Events.MANIFEST_LOADED,{levels:[A],audioTracks:[],url:T,stats:d,networkDetails:S,sessionData:null,sessionKeys:null})}d.parsing.end=performance.now(),c.levelDetails=o,this.handlePlaylistLoaded(E,d,c,S)},I.handleManifestParsingError=function(E,d,c,S){this.hls.trigger(g.Events.ERROR,{type:w.ErrorTypes.NETWORK_ERROR,details:w.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:d.type===k.PlaylistContextType.MANIFEST,url:E.url,reason:c,response:E,context:d,networkDetails:S})},I.handleNetworkError=function(E,d,c,S){c===void 0&&(c=!1),R.logger.warn("[playlist-loader]: A network "+(c?"timeout":"error")+" occurred while loading "+E.type+" level: "+E.level+" id: "+E.id+' group-id: "'+E.groupId+'"');var v=w.ErrorDetails.UNKNOWN,l=!1,p=this.getInternalLoader(E);switch(E.type){case k.PlaylistContextType.MANIFEST:v=c?w.ErrorDetails.MANIFEST_LOAD_TIMEOUT:w.ErrorDetails.MANIFEST_LOAD_ERROR,l=!0;break;case k.PlaylistContextType.LEVEL:v=c?w.ErrorDetails.LEVEL_LOAD_TIMEOUT:w.ErrorDetails.LEVEL_LOAD_ERROR,l=!1;break;case k.PlaylistContextType.AUDIO_TRACK:v=c?w.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:w.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case k.PlaylistContextType.SUBTITLE_TRACK:v=c?w.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:w.ErrorDetails.SUBTITLE_LOAD_ERROR,l=!1;break}p&&this.resetInternalLoader(E.type);var y={type:w.ErrorTypes.NETWORK_ERROR,details:v,fatal:l,url:E.url,loader:p,context:E,networkDetails:d};S&&(y.response=S),this.hls.trigger(g.Events.ERROR,y)},I.handlePlaylistLoaded=function(E,d,c,S){var v=c.type,l=c.level,p=c.id,y=c.groupId,T=c.loader,f=c.levelDetails,a=c.deliveryDirectives;if(!(f!=null&&f.targetduration)){this.handleManifestParsingError(E,c,"invalid target duration",S);return}if(T)switch(f.live&&(T.getCacheAge&&(f.ageHeader=T.getCacheAge()||0),(!T.getCacheAge||isNaN(f.ageHeader))&&(f.ageHeader=0)),v){case k.PlaylistContextType.MANIFEST:case k.PlaylistContextType.LEVEL:this.hls.trigger(g.Events.LEVEL_LOADED,{details:f,level:l||0,id:p||0,stats:d,networkDetails:S,deliveryDirectives:a});break;case k.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(g.Events.AUDIO_TRACK_LOADED,{details:f,id:p||0,groupId:y||"",stats:d,networkDetails:S,deliveryDirectives:a});break;case k.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(g.Events.SUBTITLE_TRACK_LOADED,{details:f,id:p||0,groupId:y||"",stats:d,networkDetails:S,deliveryDirectives:a});break}},N}();const m=M},"./src/polyfills/number.ts":(x,b,s)=>{s.r(b),s.d(b,{MAX_SAFE_INTEGER:()=>g,isFiniteNumber:()=>C});var C=Number.isFinite||function(w){return typeof w=="number"&&isFinite(w)},g=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>g});var C=function(){function w(){}return w.getSilentFrame=function(K,k){switch(K){case"mp4a.40.2":if(k===1)return new Uint8Array([0,200,0,128,35,128]);if(k===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(k===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(k===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(k===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(k===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(k===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},w}();const g=C},"./src/remux/mp4-generator.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>w});var C=Math.pow(2,32)-1,g=function(){function R(){}return R.init=function(){R.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var k;for(k in R.types)R.types.hasOwnProperty(k)&&(R.types[k]=[k.charCodeAt(0),k.charCodeAt(1),k.charCodeAt(2),k.charCodeAt(3)]);var F=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),B=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);R.HDLR_TYPES={video:F,audio:B};var P=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),M=new Uint8Array([0,0,0,0,0,0,0,0]);R.STTS=R.STSC=R.STCO=M,R.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),R.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),R.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),R.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var m=new Uint8Array([105,115,111,109]),N=new Uint8Array([97,118,99,49]),I=new Uint8Array([0,0,0,1]);R.FTYP=R.box(R.types.ftyp,m,I,m,N),R.DINF=R.box(R.types.dinf,R.box(R.types.dref,P))},R.box=function(k){for(var F=8,B=arguments.length,P=new Array(B>1?B-1:0),M=1;M<B;M++)P[M-1]=arguments[M];for(var m=P.length,N=m;m--;)F+=P[m].byteLength;var I=new Uint8Array(F);for(I[0]=F>>24&255,I[1]=F>>16&255,I[2]=F>>8&255,I[3]=F&255,I.set(k,4),m=0,F=8;m<N;m++)I.set(P[m],F),F+=P[m].byteLength;return I},R.hdlr=function(k){return R.box(R.types.hdlr,R.HDLR_TYPES[k])},R.mdat=function(k){return R.box(R.types.mdat,k)},R.mdhd=function(k,F){F*=k;var B=Math.floor(F/(C+1)),P=Math.floor(F%(C+1));return R.box(R.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,k&255,B>>24,B>>16&255,B>>8&255,B&255,P>>24,P>>16&255,P>>8&255,P&255,85,196,0,0]))},R.mdia=function(k){return R.box(R.types.mdia,R.mdhd(k.timescale,k.duration),R.hdlr(k.type),R.minf(k))},R.mfhd=function(k){return R.box(R.types.mfhd,new Uint8Array([0,0,0,0,k>>24,k>>16&255,k>>8&255,k&255]))},R.minf=function(k){return k.type==="audio"?R.box(R.types.minf,R.box(R.types.smhd,R.SMHD),R.DINF,R.stbl(k)):R.box(R.types.minf,R.box(R.types.vmhd,R.VMHD),R.DINF,R.stbl(k))},R.moof=function(k,F,B){return R.box(R.types.moof,R.mfhd(k),R.traf(B,F))},R.moov=function(k){for(var F=k.length,B=[];F--;)B[F]=R.trak(k[F]);return R.box.apply(null,[R.types.moov,R.mvhd(k[0].timescale,k[0].duration)].concat(B).concat(R.mvex(k)))},R.mvex=function(k){for(var F=k.length,B=[];F--;)B[F]=R.trex(k[F]);return R.box.apply(null,[R.types.mvex].concat(B))},R.mvhd=function(k,F){F*=k;var B=Math.floor(F/(C+1)),P=Math.floor(F%(C+1)),M=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,k&255,B>>24,B>>16&255,B>>8&255,B&255,P>>24,P>>16&255,P>>8&255,P&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return R.box(R.types.mvhd,M)},R.sdtp=function(k){var F=k.samples||[],B=new Uint8Array(4+F.length),P,M;for(P=0;P<F.length;P++)M=F[P].flags,B[P+4]=M.dependsOn<<4|M.isDependedOn<<2|M.hasRedundancy;return R.box(R.types.sdtp,B)},R.stbl=function(k){return R.box(R.types.stbl,R.stsd(k),R.box(R.types.stts,R.STTS),R.box(R.types.stsc,R.STSC),R.box(R.types.stsz,R.STSZ),R.box(R.types.stco,R.STCO))},R.avc1=function(k){var F=[],B=[],P,M,m;for(P=0;P<k.sps.length;P++)M=k.sps[P],m=M.byteLength,F.push(m>>>8&255),F.push(m&255),F=F.concat(Array.prototype.slice.call(M));for(P=0;P<k.pps.length;P++)M=k.pps[P],m=M.byteLength,B.push(m>>>8&255),B.push(m&255),B=B.concat(Array.prototype.slice.call(M));var N=R.box(R.types.avcC,new Uint8Array([1,F[3],F[4],F[5],255,224|k.sps.length].concat(F).concat([k.pps.length]).concat(B))),I=k.width,h=k.height,E=k.pixelRatio[0],d=k.pixelRatio[1];return R.box(R.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,I>>8&255,I&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),N,R.box(R.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),R.box(R.types.pasp,new Uint8Array([E>>24,E>>16&255,E>>8&255,E&255,d>>24,d>>16&255,d>>8&255,d&255])))},R.esds=function(k){var F=k.config.length;return new Uint8Array([0,0,0,0,3,23+F,0,1,0,4,15+F,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([F]).concat(k.config).concat([6,1,2]))},R.mp4a=function(k){var F=k.samplerate;return R.box(R.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,F>>8&255,F&255,0,0]),R.box(R.types.esds,R.esds(k)))},R.mp3=function(k){var F=k.samplerate;return R.box(R.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,F>>8&255,F&255,0,0]))},R.stsd=function(k){return k.type==="audio"?k.segmentCodec==="mp3"&&k.codec==="mp3"?R.box(R.types.stsd,R.STSD,R.mp3(k)):R.box(R.types.stsd,R.STSD,R.mp4a(k)):R.box(R.types.stsd,R.STSD,R.avc1(k))},R.tkhd=function(k){var F=k.id,B=k.duration*k.timescale,P=k.width,M=k.height,m=Math.floor(B/(C+1)),N=Math.floor(B%(C+1));return R.box(R.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,F>>24&255,F>>16&255,F>>8&255,F&255,0,0,0,0,m>>24,m>>16&255,m>>8&255,m&255,N>>24,N>>16&255,N>>8&255,N&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,P>>8&255,P&255,0,0,M>>8&255,M&255,0,0]))},R.traf=function(k,F){var B=R.sdtp(k),P=k.id,M=Math.floor(F/(C+1)),m=Math.floor(F%(C+1));return R.box(R.types.traf,R.box(R.types.tfhd,new Uint8Array([0,0,0,0,P>>24,P>>16&255,P>>8&255,P&255])),R.box(R.types.tfdt,new Uint8Array([1,0,0,0,M>>24,M>>16&255,M>>8&255,M&255,m>>24,m>>16&255,m>>8&255,m&255])),R.trun(k,B.length+16+20+8+16+8+8),B)},R.trak=function(k){return k.duration=k.duration||4294967295,R.box(R.types.trak,R.tkhd(k),R.mdia(k))},R.trex=function(k){var F=k.id;return R.box(R.types.trex,new Uint8Array([0,0,0,0,F>>24,F>>16&255,F>>8&255,F&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},R.trun=function(k,F){var B=k.samples||[],P=B.length,M=12+16*P,m=new Uint8Array(M),N,I,h,E,d,c;for(F+=8+M,m.set([k.type==="video"?1:0,0,15,1,P>>>24&255,P>>>16&255,P>>>8&255,P&255,F>>>24&255,F>>>16&255,F>>>8&255,F&255],0),N=0;N<P;N++)I=B[N],h=I.duration,E=I.size,d=I.flags,c=I.cts,m.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,E>>>24&255,E>>>16&255,E>>>8&255,E&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&240<<8,d.degradPrio&15,c>>>24&255,c>>>16&255,c>>>8&255,c&255],12+16*N);return R.box(R.types.trun,m)},R.initSegment=function(k){R.types||R.init();var F=R.moov(k),B=new Uint8Array(R.FTYP.byteLength+F.byteLength);return B.set(R.FTYP),B.set(F,R.FTYP.byteLength),B},R}();g.types=void 0,g.HDLR_TYPES=void 0,g.STTS=void 0,g.STSC=void 0,g.STCO=void 0,g.STSZ=void 0,g.VMHD=void 0,g.SMHD=void 0,g.STSD=void 0,g.FTYP=void 0,g.DINF=void 0;const w=g},"./src/remux/mp4-remuxer.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>E,flushTextTrackMetadataCueSamples:()=>S,flushTextTrackUserdataCueSamples:()=>v,normalizePts:()=>d});var C=s("./src/polyfills/number.ts"),g=s("./src/remux/aac-helper.ts"),w=s("./src/remux/mp4-generator.ts"),R=s("./src/events.ts"),K=s("./src/errors.ts"),k=s("./src/utils/logger.ts"),F=s("./src/types/loader.ts"),B=s("./src/utils/timescale-conversion.ts");function P(){return P=Object.assign?Object.assign.bind():function(y){for(var T=1;T<arguments.length;T++){var f=arguments[T];for(var a in f)Object.prototype.hasOwnProperty.call(f,a)&&(y[a]=f[a])}return y},P.apply(this,arguments)}var M=10*1e3,m=1024,N=1152,I=null,h=null,E=function(){function y(f,a,_,o){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=f,this.config=a,this.typeSupported=_,this.ISGenerated=!1,I===null){var A=navigator.userAgent||"",O=A.match(/Chrome\/(\d+)/i);I=O?parseInt(O[1]):0}if(h===null){var L=navigator.userAgent.match(/Safari\/(\d+)/i);h=L?parseInt(L[1]):0}}var T=y.prototype;return T.destroy=function(){},T.resetTimeStamp=function(a){k.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=a},T.resetNextTimestamp=function(){k.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},T.resetInitSegment=function(){k.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},T.getVideoStartPts=function(a){var _=!1,o=a.reduce(function(A,O){var L=O.pts-A;return L<-4294967296?(_=!0,d(A,O.pts)):L>0?A:O.pts},a[0].pts);return _&&k.logger.debug("PTS rollover detected"),o},T.remux=function(a,_,o,A,O,L,H,W){var U,G,Y,j,X,q,J=O,V=O,$=a.pid>-1,ee=_.pid>-1,Z=_.samples.length,re=a.samples.length>0,ae=H&&Z>0||Z>1,le=(!$||re)&&(!ee||ae)||this.ISGenerated||H;if(le){this.ISGenerated||(Y=this.generateIS(a,_,O));var ne=this.isVideoContiguous,ie=-1,oe;if(ae&&(ie=c(_.samples),!ne&&this.config.forceKeyFrameOnDiscontinuity))if(q=!0,ie>0){k.logger.warn("[mp4-remuxer]: Dropped "+ie+" out of "+Z+" video samples due to a missing keyframe");var ge=this.getVideoStartPts(_.samples);_.samples=_.samples.slice(ie),_.dropped+=ie,V+=(_.samples[0].pts-ge)/_.inputTimeScale,oe=V}else ie===-1&&(k.logger.warn("[mp4-remuxer]: No keyframe found out of "+Z+" video samples"),q=!1);if(this.ISGenerated){if(re&&ae){var he=this.getVideoStartPts(_.samples),me=d(a.samples[0].pts,he)-he,Ee=me/_.inputTimeScale;J+=Math.max(0,Ee),V+=Math.max(0,-Ee)}if(re){if(a.samplerate||(k.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),Y=this.generateIS(a,_,O)),G=this.remuxAudio(a,J,this.isAudioContiguous,L,ee||ae||W===F.PlaylistLevelType.AUDIO?V:void 0),ae){var pe=G?G.endPTS-G.startPTS:0;_.inputTimeScale||(k.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),Y=this.generateIS(a,_,O)),U=this.remuxVideo(_,V,ne,pe)}}else ae&&(U=this.remuxVideo(_,V,ne,0));U&&(U.firstKeyFrame=ie,U.independent=ie!==-1,U.firstKeyFramePTS=oe)}}return this.ISGenerated&&(o.samples.length&&(X=S(o,O,this._initPTS,this._initDTS)),A.samples.length&&(j=v(A,O,this._initPTS))),{audio:G,video:U,initSegment:Y,independent:q,text:j,id3:X}},T.generateIS=function(a,_,o){var A=a.samples,O=_.samples,L=this.typeSupported,H={},W=!(0,C.isFiniteNumber)(this._initPTS),U="audio/mp4",G,Y,j;if(W&&(G=Y=1/0),a.config&&A.length){switch(a.timescale=a.samplerate,a.segmentCodec){case"mp3":L.mpeg?(U="audio/mpeg",a.codec=""):L.mp3&&(a.codec="mp3");break}H.audio={id:"audio",container:U,codec:a.codec,initSegment:a.segmentCodec==="mp3"&&L.mpeg?new Uint8Array(0):w.default.initSegment([a]),metadata:{channelCount:a.channelCount}},W&&(j=a.inputTimeScale,G=Y=A[0].pts-Math.round(j*o))}if(_.sps&&_.pps&&O.length&&(_.timescale=_.inputTimeScale,H.video={id:"main",container:"video/mp4",codec:_.codec,initSegment:w.default.initSegment([_]),metadata:{width:_.width,height:_.height}},W)){j=_.inputTimeScale;var X=this.getVideoStartPts(O),q=Math.round(j*o);Y=Math.min(Y,d(O[0].dts,X)-q),G=Math.min(G,X-q)}if(Object.keys(H).length)return this.ISGenerated=!0,W&&(this._initPTS=G,this._initDTS=Y),{tracks:H,initPTS:G,timescale:j}},T.remuxVideo=function(a,_,o,A){var O=a.inputTimeScale,L=a.samples,H=[],W=L.length,U=this._initPTS,G=this.nextAvcDts,Y=8,j=this.videoSampleDuration,X,q,J=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,$=!1;if(!o||G===null){var ee=_*O,Z=L[0].pts-d(L[0].dts,L[0].pts);G=ee-Z}for(var re=0;re<W;re++){var ae=L[re];ae.pts=d(ae.pts-U,G),ae.dts=d(ae.dts-U,G),ae.dts<L[re>0?re-1:re].dts&&($=!0)}$&&L.sort(function(zi,Ga){var vf=zi.dts-Ga.dts,pf=zi.pts-Ga.pts;return vf||pf}),X=L[0].dts,q=L[L.length-1].dts;var le=q-X,ne=le?Math.round(le/(W-1)):j||a.inputTimeScale/30;if(o){var ie=X-G,oe=ie>ne,ge=ie<-1;if((oe||ge)&&(oe?k.logger.warn("AVC: "+(0,B.toMsFromMpegTsClock)(ie,!0)+" ms ("+ie+"dts) hole between fragments detected, filling it"):k.logger.warn("AVC: "+(0,B.toMsFromMpegTsClock)(-ie,!0)+" ms ("+ie+"dts) overlapping between fragments detected"),!ge||G>L[0].pts)){X=G;var he=L[0].pts-ie;L[0].dts=X,L[0].pts=he,k.logger.log("Video: First PTS/DTS adjusted: "+(0,B.toMsFromMpegTsClock)(he,!0)+"/"+(0,B.toMsFromMpegTsClock)(X,!0)+", delta: "+(0,B.toMsFromMpegTsClock)(ie,!0)+" ms")}}X=Math.max(0,X);for(var me=0,Ee=0,pe=0;pe<W;pe++){for(var Te=L[pe],_e=Te.units,ye=_e.length,De=0,Be=0;Be<ye;Be++)De+=_e[Be].data.length;Ee+=De,me+=ye,Te.length=De,Te.dts=Math.max(Te.dts,X),J=Math.min(Te.pts,J),V=Math.max(Te.pts,V)}q=L[W-1].dts;var He=Ee+4*me+8,Ke;try{Ke=new Uint8Array(He)}catch{this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:K.ErrorTypes.MUX_ERROR,details:K.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:He,reason:"fail allocating video mdat "+He});return}var ct=new DataView(Ke.buffer);ct.setUint32(0,He),Ke.set(w.default.types.mdat,4);for(var Me=!1,Ge=Number.POSITIVE_INFINITY,rt=Number.POSITIVE_INFINITY,ht=Number.NEGATIVE_INFINITY,gt=Number.NEGATIVE_INFINITY,ze=0;ze<W;ze++){for(var $e=L[ze],mt=$e.units,_t=0,Ye=0,Et=mt.length;Ye<Et;Ye++){var At=mt[Ye],Bn=At.data,or=At.data.byteLength;ct.setUint32(Y,or),Y+=4,Ke.set(Bn,Y),Y+=or,_t+=4+or}var Lr=void 0;if(ze<W-1)j=L[ze+1].dts-$e.dts,Lr=L[ze+1].pts-$e.pts;else{var Ua=this.config,wn=ze>0?$e.dts-L[ze-1].dts:ne;if(Lr=ze>0?$e.pts-L[ze-1].pts:ne,Ua.stretchShortVideoTrack&&this.nextAudioPts!==null){var cf=Math.floor(Ua.maxBufferHole*O),$i=(A?J+A*O:this.nextAudioPts)-$e.pts;$i>cf?(j=$i-wn,j<0?j=wn:Me=!0,k.logger.log("[mp4-remuxer]: It is approximately "+$i/90+" ms to the next segment; using duration "+j/90+" ms for the last video frame.")):j=wn}else j=wn}var ff=Math.round($e.pts-$e.dts);Ge=Math.min(Ge,j),ht=Math.max(ht,j),rt=Math.min(rt,Lr),gt=Math.max(gt,Lr),H.push(new l($e.key,j,_t,ff))}if(H.length){if(I){if(I<70){var Ha=H[0].flags;Ha.dependsOn=2,Ha.isNonSync=0}}else if(h&&gt-rt<ht-Ge&&ne/ht<.025&&H[0].cts===0){k.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Qi=X,yt=0,Ka=H.length;yt<Ka;yt++){var Wa=Qi+H[yt].duration,df=Qi+H[yt].cts;if(yt<Ka-1){var hf=Wa+H[yt+1].cts;H[yt].duration=hf-df}else H[yt].duration=yt?H[yt-1].duration:ne;H[yt].cts=0,Qi=Wa}}}console.assert(j!==null,"mp4SampleDuration must be computed"),j=Me||!j?ne:j,this.nextAvcDts=G=q+j,this.videoSampleDuration=j,this.isVideoContiguous=!0;var gf=w.default.moof(a.sequenceNumber++,X,P({},a,{samples:H})),mf="video",Ef={data1:gf,data2:Ke,startPTS:J/O,endPTS:(V+j)/O,startDTS:X/O,endDTS:G/O,type:mf,hasAudio:!1,hasVideo:!0,nb:H.length,dropped:a.dropped};return a.samples=[],a.dropped=0,console.assert(Ke.length,"MDAT length must not be zero"),Ef},T.remuxAudio=function(a,_,o,A,O){var L=a.inputTimeScale,H=a.samplerate?a.samplerate:L,W=L/H,U=a.segmentCodec==="aac"?m:N,G=U*W,Y=this._initPTS,j=a.segmentCodec==="mp3"&&this.typeSupported.mpeg,X=[],q=O!==void 0,J=a.samples,V=j?0:8,$=this.nextAudioPts||-1,ee=_*L;if(this.isAudioContiguous=o=o||J.length&&$>0&&(A&&Math.abs(ee-$)<9e3||Math.abs(d(J[0].pts-Y,ee)-$)<20*G),J.forEach(function(At){At.pts=d(At.pts-Y,ee)}),!o||$<0){if(J=J.filter(function(At){return At.pts>=0}),!J.length)return;O===0?$=0:A&&!q?$=Math.max(0,ee):$=J[0].pts}if(a.segmentCodec==="aac")for(var Z=this.config.maxAudioFramesDrift,re=0,ae=$;re<J.length;re++){var le=J[re],ne=le.pts,ie=ne-ae,oe=Math.abs(1e3*ie/L);if(ie<=-Z*G&&q)re===0&&(k.logger.warn("Audio frame @ "+(ne/L).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ie/L)+" ms."),this.nextAudioPts=$=ae=ne);else if(ie>=Z*G&&oe<M&&q){var ge=Math.round(ie/G);ae=ne-ge*G,ae<0&&(ge--,ae+=G),re===0&&(this.nextAudioPts=$=ae),k.logger.warn("[mp4-remuxer]: Injecting "+ge+" audio frame @ "+(ae/L).toFixed(3)+"s due to "+Math.round(1e3*ie/L)+" ms gap.");for(var he=0;he<ge;he++){var me=Math.max(ae,0),Ee=g.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);Ee||(k.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Ee=le.unit.subarray()),J.splice(re,0,{unit:Ee,pts:me}),ae+=G,re++}}le.pts=ae,ae+=G}for(var pe=null,Te=null,_e,ye=0,De=J.length;De--;)ye+=J[De].unit.byteLength;for(var Be=0,He=J.length;Be<He;Be++){var Ke=J[Be],ct=Ke.unit,Me=Ke.pts;if(Te!==null){var Ge=X[Be-1];Ge.duration=Math.round((Me-Te)/W)}else if(o&&a.segmentCodec==="aac"&&(Me=$),pe=Me,ye>0){ye+=V;try{_e=new Uint8Array(ye)}catch{this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:K.ErrorTypes.MUX_ERROR,details:K.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ye,reason:"fail allocating audio mdat "+ye});return}if(!j){var rt=new DataView(_e.buffer);rt.setUint32(0,ye),_e.set(w.default.types.mdat,4)}}else return;_e.set(ct,V);var ht=ct.byteLength;V+=ht,X.push(new l(!0,U,ht,0)),Te=Me}var gt=X.length;if(gt){var ze=X[X.length-1];this.nextAudioPts=$=Te+W*ze.duration;var $e=j?new Uint8Array(0):w.default.moof(a.sequenceNumber++,pe/W,P({},a,{samples:X}));a.samples=[];var mt=pe/L,_t=$/L,Ye="audio",Et={data1:$e,data2:_e,startPTS:mt,endPTS:_t,startDTS:mt,endDTS:_t,type:Ye,hasAudio:!0,hasVideo:!1,nb:gt};return this.isAudioContiguous=!0,console.assert(_e.length,"MDAT length must not be zero"),Et}},T.remuxEmptyAudio=function(a,_,o,A){var O=a.inputTimeScale,L=a.samplerate?a.samplerate:O,H=O/L,W=this.nextAudioPts,U=(W!==null?W:A.startDTS*O)+this._initDTS,G=A.endDTS*O+this._initDTS,Y=H*m,j=Math.ceil((G-U)/Y),X=g.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(k.logger.warn("[mp4-remuxer]: remux empty Audio"),!X){k.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var q=[],J=0;J<j;J++){var V=U+J*Y;q.push({unit:X,pts:V,dts:V})}return a.samples=q,this.remuxAudio(a,_,o,!1)},y}();function d(y,T){var f;if(T===null)return y;for(T<y?f=-8589934592:f=8589934592;Math.abs(y-T)>4294967296;)y+=f;return y}function c(y){for(var T=0;T<y.length;T++)if(y[T].key)return T;return-1}function S(y,T,f,a){var _=y.samples.length;if(_){for(var o=y.inputTimeScale,A=0;A<_;A++){var O=y.samples[A];O.pts=d(O.pts-f,T*o)/o,O.dts=d(O.dts-a,T*o)/o}var L=y.samples;return y.samples=[],{samples:L}}}function v(y,T,f){var a=y.samples.length;if(a){for(var _=y.inputTimeScale,o=0;o<a;o++){var A=y.samples[o];A.pts=d(A.pts-f,T*_)/_}y.samples.sort(function(L,H){return L.pts-H.pts});var O=y.samples;return y.samples=[],{samples:O}}}var l=function(T,f,a,_){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=f,this.size=a,this.cts=_,this.flags=new p(T)},p=function(T){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=T?2:1,this.isNonSync=T?0:1}},"./src/remux/passthrough-remuxer.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>B});var C=s("./src/polyfills/number.ts"),g=s("./src/remux/mp4-remuxer.ts"),w=s("./src/utils/mp4-tools.ts"),R=s("./src/loader/fragment.ts"),K=s("./src/utils/logger.ts"),k=function(){function P(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var M=P.prototype;return M.destroy=function(){},M.resetTimeStamp=function(N){this.initPTS=N,this.lastEndTime=null},M.resetNextTimestamp=function(){this.lastEndTime=null},M.resetInitSegment=function(N,I,h,E){this.audioCodec=I,this.videoCodec=h,this.generateInitSegment((0,w.patchEncyptionData)(N,E)),this.emitInitSegment=!0},M.generateInitSegment=function(N){var I=this.audioCodec,h=this.videoCodec;if(!N||!N.byteLength){this.initTracks=void 0,this.initData=void 0;return}var E=this.initData=(0,w.parseInitSegment)(N);I||(I=F(E.audio,R.ElementaryStreamTypes.AUDIO)),h||(h=F(E.video,R.ElementaryStreamTypes.VIDEO));var d={};E.audio&&E.video?d.audiovideo={container:"video/mp4",codec:I+","+h,initSegment:N,id:"main"}:E.audio?d.audio={container:"audio/mp4",codec:I,initSegment:N,id:"audio"}:E.video?d.video={container:"video/mp4",codec:h,initSegment:N,id:"main"}:K.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=d},M.remux=function(N,I,h,E,d){var c,S=this.initPTS,v=this.lastEndTime,l={audio:void 0,video:void 0,text:E,id3:h,initSegment:void 0};(0,C.isFiniteNumber)(v)||(v=this.lastEndTime=d||0);var p=I.samples;if(!p||!p.length)return l;var y={initPTS:void 0,timescale:1},T=this.initData;if((!T||!T.length)&&(this.generateInitSegment(p),T=this.initData),!T||!T.length)return K.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),l;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);var f=(0,w.getStartDTS)(T,p);(0,C.isFiniteNumber)(S)||(this.initPTS=y.initPTS=S=f-d);var a=(0,w.getDuration)(p,T),_=N?f-S:v,o=_+a;(0,w.offsetStartDTS)(T,p,S),a>0?this.lastEndTime=o:(K.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var A=!!T.audio,O=!!T.video,L="";A&&(L+="audio"),O&&(L+="video");var H={data1:p,startPTS:_,startDTS:_,endPTS:o,endDTS:o,type:L,hasAudio:A,hasVideo:O,nb:1,dropped:0};l.audio=H.type==="audio"?H:void 0,l.video=H.type!=="audio"?H:void 0,l.initSegment=y;var W=(c=this.initPTS)!=null?c:0;return l.id3=(0,g.flushTextTrackMetadataCueSamples)(h,d,W,W),E.samples.length&&(l.text=(0,g.flushTextTrackUserdataCueSamples)(E,d,W)),l},P}();function F(P,M){var m=P==null?void 0:P.codec;return m&&m.length>4?m:m==="hvc1"||m==="hev1"?"hvc1.1.c.L120.90":m==="av01"?"av01.0.04M.08":m==="avc1"||M===R.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const B=k},"./src/task-loop.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>C});var C=function(){function g(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var w=g.prototype;return w.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},w.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},w.onHandlerDestroyed=function(){},w.hasInterval=function(){return!!this._tickInterval},w.hasNextTick=function(){return!!this._tickTimer},w.setInterval=function(K){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,K),!0)},w.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},w.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},w.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},w.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},w.doTick=function(){},g}()},"./src/types/cmcd.ts":(x,b,s)=>{s.r(b),s.d(b,{CMCDObjectType:()=>g,CMCDStreamType:()=>R,CMCDStreamingFormat:()=>w,CMCDVersion:()=>C});var C=1,g;(function(K){K.MANIFEST="m",K.AUDIO="a",K.VIDEO="v",K.MUXED="av",K.INIT="i",K.CAPTION="c",K.TIMED_TEXT="tt",K.KEY="k",K.OTHER="o"})(g||(g={}));var w;(function(K){K.DASH="d",K.HLS="h",K.SMOOTH="s",K.OTHER="o"})(w||(w={}));var R;(function(K){K.VOD="v",K.LIVE="l"})(R||(R={}))},"./src/types/demuxer.ts":(x,b,s)=>{s.r(b),s.d(b,{MetadataSchema:()=>C});var C;(function(g){g.audioId3="org.id3",g.dateRange="com.apple.quicktime.HLS",g.emsg="https://aomedia.org/emsg/ID3"})(C||(C={}))},"./src/types/level.ts":(x,b,s)=>{s.r(b),s.d(b,{HdcpLevels:()=>K,HlsSkip:()=>k,HlsUrlParameters:()=>B,Level:()=>P,getSkipValue:()=>F});function C(M,m){for(var N=0;N<m.length;N++){var I=m[N];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(M,w(I.key),I)}}function g(M,m,N){return m&&C(M.prototype,m),N&&C(M,N),Object.defineProperty(M,"prototype",{writable:!1}),M}function w(M){var m=R(M,"string");return typeof m=="symbol"?m:String(m)}function R(M,m){if(typeof M!="object"||M===null)return M;var N=M[Symbol.toPrimitive];if(N!==void 0){var I=N.call(M,m||"default");if(typeof I!="object")return I;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(M)}var K=["NONE","TYPE-0","TYPE-1","TYPE-2",null],k;(function(M){M.No="",M.Yes="YES",M.v2="v2"})(k||(k={}));function F(M,m){var N=M.canSkipUntil,I=M.canSkipDateRanges,h=M.endSN,E=m!==void 0?m-h:0;return N&&E<N?I?k.v2:k.Yes:k.No}var B=function(){function M(N,I,h){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=N,this.part=I,this.skip=h}var m=M.prototype;return m.addDirectives=function(I){var h=new self.URL(I);return this.msn!==void 0&&h.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&h.searchParams.set("_HLS_part",this.part.toString()),this.skip&&h.searchParams.set("_HLS_skip",this.skip),h.href},M}(),P=function(){function M(m){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[m.url],this.attrs=m.attrs,this.bitrate=m.bitrate,m.details&&(this.details=m.details),this.id=m.id||0,this.name=m.name,this.width=m.width||0,this.height=m.height||0,this.audioCodec=m.audioCodec,this.videoCodec=m.videoCodec,this.unknownCodecs=m.unknownCodecs,this.codecSet=[m.videoCodec,m.audioCodec].filter(function(N){return N}).join(",").replace(/\.[^.,]+/g,"")}return g(M,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(N){var I=N%this.url.length;this._urlId!==I&&(this.details=void 0,this._urlId=I)}}]),M}()},"./src/types/loader.ts":(x,b,s)=>{s.r(b),s.d(b,{PlaylistContextType:()=>C,PlaylistLevelType:()=>g});var C;(function(w){w.MANIFEST="manifest",w.LEVEL="level",w.AUDIO_TRACK="audioTrack",w.SUBTITLE_TRACK="subtitleTrack"})(C||(C={}));var g;(function(w){w.MAIN="main",w.AUDIO="audio",w.SUBTITLE="subtitle"})(g||(g={}))},"./src/types/transmuxer.ts":(x,b,s)=>{s.r(b),s.d(b,{ChunkMetadata:()=>C});var C=function(R,K,k,F,B,P){F===void 0&&(F=0),B===void 0&&(B=-1),P===void 0&&(P=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=g(),this.buffering={audio:g(),video:g(),audiovideo:g()},this.level=R,this.sn=K,this.id=k,this.size=F,this.part=B,this.partial=P};function g(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(x,b,s)=>{s.r(b),s.d(b,{AttrList:()=>w});var C=/^(\d+)x(\d+)$/,g=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,w=function(){function R(k){typeof k=="string"&&(k=R.parseAttrList(k));for(var F in k)k.hasOwnProperty(F)&&(this[F]=k[F])}var K=R.prototype;return K.decimalInteger=function(F){var B=parseInt(this[F],10);return B>Number.MAX_SAFE_INTEGER?1/0:B},K.hexadecimalInteger=function(F){if(this[F]){var B=(this[F]||"0x").slice(2);B=(B.length&1?"0":"")+B;for(var P=new Uint8Array(B.length/2),M=0;M<B.length/2;M++)P[M]=parseInt(B.slice(M*2,M*2+2),16);return P}else return null},K.hexadecimalIntegerAsNumber=function(F){var B=parseInt(this[F],16);return B>Number.MAX_SAFE_INTEGER?1/0:B},K.decimalFloatingPoint=function(F){return parseFloat(this[F])},K.optionalFloat=function(F,B){var P=this[F];return P?parseFloat(P):B},K.enumeratedString=function(F){return this[F]},K.bool=function(F){return this[F]==="YES"},K.decimalResolution=function(F){var B=C.exec(this[F]);if(B!==null)return{width:parseInt(B[1],10),height:parseInt(B[2],10)}},R.parseAttrList=function(F){var B,P={},M='"';for(g.lastIndex=0;(B=g.exec(F))!==null;){var m=B[2];m.indexOf(M)===0&&m.lastIndexOf(M)===m.length-1&&(m=m.slice(1,-1)),P[B[1]]=m}return P},R}()},"./src/utils/binary-search.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>g});var C={search:function(R,K){for(var k=0,F=R.length-1,B=null,P=null;k<=F;){B=(k+F)/2|0,P=R[B];var M=K(P);if(M>0)k=B+1;else if(M<0)F=B-1;else return P}return null}};const g=C},"./src/utils/buffer-helper.ts":(x,b,s)=>{s.r(b),s.d(b,{BufferHelper:()=>w});var C=s("./src/utils/logger.ts"),g={length:0,start:function(){return 0},end:function(){return 0}},w=function(){function R(){}return R.isBuffered=function(k,F){try{if(k){for(var B=R.getBuffered(k),P=0;P<B.length;P++)if(F>=B.start(P)&&F<=B.end(P))return!0}}catch{}return!1},R.bufferInfo=function(k,F,B){try{if(k){var P=R.getBuffered(k),M=[],m;for(m=0;m<P.length;m++)M.push({start:P.start(m),end:P.end(m)});return this.bufferedInfo(M,F,B)}}catch{}return{len:0,start:F,end:F,nextStart:void 0}},R.bufferedInfo=function(k,F,B){F=Math.max(0,F),k.sort(function(l,p){var y=l.start-p.start;return y||p.end-l.end});var P=[];if(B)for(var M=0;M<k.length;M++){var m=P.length;if(m){var N=P[m-1].end;k[M].start-N<B?k[M].end>N&&(P[m-1].end=k[M].end):P.push(k[M])}else P.push(k[M])}else P=k;for(var I=0,h,E=F,d=F,c=0;c<P.length;c++){var S=P[c].start,v=P[c].end;if(F+B>=S&&F<v)E=S,d=v,I=d-F;else if(F+B<S){h=S;break}}return{len:I,start:E||0,end:d||0,nextStart:h}},R.getBuffered=function(k){try{return k.buffered}catch(F){return C.logger.log("failed to get media.buffered",F),g}},R}()},"./src/utils/cea-608-parser.ts":(x,b,s)=>{s.r(b),s.d(b,{CaptionScreen:()=>c,Row:()=>d,default:()=>T});var C=s("./src/utils/logger.ts"),g={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},w=function(a){var _=a;return g.hasOwnProperty(a)&&(_=g[a]),String.fromCharCode(_)},R=15,K=100,k={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},F={17:2,18:4,21:6,22:8,23:10,19:13,20:15},B={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},P={25:2,26:4,29:6,30:8,31:10,27:13,28:15},M=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],m;(function(f){f[f.ERROR=0]="ERROR",f[f.TEXT=1]="TEXT",f[f.WARNING=2]="WARNING",f[f.INFO=2]="INFO",f[f.DEBUG=3]="DEBUG",f[f.DATA=3]="DATA"})(m||(m={}));var N=function(){function f(){this.time=null,this.verboseLevel=m.ERROR}var a=f.prototype;return a.log=function(o,A){if(this.verboseLevel>=o){var O=typeof A=="function"?A():A;C.logger.log(this.time+" ["+o+"] "+O)}},f}(),I=function(a){for(var _=[],o=0;o<a.length;o++)_.push(a[o].toString(16));return _},h=function(){function f(_,o,A,O,L){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=_||"white",this.underline=o||!1,this.italics=A||!1,this.background=O||"black",this.flash=L||!1}var a=f.prototype;return a.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.setStyles=function(o){for(var A=["foreground","underline","italics","background","flash"],O=0;O<A.length;O++){var L=A[O];o.hasOwnProperty(L)&&(this[L]=o[L])}},a.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},a.equals=function(o){return this.foreground===o.foreground&&this.underline===o.underline&&this.italics===o.italics&&this.background===o.background&&this.flash===o.flash},a.copy=function(o){this.foreground=o.foreground,this.underline=o.underline,this.italics=o.italics,this.background=o.background,this.flash=o.flash},a.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},f}(),E=function(){function f(_,o,A,O,L,H){this.uchar=void 0,this.penState=void 0,this.uchar=_||" ",this.penState=new h(o,A,O,L,H)}var a=f.prototype;return a.reset=function(){this.uchar=" ",this.penState.reset()},a.setChar=function(o,A){this.uchar=o,this.penState.copy(A)},a.setPenState=function(o){this.penState.copy(o)},a.equals=function(o){return this.uchar===o.uchar&&this.penState.equals(o.penState)},a.copy=function(o){this.uchar=o.uchar,this.penState.copy(o.penState)},a.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},f}(),d=function(){function f(_){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var o=0;o<K;o++)this.chars.push(new E);this.logger=_,this.pos=0,this.currPenState=new h}var a=f.prototype;return a.equals=function(o){for(var A=!0,O=0;O<K;O++)if(!this.chars[O].equals(o.chars[O])){A=!1;break}return A},a.copy=function(o){for(var A=0;A<K;A++)this.chars[A].copy(o.chars[A])},a.isEmpty=function(){for(var o=!0,A=0;A<K;A++)if(!this.chars[A].isEmpty()){o=!1;break}return o},a.setCursor=function(o){this.pos!==o&&(this.pos=o),this.pos<0?(this.logger.log(m.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>K&&(this.logger.log(m.DEBUG,"Too large cursor position "+this.pos),this.pos=K)},a.moveCursor=function(o){var A=this.pos+o;if(o>1)for(var O=this.pos+1;O<A+1;O++)this.chars[O].setPenState(this.currPenState);this.setCursor(A)},a.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.insertChar=function(o){var A=this;o>=144&&this.backSpace();var O=w(o);if(this.pos>=K){this.logger.log(m.ERROR,function(){return"Cannot insert "+o.toString(16)+" ("+O+") at position "+A.pos+". Skipping it!"});return}this.chars[this.pos].setChar(O,this.currPenState),this.moveCursor(1)},a.clearFromPos=function(o){var A;for(A=o;A<K;A++)this.chars[A].reset()},a.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.getTextString=function(){for(var o=[],A=!0,O=0;O<K;O++){var L=this.chars[O].uchar;L!==" "&&(A=!1),o.push(L)}return A?"":o.join("")},a.setPenStyles=function(o){this.currPenState.setStyles(o);var A=this.chars[this.pos];A.setPenState(this.currPenState)},f}(),c=function(){function f(_){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var o=0;o<R;o++)this.rows.push(new d(_));this.logger=_,this.currRow=R-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var a=f.prototype;return a.reset=function(){for(var o=0;o<R;o++)this.rows[o].clear();this.currRow=R-1},a.equals=function(o){for(var A=!0,O=0;O<R;O++)if(!this.rows[O].equals(o.rows[O])){A=!1;break}return A},a.copy=function(o){for(var A=0;A<R;A++)this.rows[A].copy(o.rows[A])},a.isEmpty=function(){for(var o=!0,A=0;A<R;A++)if(!this.rows[A].isEmpty()){o=!1;break}return o},a.backSpace=function(){var o=this.rows[this.currRow];o.backSpace()},a.clearToEndOfRow=function(){var o=this.rows[this.currRow];o.clearToEndOfRow()},a.insertChar=function(o){var A=this.rows[this.currRow];A.insertChar(o)},a.setPen=function(o){var A=this.rows[this.currRow];A.setPenStyles(o)},a.moveCursor=function(o){var A=this.rows[this.currRow];A.moveCursor(o)},a.setCursor=function(o){this.logger.log(m.INFO,"setCursor: "+o);var A=this.rows[this.currRow];A.setCursor(o)},a.setPAC=function(o){this.logger.log(m.INFO,function(){return"pacData = "+JSON.stringify(o)});var A=o.row-1;if(this.nrRollUpRows&&A<this.nrRollUpRows-1&&(A=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==A){for(var O=0;O<R;O++)this.rows[O].clear();var L=this.currRow+1-this.nrRollUpRows,H=this.lastOutputScreen;if(H){var W=H.rows[L].cueStartTime,U=this.logger.time;if(W&&U!==null&&W<U)for(var G=0;G<this.nrRollUpRows;G++)this.rows[A-this.nrRollUpRows+G+1].copy(H.rows[L+G])}}this.currRow=A;var Y=this.rows[this.currRow];if(o.indent!==null){var j=o.indent,X=Math.max(j-1,0);Y.setCursor(o.indent),o.color=Y.chars[X].penState.foreground}var q={foreground:o.color,underline:o.underline,italics:o.italics,background:"black",flash:!1};this.setPen(q)},a.setBkgData=function(o){this.logger.log(m.INFO,function(){return"bkgData = "+JSON.stringify(o)}),this.backSpace(),this.setPen(o),this.insertChar(32)},a.setRollUpRows=function(o){this.nrRollUpRows=o},a.rollUp=function(){var o=this;if(this.nrRollUpRows===null){this.logger.log(m.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(m.TEXT,function(){return o.getDisplayText()});var A=this.currRow+1-this.nrRollUpRows,O=this.rows.splice(A,1)[0];O.clear(),this.rows.splice(this.currRow,0,O),this.logger.log(m.INFO,"Rolling up")},a.getDisplayText=function(o){o=o||!1;for(var A=[],O="",L=-1,H=0;H<R;H++){var W=this.rows[H].getTextString();W&&(L=H+1,o?A.push("Row "+L+": '"+W+"'"):A.push(W.trim()))}return A.length>0&&(o?O="["+A.join(" | ")+"]":O=A.join(`
`)),O},a.getTextAndFormat=function(){return this.rows},f}(),S=function(){function f(_,o,A){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=_,this.outputFilter=o,this.mode=null,this.verbose=0,this.displayedMemory=new c(A),this.nonDisplayedMemory=new c(A),this.lastOutputScreen=new c(A),this.currRollUpRow=this.displayedMemory.rows[R-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=A}var a=f.prototype;return a.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[R-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},a.getHandler=function(){return this.outputFilter},a.setHandler=function(o){this.outputFilter=o},a.setPAC=function(o){this.writeScreen.setPAC(o)},a.setBkgData=function(o){this.writeScreen.setBkgData(o)},a.setMode=function(o){o!==this.mode&&(this.mode=o,this.logger.log(m.INFO,function(){return"MODE="+o}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=o)},a.insertChars=function(o){for(var A=this,O=0;O<o.length;O++)this.writeScreen.insertChar(o[O]);var L=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(m.INFO,function(){return L+": "+A.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(m.TEXT,function(){return"DISPLAYED: "+A.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},a.ccRCL=function(){this.logger.log(m.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.ccBS=function(){this.logger.log(m.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.ccAOF=function(){},a.ccAON=function(){},a.ccDER=function(){this.logger.log(m.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.ccRU=function(o){this.logger.log(m.INFO,"RU("+o+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(o)},a.ccFON=function(){this.logger.log(m.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.ccRDC=function(){this.logger.log(m.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.ccTR=function(){this.logger.log(m.INFO,"TR"),this.setMode("MODE_TEXT")},a.ccRTD=function(){this.logger.log(m.INFO,"RTD"),this.setMode("MODE_TEXT")},a.ccEDM=function(){this.logger.log(m.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.ccCR=function(){this.logger.log(m.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.ccENM=function(){this.logger.log(m.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.ccEOC=function(){var o=this;if(this.logger.log(m.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var A=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=A,this.writeScreen=this.nonDisplayedMemory,this.logger.log(m.TEXT,function(){return"DISP: "+o.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},a.ccTO=function(o){this.logger.log(m.INFO,"TO("+o+") - Tab Offset"),this.writeScreen.moveCursor(o)},a.ccMIDROW=function(o){var A={flash:!1};if(A.underline=o%2===1,A.italics=o>=46,A.italics)A.foreground="white";else{var O=Math.floor(o/2)-16,L=["white","green","blue","cyan","red","yellow","magenta"];A.foreground=L[O]}this.logger.log(m.INFO,"MIDROW: "+JSON.stringify(A)),this.writeScreen.setPen(A)},a.outputDataUpdate=function(o){o===void 0&&(o=!1);var A=this.logger.time;A!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=A:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,A,this.lastOutputScreen),o&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:A),this.lastOutputScreen.copy(this.displayedMemory))},a.cueSplitAtTime=function(o){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,o,this.displayedMemory),this.cueStartTime=o))},f}(),v=function(){function f(_,o,A){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var O=new N;this.channels=[null,new S(_,o,O),new S(_+1,A,O)],this.cmdHistory=y(),this.logger=O}var a=f.prototype;return a.getHandler=function(o){return this.channels[o].getHandler()},a.setHandler=function(o,A){this.channels[o].setHandler(A)},a.addData=function(o,A){var O,L,H,W=!1;this.logger.time=o;for(var U=0;U<A.length;U+=2)if(L=A[U]&127,H=A[U+1]&127,!(L===0&&H===0)){if(this.logger.log(m.DATA,"["+I([A[U],A[U+1]])+"] -> ("+I([L,H])+")"),O=this.parseCmd(L,H),O||(O=this.parseMidrow(L,H)),O||(O=this.parsePAC(L,H)),O||(O=this.parseBackgroundAttributes(L,H)),!O&&(W=this.parseChars(L,H),W)){var G=this.currentChannel;if(G&&G>0){var Y=this.channels[G];Y.insertChars(W)}else this.logger.log(m.WARNING,"No channel found yet. TEXT-MODE?")}!O&&!W&&this.logger.log(m.WARNING,"Couldn't parse cleaned data "+I([L,H])+" orig: "+I([A[U],A[U+1]]))}},a.parseCmd=function(o,A){var O=this.cmdHistory,L=(o===20||o===28||o===21||o===29)&&A>=32&&A<=47,H=(o===23||o===31)&&A>=33&&A<=35;if(!(L||H))return!1;if(p(o,A,O))return l(null,null,O),this.logger.log(m.DEBUG,"Repeated command ("+I([o,A])+") is dropped"),!0;var W=o===20||o===21||o===23?1:2,U=this.channels[W];return o===20||o===21||o===28||o===29?A===32?U.ccRCL():A===33?U.ccBS():A===34?U.ccAOF():A===35?U.ccAON():A===36?U.ccDER():A===37?U.ccRU(2):A===38?U.ccRU(3):A===39?U.ccRU(4):A===40?U.ccFON():A===41?U.ccRDC():A===42?U.ccTR():A===43?U.ccRTD():A===44?U.ccEDM():A===45?U.ccCR():A===46?U.ccENM():A===47&&U.ccEOC():U.ccTO(A-32),l(o,A,O),this.currentChannel=W,!0},a.parseMidrow=function(o,A){var O=0;if((o===17||o===25)&&A>=32&&A<=47){if(o===17?O=1:O=2,O!==this.currentChannel)return this.logger.log(m.ERROR,"Mismatch channel in midrow parsing"),!1;var L=this.channels[O];return L?(L.ccMIDROW(A),this.logger.log(m.DEBUG,"MIDROW ("+I([o,A])+")"),!0):!1}return!1},a.parsePAC=function(o,A){var O,L=this.cmdHistory,H=(o>=17&&o<=23||o>=25&&o<=31)&&A>=64&&A<=127,W=(o===16||o===24)&&A>=64&&A<=95;if(!(H||W))return!1;if(p(o,A,L))return l(null,null,L),!0;var U=o<=23?1:2;A>=64&&A<=95?O=U===1?k[o]:B[o]:O=U===1?F[o]:P[o];var G=this.channels[U];return G?(G.setPAC(this.interpretPAC(O,A)),l(o,A,L),this.currentChannel=U,!0):!1},a.interpretPAC=function(o,A){var O,L={color:null,italics:!1,indent:null,underline:!1,row:o};return A>95?O=A-96:O=A-64,L.underline=(O&1)===1,O<=13?L.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(O/2)]:O<=15?(L.italics=!0,L.color="white"):L.indent=Math.floor((O-16)/2)*4,L},a.parseChars=function(o,A){var O,L=null,H=null;if(o>=25?(O=2,H=o-8):(O=1,H=o),H>=17&&H<=19){var W;H===17?W=A+80:H===18?W=A+112:W=A+144,this.logger.log(m.INFO,"Special char '"+w(W)+"' in channel "+O),L=[W]}else o>=32&&o<=127&&(L=A===0?[o]:[o,A]);if(L){var U=I(L);this.logger.log(m.DEBUG,"Char codes =  "+U.join(",")),l(o,A,this.cmdHistory)}return L},a.parseBackgroundAttributes=function(o,A){var O=(o===16||o===24)&&A>=32&&A<=47,L=(o===23||o===31)&&A>=45&&A<=47;if(!(O||L))return!1;var H,W={};o===16||o===24?(H=Math.floor((A-32)/2),W.background=M[H],A%2===1&&(W.background=W.background+"_semi")):A===45?W.background="transparent":(W.foreground="black",A===47&&(W.underline=!0));var U=o<=23?1:2,G=this.channels[U];return G.setBkgData(W),l(o,A,this.cmdHistory),!0},a.reset=function(){for(var o=0;o<Object.keys(this.channels).length;o++){var A=this.channels[o];A&&A.reset()}this.cmdHistory=y()},a.cueSplitAtTime=function(o){for(var A=0;A<this.channels.length;A++){var O=this.channels[A];O&&O.cueSplitAtTime(o)}},f}();function l(f,a,_){_.a=f,_.b=a}function p(f,a,_){return _.a===f&&_.b===a}function y(){return{a:null,b:null}}const T=v},"./src/utils/codecs.ts":(x,b,s)=>{s.r(b),s.d(b,{isCodecSupportedInMp4:()=>w,isCodecType:()=>g});var C={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function g(R,K){var k=C[K];return!!k&&k[R.slice(0,4)]===!0}function w(R,K){return MediaSource.isTypeSupported((K||"video")+'/mp4;codecs="'+R+'"')}},"./src/utils/cues.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>k});var C=s("./src/utils/vttparser.ts"),g=s("./src/utils/webvtt-parser.ts"),w=s("./src/utils/texttrack-utils.ts"),R=/\s/,K={newCue:function(B,P,M,m){for(var N=[],I,h,E,d,c,S=self.VTTCue||self.TextTrackCue,v=0;v<m.rows.length;v++)if(I=m.rows[v],E=!0,d=0,c="",!I.isEmpty()){for(var l=0;l<I.chars.length;l++)R.test(I.chars[l].uchar)&&E?d++:(c+=I.chars[l].uchar,E=!1);I.cueStartTime=P,P===M&&(M+=1e-4),d>=16?d--:d++;var p=(0,C.fixLineBreaks)(c.trim()),y=(0,g.generateCueId)(P,M,p);(!B||!B.cues||!B.cues.getCueById(y))&&(h=new S(P,M,p),h.id=y,h.line=v+1,h.align="left",h.position=10+Math.min(80,Math.floor(d*8/32)*10),N.push(h))}return B&&N.length&&(N.sort(function(T,f){return T.line==="auto"||f.line==="auto"?0:T.line>8&&f.line>8?f.line-T.line:T.line-f.line}),N.forEach(function(T){return(0,w.addCueToTrack)(B,T)})),N}};const k=K},"./src/utils/discontinuities.ts":(x,b,s)=>{s.r(b),s.d(b,{adjustSlidingStart:()=>B,alignMediaPlaylistByPDT:()=>N,alignPDT:()=>m,alignStream:()=>P,findDiscontinuousReferenceFrag:()=>k,findFirstFragWithCC:()=>R,shouldAlignOnDiscontinuities:()=>K});var C=s("./src/polyfills/number.ts"),g=s("./src/utils/logger.ts"),w=s("./src/controller/level-helper.ts");function R(I,h){for(var E=null,d=0,c=I.length;d<c;d++){var S=I[d];if(S&&S.cc===h){E=S;break}}return E}function K(I,h,E){return!!(h.details&&(E.endCC>E.startCC||I&&I.cc<E.startCC))}function k(I,h,E){var d=I.fragments,c=h.fragments;if(!c.length||!d.length){g.logger.log("No fragments to align");return}var S=R(d,c[0].cc);if(!S||S&&!S.startPTS){g.logger.log("No frag in previous level to align on");return}return S}function F(I,h){if(I){var E=I.start+h;I.start=I.startPTS=E,I.endPTS=E+I.duration}}function B(I,h){for(var E=h.fragments,d=0,c=E.length;d<c;d++)F(E[d],I);h.fragmentHint&&F(h.fragmentHint,I),h.alignedSliding=!0}function P(I,h,E){h&&(M(I,E,h),!E.alignedSliding&&h.details&&m(E,h.details),!E.alignedSliding&&h.details&&!E.skippedSegments&&(0,w.adjustSliding)(h.details,E))}function M(I,h,E){if(K(I,E,h)){var d=k(E.details,h);d&&(0,C.isFiniteNumber)(d.start)&&(g.logger.log("Adjusting PTS using last level due to CC increase within current level "+h.url),B(d.start,h))}}function m(I,h){if(!(!h.fragments.length||!I.hasProgramDateTime||!h.hasProgramDateTime)){var E=h.fragments[0].programDateTime,d=I.fragments[0].programDateTime,c=(d-E)/1e3+h.fragments[0].start;c&&(0,C.isFiniteNumber)(c)&&(g.logger.log("Adjusting PTS using programDateTime delta "+(d-E)+"ms, sliding:"+c.toFixed(3)+" "+I.url+" "),B(c,I))}}function N(I,h){if(!(!I.hasProgramDateTime||!h.hasProgramDateTime)){var E=I.fragments,d=h.fragments;if(!(!E.length||!d.length)){var c=Math.round(d.length/2)-1,S=d[c],v=R(E,S.cc)||E[Math.round(E.length/2)-1],l=S.programDateTime,p=v.programDateTime;if(!(l===null||p===null)){var y=(p-l)/1e3-(v.start-S.start);B(y,I)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>w});var C=s("./src/utils/ewma.ts"),g=function(){function R(k,F,B){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=B,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new C.default(k),this.fast_=new C.default(F)}var K=R.prototype;return K.update=function(F,B){var P=this.slow_,M=this.fast_;this.slow_.halfLife!==F&&(this.slow_=new C.default(F,P.getEstimate(),P.getTotalWeight())),this.fast_.halfLife!==B&&(this.fast_=new C.default(B,M.getEstimate(),M.getTotalWeight()))},K.sample=function(F,B){F=Math.max(F,this.minDelayMs_);var P=8*B,M=F/1e3,m=P/M;this.fast_.sample(M,m),this.slow_.sample(M,m)},K.canEstimate=function(){var F=this.fast_;return F&&F.getTotalWeight()>=this.minWeight_},K.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},K.destroy=function(){},R}();const w=g},"./src/utils/ewma.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>g});var C=function(){function w(K,k,F){k===void 0&&(k=0),F===void 0&&(F=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=K,this.alpha_=K?Math.exp(Math.log(.5)/K):0,this.estimate_=k,this.totalWeight_=F}var R=w.prototype;return R.sample=function(k,F){var B=Math.pow(this.alpha_,k);this.estimate_=F*(1-B)+B*this.estimate_,this.totalWeight_+=k},R.getTotalWeight=function(){return this.totalWeight_},R.getEstimate=function(){if(this.alpha_){var k=1-Math.pow(this.alpha_,this.totalWeight_);if(k)return this.estimate_/k}return this.estimate_},w}();const g=C},"./src/utils/fetch-loader.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>c,fetchSupported:()=>N});var C=s("./src/polyfills/number.ts"),g=s("./src/loader/load-stats.ts"),w=s("./src/demux/chunk-cache.ts");function R(S,v){S.prototype=Object.create(v.prototype),S.prototype.constructor=S,P(S,v)}function K(S){var v=typeof Map=="function"?new Map:void 0;return K=function(p){if(p===null||!B(p))return p;if(typeof p!="function")throw new TypeError("Super expression must either be null or a function");if(typeof v<"u"){if(v.has(p))return v.get(p);v.set(p,y)}function y(){return k(p,arguments,M(this).constructor)}return y.prototype=Object.create(p.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),P(y,p)},K(S)}function k(S,v,l){return F()?k=Reflect.construct.bind():k=function(y,T,f){var a=[null];a.push.apply(a,T);var _=Function.bind.apply(y,a),o=new _;return f&&P(o,f.prototype),o},k.apply(null,arguments)}function F(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function B(S){return Function.toString.call(S).indexOf("[native code]")!==-1}function P(S,v){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,y){return p.__proto__=y,p},P(S,v)}function M(S){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},M(S)}function m(){return m=Object.assign?Object.assign.bind():function(S){for(var v=1;v<arguments.length;v++){var l=arguments[v];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(S[p]=l[p])}return S},m.apply(this,arguments)}function N(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var I=function(){function S(l){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=l.fetchSetup||E,this.controller=new self.AbortController,this.stats=new g.LoadStats}var v=S.prototype;return v.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},v.abortInternal=function(){var p=this.response;(!p||!p.ok)&&(this.stats.aborted=!0,this.controller.abort())},v.abort=function(){var p;this.abortInternal(),(p=this.callbacks)!==null&&p!==void 0&&p.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},v.load=function(p,y,T){var f=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var _=h(p,this.controller.signal),o=T.onProgress,A=p.responseType==="arraybuffer",O=A?"byteLength":"length";this.context=p,this.config=y,this.callbacks=T,this.request=this.fetchSetup(p,_),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){f.abortInternal(),T.onTimeout(a,p,f.response)},y.timeout),self.fetch(this.request).then(function(L){if(f.response=f.loader=L,!L.ok){var H=L.status,W=L.statusText;throw new d(W||"fetch, bad network response",H,L)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(L.headers.get("Content-Length")||"0"),o&&(0,C.isFiniteNumber)(y.highWaterMark)?f.loadProgressively(L,a,p,y.highWaterMark,o):A?L.arrayBuffer():L.text()}).then(function(L){var H=f.response;self.clearTimeout(f.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);var W=L[O];W&&(a.loaded=a.total=W);var U={url:H.url,data:L};o&&!(0,C.isFiniteNumber)(y.highWaterMark)&&o(a,p,L,H),T.onSuccess(U,a,p,H)}).catch(function(L){if(self.clearTimeout(f.requestTimeout),!a.aborted){var H=L&&L.code||0,W=L?L.message:null;T.onError({code:H,text:W},p,L?L.details:null)}})},v.getCacheAge=function(){var p=null;if(this.response){var y=this.response.headers.get("age");p=y?parseFloat(y):null}return p},v.loadProgressively=function(p,y,T,f,a){f===void 0&&(f=0);var _=new w.default,o=p.body.getReader(),A=function O(){return o.read().then(function(L){if(L.done)return _.dataLength&&a(y,T,_.flush(),p),Promise.resolve(new ArrayBuffer(0));var H=L.value,W=H.length;return y.loaded+=W,W<f||_.dataLength?(_.push(H),_.dataLength>=f&&a(y,T,_.flush(),p)):a(y,T,H,p),O()}).catch(function(){return Promise.reject()})};return A()},S}();function h(S,v){var l={method:"GET",mode:"cors",credentials:"same-origin",signal:v,headers:new self.Headers(m({},S.headers))};return S.rangeEnd&&l.headers.set("Range","bytes="+S.rangeStart+"-"+String(S.rangeEnd-1)),l}function E(S,v){return new self.Request(S.url,v)}var d=function(S){R(v,S);function v(l,p,y){var T;return T=S.call(this,l)||this,T.code=void 0,T.details=void 0,T.code=p,T.details=y,T}return v}(K(Error));const c=I},"./src/utils/hex.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>g});var C={hexDump:function(R){for(var K="",k=0;k<R.length;k++){var F=R[k].toString(16);F.length<2&&(F="0"+F),K+=F}return K}};const g=C},"./src/utils/imsc1-ttml-parser.ts":(x,b,s)=>{s.r(b),s.d(b,{IMSC1_CODEC:()=>B,parseIMSC1:()=>N});var C=s("./src/utils/mp4-tools.ts"),g=s("./src/utils/vttparser.ts"),w=s("./src/utils/vttcue.ts"),R=s("./src/demux/id3.ts"),K=s("./src/utils/timescale-conversion.ts"),k=s("./src/utils/webvtt-parser.ts");function F(){return F=Object.assign?Object.assign.bind():function(T){for(var f=1;f<arguments.length;f++){var a=arguments[f];for(var _ in a)Object.prototype.hasOwnProperty.call(a,_)&&(T[_]=a[_])}return T},F.apply(this,arguments)}var B="stpp.ttml.im1t",P=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,M=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,m={left:"start",center:"center",right:"end",start:"start",end:"end"};function N(T,f,a,_,o){var A=(0,C.findBox)(new Uint8Array(T),["mdat"]);if(A.length===0){o(new Error("Could not parse IMSC1 mdat"));return}var O=A.map(function(H){return(0,R.utf8ArrayToStr)(H)}),L=(0,K.toTimescaleFromScale)(f,1,a);try{O.forEach(function(H){return _(I(H,L))})}catch(H){o(H)}}function I(T,f){var a=new DOMParser,_=a.parseFromString(T,"text/xml"),o=_.getElementsByTagName("tt")[0];if(!o)throw new Error("Invalid ttml");var A={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},O=Object.keys(A).reduce(function(G,Y){return G[Y]=o.getAttribute("ttp:"+Y)||A[Y],G},{}),L=o.getAttribute("xml:space")!=="preserve",H=E(h(o,"styling","style")),W=E(h(o,"layout","region")),U=h(o,"body","[begin]");return[].map.call(U,function(G){var Y=d(G,L);if(!Y||!G.hasAttribute("begin"))return null;var j=l(G.getAttribute("begin"),O),X=l(G.getAttribute("dur"),O),q=l(G.getAttribute("end"),O);if(j===null)throw v(G);if(q===null){if(X===null)throw v(G);q=j+X}var J=new w.default(j-f,q-f,Y);J.id=(0,k.generateCueId)(J.startTime,J.endTime,J.text);var V=W[G.getAttribute("region")],$=H[G.getAttribute("style")],ee=c(V,$,H),Z=ee.textAlign;if(Z){var re=m[Z];re&&(J.lineAlign=re),J.align=Z}return F(J,ee),J}).filter(function(G){return G!==null})}function h(T,f,a){var _=T.getElementsByTagName(f)[0];return _?[].slice.call(_.querySelectorAll(a)):[]}function E(T){return T.reduce(function(f,a){var _=a.getAttribute("xml:id");return _&&(f[_]=a),f},{})}function d(T,f){return[].slice.call(T.childNodes).reduce(function(a,_,o){var A;return _.nodeName==="br"&&o?a+`
`:(A=_.childNodes)!==null&&A!==void 0&&A.length?d(_,f):f?a+_.textContent.trim().replace(/\s+/g," "):a+_.textContent},"")}function c(T,f,a){var _="http://www.w3.org/ns/ttml#styling",o=null,A=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],O=T!=null&&T.hasAttribute("style")?T.getAttribute("style"):null;return O&&a.hasOwnProperty(O)&&(o=a[O]),A.reduce(function(L,H){var W=S(f,_,H)||S(T,_,H)||S(o,_,H);return W&&(L[H]=W),L},{})}function S(T,f,a){return T&&T.hasAttributeNS(f,a)?T.getAttributeNS(f,a):null}function v(T){return new Error("Could not parse ttml timestamp "+T)}function l(T,f){if(!T)return null;var a=(0,g.parseTimeStamp)(T);return a===null&&(P.test(T)?a=p(T,f):M.test(T)&&(a=y(T,f))),a}function p(T,f){var a=P.exec(T),_=(a[4]|0)+(a[5]|0)/f.subFrameRate;return(a[1]|0)*3600+(a[2]|0)*60+(a[3]|0)+_/f.frameRate}function y(T,f){var a=M.exec(T),_=Number(a[1]),o=a[2];switch(o){case"h":return _*3600;case"m":return _*60;case"ms":return _*1e3;case"f":return _/f.frameRate;case"t":return _/f.tickRate}return _}},"./src/utils/keysystem-util.ts":(x,b,s)=>{s.r(b),s.d(b,{changeEndianness:()=>w,convertDataUriToArrayBytes:()=>R,strToUtf8array:()=>K});var C=s("./src/utils/numeric-encoding-utils.ts");function g(k){var F=K(k).subarray(0,16),B=new Uint8Array(16);return B.set(F,16-F.length),B}function w(k){var F=function(P,M,m){var N=P[M];P[M]=P[m],P[m]=N};F(k,0,3),F(k,1,2),F(k,4,5),F(k,6,7)}function R(k){var F=k.split(":"),B=null;if(F[0]==="data"&&F.length===2){var P=F[1].split(";"),M=P[P.length-1].split(",");if(M.length===2){var m=M[0]==="base64",N=M[1];m?(P.splice(-1,1),B=(0,C.base64Decode)(N)):B=g(N)}}return B}function K(k){return Uint8Array.from(unescape(encodeURIComponent(k)),function(F){return F.charCodeAt(0)})}},"./src/utils/logger.ts":(x,b,s)=>{s.r(b),s.d(b,{enableLogs:()=>k,logger:()=>F});var C=function(){},g={trace:C,debug:C,log:C,warn:C,info:C,error:C},w=g;function R(B){var P=self.console[B];return P?P.bind(self.console,"["+B+"] >"):C}function K(B){for(var P=arguments.length,M=new Array(P>1?P-1:0),m=1;m<P;m++)M[m-1]=arguments[m];M.forEach(function(N){w[N]=B[N]?B[N].bind(B):R(N)})}function k(B,P){if(self.console&&B===!0||typeof B=="object"){K(B,"debug","log","info","warn","error");try{w.log('Debug logs enabled for "'+P+'"')}catch{w=g}}else w=g}var F=w},"./src/utils/mediakeys-helper.ts":(x,b,s)=>{s.r(b),s.d(b,{KeySystemFormats:()=>g,KeySystemIds:()=>R,KeySystems:()=>C,getKeySystemsForConfig:()=>F,getSupportedMediaKeySystemConfigurations:()=>P,keySystemDomainToKeySystemFormat:()=>k,keySystemFormatToKeySystemDomain:()=>w,keySystemIdToKeySystemDomain:()=>K,requestMediaKeySystemAccess:()=>B});var C;(function(m){m.CLEARKEY="org.w3.clearkey",m.FAIRPLAY="com.apple.fps",m.PLAYREADY="com.microsoft.playready",m.WIDEVINE="com.widevine.alpha"})(C||(C={}));var g;(function(m){m.CLEARKEY="org.w3.clearkey",m.FAIRPLAY="com.apple.streamingkeydelivery",m.PLAYREADY="com.microsoft.playready",m.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"})(g||(g={}));function w(m){switch(m){case g.FAIRPLAY:return C.FAIRPLAY;case g.PLAYREADY:return C.PLAYREADY;case g.WIDEVINE:return C.WIDEVINE;case g.CLEARKEY:return C.CLEARKEY}}var R;(function(m){m.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"})(R||(R={}));function K(m){if(m===R.WIDEVINE)return C.WIDEVINE}function k(m){switch(m){case C.FAIRPLAY:return g.FAIRPLAY;case C.PLAYREADY:return g.PLAYREADY;case C.WIDEVINE:return g.WIDEVINE;case C.CLEARKEY:return g.CLEARKEY}}function F(m){var N=m.drmSystems,I=m.widevineLicenseUrl,h=N?[C.FAIRPLAY,C.WIDEVINE,C.PLAYREADY,C.CLEARKEY].filter(function(E){return!!N[E]}):[];return!h[C.WIDEVINE]&&I&&h.push(C.WIDEVINE),h}var B=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function P(m,N,I,h){var E;switch(m){case C.FAIRPLAY:E=["cenc","sinf"];break;case C.WIDEVINE:case C.PLAYREADY:E=["cenc"];break;case C.CLEARKEY:E=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+m)}return M(E,N,I,h)}function M(m,N,I,h){var E={initDataTypes:m,persistentState:h.persistentState||"not-allowed",distinctiveIdentifier:h.distinctiveIdentifier||"not-allowed",sessionTypes:h.sessionTypes||[h.sessionType||"temporary"],audioCapabilities:N.map(function(d){return{contentType:'audio/mp4; codecs="'+d+'"',robustness:h.audioRobustness||"",encryptionScheme:h.audioEncryptionScheme||null}}),videoCapabilities:I.map(function(d){return{contentType:'video/mp4; codecs="'+d+'"',robustness:h.videoRobustness||"",encryptionScheme:h.videoEncryptionScheme||null}})};return[E]}},"./src/utils/mediasource-helper.ts":(x,b,s)=>{s.r(b),s.d(b,{getMediaSource:()=>C});function C(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(x,b,s)=>{s.r(b),s.d(b,{RemuxerTrackIdConfig:()=>B,appendUint8Array:()=>f,bin2str:()=>P,computeRawDurationFromSamples:()=>p,discardEPB:()=>O,findBox:()=>h,getDuration:()=>l,getStartDTS:()=>v,mp4Box:()=>H,mp4pssh:()=>W,offsetStartDTS:()=>y,parseEmsg:()=>L,parseInitSegment:()=>d,parsePssh:()=>U,parseSEIMessageFromNALu:()=>A,parseSamples:()=>a,parseSegmentIndex:()=>E,parseSinf:()=>S,patchEncyptionData:()=>c,readSint32:()=>N,readUint16:()=>M,readUint32:()=>m,segmentValidRange:()=>T,writeUint32:()=>I});var C=s("./src/loader/fragment.ts"),g=s("./src/utils/typed-array.ts"),w=s("./src/demux/id3.ts"),R=s("./src/utils/logger.ts"),K=s("./src/utils/hex.ts"),k=Math.pow(2,32)-1,F=[].push,B={video:1,audio:2,id3:3,text:4};function P(G){return String.fromCharCode.apply(null,G)}function M(G,Y){var j=G[Y]<<8|G[Y+1];return j<0?65536+j:j}function m(G,Y){var j=N(G,Y);return j<0?4294967296+j:j}function N(G,Y){return G[Y]<<24|G[Y+1]<<16|G[Y+2]<<8|G[Y+3]}function I(G,Y,j){G[Y]=j>>24,G[Y+1]=j>>16&255,G[Y+2]=j>>8&255,G[Y+3]=j&255}function h(G,Y){var j=[];if(!Y.length)return j;for(var X=G.byteLength,q=0;q<X;){var J=m(G,q),V=P(G.subarray(q+4,q+8)),$=J>1?q+J:X;if(V===Y[0])if(Y.length===1)j.push(G.subarray(q+8,$));else{var ee=h(G.subarray(q+8,$),Y.slice(1));ee.length&&F.apply(j,ee)}q=$}return j}function E(G){var Y=[],j=G[0],X=8,q=m(G,X);X+=4;var J=0,V=0;j===0?X+=8:X+=16,X+=2;var $=G.length+V,ee=M(G,X);X+=2;for(var Z=0;Z<ee;Z++){var re=X,ae=m(G,re);re+=4;var le=ae&2147483647,ne=(ae&2147483648)>>>31;if(ne===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var ie=m(G,re);re+=4,Y.push({referenceSize:le,subsegmentDuration:ie,info:{duration:ie/q,start:$,end:$+le-1}}),$+=le,re+=4,X=re}return{earliestPresentationTime:J,timescale:q,version:j,referencesCount:ee,references:Y}}function d(G){for(var Y=[],j=h(G,["moov","trak"]),X=0;X<j.length;X++){var q=j[X],J=h(q,["tkhd"])[0];if(J){var V=J[0],$=V===0?12:20,ee=m(J,$),Z=h(q,["mdia","mdhd"])[0];if(Z){V=Z[0],$=V===0?12:20;var re=m(Z,$),ae=h(q,["mdia","hdlr"])[0];if(ae){var le=P(ae.subarray(8,12)),ne={soun:C.ElementaryStreamTypes.AUDIO,vide:C.ElementaryStreamTypes.VIDEO}[le];if(ne){var ie=h(q,["mdia","minf","stbl","stsd"])[0],oe=void 0;ie&&(oe=P(ie.subarray(12,16))),Y[ee]={timescale:re,type:ne},Y[ne]={timescale:re,id:ee,codec:oe}}}}}}var ge=h(G,["moov","mvex","trex"]);return ge.forEach(function(he){var me=m(he,4),Ee=Y[me];Ee&&(Ee.default={duration:m(he,12),flags:m(he,20)})}),Y}function c(G,Y){if(!G||!Y)return G;var j=Y.keyId;if(j&&Y.isCommonEncryption){var X=h(G,["moov","trak"]);X.forEach(function(q){var J=h(q,["mdia","minf","stbl","stsd"])[0],V=J.subarray(8),$=h(V,["enca"]),ee=$.length>0;ee||($=h(V,["encv"])),$.forEach(function(Z){var re=ee?Z.subarray(28):Z.subarray(78),ae=h(re,["sinf"]);ae.forEach(function(le){var ne=S(le);if(ne){var ie=ne.subarray(8,24);ie.some(function(oe){return oe!==0})||(R.logger.log("[eme] Patching keyId in 'enc"+(ee?"a":"v")+">sinf>>tenc' box: "+K.default.hexDump(ie)+" -> "+K.default.hexDump(j)),ne.set(j,8))}})})})}return G}function S(G){var Y=h(G,["schm"])[0];if(Y){var j=P(Y.subarray(4,8));if(j==="cbcs"||j==="cenc")return h(G,["schi","tenc"])[0]}return R.logger.error("[eme] missing 'schm' box"),null}function v(G,Y){return h(Y,["moof","traf"]).reduce(function(j,X){var q=h(X,["tfdt"])[0],J=q[0],V=h(X,["tfhd"]).reduce(function($,ee){var Z=m(ee,4),re=G[Z];if(re){var ae=m(q,4);J===1&&(ae*=Math.pow(2,32),ae+=m(q,8));var le=re.timescale||9e4,ne=ae/le;if(isFinite(ne)&&($===null||ne<$))return ne}return $},null);return V!==null&&isFinite(V)&&(j===null||V<j)?V:j},null)||0}function l(G,Y){for(var j=0,X=0,q=0,J=h(G,["moof","traf"]),V=0;V<J.length;V++){var $=J[V],ee=h($,["tfhd"])[0],Z=m(ee,4),re=Y[Z];if(re){var ae=re.default,le=m(ee,0)|(ae==null?void 0:ae.flags),ne=ae==null?void 0:ae.duration;le&8&&(le&2?ne=m(ee,12):ne=m(ee,8));for(var ie=re.timescale||9e4,oe=h($,["trun"]),ge=0;ge<oe.length;ge++){if(j=p(oe[ge]),!j&&ne){var he=m(oe[ge],4);j=ne*he}re.type===C.ElementaryStreamTypes.VIDEO?X+=j/ie:re.type===C.ElementaryStreamTypes.AUDIO&&(q+=j/ie)}}}if(X===0&&q===0){for(var me=0,Ee=h(G,["sidx"]),pe=0;pe<Ee.length;pe++){var Te=E(Ee[pe]);Te!=null&&Te.references&&(me+=Te.references.reduce(function(_e,ye){return _e+ye.info.duration||0},0))}return me}return X||q}function p(G){var Y=m(G,0),j=8;Y&1&&(j+=4),Y&4&&(j+=4);for(var X=0,q=m(G,4),J=0;J<q;J++){if(Y&256){var V=m(G,j);X+=V,j+=4}Y&512&&(j+=4),Y&1024&&(j+=4),Y&2048&&(j+=4)}return X}function y(G,Y,j){h(Y,["moof","traf"]).forEach(function(X){h(X,["tfhd"]).forEach(function(q){var J=m(q,4),V=G[J];if(V){var $=V.timescale||9e4;h(X,["tfdt"]).forEach(function(ee){var Z=ee[0],re=m(ee,4);if(Z===0)re-=j*$,re=Math.max(re,0),I(ee,4,re);else{re*=Math.pow(2,32),re+=m(ee,8),re-=j*$,re=Math.max(re,0);var ae=Math.floor(re/(k+1)),le=Math.floor(re%(k+1));I(ee,4,ae),I(ee,8,le)}})}})})}function T(G){var Y={valid:null,remainder:null},j=h(G,["moof"]);if(j){if(j.length<2)return Y.remainder=G,Y}else return Y;var X=j[j.length-1];return Y.valid=(0,g.sliceUint8)(G,0,X.byteOffset-8),Y.remainder=(0,g.sliceUint8)(G,X.byteOffset-8),Y}function f(G,Y){var j=new Uint8Array(G.length+Y.length);return j.set(G),j.set(Y,G.length),j}function a(G,Y){var j=[],X=Y.samples,q=Y.timescale,J=Y.id,V=!1,$=h(X,["moof"]);return $.map(function(ee){var Z=ee.byteOffset-8,re=h(ee,["traf"]);re.map(function(ae){var le=h(ae,["tfdt"]).map(function(ne){var ie=ne[0],oe=m(ne,4);return ie===1&&(oe*=Math.pow(2,32),oe+=m(ne,8)),oe/q})[0];return le!==void 0&&(G=le),h(ae,["tfhd"]).map(function(ne){var ie=m(ne,4),oe=m(ne,0)&16777215,ge=(oe&1)!==0,he=(oe&2)!==0,me=(oe&8)!==0,Ee=0,pe=(oe&16)!==0,Te=0,_e=(oe&32)!==0,ye=8;ie===J&&(ge&&(ye+=8),he&&(ye+=4),me&&(Ee=m(ne,ye),ye+=4),pe&&(Te=m(ne,ye),ye+=4),_e&&(ye+=4),Y.type==="video"&&(V=_(Y.codec)),h(ae,["trun"]).map(function(De){var Be=De[0],He=m(De,0)&16777215,Ke=(He&1)!==0,ct=0,Me=(He&4)!==0,Ge=(He&256)!==0,rt=0,ht=(He&512)!==0,gt=0,ze=(He&1024)!==0,$e=(He&2048)!==0,mt=0,_t=m(De,4),Ye=8;Ke&&(ct=m(De,Ye),Ye+=4),Me&&(Ye+=4);for(var Et=ct+Z,At=0;At<_t;At++){if(Ge?(rt=m(De,Ye),Ye+=4):rt=Ee,ht?(gt=m(De,Ye),Ye+=4):gt=Te,ze&&(Ye+=4),$e&&(Be===0?mt=m(De,Ye):mt=N(De,Ye),Ye+=4),Y.type===C.ElementaryStreamTypes.VIDEO)for(var Bn=0;Bn<gt;){var or=m(X,Et);if(Et+=4,o(V,X[Et])){var Lr=X.subarray(Et,Et+or);A(Lr,V?2:1,G+mt/q,j)}Et+=or,Bn+=or+4}G+=rt/q}}))})})}),j}function _(G){if(!G)return!1;var Y=G.indexOf("."),j=Y<0?G:G.substring(0,Y);return j==="hvc1"||j==="hev1"||j==="dvh1"||j==="dvhe"}function o(G,Y){if(G){var j=Y>>1&63;return j===39||j===40}else{var X=Y&31;return X===6}}function A(G,Y,j,X){var q=O(G),J=0;J+=Y;for(var V=0,$=0,ee=!1,Z=0;J<q.length;){V=0;do{if(J>=q.length)break;Z=q[J++],V+=Z}while(Z===255);$=0;do{if(J>=q.length)break;Z=q[J++],$+=Z}while(Z===255);var re=q.length-J;if(!ee&&V===4&&J<q.length){ee=!0;var ae=q[J++];if(ae===181){var le=M(q,J);if(J+=2,le===49){var ne=m(q,J);if(J+=4,ne===1195456820){var ie=q[J++];if(ie===3){var oe=q[J++],ge=31&oe,he=64&oe,me=he?2+ge*3:0,Ee=new Uint8Array(me);if(he){Ee[0]=oe;for(var pe=1;pe<me;pe++)Ee[pe]=q[J++]}X.push({type:ie,payloadType:V,pts:j,bytes:Ee})}}}}}else if(V===5&&$<re){if(ee=!0,$>16){for(var Te=[],_e=0;_e<16;_e++){var ye=q[J++].toString(16);Te.push(ye.length==1?"0"+ye:ye),(_e===3||_e===5||_e===7||_e===9)&&Te.push("-")}for(var De=$-16,Be=new Uint8Array(De),He=0;He<De;He++)Be[He]=q[J++];X.push({payloadType:V,pts:j,uuid:Te.join(""),userData:(0,w.utf8ArrayToStr)(Be),userDataBytes:Be})}}else if($<re)J+=$;else if($>re)break}}function O(G){for(var Y=G.byteLength,j=[],X=1;X<Y-2;)G[X]===0&&G[X+1]===0&&G[X+2]===3?(j.push(X+2),X+=2):X++;if(j.length===0)return G;var q=Y-j.length,J=new Uint8Array(q),V=0;for(X=0;X<q;V++,X++)V===j[0]&&(V++,j.shift()),J[X]=G[V];return J}function L(G){var Y=G[0],j="",X="",q=0,J=0,V=0,$=0,ee=0,Z=0;if(Y===0){for(;P(G.subarray(Z,Z+1))!=="\0";)j+=P(G.subarray(Z,Z+1)),Z+=1;for(j+=P(G.subarray(Z,Z+1)),Z+=1;P(G.subarray(Z,Z+1))!=="\0";)X+=P(G.subarray(Z,Z+1)),Z+=1;X+=P(G.subarray(Z,Z+1)),Z+=1,q=m(G,12),J=m(G,16),$=m(G,20),ee=m(G,24),Z=28}else if(Y===1){Z+=4,q=m(G,Z),Z+=4;var re=m(G,Z);Z+=4;var ae=m(G,Z);for(Z+=4,V=Math.pow(2,32)*re+ae,Number.isSafeInteger(V)||(V=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),$=m(G,Z),Z+=4,ee=m(G,Z),Z+=4;P(G.subarray(Z,Z+1))!=="\0";)j+=P(G.subarray(Z,Z+1)),Z+=1;for(j+=P(G.subarray(Z,Z+1)),Z+=1;P(G.subarray(Z,Z+1))!=="\0";)X+=P(G.subarray(Z,Z+1)),Z+=1;X+=P(G.subarray(Z,Z+1)),Z+=1}var le=G.subarray(Z,G.byteLength);return{schemeIdUri:j,value:X,timeScale:q,presentationTime:V,presentationTimeDelta:J,eventDuration:$,id:ee,payload:le}}function H(G){for(var Y=arguments.length,j=new Array(Y>1?Y-1:0),X=1;X<Y;X++)j[X-1]=arguments[X];for(var q=j.length,J=8,V=q;V--;)J+=j[V].byteLength;var $=new Uint8Array(J);for($[0]=J>>24&255,$[1]=J>>16&255,$[2]=J>>8&255,$[3]=J&255,$.set(G,4),V=0,J=8;V<q;V++)$.set(j[V],J),J+=j[V].byteLength;return $}function W(G,Y,j){if(G.byteLength!==16)throw new RangeError("Invalid system id");var X,q;if(Y){X=1,q=new Uint8Array(Y.length*16);for(var J=0;J<Y.length;J++){var V=Y[J];if(V.byteLength!==16)throw new RangeError("Invalid key");q.set(V,J*16)}}else X=0,q=new Uint8Array;var $;X>0?($=new Uint8Array(4),Y.length>0&&new DataView($.buffer).setUint32(0,Y.length,!1)):$=new Uint8Array;var ee=new Uint8Array(4);return j&&j.byteLength>0&&new DataView(ee.buffer).setUint32(0,j.byteLength,!1),H([112,115,115,104],new Uint8Array([X,0,0,0]),G,$,q,ee,j||new Uint8Array)}function U(G){if(!(G instanceof ArrayBuffer)||G.byteLength<32)return null;var Y={version:0,systemId:"",kids:null,data:null},j=new DataView(G),X=j.getUint32(0);if(G.byteLength!==X&&X>44)return null;var q=j.getUint32(4);if(q!==1886614376||(Y.version=j.getUint32(8)>>>24,Y.version>1))return null;Y.systemId=K.default.hexDump(new Uint8Array(G,12,16));var J=j.getUint32(28);if(Y.version===0){if(X-32<J)return null;Y.data=new Uint8Array(G,32,J)}else if(Y.version===1){Y.kids=[];for(var V=0;V<J;V++)Y.kids.push(new Uint8Array(G,32+V*16,16))}return Y}},"./src/utils/numeric-encoding-utils.ts":(x,b,s)=>{s.r(b),s.d(b,{base64Decode:()=>k,base64DecodeToStr:()=>w,base64Encode:()=>R,base64ToBase64Url:()=>C,base64UrlEncode:()=>K,strToBase64Encode:()=>g});function C(F){return F.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function g(F){return btoa(F)}function w(F){return atob(F)}function R(F){return btoa(String.fromCharCode.apply(String,F))}function K(F){return C(R(F))}function k(F){return Uint8Array.from(atob(F),function(B){return B.charCodeAt(0)})}},"./src/utils/output-filter.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>C});var C=function(){function g(R,K){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=R,this.trackName=K}var w=g.prototype;return w.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},w.newCue=function(K,k,F){(this.startTime===null||this.startTime>K)&&(this.startTime=K),this.endTime=k,this.screen=F,this.timelineController.createCaptionsTrack(this.trackName)},w.reset=function(){this.cueRanges=[],this.startTime=null},g}()},"./src/utils/texttrack-utils.ts":(x,b,s)=>{s.r(b),s.d(b,{addCueToTrack:()=>w,clearCurrentCues:()=>R,getCuesInRange:()=>F,removeCuesInRange:()=>K,sendAddTrackEvent:()=>g});var C=s("./src/utils/logger.ts");function g(B,P){var M;try{M=new Event("addtrack")}catch{M=document.createEvent("Event"),M.initEvent("addtrack",!1,!1)}M.track=B,P.dispatchEvent(M)}function w(B,P){var M=B.mode;if(M==="disabled"&&(B.mode="hidden"),B.cues&&!B.cues.getCueById(P.id))try{if(B.addCue(P),!B.cues.getCueById(P.id))throw new Error("addCue is failed for: "+P)}catch(N){C.logger.debug("[texttrack-utils]: "+N);var m=new self.TextTrackCue(P.startTime,P.endTime,P.text);m.id=P.id,B.addCue(m)}M==="disabled"&&(B.mode=M)}function R(B){var P=B.mode;if(P==="disabled"&&(B.mode="hidden"),B.cues)for(var M=B.cues.length;M--;)B.removeCue(B.cues[M]);P==="disabled"&&(B.mode=P)}function K(B,P,M,m){var N=B.mode;if(N==="disabled"&&(B.mode="hidden"),B.cues&&B.cues.length>0)for(var I=F(B.cues,P,M),h=0;h<I.length;h++)(!m||m(I[h]))&&B.removeCue(I[h]);N==="disabled"&&(B.mode=N)}function k(B,P){if(P<B[0].startTime)return 0;var M=B.length-1;if(P>B[M].endTime)return-1;for(var m=0,N=M;m<=N;){var I=Math.floor((N+m)/2);if(P<B[I].startTime)N=I-1;else if(P>B[I].startTime&&m<M)m=I+1;else return I}return B[m].startTime-P<P-B[N].startTime?m:N}function F(B,P,M){var m=[],N=k(B,P);if(N>-1)for(var I=N,h=B.length;I<h;I++){var E=B[I];if(E.startTime>=P&&E.endTime<=M)m.push(E);else if(E.startTime>M)return m}return m}},"./src/utils/time-ranges.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>g});var C={toString:function(R){for(var K="",k=R.length,F=0;F<k;F++)K+="["+R.start(F).toFixed(3)+","+R.end(F).toFixed(3)+"]";return K}};const g=C},"./src/utils/timescale-conversion.ts":(x,b,s)=>{s.r(b),s.d(b,{toMpegTsClockFromTimescale:()=>K,toMsFromMpegTsClock:()=>R,toTimescaleFromBase:()=>g,toTimescaleFromScale:()=>w});var C=9e4;function g(k,F,B,P){B===void 0&&(B=1),P===void 0&&(P=!1);var M=k*F*B;return P?Math.round(M):M}function w(k,F,B,P){return B===void 0&&(B=1),P===void 0&&(P=!1),g(k,F,1/B,P)}function R(k,F){return F===void 0&&(F=!1),g(k,1e3,1/C,F)}function K(k,F){return F===void 0&&(F=1),g(k,C,1/F)}},"./src/utils/typed-array.ts":(x,b,s)=>{s.r(b),s.d(b,{sliceUint8:()=>C});function C(g,w,R){return Uint8Array.prototype.slice?g.slice(w,R):new Uint8Array(Array.prototype.slice.call(g,w,R))}},"./src/utils/vttcue.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>C});const C=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var g=["","lr","rl"],w=["start","middle","end","left","right"];function R(P,M){if(typeof M!="string"||!Array.isArray(P))return!1;var m=M.toLowerCase();return~P.indexOf(m)?m:!1}function K(P){return R(g,P)}function k(P){return R(w,P)}function F(P){for(var M=arguments.length,m=new Array(M>1?M-1:0),N=1;N<M;N++)m[N-1]=arguments[N];for(var I=1;I<arguments.length;I++){var h=arguments[I];for(var E in h)P[E]=h[E]}return P}function B(P,M,m){var N=this,I={enumerable:!0};N.hasBeenReset=!1;var h="",E=!1,d=P,c=M,S=m,v=null,l="",p=!0,y="auto",T="start",f=50,a="middle",_=50,o="middle";Object.defineProperty(N,"id",F({},I,{get:function(){return h},set:function(O){h=""+O}})),Object.defineProperty(N,"pauseOnExit",F({},I,{get:function(){return E},set:function(O){E=!!O}})),Object.defineProperty(N,"startTime",F({},I,{get:function(){return d},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");d=O,this.hasBeenReset=!0}})),Object.defineProperty(N,"endTime",F({},I,{get:function(){return c},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");c=O,this.hasBeenReset=!0}})),Object.defineProperty(N,"text",F({},I,{get:function(){return S},set:function(O){S=""+O,this.hasBeenReset=!0}})),Object.defineProperty(N,"region",F({},I,{get:function(){return v},set:function(O){v=O,this.hasBeenReset=!0}})),Object.defineProperty(N,"vertical",F({},I,{get:function(){return l},set:function(O){var L=K(O);if(L===!1)throw new SyntaxError("An invalid or illegal string was specified.");l=L,this.hasBeenReset=!0}})),Object.defineProperty(N,"snapToLines",F({},I,{get:function(){return p},set:function(O){p=!!O,this.hasBeenReset=!0}})),Object.defineProperty(N,"line",F({},I,{get:function(){return y},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");y=O,this.hasBeenReset=!0}})),Object.defineProperty(N,"lineAlign",F({},I,{get:function(){return T},set:function(O){var L=k(O);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");T=L,this.hasBeenReset=!0}})),Object.defineProperty(N,"position",F({},I,{get:function(){return f},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");f=O,this.hasBeenReset=!0}})),Object.defineProperty(N,"positionAlign",F({},I,{get:function(){return a},set:function(O){var L=k(O);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");a=L,this.hasBeenReset=!0}})),Object.defineProperty(N,"size",F({},I,{get:function(){return _},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");_=O,this.hasBeenReset=!0}})),Object.defineProperty(N,"align",F({},I,{get:function(){return o},set:function(O){var L=k(O);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");o=L,this.hasBeenReset=!0}})),N.displayState=void 0}return B.prototype.getCueAsHTML=function(){var P=self.WebVTT;return P.convertCueToDOMTree(self,this.text)},B}()},"./src/utils/vttparser.ts":(x,b,s)=>{s.r(b),s.d(b,{VTTParser:()=>M,fixLineBreaks:()=>P,parseTimeStamp:()=>w});var C=s("./src/utils/vttcue.ts"),g=function(){function m(){}var N=m.prototype;return N.decode=function(h,E){if(!h)return"";if(typeof h!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(h))},m}();function w(m){function N(h,E,d,c){return(h|0)*3600+(E|0)*60+(d|0)+parseFloat(c||0)}var I=m.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return I?parseFloat(I[2])>59?N(I[2],I[3],0,I[4]):N(I[1],I[2],I[3],I[4]):null}var R=function(){function m(){this.values=Object.create(null)}var N=m.prototype;return N.set=function(h,E){!this.get(h)&&E!==""&&(this.values[h]=E)},N.get=function(h,E,d){return d?this.has(h)?this.values[h]:E[d]:this.has(h)?this.values[h]:E},N.has=function(h){return h in this.values},N.alt=function(h,E,d){for(var c=0;c<d.length;++c)if(E===d[c]){this.set(h,E);break}},N.integer=function(h,E){/^-?\d+$/.test(E)&&this.set(h,parseInt(E,10))},N.percent=function(h,E){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(E)){var d=parseFloat(E);if(d>=0&&d<=100)return this.set(h,d),!0}return!1},m}();function K(m,N,I,h){var E=h?m.split(h):[m];for(var d in E)if(typeof E[d]=="string"){var c=E[d].split(I);if(c.length===2){var S=c[0],v=c[1];N(S,v)}}}var k=new C.default(0,0,""),F=k.align==="middle"?"middle":"center";function B(m,N,I){var h=m;function E(){var S=w(m);if(S===null)throw new Error("Malformed timestamp: "+h);return m=m.replace(/^[^\sa-zA-Z-]+/,""),S}function d(S,v){var l=new R;K(S,function(T,f){var a;switch(T){case"region":for(var _=I.length-1;_>=0;_--)if(I[_].id===f){l.set(T,I[_].region);break}break;case"vertical":l.alt(T,f,["rl","lr"]);break;case"line":a=f.split(","),l.integer(T,a[0]),l.percent(T,a[0])&&l.set("snapToLines",!1),l.alt(T,a[0],["auto"]),a.length===2&&l.alt("lineAlign",a[1],["start",F,"end"]);break;case"position":a=f.split(","),l.percent(T,a[0]),a.length===2&&l.alt("positionAlign",a[1],["start",F,"end","line-left","line-right","auto"]);break;case"size":l.percent(T,f);break;case"align":l.alt(T,f,["start",F,"end","left","right"]);break}},/:/,/\s/),v.region=l.get("region",null),v.vertical=l.get("vertical","");var p=l.get("line","auto");p==="auto"&&k.line===-1&&(p=-1),v.line=p,v.lineAlign=l.get("lineAlign","start"),v.snapToLines=l.get("snapToLines",!0),v.size=l.get("size",100),v.align=l.get("align",F);var y=l.get("position","auto");y==="auto"&&k.position===50&&(y=v.align==="start"||v.align==="left"?0:v.align==="end"||v.align==="right"?100:50),v.position=y}function c(){m=m.replace(/^\s+/,"")}if(c(),N.startTime=E(),c(),m.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+h);m=m.slice(3),c(),N.endTime=E(),c(),d(m,N)}function P(m){return m.replace(/<br(?: \/)?>/gi,`
`)}var M=function(){function m(){this.state="INITIAL",this.buffer="",this.decoder=new g,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var N=m.prototype;return N.parse=function(h){var E=this;h&&(E.buffer+=E.decoder.decode(h,{stream:!0}));function d(){var y=E.buffer,T=0;for(y=P(y);T<y.length&&y[T]!=="\r"&&y[T]!==`
`;)++T;var f=y.slice(0,T);return y[T]==="\r"&&++T,y[T]===`
`&&++T,E.buffer=y.slice(T),f}function c(y){K(y,function(T,f){},/:/)}try{var S="";if(E.state==="INITIAL"){if(!/\r\n|\n/.test(E.buffer))return this;S=d();var v=S.match(/^()?WEBVTT([ \t].*)?$/);if(!v||!v[0])throw new Error("Malformed WebVTT signature.");E.state="HEADER"}for(var l=!1;E.buffer;){if(!/\r\n|\n/.test(E.buffer))return this;switch(l?l=!1:S=d(),E.state){case"HEADER":/:/.test(S)?c(S):S||(E.state="ID");continue;case"NOTE":S||(E.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(S)){E.state="NOTE";break}if(!S)continue;if(E.cue=new C.default(0,0,""),E.state="CUE",S.indexOf("-->")===-1){E.cue.id=S;continue}case"CUE":if(!E.cue){E.state="BADCUE";continue}try{B(S,E.cue,E.regionList)}catch{E.cue=null,E.state="BADCUE";continue}E.state="CUETEXT";continue;case"CUETEXT":{var p=S.indexOf("-->")!==-1;if(!S||p&&(l=!0)){E.oncue&&E.cue&&E.oncue(E.cue),E.cue=null,E.state="ID";continue}if(E.cue===null)continue;E.cue.text&&(E.cue.text+=`
`),E.cue.text+=S}continue;case"BADCUE":S||(E.state="ID")}}}catch{E.state==="CUETEXT"&&E.cue&&E.oncue&&E.oncue(E.cue),E.cue=null,E.state=E.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},N.flush=function(){var h=this;try{if((h.cue||h.state==="HEADER")&&(h.buffer+=`

`,h.parse()),h.state==="INITIAL"||h.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(E){h.onparsingerror&&h.onparsingerror(E)}return h.onflush&&h.onflush(),this},m}()},"./src/utils/webvtt-parser.ts":(x,b,s)=>{s.r(b),s.d(b,{generateCueId:()=>M,parseWebVTT:()=>N});var C=s("./src/polyfills/number.ts"),g=s("./src/utils/vttparser.ts"),w=s("./src/demux/id3.ts"),R=s("./src/utils/timescale-conversion.ts"),K=s("./src/remux/mp4-remuxer.ts"),k=/\r\n|\n\r|\n|\r/g,F=function(h,E,d){return d===void 0&&(d=0),h.slice(d,d+E.length)===E},B=function(h){var E=parseInt(h.slice(-3)),d=parseInt(h.slice(-6,-4)),c=parseInt(h.slice(-9,-7)),S=h.length>9?parseInt(h.substring(0,h.indexOf(":"))):0;if(!(0,C.isFiniteNumber)(E)||!(0,C.isFiniteNumber)(d)||!(0,C.isFiniteNumber)(c)||!(0,C.isFiniteNumber)(S))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+h);return E+=1e3*d,E+=60*1e3*c,E+=60*60*1e3*S,E},P=function(h){for(var E=5381,d=h.length;d;)E=E*33^h.charCodeAt(--d);return(E>>>0).toString()};function M(I,h,E){return P(I.toString())+P(h.toString())+P(E)}var m=function(h,E,d){var c=h[E],S=h[c.prevCC];if(!S||!S.new&&c.new){h.ccOffset=h.presentationOffset=c.start,c.new=!1;return}for(;(v=S)!==null&&v!==void 0&&v.new;){var v;h.ccOffset+=c.start-S.start,c.new=!1,c=S,S=h[c.prevCC]}h.presentationOffset=d};function N(I,h,E,d,c,S,v,l){var p=new g.VTTParser,y=(0,w.utf8ArrayToStr)(new Uint8Array(I)).trim().replace(k,`
`).split(`
`),T=[],f=(0,R.toMpegTsClockFromTimescale)(h,E),a="00:00.000",_=0,o=0,A,O=!0;p.oncue=function(L){var H=d[c],W=d.ccOffset,U=(_-f)/9e4;H!=null&&H.new&&(o!==void 0?W=d.ccOffset=H.start:m(d,c,U)),U&&(W=U-d.presentationOffset);var G=L.endTime-L.startTime,Y=(0,K.normalizePts)((L.startTime+W-o)*9e4,S*9e4)/9e4;L.startTime=Math.max(Y,0),L.endTime=Math.max(Y+G,0);var j=L.text.trim();L.text=decodeURIComponent(encodeURIComponent(j)),L.id||(L.id=M(L.startTime,L.endTime,j)),L.endTime>0&&T.push(L)},p.onparsingerror=function(L){A=L},p.onflush=function(){if(A){l(A);return}v(T)},y.forEach(function(L){if(O)if(F(L,"X-TIMESTAMP-MAP=")){O=!1,L.slice(16).split(",").forEach(function(H){F(H,"LOCAL:")?a=H.slice(6):F(H,"MPEGTS:")&&(_=parseInt(H.slice(7)))});try{o=B(a)/1e3}catch(H){A=H}return}else L===""&&(O=!1);p.parse(L+`
`)}),p.flush()}},"./src/utils/xhr-loader.ts":(x,b,s)=>{s.r(b),s.d(b,{default:()=>K});var C=s("./src/utils/logger.ts"),g=s("./src/loader/load-stats.ts"),w=/^age:\s*[\d.]+\s*$/m,R=function(){function k(B){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=B?B.xhrSetup:null,this.stats=new g.LoadStats,this.retryDelay=0}var F=k.prototype;return F.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},F.abortInternal=function(){var P=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),P&&(P.onreadystatechange=null,P.onprogress=null,P.readyState!==4&&(this.stats.aborted=!0,P.abort()))},F.abort=function(){var P;this.abortInternal(),(P=this.callbacks)!==null&&P!==void 0&&P.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},F.load=function(P,M,m){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=P,this.config=M,this.callbacks=m,this.retryDelay=M.retryDelay,this.loadInternal()},F.loadInternal=function(){var P=this.config,M=this.context;if(P){var m=this.loader=new self.XMLHttpRequest,N=this.stats;N.loading.first=0,N.loaded=0;var I=this.xhrSetup;try{if(I)try{I(m,M.url)}catch{m.open("GET",M.url,!0),I(m,M.url)}m.readyState||m.open("GET",M.url,!0);var h=this.context.headers;if(h)for(var E in h)m.setRequestHeader(E,h[E])}catch(d){this.callbacks.onError({code:m.status,text:d.message},M,m);return}M.rangeEnd&&m.setRequestHeader("Range","bytes="+M.rangeStart+"-"+(M.rangeEnd-1)),m.onreadystatechange=this.readystatechange.bind(this),m.onprogress=this.loadprogress.bind(this),m.responseType=M.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),P.timeout),m.send()}},F.readystatechange=function(){var P=this.context,M=this.loader,m=this.stats;if(!(!P||!M)){var N=M.readyState,I=this.config;if(!m.aborted&&N>=2)if(self.clearTimeout(this.requestTimeout),m.loading.first===0&&(m.loading.first=Math.max(self.performance.now(),m.loading.start)),N===4){M.onreadystatechange=null,M.onprogress=null;var h=M.status,E=M.responseType==="arraybuffer";if(h>=200&&h<300&&(E&&M.response||M.responseText!==null)){m.loading.end=Math.max(self.performance.now(),m.loading.first);var d,c;if(E?(d=M.response,c=d.byteLength):(d=M.responseText,c=d.length),m.loaded=m.total=c,!this.callbacks)return;var S=this.callbacks.onProgress;if(S&&S(m,P,d,M),!this.callbacks)return;var v={url:M.responseURL,data:d};this.callbacks.onSuccess(v,m,P,M)}else m.retry>=I.maxRetry||h>=400&&h<499?(C.logger.error(h+" while loading "+P.url),this.callbacks.onError({code:h,text:M.statusText},P,M)):(C.logger.warn(h+" while loading "+P.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,I.maxRetryDelay),m.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),I.timeout)}},F.loadtimeout=function(){C.logger.warn("timeout while loading "+this.context.url);var P=this.callbacks;P&&(this.abortInternal(),P.onTimeout(this.stats,this.context,this.loader))},F.loadprogress=function(P){var M=this.stats;M.loaded=P.loaded,P.lengthComputable&&(M.total=P.total)},F.getCacheAge=function(){var P=null;if(this.loader&&w.test(this.loader.getAllResponseHeaders())){var M=this.loader.getResponseHeader("age");P=M?parseFloat(M):null}return P},k}();const K=R},"./node_modules/eventemitter3/index.js":x=>{var b=Object.prototype.hasOwnProperty,s="~";function C(){}Object.create&&(C.prototype=Object.create(null),new C().__proto__||(s=!1));function g(k,F,B){this.fn=k,this.context=F,this.once=B||!1}function w(k,F,B,P,M){if(typeof B!="function")throw new TypeError("The listener must be a function");var m=new g(B,P||k,M),N=s?s+F:F;return k._events[N]?k._events[N].fn?k._events[N]=[k._events[N],m]:k._events[N].push(m):(k._events[N]=m,k._eventsCount++),k}function R(k,F){--k._eventsCount===0?k._events=new C:delete k._events[F]}function K(){this._events=new C,this._eventsCount=0}K.prototype.eventNames=function(){var F=[],B,P;if(this._eventsCount===0)return F;for(P in B=this._events)b.call(B,P)&&F.push(s?P.slice(1):P);return Object.getOwnPropertySymbols?F.concat(Object.getOwnPropertySymbols(B)):F},K.prototype.listeners=function(F){var B=s?s+F:F,P=this._events[B];if(!P)return[];if(P.fn)return[P.fn];for(var M=0,m=P.length,N=new Array(m);M<m;M++)N[M]=P[M].fn;return N},K.prototype.listenerCount=function(F){var B=s?s+F:F,P=this._events[B];return P?P.fn?1:P.length:0},K.prototype.emit=function(F,B,P,M,m,N){var I=s?s+F:F;if(!this._events[I])return!1;var h=this._events[I],E=arguments.length,d,c;if(h.fn){switch(h.once&&this.removeListener(F,h.fn,void 0,!0),E){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,B),!0;case 3:return h.fn.call(h.context,B,P),!0;case 4:return h.fn.call(h.context,B,P,M),!0;case 5:return h.fn.call(h.context,B,P,M,m),!0;case 6:return h.fn.call(h.context,B,P,M,m,N),!0}for(c=1,d=new Array(E-1);c<E;c++)d[c-1]=arguments[c];h.fn.apply(h.context,d)}else{var S=h.length,v;for(c=0;c<S;c++)switch(h[c].once&&this.removeListener(F,h[c].fn,void 0,!0),E){case 1:h[c].fn.call(h[c].context);break;case 2:h[c].fn.call(h[c].context,B);break;case 3:h[c].fn.call(h[c].context,B,P);break;case 4:h[c].fn.call(h[c].context,B,P,M);break;default:if(!d)for(v=1,d=new Array(E-1);v<E;v++)d[v-1]=arguments[v];h[c].fn.apply(h[c].context,d)}}return!0},K.prototype.on=function(F,B,P){return w(this,F,B,P,!1)},K.prototype.once=function(F,B,P){return w(this,F,B,P,!0)},K.prototype.removeListener=function(F,B,P,M){var m=s?s+F:F;if(!this._events[m])return this;if(!B)return R(this,m),this;var N=this._events[m];if(N.fn)N.fn===B&&(!M||N.once)&&(!P||N.context===P)&&R(this,m);else{for(var I=0,h=[],E=N.length;I<E;I++)(N[I].fn!==B||M&&!N[I].once||P&&N[I].context!==P)&&h.push(N[I]);h.length?this._events[m]=h.length===1?h[0]:h:R(this,m)}return this},K.prototype.removeAllListeners=function(F){var B;return F?(B=s?s+F:F,this._events[B]&&R(this,B)):(this._events=new C,this._eventsCount=0),this},K.prototype.off=K.prototype.removeListener,K.prototype.addListener=K.prototype.on,K.prefixed=s,K.EventEmitter=K,x.exports=K},"./node_modules/url-toolkit/src/url-toolkit.js":function(x){(function(b){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,C=/^(?=([^\/?#]*))\1([^]*)$/,g=/(?:\/|^)\.(?=\/)/g,w=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,R={buildAbsoluteURL:function(K,k,F){if(F=F||{},K=K.trim(),k=k.trim(),!k){if(!F.alwaysNormalize)return K;var B=R.parseURL(K);if(!B)throw new Error("Error trying to parse base URL.");return B.path=R.normalizePath(B.path),R.buildURLFromParts(B)}var P=R.parseURL(k);if(!P)throw new Error("Error trying to parse relative URL.");if(P.scheme)return F.alwaysNormalize?(P.path=R.normalizePath(P.path),R.buildURLFromParts(P)):k;var M=R.parseURL(K);if(!M)throw new Error("Error trying to parse base URL.");if(!M.netLoc&&M.path&&M.path[0]!=="/"){var m=C.exec(M.path);M.netLoc=m[1],M.path=m[2]}M.netLoc&&!M.path&&(M.path="/");var N={scheme:M.scheme,netLoc:P.netLoc,path:null,params:P.params,query:P.query,fragment:P.fragment};if(!P.netLoc&&(N.netLoc=M.netLoc,P.path[0]!=="/"))if(!P.path)N.path=M.path,P.params||(N.params=M.params,P.query||(N.query=M.query));else{var I=M.path,h=I.substring(0,I.lastIndexOf("/")+1)+P.path;N.path=R.normalizePath(h)}return N.path===null&&(N.path=F.alwaysNormalize?R.normalizePath(P.path):P.path),R.buildURLFromParts(N)},parseURL:function(K){var k=s.exec(K);return k?{scheme:k[1]||"",netLoc:k[2]||"",path:k[3]||"",params:k[4]||"",query:k[5]||"",fragment:k[6]||""}:null},normalizePath:function(K){for(K=K.split("").reverse().join("").replace(g,"");K.length!==(K=K.replace(w,"")).length;);return K.split("").reverse().join("")},buildURLFromParts:function(K){return K.scheme+K.netLoc+K.path+K.params+K.query+K.fragment}};x.exports=R})()}},n={};function i(x){var b=n[x];if(b!==void 0)return b.exports;var s=n[x]={exports:{}};return r[x].call(s.exports,s,s.exports,i),s.exports}i.m=r,i.n=x=>{var b=x&&x.__esModule?()=>x.default:()=>x;return i.d(b,{a:b}),b},i.d=(x,b)=>{for(var s in b)i.o(b,s)&&!i.o(x,s)&&Object.defineProperty(x,s,{enumerable:!0,get:b[s]})},i.o=(x,b)=>Object.prototype.hasOwnProperty.call(x,b),i.r=x=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(x,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(x,"__esModule",{value:!0})};var u=i("./src/hls.ts");return u=u.default,u})())})(H_);const nA=aE(Qs);export{Pn as F,$_ as a,_l as b,j_ as c,X_ as d,On as e,il as f,sh as g,lt as h,G_ as i,ad as j,ei as k,Gt as l,V_ as m,nA as n,nh as o,Z_ as p,J_ as q,Y_ as r,z_ as s,K_ as t,Br as u,Q_ as v,W_ as w,q_ as x};
