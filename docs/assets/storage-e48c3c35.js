import{r as L}from"./removeDuplicates-4a376775.js";import{c as S,d as A}from"./index-3f7b967a.js";import{D as O,O as N,K as p,U as h}from"./vendor-7c7bf4c4.js";async function D(a){let t=await y(!1);t.find(i=>i.id===a.id&&i.lang===a.lang)&&(t=t.filter(i=>i.id!==a.id||i.lang!==a.lang)),t.push(a),localStorage.setItem("lastUpdated",String(Date.now())),localStorage.setItem("animeList",JSON.stringify(L(t)))}function U(a,t,i){const s=localStorage.getItem("animeList");return(s?JSON.parse(s):[]).find(n=>n.id===a&&n.episode===t&&n.lang===i)}async function y(a=!0){let t=localStorage.getItem("animeList");const i=localStorage.getItem("lastUpdated");let s=[];if(a){const n=S.currentUser;if(n){const r=O(A,"users",n.uid),g=await N(r);if(g){const e=g.data();if(e)if(t){if(e.animeList&&e.animeList.length>0){let c=JSON.parse(t),m=!1;if(c.length!==e.animeList.length)m=!0;else for(let o=0;o<e.animeList.length;o++){const l=e.animeList[o],d=c.find(f=>f.id===l.id&&f.lang===l.lang);if(d&&(d.episode!==l.episode||d.time!==l.time)){m=!0;break}}m&&(i&&e.updatedAt?Number(i)<e.updatedAt?(localStorage.setItem("animeList",JSON.stringify(e.animeList)),t=JSON.stringify(e.animeList)):(await p(r,{animeList:JSON.parse(t),updatedAt:Date.now()}),localStorage.setItem("lastUpdated",String(Date.now()))):(await p(r,{animeList:JSON.parse(t),updatedAt:Date.now()}),localStorage.setItem("lastUpdated",String(e.updatedAt))))}}else s=e.animeList?e.animeList:[],localStorage.setItem("animeList",JSON.stringify(s));else t&&h(r,{animeList:JSON.parse(t),updatedAt:Date.now()})}}}return t?JSON.parse(t):s}export{y as a,U as g,D as s};
