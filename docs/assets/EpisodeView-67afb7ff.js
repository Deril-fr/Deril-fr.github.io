import{a as xa,g as Fa,s as Ma,b as Na}from"./index-14f40d11.js";import{a as Ua,b as Ba}from"./animehelper-da611cd9.js";import{z as Ka,o as Ga,c as ja,b as Ha}from"./vendor-91cf30d1.js";var Va=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qa(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Xr={},Ya={get exports(){return Xr},set exports(o){Xr=o}};(function(o,g){typeof window<"u"&&function(c,v){o.exports=v()}(Va,()=>(()=>{var c={21:(w,L,R)=>{R.r(L),R.d(L,{default:()=>de});var B=function(){function Q(ie,q){this.subtle=void 0,this.aesIV=void 0,this.subtle=ie,this.aesIV=q}return Q.prototype.decrypt=function(ie,q){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},q,ie)},Q}(),H=function(){function Q(ie,q){this.subtle=void 0,this.key=void 0,this.subtle=ie,this.key=q}return Q.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},Q}(),N=R(145),p=function(){function Q(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var ie=Q.prototype;return ie.uint8ArrayToUint32Array_=function(q){for(var j=new DataView(q),re=new Uint32Array(4),X=0;X<4;X++)re[X]=j.getUint32(4*X);return re},ie.initTable=function(){var q=this.sBox,j=this.invSBox,re=this.subMix,X=re[0],z=re[1],$=re[2],ve=re[3],be=this.invSubMix,Ne=be[0],J=be[1],A=be[2],G=be[3],O=new Uint32Array(256),se=0,ye=0,me=0;for(me=0;me<256;me++)O[me]=me<128?me<<1:me<<1^283;for(me=0;me<256;me++){var ge=ye^ye<<1^ye<<2^ye<<3^ye<<4;ge=ge>>>8^255&ge^99,q[se]=ge,j[ge]=se;var Pe=O[se],xe=O[Pe],Fe=O[xe],_e=257*O[ge]^16843008*ge;X[se]=_e<<24|_e>>>8,z[se]=_e<<16|_e>>>16,$[se]=_e<<8|_e>>>24,ve[se]=_e,_e=16843009*Fe^65537*xe^257*Pe^16843008*se,Ne[ge]=_e<<24|_e>>>8,J[ge]=_e<<16|_e>>>16,A[ge]=_e<<8|_e>>>24,G[ge]=_e,se?(se=Pe^O[O[O[Fe^Pe]]],ye^=O[O[ye]]):se=ye=1}},ie.expandKey=function(q){for(var j=this.uint8ArrayToUint32Array_(q),re=!0,X=0;X<j.length&&re;)re=j[X]===this.key[X],X++;if(!re){this.key=j;var z=this.keySize=j.length;if(z!==4&&z!==6&&z!==8)throw new Error("Invalid aes key size="+z);var $,ve,be,Ne,J=this.ksRows=4*(z+6+1),A=this.keySchedule=new Uint32Array(J),G=this.invKeySchedule=new Uint32Array(J),O=this.sBox,se=this.rcon,ye=this.invSubMix,me=ye[0],ge=ye[1],Pe=ye[2],xe=ye[3];for($=0;$<J;$++)$<z?be=A[$]=j[$]:(Ne=be,$%z==0?(Ne=O[(Ne=Ne<<8|Ne>>>24)>>>24]<<24|O[Ne>>>16&255]<<16|O[Ne>>>8&255]<<8|O[255&Ne],Ne^=se[$/z|0]<<24):z>6&&$%z==4&&(Ne=O[Ne>>>24]<<24|O[Ne>>>16&255]<<16|O[Ne>>>8&255]<<8|O[255&Ne]),A[$]=be=(A[$-z]^Ne)>>>0);for(ve=0;ve<J;ve++)$=J-ve,Ne=3&ve?A[$]:A[$-4],G[ve]=ve<4||$<=4?Ne:me[O[Ne>>>24]]^ge[O[Ne>>>16&255]]^Pe[O[Ne>>>8&255]]^xe[O[255&Ne]],G[ve]=G[ve]>>>0}},ie.networkToHostOrderSwap=function(q){return q<<24|(65280&q)<<8|(16711680&q)>>8|q>>>24},ie.decrypt=function(q,j,re){for(var X,z,$,ve,be,Ne,J,A,G,O,se,ye,me,ge,Pe=this.keySize+6,xe=this.invKeySchedule,Fe=this.invSBox,_e=this.invSubMix,$e=_e[0],at=_e[1],te=_e[2],ce=_e[3],ee=this.uint8ArrayToUint32Array_(re),Se=ee[0],Te=ee[1],we=ee[2],Le=ee[3],Ce=new Int32Array(q),oe=new Int32Array(Ce.length),Ee=this.networkToHostOrderSwap;j<Ce.length;){for(G=Ee(Ce[j]),O=Ee(Ce[j+1]),se=Ee(Ce[j+2]),ye=Ee(Ce[j+3]),be=G^xe[0],Ne=ye^xe[1],J=se^xe[2],A=O^xe[3],me=4,ge=1;ge<Pe;ge++)X=$e[be>>>24]^at[Ne>>16&255]^te[J>>8&255]^ce[255&A]^xe[me],z=$e[Ne>>>24]^at[J>>16&255]^te[A>>8&255]^ce[255&be]^xe[me+1],$=$e[J>>>24]^at[A>>16&255]^te[be>>8&255]^ce[255&Ne]^xe[me+2],ve=$e[A>>>24]^at[be>>16&255]^te[Ne>>8&255]^ce[255&J]^xe[me+3],be=X,Ne=z,J=$,A=ve,me+=4;X=Fe[be>>>24]<<24^Fe[Ne>>16&255]<<16^Fe[J>>8&255]<<8^Fe[255&A]^xe[me],z=Fe[Ne>>>24]<<24^Fe[J>>16&255]<<16^Fe[A>>8&255]<<8^Fe[255&be]^xe[me+1],$=Fe[J>>>24]<<24^Fe[A>>16&255]<<16^Fe[be>>8&255]<<8^Fe[255&Ne]^xe[me+2],ve=Fe[A>>>24]<<24^Fe[be>>16&255]<<16^Fe[Ne>>8&255]<<8^Fe[255&J]^xe[me+3],oe[j]=Ee(X^Se),oe[j+1]=Ee(ve^Te),oe[j+2]=Ee($^we),oe[j+3]=Ee(z^Le),Se=G,Te=O,we=se,Le=ye,j+=4}return oe.buffer},Q}(),I=R(93),_=R(63),de=function(){function Q(q,j){var re=(j===void 0?{}:j).removePKCS7Padding,X=re===void 0||re;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=q.enableSoftwareAES,this.removePKCS7Padding=X,X)try{var z=self.crypto;z&&(this.subtle=z.subtle||z.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}var ie=Q.prototype;return ie.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},ie.isSync=function(){return this.useSoftware},ie.flush=function(){var q=this.currentResult,j=this.remainderData;if(!q||j)return I.logger.error("[softwareDecrypt] "+(j?"overflow bytes: "+j.byteLength:"no result")),this.reset(),null;var re,X,z,$=new Uint8Array(q);return this.reset(),this.removePKCS7Padding?(z=(X=(re=$).byteLength)&&new DataView(re.buffer).getUint8(X-1))?(0,N.sliceUint8)(re,0,X-z):re:$},ie.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},ie.decrypt=function(q,j,re){var X=this;return this.useSoftware?new Promise(function(z,$){X.softwareDecrypt(new Uint8Array(q),j,re);var ve=X.flush();ve?z(ve.buffer):$(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(q),j,re)},ie.softwareDecrypt=function(q,j,re){var X=this.currentIV,z=this.currentResult,$=this.remainderData;this.logOnce("JS AES decrypt"),$&&(q=(0,_.appendUint8Array)($,q),this.remainderData=null);var ve=this.getValidChunk(q);if(!ve.length)return null;X&&(re=X);var be=this.softwareDecrypter;be||(be=this.softwareDecrypter=new p),be.expandKey(j);var Ne=z;return this.currentResult=be.decrypt(ve.buffer,0,re),this.currentIV=(0,N.sliceUint8)(ve,-16).buffer,Ne||null},ie.webCryptoDecrypt=function(q,j,re){var X=this,z=this.subtle;return this.key===j&&this.fastAesKey||(this.key=j,this.fastAesKey=new H(z,j)),this.fastAesKey.expandKey().then(function($){return z?(X.logOnce("WebCrypto AES decrypt"),new B(z,new Uint8Array(re)).decrypt(q.buffer,$)):Promise.reject(new Error("web crypto not initialized"))}).catch(function($){return I.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+$.name+": "+$.message),X.onWebCryptoError(q,j,re)})},ie.onWebCryptoError=function(q,j,re){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(q,j,re);var X=this.flush();if(X)return X.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},ie.getValidChunk=function(q){var j=q,re=q.length-q.length%16;return re!==q.length&&(j=(0,N.sliceUint8)(q,0,re),this.remainderData=(0,N.sliceUint8)(q,re)),j},ie.logOnce=function(q){this.logEnabled&&(I.logger.log("[decrypter]: "+q),this.logEnabled=!1)},Q}()},181:(w,L,R)=>{R.r(L),R.d(L,{canParse:()=>_,decodeFrame:()=>j,getID3Data:()=>p,getID3Frames:()=>q,getTimeStamp:()=>de,isFooter:()=>N,isHeader:()=>H,isTimeStampFrame:()=>Q,testables:()=>be,utf8ArrayToStr:()=>ve});var B,H=function(J,A){return A+10<=J.length&&J[A]===73&&J[A+1]===68&&J[A+2]===51&&J[A+3]<255&&J[A+4]<255&&J[A+6]<128&&J[A+7]<128&&J[A+8]<128&&J[A+9]<128},N=function(J,A){return A+10<=J.length&&J[A]===51&&J[A+1]===68&&J[A+2]===73&&J[A+3]<255&&J[A+4]<255&&J[A+6]<128&&J[A+7]<128&&J[A+8]<128&&J[A+9]<128},p=function(J,A){for(var G=A,O=0;H(J,A);)O+=10,O+=I(J,A+6),N(J,A+10)&&(O+=10),A+=O;if(O>0)return J.subarray(G,G+O)},I=function(J,A){var G=0;return G=(127&J[A])<<21,G|=(127&J[A+1])<<14,(G|=(127&J[A+2])<<7)|127&J[A+3]},_=function(J,A){return H(J,A)&&I(J,A+6)+10<=J.length-A},de=function(J){for(var A=q(J),G=0;G<A.length;G++){var O=A[G];if(Q(O))return $(O)}},Q=function(J){return J&&J.key==="PRIV"&&J.info==="com.apple.streaming.transportStreamTimestamp"},ie=function(J){var A=String.fromCharCode(J[0],J[1],J[2],J[3]),G=I(J,4);return{type:A,size:G,data:J.subarray(10,10+G)}},q=function(J){for(var A=0,G=[];H(J,A);){for(var O=I(J,A+6),se=(A+=10)+O;A+8<se;){var ye=ie(J.subarray(A)),me=j(ye);me&&G.push(me),A+=ye.size+10}N(J,A)&&(A+=10)}return G},j=function(J){return J.type==="PRIV"?re(J):J.type[0]==="W"?z(J):X(J)},re=function(J){if(!(J.size<2)){var A=ve(J.data,!0),G=new Uint8Array(J.data.subarray(A.length+1));return{key:J.type,info:A,data:G.buffer}}},X=function(J){if(!(J.size<2)){if(J.type==="TXXX"){var A=1,G=ve(J.data.subarray(A),!0);A+=G.length+1;var O=ve(J.data.subarray(A));return{key:J.type,info:G,data:O}}var se=ve(J.data.subarray(1));return{key:J.type,data:se}}},z=function(J){if(J.type==="WXXX"){if(J.size<2)return;var A=1,G=ve(J.data.subarray(A),!0);A+=G.length+1;var O=ve(J.data.subarray(A));return{key:J.type,info:G,data:O}}var se=ve(J.data);return{key:J.type,data:se}},$=function(J){if(J.data.byteLength===8){var A=new Uint8Array(J.data),G=1&A[3],O=(A[4]<<23)+(A[5]<<15)+(A[6]<<7)+A[7];return O/=45,G&&(O+=4772185884e-2),Math.round(O)}},ve=function(J,A){A===void 0&&(A=!1);var G=Ne();if(G){var O=G.decode(J);if(A){var se=O.indexOf("\0");return se!==-1?O.substring(0,se):O}return O.replace(/\0/g,"")}for(var ye,me,ge,Pe=J.length,xe="",Fe=0;Fe<Pe;){if((ye=J[Fe++])===0&&A)return xe;if(ye!==0&&ye!==3)switch(ye>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:xe+=String.fromCharCode(ye);break;case 12:case 13:me=J[Fe++],xe+=String.fromCharCode((31&ye)<<6|63&me);break;case 14:me=J[Fe++],ge=J[Fe++],xe+=String.fromCharCode((15&ye)<<12|(63&me)<<6|(63&ge)<<0)}}return xe},be={decodeTextFrame:X};function Ne(){return B||self.TextDecoder===void 0||(B=new self.TextDecoder("utf-8")),B}},182:(w,L,R)=>{R.r(L),R.d(L,{default:()=>_});var B=R(544),H=R(851),N=R(93),p=R(729),I=R(973);function _(q){var j=new p.EventEmitter,re=function(X,z){q.postMessage({event:X,data:z})};j.on(H.Events.FRAG_DECRYPTED,re),j.on(H.Events.ERROR,re),q.addEventListener("message",function(X){var z=X.data;switch(z.cmd){case"init":var $=JSON.parse(z.config);q.transmuxer=new B.default(j,z.typeSupported,$,z.vendor,z.id),(0,N.enableLogs)($.debug,z.id),function(){var J=function(G){N.logger[G]=function(O){re("workerLog",{logType:G,message:O})}};for(var A in N.logger)J(A)}(),re("init",null);break;case"configure":q.transmuxer.configure(z.config);break;case"demux":var ve=q.transmuxer.push(z.data,z.decryptdata,z.chunkMeta,z.state);(0,B.isPromise)(ve)?(q.transmuxer.async=!0,ve.then(function(J){de(q,J)}).catch(function(J){re(H.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:z.chunkMeta,fatal:!1,error:J,err:J,reason:"transmuxer-worker push error"})})):(q.transmuxer.async=!1,de(q,ve));break;case"flush":var be=z.chunkMeta,Ne=q.transmuxer.flush(be);(0,B.isPromise)(Ne)||q.transmuxer.async?((0,B.isPromise)(Ne)||(Ne=Promise.resolve(Ne)),Ne.then(function(J){ie(q,J,be)}).catch(function(J){re(H.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:z.chunkMeta,fatal:!1,error:J,err:J,reason:"transmuxer-worker flush error"})})):ie(q,Ne,be)}})}function de(q,j){if(!((re=j.remuxResult).audio||re.video||re.text||re.id3||re.initSegment))return!1;var re,X=[],z=j.remuxResult,$=z.audio,ve=z.video;return $&&Q(X,$),ve&&Q(X,ve),q.postMessage({event:"transmuxComplete",data:j},X),!0}function Q(q,j){j.data1&&q.push(j.data1.buffer),j.data2&&q.push(j.data2.buffer)}function ie(q,j,re){j.reduce(function(X,z){return de(q,z)||X},!1)||q.postMessage({event:"transmuxComplete",data:j[0]}),q.postMessage({event:"flush",data:re})}},544:(w,L,R)=>{R.r(L),R.d(L,{TransmuxConfig:()=>It,TransmuxState:()=>Ht,default:()=>Et,isPromise:()=>Mt});var B=R(851),H=R(973),N=R(21),p=R(965),I=R(181),_=R(856);function de(W,M){return W===void 0&&(W=""),M===void 0&&(M=9e4),{type:W,id:-1,pid:-1,inputTimeScale:M,sequenceNumber:-1,samples:[],dropped:0}}var Q=R(63),ie=R(145),q=function(){function W(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var M=W.prototype;return M.resetInitSegment=function(b,x,C,U){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},M.resetTimeStamp=function(b){this.initPTS=b,this.resetContiguity()},M.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},M.canParse=function(b,x){return!1},M.appendFrame=function(b,x,C){},M.demux=function(b,x){this.cachedData&&(b=(0,Q.appendUint8Array)(this.cachedData,b),this.cachedData=null);var C,U=I.getID3Data(b,0),V=U?U.length:0,Y=this._audioTrack,ae=this._id3Track,fe=U?I.getTimeStamp(U):void 0,pe=b.length;for((this.basePTS===null||this.frameIndex===0&&(0,p.isFiniteNumber)(fe))&&(this.basePTS=j(fe,x,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),U&&U.length>0&&ae.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:U,type:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});V<pe;){if(this.canParse(b,V)){var ke=this.appendFrame(Y,b,V);ke?(this.frameIndex++,this.lastPTS=ke.sample.pts,C=V+=ke.length):V=pe}else I.canParse(b,V)?(U=I.getID3Data(b,V),ae.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:U,type:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),C=V+=U.length):V++;if(V===pe&&C!==pe){var Ue=(0,ie.sliceUint8)(b,C);this.cachedData?this.cachedData=(0,Q.appendUint8Array)(this.cachedData,Ue):this.cachedData=Ue}}return{audioTrack:Y,videoTrack:de(),id3Track:ae,textTrack:de()}},M.demuxSampleAes=function(b,x,C){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},M.flush=function(b){var x=this.cachedData;return x&&(this.cachedData=null,this.demux(x,0)),{audioTrack:this._audioTrack,videoTrack:de(),id3Track:this._id3Track,textTrack:de()}},M.destroy=function(){},W}(),j=function(W,M,b){return(0,p.isFiniteNumber)(W)?90*W:9e4*M+(b||0)};const re=q;var X=R(93);function z(W,M){return W[M]===255&&(246&W[M+1])==240}function $(W,M){return 1&W[M+1]?7:9}function ve(W,M){return(3&W[M+3])<<11|W[M+4]<<3|(224&W[M+5])>>>5}function be(W,M){return M+1<W.length&&z(W,M)}function Ne(W,M){if(be(W,M)){var b=$(W,M);if(M+b>=W.length)return!1;var x=ve(W,M);if(x<=b)return!1;var C=M+x;return C===W.length||be(W,C)}return!1}function J(W,M,b,x,C){if(!W.samplerate){var U=function(V,Y,ae,fe){var pe,ke,Ue,De,je=navigator.userAgent.toLowerCase(),ze=fe,ot=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];pe=1+((192&Y[ae+2])>>>6);var Ke=(60&Y[ae+2])>>>2;if(!(Ke>ot.length-1))return Ue=(1&Y[ae+2])<<2,Ue|=(192&Y[ae+3])>>>6,X.logger.log("manifest codec:"+fe+", ADTS type:"+pe+", samplingIndex:"+Ke),/firefox/i.test(je)?Ke>=6?(pe=5,De=new Array(4),ke=Ke-3):(pe=2,De=new Array(2),ke=Ke):je.indexOf("android")!==-1?(pe=2,De=new Array(2),ke=Ke):(pe=5,De=new Array(4),fe&&(fe.indexOf("mp4a.40.29")!==-1||fe.indexOf("mp4a.40.5")!==-1)||!fe&&Ke>=6?ke=Ke-3:((fe&&fe.indexOf("mp4a.40.2")!==-1&&(Ke>=6&&Ue===1||/vivaldi/i.test(je))||!fe&&Ue===1)&&(pe=2,De=new Array(2)),ke=Ke)),De[0]=pe<<3,De[0]|=(14&Ke)>>1,De[1]|=(1&Ke)<<7,De[1]|=Ue<<3,pe===5&&(De[1]|=(14&ke)>>1,De[2]=(1&ke)<<7,De[2]|=8,De[3]=0),{config:De,samplerate:ot[Ke],channelCount:Ue,codec:"mp4a.40."+pe,manifestCodec:ze};V.trigger(B.Events.ERROR,{type:H.ErrorTypes.MEDIA_ERROR,details:H.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+Ke})}(M,b,x,C);if(!U)return;W.config=U.config,W.samplerate=U.samplerate,W.channelCount=U.channelCount,W.codec=U.codec,W.manifestCodec=U.manifestCodec,X.logger.log("parsed codec:"+W.codec+", rate:"+U.samplerate+", channels:"+U.channelCount)}}function A(W){return 9216e4/W}function G(W,M,b,x,C){var U,V=x+C*A(W.samplerate),Y=function(je,ze){var ot=$(je,ze);if(ze+ot<=je.length){var Ke=ve(je,ze)-ot;if(Ke>0)return{headerLength:ot,frameLength:Ke}}}(M,b);if(Y){var ae=Y.frameLength,fe=Y.headerLength,pe=fe+ae,ke=Math.max(0,b+pe-M.length);ke?(U=new Uint8Array(pe-fe)).set(M.subarray(b+fe,M.length),0):U=M.subarray(b+fe,b+pe);var Ue={unit:U,pts:V};return ke||W.samples.push(Ue),{sample:Ue,length:pe,missing:ke}}var De=M.length-b;return(U=new Uint8Array(De)).set(M.subarray(b,M.length),0),{sample:{unit:U,pts:V},length:De,missing:-1}}function O(W,M){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(b,x){return b.__proto__=x,b},O(W,M)}const se=function(W){var M,b;function x(U,V){var Y;return(Y=W.call(this)||this).observer=void 0,Y.config=void 0,Y.observer=U,Y.config=V,Y}b=W,(M=x).prototype=Object.create(b.prototype),M.prototype.constructor=M,O(M,b);var C=x.prototype;return C.resetInitSegment=function(U,V,Y,ae){W.prototype.resetInitSegment.call(this,U,V,Y,ae),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:V,duration:ae,inputTimeScale:9e4,dropped:0}},x.probe=function(U){if(!U)return!1;for(var V=(I.getID3Data(U,0)||[]).length,Y=U.length;V<Y;V++)if(Ne(U,V))return X.logger.log("ADTS sync word found !"),!0;return!1},C.canParse=function(U,V){return function(Y,ae){return function(fe,pe){return pe+5<fe.length}(Y,ae)&&z(Y,ae)&&ve(Y,ae)<=Y.length-ae}(U,V)},C.appendFrame=function(U,V,Y){J(U,this.observer,V,Y,U.manifestCodec);var ae=G(U,V,Y,this.basePTS,this.frameIndex);if(ae&&ae.missing===0)return ae},x}(re);var ye=/\/emsg[-/]ID3/i;const me=function(){function W(b,x){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=x}var M=W.prototype;return M.resetTimeStamp=function(){},M.resetInitSegment=function(b,x,C,U){var V=this.videoTrack=de("video",1),Y=this.audioTrack=de("audio",1),ae=this.txtTrack=de("text",1);if(this.id3Track=de("id3",1),this.timeOffset=0,b&&b.byteLength){var fe=(0,Q.parseInitSegment)(b);if(fe.video){var pe=fe.video,ke=pe.id,Ue=pe.timescale,De=pe.codec;V.id=ke,V.timescale=ae.timescale=Ue,V.codec=De}if(fe.audio){var je=fe.audio,ze=je.id,ot=je.timescale,Ke=je.codec;Y.id=ze,Y.timescale=ot,Y.codec=Ke}ae.id=Q.RemuxerTrackIdConfig.text,V.sampleDuration=0,V.duration=Y.duration=U}},M.resetContiguity=function(){},W.probe=function(b){return b=b.length>16384?b.subarray(0,16384):b,(0,Q.findBox)(b,["moof"]).length>0},M.demux=function(b,x){this.timeOffset=x;var C=b,U=this.videoTrack,V=this.txtTrack;if(this.config.progressive){this.remainderData&&(C=(0,Q.appendUint8Array)(this.remainderData,b));var Y=(0,Q.segmentValidRange)(C);this.remainderData=Y.remainder,U.samples=Y.valid||new Uint8Array}else U.samples=C;var ae=this.extractID3Track(U,x);return V.samples=(0,Q.parseSamples)(x,U),{videoTrack:U,audioTrack:this.audioTrack,id3Track:ae,textTrack:this.txtTrack}},M.flush=function(){var b=this.timeOffset,x=this.videoTrack,C=this.txtTrack;x.samples=this.remainderData||new Uint8Array,this.remainderData=null;var U=this.extractID3Track(x,this.timeOffset);return C.samples=(0,Q.parseSamples)(b,x),{videoTrack:x,audioTrack:de(),id3Track:U,textTrack:de()}},M.extractID3Track=function(b,x){var C=this.id3Track;if(b.samples.length){var U=(0,Q.findBox)(b.samples,["emsg"]);U&&U.forEach(function(V){var Y=(0,Q.parseEmsg)(V);if(ye.test(Y.schemeIdUri)){var ae=(0,p.isFiniteNumber)(Y.presentationTime)?Y.presentationTime/Y.timeScale:x+Y.presentationTimeDelta/Y.timeScale,fe=Y.eventDuration===4294967295?Number.POSITIVE_INFINITY:Y.eventDuration/Y.timeScale;fe<=.001&&(fe=Number.POSITIVE_INFINITY);var pe=Y.payload;C.samples.push({data:pe,len:pe.byteLength,dts:ae,pts:ae,type:_.MetadataSchema.emsg,duration:fe})}})}return C},M.demuxSampleAes=function(b,x,C){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},M.destroy=function(){},W}();var ge=null,Pe=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],xe=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Fe=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_e=[0,1,1,4];function $e(W,M,b,x,C){if(!(b+24>M.length)){var U=at(M,b);if(U&&b+U.frameLength<=M.length){var V=x+C*(9e4*U.samplesPerFrame/U.sampleRate),Y={unit:M.subarray(b,b+U.frameLength),pts:V,dts:V};return W.config=[],W.channelCount=U.channelCount,W.samplerate=U.sampleRate,W.samples.push(Y),{sample:Y,length:U.frameLength,missing:0}}}}function at(W,M){var b=W[M+1]>>3&3,x=W[M+1]>>1&3,C=W[M+2]>>4&15,U=W[M+2]>>2&3;if(b!==1&&C!==0&&C!==15&&U!==3){var V=W[M+2]>>1&1,Y=W[M+3]>>6,ae=1e3*Pe[14*(b===3?3-x:x===3?3:4)+C-1],fe=xe[3*(b===3?0:b===2?1:2)+U],pe=Y===3?1:2,ke=Fe[b][x],Ue=_e[x],De=8*ke*Ue,je=Math.floor(ke*ae/fe+V)*Ue;if(ge===null){var ze=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ge=ze?parseInt(ze[1]):0}return ge&&ge<=87&&x===2&&ae>=224e3&&Y===0&&(W[M+3]=128|W[M+3]),{sampleRate:fe,channelCount:pe,frameLength:je,samplesPerFrame:De}}}function te(W,M){return W[M]===255&&(224&W[M+1])==224&&(6&W[M+1])!=0}function ce(W,M){return M+1<W.length&&te(W,M)}function ee(W,M){if(M+1<W.length&&te(W,M)){var b=at(W,M),x=4;b!=null&&b.frameLength&&(x=b.frameLength);var C=M+x;return C===W.length||ce(W,C)}return!1}const Se=function(){function W(b){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=b,this.bytesAvailable=b.byteLength,this.word=0,this.bitsAvailable=0}var M=W.prototype;return M.loadWord=function(){var b=this.data,x=this.bytesAvailable,C=b.byteLength-x,U=new Uint8Array(4),V=Math.min(4,x);if(V===0)throw new Error("no bytes available");U.set(b.subarray(C,C+V)),this.word=new DataView(U.buffer).getUint32(0),this.bitsAvailable=8*V,this.bytesAvailable-=V},M.skipBits=function(b){var x;b=Math.min(b,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>b?(this.word<<=b,this.bitsAvailable-=b):(b-=this.bitsAvailable,b-=(x=b>>3)<<3,this.bytesAvailable-=x,this.loadWord(),this.word<<=b,this.bitsAvailable-=b)},M.readBits=function(b){var x=Math.min(this.bitsAvailable,b),C=this.word>>>32-x;if(b>32&&X.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=x,this.bitsAvailable>0)this.word<<=x;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(x=b-x)>0&&this.bitsAvailable?C<<x|this.readBits(x):C},M.skipLZ=function(){var b;for(b=0;b<this.bitsAvailable;++b)if(this.word&2147483648>>>b)return this.word<<=b,this.bitsAvailable-=b,b;return this.loadWord(),b+this.skipLZ()},M.skipUEG=function(){this.skipBits(1+this.skipLZ())},M.skipEG=function(){this.skipBits(1+this.skipLZ())},M.readUEG=function(){var b=this.skipLZ();return this.readBits(b+1)-1},M.readEG=function(){var b=this.readUEG();return 1&b?1+b>>>1:-1*(b>>>1)},M.readBoolean=function(){return this.readBits(1)===1},M.readUByte=function(){return this.readBits(8)},M.readUShort=function(){return this.readBits(16)},M.readUInt=function(){return this.readBits(32)},M.skipScalingList=function(b){for(var x=8,C=8,U=0;U<b;U++)C!==0&&(C=(x+this.readEG()+256)%256),x=C===0?x:C},M.readSPS=function(){var b,x,C,U=0,V=0,Y=0,ae=0,fe=this.readUByte.bind(this),pe=this.readBits.bind(this),ke=this.readUEG.bind(this),Ue=this.readBoolean.bind(this),De=this.skipBits.bind(this),je=this.skipEG.bind(this),ze=this.skipUEG.bind(this),ot=this.skipScalingList.bind(this);fe();var Ke=fe();if(pe(5),De(3),fe(),ze(),Ke===100||Ke===110||Ke===122||Ke===244||Ke===44||Ke===83||Ke===86||Ke===118||Ke===128){var mt=ke();if(mt===3&&De(1),ze(),ze(),De(1),Ue())for(x=mt!==3?8:12,C=0;C<x;C++)Ue()&&ot(C<6?16:64)}ze();var Ut=ke();if(Ut===0)ke();else if(Ut===1)for(De(1),je(),je(),b=ke(),C=0;C<b;C++)je();ze(),De(1);var At=ke(),Tt=ke(),Lt=pe(1);Lt===0&&De(1),De(1),Ue()&&(U=ke(),V=ke(),Y=ke(),ae=ke());var He=[1,1];if(Ue()&&Ue())switch(fe()){case 1:He=[1,1];break;case 2:He=[12,11];break;case 3:He=[10,11];break;case 4:He=[16,11];break;case 5:He=[40,33];break;case 6:He=[24,11];break;case 7:He=[20,11];break;case 8:He=[32,11];break;case 9:He=[80,33];break;case 10:He=[18,11];break;case 11:He=[15,11];break;case 12:He=[64,33];break;case 13:He=[160,99];break;case 14:He=[4,3];break;case 15:He=[3,2];break;case 16:He=[2,1];break;case 255:He=[fe()<<8|fe(),fe()<<8|fe()]}return{width:Math.ceil(16*(At+1)-2*U-2*V),height:(2-Lt)*(Tt+1)*16-(Lt?2:4)*(Y+ae),pixelRatio:He}},M.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},W}(),Te=function(){function W(b,x,C){this.keyData=void 0,this.decrypter=void 0,this.keyData=C,this.decrypter=new N.default(x,{removePKCS7Padding:!1})}var M=W.prototype;return M.decryptBuffer=function(b){return this.decrypter.decrypt(b,this.keyData.key.buffer,this.keyData.iv.buffer)},M.decryptAacSample=function(b,x,C){var U=this,V=b[x].unit;if(!(V.length<=16)){var Y=V.subarray(16,V.length-V.length%16),ae=Y.buffer.slice(Y.byteOffset,Y.byteOffset+Y.length);this.decryptBuffer(ae).then(function(fe){var pe=new Uint8Array(fe);V.set(pe,16),U.decrypter.isSync()||U.decryptAacSamples(b,x+1,C)})}},M.decryptAacSamples=function(b,x,C){for(;;x++){if(x>=b.length)return void C();if(!(b[x].unit.length<32||(this.decryptAacSample(b,x,C),this.decrypter.isSync())))return}},M.getAvcEncryptedData=function(b){for(var x=16*Math.floor((b.length-48)/160)+16,C=new Int8Array(x),U=0,V=32;V<b.length-16;V+=160,U+=16)C.set(b.subarray(V,V+16),U);return C},M.getAvcDecryptedUnit=function(b,x){for(var C=new Uint8Array(x),U=0,V=32;V<b.length-16;V+=160,U+=16)b.set(C.subarray(U,U+16),V);return b},M.decryptAvcSample=function(b,x,C,U,V){var Y=this,ae=(0,Q.discardEPB)(V.data),fe=this.getAvcEncryptedData(ae);this.decryptBuffer(fe.buffer).then(function(pe){V.data=Y.getAvcDecryptedUnit(ae,pe),Y.decrypter.isSync()||Y.decryptAvcSamples(b,x,C+1,U)})},M.decryptAvcSamples=function(b,x,C,U){if(b instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;x++,C=0){if(x>=b.length)return void U();for(var V=b[x].units;!(C>=V.length);C++){var Y=V[C];if(!(Y.data.length<=48||Y.type!==1&&Y.type!==5||(this.decryptAvcSample(b,x,C,U,Y),this.decrypter.isSync())))return}}},W}();function we(){return we=Object.assign?Object.assign.bind():function(W){for(var M=1;M<arguments.length;M++){var b=arguments[M];for(var x in b)Object.prototype.hasOwnProperty.call(b,x)&&(W[x]=b[x])}return W},we.apply(this,arguments)}var Le=188;function Ce(W,M,b,x){return{key:W,frame:!1,pts:M,dts:b,units:[],debug:x,length:0}}function oe(W,M){return(31&W[M+10])<<8|W[M+11]}function Ee(W,M,b,x){var C={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},U=M+3+((15&W[M+1])<<8|W[M+2])-4;for(M+=12+((15&W[M+10])<<8|W[M+11]);M<U;){var V=(31&W[M+1])<<8|W[M+2];switch(W[M]){case 207:if(!x){X.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:C.audio===-1&&(C.audio=V);break;case 21:C.id3===-1&&(C.id3=V);break;case 219:if(!x){X.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:C.avc===-1&&(C.avc=V);break;case 3:case 4:b.mpeg!==!0&&b.mp3!==!0?X.logger.log("MPEG audio found, not supported in this browser"):C.audio===-1&&(C.audio=V,C.segmentCodec="mp3");break;case 36:X.logger.warn("Unsupported HEVC stream type found")}M+=5+((15&W[M+3])<<8|W[M+4])}return C}function Be(W){var M,b,x,C,U,V=0,Y=W.data;if(!W||W.size===0)return null;for(;Y[0].length<19&&Y.length>1;){var ae=new Uint8Array(Y[0].length+Y[1].length);ae.set(Y[0]),ae.set(Y[1],Y[0].length),Y[0]=ae,Y.splice(1,1)}if(((M=Y[0])[0]<<16)+(M[1]<<8)+M[2]===1){if((b=(M[4]<<8)+M[5])&&b>W.size-6)return null;var fe=M[7];192&fe&&(C=536870912*(14&M[9])+4194304*(255&M[10])+16384*(254&M[11])+128*(255&M[12])+(254&M[13])/2,64&fe?C-(U=536870912*(14&M[14])+4194304*(255&M[15])+16384*(254&M[16])+128*(255&M[17])+(254&M[18])/2)>54e5&&(X.logger.warn(Math.round((C-U)/9e4)+"s delta between PTS and DTS, align them"),C=U):U=C);var pe=(x=M[8])+9;if(W.size<=pe)return null;W.size-=pe;for(var ke=new Uint8Array(W.size),Ue=0,De=Y.length;Ue<De;Ue++){var je=(M=Y[Ue]).byteLength;if(pe){if(pe>je){pe-=je;continue}M=M.subarray(pe),je-=pe,pe=0}ke.set(M,V),V+=je}return b&&(b-=x+3),{data:ke,pts:C,dts:U,len:b}}return null}function Ve(W,M){if(W.units.length&&W.frame){if(W.pts===void 0){var b=M.samples,x=b.length;if(!x)return void M.dropped++;var C=b[x-1];W.pts=C.pts,W.dts=C.dts}M.samples.push(W)}W.debug.length&&X.logger.log(W.pts+"/"+W.dts+":"+W.debug)}const st=function(){function W(b,x,C){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=b,this.config=x,this.typeSupported=C}W.probe=function(b){var x=W.syncOffset(b);return x>0&&X.logger.warn("MPEG2-TS detected but first sync word found @ offset "+x),x!==-1},W.syncOffset=function(b){for(var x=Math.min(940,b.length-376)+1,C=0;C<x;){if(b[C]===71&&b[C+Le]===71)return C;C++}return-1},W.createTrack=function(b,x){return{container:b==="video"||b==="audio"?"video/mp2t":void 0,type:b,id:Q.RemuxerTrackIdConfig[b],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:b==="audio"?x:void 0}};var M=W.prototype;return M.resetInitSegment=function(b,x,C,U){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=W.createTrack("video"),this._audioTrack=W.createTrack("audio",U),this._id3Track=W.createTrack("id3"),this._txtTrack=W.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=x,this.videoCodec=C,this._duration=U},M.resetTimeStamp=function(){},M.resetContiguity=function(){var b=this._audioTrack,x=this._avcTrack,C=this._id3Track;b&&(b.pesData=null),x&&(x.pesData=null),C&&(C.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},M.demux=function(b,x,C,U){var V;C===void 0&&(C=!1),U===void 0&&(U=!1),C||(this.sampleAes=null);var Y=this._avcTrack,ae=this._audioTrack,fe=this._id3Track,pe=this._txtTrack,ke=Y.pid,Ue=Y.pesData,De=ae.pid,je=fe.pid,ze=ae.pesData,ot=fe.pesData,Ke=null,mt=this.pmtParsed,Ut=this._pmtId,At=b.length;if(this.remainderData&&(At=(b=(0,Q.appendUint8Array)(this.remainderData,b)).length,this.remainderData=null),At<Le&&!U)return this.remainderData=b,{audioTrack:ae,videoTrack:Y,id3Track:fe,textTrack:pe};var Tt=Math.max(0,W.syncOffset(b));(At-=(At-Tt)%Le)<b.byteLength&&!U&&(this.remainderData=new Uint8Array(b.buffer,At,b.buffer.byteLength-At));for(var Lt=0,He=Tt;He<At;He+=Le)if(b[He]===71){var jt=!!(64&b[He+1]),ri=((31&b[He+1])<<8)+b[He+2],wt=void 0;if((48&b[He+3])>>4>1){if((wt=He+5+b[He+4])===He+Le)continue}else wt=He+4;switch(ri){case ke:jt&&(Ue&&(V=Be(Ue))&&this.parseAVCPES(Y,pe,V,!1),Ue={data:[],size:0}),Ue&&(Ue.data.push(b.subarray(wt,He+Le)),Ue.size+=He+Le-wt);break;case De:if(jt){if(ze&&(V=Be(ze)))switch(ae.segmentCodec){case"aac":this.parseAACPES(ae,V);break;case"mp3":this.parseMPEGPES(ae,V)}ze={data:[],size:0}}ze&&(ze.data.push(b.subarray(wt,He+Le)),ze.size+=He+Le-wt);break;case je:jt&&(ot&&(V=Be(ot))&&this.parseID3PES(fe,V),ot={data:[],size:0}),ot&&(ot.data.push(b.subarray(wt,He+Le)),ot.size+=He+Le-wt);break;case 0:jt&&(wt+=b[wt]+1),Ut=this._pmtId=oe(b,wt);break;case Ut:jt&&(wt+=b[wt]+1);var xt=Ee(b,wt,this.typeSupported,C);(ke=xt.avc)>0&&(Y.pid=ke),(De=xt.audio)>0&&(ae.pid=De,ae.segmentCodec=xt.segmentCodec),(je=xt.id3)>0&&(fe.pid=je),Ke===null||mt||(X.logger.log("unknown PID '"+Ke+"' in TS found"),Ke=null,He=Tt-188),mt=this.pmtParsed=!0;break;case 17:case 8191:break;default:Ke=ri}}else Lt++;Lt>0&&this.observer.emit(B.Events.ERROR,B.Events.ERROR,{type:H.ErrorTypes.MEDIA_ERROR,details:H.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+Lt+" TS packet/s that do not start with 0x47"}),Y.pesData=Ue,ae.pesData=ze,fe.pesData=ot;var Yt={audioTrack:ae,videoTrack:Y,id3Track:fe,textTrack:pe};return U&&this.extractRemainingSamples(Yt),Yt},M.flush=function(){var b,x=this.remainderData;return this.remainderData=null,b=x?this.demux(x,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(b),this.sampleAes?this.decrypt(b,this.sampleAes):b},M.extractRemainingSamples=function(b){var x,C=b.audioTrack,U=b.videoTrack,V=b.id3Track,Y=b.textTrack,ae=U.pesData,fe=C.pesData,pe=V.pesData;if(ae&&(x=Be(ae))?(this.parseAVCPES(U,Y,x,!0),U.pesData=null):U.pesData=ae,fe&&(x=Be(fe))){switch(C.segmentCodec){case"aac":this.parseAACPES(C,x);break;case"mp3":this.parseMPEGPES(C,x)}C.pesData=null}else fe!=null&&fe.size&&X.logger.log("last AAC PES packet truncated,might overlap between fragments"),C.pesData=fe;pe&&(x=Be(pe))?(this.parseID3PES(V,x),V.pesData=null):V.pesData=pe},M.demuxSampleAes=function(b,x,C){var U=this.demux(b,C,!0,!this.config.progressive),V=this.sampleAes=new Te(this.observer,this.config,x);return this.decrypt(U,V)},M.decrypt=function(b,x){return new Promise(function(C){var U=b.audioTrack,V=b.videoTrack;U.samples&&U.segmentCodec==="aac"?x.decryptAacSamples(U.samples,0,function(){V.samples?x.decryptAvcSamples(V.samples,0,0,function(){C(b)}):C(b)}):V.samples&&x.decryptAvcSamples(V.samples,0,0,function(){C(b)})})},M.destroy=function(){this._duration=0},M.parseAVCPES=function(b,x,C,U){var V,Y=this,ae=this.parseAVCNALu(b,C.data),fe=this.avcSample,pe=!1;C.data=null,fe&&ae.length&&!b.audFound&&(Ve(fe,b),fe=this.avcSample=Ce(!1,C.pts,C.dts,"")),ae.forEach(function(ke){switch(ke.type){case 1:V=!0,fe||(fe=Y.avcSample=Ce(!0,C.pts,C.dts,"")),fe.frame=!0;var Ue=ke.data;if(pe&&Ue.length>4){var De=new Se(Ue).readSliceType();De!==2&&De!==4&&De!==7&&De!==9||(fe.key=!0)}break;case 5:V=!0,fe||(fe=Y.avcSample=Ce(!0,C.pts,C.dts,"")),fe.key=!0,fe.frame=!0;break;case 6:V=!0,(0,Q.parseSEIMessageFromNALu)(ke.data,1,C.pts,x.samples);break;case 7:if(V=!0,pe=!0,!b.sps){var je=new Se(ke.data).readSPS();b.width=je.width,b.height=je.height,b.pixelRatio=je.pixelRatio,b.sps=[ke.data],b.duration=Y._duration;for(var ze=ke.data.subarray(1,4),ot="avc1.",Ke=0;Ke<3;Ke++){var mt=ze[Ke].toString(16);mt.length<2&&(mt="0"+mt),ot+=mt}b.codec=ot}break;case 8:V=!0,b.pps||(b.pps=[ke.data]);break;case 9:V=!1,b.audFound=!0,fe&&Ve(fe,b),fe=Y.avcSample=Ce(!1,C.pts,C.dts,"");break;case 12:V=!0;break;default:V=!1,fe&&(fe.debug+="unknown NAL "+ke.type+" ")}fe&&V&&fe.units.push(ke)}),U&&fe&&(Ve(fe,b),this.avcSample=null)},M.getLastNalUnit=function(b){var x,C,U=this.avcSample;if(U&&U.units.length!==0||(U=b[b.length-1]),(x=U)!==null&&x!==void 0&&x.units){var V=U.units;C=V[V.length-1]}return C},M.parseAVCNALu=function(b,x){var C,U,V=x.byteLength,Y=b.naluState||0,ae=Y,fe=[],pe=0,ke=-1,Ue=0;for(Y===-1&&(ke=0,Ue=31&x[0],Y=0,pe=1);pe<V;)if(C=x[pe++],Y)if(Y!==1)if(C)if(C===1){if(ke>=0){var De={data:x.subarray(ke,pe-Y-1),type:Ue};fe.push(De)}else{var je=this.getLastNalUnit(b.samples);if(je&&(ae&&pe<=4-ae&&je.state&&(je.data=je.data.subarray(0,je.data.byteLength-ae)),(U=pe-Y-1)>0)){var ze=new Uint8Array(je.data.byteLength+U);ze.set(je.data,0),ze.set(x.subarray(0,U),je.data.byteLength),je.data=ze,je.state=0}}pe<V?(ke=pe,Ue=31&x[pe],Y=0):Y=-1}else Y=0;else Y=3;else Y=C?0:2;else Y=C?0:1;if(ke>=0&&Y>=0){var ot={data:x.subarray(ke,V),type:Ue,state:Y};fe.push(ot)}if(fe.length===0){var Ke=this.getLastNalUnit(b.samples);if(Ke){var mt=new Uint8Array(Ke.data.byteLength+x.byteLength);mt.set(Ke.data,0),mt.set(x,Ke.data.byteLength),Ke.data=mt}}return b.naluState=Y,fe},M.parseAACPES=function(b,x){var C,U,V,Y,ae,fe=0,pe=this.aacOverFlow,ke=x.data;if(pe){this.aacOverFlow=null;var Ue=pe.missing,De=pe.sample.unit.byteLength;if(Ue===-1){var je=new Uint8Array(De+ke.byteLength);je.set(pe.sample.unit,0),je.set(ke,De),ke=je}else{var ze=De-Ue;pe.sample.unit.set(ke.subarray(0,Ue),ze),b.samples.push(pe.sample),fe=pe.missing}}for(C=fe,U=ke.length;C<U-1&&!be(ke,C);C++);if(C===fe||(C<U-1?(V="AAC PES did not start with ADTS header,offset:"+C,Y=!1):(V="no ADTS header found in AAC PES",Y=!0),X.logger.warn("parsing error:"+V),this.observer.emit(B.Events.ERROR,B.Events.ERROR,{type:H.ErrorTypes.MEDIA_ERROR,details:H.ErrorDetails.FRAG_PARSING_ERROR,fatal:Y,reason:V}),!Y)){if(J(b,this.observer,ke,C,this.audioCodec),x.pts!==void 0)ae=x.pts;else{if(!pe)return void X.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var ot=A(b.samplerate);ae=pe.sample.pts+ot}for(var Ke,mt=0;C<U;){if(C+=(Ke=G(b,ke,C,ae,mt)).length,Ke.missing){this.aacOverFlow=Ke;break}for(mt++;C<U-1&&!be(ke,C);C++);}}},M.parseMPEGPES=function(b,x){var C=x.data,U=C.length,V=0,Y=0,ae=x.pts;if(ae!==void 0)for(;Y<U;)if(ce(C,Y)){var fe=$e(b,C,Y,ae,V);if(!fe)break;Y+=fe.length,V++}else Y++;else X.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},M.parseID3PES=function(b,x){if(x.pts!==void 0){var C=we({},x,{type:this._avcTrack?_.MetadataSchema.emsg:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});b.samples.push(C)}else X.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},W}();function et(W,M){return et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(b,x){return b.__proto__=x,b},et(W,M)}const yt=function(W){var M,b;function x(){return W.apply(this,arguments)||this}b=W,(M=x).prototype=Object.create(b.prototype),M.prototype.constructor=M,et(M,b);var C=x.prototype;return C.resetInitSegment=function(U,V,Y,ae){W.prototype.resetInitSegment.call(this,U,V,Y,ae),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:V,duration:ae,inputTimeScale:9e4,dropped:0}},x.probe=function(U){if(!U)return!1;for(var V=(I.getID3Data(U,0)||[]).length,Y=U.length;V<Y;V++)if(ee(U,V))return X.logger.log("MPEG Audio sync word found !"),!0;return!1},C.canParse=function(U,V){return function(Y,ae){return te(Y,ae)&&4<=Y.length-ae}(U,V)},C.appendFrame=function(U,V,Y){if(this.basePTS!==null)return $e(U,V,Y,this.basePTS,this.frameIndex)},x}(re);var gt=R(524),ct=R(923);function ht(W,M){var b=W==null?void 0:W.codec;return b&&b.length>4?b:b==="hvc1"||b==="hev1"?"hvc1.1.c.L120.90":b==="av01"?"av01.0.04M.08":b==="avc1"||M===ct.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const it=function(){function W(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var M=W.prototype;return M.destroy=function(){},M.resetTimeStamp=function(b){this.initPTS=b,this.lastEndTime=null},M.resetNextTimestamp=function(){this.lastEndTime=null},M.resetInitSegment=function(b,x,C,U){this.audioCodec=x,this.videoCodec=C,this.generateInitSegment((0,Q.patchEncyptionData)(b,U)),this.emitInitSegment=!0},M.generateInitSegment=function(b){var x=this.audioCodec,C=this.videoCodec;if(!b||!b.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var U=this.initData=(0,Q.parseInitSegment)(b);x||(x=ht(U.audio,ct.ElementaryStreamTypes.AUDIO)),C||(C=ht(U.video,ct.ElementaryStreamTypes.VIDEO));var V={};U.audio&&U.video?V.audiovideo={container:"video/mp4",codec:x+","+C,initSegment:b,id:"main"}:U.audio?V.audio={container:"audio/mp4",codec:x,initSegment:b,id:"audio"}:U.video?V.video={container:"video/mp4",codec:C,initSegment:b,id:"main"}:X.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=V},M.remux=function(b,x,C,U,V){var Y,ae=this.initPTS,fe=this.lastEndTime,pe={audio:void 0,video:void 0,text:U,id3:C,initSegment:void 0};(0,p.isFiniteNumber)(fe)||(fe=this.lastEndTime=V||0);var ke=x.samples;if(!ke||!ke.length)return pe;var Ue={initPTS:void 0,timescale:1},De=this.initData;if(De&&De.length||(this.generateInitSegment(ke),De=this.initData),!De||!De.length)return X.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),pe;this.emitInitSegment&&(Ue.tracks=this.initTracks,this.emitInitSegment=!1);var je=(0,Q.getStartDTS)(De,ke);(0,p.isFiniteNumber)(ae)||(this.initPTS=Ue.initPTS=ae=je-V);var ze=(0,Q.getDuration)(ke,De),ot=b?je-ae:fe,Ke=ot+ze;(0,Q.offsetStartDTS)(De,ke,ae),ze>0?this.lastEndTime=Ke:(X.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var mt=!!De.audio,Ut=!!De.video,At="";mt&&(At+="audio"),Ut&&(At+="video");var Tt={data1:ke,startPTS:ot,startDTS:ot,endPTS:Ke,endDTS:Ke,type:At,hasAudio:mt,hasVideo:Ut,nb:1,dropped:0};pe.audio=Tt.type==="audio"?Tt:void 0,pe.video=Tt.type!=="audio"?Tt:void 0,pe.initSegment=Ue;var Lt=(Y=this.initPTS)!=null?Y:0;return pe.id3=(0,gt.flushTextTrackMetadataCueSamples)(C,V,Lt,Lt),U.samples.length&&(pe.text=(0,gt.flushTextTrackUserdataCueSamples)(U,V,Lt)),pe},W}();var Qe;try{Qe=self.performance.now.bind(self.performance)}catch{X.logger.debug("Unable to use Performance API on this environment"),Qe=self.Date.now}var pt=[{demux:me,remux:it},{demux:st,remux:gt.default},{demux:se,remux:gt.default},{demux:yt,remux:gt.default}],Et=function(){function W(b,x,C,U,V){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=b,this.typeSupported=x,this.config=C,this.vendor=U,this.id=V}var M=W.prototype;return M.configure=function(b){this.transmuxConfig=b,this.decrypter&&this.decrypter.reset()},M.push=function(b,x,C,U){var V=this,Y=C.transmuxing;Y.executeStart=Qe();var ae=new Uint8Array(b),fe=this.currentTransmuxState,pe=this.transmuxConfig;U&&(this.currentTransmuxState=U);var ke=U||fe,Ue=ke.contiguous,De=ke.discontinuity,je=ke.trackSwitch,ze=ke.accurateTimeOffset,ot=ke.timeOffset,Ke=ke.initSegmentChange,mt=pe.audioCodec,Ut=pe.videoCodec,At=pe.defaultInitPts,Tt=pe.duration,Lt=pe.initSegmentData,He=function(gi,Wt){var St=null;return gi.byteLength>0&&Wt!=null&&Wt.key!=null&&Wt.iv!==null&&Wt.method!=null&&(St=Wt),St}(ae,x);if(He&&He.method==="AES-128"){var jt=this.getDecrypter();if(!jt.isSync())return this.decryptionPromise=jt.webCryptoDecrypt(ae,He.key.buffer,He.iv.buffer).then(function(gi){var Wt=V.push(gi,null,C);return V.decryptionPromise=null,Wt}),this.decryptionPromise;var ri=jt.softwareDecrypt(ae,He.key.buffer,He.iv.buffer);if(!ri)return Y.executeEnd=Qe(),_t(C);ae=new Uint8Array(ri)}var wt=this.needsProbing(De,je);wt&&this.configureTransmuxer(ae),(De||je||Ke||wt)&&this.resetInitSegment(Lt,mt,Ut,Tt,x),(De||Ke||wt)&&this.resetInitialTimestamp(At),Ue||this.resetContiguity();var xt=this.transmux(ae,He,ot,ze,C),Yt=this.currentTransmuxState;return Yt.contiguous=!0,Yt.discontinuity=!1,Yt.trackSwitch=!1,Y.executeEnd=Qe(),xt},M.flush=function(b){var x=this,C=b.transmuxing;C.executeStart=Qe();var U=this.decrypter,V=this.currentTransmuxState,Y=this.decryptionPromise;if(Y)return Y.then(function(){return x.flush(b)});var ae=[],fe=V.timeOffset;if(U){var pe=U.flush();pe&&ae.push(this.push(pe,null,b))}var ke=this.demuxer,Ue=this.remuxer;if(!ke||!Ue)return this.observer.emit(B.Events.ERROR,B.Events.ERROR,{type:H.ErrorTypes.MEDIA_ERROR,details:H.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),C.executeEnd=Qe(),[_t(b)];var De=ke.flush(fe);return Mt(De)?De.then(function(je){return x.flushRemux(ae,je,b),ae}):(this.flushRemux(ae,De,b),ae)},M.flushRemux=function(b,x,C){var U=x.audioTrack,V=x.videoTrack,Y=x.id3Track,ae=x.textTrack,fe=this.currentTransmuxState,pe=fe.accurateTimeOffset,ke=fe.timeOffset;X.logger.log("[transmuxer.ts]: Flushed fragment "+C.sn+(C.part>-1?" p: "+C.part:"")+" of level "+C.level);var Ue=this.remuxer.remux(U,V,Y,ae,ke,pe,!0,this.id);b.push({remuxResult:Ue,chunkMeta:C}),C.transmuxing.executeEnd=Qe()},M.resetInitialTimestamp=function(b){var x=this.demuxer,C=this.remuxer;x&&C&&(x.resetTimeStamp(b),C.resetTimeStamp(b))},M.resetContiguity=function(){var b=this.demuxer,x=this.remuxer;b&&x&&(b.resetContiguity(),x.resetNextTimestamp())},M.resetInitSegment=function(b,x,C,U,V){var Y=this.demuxer,ae=this.remuxer;Y&&ae&&(Y.resetInitSegment(b,x,C,U),ae.resetInitSegment(b,x,C,V))},M.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},M.transmux=function(b,x,C,U,V){return x&&x.method==="SAMPLE-AES"?this.transmuxSampleAes(b,x,C,U,V):this.transmuxUnencrypted(b,C,U,V)},M.transmuxUnencrypted=function(b,x,C,U){var V=this.demuxer.demux(b,x,!1,!this.config.progressive),Y=V.audioTrack,ae=V.videoTrack,fe=V.id3Track,pe=V.textTrack;return{remuxResult:this.remuxer.remux(Y,ae,fe,pe,x,C,!1,this.id),chunkMeta:U}},M.transmuxSampleAes=function(b,x,C,U,V){var Y=this;return this.demuxer.demuxSampleAes(b,x,C).then(function(ae){return{remuxResult:Y.remuxer.remux(ae.audioTrack,ae.videoTrack,ae.id3Track,ae.textTrack,C,U,!1,Y.id),chunkMeta:V}})},M.configureTransmuxer=function(b){for(var x,C=this.config,U=this.observer,V=this.typeSupported,Y=this.vendor,ae=0,fe=pt.length;ae<fe;ae++)if(pt[ae].demux.probe(b)){x=pt[ae];break}x||(X.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),x={demux:me,remux:it});var pe=this.demuxer,ke=this.remuxer,Ue=x.remux,De=x.demux;ke&&ke instanceof Ue||(this.remuxer=new Ue(U,C,V,Y)),pe&&pe instanceof De||(this.demuxer=new De(U,C,V),this.probe=De.probe)},M.needsProbing=function(b,x){return!this.demuxer||!this.remuxer||b||x},M.getDecrypter=function(){var b=this.decrypter;return b||(b=this.decrypter=new N.default(this.config)),b},W}(),_t=function(W){return{remuxResult:{},chunkMeta:W}};function Mt(W){return"then"in W&&W.then instanceof Function}var It=function(W,M,b,x,C){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=W,this.videoCodec=M,this.initSegmentData=b,this.duration=x,this.defaultInitPts=C},Ht=function(W,M,b,x,C,U){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=W,this.contiguous=M,this.accurateTimeOffset=b,this.trackSwitch=x,this.timeOffset=C,this.initSegmentChange=U}},973:(w,L,R)=>{var B,H;R.r(L),R.d(L,{ErrorDetails:()=>H,ErrorTypes:()=>B}),function(N){N.NETWORK_ERROR="networkError",N.MEDIA_ERROR="mediaError",N.KEY_SYSTEM_ERROR="keySystemError",N.MUX_ERROR="muxError",N.OTHER_ERROR="otherError"}(B||(B={})),function(N){N.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",N.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",N.KEY_SYSTEM_NO_SESSION="keySystemNoSession",N.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",N.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",N.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",N.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",N.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",N.MANIFEST_LOAD_ERROR="manifestLoadError",N.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",N.MANIFEST_PARSING_ERROR="manifestParsingError",N.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",N.LEVEL_EMPTY_ERROR="levelEmptyError",N.LEVEL_LOAD_ERROR="levelLoadError",N.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",N.LEVEL_SWITCH_ERROR="levelSwitchError",N.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",N.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",N.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",N.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",N.FRAG_LOAD_ERROR="fragLoadError",N.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",N.FRAG_DECRYPT_ERROR="fragDecryptError",N.FRAG_PARSING_ERROR="fragParsingError",N.REMUX_ALLOC_ERROR="remuxAllocError",N.KEY_LOAD_ERROR="keyLoadError",N.KEY_LOAD_TIMEOUT="keyLoadTimeOut",N.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",N.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",N.BUFFER_APPEND_ERROR="bufferAppendError",N.BUFFER_APPENDING_ERROR="bufferAppendingError",N.BUFFER_STALLED_ERROR="bufferStalledError",N.BUFFER_FULL_ERROR="bufferFullError",N.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",N.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",N.INTERNAL_EXCEPTION="internalException",N.INTERNAL_ABORTED="aborted",N.UNKNOWN="unknown"}(H||(H={}))},851:(w,L,R)=>{var B;R.r(L),R.d(L,{Events:()=>B}),function(H){H.MEDIA_ATTACHING="hlsMediaAttaching",H.MEDIA_ATTACHED="hlsMediaAttached",H.MEDIA_DETACHING="hlsMediaDetaching",H.MEDIA_DETACHED="hlsMediaDetached",H.BUFFER_RESET="hlsBufferReset",H.BUFFER_CODECS="hlsBufferCodecs",H.BUFFER_CREATED="hlsBufferCreated",H.BUFFER_APPENDING="hlsBufferAppending",H.BUFFER_APPENDED="hlsBufferAppended",H.BUFFER_EOS="hlsBufferEos",H.BUFFER_FLUSHING="hlsBufferFlushing",H.BUFFER_FLUSHED="hlsBufferFlushed",H.MANIFEST_LOADING="hlsManifestLoading",H.MANIFEST_LOADED="hlsManifestLoaded",H.MANIFEST_PARSED="hlsManifestParsed",H.LEVEL_SWITCHING="hlsLevelSwitching",H.LEVEL_SWITCHED="hlsLevelSwitched",H.LEVEL_LOADING="hlsLevelLoading",H.LEVEL_LOADED="hlsLevelLoaded",H.LEVEL_UPDATED="hlsLevelUpdated",H.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",H.LEVELS_UPDATED="hlsLevelsUpdated",H.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",H.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",H.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",H.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",H.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",H.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",H.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",H.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",H.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",H.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",H.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",H.CUES_PARSED="hlsCuesParsed",H.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",H.INIT_PTS_FOUND="hlsInitPtsFound",H.FRAG_LOADING="hlsFragLoading",H.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",H.FRAG_LOADED="hlsFragLoaded",H.FRAG_DECRYPTED="hlsFragDecrypted",H.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",H.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",H.FRAG_PARSING_METADATA="hlsFragParsingMetadata",H.FRAG_PARSED="hlsFragParsed",H.FRAG_BUFFERED="hlsFragBuffered",H.FRAG_CHANGED="hlsFragChanged",H.FPS_DROP="hlsFpsDrop",H.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",H.ERROR="hlsError",H.DESTROYING="hlsDestroying",H.KEY_LOADING="hlsKeyLoading",H.KEY_LOADED="hlsKeyLoaded",H.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",H.BACK_BUFFER_REACHED="hlsBackBufferReached"}(B||(B={}))},76:(w,L,R)=>{R.r(L),R.d(L,{default:()=>Qn});var B,H=R(945),N=R(965),p=R(851),I=R(973),_=R(93),de=/^(\d+)x(\d+)$/,Q=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,ie=function(){function d(e){for(var t in typeof e=="string"&&(e=d.parseAttrList(e)),e)e.hasOwnProperty(t)&&(this[t]=e[t])}var l=d.prototype;return l.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},l.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(2*n,2*n+2),16);return r}return null},l.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},l.decimalFloatingPoint=function(e){return parseFloat(this[e])},l.optionalFloat=function(e,t){var r=this[e];return r?parseFloat(r):t},l.enumeratedString=function(e){return this[e]},l.bool=function(e){return this[e]==="YES"},l.decimalResolution=function(e){var t=de.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},d.parseAttrList=function(e){var t,r={};for(Q.lastIndex=0;(t=Q.exec(e))!==null;){var n=t[2];n.indexOf('"')===0&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),r[t[1]]=n}return r},d}();function q(){return q=Object.assign?Object.assign.bind():function(d){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(d[t]=e[t])}return d},q.apply(this,arguments)}function j(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}(function(d){d.ID="ID",d.CLASS="CLASS",d.START_DATE="START-DATE",d.DURATION="DURATION",d.END_DATE="END-DATE",d.END_ON_NEXT="END-ON-NEXT",d.PLANNED_DURATION="PLANNED-DURATION",d.SCTE35_OUT="SCTE35-OUT",d.SCTE35_IN="SCTE35-IN"})(B||(B={}));var re=function(){function d(t,r){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,r){var n=r.attr;for(var s in n)if(Object.prototype.hasOwnProperty.call(t,s)&&t[s]!==n[s]){_.logger.warn('DATERANGE tag attribute: "'+s+'" does not match for tags with ID: "'+t.ID+'"'),this._badValueForSameId=s;break}t=q(new ie({}),n,t)}if(this.attr=t,this._startDate=new Date(t[B.START_DATE]),B.END_DATE in this.attr){var i=new Date(this.attr[B.END_DATE]);(0,N.isFiniteNumber)(i.getTime())&&(this._endDate=i)}}var l,e;return l=d,(e=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var t=this.duration;return t!==null?new Date(this._startDate.getTime()+1e3*t):null}},{key:"duration",get:function(){if(B.DURATION in this.attr){var t=this.attr.decimalFloatingPoint(B.DURATION);if((0,N.isFiniteNumber)(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return B.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(B.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(B.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,N.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&j(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),d}(),X=R(923);function z(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}var $,ve,be,Ne=function(){function d(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}var l,e;return d.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var r=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!r,this.advanced=this.endSN>t.endSN||r>0||r===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},l=d,(e=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,N.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return(t=this.fragments)!==null&&t!==void 0&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return(t=this.partList)!==null&&t!==void 0&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&z(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),d}();function J(d){return Uint8Array.from(atob(d),function(l){return l.charCodeAt(0)})}function A(d){return Uint8Array.from(unescape(encodeURIComponent(d)),function(l){return l.charCodeAt(0)})}function G(d){switch(d){case ve.FAIRPLAY:return $.FAIRPLAY;case ve.PLAYREADY:return $.PLAYREADY;case ve.WIDEVINE:return $.WIDEVINE;case ve.CLEARKEY:return $.CLEARKEY}}function O(d){switch(d){case $.FAIRPLAY:return ve.FAIRPLAY;case $.PLAYREADY:return ve.PLAYREADY;case $.WIDEVINE:return ve.WIDEVINE;case $.CLEARKEY:return ve.CLEARKEY}}function se(d){var l=d.drmSystems,e=d.widevineLicenseUrl,t=l?[$.FAIRPLAY,$.WIDEVINE,$.PLAYREADY,$.CLEARKEY].filter(function(r){return!!l[r]}):[];return!t[$.WIDEVINE]&&e&&t.push($.WIDEVINE),t}(function(d){d.CLEARKEY="org.w3.clearkey",d.FAIRPLAY="com.apple.fps",d.PLAYREADY="com.microsoft.playready",d.WIDEVINE="com.widevine.alpha"})($||($={})),function(d){d.CLEARKEY="org.w3.clearkey",d.FAIRPLAY="com.apple.streamingkeydelivery",d.PLAYREADY="com.microsoft.playready",d.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"}(ve||(ve={})),function(d){d.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"}(be||(be={}));var ye=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null,me=R(63),ge={},Pe=function(){function d(e,t,r,n,s){n===void 0&&(n=[1]),s===void 0&&(s=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=n,this.iv=s,this.encrypted=!!e&&e!=="NONE",this.isCommonEncryption=this.encrypted&&e!=="AES-128"}d.clearKeyUriToKeyIdMap=function(){ge={}};var l=d.prototype;return l.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;switch(this.keyFormat){case"identity":return this.method==="SAMPLE-AES";case ve.FAIRPLAY:case ve.WIDEVINE:case ve.PLAYREADY:case ve.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},l.getDecryptData=function(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method!=="AES-128"||this.iv||_.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),e=0);var t=function(F){for(var P=new Uint8Array(16),K=12;K<16;K++)P[K]=F>>8*(15-K)&255;return P}(e);return new d(this.method,this.uri,"identity",this.keyFormatVersions,t)}var r=function(F){var P,K,Z=F.split(":"),le=null;if(Z[0]==="data"&&Z.length===2){var ne=Z[1].split(";"),he=ne[ne.length-1].split(",");if(he.length===2){var Re=he[0]==="base64",Ge=he[1];Re?(ne.splice(-1,1),le=J(Ge)):(P=A(Ge).subarray(0,16),(K=new Uint8Array(16)).set(P,16-P.length),le=K)}}return le}(this.uri);if(r)switch(this.keyFormat){case ve.WIDEVINE:this.pssh=r,r.length>=22&&(this.keyId=r.subarray(r.length-22,r.length-6));break;case ve.PLAYREADY:var n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,me.mp4pssh)(n,null,r);var s=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),i=String.fromCharCode.apply(null,Array.from(s)),a=i.substring(i.indexOf("<"),i.length),u=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("KID")[0];if(u){var h=u.childNodes[0]?u.childNodes[0].nodeValue:u.getAttribute("VALUE");if(h){var f=J(h).subarray(0,16);(function(F){var P=function(K,Z,le){var ne=K[Z];K[Z]=K[le],K[le]=ne};P(F,0,3),P(F,1,2),P(F,4,5),P(F,6,7)})(f),this.keyId=f}}break;default:var m=r.subarray(0,16);if(m.length!==16){var y=new Uint8Array(16);y.set(m,16-m.length),m=y}this.keyId=m}if(!this.keyId||this.keyId.byteLength!==16){var S=ge[this.uri];if(!S){var k=Object.keys(ge).length%Number.MAX_SAFE_INTEGER;S=new Uint8Array(16),new DataView(S.buffer,12,4).setUint32(0,k),ge[this.uri]=S}this.keyId=S}return this},d}(),xe={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function Fe(d,l){return MediaSource.isTypeSupported((l||"video")+'/mp4;codecs="'+d+'"')}function _e(){return _e=Object.assign?Object.assign.bind():function(d){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(d[t]=e[t])}return d},_e.apply(this,arguments)}var $e=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,at=/#EXT-X-MEDIA:(.*)/g,te=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),ce=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),ee=function(){function d(){}return d.findGroup=function(l,e){for(var t=0;t<l.length;t++){var r=l[t];if(r.id===e)return r}},d.convertAVC1ToAVCOTI=function(l){var e=l.split(".");if(e.length>2){var t=e.shift()+".";return(t+=parseInt(e.shift()).toString(16))+("000"+parseInt(e.shift()).toString(16)).slice(-4)}return l},d.resolve=function(l,e){return(0,H.buildAbsoluteURL)(e,l,{alwaysNormalize:!0})},d.parseMasterPlaylist=function(l,e){var t,r=[],n=[],s={},i=[],a=!1;for($e.lastIndex=0;(t=$e.exec(l))!=null;)if(t[1]){var u,h=new ie(t[1]),f={attrs:h,bitrate:h.decimalInteger("AVERAGE-BANDWIDTH")||h.decimalInteger("BANDWIDTH"),name:h.NAME,url:d.resolve(t[2],e)},m=h.decimalResolution("RESOLUTION");m&&(f.width=m.width,f.height=m.height),Te((h.CODECS||"").split(/[ ,]+/).filter(function(F){return F}),f),f.videoCodec&&f.videoCodec.indexOf("avc1")!==-1&&(f.videoCodec=d.convertAVC1ToAVCOTI(f.videoCodec)),(u=f.unknownCodecs)!==null&&u!==void 0&&u.length||n.push(f),r.push(f)}else if(t[3]){var y=new ie(t[3]);y["DATA-ID"]&&(a=!0,s[y["DATA-ID"]]=y)}else if(t[4]){var S=t[4],k=Se(S,e);k.encrypted&&k.isSupported()?i.push(k):_.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+S+'"')}return{levels:n.length>0&&n.length<r.length?n:r,sessionData:a?s:null,sessionKeys:i.length?i:null}},d.parseMasterPlaylistMedia=function(l,e,t,r){var n;r===void 0&&(r=[]);var s=[],i=0;for(at.lastIndex=0;(n=at.exec(l))!==null;){var a=new ie(n[1]);if(a.TYPE===t){var u={attrs:a,bitrate:0,id:i++,groupId:a["GROUP-ID"],instreamId:a["INSTREAM-ID"],name:a.NAME||a.LANGUAGE||"",type:t,default:a.bool("DEFAULT"),autoselect:a.bool("AUTOSELECT"),forced:a.bool("FORCED"),lang:a.LANGUAGE,url:a.URI?d.resolve(a.URI,e):""};if(r.length){var h=d.findGroup(r,u.groupId)||r[0];we(u,h,"audioCodec"),we(u,h,"textCodec")}s.push(u)}}return s},d.parseLevelPlaylist=function(l,e,t,r,n){var s,i,a,u=new Ne(e),h=u.fragments,f=null,m=0,y=0,S=0,k=0,F=null,P=new X.Fragment(r,e),K=-1,Z=!1;for(te.lastIndex=0,u.m3u8=l;(s=te.exec(l))!==null;){Z&&(Z=!1,(P=new X.Fragment(r,e)).start=S,P.sn=m,P.cc=k,P.level=t,f&&(P.initSegment=f,P.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null));var le=s[1];if(le){P.duration=parseFloat(le);var ne=(" "+s[2]).slice(1);P.title=ne||null,P.tagList.push(ne?["INF",le,ne]:["INF",le])}else if(s[3]){if((0,N.isFiniteNumber)(P.duration)){if(P.start=S,a){P.levelkeys=a;var he=u.encryptedFragments;!P.levelkeys||!Object.keys(P.levelkeys).some(function(Xt){return P.levelkeys[Xt].isCommonEncryption})||he.length&&he[he.length-1].levelkeys===a||he.push(P)}P.sn=m,P.level=t,P.cc=k,P.urlId=n,h.push(P),P.relurl=(" "+s[3]).slice(1),Le(P,F),F=P,S+=P.duration,m++,y=0,Z=!0}}else if(s[4]){var Re=(" "+s[4]).slice(1);F?P.setByteRange(Re,F):P.setByteRange(Re)}else if(s[5])P.rawProgramDateTime=(" "+s[5]).slice(1),P.tagList.push(["PROGRAM-DATE-TIME",P.rawProgramDateTime]),K===-1&&(K=h.length);else{if(!(s=s[0].match(ce))){_.logger.warn("No matches on slow regex match for level playlist!");continue}for(i=1;i<s.length&&s[i]===void 0;i++);var Ge=(" "+s[i]).slice(1),ue=(" "+s[i+1]).slice(1),Ie=s[i+2]?(" "+s[i+2]).slice(1):"";switch(Ge){case"PLAYLIST-TYPE":u.type=ue.toUpperCase();break;case"MEDIA-SEQUENCE":m=u.startSN=parseInt(ue);break;case"SKIP":var Ae=new ie(ue),Xe=Ae.decimalInteger("SKIPPED-SEGMENTS");if((0,N.isFiniteNumber)(Xe)){u.skippedSegments=Xe;for(var vt=Xe;vt--;)h.unshift(null);m+=Xe}var Je=Ae.enumeratedString("RECENTLY-REMOVED-DATERANGES");Je&&(u.recentlyRemovedDateranges=Je.split("	"));break;case"TARGETDURATION":u.targetduration=parseFloat(ue);break;case"VERSION":u.version=parseInt(ue);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"#":(ue||Ie)&&P.tagList.push(Ie?[ue,Ie]:[ue]);break;case"DISCONTINUITY":k++,P.tagList.push(["DIS"]);break;case"GAP":P.tagList.push([Ge]);break;case"BITRATE":P.tagList.push([Ge,ue]);break;case"DATERANGE":var tt=new ie(ue),lt=new re(tt,u.dateRanges[tt.ID]);lt.isValid||u.skippedSegments?u.dateRanges[lt.id]=lt:_.logger.warn('Ignoring invalid DATERANGE tag: "'+ue+'"'),P.tagList.push(["EXT-X-DATERANGE",ue]);break;case"DISCONTINUITY-SEQUENCE":k=parseInt(ue);break;case"KEY":var Pt=Se(ue,e);if(Pt.isSupported()){if(Pt.method==="NONE"){a=void 0;break}a||(a={}),a[Pt.keyFormat]&&(a=_e({},a)),a[Pt.keyFormat]=Pt}else _.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+ue+'"');break;case"START":var Rt=new ie(ue).decimalFloatingPoint("TIME-OFFSET");(0,N.isFiniteNumber)(Rt)&&(u.startTimeOffset=Rt);break;case"MAP":var kt=new ie(ue);if(P.duration){var Ot=new X.Fragment(r,e);Ce(Ot,kt,t,a),f=Ot,P.initSegment=f,f.rawProgramDateTime&&!P.rawProgramDateTime&&(P.rawProgramDateTime=f.rawProgramDateTime)}else Ce(P,kt,t,a),f=P,Z=!0;break;case"SERVER-CONTROL":var Vt=new ie(ue);u.canBlockReload=Vt.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=Vt.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&Vt.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=Vt.optionalFloat("PART-HOLD-BACK",0),u.holdBack=Vt.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var qr=new ie(ue);u.partTarget=qr.decimalFloatingPoint("PART-TARGET");break;case"PART":var Jt=u.partList;Jt||(Jt=u.partList=[]);var Fi=y>0?Jt[Jt.length-1]:void 0,Mi=y++,Ni=new X.Part(new ie(ue),P,e,Mi,Fi);Jt.push(Ni),P.duration+=Ni.duration;break;case"PRELOAD-HINT":var Ye=new ie(ue);u.preloadHint=Ye;break;case"RENDITION-REPORT":var Ze=new ie(ue);u.renditionReports=u.renditionReports||[],u.renditionReports.push(Ze);break;default:_.logger.warn("line parsed but not handled: "+s)}}}F&&!F.relurl?(h.pop(),S-=F.duration,u.partList&&(u.fragmentHint=F)):u.partList&&(Le(P,F),P.cc=k,u.fragmentHint=P);var wi=h.length,ai=h[0],Zt=h[wi-1];if((S+=u.skippedSegments*u.targetduration)>0&&wi&&Zt){u.averagetargetduration=S/wi;var Li=Zt.sn;u.endSN=Li!=="initSegment"?Li:0,u.live||(Zt.endList=!0),ai&&(u.startCC=ai.cc)}else u.endSN=0,u.startCC=0;return u.fragmentHint&&(S+=u.fragmentHint.duration),u.totalduration=S,u.endCC=k,K>0&&function(Xt,oi){for(var ci=Xt[oi],qt=oi;qt--;){var hi=Xt[qt];if(!hi)return;hi.programDateTime=ci.programDateTime-1e3*hi.duration,ci=hi}}(h,K),u},d}();function Se(d,l){var e,t,r=new ie(d),n=(e=r.enumeratedString("METHOD"))!=null?e:"",s=r.URI,i=r.hexadecimalInteger("IV"),a=r.enumeratedString("KEYFORMATVERSIONS"),u=(t=r.enumeratedString("KEYFORMAT"))!=null?t:"identity";s&&r.IV&&!i&&_.logger.error("Invalid IV: "+r.IV);var h=s?ee.resolve(s,l):"",f=(a||"1").split("/").map(Number).filter(Number.isFinite);return new Pe(n,h,u,f,i)}function Te(d,l){["video","audio","text"].forEach(function(e){var t=d.filter(function(n){return function(s,i){var a=xe[i];return!!a&&a[s.slice(0,4)]===!0}(n,e)});if(t.length){var r=t.filter(function(n){return n.lastIndexOf("avc1",0)===0||n.lastIndexOf("mp4a",0)===0});l[e+"Codec"]=r.length>0?r[0]:t[0],d=d.filter(function(n){return t.indexOf(n)===-1})}}),l.unknownCodecs=d}function we(d,l,e){var t=l[e];t&&(d[e]=t)}function Le(d,l){d.rawProgramDateTime?d.programDateTime=Date.parse(d.rawProgramDateTime):l!=null&&l.programDateTime&&(d.programDateTime=l.endProgramDateTime),(0,N.isFiniteNumber)(d.programDateTime)||(d.programDateTime=null,d.rawProgramDateTime=null)}function Ce(d,l,e,t){d.relurl=l.URI,l.BYTERANGE&&d.setByteRange(l.BYTERANGE),d.level=e,d.sn="initSegment",t&&(d.levelkeys=t),d.initSegment=null}var oe=R(308);function Ee(d,l){var e=d.url;return e!==void 0&&e.indexOf("data:")!==0||(e=l.url),e}const Be=function(){function d(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var l=d.prototype;return l.startLoad=function(e){},l.stopLoad=function(){this.destroyInternalLoaders()},l.registerListeners=function(){var e=this.hls;e.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(p.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(p.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.unregisterListeners=function(){var e=this.hls;e.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(p.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(p.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,n=t.loader,s=new(r||n)(t);return e.loader=s,this.loaders[e.type]=s,s},l.getInternalLoader=function(e){return this.loaders[e.type]},l.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},l.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},l.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},l.onManifestLoading=function(e,t){var r=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:oe.PlaylistContextType.MANIFEST,url:r,deliveryDirectives:null})},l.onLevelLoading=function(e,t){var r=t.id,n=t.level,s=t.url,i=t.deliveryDirectives;this.load({id:r,groupId:null,level:n,responseType:"text",type:oe.PlaylistContextType.LEVEL,url:s,deliveryDirectives:i})},l.onAudioTrackLoading=function(e,t){var r=t.id,n=t.groupId,s=t.url,i=t.deliveryDirectives;this.load({id:r,groupId:n,level:null,responseType:"text",type:oe.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:i})},l.onSubtitleTrackLoading=function(e,t){var r=t.id,n=t.groupId,s=t.url,i=t.deliveryDirectives;this.load({id:r,groupId:n,level:null,responseType:"text",type:oe.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:i})},l.load=function(e){var t,r,n,s,i,a,u=this.hls.config,h=this.getInternalLoader(e);if(h){var f=h.context;if(f&&f.url===e.url)return void _.logger.trace("[playlist-loader]: playlist request ongoing");_.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),h.abort()}switch(e.type){case oe.PlaylistContextType.MANIFEST:r=u.manifestLoadingMaxRetry,n=u.manifestLoadingTimeOut,s=u.manifestLoadingRetryDelay,i=u.manifestLoadingMaxRetryTimeout;break;case oe.PlaylistContextType.LEVEL:case oe.PlaylistContextType.AUDIO_TRACK:case oe.PlaylistContextType.SUBTITLE_TRACK:r=0,n=u.levelLoadingTimeOut;break;default:r=u.levelLoadingMaxRetry,n=u.levelLoadingTimeOut,s=u.levelLoadingRetryDelay,i=u.levelLoadingMaxRetryTimeout}if(h=this.createInternalLoader(e),(t=e.deliveryDirectives)!==null&&t!==void 0&&t.part&&(e.type===oe.PlaylistContextType.LEVEL&&e.level!==null?a=this.hls.levels[e.level].details:e.type===oe.PlaylistContextType.AUDIO_TRACK&&e.id!==null?a=this.hls.audioTracks[e.id].details:e.type===oe.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(a=this.hls.subtitleTracks[e.id].details),a)){var m=a.partTarget,y=a.targetduration;m&&y&&(n=Math.min(1e3*Math.max(3*m,.8*y),n))}var S={timeout:n,maxRetry:r,retryDelay:s,maxRetryDelay:i,highWaterMark:0},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};h.load(e,S,k)},l.loadsuccess=function(e,t,r,n){n===void 0&&(n=null),this.resetInternalLoader(r.type);var s=e.data;s.indexOf("#EXTM3U")===0?(t.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,r,n):this.handleMasterPlaylist(e,t,r,n)):this.handleManifestParsingError(e,r,"no EXTM3U delimiter",n)},l.loaderror=function(e,t,r){r===void 0&&(r=null),this.handleNetworkError(t,r,!1,e)},l.loadtimeout=function(e,t,r){r===void 0&&(r=null),this.handleNetworkError(t,r,!0)},l.handleMasterPlaylist=function(e,t,r,n){var s=this.hls,i=e.data,a=Ee(e,r),u=ee.parseMasterPlaylist(i,a),h=u.levels,f=u.sessionData,m=u.sessionKeys;if(h.length){var y=h.map(function(K){return{id:K.attrs.AUDIO,audioCodec:K.audioCodec}}),S=h.map(function(K){return{id:K.attrs.SUBTITLES,textCodec:K.textCodec}}),k=ee.parseMasterPlaylistMedia(i,a,"AUDIO",y),F=ee.parseMasterPlaylistMedia(i,a,"SUBTITLES",S),P=ee.parseMasterPlaylistMedia(i,a,"CLOSED-CAPTIONS");k.length&&(k.some(function(K){return!K.url})||!h[0].audioCodec||h[0].attrs.AUDIO||(_.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),k.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ie({}),bitrate:0,url:""}))),s.trigger(p.Events.MANIFEST_LOADED,{levels:h,audioTracks:k,subtitles:F,captions:P,url:a,stats:t,networkDetails:n,sessionData:f,sessionKeys:m})}else this.handleManifestParsingError(e,r,"no level found in manifest",n)},l.handleTrackOrLevelPlaylist=function(e,t,r,n){var s=this.hls,i=r.id,a=r.level,u=r.type,h=Ee(e,r),f=(0,N.isFiniteNumber)(i)?i:0,m=(0,N.isFiniteNumber)(a)?a:f,y=function(F){switch(F.type){case oe.PlaylistContextType.AUDIO_TRACK:return oe.PlaylistLevelType.AUDIO;case oe.PlaylistContextType.SUBTITLE_TRACK:return oe.PlaylistLevelType.SUBTITLE;default:return oe.PlaylistLevelType.MAIN}}(r),S=ee.parseLevelPlaylist(e.data,h,m,y,f);if(S.fragments.length){if(u===oe.PlaylistContextType.MANIFEST){var k={attrs:new ie({}),bitrate:0,details:S,name:"",url:h};s.trigger(p.Events.MANIFEST_LOADED,{levels:[k],audioTracks:[],url:h,stats:t,networkDetails:n,sessionData:null,sessionKeys:null})}t.parsing.end=performance.now(),r.levelDetails=S,this.handlePlaylistLoaded(e,t,r,n)}else s.trigger(p.Events.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:h,reason:"no fragments found in level",level:typeof r.level=="number"?r.level:void 0})},l.handleManifestParsingError=function(e,t,r,n){this.hls.trigger(p.Events.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===oe.PlaylistContextType.MANIFEST,url:e.url,reason:r,response:e,context:t,networkDetails:n})},l.handleNetworkError=function(e,t,r,n){r===void 0&&(r=!1),_.logger.warn("[playlist-loader]: A network "+(r?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var s=I.ErrorDetails.UNKNOWN,i=!1,a=this.getInternalLoader(e);switch(e.type){case oe.PlaylistContextType.MANIFEST:s=r?I.ErrorDetails.MANIFEST_LOAD_TIMEOUT:I.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case oe.PlaylistContextType.LEVEL:s=r?I.ErrorDetails.LEVEL_LOAD_TIMEOUT:I.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case oe.PlaylistContextType.AUDIO_TRACK:s=r?I.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:I.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1;break;case oe.PlaylistContextType.SUBTITLE_TRACK:s=r?I.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:I.ErrorDetails.SUBTITLE_LOAD_ERROR,i=!1}a&&this.resetInternalLoader(e.type);var u={type:I.ErrorTypes.NETWORK_ERROR,details:s,fatal:i,url:e.url,loader:a,context:e,networkDetails:t};n&&(u.response=n),this.hls.trigger(p.Events.ERROR,u)},l.handlePlaylistLoaded=function(e,t,r,n){var s=r.type,i=r.level,a=r.id,u=r.groupId,h=r.loader,f=r.levelDetails,m=r.deliveryDirectives;if(f!=null&&f.targetduration){if(h)switch(f.live&&(h.getCacheAge&&(f.ageHeader=h.getCacheAge()||0),h.getCacheAge&&!isNaN(f.ageHeader)||(f.ageHeader=0)),s){case oe.PlaylistContextType.MANIFEST:case oe.PlaylistContextType.LEVEL:this.hls.trigger(p.Events.LEVEL_LOADED,{details:f,level:i||0,id:a||0,stats:t,networkDetails:n,deliveryDirectives:m});break;case oe.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(p.Events.AUDIO_TRACK_LOADED,{details:f,id:a||0,groupId:u||"",stats:t,networkDetails:n,deliveryDirectives:m});break;case oe.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(p.Events.SUBTITLE_TRACK_LOADED,{details:f,id:a||0,groupId:u||"",stats:t,networkDetails:n,deliveryDirectives:m})}}else this.handleManifestParsingError(e,r,"invalid target duration",n)},d}();function Ve(d,l){var e;try{e=new Event("addtrack")}catch{(e=document.createEvent("Event")).initEvent("addtrack",!1,!1)}e.track=d,l.dispatchEvent(e)}function st(d,l){var e=d.mode;if(e==="disabled"&&(d.mode="hidden"),d.cues&&!d.cues.getCueById(l.id))try{if(d.addCue(l),!d.cues.getCueById(l.id))throw new Error("addCue is failed for: "+l)}catch(r){_.logger.debug("[texttrack-utils]: "+r);var t=new self.TextTrackCue(l.startTime,l.endTime,l.text);t.id=l.id,d.addCue(t)}e==="disabled"&&(d.mode=e)}function et(d){var l=d.mode;if(l==="disabled"&&(d.mode="hidden"),d.cues)for(var e=d.cues.length;e--;)d.removeCue(d.cues[e]);l==="disabled"&&(d.mode=l)}function yt(d,l,e,t){var r=d.mode;if(r==="disabled"&&(d.mode="hidden"),d.cues&&d.cues.length>0)for(var n=function(i,a,u){var h=[],f=function(k,F){if(F<k[0].startTime)return 0;var P=k.length-1;if(F>k[P].endTime)return-1;for(var K=0,Z=P;K<=Z;){var le=Math.floor((Z+K)/2);if(F<k[le].startTime)Z=le-1;else{if(!(F>k[le].startTime&&K<P))return le;K=le+1}}return k[K].startTime-F<F-k[Z].startTime?K:Z}(i,a);if(f>-1)for(var m=f,y=i.length;m<y;m++){var S=i[m];if(S.startTime>=a&&S.endTime<=u)h.push(S);else if(S.startTime>u)return h}return h}(d.cues,l,e),s=0;s<n.length;s++)t&&!t(n[s])||d.removeCue(n[s]);r==="disabled"&&(d.mode=r)}var gt=R(181),ct=R(856);function ht(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var it=function(){var d=ht();try{new d(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Qe(d,l){return d.getTime()/1e3-l}const pt=function(){function d(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var l=d.prototype;return l.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},l._registerListeners=function(){var e=this.hls;e.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(p.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},l._unregisterListeners=function(){var e=this.hls;e.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(p.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},l.onMediaAttached=function(e,t){this.media=t.media},l.onMediaDetaching=function(){this.id3Track&&(et(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},l.onManifestLoading=function(){this.dateRangeCuesAppended={}},l.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},l.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if(r.kind==="metadata"&&r.label==="id3")return Ve(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},l.onFragParsingMetadata=function(e,t){if(this.media){var r=this.hls.config,n=r.enableEmsgMetadataCues,s=r.enableID3MetadataCues;if(n||s){var i=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var a=ht(),u=0;u<i.length;u++){var h=i[u].type;if((h!==ct.MetadataSchema.emsg||n)&&s){var f=gt.getID3Frames(i[u].data);if(f){var m=i[u].pts,y=m+i[u].duration;y>it&&(y=it),y-m<=0&&(y=m+.25);for(var S=0;S<f.length;S++){var k=f[S];if(!gt.isTimeStampFrame(k)){this.updateId3CueEnds(m);var F=new a(m,y,"");F.value=k,h&&(F.type=h),this.id3Track.addCue(F)}}}}}}}},l.updateId3CueEnds=function(e){var t,r=(t=this.id3Track)===null||t===void 0?void 0:t.cues;if(r)for(var n=r.length;n--;){var s=r[n];s.startTime<e&&s.endTime===it&&(s.endTime=e)}},l.onBufferFlushing=function(e,t){var r=t.startOffset,n=t.endOffset,s=t.type,i=this.id3Track,a=this.hls;if(a){var u=a.config,h=u.enableEmsgMetadataCues,f=u.enableID3MetadataCues;i&&(h||f)&&yt(i,r,n,s==="audio"?function(m){return m.type===ct.MetadataSchema.audioId3&&f}:s==="video"?function(m){return m.type===ct.MetadataSchema.emsg&&h}:function(m){return m.type===ct.MetadataSchema.audioId3&&f||m.type===ct.MetadataSchema.emsg&&h})}},l.onLevelUpdated=function(e,t){var r=this,n=t.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var s=this.dateRangeCuesAppended,i=this.id3Track,a=n.dateRanges,u=Object.keys(a);if(i)for(var h=Object.keys(s).filter(function(K){return!u.includes(K)}),f=function(K){var Z=h[K];Object.keys(s[Z].cues).forEach(function(le){i.removeCue(s[Z].cues[le])}),delete s[Z]},m=h.length;m--;)f(m);var y=n.fragments[n.fragments.length-1];if(u.length!==0&&(0,N.isFiniteNumber)(y==null?void 0:y.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var S=y.programDateTime/1e3-y.start,k=ht(),F=function(K){var Z=u[K],le=a[Z],ne=s[Z],he=(ne==null?void 0:ne.cues)||{},Re=(ne==null?void 0:ne.durationKnown)||!1,Ge=Qe(le.startDate,S),ue=it,Ie=le.endDate;if(Ie)ue=Qe(Ie,S),Re=!0;else if(le.endOnNext&&!Re){var Ae=u.reduce(function(Rt,kt){var Ot=a[kt];return Ot.class===le.class&&Ot.id!==kt&&Ot.startDate>le.startDate&&Rt.push(Ot),Rt},[]).sort(function(Rt,kt){return Rt.startDate.getTime()-kt.startDate.getTime()})[0];Ae&&(ue=Qe(Ae.startDate,S),Re=!0)}for(var Xe,vt=Object.keys(le.attr),Je=0;Je<vt.length;Je++){var tt=vt[Je];if(tt!==B.ID&&tt!==B.CLASS&&tt!==B.START_DATE&&tt!==B.DURATION&&tt!==B.END_DATE&&tt!==B.END_ON_NEXT){var lt=he[tt];if(lt)Re&&!ne.durationKnown&&(lt.endTime=ue);else{var Pt=le.attr[tt];lt=new k(Ge,ue,""),tt!==B.SCTE35_OUT&&tt!==B.SCTE35_IN||(Xe=Pt,Pt=Uint8Array.from(Xe.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),lt.value={key:tt,data:Pt},lt.type=ct.MetadataSchema.dateRange,r.id3Track.addCue(lt),he[tt]=lt}}}s[Z]={cues:he,dateRange:le,durationKnown:Re}},P=0;P<u.length;P++)F(P)}}},d}();function Et(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}var _t=function(){function d(r){var n=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return n.timeupdate()},this.hls=r,this.config=r.config,this.registerListeners()}var l,e,t=d.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},t.registerListeners=function(){this.hls.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(p.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(p.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){this.hls.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(p.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(p.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(p.Events.ERROR,this.onError)},t.onMediaAttached=function(r,n){this.media=n.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},t.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},t.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},t.onLevelUpdated=function(r,n){var s=n.details;this.levelDetails=s,s.advanced&&this.timeupdate(),!s.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},t.onError=function(r,n){n.details===I.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,_.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},t.timeupdate=function(){var r=this.media,n=this.levelDetails;if(r&&n){this.currentTime=r.currentTime;var s=this.computeLatency();if(s!==null){this._latency=s;var i=this.config,a=i.lowLatencyMode,u=i.maxLiveSyncPlaybackRate;if(a&&u!==1){var h=this.targetLatency;if(h!==null){var f=s-h,m=f<Math.min(this.maxLatency,h+n.targetduration);if(n.live&&m&&f>.05&&this.forwardBufferLength>1){var y=Math.min(2,Math.max(1,u)),S=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20;r.playbackRate=Math.min(y,Math.max(1,S))}else r.playbackRate!==1&&r.playbackRate!==0&&(r.playbackRate=1)}}}}},t.estimateLiveEdge=function(){var r=this.levelDetails;return r===null?null:r.edge+r.age},t.computeLatency=function(){var r=this.estimateLiveEdge();return r===null?null:r-this.currentTime},l=d,(e=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var r=this.config,n=this.levelDetails;return r.liveMaxLatencyDuration!==void 0?r.liveMaxLatencyDuration:n?r.liveMaxLatencyDurationCount*n.targetduration:0}},{key:"targetLatency",get:function(){var r=this.levelDetails;if(r===null)return null;var n=r.holdBack,s=r.partHoldBack,i=r.targetduration,a=this.config,u=a.liveSyncDuration,h=a.liveSyncDurationCount,f=a.lowLatencyMode,m=this.hls.userConfig,y=f&&s||n;(m.liveSyncDuration||m.liveSyncDurationCount||y===0)&&(y=u!==void 0?u:h*i);var S=i;return y+Math.min(1*this.stallCount,S)}},{key:"liveSyncPosition",get:function(){var r=this.estimateLiveEdge(),n=this.targetLatency,s=this.levelDetails;if(r===null||n===null||s===null)return null;var i=s.edge,a=r-n-this.edgeStalled,u=i-s.totalduration,h=i-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(u,a),h)}},{key:"drift",get:function(){var r=this.levelDetails;return r===null?1:r.drift}},{key:"edgeStalled",get:function(){var r=this.levelDetails;if(r===null)return 0;var n=3*(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.max(r.age-n,0)}},{key:"forwardBufferLength",get:function(){var r=this.media,n=this.levelDetails;if(!r||!n)return 0;var s=r.buffered.length;return(s?r.buffered.end(s-1):n.edge)-this.currentTime}}])&&Et(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),d}();function Mt(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}var It,Ht=["NONE","TYPE-0","TYPE-1","TYPE-2",null];(function(d){d.No="",d.Yes="YES",d.v2="v2"})(It||(It={}));var W=function(){function d(l,e,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=l,this.part=e,this.skip=t}return d.prototype.addDirectives=function(l){var e=new self.URL(l);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},d}(),M=function(){function d(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(r){return r}).join(",").replace(/\.[^.,]+/g,"")}var l,e;return l=d,(e=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var r=t%this.url.length;this._urlId!==r&&(this.details=void 0,this._urlId=r)}}])&&Mt(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),d}();function b(){return b=Object.assign?Object.assign.bind():function(d){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(d[t]=e[t])}return d},b.apply(this,arguments)}function x(d,l,e){switch(l){case"audio":d.audioGroupIds||(d.audioGroupIds=[]),d.audioGroupIds.push(e);break;case"text":d.textGroupIds||(d.textGroupIds=[]),d.textGroupIds.push(e)}}function C(d){var l={};d.forEach(function(e){var t=e.groupId||"";e.id=l[t]=l[t]||0,l[t]++})}function U(d,l){var e=l.startPTS;if((0,N.isFiniteNumber)(e)){var t,r=0;l.sn>d.sn?(r=e-d.start,t=d):(r=d.start-e,t=l),t.duration!==r&&(t.duration=r)}else l.sn>d.sn?d.cc===l.cc&&d.minEndPTS?l.start=d.start+(d.minEndPTS-d.start):l.start=d.start+d.duration:l.start=Math.max(d.start-l.duration,0)}function V(d,l,e,t,r,n){t-e<=0&&(_.logger.warn("Fragment should have a positive duration",l),t=e+l.duration,n=r+l.duration);var s=e,i=t,a=l.startPTS,u=l.endPTS;if((0,N.isFiniteNumber)(a)){var h=Math.abs(a-e);(0,N.isFiniteNumber)(l.deltaPTS)?l.deltaPTS=Math.max(h,l.deltaPTS):l.deltaPTS=h,s=Math.max(e,a),e=Math.min(e,a),r=Math.min(r,l.startDTS),i=Math.min(t,u),t=Math.max(t,u),n=Math.max(n,l.endDTS)}l.duration=t-e;var f=e-l.start;l.start=l.startPTS=e,l.maxStartPTS=s,l.startDTS=r,l.endPTS=t,l.minEndPTS=i,l.endDTS=n;var m,y=l.sn;if(!d||y<d.startSN||y>d.endSN)return 0;var S=y-d.startSN,k=d.fragments;for(k[S]=l,m=S;m>0;m--)U(k[m],k[m-1]);for(m=S;m<k.length-1;m++)U(k[m],k[m+1]);return d.fragmentHint&&U(k[k.length-1],d.fragmentHint),d.PTSKnown=d.alignedSliding=!0,f}function Y(d,l){var e=l.startSN+l.skippedSegments-d.startSN,t=d.fragments;e<0||e>=t.length||ae(l,t[e].start)}function ae(d,l){if(l){for(var e=d.fragments,t=d.skippedSegments;t<e.length;t++)e[t].start+=l;d.fragmentHint&&(d.fragmentHint.start+=l)}}var fe=function(){function d(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=_.logger.log.bind(_.logger,t+":"),this.warn=_.logger.warn.bind(_.logger,t+":"),this.hls=e}var l=d.prototype;return l.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},l.onError=function(e,t){!t.fatal||t.type!==I.ErrorTypes.NETWORK_ERROR&&t.type!==I.ErrorTypes.KEY_SYSTEM_ERROR||this.stopLoad()},l.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},l.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},l.stopLoad=function(){this.canLoad=!1,this.clearTimer()},l.switchParams=function(e,t){var r=t==null?void 0:t.renditionReports;if(r)for(var n=0;n<r.length;n++){var s=r[n],i=void 0;try{i=new self.URL(s.URI,t.url).href}catch(f){_.logger.warn("Could not construct new URL for Rendition Report: "+f),i=s.URI||""}if(i===e.slice(-i.length)){var a=parseInt(s["LAST-MSN"])||(t==null?void 0:t.lastPartSn),u=parseInt(s["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var h=Math.min(t.age-t.partTarget,t.targetduration);u>=0&&h>t.partTarget&&(u+=1)}return new W(a,u>=0?u:void 0,It.No)}}},l.loadPlaylist=function(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},l.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},l.playlistLoaded=function(e,t,r){var n=this,s=t.details,i=t.stats,a=self.performance.now(),u=i.loading.first?Math.max(0,a-i.loading.first):0;if(s.advancedDateTime=Date.now()-u,s.live||r!=null&&r.live){if(s.reloaded(r),r&&this.log("live playlist "+e+" "+(s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:"MISSED")),r&&s.fragments.length>0&&function(Ie,Ae){for(var Xe=null,vt=Ie.fragments,Je=vt.length-1;Je>=0;Je--){var tt=vt[Je].initSegment;if(tt){Xe=tt;break}}Ie.fragmentHint&&delete Ie.fragmentHint.endPTS;var lt,Pt,Rt,kt,Ot,Vt=0;if(function(Ye,Ze,wi){for(var ai=Ze.skippedSegments,Zt=Math.max(Ye.startSN,Ze.startSN)-Ze.startSN,Li=(Ye.fragmentHint?1:0)+(ai?Ze.endSN:Math.min(Ye.endSN,Ze.endSN))-Ze.startSN,Xt=Ze.startSN-Ye.startSN,oi=Ze.fragmentHint?Ze.fragments.concat(Ze.fragmentHint):Ze.fragments,ci=Ye.fragmentHint?Ye.fragments.concat(Ye.fragmentHint):Ye.fragments,qt=Zt;qt<=Li;qt++){var hi=ci[Xt+qt],Zi=oi[qt];ai&&!Zi&&qt<ai&&(Zi=Ze.fragments[qt]=hi),hi&&Zi&&wi(hi,Zi)}}(Ie,Ae,function(Ye,Ze){Ye.relurl&&(Vt=Ye.cc-Ze.cc),(0,N.isFiniteNumber)(Ye.startPTS)&&(0,N.isFiniteNumber)(Ye.endPTS)&&(Ze.start=Ze.startPTS=Ye.startPTS,Ze.startDTS=Ye.startDTS,Ze.appendedPTS=Ye.appendedPTS,Ze.maxStartPTS=Ye.maxStartPTS,Ze.endPTS=Ye.endPTS,Ze.endDTS=Ye.endDTS,Ze.minEndPTS=Ye.minEndPTS,Ze.duration=Ye.endPTS-Ye.startPTS,Ze.duration&&(lt=Ze),Ae.PTSKnown=Ae.alignedSliding=!0),Ze.elementaryStreams=Ye.elementaryStreams,Ze.loader=Ye.loader,Ze.stats=Ye.stats,Ze.urlId=Ye.urlId,Ye.initSegment&&(Ze.initSegment=Ye.initSegment,Xe=Ye.initSegment)}),Xe&&(Ae.fragmentHint?Ae.fragments.concat(Ae.fragmentHint):Ae.fragments).forEach(function(Ye){var Ze;Ye.initSegment&&Ye.initSegment.relurl!==((Ze=Xe)===null||Ze===void 0?void 0:Ze.relurl)||(Ye.initSegment=Xe)}),Ae.skippedSegments)if(Ae.deltaUpdateFailed=Ae.fragments.some(function(Ye){return!Ye}),Ae.deltaUpdateFailed){_.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var qr=Ae.skippedSegments;qr--;)Ae.fragments.shift();Ae.startSN=Ae.fragments[0].sn,Ae.startCC=Ae.fragments[0].cc}else Ae.canSkipDateRanges&&(Ae.dateRanges=(Pt=Ie.dateRanges,Rt=Ae.dateRanges,kt=Ae.recentlyRemovedDateranges,Ot=b({},Pt),kt&&kt.forEach(function(Ye){delete Ot[Ye]}),Object.keys(Rt).forEach(function(Ye){var Ze=new re(Rt[Ye].attr,Ot[Ye]);Ze.isValid?Ot[Ye]=Ze:_.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(Rt[Ye].attr)+'"')}),Ot));var Jt=Ae.fragments;if(Vt){_.logger.warn("discontinuity sliding from playlist, take drift into account");for(var Fi=0;Fi<Jt.length;Fi++)Jt[Fi].cc+=Vt}Ae.skippedSegments&&(Ae.startCC=Ae.fragments[0].cc),function(Ye,Ze,wi){if(Ye&&Ze)for(var ai=0,Zt=0,Li=Ye.length;Zt<=Li;Zt++){var Xt=Ye[Zt],oi=Ze[Zt+ai];Xt&&oi&&Xt.index===oi.index&&Xt.fragment.sn===oi.fragment.sn?(ci=Xt,(qt=oi).elementaryStreams=ci.elementaryStreams,qt.stats=ci.stats):ai--}var ci,qt}(Ie.partList,Ae.partList),lt?V(Ae,lt,lt.startPTS,lt.endPTS,lt.startDTS,lt.endDTS):Y(Ie,Ae),Jt.length&&(Ae.totalduration=Ae.edge-Jt[0].start),Ae.driftStartTime=Ie.driftStartTime,Ae.driftStart=Ie.driftStart;var Mi=Ae.advancedDateTime;if(Ae.advanced&&Mi){var Ni=Ae.edge;Ae.driftStart||(Ae.driftStartTime=Mi,Ae.driftStart=Ni),Ae.driftEndTime=Mi,Ae.driftEnd=Ni}else Ae.driftEndTime=Ie.driftEndTime,Ae.driftEnd=Ie.driftEnd,Ae.advancedDateTime=Ie.advancedDateTime}(r,s),!this.canLoad||!s.live)return;var h,f=void 0,m=void 0;if(s.canBlockReload&&s.endSN&&s.advanced){var y=this.hls.config.lowLatencyMode,S=s.lastPartSn,k=s.endSN,F=s.lastPartIndex,P=S===k;F!==-1?(f=P?k+1:S,m=P?y?0:F:F+1):f=k+1;var K=s.age,Z=K+s.ageHeader,le=Math.min(Z-s.partTarget,1.5*s.targetduration);if(le>0){if(r&&le>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+le+" with playlist age: "+s.age),le=0;else{var ne=Math.floor(le/s.targetduration);f+=ne,m!==void 0&&(m+=Math.round(le%s.targetduration/s.partTarget)),this.log("CDN Tune-in age: "+s.ageHeader+"s last advanced "+K.toFixed(2)+"s goal: "+le+" skip sn "+ne+" to part "+m)}s.tuneInGoal=le}if(h=this.getDeliveryDirectives(s,t.deliveryDirectives,f,m),y||!P)return void this.loadPlaylist(h)}else h=this.getDeliveryDirectives(s,t.deliveryDirectives,f,m);var he=this.hls.mainForwardBufferInfo,Re=he?he.end-he.len:0,Ge=function(Ie,Ae){Ae===void 0&&(Ae=1/0);var Xe=1e3*Ie.targetduration;if(Ie.updated){var vt=Ie.fragments;if(vt.length&&4*Xe>Ae){var Je=1e3*vt[vt.length-1].duration;Je<Xe&&(Xe=Je)}}else Xe/=2;return Math.round(Xe)}(s,1e3*(s.edge-Re));s.updated?a>this.requestScheduled+Ge&&(this.requestScheduled=i.loading.start):this.requestScheduled=-1,f!==void 0&&s.canBlockReload?this.requestScheduled=i.loading.first+Ge-(1e3*s.partTarget||1e3):this.requestScheduled=(this.requestScheduled===-1?a:this.requestScheduled)+Ge;var ue=this.requestScheduled-a;ue=Math.max(0,ue),this.log("reload live playlist "+e+" in "+Math.round(ue)+" ms"),this.timer=self.setTimeout(function(){return n.loadPlaylist(h)},ue)}else this.clearTimer()},l.getDeliveryDirectives=function(e,t,r,n){var s=function(i,a){var u=i.canSkipUntil,h=i.canSkipDateRanges,f=i.endSN;return u&&(a!==void 0?a-f:0)<u?h?It.v2:It.Yes:It.No}(e,r);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,n=t.part,s=It.No),new W(r,n,s)},l.retryLoadingOrFail=function(e){var t,r=this,n=this.hls.config,s=this.retryCount<n.levelLoadingMaxRetry;if(s)if(this.requestScheduled=-1,this.retryCount++,e.details.indexOf("LoadTimeOut")>-1&&(t=e.context)!==null&&t!==void 0&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist();else{var i=Math.min(Math.pow(2,this.retryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return r.loadPlaylist()},i),this.warn("retry playlist loading #"+this.retryCount+" in "+i+' ms after "'+e.details+'"')}else this.warn('cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0;return s},d}();function pe(){return pe=Object.assign?Object.assign.bind():function(d){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(d[t]=e[t])}return d},pe.apply(this,arguments)}function ke(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}function Ue(d,l){return Ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ue(d,l)}var De,je=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),ze=function(d){var l,e;function t(i){var a;return(a=d.call(this,i,"[level-controller]")||this)._levels=[],a._firstLevel=-1,a._startLevel=void 0,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.onParsedComplete=void 0,a._registerListeners(),a}e=d,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Ue(l,e);var r,n,s=t.prototype;return s._registerListeners=function(){var i=this.hls;i.on(p.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(p.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(p.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(p.Events.ERROR,this.onError,this)},s._unregisterListeners=function(){var i=this.hls;i.off(p.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(p.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(p.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(p.Events.ERROR,this.onError,this)},s.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,d.prototype.destroy.call(this)},s.startLoad=function(){this._levels.forEach(function(i){i.loadError=0}),d.prototype.startLoad.call(this)},s.onManifestLoaded=function(i,a){var u,h,f=[],m=[],y=[],S={},k=!1,F=!1,P=!1;if(a.levels.forEach(function(ne){var he=ne.attrs;k=k||!(!ne.width||!ne.height),F=F||!!ne.videoCodec,P=P||!!ne.audioCodec,je&&ne.audioCodec&&ne.audioCodec.indexOf("mp4a.40.34")!==-1&&(ne.audioCodec=void 0);var Re=ne.bitrate+"-"+ne.attrs.RESOLUTION+"-"+ne.attrs.CODECS;(h=S[Re])?h.url.push(ne.url):(h=new M(ne),S[Re]=h,f.push(h)),he&&(he.AUDIO&&x(h,"audio",he.AUDIO),he.SUBTITLES&&x(h,"text",he.SUBTITLES))}),(k||F)&&P&&(f=f.filter(function(ne){var he=ne.videoCodec,Re=ne.width,Ge=ne.height;return!!he||!(!Re||!Ge)})),f=f.filter(function(ne){var he=ne.audioCodec,Re=ne.videoCodec;return(!he||Fe(he,"audio"))&&(!Re||Fe(Re,"video"))}),a.audioTracks&&C(m=a.audioTracks.filter(function(ne){return!ne.audioCodec||Fe(ne.audioCodec,"audio")})),a.subtitles&&C(y=a.subtitles),f.length>0){u=f[0].bitrate,f.sort(function(ne,he){return ne.attrs["HDCP-LEVEL"]!==he.attrs["HDCP-LEVEL"]?(ne.attrs["HDCP-LEVEL"]||"")>(he.attrs["HDCP-LEVEL"]||"")?1:-1:ne.bitrate!==he.bitrate?ne.bitrate-he.bitrate:ne.attrs.SCORE!==he.attrs.SCORE?ne.attrs.decimalFloatingPoint("SCORE")-he.attrs.decimalFloatingPoint("SCORE"):k&&ne.height!==he.height?ne.height-he.height:0}),this._levels=f;for(var K=0;K<f.length;K++)if(f[K].bitrate===u){this._firstLevel=K,this.log("manifest loaded, "+f.length+" level(s) found, first bitrate: "+u);break}var Z=P&&!F,le={levels:f,audioTracks:m,subtitleTracks:y,sessionData:a.sessionData,sessionKeys:a.sessionKeys,firstLevel:this._firstLevel,stats:a.stats,audio:P,video:F,altAudio:!Z&&m.some(function(ne){return!!ne.url})};this.hls.trigger(p.Events.MANIFEST_PARSED,le),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(p.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})},s.onError=function(i,a){var u,h;if(d.prototype.onError.call(this,i,a),!a.fatal){var f=a.context,m=this._levels[this.currentLevelIndex];if(f&&(f.type===oe.PlaylistContextType.AUDIO_TRACK&&m.audioGroupIds&&f.groupId===m.audioGroupIds[m.urlId]||f.type===oe.PlaylistContextType.SUBTITLE_TRACK&&m.textGroupIds&&f.groupId===m.textGroupIds[m.urlId]))this.redundantFailover(this.currentLevelIndex);else{var y,S=!1,k=!0;switch(a.details){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:case I.ErrorDetails.KEY_LOAD_ERROR:case I.ErrorDetails.KEY_LOAD_TIMEOUT:if(a.frag){var F=a.frag.type===oe.PlaylistLevelType.MAIN?a.frag.level:this.currentLevelIndex,P=this._levels[F];P?(P.fragmentError++,P.fragmentError>this.hls.config.fragLoadingMaxRetry&&(y=F)):y=F}break;case I.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var K=m.attrs["HDCP-LEVEL"];K&&(this.hls.maxHdcpLevel=Ht[Ht.indexOf(K)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'));case I.ErrorDetails.FRAG_PARSING_ERROR:case I.ErrorDetails.KEY_SYSTEM_NO_SESSION:y=((u=a.frag)===null||u===void 0?void 0:u.type)===oe.PlaylistLevelType.MAIN?a.frag.level:this.currentLevelIndex,a.levelRetry=!1;break;case I.ErrorDetails.LEVEL_LOAD_ERROR:case I.ErrorDetails.LEVEL_LOAD_TIMEOUT:f&&(f.deliveryDirectives&&(k=!1),y=f.level),S=!0;break;case I.ErrorDetails.REMUX_ALLOC_ERROR:y=(h=a.level)!=null?h:this.currentLevelIndex,S=!0}y!==void 0&&this.recoverLevel(a,y,S,k)}}},s.recoverLevel=function(i,a,u,h){var f=i.details,m=this._levels[a];if(m.loadError++,u){if(!this.retryLoadingOrFail(i))return void(this.currentLevelIndex=-1);i.levelRetry=!0}if(h){var y=m.url.length;if(y>1&&m.loadError<y)i.levelRetry=!0,this.redundantFailover(a);else if(this.manualLevelIndex===-1){for(var S=-1,k=this._levels,F=k.length;F--;){var P=(F+this.currentLevelIndex)%k.length;if(P!==this.currentLevelIndex&&k[P].loadError===0){S=P;break}}S>-1&&this.currentLevelIndex!==S?(this.warn(f+": switch to "+S),i.levelRetry=!0,this.hls.nextAutoLevel=S):i.levelRetry===!1&&(i.fatal=!0)}}},s.redundantFailover=function(i){var a=this._levels[i],u=a.url.length;if(u>1){var h=(a.urlId+1)%u;this.warn("Switching to redundant URL-id "+h),this._levels.forEach(function(f){f.urlId=h}),this.level=i}},s.onFragLoaded=function(i,a){var u=a.frag;if(u!==void 0&&u.type===oe.PlaylistLevelType.MAIN){var h=this._levels[u.level];h!==void 0&&(h.fragmentError=0,h.loadError=0)}},s.onLevelLoaded=function(i,a){var u,h,f=a.level,m=a.details,y=this._levels[f];if(!y)return this.warn("Invalid level index "+f),void((h=a.deliveryDirectives)!==null&&h!==void 0&&h.skip&&(m.deltaUpdateFailed=!0));f===this.currentLevelIndex?(y.fragmentError===0&&(y.loadError=0,this.retryCount=0),this.playlistLoaded(f,a,y.details)):(u=a.deliveryDirectives)!==null&&u!==void 0&&u.skip&&(m.deltaUpdateFailed=!0)},s.onAudioTrackSwitched=function(i,a){var u=this.hls.levels[this.currentLevelIndex];if(u&&u.audioGroupIds){for(var h=-1,f=this.hls.audioTracks[a.id].groupId,m=0;m<u.audioGroupIds.length;m++)if(u.audioGroupIds[m]===f){h=m;break}h!==u.urlId&&(u.urlId=h,this.startLoad())}},s.loadPlaylist=function(i){d.prototype.loadPlaylist.call(this);var a=this.currentLevelIndex,u=this._levels[a];if(this.canLoad&&u&&u.url.length>0){var h=u.urlId,f=u.url[h];if(i)try{f=i.addDirectives(f)}catch(m){this.warn("Could not construct new URL with HLS Delivery Directives: "+m)}this.log("Attempt loading level index "+a+(i?" at sn "+i.msn+" part "+i.part:"")+" with URL-id "+h+" "+f),this.clearTimer(),this.hls.trigger(p.Events.LEVEL_LOADING,{url:f,level:a,id:h,deliveryDirectives:i||null})}},s.removeLevel=function(i,a){var u=function(f,m){return m!==a},h=this._levels.filter(function(f,m){return m!==i||f.url.length>1&&a!==void 0&&(f.url=f.url.filter(u),f.audioGroupIds&&(f.audioGroupIds=f.audioGroupIds.filter(u)),f.textGroupIds&&(f.textGroupIds=f.textGroupIds.filter(u)),f.urlId=0,!0)}).map(function(f,m){var y=f.details;return y!=null&&y.fragments&&y.fragments.forEach(function(S){S.level=m}),f});this._levels=h,this.hls.trigger(p.Events.LEVELS_UPDATED,{levels:h})},r=t,(n=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(i){var a,u=this._levels;if(u.length!==0&&(this.currentLevelIndex!==i||(a=u[i])===null||a===void 0||!a.details)){if(i<0||i>=u.length){var h=i<0;if(this.hls.trigger(p.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.LEVEL_SWITCH_ERROR,level:i,fatal:h,reason:"invalid level idx"}),h)return;i=Math.min(i,u.length-1)}this.clearTimer();var f=this.currentLevelIndex,m=u[f],y=u[i];this.log("switching to level "+i+" from "+f),this.currentLevelIndex=i;var S=pe({},y,{level:i,maxBitrate:y.maxBitrate,uri:y.uri,urlId:y.urlId});delete S._urlId,this.hls.trigger(p.Events.LEVEL_SWITCHING,S);var k=y.details;if(!k||k.live){var F=this.switchParams(y.uri,m==null?void 0:m.details);this.loadPlaylist(F)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(i){this.manualLevelIndex=i,this._startLevel===void 0&&(this._startLevel=i),i!==-1&&(this.level=i)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(i){this._firstLevel=i}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var i=this.hls.config.startLevel;return i!==void 0?i:this._firstLevel}return this._startLevel},set:function(i){this._startLevel=i}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(i){this.level=i,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=i)}}])&&ke(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),t}(fe);(function(d){d.NOT_LOADED="NOT_LOADED",d.APPENDING="APPENDING",d.PARTIAL="PARTIAL",d.OK="OK"})(De||(De={}));var ot=function(){function d(e){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var l=d.prototype;return l._registerListeners=function(){var e=this.hls;e.on(p.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(p.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(p.Events.FRAG_LOADED,this.onFragLoaded,this)},l._unregisterListeners=function(){var e=this.hls;e.off(p.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(p.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(p.Events.FRAG_LOADED,this.onFragLoaded,this)},l.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},l.getAppendedFrag=function(e,t){if(t===oe.PlaylistLevelType.MAIN){var r=this.activeFragment,n=this.activeParts;if(!r)return null;if(n)for(var s=n.length;s--;){var i=n[s],a=i?i.end:r.appendedPTS;if(i.start<=e&&a!==void 0&&e<=a)return s>9&&(this.activeParts=n.slice(s-9)),i}else if(r.start<=e&&r.appendedPTS!==void 0&&e<=r.appendedPTS)return r}return this.getBufferedFrag(e,t)},l.getBufferedFrag=function(e,t){for(var r=this.fragments,n=Object.keys(r),s=n.length;s--;){var i=r[n[s]];if((i==null?void 0:i.body.type)===t&&i.buffered){var a=i.body;if(a.start<=e&&e<=a.end)return a}}return null},l.detectEvictedFragments=function(e,t,r){var n=this;this.timeRanges&&(this.timeRanges[e]=t),Object.keys(this.fragments).forEach(function(s){var i=n.fragments[s];if(i)if(i.buffered||i.loaded){var a=i.range[e];a&&a.time.some(function(u){var h=!n.isTimeBuffered(u.startPTS,u.endPTS,t);return h&&n.removeFragment(i.body),h})}else i.body.type===r&&n.removeFragment(i.body)})},l.detectPartialFragments=function(e){var t=this,r=this.timeRanges,n=e.frag,s=e.part;if(r&&n.sn!=="initSegment"){var i=mt(n),a=this.fragments[i];a&&(Object.keys(r).forEach(function(u){var h=n.elementaryStreams[u];if(h){var f=r[u],m=s!==null||h.partial===!0;a.range[u]=t.getBufferedTimes(n,s,m,f)}}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,a.body.endList&&(this.endListFragments[a.body.type]=a)):this.removeFragment(a.body))}},l.fragBuffered=function(e){var t=mt(e),r=this.fragments[t];r&&(r.loaded=null,r.buffered=!0)},l.getBufferedTimes=function(e,t,r,n){for(var s={time:[],partial:r},i=t?t.start:e.start,a=t?t.end:e.end,u=e.minEndPTS||a,h=e.maxStartPTS||i,f=0;f<n.length;f++){var m=n.start(f)-this.bufferPadding,y=n.end(f)+this.bufferPadding;if(h>=m&&u<=y){s.time.push({startPTS:Math.max(i,n.start(f)),endPTS:Math.min(a,n.end(f))});break}if(i<y&&a>m)s.partial=!0,s.time.push({startPTS:Math.max(i,n.start(f)),endPTS:Math.min(a,n.end(f))});else if(a<=m)break}return s},l.getPartialFragment=function(e){var t,r,n,s=null,i=0,a=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach(function(h){var f=u[h];f&&Ke(f)&&(r=f.body.start-a,n=f.body.end+a,e>=r&&e<=n&&(t=Math.min(e-r,n-e),i<=t&&(s=f.body,i=t)))}),s},l.isEndListAppended=function(e){var t=this.endListFragments[e];return t!==void 0&&(t.buffered||Ke(t))},l.getState=function(e){var t=mt(e),r=this.fragments[t];return r?r.buffered?Ke(r)?De.PARTIAL:De.OK:De.APPENDING:De.NOT_LOADED},l.isTimeBuffered=function(e,t,r){for(var n,s,i=0;i<r.length;i++){if(n=r.start(i)-this.bufferPadding,s=r.end(i)+this.bufferPadding,e>=n&&t<=s)return!0;if(t<=n)return!1}return!1},l.onFragLoaded=function(e,t){var r=t.frag,n=t.part;if(r.sn!=="initSegment"&&!r.bitrateTest&&!n){var s=mt(r);this.fragments[s]={body:r,loaded:t,buffered:!1,range:Object.create(null)}}},l.onBufferAppended=function(e,t){var r=this,n=t.frag,s=t.part,i=t.timeRanges;if(n.type===oe.PlaylistLevelType.MAIN)if(this.activeFragment!==n&&(this.activeFragment=n,n.appendedPTS=void 0),s){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(s)}else this.activeParts=null;this.timeRanges=i,Object.keys(i).forEach(function(u){var h=i[u];if(r.detectEvictedFragments(u,h),!s&&n.type===oe.PlaylistLevelType.MAIN){var f=n.elementaryStreams[u];if(!f)return;for(var m=0;m<h.length;m++){var y=h.end(m);y<=f.endPTS&&y>f.startPTS?n.appendedPTS=Math.max(y,n.appendedPTS||0):n.appendedPTS=f.endPTS}}})},l.onFragBuffered=function(e,t){this.detectPartialFragments(t)},l.hasFragment=function(e){var t=mt(e);return!!this.fragments[t]},l.removeFragmentsInRange=function(e,t,r){var n=this;Object.keys(this.fragments).forEach(function(s){var i=n.fragments[s];if(i&&i.buffered){var a=i.body;a.type===r&&a.start<t&&a.end>e&&n.removeFragment(a)}})},l.removeFragment=function(e){var t=mt(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),e.appendedPTS=void 0,delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]},l.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},d}();function Ke(d){var l,e;return d.buffered&&(((l=d.range.video)===null||l===void 0?void 0:l.partial)||((e=d.range.audio)===null||e===void 0?void 0:e.partial))}function mt(d){return d.type+"_"+d.level+"_"+d.urlId+"_"+d.sn}function Ut(d){var l=typeof Map=="function"?new Map:void 0;return Ut=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(e))return l.get(e);l.set(e,r)}function r(){return At(e,arguments,He(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Lt(r,e)},Ut(d)}function At(d,l,e){return At=Tt()?Reflect.construct.bind():function(t,r,n){var s=[null];s.push.apply(s,r);var i=new(Function.bind.apply(t,s));return n&&Lt(i,n.prototype),i},At.apply(null,arguments)}function Tt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Lt(d,l){return Lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Lt(d,l)}function He(d){return He=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},He(d)}var jt=Math.pow(2,17),ri=function(){function d(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var l=d.prototype;return l.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},l.abort=function(){this.loader&&this.loader.abort()},l.load=function(e,t){var r=this,n=e.url;if(!n)return Promise.reject(new xt({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var s=this.config,i=s.fLoader,a=s.loader;return new Promise(function(u,h){r.loader&&r.loader.destroy();var f=r.loader=e.loader=i?new i(s):new a(s),m=wt(e),y={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:e.sn==="initSegment"?1/0:jt};e.stats=f.stats,f.load(m,y,{onSuccess:function(S,k,F,P){r.resetLoader(e,f);var K=S.data;F.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(K.slice(0,16)),K=K.slice(16)),u({frag:e,part:null,payload:K,networkDetails:P})},onError:function(S,k,F){r.resetLoader(e,f),h(new xt({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:S,networkDetails:F}))},onAbort:function(S,k,F){r.resetLoader(e,f),h(new xt({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:F}))},onTimeout:function(S,k,F){r.resetLoader(e,f),h(new xt({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:F}))},onProgress:function(S,k,F,P){t&&t({frag:e,part:null,payload:F,networkDetails:P})}})})},l.loadPart=function(e,t,r){var n=this;this.abort();var s=this.config,i=s.fLoader,a=s.loader;return new Promise(function(u,h){n.loader&&n.loader.destroy();var f=n.loader=e.loader=i?new i(s):new a(s),m=wt(e,t),y={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:jt};t.stats=f.stats,f.load(m,y,{onSuccess:function(S,k,F,P){n.resetLoader(e,f),n.updateStatsFromPart(e,t);var K={frag:e,part:t,payload:S.data,networkDetails:P};r(K),u(K)},onError:function(S,k,F){n.resetLoader(e,f),h(new xt({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:S,networkDetails:F}))},onAbort:function(S,k,F){e.stats.aborted=t.stats.aborted,n.resetLoader(e,f),h(new xt({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,networkDetails:F}))},onTimeout:function(S,k,F){n.resetLoader(e,f),h(new xt({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,networkDetails:F}))}})})},l.updateStatsFromPart=function(e,t){var r=e.stats,n=t.stats,s=n.total;if(r.loaded+=n.loaded,s){var i=Math.round(e.duration/t.duration),a=Math.min(Math.round(r.loaded/s),i),u=(i-a)*Math.round(r.loaded/a);r.total=r.loaded+u}else r.total=Math.max(r.loaded,r.total);var h=r.loading,f=n.loading;h.start?h.first+=f.first-f.start:(h.start=f.start,h.first=f.first),h.end=f.end},l.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},d}();function wt(d,l){l===void 0&&(l=null);var e=l||d,t={frag:d,part:l,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},r=e.byteRangeStartOffset,n=e.byteRangeEndOffset;if((0,N.isFiniteNumber)(r)&&(0,N.isFiniteNumber)(n)){var s,i=r,a=n;if(d.sn==="initSegment"&&((s=d.decryptdata)===null||s===void 0?void 0:s.method)==="AES-128"){var u=n-r;u%16&&(a=n+(16-u%16)),r!==0&&(t.resetIV=!0,i=r-16)}t.rangeStart=i,t.rangeEnd=a}return t}var xt=function(d){var l,e;function t(r){for(var n,s=arguments.length,i=new Array(s>1?s-1:0),a=1;a<s;a++)i[a-1]=arguments[a];return(n=d.call.apply(d,[this].concat(i))||this).data=void 0,n.data=r,n}return e=d,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Lt(l,e),t}(Ut(Error)),Yt=function(){function d(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var l=d.prototype;return l.abort=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.abort()}},l.detach=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},l.destroy=function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},l.createKeyLoadError=function(e,t,r,n){return t===void 0&&(t=I.ErrorDetails.KEY_LOAD_ERROR),new xt({type:I.ErrorTypes.NETWORK_ERROR,details:t,fatal:!1,frag:e,networkDetails:r})},l.loadClear=function(e,t){var r=this;if(this.emeController&&this.config.emeEnabled)for(var n=e.sn,s=e.cc,i=function(u){var h=t[u];if(s<=h.cc&&(n==="initSegment"||n<h.sn))return r.emeController.selectKeySystemFormat(h).then(function(f){h.setKeyFormat(f)}),"break"},a=0;a<t.length&&i(a)!=="break";a++);},l.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(function(r){return t.loadInternal(e,r)}):this.loadInternal(e)},l.loadInternal=function(e,t){var r,n;t&&e.setKeyFormat(t);var s=e.decryptdata;if(!s){var i=t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(e,I.ErrorDetails.KEY_LOAD_ERROR,null,i))}var a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,I.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+a+'"'));var u,h=this.keyUriToKeyInfo[a];if((r=h)!==null&&r!==void 0&&r.decryptdata.key)return s.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if((n=h)!==null&&n!==void 0&&n.keyLoadPromise)switch((u=h.mediaKeySessionContext)===null||u===void 0?void 0:u.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return h.keyLoadPromise}switch(h=this.keyUriToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,I.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+s.method+'"'))}},l.loadKeyEME=function(e,t){var r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n=this.emeController.loadKey(r);if(n)return(e.keyLoadPromise=n.then(function(s){return e.mediaKeySessionContext=s,r})).catch(function(s){throw e.keyLoadPromise=null,s})}return Promise.resolve(r)},l.loadKeyHTTP=function(e,t){var r=this,n=this.config,s=new n.loader(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise(function(i,a){var u={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},h={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:n.fragLoadingRetryDelay,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:0},f={onSuccess:function(m,y,S,k){var F=S.frag,P=S.keyInfo,K=S.url;if(!F.decryptdata||P!==r.keyUriToKeyInfo[K])return a(r.createKeyLoadError(F,I.ErrorDetails.KEY_LOAD_ERROR,k,"after key load, decryptdata unset or changed"));P.decryptdata.key=F.decryptdata.key=new Uint8Array(m.data),F.keyLoader=null,P.loader=null,i({frag:F,keyInfo:P})},onError:function(m,y,S){r.resetLoader(y),a(r.createKeyLoadError(t,I.ErrorDetails.KEY_LOAD_ERROR,S))},onTimeout:function(m,y,S){r.resetLoader(y),a(r.createKeyLoadError(t,I.ErrorDetails.KEY_LOAD_TIMEOUT,S))},onAbort:function(m,y,S){r.resetLoader(y),a(r.createKeyLoadError(t,I.ErrorDetails.INTERNAL_ABORTED,S))}};s.load(u,h,f)})},l.resetLoader=function(e){var t=e.frag,r=e.keyInfo,n=e.url,s=r.loader;t.keyLoader===s&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[n],s&&s.destroy()},d}(),gi=function(){function d(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var l=d.prototype;return l.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},l.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},l.onHandlerDestroyed=function(){},l.hasInterval=function(){return!!this._tickInterval},l.hasNextTick=function(){return!!this._tickTimer},l.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},l.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},l.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},l.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},l.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},l.doTick=function(){},d}(),Wt={length:0,start:function(){return 0},end:function(){return 0}},St=function(){function d(){}return d.isBuffered=function(l,e){try{if(l){for(var t=d.getBuffered(l),r=0;r<t.length;r++)if(e>=t.start(r)&&e<=t.end(r))return!0}}catch{}return!1},d.bufferInfo=function(l,e,t){try{if(l){var r,n=d.getBuffered(l),s=[];for(r=0;r<n.length;r++)s.push({start:n.start(r),end:n.end(r)});return this.bufferedInfo(s,e,t)}}catch{}return{len:0,start:e,end:e,nextStart:void 0}},d.bufferedInfo=function(l,e,t){e=Math.max(0,e),l.sort(function(k,F){return k.start-F.start||F.end-k.end});var r=[];if(t)for(var n=0;n<l.length;n++){var s=r.length;if(s){var i=r[s-1].end;l[n].start-i<t?l[n].end>i&&(r[s-1].end=l[n].end):r.push(l[n])}else r.push(l[n])}else r=l;for(var a,u=0,h=e,f=e,m=0;m<r.length;m++){var y=r[m].start,S=r[m].end;if(e+t>=y&&e<S)h=y,u=(f=S)-e;else if(e+t<y){a=y;break}}return{len:u,start:h||0,end:f||0,nextStart:a}},d.getBuffered=function(l){try{return l.buffered}catch(e){return _.logger.log("failed to get media.buffered",e),Wt}},d}(),ur=function(d,l,e,t,r,n){t===void 0&&(t=0),r===void 0&&(r=-1),n===void 0&&(n=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=d,this.sn=l,this.id=e,this.size=t,this.part=r,this.partial=n};function cn(d,l){for(var e=null,t=0,r=d.length;t<r;t++){var n=d[t];if(n&&n.cc===l){e=n;break}}return e}function hn(d,l){if(d){var e=d.start+l;d.start=d.startPTS=e,d.endPTS=e+d.duration}}function cr(d,l){for(var e=l.fragments,t=0,r=e.length;t<r;t++)hn(e[t],d);l.fragmentHint&&hn(l.fragmentHint,d),l.alignedSliding=!0}function dn(d,l){if(d.hasProgramDateTime&&l.hasProgramDateTime){var e=d.fragments,t=l.fragments;if(e.length&&t.length){var r=t[Math.round(t.length/2)-1],n=cn(e,r.cc)||e[Math.round(e.length/2)-1],s=r.programDateTime,i=n.programDateTime;s!==null&&i!==null&&cr((i-s)/1e3-(n.start-r.start),d)}}}const fn=function(d,l){for(var e=0,t=d.length-1,r=null,n=null;e<=t;){var s=l(n=d[r=(e+t)/2|0]);if(s>0)e=r+1;else{if(!(s<0))return n;t=r-1}}return null};function hr(d,l,e,t){e===void 0&&(e=0),t===void 0&&(t=0);var r=null;if(d?r=l[d.sn-l[0].sn+1]||null:e===0&&l[0].start===0&&(r=l[0]),r&&dr(e,t,r)===0)return r;var n=fn(l,dr.bind(null,e,t));return!n||n===d&&r?r:n}function dr(d,l,e){if(d===void 0&&(d=0),l===void 0&&(l=0),e.start<=d&&e.start+e.duration>d)return 0;var t=Math.min(l,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=d?1:e.start-t>d&&e.start?-1:0}function Ps(d,l,e){var t=1e3*Math.min(l,e.duration+(e.deltaPTS?e.deltaPTS:0));return(e.endProgramDateTime||0)-t>d}var Os=R(21);const xs=function(d){for(var l="",e=d.length,t=0;t<e;t++)l+="["+d.start(t).toFixed(3)+","+d.end(t).toFixed(3)+"]";return l};function Fs(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}function fr(d,l){return fr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fr(d,l)}var $t="STOPPED",nt="IDLE",gn="KEY_LOADING",Ti="FRAG_LOADING",Si="FRAG_LOADING_WAITING_RETRY",Yi="WAITING_TRACK",Qt="PARSING",Ci="PARSED",_i="ENDED",ni="ERROR",Pi="WAITING_INIT_PTS",ki="WAITING_LEVEL",gr=function(d){var l,e;function t(i,a,u,h){var f;return(f=d.call(this)||this).hls=void 0,f.fragPrevious=null,f.fragCurrent=null,f.fragmentTracker=void 0,f.transmuxer=null,f._state=$t,f.media=null,f.mediaBuffer=null,f.config=void 0,f.bitrateTest=!1,f.lastCurrentTime=0,f.nextLoadPosition=0,f.startPosition=0,f.loadedmetadata=!1,f.fragLoadError=0,f.retryDate=0,f.levels=null,f.fragmentLoader=void 0,f.keyLoader=void 0,f.levelLastLoaded=null,f.startFragRequested=!1,f.decrypter=void 0,f.initPTS=[],f.onvseeking=null,f.onvended=null,f.logPrefix="",f.log=void 0,f.warn=void 0,f.logPrefix=h,f.log=_.logger.log.bind(_.logger,h+":"),f.warn=_.logger.warn.bind(_.logger,h+":"),f.hls=i,f.fragmentLoader=new ri(i.config),f.keyLoader=u,f.fragmentTracker=a,f.config=i.config,f.decrypter=new Os.default(i.config),i.on(p.Events.LEVEL_SWITCHING,f.onLevelSwitching,function(m){if(m===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m}(f)),f}e=d,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,fr(l,e);var r,n,s=t.prototype;return s.doTick=function(){this.onTickEnd()},s.onTickEnd=function(){},s.startLoad=function(i){},s.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var i=this.fragCurrent;i&&(i.abortRequests(),this.fragmentTracker.removeFragment(i)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=$t},s._streamEnded=function(i,a){if(a.live||i.nextStart||!i.end||!this.media)return!1;var u=a.partList;if(u!=null&&u.length){var h=u[u.length-1];return St.isBuffered(this.media,h.start+h.duration/2)}var f=a.fragments[a.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(f)},s.getLevelDetails=function(){var i;if(this.levels&&this.levelLastLoaded!==null)return(i=this.levels[this.levelLastLoaded])===null||i===void 0?void 0:i.details},s.onMediaAttached=function(i,a){var u=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),u.addEventListener("seeking",this.onvseeking),u.addEventListener("ended",this.onvended);var h=this.config;this.levels&&h.autoStartLoad&&this.state===$t&&this.startLoad(h.startPosition)},s.onMediaDetaching=function(){var i=this.media;i!=null&&i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),i&&this.onvseeking&&this.onvended&&(i.removeEventListener("seeking",this.onvseeking),i.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},s.onMediaSeeking=function(){var i=this.config,a=this.fragCurrent,u=this.media,h=this.mediaBuffer,f=this.state,m=u?u.currentTime:0,y=St.bufferInfo(h||u,m,i.maxBufferHole);if(this.log("media seeking to "+((0,N.isFiniteNumber)(m)?m.toFixed(3):m)+", state: "+f),this.state===_i)this.resetLoadingState();else if(a){var S=i.maxFragLookUpTolerance,k=a.start-S,F=a.start+a.duration+S;if(!y.len||F<y.start||k>y.end){var P=m>F;(m<k||P)&&(P&&a.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.abortRequests()),this.resetLoadingState())}}u&&(this.lastCurrentTime=m),this.loadedmetadata||y.len||(this.nextLoadPosition=this.startPosition=m),this.tickImmediate()},s.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},s.onLevelSwitching=function(i,a){this.fragLoadError=0},s.onHandlerDestroying=function(){this.stopLoad(),d.prototype.onHandlerDestroying.call(this)},s.onHandlerDestroyed=function(){this.state=$t,this.hls.off(p.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,d.prototype.onHandlerDestroyed.call(this)},s.loadFragment=function(i,a,u){this._loadFragForPlayback(i,a,u)},s._loadFragForPlayback=function(i,a,u){var h=this;this._doFragLoad(i,a,u,function(f){if(h.fragContextChanged(i))return h.warn("Fragment "+i.sn+(f.part?" p: "+f.part.index:"")+" of level "+i.level+" was dropped during download."),void h.fragmentTracker.removeFragment(i);i.stats.chunkCount++,h._handleFragmentLoadProgress(f)}).then(function(f){if(f){h.fragLoadError=0;var m=h.state;h.fragContextChanged(i)?(m===Ti||!h.fragCurrent&&m===Qt)&&(h.fragmentTracker.removeFragment(i),h.state=nt):("payload"in f&&(h.log("Loaded fragment "+i.sn+" of level "+i.level),h.hls.trigger(p.Events.FRAG_LOADED,f)),h._handleFragmentLoadComplete(f))}}).catch(function(f){h.state!==$t&&h.state!==ni&&(h.warn(f),h.resetFragmentLoading(i))})},s.flushMainBuffer=function(i,a,u){if(u===void 0&&(u=null),i-a){var h={startOffset:i,endOffset:a,type:u};this.fragLoadError=0,this.hls.trigger(p.Events.BUFFER_FLUSHING,h)}},s._loadInitSegment=function(i,a){var u=this;this._doFragLoad(i,a).then(function(h){if(!h||u.fragContextChanged(i)||!u.levels)throw new Error("init load aborted");return h}).then(function(h){var f=u.hls,m=h.payload,y=i.decryptdata;if(m&&m.byteLength>0&&y&&y.key&&y.iv&&y.method==="AES-128"){var S=self.performance.now();return u.decrypter.decrypt(new Uint8Array(m),y.key.buffer,y.iv.buffer).then(function(k){var F=self.performance.now();return f.trigger(p.Events.FRAG_DECRYPTED,{frag:i,payload:k,stats:{tstart:S,tdecrypt:F}}),h.payload=k,h})}return h}).then(function(h){var f=u.fragCurrent,m=u.hls,y=u.levels;if(!y)throw new Error("init load aborted, missing levels");y[i.level].details;var S=i.stats;u.state=nt,u.fragLoadError=0,i.data=new Uint8Array(h.payload),S.parsing.start=S.buffering.start=self.performance.now(),S.parsing.end=S.buffering.end=self.performance.now(),h.frag===f&&m.trigger(p.Events.FRAG_BUFFERED,{stats:S,frag:f,part:null,id:i.type}),u.tick()}).catch(function(h){u.state!==$t&&u.state!==ni&&(u.warn(h),u.resetFragmentLoading(i))})},s.fragContextChanged=function(i){var a=this.fragCurrent;return!i||!a||i.level!==a.level||i.sn!==a.sn||i.urlId!==a.urlId},s.fragBufferedComplete=function(i,a){var u,h,f=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+i.type+" sn: "+i.sn+(a?" part: "+a.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+i.level+" "+(f?xs(St.getBuffered(f)):"(detached)")),this.state=nt,f&&(!this.loadedmetadata&&i.type==oe.PlaylistLevelType.MAIN&&f.buffered.length&&((u=this.fragCurrent)===null||u===void 0?void 0:u.sn)===((h=this.fragPrevious)===null||h===void 0?void 0:h.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},s.seekToStartPos=function(){},s._handleFragmentLoadComplete=function(i){var a=this.transmuxer;if(a){var u=i.frag,h=i.part,f=i.partsLoaded,m=!f||f.length===0||f.some(function(S){return!S}),y=new ur(u.level,u.sn,u.stats.chunkCount+1,0,h?h.index:-1,!m);a.flush(y)}},s._handleFragmentLoadProgress=function(i){},s._doFragLoad=function(i,a,u,h){var f,m=this;if(u===void 0&&(u=null),!this.levels)throw new Error("frag load aborted, missing levels");var y=null;if(!i.encrypted||(f=i.decryptdata)!==null&&f!==void 0&&f.key?!i.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(i,a.encryptedFragments):(this.log("Loading key for "+i.sn+" of ["+a.startSN+"-"+a.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+i.level),this.state=gn,this.fragCurrent=i,y=this.keyLoader.load(i).then(function(K){if(!m.fragContextChanged(K.frag))return m.hls.trigger(p.Events.KEY_LOADED,K),K}),this.hls.trigger(p.Events.KEY_LOADING,{frag:i}),this.throwIfFragContextChanged("KEY_LOADING")),u=Math.max(i.start,u||0),this.config.lowLatencyMode&&a){var S=a.partList;if(S&&h){u>i.end&&a.fragmentHint&&(i=a.fragmentHint);var k=this.getNextPart(S,i,u);if(k>-1){var F=S[k];return this.log("Loading part sn: "+i.sn+" p: "+F.index+" cc: "+i.cc+" of playlist ["+a.startSN+"-"+a.endSN+"] parts [0-"+k+"-"+(S.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+i.level+", target: "+parseFloat(u.toFixed(3))),this.nextLoadPosition=F.start+F.duration,this.state=Ti,this.hls.trigger(p.Events.FRAG_LOADING,{frag:i,part:S[k],targetBufferTime:u}),this.throwIfFragContextChanged("FRAG_LOADING parts"),y?y.then(function(K){return!K||m.fragContextChanged(K.frag)?null:m.doFragPartsLoad(i,S,k,h)}).catch(function(K){return m.handleFragLoadError(K)}):this.doFragPartsLoad(i,S,k,h).catch(function(K){return m.handleFragLoadError(K)})}if(!i.url||this.loadedEndOfParts(S,u))return Promise.resolve(null)}}this.log("Loading fragment "+i.sn+" cc: "+i.cc+" "+(a?"of ["+a.startSN+"-"+a.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+i.level+", target: "+parseFloat(u.toFixed(3))),(0,N.isFiniteNumber)(i.sn)&&!this.bitrateTest&&(this.nextLoadPosition=i.start+i.duration),this.state=Ti,this.hls.trigger(p.Events.FRAG_LOADING,{frag:i,targetBufferTime:u}),this.throwIfFragContextChanged("FRAG_LOADING");var P=this.config.progressive;return P&&y?y.then(function(K){return!K||m.fragContextChanged(K==null?void 0:K.frag)?null:m.fragmentLoader.load(i,h)}).catch(function(K){return m.handleFragLoadError(K)}):Promise.all([this.fragmentLoader.load(i,P?h:void 0),y]).then(function(K){var Z=K[0];return!P&&Z&&h&&h(Z),Z}).catch(function(K){return m.handleFragLoadError(K)})},s.throwIfFragContextChanged=function(i){if(this.fragCurrent===null)throw new Error("frag load aborted, context changed in "+i)},s.doFragPartsLoad=function(i,a,u,h){var f=this;return new Promise(function(m,y){var S=[];(function k(F){var P=a[F];f.fragmentLoader.loadPart(i,P,h).then(function(K){S[P.index]=K;var Z=K.part;f.hls.trigger(p.Events.FRAG_LOADED,K);var le=a[F+1];if(!le||le.fragment!==i)return m({frag:i,part:Z,partsLoaded:S});k(F+1)}).catch(y)})(u)})},s.handleFragLoadError=function(i){if("data"in i){var a=i.data;i.data&&a.details===I.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(a.frag,a.part):this.hls.trigger(p.Events.ERROR,a)}else this.hls.trigger(p.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.INTERNAL_EXCEPTION,err:i,fatal:!0});return null},s._handleTransmuxerFlush=function(i){var a=this.getCurrentContext(i);if(a&&this.state===Qt){var u=a.frag,h=a.part,f=a.level,m=self.performance.now();u.stats.parsing.end=m,h&&(h.stats.parsing.end=m),this.updateLevelTiming(u,h,f,i.partial)}else this.fragCurrent||this.state===$t||this.state===ni||(this.state=nt)},s.getCurrentContext=function(i){var a=this.levels,u=i.level,h=i.sn,f=i.part;if(!a||!a[u])return this.warn("Levels object was unset while buffering fragment "+h+" of level "+u+". The current chunk will not be buffered."),null;var m=a[u],y=f>-1?function(k,F,P){if(!k||!k.details)return null;var K=k.details.partList;if(K)for(var Z=K.length;Z--;){var le=K[Z];if(le.index===P&&le.fragment.sn===F)return le}return null}(m,h,f):null,S=y?y.fragment:function(k,F,P){if(!k||!k.details)return null;var K=k.details,Z=K.fragments[F-K.startSN];return Z||((Z=K.fragmentHint)&&Z.sn===F?Z:F<K.startSN&&P&&P.sn===F?P:null)}(m,h,this.fragCurrent);return S?{frag:S,part:y,level:m}:null},s.bufferFragmentData=function(i,a,u,h){if(i&&this.state===Qt){var f=i.data1,m=i.data2,y=f;if(f&&m&&(y=(0,me.appendUint8Array)(f,m)),y&&y.length){var S={type:i.type,frag:a,part:u,chunkMeta:h,parent:a.type,data:y};this.hls.trigger(p.Events.BUFFER_APPENDING,S),i.dropped&&i.independent&&!u&&this.flushBufferGap(a)}}},s.flushBufferGap=function(i){var a=this.media;if(a)if(St.isBuffered(a,a.currentTime)){var u=a.currentTime,h=St.bufferInfo(a,u,0),f=i.duration,m=Math.min(2*this.config.maxFragLookUpTolerance,.25*f),y=Math.max(Math.min(i.start-m,h.end-m),u+m);i.start-y>m&&this.flushMainBuffer(y,i.start)}else this.flushMainBuffer(0,i.start)},s.getFwdBufferInfo=function(i,a){var u=this.config,h=this.getLoadPosition();if(!(0,N.isFiniteNumber)(h))return null;var f=St.bufferInfo(i,h,u.maxBufferHole);if(f.len===0&&f.nextStart!==void 0){var m=this.fragmentTracker.getBufferedFrag(h,a);if(m&&f.nextStart<m.end)return St.bufferInfo(i,h,Math.max(f.nextStart,u.maxBufferHole))}return f},s.getMaxBufferLength=function(i){var a,u=this.config;return a=i?Math.max(8*u.maxBufferSize/i,u.maxBufferLength):u.maxBufferLength,Math.min(a,u.maxMaxBufferLength)},s.reduceMaxBufferLength=function(i){var a=this.config,u=i||a.maxBufferLength;return a.maxMaxBufferLength>=u&&(a.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+a.maxMaxBufferLength+"s"),!0)},s.getNextFragment=function(i,a){var u=a.fragments,h=u.length;if(!h)return null;var f,m=this.config,y=u[0].start;if(a.live){var S=m.initialLiveManifestSize;if(h<S)return this.warn("Not enough fragments to start playback (have: "+h+", need: "+S+")"),null;a.PTSKnown||this.startFragRequested||this.startPosition!==-1||(f=this.getInitialLiveFragment(a,u),this.startPosition=f?this.hls.liveSyncPosition||f.start:i)}else i<=y&&(f=u[0]);if(!f){var k=m.lowLatencyMode?a.partEnd:a.fragmentEnd;f=this.getFragmentAtPosition(i,k,a)}return this.mapToInitFragWhenRequired(f)},s.mapToInitFragWhenRequired=function(i){return i==null||!i.initSegment||i!=null&&i.initSegment.data||this.bitrateTest?i:i.initSegment},s.getNextPart=function(i,a,u){for(var h=-1,f=!1,m=!0,y=0,S=i.length;y<S;y++){var k=i[y];if(m=m&&!k.independent,h>-1&&u<k.start)break;var F=k.loaded;F?h=-1:(f||k.independent||m)&&k.fragment===a&&(h=y),f=F}return h},s.loadedEndOfParts=function(i,a){var u=i[i.length-1];return u&&a>u.start&&u.loaded},s.getInitialLiveFragment=function(i,a){var u=this.fragPrevious,h=null;if(u){if(i.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+u.programDateTime),h=function(S,k,F){if(k===null||!Array.isArray(S)||!S.length||!(0,N.isFiniteNumber)(k)||k<(S[0].programDateTime||0)||k>=(S[S.length-1].endProgramDateTime||0))return null;F=F||0;for(var P=0;P<S.length;++P){var K=S[P];if(Ps(k,F,K))return K}return null}(a,u.endProgramDateTime,this.config.maxFragLookUpTolerance)),!h){var f=u.sn+1;if(f>=i.startSN&&f<=i.endSN){var m=a[f-i.startSN];u.cc===m.cc&&(h=m,this.log("Live playlist, switching playlist, load frag with next SN: "+h.sn))}h||(h=function(S,k){return fn(S,function(F){return F.cc<k?1:F.cc>k?-1:0})}(a,u.cc),h&&this.log("Live playlist, switching playlist, load frag with same CC: "+h.sn))}}else{var y=this.hls.liveSyncPosition;y!==null&&(h=this.getFragmentAtPosition(y,this.bitrateTest?i.fragmentEnd:i.edge,i))}return h},s.getFragmentAtPosition=function(i,a,u){var h,f=this.config,m=this.fragPrevious,y=u.fragments,S=u.endSN,k=u.fragmentHint,F=f.maxFragLookUpTolerance,P=!!(f.lowLatencyMode&&u.partList&&k);if(P&&k&&!this.bitrateTest&&(y=y.concat(k),S=k.sn),h=i<a?hr(m,y,i,i>a-F?0:F):y[y.length-1]){var K=h.sn-u.startSN;if(this.fragmentTracker.getState(h)===De.OK&&(m=h),m&&h.sn===m.sn&&!P&&m&&h.level===m.level){var Z=y[K+1];h.sn<S&&this.fragmentTracker.getState(Z)!==De.OK?(this.log("SN "+h.sn+" just loaded, load next one: "+Z.sn),h=Z):h=null}}return h},s.synchronizeToLiveEdge=function(i){var a=this.config,u=this.media;if(u){var h=this.hls.liveSyncPosition,f=u.currentTime,m=i.fragments[0].start,y=i.edge,S=f>=m-a.maxFragLookUpTolerance&&f<=y;if(h!==null&&u.duration>h&&(f<h||!S)){var k=a.liveMaxLatencyDuration!==void 0?a.liveMaxLatencyDuration:a.liveMaxLatencyDurationCount*i.targetduration;(!S&&u.readyState<4||f<y-k)&&(this.loadedmetadata||(this.nextLoadPosition=h),u.readyState&&(this.warn("Playback: "+f.toFixed(3)+" is located too far from the end of live sliding playlist: "+y+", reset currentTime to : "+h.toFixed(3)),u.currentTime=h))}}},s.alignPlaylists=function(i,a){var u=this.levels,h=this.levelLastLoaded,f=this.fragPrevious,m=h!==null?u[h]:null,y=i.fragments.length;if(!y)return this.warn("No fragments in live playlist"),0;var S=i.fragments[0].start,k=!a,F=i.alignedSliding&&(0,N.isFiniteNumber)(S);if(k||!F&&!S){(function(K,Z,le){Z&&(function(ne,he,Re){if(function(ue,Ie,Ae){return!(!Ie.details||!(Ae.endCC>Ae.startCC||ue&&ue.cc<Ae.startCC))}(ne,Re,he)){var Ge=function(ue,Ie,Ae){var Xe=ue.fragments,vt=Ie.fragments;if(vt.length&&Xe.length){var Je=cn(Xe,vt[0].cc);if(Je&&(!Je||Je.startPTS))return Je;_.logger.log("No frag in previous level to align on")}else _.logger.log("No fragments to align")}(Re.details,he);Ge&&(0,N.isFiniteNumber)(Ge.start)&&(_.logger.log("Adjusting PTS using last level due to CC increase within current level "+he.url),cr(Ge.start,he))}}(K,le,Z),!le.alignedSliding&&Z.details&&function(ne,he){if(he.fragments.length&&ne.hasProgramDateTime&&he.hasProgramDateTime){var Re=he.fragments[0].programDateTime,Ge=ne.fragments[0].programDateTime,ue=(Ge-Re)/1e3+he.fragments[0].start;ue&&(0,N.isFiniteNumber)(ue)&&(_.logger.log("Adjusting PTS using programDateTime delta "+(Ge-Re)+"ms, sliding:"+ue.toFixed(3)+" "+ne.url+" "),cr(ue,ne))}}(le,Z.details),le.alignedSliding||!Z.details||le.skippedSegments||Y(Z.details,le))})(f,m,i);var P=i.fragments[0].start;return this.log("Live playlist sliding: "+P.toFixed(2)+" start-sn: "+(a?a.startSN:"na")+"->"+i.startSN+" prev-sn: "+(f?f.sn:"na")+" fragments: "+y),P}return S},s.waitForCdnTuneIn=function(i){return i.live&&i.canBlockReload&&i.partTarget&&i.tuneInGoal>Math.max(i.partHoldBack,3*i.partTarget)},s.setStartPosition=function(i,a){var u=this.startPosition;if(u<a&&(u=-1),u===-1||this.lastCurrentTime===-1){var h=i.startTimeOffset;(0,N.isFiniteNumber)(h)?(u=a+h,h<0&&(u+=i.totalduration),u=Math.min(Math.max(a,u),a+i.totalduration),this.log("Start time offset "+h+" found in playlist, adjust startPosition to "+u),this.startPosition=u):i.live?u=this.hls.liveSyncPosition||a:this.startPosition=u=0,this.lastCurrentTime=u}this.nextLoadPosition=u},s.getLoadPosition=function(){var i=this.media,a=0;return this.loadedmetadata&&i?a=i.currentTime:this.nextLoadPosition&&(a=this.nextLoadPosition),a},s.handleFragLoadAborted=function(i,a){this.transmuxer&&i.sn!=="initSegment"&&i.stats.aborted&&(this.warn("Fragment "+i.sn+(a?" part"+a.index:"")+" of level "+i.level+" was aborted"),this.resetFragmentLoading(i))},s.resetFragmentLoading=function(i){this.fragCurrent&&(this.fragContextChanged(i)||this.state===Si)||(this.state=nt)},s.onFragmentOrKeyLoadError=function(i,a){if(a.fatal)return this.stopLoad(),void(this.state=ni);var u=this.config;if(a.chunkMeta){var h=this.getCurrentContext(a.chunkMeta);h&&(a.frag=h.frag,a.levelRetry=!0,this.fragLoadError=u.fragLoadingMaxRetry)}var f=a.frag;if(f&&f.type===i)if(this.fragCurrent,this.fragLoadError+1<=u.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var m=Math.min(Math.pow(2,this.fragLoadError)*u.fragLoadingRetryDelay,u.fragLoadingMaxRetryTimeout);this.warn("Fragment "+f.sn+" of "+i+" "+f.level+" failed to load, retrying in "+m+"ms"),this.retryDate=self.performance.now()+m,this.fragLoadError++,this.state=Si}else a.levelRetry?(i===oe.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=nt):(_.logger.error(a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.hls.stopLoad(),this.state=ni)},s.afterBufferFlushed=function(i,a,u){if(i){var h=St.getBuffered(i);this.fragmentTracker.detectEvictedFragments(a,h,u),this.state===_i&&this.resetLoadingState()}},s.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=nt},s.resetStartWhenNotLoaded=function(i){if(!this.loadedmetadata){this.startFragRequested=!1;var a=this.levels?this.levels[i].details:null;a!=null&&a.live?(this.startPosition=-1,this.setStartPosition(a,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},s.updateLevelTiming=function(i,a,u,h){var f=this,m=u.details;Object.keys(i.elementaryStreams).reduce(function(y,S){var k=i.elementaryStreams[S];if(k){var F=k.endPTS-k.startPTS;if(F<=0)return f.warn("Could not parse fragment "+i.sn+" "+S+" duration reliably ("+F+")"),y||!1;var P=h?0:V(m,i,k.startPTS,k.endPTS,k.startDTS,k.endDTS);return f.hls.trigger(p.Events.LEVEL_PTS_UPDATED,{details:m,level:u,drift:P,type:S,frag:i,start:k.startPTS,end:k.endPTS}),!0}return y},!1)||(this.warn("Found no media in fragment "+i.sn+" of level "+u.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=Ci,this.hls.trigger(p.Events.FRAG_PARSED,{frag:i,part:a})},s.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},r=t,(n=[{key:"state",get:function(){return this._state},set:function(i){var a=this._state;a!==i&&(this._state=i,this.log(a+"->"+i))}}])&&Fs(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),t}(gi);function pr(){return self.MediaSource||self.WebKitMediaSource}function pn(){return self.SourceBuffer||self.WebKitSourceBuffer}var mr=function(){var d=ENTRY_MODULE,l={},e=function r(n){var s=l[n];if(s!==void 0)return s.exports;var i=l[n]={exports:{}};return d[n].call(i.exports,i,i.exports,r),i.exports};e.m=d,e.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(n,{a:n}),n},e.d=function(r,n){for(var s in n)e.o(n,s)&&!e.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:n[s]})},e.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},e.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})};var t=e(ENTRY_MODULE);return t.default||t}.toString().split("ENTRY_MODULE"),mn="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function vn(d){return(d+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function Ms(d,l,e){var t={};t[e]=[];var r=l.toString().replace(/^"[^"]+"/,"function"),n=r.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||r.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!n)return t;for(var s,i=n[1],a=new RegExp("(\\\\n|\\W)"+vn(i)+mn,"g");s=a.exec(r);)s[3]!=="dll-reference"&&t[e].push(s[3]);for(a=new RegExp("\\("+vn(i)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+mn,"g");s=a.exec(r);)d[s[2]]||(t[e].push(s[1]),d[s[2]]=R(s[1]).m),t[s[2]]=t[s[2]]||[],t[s[2]].push(s[4]);for(var u,h=Object.keys(t),f=0;f<h.length;f++)for(var m=0;m<t[h[f]].length;m++)u=t[h[f]][m],isNaN(1*u)||(t[h[f]][m]=1*t[h[f]][m]);return t}function Ns(d){return Object.keys(d).reduce(function(l,e){return l||d[e].length>0},!1)}function yn(d,l,e,t){var r=d[t].map(function(n){return'"'+n+'": '+l[t][n].toString().replace(/^"[^"]+"/,"function")}).join(",");return mr[0]+"{"+r+"}"+mr[1]+'"'+e+'"'+mr[2]}var pi=R(544),vr=R(729),Us=R.n(vr),yr=pr()||{isTypeSupported:function(){return!1}},En=function(){function d(e,t,r,n){var s=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=n;var a=function(m,y){(y=y||{}).frag=s.frag,y.id=s.id,s.hls.trigger(m,y)};this.observer=new vr.EventEmitter,this.observer.on(p.Events.FRAG_DECRYPTED,a),this.observer.on(p.Events.ERROR,a);var u={mp4:yr.isTypeSupported("video/mp4"),mpeg:yr.isTypeSupported("audio/mpeg"),mp3:yr.isTypeSupported('audio/mp4; codecs="mp3"')},h=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){var f;_.logger.log("demuxing in webworker");try{f=this.worker=function(m,y){y=y||{};var S={main:R.m},k=y.all?{main:Object.keys(S.main)}:function(le,ne){for(var he={main:[ne]},Re={main:[]},Ge={main:{}};Ns(he);)for(var ue=Object.keys(he),Ie=0;Ie<ue.length;Ie++){var Ae=ue[Ie],Xe=he[Ae].pop();if(Ge[Ae]=Ge[Ae]||{},!Ge[Ae][Xe]&&le[Ae][Xe]){Ge[Ae][Xe]=!0,Re[Ae]=Re[Ae]||[],Re[Ae].push(Xe);for(var vt=Ms(le,le[Ae][Xe],Ae),Je=Object.keys(vt),tt=0;tt<Je.length;tt++)he[Je[tt]]=he[Je[tt]]||[],he[Je[tt]]=he[Je[tt]].concat(vt[Je[tt]])}}return Re}(S,m),F="";Object.keys(k).filter(function(le){return le!=="main"}).forEach(function(le){for(var ne=0;k[le][ne];)ne++;k[le].push(ne),S[le][ne]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",F=F+"var "+le+" = ("+yn(k,S,ne,modules)+`)();
`}),F=F+"new (("+yn(k,S,m,"main")+")())(self);";var P=new window.Blob([F],{type:"text/javascript"}),K=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(P),Z=new window.Worker(K);return Z.objectURL=K,Z}(182),this.onwmsg=this.onWorkerMessage.bind(this),f.addEventListener("message",this.onwmsg),f.onerror=function(m){s.useWorker=!1,_.logger.warn("Exception in webworker, fallback to inline"),s.hls.trigger(p.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(m.message+"  ("+m.filename+":"+m.lineno+")")})},f.postMessage({cmd:"init",typeSupported:u,vendor:h,id:t,config:JSON.stringify(i)})}catch(m){_.logger.warn("Error in worker:",m),_.logger.error("Error while initializing DemuxerWorker, fallback to inline"),f&&self.URL.revokeObjectURL(f.objectURL),this.transmuxer=new pi.default(this.observer,u,i,h,t),this.worker=null}}else this.transmuxer=new pi.default(this.observer,u,i,h,t)}var l=d.prototype;return l.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null,this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var r=this.observer;r&&r.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},l.push=function(e,t,r,n,s,i,a,u,h,f){var m,y,S=this;h.transmuxing.start=self.performance.now();var k=this.transmuxer,F=this.worker,P=i?i.start:s.start,K=s.decryptdata,Z=this.frag,le=!(Z&&s.cc===Z.cc),ne=!(Z&&h.level===Z.level),he=Z?h.sn-Z.sn:-1,Re=this.part?h.part-this.part.index:-1,Ge=he===0&&h.id>1&&h.id===(Z==null?void 0:Z.stats.chunkCount),ue=!ne&&(he===1||he===0&&(Re===1||Ge&&Re<=0)),Ie=self.performance.now();(ne||he||s.stats.parsing.start===0)&&(s.stats.parsing.start=Ie),!i||!Re&&ue||(i.stats.parsing.start=Ie);var Ae=!(Z&&((m=s.initSegment)===null||m===void 0?void 0:m.url)===((y=Z.initSegment)===null||y===void 0?void 0:y.url)),Xe=new pi.TransmuxState(le,ue,u,ne,P,Ae);if(!ue||le||Ae){_.logger.log("[transmuxer-interface, "+s.type+"]: Starting new transmux session for sn: "+h.sn+" p: "+h.part+" level: "+h.level+" id: "+h.id+`
        discontinuity: `+le+`
        trackSwitch: `+ne+`
        contiguous: `+ue+`
        accurateTimeOffset: `+u+`
        timeOffset: `+P+`
        initSegmentChange: `+Ae);var vt=new pi.TransmuxConfig(r,n,t,a,f);this.configureTransmuxer(vt)}if(this.frag=s,this.part=i,F)F.postMessage({cmd:"demux",data:e,decryptdata:K,chunkMeta:h,state:Xe},e instanceof ArrayBuffer?[e]:[]);else if(k){var Je=k.push(e,K,h,Xe);(0,pi.isPromise)(Je)?(k.async=!0,Je.then(function(tt){S.handleTransmuxComplete(tt)}).catch(function(tt){S.transmuxerError(tt,h,"transmuxer-interface push error")})):(k.async=!1,this.handleTransmuxComplete(Je))}},l.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:e});else if(r){var s=r.flush(e);(0,pi.isPromise)(s)||r.async?((0,pi.isPromise)(s)||(s=Promise.resolve(s)),s.then(function(i){t.handleFlushResult(i,e)}).catch(function(i){t.transmuxerError(i,e,"transmuxer-interface flush error")})):this.handleFlushResult(s,e)}},l.transmuxerError=function(e,t,r){this.hls&&this.hls.trigger(p.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r})},l.handleFlushResult=function(e,t){var r=this;e.forEach(function(n){r.handleTransmuxComplete(n)}),this.onFlush(t)},l.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":_.logger[t.data.logType]&&_.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},l.configureTransmuxer=function(e){var t=this.worker,r=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):r&&r.configure(e)},l.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},d}(),Bs=function(){function d(e,t,r,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=n}var l=d.prototype;return l.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},l.poll=function(e,t){var r=this.config,n=this.media,s=this.stalled;if(n!==null){var i=n.currentTime,a=n.seeking,u=this.seeking&&!a,h=!this.seeking&&a;if(this.seeking=a,i===e){if((h||u)&&(this.stalled=null),!(n.paused&&!a||n.ended||n.playbackRate===0)&&St.getBuffered(n).length){var f=St.bufferInfo(n,i,0),m=f.len>0,y=f.nextStart||0;if(m||y){if(a){var S=f.len>2,k=!y||t&&t.start<=i||y-i>2&&!this.fragmentTracker.getPartialFragment(i);if(S||k)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var F,P=Math.max(y,f.start||0)-i,K=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,Z=!(K==null||(F=K.details)===null||F===void 0)&&F.live?2*K.details.targetduration:2;if(P>0&&P<=Z)return void this._trySkipBufferHole(null)}var le=self.performance.now();if(s!==null){var ne=le-s;if(a||!(ne>=250)||(this._reportStall(f),this.media)){var he=St.bufferInfo(n,i,r.maxBufferHole);this._tryFixBufferStall(he,ne)}}else this.stalled=le}}}else if(this.moved=!0,s!==null){if(this.stallReported){var Re=self.performance.now()-s;_.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(Re)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},l._tryFixBufferStall=function(e,t){var r=this.config,n=this.fragmentTracker,s=this.media;if(s!==null){var i=s.currentTime,a=n.getPartialFragment(i);if(a&&(this._trySkipBufferHole(a)||!this.media))return;e.len>r.maxBufferHole&&t>1e3*r.highBufferWatchdogPeriod&&(_.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},l._reportStall=function(e){var t=this.hls,r=this.media;!this.stallReported&&r&&(this.stallReported=!0,_.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(e)+")"),t.trigger(p.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e.len}))},l._trySkipBufferHole=function(e){var t=this.config,r=this.hls,n=this.media;if(n===null)return 0;for(var s=n.currentTime,i=0,a=St.getBuffered(n),u=0;u<a.length;u++){var h=a.start(u);if(s+t.maxBufferHole>=i&&s<h){var f=Math.max(h+.05,n.currentTime+.1);return _.logger.warn("skipping hole, adjusting currentTime from "+s+" to "+f),this.moved=!0,this.stalled=null,n.currentTime=f,e&&r.trigger(p.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+f,frag:e}),f}i=a.end(u)}return 0},l._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,n=this.nudgeRetry;if(r!==null){var s=r.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){var i=s+(n+1)*e.nudgeOffset;_.logger.warn("Nudging 'currentTime' from "+s+" to "+i),r.currentTime=i,t.trigger(p.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else _.logger.error("Playhead still not moving while enough data buffered @"+s+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(p.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},d}();function Ks(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}function Er(d,l){return Er=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Er(d,l)}var Gs=function(d){var l,e;function t(i,a,u){var h;return(h=d.call(this,i,a,u,"[stream-controller]")||this).audioCodecSwap=!1,h.gapController=null,h.level=-1,h._forceStartLoad=!1,h.altAudio=!1,h.audioOnly=!1,h.fragPlaying=null,h.onvplaying=null,h.onvseeked=null,h.fragLastKbps=0,h.couldBacktrack=!1,h.backtrackFragment=null,h.audioCodecSwitch=!1,h.videoBuffer=null,h._registerListeners(),h}e=d,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Er(l,e);var r,n,s=t.prototype;return s._registerListeners=function(){var i=this.hls;i.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(p.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(p.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),i.on(p.Events.ERROR,this.onError,this),i.on(p.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.on(p.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(p.Events.BUFFER_CREATED,this.onBufferCreated,this),i.on(p.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),i.on(p.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),i.on(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s._unregisterListeners=function(){var i=this.hls;i.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(p.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),i.off(p.Events.ERROR,this.onError,this),i.off(p.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.off(p.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(p.Events.BUFFER_CREATED,this.onBufferCreated,this),i.off(p.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),i.off(p.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),i.off(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},s.startLoad=function(i){if(this.levels){var a=this.lastCurrentTime,u=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var h=u.startLevel;h===-1&&(u.config.testBandwidth&&this.levels.length>1?(h=0,this.bitrateTest=!0):h=u.nextAutoLevel),this.level=u.nextLoadLevel=h,this.loadedmetadata=!1}a>0&&i===-1&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),i=a),this.state=nt,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=i,this.tick()}else this._forceStartLoad=!0,this.state=$t},s.stopLoad=function(){this._forceStartLoad=!1,d.prototype.stopLoad.call(this)},s.doTick=function(){switch(this.state){case nt:this.doTickIdle();break;case ki:var i,a=this.levels,u=this.level,h=a==null||(i=a[u])===null||i===void 0?void 0:i.details;if(h&&(!h.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(h))break;this.state=nt;break}break;case Si:var f,m=self.performance.now(),y=this.retryDate;(!y||m>=y||(f=this.media)!==null&&f!==void 0&&f.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=nt)}this.onTickEnd()},s.onTickEnd=function(){d.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},s.doTickIdle=function(){var i=this.hls,a=this.levelLastLoaded,u=this.levels,h=this.media,f=i.config,m=i.nextLoadLevel;if(a!==null&&(h||!this.startFragRequested&&f.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&u&&u[m]){var y=u[m],S=this.getMainFwdBufferInfo();if(S!==null){var k=this.getLevelDetails();if(k&&this._streamEnded(S,k)){var F={};return this.altAudio&&(F.type="video"),this.hls.trigger(p.Events.BUFFER_EOS,F),void(this.state=_i)}this.level=i.nextLoadLevel=m;var P=y.details;if(!P||this.state===ki||P.live&&this.levelLastLoaded!==m)return this.level=m,void(this.state=ki);if(!(S.len>=this.getMaxBufferLength(y.maxBitrate))){this.backtrackFragment&&this.backtrackFragment.start>S.end&&(this.backtrackFragment=null);var K=this.backtrackFragment?this.backtrackFragment.start:S.end,Z=this.getNextFragment(K,P);if(this.couldBacktrack&&!this.fragPrevious&&Z&&Z.sn!=="initSegment"&&this.fragmentTracker.getState(Z)!==De.OK){var le,ne=((le=this.backtrackFragment)!=null?le:Z).sn-P.startSN,he=P.fragments[ne-1];he&&Z.cc===he.cc&&(Z=he,this.fragmentTracker.removeFragment(he))}else this.backtrackFragment&&S.len&&(this.backtrackFragment=null);if(Z&&this.fragmentTracker.getState(Z)===De.OK&&this.nextLoadPosition>K){var Re=this.audioOnly&&!this.altAudio?X.ElementaryStreamTypes.AUDIO:X.ElementaryStreamTypes.VIDEO,Ge=(Re===X.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;Ge&&this.afterBufferFlushed(Ge,Re,oe.PlaylistLevelType.MAIN),Z=this.getNextFragment(this.nextLoadPosition,P)}Z&&(!Z.initSegment||Z.initSegment.data||this.bitrateTest||(Z=Z.initSegment),this.loadFragment(Z,P,K))}}}},s.loadFragment=function(i,a,u){var h,f=this.fragmentTracker.getState(i);this.fragCurrent=i,f===De.NOT_LOADED?i.sn==="initSegment"?this._loadInitSegment(i,a):this.bitrateTest?(this.log("Fragment "+i.sn+" of level "+i.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(i,a)):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,i,a,u)):f===De.APPENDING?this.reduceMaxBufferLength(i.duration)&&this.fragmentTracker.removeFragment(i):((h=this.media)===null||h===void 0?void 0:h.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},s.getAppendedFrag=function(i){var a=this.fragmentTracker.getAppendedFrag(i,oe.PlaylistLevelType.MAIN);return a&&"fragment"in a?a.fragment:a},s.getBufferedFrag=function(i){return this.fragmentTracker.getBufferedFrag(i,oe.PlaylistLevelType.MAIN)},s.followingBufferedFrag=function(i){return i?this.getBufferedFrag(i.end+.5):null},s.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},s.nextLevelSwitch=function(){var i=this.levels,a=this.media;if(a!=null&&a.readyState){var u,h=this.getAppendedFrag(a.currentTime);if(h&&h.start>1&&this.flushMainBuffer(0,h.start-1),!a.paused&&i){var f=i[this.hls.nextLoadLevel],m=this.fragLastKbps;u=m&&this.fragCurrent?this.fragCurrent.duration*f.maxBitrate/(1e3*m)+1:0}else u=0;var y=this.getBufferedFrag(a.currentTime+u);if(y){var S=this.followingBufferedFrag(y);if(S){this.abortCurrentFrag();var k=S.maxStartPTS?S.maxStartPTS:S.start,F=S.duration,P=Math.max(y.end,k+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,.5*F),.75*F));this.flushMainBuffer(P,Number.POSITIVE_INFINITY)}}}},s.abortCurrentFrag=function(){var i=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,i&&i.abortRequests(),this.state){case gn:case Ti:case Si:case Qt:case Ci:this.state=nt}this.nextLoadPosition=this.getLoadPosition()},s.flushMainBuffer=function(i,a){d.prototype.flushMainBuffer.call(this,i,a,this.altAudio?"video":null)},s.onMediaAttached=function(i,a){d.prototype.onMediaAttached.call(this,i,a);var u=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),u.addEventListener("playing",this.onvplaying),u.addEventListener("seeked",this.onvseeked),this.gapController=new Bs(this.config,u,this.fragmentTracker,this.hls)},s.onMediaDetaching=function(){var i=this.media;i&&this.onvplaying&&this.onvseeked&&(i.removeEventListener("playing",this.onvplaying),i.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),d.prototype.onMediaDetaching.call(this)},s.onMediaPlaying=function(){this.tick()},s.onMediaSeeked=function(){var i=this.media,a=i?i.currentTime:null;(0,N.isFiniteNumber)(a)&&this.log("Media seeked to "+a.toFixed(3)),this.tick()},s.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(p.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},s.onManifestParsed=function(i,a){var u,h,f,m=!1,y=!1;a.levels.forEach(function(S){(u=S.audioCodec)&&(u.indexOf("mp4a.40.2")!==-1&&(m=!0),u.indexOf("mp4a.40.5")!==-1&&(y=!0))}),this.audioCodecSwitch=m&&y&&typeof((f=pn())==null||(h=f.prototype)===null||h===void 0?void 0:h.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},s.onLevelLoading=function(i,a){var u=this.levels;if(u&&this.state===nt){var h=u[a.level];(!h.details||h.details.live&&this.levelLastLoaded!==a.level||this.waitForCdnTuneIn(h.details))&&(this.state=ki)}},s.onLevelLoaded=function(i,a){var u,h=this.levels,f=a.level,m=a.details,y=m.totalduration;if(h){this.log("Level "+f+" loaded ["+m.startSN+","+m.endSN+"], cc ["+m.startCC+", "+m.endCC+"] duration:"+y);var S=this.fragCurrent;!S||this.state!==Ti&&this.state!==Si||S.level!==a.level&&S.loader&&(this.state=nt,this.backtrackFragment=null,S.abortRequests());var k=h[f],F=0;if(m.live||(u=k.details)!==null&&u!==void 0&&u.live){if(m.fragments[0]||(m.deltaUpdateFailed=!0),m.deltaUpdateFailed)return;F=this.alignPlaylists(m,k.details)}if(k.details=m,this.levelLastLoaded=f,this.hls.trigger(p.Events.LEVEL_UPDATED,{details:m,level:f}),this.state===ki){if(this.waitForCdnTuneIn(m))return;this.state=nt}this.startFragRequested?m.live&&this.synchronizeToLiveEdge(m):this.setStartPosition(m,F),this.tick()}else this.warn("Levels were reset while loading level "+f)},s._handleFragmentLoadProgress=function(i){var a,u=i.frag,h=i.part,f=i.payload,m=this.levels;if(m){var y=m[u.level],S=y.details;if(S){var k=y.videoCodec,F=S.PTSKnown||!S.live,P=(a=u.initSegment)===null||a===void 0?void 0:a.data,K=this._getAudioCodec(y),Z=this.transmuxer=this.transmuxer||new En(this.hls,oe.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),le=h?h.index:-1,ne=le!==-1,he=new ur(u.level,u.sn,u.stats.chunkCount,f.byteLength,le,ne),Re=this.initPTS[u.cc];Z.push(f,P,K,k,u,h,S.totalduration,F,he,Re)}else this.warn("Dropping fragment "+u.sn+" of level "+u.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+u.sn+" of level "+u.level+" will not be buffered")},s.onAudioTrackSwitching=function(i,a){var u=this.altAudio,h=!!a.url,f=a.id;if(!h){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var m=this.fragCurrent;m&&(this.log("Switching to main audio track, cancel main fragment load"),m.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var y=this.hls;u&&y.trigger(p.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),y.trigger(p.Events.AUDIO_TRACK_SWITCHED,{id:f})}},s.onAudioTrackSwitched=function(i,a){var u=a.id,h=!!this.hls.audioTracks[u].url;if(h){var f=this.videoBuffer;f&&this.mediaBuffer!==f&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=f)}this.altAudio=h,this.tick()},s.onBufferCreated=function(i,a){var u,h,f=a.tracks,m=!1;for(var y in f){var S=f[y];if(S.id==="main"){if(h=y,u=S,y==="video"){var k=f[y];k&&(this.videoBuffer=k.buffer)}}else m=!0}m&&u?(this.log("Alternate track found, use "+h+".buffered to schedule main fragment loading"),this.mediaBuffer=u.buffer):this.mediaBuffer=this.media},s.onFragBuffered=function(i,a){var u=a.frag,h=a.part;if(!u||u.type===oe.PlaylistLevelType.MAIN){if(this.fragContextChanged(u))return this.warn("Fragment "+u.sn+(h?" p: "+h.index:"")+" of level "+u.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Ci&&(this.state=nt));var f=h?h.stats:u.stats;this.fragLastKbps=Math.round(8*f.total/(f.buffering.end-f.loading.first)),u.sn!=="initSegment"&&(this.fragPrevious=u),this.fragBufferedComplete(u,h)}},s.onError=function(i,a){if(a.type!==I.ErrorTypes.KEY_SYSTEM_ERROR)switch(a.details){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:case I.ErrorDetails.FRAG_PARSING_ERROR:case I.ErrorDetails.KEY_LOAD_ERROR:case I.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(oe.PlaylistLevelType.MAIN,a);break;case I.ErrorDetails.LEVEL_LOAD_ERROR:case I.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==ni&&(a.fatal?(this.warn(""+a.details),this.state=ni):a.levelRetry||this.state!==ki||(this.state=nt));break;case I.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="main"&&(this.state===Qt||this.state===Ci)){var u=!0,h=this.getFwdBufferInfo(this.media,oe.PlaylistLevelType.MAIN);h&&h.len>.5&&(u=!this.reduceMaxBufferLength(h.len)),u&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(oe.PlaylistLevelType.MAIN,a)},s.checkBuffer=function(){var i=this.media,a=this.gapController;if(i&&a&&i.readyState){if(this.loadedmetadata||!St.getBuffered(i).length){var u=this.state!==nt?this.fragCurrent:null;a.poll(this.lastCurrentTime,u)}this.lastCurrentTime=i.currentTime}},s.onFragLoadEmergencyAborted=function(){this.state=nt,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},s.onBufferFlushed=function(i,a){var u=a.type;if(u!==X.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var h=(u===X.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(h,u,oe.PlaylistLevelType.MAIN)}},s.onLevelsUpdated=function(i,a){this.levels=a.levels},s.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},s.seekToStartPos=function(){var i=this.media;if(i){var a=i.currentTime,u=this.startPosition;if(u>=0&&a<u){if(i.seeking)return void this.log("could not seek to "+u+", already seeking at "+a);var h=St.getBuffered(i),f=(h.length?h.start(0):0)-u;f>0&&(f<this.config.maxBufferHole||f<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+f+" to match buffer start"),u+=f,this.startPosition=u),this.log("seek to target start position "+u+" from current time "+a),i.currentTime=u}}},s._getAudioCodec=function(i){var a=this.config.defaultAudioCodec||i.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a=a.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),a},s._loadBitrateTestFrag=function(i,a){var u=this;i.bitrateTest=!0,this._doFragLoad(i,a).then(function(h){var f=u.hls;if(h&&!f.nextLoadLevel&&!u.fragContextChanged(i)){u.fragLoadError=0,u.state=nt,u.startFragRequested=!1,u.bitrateTest=!1;var m=i.stats;m.parsing.start=m.parsing.end=m.buffering.start=m.buffering.end=self.performance.now(),f.trigger(p.Events.FRAG_LOADED,h),i.bitrateTest=!1}})},s._handleTransmuxComplete=function(i){var a,u="main",h=this.hls,f=i.remuxResult,m=i.chunkMeta,y=this.getCurrentContext(m);if(!y)return this.warn("The loading context changed while buffering fragment "+m.sn+" of level "+m.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(m.level);var S=y.frag,k=y.part,F=y.level,P=f.video,K=f.text,Z=f.id3,le=f.initSegment,ne=F.details,he=this.altAudio?void 0:f.audio;if(!this.fragContextChanged(S)){if(this.state=Qt,le){le.tracks&&(this._bufferInitSegment(F,le.tracks,S,m),h.trigger(p.Events.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:u,tracks:le.tracks}));var Re=le.initPTS,Ge=le.timescale;(0,N.isFiniteNumber)(Re)&&(this.initPTS[S.cc]=Re,h.trigger(p.Events.INIT_PTS_FOUND,{frag:S,id:u,initPTS:Re,timescale:Ge}))}if(P&&f.independent!==!1){if(ne){var ue=P.startPTS,Ie=P.endPTS,Ae=P.startDTS,Xe=P.endDTS;if(k)k.elementaryStreams[P.type]={startPTS:ue,endPTS:Ie,startDTS:Ae,endDTS:Xe};else if(P.firstKeyFrame&&P.independent&&m.id===1&&(this.couldBacktrack=!0),P.dropped&&P.independent){var vt=this.getMainFwdBufferInfo();if((vt?vt.end:this.getLoadPosition())+this.config.maxBufferHole<(P.firstKeyFramePTS?P.firstKeyFramePTS:ue)-this.config.maxBufferHole)return void this.backtrack(S);S.setElementaryStreamInfo(P.type,S.start,Ie,S.start,Xe,!0)}S.setElementaryStreamInfo(P.type,ue,Ie,Ae,Xe),this.backtrackFragment&&(this.backtrackFragment=S),this.bufferFragmentData(P,S,k,m)}}else if(f.independent===!1)return void this.backtrack(S);if(he){var Je=he.startPTS,tt=he.endPTS,lt=he.startDTS,Pt=he.endDTS;k&&(k.elementaryStreams[X.ElementaryStreamTypes.AUDIO]={startPTS:Je,endPTS:tt,startDTS:lt,endDTS:Pt}),S.setElementaryStreamInfo(X.ElementaryStreamTypes.AUDIO,Je,tt,lt,Pt),this.bufferFragmentData(he,S,k,m)}if(ne&&Z!=null&&(a=Z.samples)!==null&&a!==void 0&&a.length){var Rt={id:u,frag:S,details:ne,samples:Z.samples};h.trigger(p.Events.FRAG_PARSING_METADATA,Rt)}if(ne&&K){var kt={id:u,frag:S,details:ne,samples:K.samples};h.trigger(p.Events.FRAG_PARSING_USERDATA,kt)}}},s._bufferInitSegment=function(i,a,u,h){var f=this;if(this.state===Qt){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var m=a.audio,y=a.video,S=a.audiovideo;if(m){var k=i.audioCodec,F=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(k&&(k=k.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),m.metadata.channelCount!==1&&F.indexOf("firefox")===-1&&(k="mp4a.40.5")),F.indexOf("android")!==-1&&m.container!=="audio/mpeg"&&(k="mp4a.40.2",this.log("Android: force audio codec to "+k)),i.audioCodec&&i.audioCodec!==k&&this.log('Swapping manifest audio codec "'+i.audioCodec+'" for "'+k+'"'),m.levelCodec=k,m.id="main",this.log("Init audio buffer, container:"+m.container+", codecs[selected/level/parsed]=["+(k||"")+"/"+(i.audioCodec||"")+"/"+m.codec+"]")}y&&(y.levelCodec=i.videoCodec,y.id="main",this.log("Init video buffer, container:"+y.container+", codecs[level/parsed]=["+(i.videoCodec||"")+"/"+y.codec+"]")),S&&this.log("Init audiovideo buffer, container:"+S.container+", codecs[level/parsed]=["+(i.attrs.CODECS||"")+"/"+S.codec+"]"),this.hls.trigger(p.Events.BUFFER_CODECS,a),Object.keys(a).forEach(function(P){var K=a[P].initSegment;K!=null&&K.byteLength&&f.hls.trigger(p.Events.BUFFER_APPENDING,{type:P,data:K,frag:u,part:null,chunkMeta:h,parent:u.type})}),this.tick()}},s.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,oe.PlaylistLevelType.MAIN)},s.backtrack=function(i){this.couldBacktrack=!0,this.backtrackFragment=i,this.resetTransmuxer(),this.flushBufferGap(i),this.fragmentTracker.removeFragment(i),this.fragPrevious=null,this.nextLoadPosition=i.start,this.state=nt},s.checkFragmentChanged=function(){var i=this.media,a=null;if(i&&i.readyState>1&&i.seeking===!1){var u=i.currentTime;if(St.isBuffered(i,u)?a=this.getAppendedFrag(u):St.isBuffered(i,u+.1)&&(a=this.getAppendedFrag(u+.1)),a){this.backtrackFragment=null;var h=this.fragPlaying,f=a.level;h&&a.sn===h.sn&&h.level===f&&a.urlId===h.urlId||(this.fragPlaying=a,this.hls.trigger(p.Events.FRAG_CHANGED,{frag:a}),h&&h.level===f||this.hls.trigger(p.Events.LEVEL_SWITCHED,{level:f}))}}},r=t,(n=[{key:"nextLevel",get:function(){var i=this.nextBufferedFrag;return i?i.level:-1}},{key:"currentFrag",get:function(){var i=this.media;return i?this.fragPlaying||this.getAppendedFrag(i.currentTime):null}},{key:"currentProgramDateTime",get:function(){var i=this.media;if(i){var a=i.currentTime,u=this.currentFrag;if(u&&(0,N.isFiniteNumber)(a)&&(0,N.isFiniteNumber)(u.programDateTime)){var h=u.programDateTime+1e3*(a-u.start);return new Date(h)}}return null}},{key:"currentLevel",get:function(){var i=this.currentFrag;return i?i.level:-1}},{key:"nextBufferedFrag",get:function(){var i=this.currentFrag;return i?this.followingBufferedFrag(i):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&Ks(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),t}(gr);const Wi=function(){function d(e,t,r){t===void 0&&(t=0),r===void 0&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}var l=d.prototype;return l.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},l.getTotalWeight=function(){return this.totalWeight_},l.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},d}(),js=function(){function d(e,t,r){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Wi(e),this.fast_=new Wi(t)}var l=d.prototype;return l.update=function(e,t){var r=this.slow_,n=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new Wi(e,r.getEstimate(),r.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new Wi(t,n.getEstimate(),n.getTotalWeight()))},l.sample=function(e,t){var r=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/r;this.fast_.sample(r,n),this.slow_.sample(r,n)},l.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},l.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},l.destroy=function(){},d}();function Hs(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}const Vs=function(){function d(r){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=r;var n=r.config;this.bwEstimator=new js(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var l,e,t=d.prototype;return t.registerListeners=function(){var r=this.hls;r.on(p.Events.FRAG_LOADING,this.onFragLoading,this),r.on(p.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(p.Events.FRAG_BUFFERED,this.onFragBuffered,this),r.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(p.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var r=this.hls;r.off(p.Events.FRAG_LOADING,this.onFragLoading,this),r.off(p.Events.FRAG_LOADED,this.onFragLoaded,this),r.off(p.Events.FRAG_BUFFERED,this.onFragBuffered,this),r.off(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(p.Events.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},t.onFragLoading=function(r,n){var s,i=n.frag;i.type===oe.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=i,this.partCurrent=(s=n.part)!=null?s:null,this.timer=self.setInterval(this.onCheck,100)))},t.onLevelLoaded=function(r,n){var s=this.hls.config;n.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD)},t._abandonRulesCheck=function(){var r=this.fragCurrent,n=this.partCurrent,s=this.hls,i=s.autoLevelEnabled,a=s.media;if(r&&a){var u=n?n.stats:r.stats,h=n?n.duration:r.duration;if(u.aborted||u.loaded&&u.loaded===u.total||r.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!a.paused&&a.playbackRate&&a.readyState){var f=s.mainForwardBufferInfo;if(f!==null){var m=performance.now()-u.loading.start,y=Math.abs(a.playbackRate);if(!(m<=500*h/y)){var S=u.loaded&&u.loading.first,k=this.bwEstimator.getEstimate(),F=s.levels,P=s.minAutoLevel,K=F[r.level],Z=u.total||Math.max(u.loaded,Math.round(h*K.maxBitrate/8)),le=S?1e3*u.loaded/m:0,ne=le?(Z-u.loaded)/le:8*Z/k,he=f.len/y;if(!(ne<=he)){var Re,Ge=Number.POSITIVE_INFINITY;for(Re=r.level-1;Re>P;Re--){var ue=F[Re].maxBitrate;if((Ge=le?h*ue/(6.4*le):h*ue/k)<he)break}Ge>=ne||(_.logger.warn("Fragment "+r.sn+(n?" part "+n.index:"")+" of level "+r.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+Re+`
      Current BW estimate: `+((0,N.isFiniteNumber)(k)?(k/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+ne.toFixed(3)+` s
      Estimated load time for the next fragment: `+Ge.toFixed(3)+` s
      Time to underbuffer: `+he.toFixed(3)+" s"),s.nextLoadLevel=Re,S&&this.bwEstimator.sample(m,u.loaded),this.clearTimer(),(r.loader||r.keyLoader)&&(this.fragCurrent=this.partCurrent=null,r.abortRequests()),s.trigger(p.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:n,stats:u}))}}}}}},t.onFragLoaded=function(r,n){var s=n.frag,i=n.part;if(s.type===oe.PlaylistLevelType.MAIN&&(0,N.isFiniteNumber)(s.sn)){var a=i?i.stats:s.stats,u=i?i.duration:s.duration;if(this.clearTimer(),this.lastLoadedFragLevel=s.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var h=this.hls.levels[s.level],f=(h.loaded?h.loaded.bytes:0)+a.loaded,m=(h.loaded?h.loaded.duration:0)+u;h.loaded={bytes:f,duration:m},h.realBitrate=Math.round(8*f/m)}if(s.bitrateTest){var y={stats:a,frag:s,part:i,id:s.type};this.onFragBuffered(p.Events.FRAG_BUFFERED,y)}}},t.onFragBuffered=function(r,n){var s=n.frag,i=n.part,a=i?i.stats:s.stats;if(!a.aborted&&s.type===oe.PlaylistLevelType.MAIN&&s.sn!=="initSegment"){var u=a.parsing.end-a.loading.start;this.bwEstimator.sample(u,a.loaded),a.bwEstimate=this.bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=u/1e3:this.bitrateTestDelay=0}},t.onError=function(r,n){var s;if(((s=n.frag)===null||s===void 0?void 0:s.type)===oe.PlaylistLevelType.MAIN){if(n.type===I.ErrorTypes.KEY_SYSTEM_ERROR)return void this.clearTimer();switch(n.details){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:case I.ErrorDetails.KEY_LOAD_ERROR:case I.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer()}}},t.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},t.getNextABRAutoLevel=function(){var r=this.fragCurrent,n=this.partCurrent,s=this.hls,i=s.maxAutoLevel,a=s.config,u=s.minAutoLevel,h=s.media,f=n?n.duration:r?r.duration:0,m=h&&h.playbackRate!==0?Math.abs(h.playbackRate):1,y=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,S=s.mainForwardBufferInfo,k=(S?S.len:0)/m,F=this.findBestLevel(y,u,i,k,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(F>=0)return F;_.logger.trace((k?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var P=f?Math.min(f,a.maxStarvationDelay):a.maxStarvationDelay,K=a.abrBandWidthFactor,Z=a.abrBandWidthUpFactor;if(!k){var le=this.bitrateTestDelay;le&&(P=(f?Math.min(f,a.maxLoadingDelay):a.maxLoadingDelay)-le,_.logger.trace("bitrate test took "+Math.round(1e3*le)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*P)+" ms"),K=Z=1)}return F=this.findBestLevel(y,u,i,k+P,K,Z),Math.max(F,0)},t.findBestLevel=function(r,n,s,i,a,u){for(var h,f=this.fragCurrent,m=this.partCurrent,y=this.lastLoadedFragLevel,S=this.hls.levels,k=S[y],F=!(k==null||(h=k.details)===null||h===void 0||!h.live),P=k==null?void 0:k.codecSet,K=m?m.duration:f?f.duration:0,Z=s;Z>=n;Z--){var le=S[Z];if(le&&(!P||le.codecSet===P)){var ne,he=le.details,Re=(m?he==null?void 0:he.partTarget:he==null?void 0:he.averagetargetduration)||K;ne=Z<=y?a*r:u*r;var Ge=S[Z].maxBitrate,ue=Ge*Re/ne;if(_.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+Z+"/"+Math.round(ne)+"/"+Ge+"/"+Re+"/"+i+"/"+ue),ne>Ge&&(ue===0||!(0,N.isFiniteNumber)(ue)||F&&!this.bitrateTestDelay||ue<i))return Z}}return-1},l=d,(e=[{key:"nextAutoLevel",get:function(){var r=this._nextAutoLevel,n=this.bwEstimator;if(r!==-1&&!n.canEstimate())return r;var s=this.getNextABRAutoLevel();return r!==-1&&this.hls.levels[s].loadError?r:(r!==-1&&(s=Math.min(r,s)),s)},set:function(r){this._nextAutoLevel=r}}])&&Hs(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),d}();var bn=function(){function d(){this.chunks=[],this.dataLength=0}var l=d.prototype;return l.push=function(e){this.chunks.push(e),this.dataLength+=e.length},l.flush=function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=t.length===1?t[0]:function(n,s){for(var i=new Uint8Array(s),a=0,u=0;u<n.length;u++){var h=n[u];i.set(h,a),a+=h.length}return i}(t,r),this.reset(),e):new Uint8Array(0)},l.reset=function(){this.chunks.length=0,this.dataLength=0},d}();function $i(){return $i=Object.assign?Object.assign.bind():function(d){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(d[t]=e[t])}return d},$i.apply(this,arguments)}function br(d,l){return br=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},br(d,l)}var qs=function(d){var l,e;function t(n,s,i){var a;return(a=d.call(this,n,s,i,"[audio-stream-controller]")||this).videoBuffer=null,a.videoTrackCC=-1,a.waitingVideoCC=-1,a.audioSwitch=!1,a.trackId=-1,a.waitingData=null,a.mainDetails=null,a.bufferFlushed=!1,a.cachedTrackLoadedData=null,a._registerListeners(),a}e=d,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,br(l,e);var r=t.prototype;return r.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},r._registerListeners=function(){var n=this.hls;n.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(p.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.on(p.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(p.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(p.Events.ERROR,this.onError,this),n.on(p.Events.BUFFER_RESET,this.onBufferReset,this),n.on(p.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(p.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(p.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var n=this.hls;n.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(p.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.off(p.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(p.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(p.Events.ERROR,this.onError,this),n.off(p.Events.BUFFER_RESET,this.onBufferReset,this),n.off(p.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(p.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(p.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r.onInitPtsFound=function(n,s){var i=s.frag,a=s.id,u=s.initPTS;if(a==="main"){var h=i.cc;this.initPTS[i.cc]=u,this.log("InitPTS for cc: "+h+" found from main: "+u),this.videoTrackCC=h,this.state===Pi&&this.tick()}},r.startLoad=function(n){if(!this.levels)return this.startPosition=n,void(this.state=$t);var s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,s>0&&n===-1?(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),n=s,this.state=nt):(this.loadedmetadata=!1,this.state=Yi),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()},r.doTick=function(){switch(this.state){case nt:this.doTickIdle();break;case Yi:var n,s=this.levels,i=this.trackId,a=s==null||(n=s[i])===null||n===void 0?void 0:n.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=Pi}break;case Si:var u,h=performance.now(),f=this.retryDate;(!f||h>=f||(u=this.media)!==null&&u!==void 0&&u.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=nt);break;case Pi:var m=this.waitingData;if(m){var y=m.frag,S=m.part,k=m.cache,F=m.complete;if(this.initPTS[y.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=Ti;var P={frag:y,part:S,payload:k.flush(),networkDetails:null};this._handleFragmentLoadProgress(P),F&&d.prototype._handleFragmentLoadComplete.call(this,P)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+y.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var K=this.getLoadPosition(),Z=St.bufferInfo(this.mediaBuffer,K,this.config.maxBufferHole);dr(Z.end,this.config.maxFragLookUpTolerance,y)<0&&(this.log("Waiting fragment cc ("+y.cc+") @ "+y.start+" cancelled because another fragment at "+Z.end+" is needed"),this.clearWaitingFragment())}}else this.state=nt}this.onTickEnd()},r.clearWaitingFragment=function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=nt)},r.resetLoadingState=function(){this.clearWaitingFragment(),d.prototype.resetLoadingState.call(this)},r.onTickEnd=function(){var n=this.media;n&&n.readyState&&(this.lastCurrentTime=n.currentTime)},r.doTickIdle=function(){var n=this.hls,s=this.levels,i=this.media,a=this.trackId,u=n.config;if(s&&s[a]&&(i||!this.startFragRequested&&u.startFragPrefetch)){var h=s[a].details;if(!h||h.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(h))this.state=Yi;else{var f=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&f&&(this.bufferFlushed=!1,this.afterBufferFlushed(f,X.ElementaryStreamTypes.AUDIO,oe.PlaylistLevelType.AUDIO));var m=this.getFwdBufferInfo(f,oe.PlaylistLevelType.AUDIO);if(m!==null){var y=this.audioSwitch;if(!y&&this._streamEnded(m,h))return n.trigger(p.Events.BUFFER_EOS,{type:"audio"}),void(this.state=_i);var S=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,oe.PlaylistLevelType.MAIN);if(!(m.len>=this.getMaxBufferLength(S==null?void 0:S.len))||y){var k=h.fragments[0].start,F=m.end;if(y&&i){var P=this.getLoadPosition();F=P,h.PTSKnown&&P<k&&(m.end>k||m.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=k+.05)}if(!(S&&F>S.end+h.targetduration)&&(S&&S.len||!m.len)){var K=this.getNextFragment(F,h);K?this.loadFragment(K,h,F):this.bufferFlushed=!0}}}}}},r.getMaxBufferLength=function(n){var s=d.prototype.getMaxBufferLength.call(this);return n?Math.max(s,n):s},r.onMediaDetaching=function(){this.videoBuffer=null,d.prototype.onMediaDetaching.call(this)},r.onAudioTracksUpdated=function(n,s){var i=s.audioTracks;this.resetTransmuxer(),this.levels=i.map(function(a){return new M(a)})},r.onAudioTrackSwitching=function(n,s){var i=!!s.url;this.trackId=s.id;var a=this.fragCurrent;a&&a.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.audioSwitch=!0,this.state=nt):this.state=$t,this.tick()},r.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},r.onLevelLoaded=function(n,s){this.mainDetails=s.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(p.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},r.onAudioTrackLoaded=function(n,s){var i;if(this.mainDetails!=null){var a=this.levels,u=s.details,h=s.id;if(a){this.log("Track "+h+" loaded ["+u.startSN+","+u.endSN+"],duration:"+u.totalduration);var f=a[h],m=0;if(u.live||(i=f.details)!==null&&i!==void 0&&i.live){var y=this.mainDetails;if(u.fragments[0]||(u.deltaUpdateFailed=!0),u.deltaUpdateFailed||!y)return;!f.details&&u.hasProgramDateTime&&y.hasProgramDateTime?(dn(u,y),m=u.fragments[0].start):m=this.alignPlaylists(u,f.details)}f.details=u,this.levelLastLoaded=h,this.startFragRequested||!this.mainDetails&&u.live||this.setStartPosition(f.details,m),this.state!==Yi||this.waitForCdnTuneIn(u)||(this.state=nt),this.tick()}else this.warn("Audio tracks were reset while loading level "+h)}else this.cachedTrackLoadedData=s},r._handleFragmentLoadProgress=function(n){var s,i=n.frag,a=n.part,u=n.payload,h=this.config,f=this.trackId,m=this.levels;if(m){var y=m[f],S=y.details,k=h.defaultAudioCodec||y.audioCodec||"mp4a.40.2",F=this.transmuxer;F||(F=this.transmuxer=new En(this.hls,oe.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var P=this.initPTS[i.cc],K=(s=i.initSegment)===null||s===void 0?void 0:s.data;if(P!==void 0){var Z=a?a.index:-1,le=Z!==-1,ne=new ur(i.level,i.sn,i.stats.chunkCount,u.byteLength,Z,le);F.push(u,K,k,"",i,a,S.totalduration,!1,ne,P)}else this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+S.startSN+" ,"+S.endSN+"],track "+f),(this.waitingData=this.waitingData||{frag:i,part:a,cache:new bn,complete:!1}).cache.push(new Uint8Array(u)),this.waitingVideoCC=this.videoTrackCC,this.state=Pi}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},r._handleFragmentLoadComplete=function(n){this.waitingData?this.waitingData.complete=!0:d.prototype._handleFragmentLoadComplete.call(this,n)},r.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},r.onBufferCreated=function(n,s){var i=s.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),s.tracks.video&&(this.videoBuffer=s.tracks.video.buffer||null)},r.onFragBuffered=function(n,s){var i,a=s.frag,u=s.part;a.type===oe.PlaylistLevelType.AUDIO?this.fragContextChanged(a)?this.warn("Fragment "+a.sn+(u?" p: "+u.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(a.sn!=="initSegment"&&(this.fragPrevious=a,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(p.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(a,u)):this.loadedmetadata||a.type!==oe.PlaylistLevelType.MAIN||(i=this.videoBuffer||this.media)!==null&&i!==void 0&&i.buffered.length&&(this.loadedmetadata=!0)},r.onError=function(n,s){if(s.type!==I.ErrorTypes.KEY_SYSTEM_ERROR)switch(s.details){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:case I.ErrorDetails.FRAG_PARSING_ERROR:case I.ErrorDetails.KEY_LOAD_ERROR:case I.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(oe.PlaylistLevelType.AUDIO,s);break;case I.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case I.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==ni&&this.state!==$t&&(this.state=s.fatal?ni:nt,this.warn(s.details+" while loading frag, switching to "+this.state+" state"));break;case I.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="audio"&&(this.state===Qt||this.state===Ci)){var i=!0,a=this.getFwdBufferInfo(this.mediaBuffer,oe.PlaylistLevelType.AUDIO);a&&a.len>.5&&(i=!this.reduceMaxBufferLength(a.len)),i&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(oe.PlaylistLevelType.AUDIO,s)},r.onBufferFlushed=function(n,s){s.type===X.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===_i&&(this.state=nt))},r._handleTransmuxComplete=function(n){var s,i="audio",a=this.hls,u=n.remuxResult,h=n.chunkMeta,f=this.getCurrentContext(h);if(!f)return this.warn("The loading context changed while buffering fragment "+h.sn+" of level "+h.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(h.level);var m=f.frag,y=f.part,S=f.level.details,k=u.audio,F=u.text,P=u.id3,K=u.initSegment;if(!this.fragContextChanged(m)&&S){if(this.state=Qt,this.audioSwitch&&k&&this.completeAudioSwitch(),K!=null&&K.tracks&&(this._bufferInitSegment(K.tracks,m,h),a.trigger(p.Events.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:i,tracks:K.tracks})),k){var Z=k.startPTS,le=k.endPTS,ne=k.startDTS,he=k.endDTS;y&&(y.elementaryStreams[X.ElementaryStreamTypes.AUDIO]={startPTS:Z,endPTS:le,startDTS:ne,endDTS:he}),m.setElementaryStreamInfo(X.ElementaryStreamTypes.AUDIO,Z,le,ne,he),this.bufferFragmentData(k,m,y,h)}if(P!=null&&(s=P.samples)!==null&&s!==void 0&&s.length){var Re=$i({id:i,frag:m,details:S},P);a.trigger(p.Events.FRAG_PARSING_METADATA,Re)}if(F){var Ge=$i({id:i,frag:m,details:S},F);a.trigger(p.Events.FRAG_PARSING_USERDATA,Ge)}}},r._bufferInitSegment=function(n,s,i){if(this.state===Qt){n.video&&delete n.video;var a=n.audio;if(a){a.levelCodec=a.codec,a.id="audio",this.log("Init audio buffer, container:"+a.container+", codecs[parsed]=["+a.codec+"]"),this.hls.trigger(p.Events.BUFFER_CODECS,n);var u=a.initSegment;if(u!=null&&u.byteLength){var h={type:"audio",frag:s,part:null,chunkMeta:i,parent:s.type,data:u};this.hls.trigger(p.Events.BUFFER_APPENDING,h)}this.tick()}}},r.loadFragment=function(n,s,i){var a=this.fragmentTracker.getState(n);this.fragCurrent=n,(this.audioSwitch||a===De.NOT_LOADED||a===De.PARTIAL)&&(n.sn==="initSegment"?this._loadInitSegment(n,s):s.live&&!(0,N.isFiniteNumber)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=Pi):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,n,s,i)))},r.completeAudioSwitch=function(){var n=this.hls,s=this.media,i=this.trackId;s&&(this.log("Switching audio track : flushing all audio"),d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,n.trigger(p.Events.AUDIO_TRACK_SWITCHED,{id:i})},t}(gr);const Ys=qs;function Ws(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}function Tr(d,l){return Tr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Tr(d,l)}const $s=function(d){var l,e;function t(i){var a;return(a=d.call(this,i,"[audio-track-controller]")||this).tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.trackName="",a.selectDefaultTrack=!0,a.registerListeners(),a}e=d,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Tr(l,e);var r,n,s=t.prototype;return s.registerListeners=function(){var i=this.hls;i.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(p.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(p.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(p.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(p.Events.ERROR,this.onError,this)},s.unregisterListeners=function(){var i=this.hls;i.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(p.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(p.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(p.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(p.Events.ERROR,this.onError,this)},s.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,d.prototype.destroy.call(this)},s.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},s.onManifestParsed=function(i,a){this.tracks=a.audioTracks||[]},s.onAudioTrackLoaded=function(i,a){var u=a.id,h=a.details,f=this.tracksInGroup[u];if(f){var m=f.details;f.details=a.details,this.log("audioTrack "+u+" loaded ["+h.startSN+"-"+h.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,a,m))}else this.warn("Invalid audio track id "+u)},s.onLevelLoading=function(i,a){this.switchLevel(a.level)},s.onLevelSwitching=function(i,a){this.switchLevel(a.level)},s.switchLevel=function(i){var a=this.hls.levels[i];if(a!=null&&a.audioGroupIds){var u=a.audioGroupIds[a.urlId];if(this.groupId!==u){this.groupId=u;var h=this.tracks.filter(function(m){return!u||m.groupId===u});this.selectDefaultTrack&&!h.some(function(m){return m.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=h;var f={audioTracks:h};this.log("Updating audio tracks, "+h.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(p.Events.AUDIO_TRACKS_UPDATED,f),this.selectInitialTrack()}}},s.onError=function(i,a){d.prototype.onError.call(this,i,a),!a.fatal&&a.context&&a.context.type===oe.PlaylistContextType.AUDIO_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},s.setAudioTrack=function(i){var a=this.tracksInGroup;if(i<0||i>=a.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var u=a[this.trackId];this.log("Now switching to audio-track index "+i);var h=a[i],f=h.id,m=h.groupId,y=m===void 0?"":m,S=h.name,k=h.type,F=h.url;if(this.trackId=i,this.trackName=S,this.selectDefaultTrack=!1,this.hls.trigger(p.Events.AUDIO_TRACK_SWITCHING,{id:f,groupId:y,name:S,type:k,url:F}),!h.details||h.details.live){var P=this.switchParams(h.url,u==null?void 0:u.details);this.loadPlaylist(P)}}},s.selectInitialTrack=function(){this.tracksInGroup;var i=this.trackName,a=this.findTrackId(i)||this.findTrackId();a!==-1?this.setAudioTrack(a):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(p.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},s.findTrackId=function(i){for(var a=this.tracksInGroup,u=0;u<a.length;u++){var h=a[u];if((!this.selectDefaultTrack||h.default)&&(!i||i===h.name))return h.id}return-1},s.loadPlaylist=function(i){d.prototype.loadPlaylist.call(this);var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var u=a.id,h=a.groupId,f=a.url;if(i)try{f=i.addDirectives(f)}catch(m){this.warn("Could not construct new URL with HLS Delivery Directives: "+m)}this.log("loading audio-track playlist for id: "+u),this.clearTimer(),this.hls.trigger(p.Events.AUDIO_TRACK_LOADING,{url:f,id:u,groupId:h,deliveryDirectives:i||null})}},r=t,(n=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}}])&&Ws(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),t}(fe);function zs(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}function Sr(d,l){return Sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Sr(d,l)}var Xs=function(d){var l,e;function t(i,a,u){var h;return(h=d.call(this,i,a,u,"[subtitle-stream-controller]")||this).levels=[],h.currentTrackId=-1,h.tracksBuffered=[],h.mainDetails=null,h._registerListeners(),h}e=d,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Sr(l,e);var r,n,s=t.prototype;return s.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},s._registerListeners=function(){var i=this.hls;i.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(p.Events.ERROR,this.onError,this),i.on(p.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(p.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.on(p.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(p.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.on(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s._unregisterListeners=function(){var i=this.hls;i.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(p.Events.ERROR,this.onError,this),i.off(p.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(p.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.off(p.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(p.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.off(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s.startLoad=function(i){this.stopLoad(),this.state=nt,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=i,this.tick()},s.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},s.onLevelLoaded=function(i,a){this.mainDetails=a.details},s.onSubtitleFragProcessed=function(i,a){var u=a.frag,h=a.success;if(this.fragPrevious=u,this.state=nt,h){var f=this.tracksBuffered[this.currentTrackId];if(f){for(var m,y=u.start,S=0;S<f.length;S++)if(y>=f[S].start&&y<=f[S].end){m=f[S];break}var k=u.start+u.duration;m?m.end=k:(m={start:y,end:k},f.push(m)),this.fragmentTracker.fragBuffered(u)}}},s.onBufferFlushing=function(i,a){var u=a.startOffset,h=a.endOffset;if(u===0&&h!==Number.POSITIVE_INFINITY){var f=this.currentTrackId,m=this.levels;if(!m.length||!m[f]||!m[f].details)return;var y=h-m[f].details.targetduration;if(y<=0)return;a.endOffsetSubtitles=Math.max(0,y),this.tracksBuffered.forEach(function(S){for(var k=0;k<S.length;)if(S[k].end<=y)S.shift();else{if(!(S[k].start<y))break;S[k].start=y,k++}}),this.fragmentTracker.removeFragmentsInRange(u,y,oe.PlaylistLevelType.SUBTITLE)}},s.onFragBuffered=function(i,a){var u;this.loadedmetadata||a.frag.type!==oe.PlaylistLevelType.MAIN||(u=this.media)!==null&&u!==void 0&&u.buffered.length&&(this.loadedmetadata=!0)},s.onError=function(i,a){var u=a.frag;u&&u.type===oe.PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=nt)},s.onSubtitleTracksUpdated=function(i,a){var u=this,h=a.subtitleTracks;this.tracksBuffered=[],this.levels=h.map(function(f){return new M(f)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(f){u.tracksBuffered[f.id]=[]}),this.mediaBuffer=null},s.onSubtitleTrackSwitch=function(i,a){if(this.currentTrackId=a.id,this.levels.length&&this.currentTrackId!==-1){var u=this.levels[this.currentTrackId];u!=null&&u.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,u&&this.setInterval(500)}else this.clearInterval()},s.onSubtitleTrackLoaded=function(i,a){var u,h=a.details,f=a.id,m=this.currentTrackId,y=this.levels;if(y.length){var S=y[m];if(!(f>=y.length||f!==m)&&S){this.mediaBuffer=this.mediaBufferTimeRanges;var k=0;if(h.live||(u=S.details)!==null&&u!==void 0&&u.live){var F=this.mainDetails;if(h.deltaUpdateFailed||!F)return;var P=F.fragments[0];S.details?(k=this.alignPlaylists(h,S.details))===0&&P&&ae(h,k=P.start):h.hasProgramDateTime&&F.hasProgramDateTime?(dn(h,F),k=h.fragments[0].start):P&&ae(h,k=P.start)}S.details=h,this.levelLastLoaded=f,this.startFragRequested||!this.mainDetails&&h.live||this.setStartPosition(S.details,k),this.tick(),h.live&&!this.fragCurrent&&this.media&&this.state===nt&&(hr(null,h.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),S.details=void 0))}}},s._handleFragmentLoadComplete=function(i){var a=this,u=i.frag,h=i.payload,f=u.decryptdata,m=this.hls;if(!this.fragContextChanged(u)&&h&&h.byteLength>0&&f&&f.key&&f.iv&&f.method==="AES-128"){var y=performance.now();this.decrypter.decrypt(new Uint8Array(h),f.key.buffer,f.iv.buffer).then(function(S){var k=performance.now();m.trigger(p.Events.FRAG_DECRYPTED,{frag:u,payload:S,stats:{tstart:y,tdecrypt:k}})}).catch(function(S){a.warn(S.name+": "+S.message),a.state=nt})}},s.doTick=function(){if(this.media){if(this.state===nt){var i=this.currentTrackId,a=this.levels;if(!a.length||!a[i]||!a[i].details)return;var u=a[i].details,h=u.targetduration,f=this.config,m=this.getLoadPosition(),y=St.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],m-h,f.maxBufferHole),S=y.end,k=y.len,F=this.getFwdBufferInfo(this.media,oe.PlaylistLevelType.MAIN);if(k>this.getMaxBufferLength(F==null?void 0:F.len)+h)return;var P=u.fragments,K=P.length,Z=u.edge,le=null,ne=this.fragPrevious;if(S<Z){var he=f.maxFragLookUpTolerance;!(le=hr(ne,P,Math.max(P[0].start,S),he))&&ne&&ne.start<P[0].start&&(le=P[0])}else le=P[K-1];if(!le)return;le=this.mapToInitFragWhenRequired(le),this.fragmentTracker.getState(le)===De.NOT_LOADED&&this.loadFragment(le,u,S)}}else this.state=nt},s.getMaxBufferLength=function(i){var a=d.prototype.getMaxBufferLength.call(this);return i?Math.max(a,i):a},s.loadFragment=function(i,a,u){this.fragCurrent=i,i.sn==="initSegment"?this._loadInitSegment(i,a):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,i,a,u))},r=t,(n=[{key:"mediaBufferTimeRanges",get:function(){return new Qs(this.tracksBuffered[this.currentTrackId]||[])}}])&&zs(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),t}(gr),Qs=function(d){this.buffered=void 0;var l=function(e,t,r){if((t>>>=0)>r-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+r+")");return d[t][e]};this.buffered={get length(){return d.length},end:function(e){return l("end",e,d.length)},start:function(e){return l("start",e,d.length)}}};function Js(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}function kr(d,l){return kr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},kr(d,l)}function Ar(d){for(var l=[],e=0;e<d.length;e++){var t=d[e];t.kind==="subtitles"&&t.label&&l.push(d[e])}return l}const Zs=function(d){var l,e;function t(i){var a;return(a=d.call(this,i,"[subtitle-track-controller]")||this).media=null,a.tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.selectDefaultTrack=!0,a.queuedDefaultTrack=-1,a.trackChangeListener=function(){return a.onTextTracksChanged()},a.asyncPollTrackChange=function(){return a.pollTrackChange(0)},a.useTextTrackPolling=!1,a.subtitlePollingInterval=-1,a._subtitleDisplay=!0,a.registerListeners(),a}e=d,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,kr(l,e);var r,n,s=t.prototype;return s.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,d.prototype.destroy.call(this)},s.registerListeners=function(){var i=this.hls;i.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(p.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(p.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(p.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(p.Events.ERROR,this.onError,this)},s.unregisterListeners=function(){var i=this.hls;i.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(p.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(p.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(p.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(p.Events.ERROR,this.onError,this)},s.onMediaAttached=function(i,a){this.media=a.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},s.pollTrackChange=function(i){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,i)},s.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Ar(this.media.textTracks).forEach(function(i){et(i)}),this.subtitleTrack=-1,this.media=null)},s.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},s.onManifestParsed=function(i,a){this.tracks=a.subtitleTracks},s.onSubtitleTrackLoaded=function(i,a){var u=a.id,h=a.details,f=this.trackId,m=this.tracksInGroup[f];if(m){var y=m.details;m.details=a.details,this.log("subtitle track "+u+" loaded ["+h.startSN+"-"+h.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,a,y))}else this.warn("Invalid subtitle track id "+u)},s.onLevelLoading=function(i,a){this.switchLevel(a.level)},s.onLevelSwitching=function(i,a){this.switchLevel(a.level)},s.switchLevel=function(i){var a=this.hls.levels[i];if(a!=null&&a.textGroupIds){var u=a.textGroupIds[a.urlId];if(this.groupId!==u){var h=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,f=this.tracks.filter(function(S){return!u||S.groupId===u});this.tracksInGroup=f;var m=this.findTrackId(h==null?void 0:h.name)||this.findTrackId();this.groupId=u;var y={subtitleTracks:f};this.log("Updating subtitle tracks, "+f.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(p.Events.SUBTITLE_TRACKS_UPDATED,y),m!==-1&&this.setSubtitleTrack(m,h)}}},s.findTrackId=function(i){for(var a=this.tracksInGroup,u=0;u<a.length;u++){var h=a[u];if((!this.selectDefaultTrack||h.default)&&(!i||i===h.name))return h.id}return-1},s.onError=function(i,a){d.prototype.onError.call(this,i,a),!a.fatal&&a.context&&a.context.type===oe.PlaylistContextType.SUBTITLE_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},s.loadPlaylist=function(i){d.prototype.loadPlaylist.call(this);var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var u=a.id,h=a.groupId,f=a.url;if(i)try{f=i.addDirectives(f)}catch(m){this.warn("Could not construct new URL with HLS Delivery Directives: "+m)}this.log("Loading subtitle playlist for id "+u),this.hls.trigger(p.Events.SUBTITLE_TRACK_LOADING,{url:f,id:u,groupId:h,deliveryDirectives:i||null})}},s.toggleTrackModes=function(i){var a=this,u=this.media,h=this.trackId;if(u){var f=Ar(u.textTracks),m=f.filter(function(k){return k.groupId===a.groupId});if(i===-1)[].slice.call(f).forEach(function(k){k.mode="disabled"});else{var y=m[h];y&&(y.mode="disabled")}var S=m[i];S&&(S.mode=this.subtitleDisplay?"showing":"hidden")}},s.setSubtitleTrack=function(i,a){var u,h=this.tracksInGroup;if(this.media){if(this.trackId!==i&&this.toggleTrackModes(i),!(this.trackId===i&&(i===-1||(u=h[i])!==null&&u!==void 0&&u.details)||i<-1||i>=h.length)){this.clearTimer();var f=h[i];if(this.log("Switching to subtitle track "+i),this.trackId=i,f){var m=f.id,y=f.groupId,S=y===void 0?"":y,k=f.name,F=f.type,P=f.url;this.hls.trigger(p.Events.SUBTITLE_TRACK_SWITCH,{id:m,groupId:S,name:k,type:F,url:P});var K=this.switchParams(f.url,a==null?void 0:a.details);this.loadPlaylist(K)}else this.hls.trigger(p.Events.SUBTITLE_TRACK_SWITCH,{id:i})}}else this.queuedDefaultTrack=i},s.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var i=-1,a=Ar(this.media.textTracks),u=0;u<a.length;u++)if(a[u].mode==="hidden")i=u;else if(a[u].mode==="showing"){i=u;break}this.subtitleTrack!==i&&(this.subtitleTrack=i)}},r=t,(n=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(i){this._subtitleDisplay=i,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1;var a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(i,a)}}])&&Js(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),t}(fe);var rt,ea=function(){function d(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var l=d.prototype;return l.append=function(e,t){var r=this.queues[t];r.push(e),r.length===1&&this.buffers[t]&&this.executeNext(t)},l.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},l.appendBlocker=function(e){var t,r=new Promise(function(s){t=s}),n={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,e),r},l.executeNext=function(e){var t=this.buffers,r=this.queues,n=t[e],s=r[e];if(s.length){var i=s[0];try{i.execute()}catch(a){_.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),i.onError(a),n&&n.updating||(s.shift(),this.executeNext(e))}}},l.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},l.current=function(e){return this.queues[e][0]},d}(),Tn=pr(),Sn=/([ha]vc.)(?:\.[^.,]+)+/,ta=function(){function d(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=t.hls,n=t.media,s=t.mediaSource;_.logger.log("[buffer-controller]: Media source opened"),n&&(t.updateMediaElementDuration(),r.trigger(p.Events.MEDIA_ATTACHED,{media:n})),s&&s.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){_.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){_.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var l=d.prototype;return l.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},l.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},l.registerListeners=function(){var e=this.hls;e.on(p.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(p.Events.BUFFER_RESET,this.onBufferReset,this),e.on(p.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(p.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(p.Events.BUFFER_EOS,this.onBufferEos,this),e.on(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(p.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(p.Events.FRAG_PARSED,this.onFragParsed,this),e.on(p.Events.FRAG_CHANGED,this.onFragChanged,this)},l.unregisterListeners=function(){var e=this.hls;e.off(p.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(p.Events.BUFFER_RESET,this.onBufferReset,this),e.off(p.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(p.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(p.Events.BUFFER_EOS,this.onBufferEos,this),e.off(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(p.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(p.Events.FRAG_PARSED,this.onFragParsed,this),e.off(p.Events.FRAG_CHANGED,this.onFragChanged,this)},l._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new ea(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},l.onManifestParsed=function(e,t){var r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,_.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},l.onMediaAttaching=function(e,t){var r=this.media=t.media;if(r&&Tn){var n=this.mediaSource=new Tn;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(n),this._objectUrl=r.src}},l.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(_.logger.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(n){_.logger.warn("[buffer-controller]: onMediaDetaching: "+n.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):_.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(p.Events.MEDIA_DETACHED,void 0)},l.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var r=e.sourceBuffer[t];try{r&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[t]=void 0)}catch(n){_.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",n)}}),this._initSourceBuffer()},l.onBufferCodecs=function(e,t){var r=this,n=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(s){if(n){var i=r.tracks[s];if(i&&typeof i.buffer.changeType=="function"){var a=t[s],u=a.id,h=a.codec,f=a.levelCodec,m=a.container,y=a.metadata,S=(i.levelCodec||i.codec).replace(Sn,"$1"),k=(f||h).replace(Sn,"$1");if(S!==k){var F=m+";codecs="+(f||h);r.appendChangeType(s,F),_.logger.log("[buffer-controller]: switching codec "+S+" to "+k),r.tracks[s]={buffer:i.buffer,codec:h,container:m,levelCodec:f,metadata:y,id:u}}}}else r.pendingTracks[s]=t[s]}),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},l.appendChangeType=function(e,t){var r=this,n=this.operationQueue,s={execute:function(){var i=r.sourceBuffer[e];i&&(_.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),i.changeType(t)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(i){_.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",i)}};n.append(s,e)},l.onBufferAppending=function(e,t){var r=this,n=this.hls,s=this.operationQueue,i=this.tracks,a=t.data,u=t.type,h=t.frag,f=t.part,m=t.chunkMeta,y=m.buffering[u],S=self.performance.now();y.start=S;var k=h.stats.buffering,F=f?f.stats.buffering:null;k.start===0&&(k.start=S),F&&F.start===0&&(F.start=S);var P=i.audio,K=!1;u==="audio"&&(P==null?void 0:P.container)==="audio/mpeg"&&(K=!this.lastMpegAudioChunk||m.id===1||this.lastMpegAudioChunk.sn!==m.sn,this.lastMpegAudioChunk=m);var Z=h.start,le={execute:function(){if(y.executeStart=self.performance.now(),K){var ne=r.sourceBuffer[u];if(ne){var he=Z-ne.timestampOffset;Math.abs(he)>=.1&&(_.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+Z+" (delta: "+he+") sn: "+h.sn+")"),ne.timestampOffset=Z)}}r.appendExecutor(a,u)},onStart:function(){},onComplete:function(){var ne=self.performance.now();y.executeEnd=y.end=ne,k.first===0&&(k.first=ne),F&&F.first===0&&(F.first=ne);var he=r.sourceBuffer,Re={};for(var Ge in he)Re[Ge]=St.getBuffered(he[Ge]);r.appendError=0,r.hls.trigger(p.Events.BUFFER_APPENDED,{type:u,frag:h,part:f,chunkMeta:m,parent:h.type,timeRanges:Re})},onError:function(ne){_.logger.error("[buffer-controller]: Error encountered while trying to append to the "+u+" SourceBuffer",ne);var he={type:I.ErrorTypes.MEDIA_ERROR,parent:h.type,details:I.ErrorDetails.BUFFER_APPEND_ERROR,err:ne,fatal:!1};ne.code===DOMException.QUOTA_EXCEEDED_ERR?he.details=I.ErrorDetails.BUFFER_FULL_ERROR:(r.appendError++,he.details=I.ErrorDetails.BUFFER_APPEND_ERROR,r.appendError>n.config.appendErrorMaxRetry&&(_.logger.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),he.fatal=!0,n.stopLoad())),n.trigger(p.Events.ERROR,he)}};s.append(le,u)},l.onBufferFlushing=function(e,t){var r=this,n=this.operationQueue,s=function(i){return{execute:r.removeExecutor.bind(r,i,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(p.Events.BUFFER_FLUSHED,{type:i})},onError:function(a){_.logger.warn("[buffer-controller]: Failed to remove from "+i+" SourceBuffer",a)}}};t.type?n.append(s(t.type),t.type):this.getSourceBufferTypes().forEach(function(i){n.append(s(i),i)})},l.onFragParsed=function(e,t){var r=this,n=t.frag,s=t.part,i=[],a=s?s.elementaryStreams:n.elementaryStreams;a[X.ElementaryStreamTypes.AUDIOVIDEO]?i.push("audiovideo"):(a[X.ElementaryStreamTypes.AUDIO]&&i.push("audio"),a[X.ElementaryStreamTypes.VIDEO]&&i.push("video")),i.length===0&&_.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(function(){var u=self.performance.now();n.stats.buffering.end=u,s&&(s.stats.buffering.end=u);var h=s?s.stats:n.stats;r.hls.trigger(p.Events.FRAG_BUFFERED,{frag:n,part:s,stats:h,id:n.type})},i)},l.onFragChanged=function(e,t){this.flushBackBuffer()},l.onBufferEos=function(e,t){var r=this;this.getSourceBufferTypes().reduce(function(n,s){var i=r.sourceBuffer[s];return!i||t.type&&t.type!==s||(i.ending=!0,i.ended||(i.ended=!0,_.logger.log("[buffer-controller]: "+s+" sourceBuffer now EOS"))),n&&!(i&&!i.ended)},!0)&&(_.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){r.getSourceBufferTypes().forEach(function(s){var i=r.sourceBuffer[s];i&&(i.ending=!1)});var n=r.mediaSource;n&&n.readyState==="open"?(_.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),n.endOfStream()):n&&_.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+n.readyState)}))},l.onLevelUpdated=function(e,t){var r=t.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},l.flushBackBuffer=function(){var e=this.hls,t=this.details,r=this.media,n=this.sourceBuffer;if(r&&t!==null){var s=this.getSourceBufferTypes();if(s.length){var i=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if((0,N.isFiniteNumber)(i)&&!(i<0)){var a=r.currentTime,u=t.levelTargetDuration,h=Math.max(i,u),f=Math.floor(a/u)*u-h;s.forEach(function(m){var y=n[m];if(y){var S=St.getBuffered(y);if(S.length>0&&f>S.start(0)){if(e.trigger(p.Events.BACK_BUFFER_REACHED,{bufferEnd:f}),t.live)e.trigger(p.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:f});else if(y.ended&&S.end(S.length-1)-a<2*u)return void _.logger.info("[buffer-controller]: Cannot flush "+m+" back buffer while SourceBuffer is in ended state");e.trigger(p.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:f,type:m})}}})}}}},l.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,t=this.hls,r=this.media,n=this.mediaSource,s=e.fragments[0].start+e.totalduration,i=r.duration,a=(0,N.isFiniteNumber)(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(_.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(s>a&&s>i||!(0,N.isFiniteNumber)(i))&&(_.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),n.duration=s)}},l.updateSeekableRange=function(e){var t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&t!=null&&t.setLiveSeekableRange){var n=Math.max(0,r[0].start),s=Math.max(n,n+e.totalduration);t.setLiveSeekableRange(n,s)}},l.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,n=Object.keys(r).length;if(n&&!e||n===2){this.createSourceBuffers(r),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length===0)return void this.hls.trigger(p.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});s.forEach(function(i){t.executeNext(i)})}},l.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var n=0;for(var s in e)if(!t[s]){var i=e[s];if(!i)throw Error("source buffer exists for track "+s+", however track does not");var a=i.levelCodec||i.codec,u=i.container+";codecs="+a;_.logger.log("[buffer-controller]: creating sourceBuffer("+u+")");try{var h=t[s]=r.addSourceBuffer(u),f=s;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.tracks[s]={buffer:h,codec:a,container:i.container,levelCodec:i.levelCodec,metadata:i.metadata,id:i.id},n++}catch(m){_.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+m.message),this.hls.trigger(p.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,mimeType:u})}}n&&this.hls.trigger(p.Events.BUFFER_CREATED,{tracks:this.tracks})},l._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},l._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},l._onSBUpdateError=function(e,t){_.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(p.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var r=this.operationQueue.current(e);r&&r.onError(t)},l.removeExecutor=function(e,t,r){var n=this.media,s=this.mediaSource,i=this.operationQueue,a=this.sourceBuffer[e];if(!n||!s||!a)return _.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(e);var u=(0,N.isFiniteNumber)(n.duration)?n.duration:1/0,h=(0,N.isFiniteNumber)(s.duration)?s.duration:1/0,f=Math.max(0,t),m=Math.min(r,u,h);m>f&&!a.ending?(a.ended=!1,_.logger.log("[buffer-controller]: Removing ["+f+","+m+"] from the "+e+" SourceBuffer"),a.remove(f,m)):i.shiftAndExecuteNext(e)},l.appendExecutor=function(e,t){var r=this.operationQueue,n=this.sourceBuffer[t];if(!n)return _.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(t);n.ended=!1,n.appendBuffer(e)},l.blockBuffers=function(e,t){var r=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length)return _.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var n=this.operationQueue,s=t.map(function(i){return n.appendBlocker(i)});Promise.all(s).then(function(){e(),t.forEach(function(i){var a=r.sourceBuffer[i];a&&a.updating||n.shiftAndExecuteNext(i)})})},l.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},l.addBufferListener=function(e,t,r){var n=this.sourceBuffer[e];if(n){var s=r.bind(this,e);this.listeners[e].push({event:t,listener:s}),n.addEventListener(t,s)}},l.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach(function(r){t.removeEventListener(r.event,r.listener)})},d}(),kn={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},An=function(d){var l=d;return kn.hasOwnProperty(d)&&(l=kn[d]),String.fromCharCode(l)},mi=15,si=100,ia={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},ra={17:2,18:4,21:6,22:8,23:10,19:13,20:15},na={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},sa={25:2,26:4,29:6,30:8,31:10,27:13,28:15},aa=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(d){d[d.ERROR=0]="ERROR",d[d.TEXT=1]="TEXT",d[d.WARNING=2]="WARNING",d[d.INFO=2]="INFO",d[d.DEBUG=3]="DEBUG",d[d.DATA=3]="DATA"})(rt||(rt={}));var oa=function(){function d(){this.time=null,this.verboseLevel=rt.ERROR}return d.prototype.log=function(l,e){if(this.verboseLevel>=l){var t=typeof e=="function"?e():e;_.logger.log(this.time+" ["+l+"] "+t)}},d}(),vi=function(d){for(var l=[],e=0;e<d.length;e++)l.push(d[e].toString(16));return l},wn=function(){function d(e,t,r,n,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=n||"black",this.flash=s||!1}var l=d.prototype;return l.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},l.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}},l.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},l.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},l.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},l.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},d}(),la=function(){function d(e,t,r,n,s,i){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new wn(t,r,n,s,i)}var l=d.prototype;return l.reset=function(){this.uchar=" ",this.penState.reset()},l.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},l.setPenState=function(e){this.penState.copy(e)},l.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},l.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},l.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},d}(),ua=function(){function d(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<si;t++)this.chars.push(new la);this.logger=e,this.pos=0,this.currPenState=new wn}var l=d.prototype;return l.equals=function(e){for(var t=!0,r=0;r<si;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},l.copy=function(e){for(var t=0;t<si;t++)this.chars[t].copy(e.chars[t])},l.isEmpty=function(){for(var e=!0,t=0;t<si;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},l.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(rt.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>si&&(this.logger.log(rt.DEBUG,"Too large cursor position "+this.pos),this.pos=si)},l.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},l.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},l.insertChar=function(e){var t=this;e>=144&&this.backSpace();var r=An(e);this.pos>=si?this.logger.log(rt.ERROR,function(){return"Cannot insert "+e.toString(16)+" ("+r+") at position "+t.pos+". Skipping it!"}):(this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1))},l.clearFromPos=function(e){var t;for(t=e;t<si;t++)this.chars[t].reset()},l.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},l.clearToEndOfRow=function(){this.clearFromPos(this.pos)},l.getTextString=function(){for(var e=[],t=!0,r=0;r<si;r++){var n=this.chars[r].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")},l.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},d}(),wr=function(){function d(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<mi;t++)this.rows.push(new ua(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var l=d.prototype;return l.reset=function(){for(var e=0;e<mi;e++)this.rows[e].clear();this.currRow=14},l.equals=function(e){for(var t=!0,r=0;r<mi;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},l.copy=function(e){for(var t=0;t<mi;t++)this.rows[t].copy(e.rows[t])},l.isEmpty=function(){for(var e=!0,t=0;t<mi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},l.backSpace=function(){this.rows[this.currRow].backSpace()},l.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},l.insertChar=function(e){this.rows[this.currRow].insertChar(e)},l.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},l.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},l.setCursor=function(e){this.logger.log(rt.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},l.setPAC=function(e){this.logger.log(rt.INFO,function(){return"pacData = "+JSON.stringify(e)});var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<mi;r++)this.rows[r].clear();var n=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var i=s.rows[n].cueStartTime,a=this.logger.time;if(i&&a!==null&&i<a)for(var u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(s.rows[n+u])}}this.currRow=t;var h=this.rows[this.currRow];if(e.indent!==null){var f=e.indent,m=Math.max(f-1,0);h.setCursor(e.indent),e.color=h.chars[m].penState.foreground}var y={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(y)},l.setBkgData=function(e){this.logger.log(rt.INFO,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},l.setRollUpRows=function(e){this.nrRollUpRows=e},l.rollUp=function(){var e=this;if(this.nrRollUpRows!==null){this.logger.log(rt.TEXT,function(){return e.getDisplayText()});var t=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(t,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),this.logger.log(rt.INFO,"Rolling up")}else this.logger.log(rt.DEBUG,"roll_up but nrRollUpRows not set yet")},l.getDisplayText=function(e){e=e||!1;for(var t=[],r="",n=-1,s=0;s<mi;s++){var i=this.rows[s].getTextString();i&&(n=s+1,e?t.push("Row "+n+": '"+i+"'"):t.push(i.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join(`
`)),r},l.getTextAndFormat=function(){return this.rows},d}(),Ln=function(){function d(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new wr(r),this.nonDisplayedMemory=new wr(r),this.lastOutputScreen=new wr(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var l=d.prototype;return l.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},l.getHandler=function(){return this.outputFilter},l.setHandler=function(e){this.outputFilter=e},l.setPAC=function(e){this.writeScreen.setPAC(e)},l.setBkgData=function(e){this.writeScreen.setBkgData(e)},l.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(rt.INFO,function(){return"MODE="+e}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},l.insertChars=function(e){for(var t=this,r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(rt.INFO,function(){return n+": "+t.writeScreen.getDisplayText(!0)}),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(rt.TEXT,function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},l.ccRCL=function(){this.logger.log(rt.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},l.ccBS=function(){this.logger.log(rt.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},l.ccAOF=function(){},l.ccAON=function(){},l.ccDER=function(){this.logger.log(rt.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},l.ccRU=function(e){this.logger.log(rt.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},l.ccFON=function(){this.logger.log(rt.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},l.ccRDC=function(){this.logger.log(rt.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},l.ccTR=function(){this.logger.log(rt.INFO,"TR"),this.setMode("MODE_TEXT")},l.ccRTD=function(){this.logger.log(rt.INFO,"RTD"),this.setMode("MODE_TEXT")},l.ccEDM=function(){this.logger.log(rt.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},l.ccCR=function(){this.logger.log(rt.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},l.ccENM=function(){this.logger.log(rt.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},l.ccEOC=function(){var e=this;if(this.logger.log(rt.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(rt.TEXT,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},l.ccTO=function(e){this.logger.log(rt.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},l.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(rt.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},l.outputDataUpdate=function(e){e===void 0&&(e=!1);var t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},l.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},d}(),ca=function(){function d(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var n=new oa;this.channels=[null,new Ln(e,t,n),new Ln(e+1,r,n)],this.cmdHistory={a:null,b:null},this.logger=n}var l=d.prototype;return l.getHandler=function(e){return this.channels[e].getHandler()},l.setHandler=function(e,t){this.channels[e].setHandler(t)},l.addData=function(e,t){var r,n,s,i=!1;this.logger.time=e;for(var a=0;a<t.length;a+=2)if(n=127&t[a],s=127&t[a+1],n!==0||s!==0){if(this.logger.log(rt.DATA,"["+vi([t[a],t[a+1]])+"] -> ("+vi([n,s])+")"),(r=this.parseCmd(n,s))||(r=this.parseMidrow(n,s)),r||(r=this.parsePAC(n,s)),r||(r=this.parseBackgroundAttributes(n,s)),!r&&(i=this.parseChars(n,s))){var u=this.currentChannel;u&&u>0?this.channels[u].insertChars(i):this.logger.log(rt.WARNING,"No channel found yet. TEXT-MODE?")}r||i||this.logger.log(rt.WARNING,"Couldn't parse cleaned data "+vi([n,s])+" orig: "+vi([t[a],t[a+1]]))}},l.parseCmd=function(e,t){var r=this.cmdHistory;if(!((e===20||e===28||e===21||e===29)&&t>=32&&t<=47||(e===23||e===31)&&t>=33&&t<=35))return!1;if(Dn(e,t,r))return Ai(null,null,r),this.logger.log(rt.DEBUG,"Repeated command ("+vi([e,t])+") is dropped"),!0;var n=e===20||e===21||e===23?1:2,s=this.channels[n];return e===20||e===21||e===28||e===29?t===32?s.ccRCL():t===33?s.ccBS():t===34?s.ccAOF():t===35?s.ccAON():t===36?s.ccDER():t===37?s.ccRU(2):t===38?s.ccRU(3):t===39?s.ccRU(4):t===40?s.ccFON():t===41?s.ccRDC():t===42?s.ccTR():t===43?s.ccRTD():t===44?s.ccEDM():t===45?s.ccCR():t===46?s.ccENM():t===47&&s.ccEOC():s.ccTO(t-32),Ai(e,t,r),this.currentChannel=n,!0},l.parseMidrow=function(e,t){var r=0;if((e===17||e===25)&&t>=32&&t<=47){if((r=e===17?1:2)!==this.currentChannel)return this.logger.log(rt.ERROR,"Mismatch channel in midrow parsing"),!1;var n=this.channels[r];return!!n&&(n.ccMIDROW(t),this.logger.log(rt.DEBUG,"MIDROW ("+vi([e,t])+")"),!0)}return!1},l.parsePAC=function(e,t){var r,n=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(e===16||e===24)&&t>=64&&t<=95))return!1;if(Dn(e,t,n))return Ai(null,null,n),!0;var s=e<=23?1:2;r=t>=64&&t<=95?s===1?ia[e]:na[e]:s===1?ra[e]:sa[e];var i=this.channels[s];return!!i&&(i.setPAC(this.interpretPAC(r,t)),Ai(e,t,n),this.currentChannel=s,!0)},l.interpretPAC=function(e,t){var r,n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,n.underline=(1&r)==1,r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n},l.parseChars=function(e,t){var r,n,s=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19?(n=i===17?t+80:i===18?t+112:t+144,this.logger.log(rt.INFO,"Special char '"+An(n)+"' in channel "+r),s=[n]):e>=32&&e<=127&&(s=t===0?[e]:[e,t]),s){var a=vi(s);this.logger.log(rt.DEBUG,"Char codes =  "+a.join(",")),Ai(e,t,this.cmdHistory)}return s},l.parseBackgroundAttributes=function(e,t){var r;if(!((e===16||e===24)&&t>=32&&t<=47||(e===23||e===31)&&t>=45&&t<=47))return!1;var n={};e===16||e===24?(r=Math.floor((t-32)/2),n.background=aa[r],t%2==1&&(n.background=n.background+"_semi")):t===45?n.background="transparent":(n.foreground="black",t===47&&(n.underline=!0));var s=e<=23?1:2;return this.channels[s].setBkgData(n),Ai(e,t,this.cmdHistory),!0},l.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},l.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t];r&&r.cueSplitAtTime(e)}},d}();function Ai(d,l,e){e.a=d,e.b=l}function Dn(d,l,e){return e.a===d&&e.b===l}const In=ca;var zi=function(){function d(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var l=d.prototype;return l.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},l.newCue=function(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},l.reset=function(){this.cueRanges=[],this.startTime=null},d}();const Lr=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var d=["","lr","rl"],l=["start","middle","end","left","right"];function e(s,i){if(typeof i!="string"||!Array.isArray(s))return!1;var a=i.toLowerCase();return!!~s.indexOf(a)&&a}function t(s){return e(l,s)}function r(s){for(var i=arguments.length,a=new Array(i>1?i-1:0),u=1;u<i;u++)a[u-1]=arguments[u];for(var h=1;h<arguments.length;h++){var f=arguments[h];for(var m in f)s[m]=f[m]}return s}function n(s,i,a){var u=this,h={enumerable:!0};u.hasBeenReset=!1;var f="",m=!1,y=s,S=i,k=a,F=null,P="",K=!0,Z="auto",le="start",ne=50,he="middle",Re=50,Ge="middle";Object.defineProperty(u,"id",r({},h,{get:function(){return f},set:function(ue){f=""+ue}})),Object.defineProperty(u,"pauseOnExit",r({},h,{get:function(){return m},set:function(ue){m=!!ue}})),Object.defineProperty(u,"startTime",r({},h,{get:function(){return y},set:function(ue){if(typeof ue!="number")throw new TypeError("Start time must be set to a number.");y=ue,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",r({},h,{get:function(){return S},set:function(ue){if(typeof ue!="number")throw new TypeError("End time must be set to a number.");S=ue,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",r({},h,{get:function(){return k},set:function(ue){k=""+ue,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",r({},h,{get:function(){return F},set:function(ue){F=ue,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",r({},h,{get:function(){return P},set:function(ue){var Ie=function(Ae){return e(d,Ae)}(ue);if(Ie===!1)throw new SyntaxError("An invalid or illegal string was specified.");P=Ie,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",r({},h,{get:function(){return K},set:function(ue){K=!!ue,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",r({},h,{get:function(){return Z},set:function(ue){if(typeof ue!="number"&&ue!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");Z=ue,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",r({},h,{get:function(){return le},set:function(ue){var Ie=t(ue);if(!Ie)throw new SyntaxError("An invalid or illegal string was specified.");le=Ie,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",r({},h,{get:function(){return ne},set:function(ue){if(ue<0||ue>100)throw new Error("Position must be between 0 and 100.");ne=ue,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",r({},h,{get:function(){return he},set:function(ue){var Ie=t(ue);if(!Ie)throw new SyntaxError("An invalid or illegal string was specified.");he=Ie,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",r({},h,{get:function(){return Re},set:function(ue){if(ue<0||ue>100)throw new Error("Size must be between 0 and 100.");Re=ue,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",r({},h,{get:function(){return Ge},set:function(ue){var Ie=t(ue);if(!Ie)throw new SyntaxError("An invalid or illegal string was specified.");Ge=Ie,this.hasBeenReset=!0}})),u.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();var ha=function(){function d(){}return d.prototype.decode=function(l,e){if(!l)return"";if(typeof l!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(l))},d}();function Rn(d){function l(t,r,n,s){return 3600*(0|t)+60*(0|r)+(0|n)+parseFloat(s||0)}var e=d.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?l(e[2],e[3],0,e[4]):l(e[1],e[2],e[3],e[4]):null}var da=function(){function d(){this.values=Object.create(null)}var l=d.prototype;return l.set=function(e,t){this.get(e)||t===""||(this.values[e]=t)},l.get=function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},l.has=function(e){return e in this.values},l.alt=function(e,t,r){for(var n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}},l.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},l.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1},d}();function Cn(d,l,e,t){var r=t?d.split(t):[d];for(var n in r)if(typeof r[n]=="string"){var s=r[n].split(e);s.length===2&&l(s[0],s[1])}}var Dr=new Lr(0,0,""),Xi=Dr.align==="middle"?"middle":"center";function fa(d,l,e){var t=d;function r(){var s=Rn(d);if(s===null)throw new Error("Malformed timestamp: "+t);return d=d.replace(/^[^\sa-zA-Z-]+/,""),s}function n(){d=d.replace(/^\s+/,"")}if(n(),l.startTime=r(),n(),d.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);d=d.slice(3),n(),l.endTime=r(),n(),function(s,i){var a=new da;Cn(s,function(f,m){var y;switch(f){case"region":for(var S=e.length-1;S>=0;S--)if(e[S].id===m){a.set(f,e[S].region);break}break;case"vertical":a.alt(f,m,["rl","lr"]);break;case"line":y=m.split(","),a.integer(f,y[0]),a.percent(f,y[0])&&a.set("snapToLines",!1),a.alt(f,y[0],["auto"]),y.length===2&&a.alt("lineAlign",y[1],["start",Xi,"end"]);break;case"position":y=m.split(","),a.percent(f,y[0]),y.length===2&&a.alt("positionAlign",y[1],["start",Xi,"end","line-left","line-right","auto"]);break;case"size":a.percent(f,m);break;case"align":a.alt(f,m,["start",Xi,"end","left","right"])}},/:/,/\s/),i.region=a.get("region",null),i.vertical=a.get("vertical","");var u=a.get("line","auto");u==="auto"&&Dr.line===-1&&(u=-1),i.line=u,i.lineAlign=a.get("lineAlign","start"),i.snapToLines=a.get("snapToLines",!0),i.size=a.get("size",100),i.align=a.get("align",Xi);var h=a.get("position","auto");h==="auto"&&Dr.position===50&&(h=i.align==="start"||i.align==="left"?0:i.align==="end"||i.align==="right"?100:50),i.position=h}(d,l)}function _n(d){return d.replace(/<br(?: \/)?>/gi,`
`)}var ga=function(){function d(){this.state="INITIAL",this.buffer="",this.decoder=new ha,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var l=d.prototype;return l.parse=function(e){var t=this;function r(){var u=t.buffer,h=0;for(u=_n(u);h<u.length&&u[h]!=="\r"&&u[h]!==`
`;)++h;var f=u.slice(0,h);return u[h]==="\r"&&++h,u[h]===`
`&&++h,t.buffer=u.slice(h),f}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var s=(n=r()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var i=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(i?i=!1:n=r(),t.state){case"HEADER":/:/.test(n)?Cn(n,function(u,h){},/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new Lr(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{fa(n,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var a=n.indexOf("-->")!==-1;if(!n||a&&(i=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},l.flush=function(){var e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},d}(),Pn=R(673),pa=R(524),ma=/\r\n|\n\r|\n|\r/g,Ir=function(d,l,e){return e===void 0&&(e=0),d.slice(e,e+l.length)===l},Rr=function(d){for(var l=5381,e=d.length;e;)l=33*l^d.charCodeAt(--e);return(l>>>0).toString()};function Cr(d,l,e){return Rr(d.toString())+Rr(l.toString())+Rr(e)}function _r(){return _r=Object.assign?Object.assign.bind():function(d){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(d[t]=e[t])}return d},_r.apply(this,arguments)}var Pr="stpp.ttml.im1t",On=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,xn=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,va={left:"start",center:"center",right:"end",start:"start",end:"end"};function Fn(d,l,e,t,r){var n=(0,me.findBox)(new Uint8Array(d),["mdat"]);if(n.length!==0){var s=n.map(function(a){return(0,gt.utf8ArrayToStr)(a)}),i=(0,Pn.toTimescaleFromScale)(l,1,e);try{s.forEach(function(a){return t(function(u,h){var f=new DOMParser().parseFromString(u,"text/xml").getElementsByTagName("tt")[0];if(!f)throw new Error("Invalid ttml");var m={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},y=Object.keys(m).reduce(function(K,Z){return K[Z]=f.getAttribute("ttp:"+Z)||m[Z],K},{}),S=f.getAttribute("xml:space")!=="preserve",k=Mn(Or(f,"styling","style")),F=Mn(Or(f,"layout","region")),P=Or(f,"body","[begin]");return[].map.call(P,function(K){var Z=Nn(K,S);if(!Z||!K.hasAttribute("begin"))return null;var le=Fr(K.getAttribute("begin"),y),ne=Fr(K.getAttribute("dur"),y),he=Fr(K.getAttribute("end"),y);if(le===null)throw Un(K);if(he===null){if(ne===null)throw Un(K);he=le+ne}var Re=new Lr(le-h,he-h,Z);Re.id=Cr(Re.startTime,Re.endTime,Re.text);var Ge=function(Ae,Xe,vt){var Je="http://www.w3.org/ns/ttml#styling",tt=null,lt=Ae!=null&&Ae.hasAttribute("style")?Ae.getAttribute("style"):null;return lt&&vt.hasOwnProperty(lt)&&(tt=vt[lt]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(Pt,Rt){var kt=xr(Xe,Je,Rt)||xr(Ae,Je,Rt)||xr(tt,Je,Rt);return kt&&(Pt[Rt]=kt),Pt},{})}(F[K.getAttribute("region")],k[K.getAttribute("style")],k),ue=Ge.textAlign;if(ue){var Ie=va[ue];Ie&&(Re.lineAlign=Ie),Re.align=ue}return _r(Re,Ge),Re}).filter(function(K){return K!==null})}(a,i))})}catch(a){r(a)}}else r(new Error("Could not parse IMSC1 mdat"))}function Or(d,l,e){var t=d.getElementsByTagName(l)[0];return t?[].slice.call(t.querySelectorAll(e)):[]}function Mn(d){return d.reduce(function(l,e){var t=e.getAttribute("xml:id");return t&&(l[t]=e),l},{})}function Nn(d,l){return[].slice.call(d.childNodes).reduce(function(e,t,r){var n;return t.nodeName==="br"&&r?e+`
`:(n=t.childNodes)!==null&&n!==void 0&&n.length?Nn(t,l):l?e+t.textContent.trim().replace(/\s+/g," "):e+t.textContent},"")}function xr(d,l,e){return d&&d.hasAttributeNS(l,e)?d.getAttributeNS(l,e):null}function Un(d){return new Error("Could not parse ttml timestamp "+d)}function Fr(d,l){if(!d)return null;var e=Rn(d);return e===null&&(On.test(d)?e=function(t,r){var n=On.exec(t),s=(0|n[4])+(0|n[5])/r.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+s/r.frameRate}(d,l):xn.test(d)&&(e=function(t,r){var n=xn.exec(t),s=Number(n[1]);switch(n[2]){case"h":return 3600*s;case"m":return 60*s;case"ms":return 1e3*s;case"f":return s/r.frameRate;case"t":return s/r.tickRate}return s}(d,l))),e}var ya=function(){function d(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new zi(this,"textTrack1"),r=new zi(this,"textTrack2"),n=new zi(this,"textTrack3"),s=new zi(this,"textTrack4");this.cea608Parser1=new In(1,t,r),this.cea608Parser2=new In(3,n,s)}e.on(p.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(p.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(p.Events.FRAG_LOADING,this.onFragLoading,this),e.on(p.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(p.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(p.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(p.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(p.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var l=d.prototype;return l.destroy=function(){var e=this.hls;e.off(p.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(p.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(p.Events.FRAG_LOADING,this.onFragLoading,this),e.off(p.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(p.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(p.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(p.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(p.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},l.addCues=function(e,t,r,n,s){for(var i,a,u,h,f=!1,m=s.length;m--;){var y=s[m],S=(i=y[0],a=y[1],u=t,h=r,Math.min(a,h)-Math.max(i,u));if(S>=0&&(y[0]=Math.min(y[0],t),y[1]=Math.max(y[1],r),f=!0,S/(r-t)>.5))return}if(f||s.push([t,r]),this.config.renderTextTracksNatively){var k=this.captionsTracks[e];this.Cues.newCue(k,t,r,n)}else{var F=this.Cues.newCue(null,t,r,n);this.hls.trigger(p.Events.CUES_PARSED,{type:"captions",cues:F,track:e})}},l.onInitPtsFound=function(e,t){var r=this,n=t.frag,s=t.id,i=t.initPTS,a=t.timescale,u=this.unparsedVttFrags;s==="main"&&(this.initPTS[n.cc]=i,this.timescale[n.cc]=a),u.length&&(this.unparsedVttFrags=[],u.forEach(function(h){r.onFragLoaded(p.Events.FRAG_LOADED,h)}))},l.getExistingTrack=function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var n=t.textTracks[r];if(n[e])return n}return null},l.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},l.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,r=this.captionsTracks,n=this.media,s=t[e],i=s.label,a=s.languageCode,u=this.getExistingTrack(e);if(u)r[e]=u,et(r[e]),Ve(r[e],n);else{var h=this.createTextTrack("captions",i,a);h&&(h[e]=!0,r[e]=h)}}},l.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(p.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},l.createTextTrack=function(e,t,r){var n=this.media;if(n)return n.addTextTrack(e,t,r)},l.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},l.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){et(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},l.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},l._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)et(t[r])}},l.onSubtitleTracksUpdated=function(e,t){var r=this;this.textTracks=[];var n=t.subtitleTracks||[],s=n.some(function(h){return h.textCodec===Pr});if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var i=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var a=this.media?this.media.textTracks:[];this.tracks.forEach(function(h,f){var m;if(f<a.length){for(var y=null,S=0;S<a.length;S++)if(Ea(a[S],h)){y=a[S];break}y&&(m=y)}if(m)et(m);else{var k=r._captionsOrSubtitlesFromCharacteristics(h);(m=r.createTextTrack(k,h.name,h.lang))&&(m.mode="disabled")}m&&(m.groupId=h.groupId,r.textTracks.push(m))})}else if(!i&&this.tracks&&this.tracks.length){var u=this.tracks.map(function(h){return{label:h.name,kind:h.type.toLowerCase(),default:h.default,subtitleTrack:h}});this.hls.trigger(p.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}},l._captionsOrSubtitlesFromCharacteristics=function(e){var t;if((t=e.attrs)!==null&&t!==void 0&&t.CHARACTERISTICS){var r=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),n=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(r&&n)return"captions"}return"subtitles"},l.onManifestLoaded=function(e,t){var r=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(n){var s=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(s){var i="textTrack"+s[1],a=r.captionsProperties[i];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)}})},l.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]},l.onFragLoading=function(e,t){var r=this.cea608Parser1,n=this.cea608Parser2,s=this.lastSn,i=this.lastPartIndex;if(this.enabled&&r&&n&&t.frag.type===oe.PlaylistLevelType.MAIN){var a,u,h=t.frag.sn,f=(a=t==null||(u=t.part)===null||u===void 0?void 0:u.index)!=null?a:-1;h===s+1||h===s&&f===i+1||(r.reset(),n.reset()),this.lastSn=h,this.lastPartIndex=f}},l.onFragLoaded=function(e,t){var r=t.frag,n=t.payload,s=this.initPTS,i=this.unparsedVttFrags;if(r.type===oe.PlaylistLevelType.SUBTITLE)if(n.byteLength){if(!(0,N.isFiniteNumber)(s[r.cc]))return i.push(t),void(s.length&&this.hls.trigger(p.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));var a=r.decryptdata,u="stats"in t;if(a==null||!a.encrypted||u){var h=this.tracks[r.level],f=this.vttCCs;f[r.cc]||(f[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),h&&h.textCodec===Pr?this._parseIMSC1(r,n):this._parseVTTs(r,n,f)}}else this.hls.trigger(p.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},l._parseIMSC1=function(e,t){var r=this,n=this.hls;Fn(t,this.initPTS[e.cc],this.timescale[e.cc],function(s){r._appendCues(s,e.level),n.trigger(p.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(s){_.logger.log("Failed to parse IMSC1: "+s),n.trigger(p.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})},l._parseVTTs=function(e,t,r){var n,s=this,i=this.hls;(function(a,u,h,f,m,y,S,k){var F,P=new ga,K=(0,gt.utf8ArrayToStr)(new Uint8Array(a)).trim().replace(ma,`
`).split(`
`),Z=[],le=(0,Pn.toMpegTsClockFromTimescale)(u,h),ne="00:00.000",he=0,Re=0,Ge=!0;P.oncue=function(ue){var Ie=f[m],Ae=f.ccOffset,Xe=(he-le)/9e4;Ie!=null&&Ie.new&&(Re!==void 0?Ae=f.ccOffset=Ie.start:function(lt,Pt,Rt){var kt=lt[Pt],Ot=lt[kt.prevCC];if(!Ot||!Ot.new&&kt.new)return lt.ccOffset=lt.presentationOffset=kt.start,void(kt.new=!1);for(;(Vt=Ot)!==null&&Vt!==void 0&&Vt.new;){var Vt;lt.ccOffset+=kt.start-Ot.start,kt.new=!1,Ot=lt[(kt=Ot).prevCC]}lt.presentationOffset=Rt}(f,m,Xe)),Xe&&(Ae=Xe-f.presentationOffset);var vt=ue.endTime-ue.startTime,Je=(0,pa.normalizePts)(9e4*(ue.startTime+Ae-Re),9e4*y)/9e4;ue.startTime=Math.max(Je,0),ue.endTime=Math.max(Je+vt,0);var tt=ue.text.trim();ue.text=decodeURIComponent(encodeURIComponent(tt)),ue.id||(ue.id=Cr(ue.startTime,ue.endTime,tt)),ue.endTime>0&&Z.push(ue)},P.onparsingerror=function(ue){F=ue},P.onflush=function(){F?k(F):S(Z)},K.forEach(function(ue){if(Ge){if(Ir(ue,"X-TIMESTAMP-MAP=")){Ge=!1,ue.slice(16).split(",").forEach(function(Ie){Ir(Ie,"LOCAL:")?ne=Ie.slice(6):Ir(Ie,"MPEGTS:")&&(he=parseInt(Ie.slice(7)))});try{Re=function(Ie){var Ae=parseInt(Ie.slice(-3)),Xe=parseInt(Ie.slice(-6,-4)),vt=parseInt(Ie.slice(-9,-7)),Je=Ie.length>9?parseInt(Ie.substring(0,Ie.indexOf(":"))):0;if(!((0,N.isFiniteNumber)(Ae)&&(0,N.isFiniteNumber)(Xe)&&(0,N.isFiniteNumber)(vt)&&(0,N.isFiniteNumber)(Je)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+Ie);return Ae+=1e3*Xe,(Ae+=6e4*vt)+36e5*Je}(ne)/1e3}catch(Ie){F=Ie}return}ue===""&&(Ge=!1)}P.parse(ue+`
`)}),P.flush()})((n=e.initSegment)!==null&&n!==void 0&&n.data?(0,me.appendUint8Array)(e.initSegment.data,new Uint8Array(t)):t,this.initPTS[e.cc],this.timescale[e.cc],r,e.cc,e.start,function(a){s._appendCues(a,e.level),i.trigger(p.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(a){s._fallbackToIMSC1(e,t),_.logger.log("Failed to parse VTT cue: "+a),i.trigger(p.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})},l._fallbackToIMSC1=function(e,t){var r=this,n=this.tracks[e.level];n.textCodec||Fn(t,this.initPTS[e.cc],this.timescale[e.cc],function(){n.textCodec=Pr,r._parseIMSC1(e,t)},function(){n.textCodec="wvtt"})},l._appendCues=function(e,t){var r=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(function(a){return st(n,a)})}else{var s=this.tracks[t];if(!s)return;var i=s.default?"default":"subtitles"+t;r.trigger(p.Events.CUES_PARSED,{type:"subtitles",cues:e,track:i})}},l.onFragDecrypted=function(e,t){var r=t.frag;if(r.type===oe.PlaylistLevelType.SUBTITLE){if(!(0,N.isFiniteNumber)(this.initPTS[r.cc]))return void this.unparsedVttFrags.push(t);this.onFragLoaded(p.Events.FRAG_LOADED,t)}},l.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},l.onFragParsingUserdata=function(e,t){var r=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&r&&n){var s=t.frag,i=t.samples;if(s.type!==oe.PlaylistLevelType.MAIN||this.closedCaptionsForLevel(s)!=="NONE")for(var a=0;a<i.length;a++){var u=i[a].bytes;if(u){var h=this.extractCea608Data(u);r.addData(i[a].pts,h[0]),n.addData(i[a].pts,h[1])}}}},l.onBufferFlushing=function(e,t){var r=t.startOffset,n=t.endOffset,s=t.endOffsetSubtitles,i=t.type,a=this.media;if(a&&!(a.currentTime<n)){if(!i||i==="video"){var u=this.captionsTracks;Object.keys(u).forEach(function(f){return yt(u[f],r,n)})}if(this.config.renderTextTracksNatively&&r===0&&s!==void 0){var h=this.textTracks;Object.keys(h).forEach(function(f){return yt(h[f],r,s)})}}},l.extractCea608Data=function(e){for(var t=[[],[]],r=31&e[0],n=2,s=0;s<r;s++){var i=e[n++],a=127&e[n++],u=127&e[n++];if((a!==0||u!==0)&&4&i){var h=3&i;h!==0&&h!==1||(t[h].push(a),t[h].push(u))}}return t},d}();function Ea(d,l){return d&&d.label===l.name&&!(d.textTrack1||d.textTrack2)}function ba(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}const Ta=function(){function d(r){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=r,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var l,e,t=d.prototype;return t.setStreamController=function(r){this.streamController=r},t.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function(){var r=this.hls;r.on(p.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.on(p.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(p.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function(){var r=this.hls;r.off(p.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.off(p.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(p.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function(r,n){d.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)},t.onMediaAttaching=function(r,n){this.media=n.media instanceof HTMLVideoElement?n.media:null,this.clientRect=null},t.onManifestParsed=function(r,n){var s=this.hls;this.restrictedLevels=[],this.firstLevel=n.firstLevel,s.config.capLevelToPlayerSize&&n.video&&this.startCapping()},t.onBufferCodecs=function(r,n){this.hls.config.capLevelToPlayerSize&&n.video&&this.startCapping()},t.onMediaDetaching=function(){this.stopCapping()},t.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var r=this.hls.levels;if(r.length){var n=this.hls;n.autoLevelCapping=this.getMaxLevel(r.length-1),n.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=n.autoLevelCapping}}},t.getMaxLevel=function(r){var n=this,s=this.hls.levels;if(!s.length)return-1;var i=s.filter(function(a,u){return d.isLevelAllowed(u,n.restrictedLevels)&&u<=r});return this.clientRect=null,d.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},t.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function(){if(this.clientRect)return this.clientRect;var r=this.media,n={width:0,height:0};if(r){var s=r.getBoundingClientRect();n.width=s.width,n.height=s.height,n.width||n.height||(n.width=s.right-s.left||r.width||0,n.height=s.bottom-s.top||r.height||0)}return this.clientRect=n,n},d.isLevelAllowed=function(r,n){return n===void 0&&(n=[]),n.indexOf(r)===-1},d.getMaxLevelByMediaSize=function(r,n,s){if(!r||!r.length)return-1;for(var i,a,u=r.length-1,h=0;h<r.length;h+=1){var f=r[h];if((f.width>=n||f.height>=s)&&(i=f,!(a=r[h+1])||i.width!==a.width||i.height!==a.height)){u=h;break}}return u},l=d,(e=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var r=1;if(!this.hls.config.ignoreDevicePixelRatio)try{r=self.devicePixelRatio}catch{}return r}}])&&ba(l.prototype,e),Object.defineProperty(l,"prototype",{writable:!1}),d}(),Sa=function(){function d(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var l=d.prototype;return l.setStreamController=function(e){this.streamController=e},l.registerListeners=function(){this.hls.on(p.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},l.unregisterListeners=function(){this.hls.off(p.Events.MEDIA_ATTACHING,this.onMediaAttaching)},l.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},l.onMediaAttaching=function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},l.checkFPS=function(e,t,r){var n=performance.now();if(t){if(this.lastTime){var s=n-this.lastTime,i=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,u=1e3*i/s,h=this.hls;if(h.trigger(p.Events.FPS_DROP,{currentDropped:i,currentDecoded:a,totalDroppedFrames:r}),u>0&&i>h.config.fpsDroppedMonitoringThreshold*a){var f=h.currentLevel;_.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(h.autoLevelCapping===-1||h.autoLevelCapping>=f)&&(f-=1,h.trigger(p.Events.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:h.currentLevel}),h.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},l.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},d}();var yi=R(300);function Mr(d){var l=typeof Map=="function"?new Map:void 0;return Mr=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(e))return l.get(e);l.set(e,r)}function r(){return Nr(e,arguments,Ur(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Oi(r,e)},Mr(d)}function Nr(d,l,e){return Nr=ka()?Reflect.construct.bind():function(t,r,n){var s=[null];s.push.apply(s,r);var i=new(Function.bind.apply(t,s));return n&&Oi(i,n.prototype),i},Nr.apply(null,arguments)}function ka(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Oi(d,l){return Oi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Oi(d,l)}function Ur(d){return Ur=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},Ur(d)}var Qi="[eme]",Bn=function(){function d(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=d.CDMCleanupPromise?[d.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=_.logger.debug.bind(_.logger,Qi),this.log=_.logger.log.bind(_.logger,Qi),this.warn=_.logger.warn.bind(_.logger,Qi),this.error=_.logger.error.bind(_.logger,Qi),this.hls=e,this.config=e.config,this.registerListeners()}var l=d.prototype;return l.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},l.registerListeners=function(){this.hls.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(p.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(p.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},l.unregisterListeners=function(){this.hls.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(p.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(p.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},l.getLicenseServerUrl=function(e){var t=this.config,r=t.drmSystems,n=t.widevineLicenseUrl,s=r[e];if(s)return s.licenseUrl;if(e===$.WIDEVINE&&n)return n;throw new Error('no license server URL configured for key-system "'+e+'"')},l.getServerCertificateUrl=function(e){var t=this.config.drmSystems[e];if(t)return t.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},l.attemptKeySystemAccess=function(e){var t=this,r=this.hls.levels,n=function(a,u,h){return!!a&&h.indexOf(a)===u},s=r.map(function(a){return a.audioCodec}).filter(n),i=r.map(function(a){return a.videoCodec}).filter(n);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise(function(a,u){(function h(f){var m=f.shift();t.getMediaKeysPromise(m,s,i).then(function(y){return a({keySystem:m,mediaKeys:y})}).catch(function(y){f.length?h(f):u(y instanceof zt?y:new zt({type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:y,fatal:!0},y.message))})})(e)})},l.requestMediaKeySystemAccess=function(e,t){var r=this.config.requestMediaKeySystemAccessFunc;if(typeof r!="function"){var n="Configured requestMediaKeySystemAccess is not a function "+r;return ye===null&&self.location.protocol==="http:"&&(n="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(n))}return r(e,t)},l.getMediaKeysPromise=function(e,t,r){var n=this,s=function(h,f,m,y){var S;switch(h){case $.FAIRPLAY:S=["cenc","sinf"];break;case $.WIDEVINE:case $.PLAYREADY:S=["cenc"];break;case $.CLEARKEY:S=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+h)}return function(k,F,P,K){return[{initDataTypes:k,persistentState:K.persistentState||"not-allowed",distinctiveIdentifier:K.distinctiveIdentifier||"not-allowed",sessionTypes:K.sessionTypes||[K.sessionType||"temporary"],audioCapabilities:F.map(function(Z){return{contentType:'audio/mp4; codecs="'+Z+'"',robustness:K.audioRobustness||"",encryptionScheme:K.audioEncryptionScheme||null}}),videoCapabilities:P.map(function(Z){return{contentType:'video/mp4; codecs="'+Z+'"',robustness:K.videoRobustness||"",encryptionScheme:K.videoEncryptionScheme||null}})}]}(S,f,m,y)}(e,t,r,this.config.drmSystemOptions),i=this.keySystemAccessPromises[e],a=i==null?void 0:i.keySystemAccess;if(!a){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(s)),a=this.requestMediaKeySystemAccess(e,s);var u=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(function(h){n.log('Failed to obtain access to key-system "'+e+'": '+h)}),a.then(function(h){n.log('Access for key-system "'+h.keySystem+'" obtained');var f=n.fetchServerCertificate(e);return n.log('Create media-keys for "'+e+'"'),u.mediaKeys=h.createMediaKeys().then(function(m){return n.log('Media-keys created for "'+e+'"'),f.then(function(y){return y?n.setMediaKeysServerCertificate(m,e,y):m})}),u.mediaKeys.catch(function(m){n.error('Failed to create media-keys for "'+e+'"}: '+m)}),u.mediaKeys})}return a.then(function(){return i.mediaKeys})},l.createMediaKeySessionContext=function(e){var t=e.decryptdata,r=e.keySystem,n=e.mediaKeys;this.log('Creating key-system session "'+r+'" keyId: '+yi.default.hexDump(t.keyId||[]));var s=n.createSession(),i={decryptdata:t,keySystem:r,mediaKeys:n,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i},l.renewKeySession=function(e){var t=e.decryptdata;if(t.pssh){var r=this.createMediaKeySessionContext(e),n=this.getKeyIdString(t);this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(r,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},l.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return yi.default.hexDump(e.keyId)},l.updateKeySession=function(e,t){var r,n=e.mediaKeysSession;return this.log('Updating key-session "'+n.sessionId+'" for keyID '+yi.default.hexDump(((r=e.decryptdata)===null||r===void 0?void 0:r.keyId)||[])+`
      } (data length: `+(t&&t.byteLength)+")"),n.update(t)},l.selectKeySystemFormat=function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise},l.getKeyFormatPromise=function(e){var t=this;return new Promise(function(r,n){var s=se(t.config),i=e.map(G).filter(function(a){return!!a&&s.indexOf(a)!==-1});return t.getKeySystemSelectionPromise(i).then(function(a){var u=a.keySystem,h=O(u);h?r(h):n(new Error('Unable to find format for key-system "'+u+'"'))}).catch(n)})},l.loadKey=function(e){var t=this,r=e.keyInfo.decryptdata,n=this.getKeyIdString(r),s="(keyId: "+n+' format: "'+r.keyFormat+'" method: '+r.method+" uri: "+r.uri+")";this.log("Starting session for key "+s);var i=this.keyIdToKeySessionPromise[n];return i||(i=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(r).then(function(a){var u=a.keySystem,h=a.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+s),t.attemptSetMediaKeys(u,h).then(function(){t.throwIfDestroyed();var f=t.createMediaKeySessionContext({keySystem:u,mediaKeys:h,decryptdata:r});return t.generateRequestWithPreferredKeySession(f,"cenc",r.pssh,"playlist-key")})})).catch(function(a){return t.handleError(a)}),i},l.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},l.handleError=function(e){this.hls&&(this.error(e.message),e instanceof zt?this.hls.trigger(p.Events.ERROR,e.data):this.hls.trigger(p.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},l.getKeySystemForKeyPromise=function(e){var t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){var n=G(e.keyFormat),s=n?[n]:se(this.config);return this.attemptKeySystemAccess(s)}return r},l.getKeySystemSelectionPromise=function(e){if(e.length||(e=se(this.config)),e.length===0)throw new zt({type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},l._onMediaEncrypted=function(e){var t=this,r=e.initDataType,n=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+r+'"'),n!==null){var s,i;if(r==="sinf"&&this.config.drmSystems[$.FAIRPLAY]){var a=(0,me.bin2str)(new Uint8Array(n));try{var u=J(JSON.parse(a).sinf),h=(0,me.parseSinf)(new Uint8Array(u));if(!h)return;s=h.subarray(8,24),i=$.FAIRPLAY}catch{return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var f=(0,me.parsePssh)(n);if(f===null)return;f.version===0&&f.systemId===be.WIDEVINE&&f.data&&(s=f.data.subarray(8,24)),i=function(Z){if(Z===be.WIDEVINE)return $.WIDEVINE}(f.systemId)}if(i&&s){for(var m=yi.default.hexDump(s),y=this.keyIdToKeySessionPromise,S=this.mediaKeySessions,k=y[m],F=function(Z){var le=S[Z],ne=le.decryptdata;if(ne.pssh||!ne.keyId)return"continue";var he=yi.default.hexDump(ne.keyId);return m===he||ne.uri.replace(/-/g,"").indexOf(m)!==-1?(k=y[he],delete y[he],ne.pssh=new Uint8Array(n),ne.keyId=s,k=y[m]=k.then(function(){return t.generateRequestWithPreferredKeySession(le,r,n,"encrypted-event-key-match")}),"break"):void 0},P=0;P<S.length;P++){var K=F(P);if(K!=="continue"&&K==="break")break}k||(k=y[m]=this.getKeySystemSelectionPromise([i]).then(function(Z){var le,ne=Z.keySystem,he=Z.mediaKeys;t.throwIfDestroyed();var Re=new Pe("ISO-23001-7",m,(le=O(ne))!=null?le:"");return Re.pssh=new Uint8Array(n),Re.keyId=s,t.attemptSetMediaKeys(ne,he).then(function(){t.throwIfDestroyed();var Ge=t.createMediaKeySessionContext({decryptdata:Re,keySystem:ne,mediaKeys:he});return t.generateRequestWithPreferredKeySession(Ge,r,n,"encrypted-event-no-match")})})),k.catch(function(Z){return t.handleError(Z)})}}},l._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},l.attemptSetMediaKeys=function(e,t){var r=this,n=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var s=Promise.all(n).then(function(){if(!r.media)throw new Error("Attempted to set mediaKeys without media element attached");return r.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(s),s.then(function(){r.log('Media-keys set for "'+e+'"'),n.push(s),r.setMediaKeysQueue=r.setMediaKeysQueue.filter(function(i){return n.indexOf(i)===-1})})},l.generateRequestWithPreferredKeySession=function(e,t,r,n){var s,i,a=this,u=(s=this.config.drmSystems)===null||s===void 0||(i=s[e.keySystem])===null||i===void 0?void 0:i.generateRequest;if(u)try{var h=u.call(this.hls,t,r,e);if(!h)throw new Error("Invalid response from configured generateRequest filter");t=h.initDataType,r=e.decryptdata.pssh=h.initData?new Uint8Array(h.initData):null}catch(k){var f;if(this.warn(k.message),(f=this.hls)!==null&&f!==void 0&&f.config.debug)throw k}if(r===null)return this.log('Skipping key-session request for "'+n+'" (no initData)'),Promise.resolve(e);var m=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+n+'": '+m+" (init data type: "+t+" length: "+(r?r.byteLength:null)+")");var y=new(Us());e.mediaKeysSession.onmessage=function(k){var F=e.mediaKeysSession;if(F){var P=k.messageType,K=k.message;a.log('"'+P+'" message event for session "'+F.sessionId+'" message size: '+K.byteLength),P==="license-request"||P==="license-renewal"?a.renewLicense(e,K).catch(function(Z){a.handleError(Z),y.emit("error",Z)}):P==="license-release"?e.keySystem===$.FAIRPLAY&&(a.updateKeySession(e,A("acknowledged")),a.removeSession(e)):a.warn('unhandled media key message type "'+P+'"')}else y.emit("error",new Error("invalid state"))},e.mediaKeysSession.onkeystatuseschange=function(k){if(e.mediaKeysSession){a.onKeyStatusChange(e);var F=e.keyStatus;y.emit("keyStatus",F),F==="expired"&&(a.warn(e.keySystem+" expired for key "+m),a.renewKeySession(e))}else y.emit("error",new Error("invalid state"))};var S=new Promise(function(k,F){y.on("error",F),y.on("keyStatus",function(P){P.startsWith("usable")?k():P==="output-restricted"?F(new zt({type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):P==="internal-error"?F(new zt({type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+P+'"')):P==="expired"?F(new Error("key expired while generating request")):a.warn('unhandled key status change "'+P+'"')})});return e.mediaKeysSession.generateRequest(t,r).then(function(){var k;a.log('Request generated for key-session "'+((k=e.mediaKeysSession)===null||k===void 0?void 0:k.sessionId)+'" keyId: '+m)}).catch(function(k){throw new zt({type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:k,fatal:!1},"Error generating key-session request: "+k)}).then(function(){return S}).catch(function(k){throw y.removeAllListeners(),a.removeSession(e),k}).then(function(){return y.removeAllListeners(),e})},l.onKeyStatusChange=function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach(function(r,n){t.log('key status change "'+r+'" for keyStatuses keyId: '+yi.default.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))+" session keyId: "+yi.default.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=r})},l.fetchServerCertificate=function(e){var t=this;return new Promise(function(r,n){var s=t.getServerCertificateUrl(e);if(!s)return r();t.log('Fetching serverCertificate for "'+e+'"');var i=new XMLHttpRequest;i.open("GET",s,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(i.status===200?r(i.response):n(new zt({type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i},'"'+e+'" certificate request XHR failed ('+s+"). Status: "+i.status+" ("+i.statusText+")")))},i.send()})},l.setMediaKeysServerCertificate=function(e,t,r){var n=this;return new Promise(function(s,i){e.setServerCertificate(r).then(function(a){n.log("setServerCertificate "+(a?"success":"not supported by CDM")+" ("+(r==null?void 0:r.byteLength)+') on "'+t+'"'),s(e)}).catch(function(a){i(new zt({type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})},l.renewLicense=function(e,t){var r=this;return this.requestLicense(e,new Uint8Array(t)).then(function(n){return r.updateKeySession(e,new Uint8Array(n)).catch(function(s){throw new zt({type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)})})},l.setupLicenseXHR=function(e,t,r,n){var s=this,i=this.config.licenseXhrSetup;return i?Promise.resolve().then(function(){if(!r.decryptdata)throw new Error("Key removed");return i.call(s.hls,e,t,r,n)}).catch(function(a){if(!r.decryptdata)throw a;return e.open("POST",t,!0),i.call(s.hls,e,t,r,n)}).then(function(a){return e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||n}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))},l.requestLicense=function(e,t){var r=this;return new Promise(function(n,s){var i=r.getLicenseServerUrl(e.keySystem);r.log("Sending license request to URL: "+i);var a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=function(){if(!r.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(a.readyState===4)if(a.status===200){r._requestLicenseFailureCount=0;var u=a.response;r.log("License received "+(u instanceof ArrayBuffer?u.byteLength:u));var h=r.config.licenseResponseCallback;if(h)try{u=h.call(r.hls,a,i,e)}catch(m){r.error(m)}n(u)}else if(r._requestLicenseFailureCount++,r._requestLicenseFailureCount>3||a.status>=400&&a.status<500)s(new zt({type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a},"License Request XHR failed ("+i+"). Status: "+a.status+" ("+a.statusText+")"));else{var f=3-r._requestLicenseFailureCount+1;r.warn("Retrying license request, "+f+" attempts left"),r.requestLicense(e,t).then(n,s)}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,r.setupLicenseXHR(a,i,e,t).then(function(u){var h=u.xhr,f=u.licenseChallenge;h.send(f)})})},l.onMediaAttached=function(e,t){if(this.config.emeEnabled){var r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}},l.onMediaDetached=function(){var e=this,t=this.media,r=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Pe.clearKeyUriToKeyIdMap();var n=r.length;d.CDMCleanupPromise=Promise.all(r.map(function(s){return e.removeSession(s)}).concat(t==null?void 0:t.setMediaKeys(null).catch(function(s){e.log("Could not clear media keys: "+s+". media.src: "+(t==null?void 0:t.src))}))).then(function(){n&&(e.log("finished closing key sessions and clearing media keys"),r.length=0)}).catch(function(s){e.log("Could not close sessions and clear media keys: "+s+". media.src: "+(t==null?void 0:t.src))})},l.onManifestLoaded=function(e,t){var r=t.sessionKeys;if(r&&this.config.emeEnabled&&!this.keyFormatPromise){var n=r.reduce(function(s,i){return s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s},[]);this.log("Selecting key-system from session-keys "+n.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(n)}},l.removeSession=function(e){var t=this,r=e.mediaKeysSession,n=e.licenseXhr;if(r){this.log("Remove licenses and keys and close session "+r.sessionId),r.onmessage=null,r.onkeystatuseschange=null,n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var s=this.mediaKeySessions.indexOf(e);return s>-1&&this.mediaKeySessions.splice(s,1),r.remove().catch(function(i){t.log("Could not remove session: "+i)}).then(function(){return r.close()}).catch(function(i){t.log("Could not close session: "+i)})}},d}();Bn.CDMCleanupPromise=void 0;var zt=function(d){var l,e;function t(r,n){var s;return(s=d.call(this,n)||this).data=void 0,s.data=r,r.err=r.error,s}return e=d,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,Oi(l,e),t}(Mr(Error));const Aa=Bn;var Kt,Br,Kn;function Gn(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}function jn(d,l,e){return l&&Gn(d.prototype,l),e&&Gn(d,e),Object.defineProperty(d,"prototype",{writable:!1}),d}function Hn(d,l){var e=typeof Symbol<"u"&&d[Symbol.iterator]||d["@@iterator"];if(e)return(e=e.call(d)).next.bind(e);if(Array.isArray(d)||(e=function(r,n){if(r){if(typeof r=="string")return Vn(r,n);var s=Object.prototype.toString.call(r).slice(8,-1);return s==="Object"&&r.constructor&&(s=r.constructor.name),s==="Map"||s==="Set"?Array.from(r):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?Vn(r,n):void 0}}(d))||l&&d&&typeof d.length=="number"){e&&(d=e);var t=0;return function(){return t>=d.length?{done:!0}:{done:!1,value:d[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vn(d,l){(l==null||l>d.length)&&(l=d.length);for(var e=0,t=new Array(l);e<l;e++)t[e]=d[e];return t}function Ji(){return Ji=Object.assign?Object.assign.bind():function(d){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(d[t]=e[t])}return d},Ji.apply(this,arguments)}(function(d){d.MANIFEST="m",d.AUDIO="a",d.VIDEO="v",d.MUXED="av",d.INIT="i",d.CAPTION="c",d.TIMED_TEXT="tt",d.KEY="k",d.OTHER="o"})(Kt||(Kt={})),function(d){d.DASH="d",d.HLS="h",d.SMOOTH="s",d.OTHER="o"}(Br||(Br={})),function(d){d.VOD="v",d.LIVE="l"}(Kn||(Kn={}));var wa=function(){function d(e){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(s){try{t.apply(s,{ot:Kt.MANIFEST,su:!t.initialized})}catch(i){_.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=function(s){try{var i=s.frag,a=t.hls.levels[i.level],u=t.getObjectType(i),h={d:1e3*i.duration,ot:u};u!==Kt.VIDEO&&u!==Kt.AUDIO&&u!=Kt.MUXED||(h.br=a.bitrate/1e3,h.tb=t.getTopBandwidth(u)/1e3,h.bl=t.getBufferLength(u)),t.apply(s,h)}catch(f){_.logger.warn("Could not generate segment CMCD data.",f)}},this.hls=e;var r=this.config=e.config,n=r.cmcd;n!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||d.uuid(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.registerListeners())}var l=d.prototype;return l.registerListeners=function(){var e=this.hls;e.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(p.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(p.Events.BUFFER_CREATED,this.onBufferCreated,this)},l.unregisterListeners=function(){var e=this.hls;e.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(p.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(p.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},l.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},l.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},l.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},l.onBufferCreated=function(e,t){var r,n;this.audioBuffer=(r=t.tracks.audio)===null||r===void 0?void 0:r.buffer,this.videoBuffer=(n=t.tracks.video)===null||n===void 0?void 0:n.buffer},l.createData=function(){var e;return{v:1,sf:Br.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},l.apply=function(e,t){t===void 0&&(t={}),Ji(t,this.createData());var r=t.ot===Kt.INIT||t.ot===Kt.VIDEO||t.ot===Kt.MUXED;if(this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){var n=d.toHeaders(t);if(!Object.keys(n).length)return;e.headers||(e.headers={}),Ji(e.headers,n)}else{var s=d.toQuery(t);if(!s)return;e.url=d.appendQueryToUri(e.url,s)}},l.getObjectType=function(e){var t=e.type;return t==="subtitle"?Kt.TIMED_TEXT:e.sn==="initSegment"?Kt.INIT:t==="audio"?Kt.AUDIO:t==="main"?this.hls.audioTracks.length?Kt.VIDEO:Kt.MUXED:void 0},l.getTopBandwidth=function(e){var t,r=0,n=this.hls;if(e===Kt.AUDIO)t=n.audioTracks;else{var s=n.maxAutoLevel,i=s>-1?s+1:n.levels.length;t=n.levels.slice(0,i)}for(var a,u=Hn(t);!(a=u()).done;){var h=a.value;h.bitrate>r&&(r=h.bitrate)}return r>0?r:NaN},l.getBufferLength=function(e){var t=this.hls.media,r=e===Kt.AUDIO?this.audioBuffer:this.videoBuffer;return r&&t?1e3*St.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN},l.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,r=e||this.config.loader;return function(){function n(i){this.loader=void 0,this.loader=new r(i)}var s=n.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(i,a,u){t(i),this.loader.load(i,a,u)},jn(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},l.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,r=e||this.config.loader;return function(){function n(i){this.loader=void 0,this.loader=new r(i)}var s=n.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(i,a,u){t(i),this.loader.load(i,a,u)},jn(n,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),n}()},d.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)},d.serialize=function(e){for(var t,r=[],n=function(k){return!Number.isNaN(k)&&k!=null&&k!==""&&k!==!1},s=function(k){return Math.round(k)},i=function(k){return 100*s(k/100)},a={br:s,d:s,bl:i,dl:i,mtp:i,nor:function(k){return encodeURIComponent(k)},rtp:i,tb:s},u=Hn(Object.keys(e||{}).sort());!(t=u()).done;){var h=t.value,f=e[h];if(n(f)&&!(h==="v"&&f===1||h=="pr"&&f===1)){var m=a[h];m&&(f=m(f));var y,S=typeof f;y=h==="ot"||h==="sf"||h==="st"?h+"="+f:S==="boolean"?h:S==="number"?h+"="+f:h+"="+JSON.stringify(f),r.push(y)}}return r.join(",")},d.toHeaders=function(e){for(var t={},r=["Object","Request","Session","Status"],n=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},i=0,a=Object.keys(e);i<a.length;i++){var u=a[i];n[s[u]!=null?s[u]:1][u]=e[u]}for(var h=0;h<n.length;h++){var f=d.serialize(n[h]);f&&(t["CMCD-"+r[h]]=f)}return t},d.toQuery=function(e){return"CMCD="+encodeURIComponent(d.serialize(e))},d.appendQueryToUri=function(e,t){if(!t)return e;var r=e.includes("?")?"&":"?";return""+e+r+t},d}(),qn=R(408),La=/^age:\s*[\d.]+\s*$/m;const Yn=function(){function d(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new qn.LoadStats,this.retryDelay=0}var l=d.prototype;return l.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},l.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))},l.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},l.load=function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.retryDelay=t.retryDelay,this.loadInternal()},l.loadInternal=function(){var e=this.config,t=this.context;if(e){var r=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0;var s=this.xhrSetup;try{if(s)try{s(r,t.url)}catch{r.open("GET",t.url,!0),s(r,t.url)}r.readyState||r.open("GET",t.url,!0);var i=this.context.headers;if(i)for(var a in i)r.setRequestHeader(a,i[a])}catch(u){return void this.callbacks.onError({code:r.status,text:u.message},t,r)}t.rangeEnd&&r.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=t.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),r.send()}},l.readystatechange=function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var n=t.readyState,s=this.config;if(!r.aborted&&n>=2)if(self.clearTimeout(this.requestTimeout),r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start)),n===4){t.onreadystatechange=null,t.onprogress=null;var i=t.status,a=t.responseType==="arraybuffer";if(i>=200&&i<300&&(a&&t.response||t.responseText!==null)){var u,h;if(r.loading.end=Math.max(self.performance.now(),r.loading.first),h=a?(u=t.response).byteLength:(u=t.responseText).length,r.loaded=r.total=h,!this.callbacks)return;var f=this.callbacks.onProgress;if(f&&f(r,e,u,t),!this.callbacks)return;var m={url:t.responseURL,data:u};this.callbacks.onSuccess(m,r,e,t)}else r.retry>=s.maxRetry||i>=400&&i<499?(_.logger.error(i+" while loading "+e.url),this.callbacks.onError({code:i,text:t.statusText},e,t)):(_.logger.warn(i+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),r.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout)}},l.loadtimeout=function(){_.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},l.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},l.getCacheAge=function(){var e=null;if(this.loader&&La.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},d}();function Kr(d){var l=typeof Map=="function"?new Map:void 0;return Kr=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(e))return l.get(e);l.set(e,r)}function r(){return Gr(e,arguments,jr(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),xi(r,e)},Kr(d)}function Gr(d,l,e){return Gr=Da()?Reflect.construct.bind():function(t,r,n){var s=[null];s.push.apply(s,r);var i=new(Function.bind.apply(t,s));return n&&xi(i,n.prototype),i},Gr.apply(null,arguments)}function Da(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function xi(d,l){return xi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},xi(d,l)}function jr(d){return jr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},jr(d)}function Hr(){return Hr=Object.assign?Object.assign.bind():function(d){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(d[t]=e[t])}return d},Hr.apply(this,arguments)}var Ia=function(){function d(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Ra,this.controller=new self.AbortController,this.stats=new qn.LoadStats}var l=d.prototype;return l.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},l.abortInternal=function(){var e=this.response;e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},l.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},l.load=function(e,t,r){var n=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var i=function(f,m){var y={method:"GET",mode:"cors",credentials:"same-origin",signal:m,headers:new self.Headers(Hr({},f.headers))};return f.rangeEnd&&y.headers.set("Range","bytes="+f.rangeStart+"-"+String(f.rangeEnd-1)),y}(e,this.controller.signal),a=r.onProgress,u=e.responseType==="arraybuffer",h=u?"byteLength":"length";this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){n.abortInternal(),r.onTimeout(s,e,n.response)},t.timeout),self.fetch(this.request).then(function(f){if(n.response=n.loader=f,!f.ok){var m=f.status,y=f.statusText;throw new Ca(y||"fetch, bad network response",m,f)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(f.headers.get("Content-Length")||"0"),a&&(0,N.isFiniteNumber)(t.highWaterMark)?n.loadProgressively(f,s,e,t.highWaterMark,a):u?f.arrayBuffer():f.text()}).then(function(f){var m=n.response;self.clearTimeout(n.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var y=f[h];y&&(s.loaded=s.total=y);var S={url:m.url,data:f};a&&!(0,N.isFiniteNumber)(t.highWaterMark)&&a(s,e,f,m),r.onSuccess(S,s,e,m)}).catch(function(f){if(self.clearTimeout(n.requestTimeout),!s.aborted){var m=f&&f.code||0,y=f?f.message:null;r.onError({code:m,text:y},e,f?f.details:null)}})},l.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},l.loadProgressively=function(e,t,r,n,s){n===void 0&&(n=0);var i=new bn,a=e.body.getReader();return function u(){return a.read().then(function(h){if(h.done)return i.dataLength&&s(t,r,i.flush(),e),Promise.resolve(new ArrayBuffer(0));var f=h.value,m=f.length;return t.loaded+=m,m<n||i.dataLength?(i.push(f),i.dataLength>=n&&s(t,r,i.flush(),e)):s(t,r,f,e),u()}).catch(function(){return Promise.reject()})}()},d}();function Ra(d,l){return new self.Request(d.url,l)}var Ca=function(d){var l,e;function t(r,n,s){var i;return(i=d.call(this,r)||this).code=void 0,i.details=void 0,i.code=n,i.details=s,i}return e=d,(l=t).prototype=Object.create(e.prototype),l.prototype.constructor=l,xi(l,e),t}(Kr(Error));const Wn=Ia;var _a=/\s/;function Vr(){return Vr=Object.assign?Object.assign.bind():function(d){for(var l=1;l<arguments.length;l++){var e=arguments[l];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(d[t]=e[t])}return d},Vr.apply(this,arguments)}function $n(d,l){var e=Object.keys(d);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(d);l&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(d,r).enumerable})),e.push.apply(e,t)}return e}function zn(d){for(var l=1;l<arguments.length;l++){var e=arguments[l]!=null?arguments[l]:{};l%2?$n(Object(e),!0).forEach(function(t){Pa(d,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(e)):$n(Object(e)).forEach(function(t){Object.defineProperty(d,t,Object.getOwnPropertyDescriptor(e,t))})}return d}function Pa(d,l,e){return(l=function(t){var r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t,"string");return typeof r=="symbol"?r:String(r)}(l))in d?Object.defineProperty(d,l,{value:e,enumerable:!0,configurable:!0,writable:!0}):d[l]=e,d}var Oa=zn(zn({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Yn,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Vs,bufferController:ta,capLevelController:Ta,fpsController:Sa,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ye,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:{newCue:function(d,l,e,t){for(var r,n,s,i,a,u=[],h=self.VTTCue||self.TextTrackCue,f=0;f<t.rows.length;f++)if(s=!0,i=0,a="",!(r=t.rows[f]).isEmpty()){for(var m=0;m<r.chars.length;m++)_a.test(r.chars[m].uchar)&&s?i++:(a+=r.chars[m].uchar,s=!1);r.cueStartTime=l,l===e&&(e+=1e-4),i>=16?i--:i++;var y=_n(a.trim()),S=Cr(l,e,y);d&&d.cues&&d.cues.getCueById(S)||((n=new h(l,e,y)).id=S,n.line=f+1,n.align="left",n.position=10+Math.min(80,10*Math.floor(8*i/32)),u.push(n))}return d&&u.length&&(u.sort(function(k,F){return k.line==="auto"||F.line==="auto"?0:k.line>8&&F.line>8?F.line-k.line:k.line-F.line}),u.forEach(function(k){return st(d,k)})),u}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Xs,subtitleTrackController:Zs,timelineController:ya,audioStreamController:Ys,audioTrackController:$s,emeController:Aa,cmcdController:wa});function Xn(d,l){for(var e=0;e<l.length;e++){var t=l[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,typeof(r=function(n,s){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(t.key,"string"))=="symbol"?r:String(r),t)}var r}var Qn=function(){function d(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new vr.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var s=this.config=function(ue,Ie){if((Ie.liveSyncDurationCount||Ie.liveMaxLatencyDurationCount)&&(Ie.liveSyncDuration||Ie.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(Ie.liveMaxLatencyDurationCount!==void 0&&(Ie.liveSyncDurationCount===void 0||Ie.liveMaxLatencyDurationCount<=Ie.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(Ie.liveMaxLatencyDuration!==void 0&&(Ie.liveSyncDuration===void 0||Ie.liveMaxLatencyDuration<=Ie.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return Vr({},ue,Ie)}(d.DefaultConfig,n);this.userConfig=n,(0,_.enableLogs)(s.debug,"Hls instance"),this._autoLevelCapping=-1,s.progressive&&function(ue){var Ie=ue.loader;Ie!==Wn&&Ie!==Yn?(_.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),ue.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(ue.loader=Wn,ue.progressive=!0,ue.enableSoftwareAES=!0,_.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}(s);var i=s.abrController,a=s.bufferController,u=s.capLevelController,h=s.fpsController,f=this.abrController=new i(this),m=this.bufferController=new a(this),y=this.capLevelController=new u(this),S=new h(this),k=new Be(this),F=new pt(this),P=this.levelController=new ze(this),K=new ot(this),Z=new Yt(this.config),le=this.streamController=new Gs(this,K,Z);y.setStreamController(le),S.setStreamController(le);var ne=[k,P,le];this.networkControllers=ne;var he=[f,m,y,S,F,K];this.audioTrackController=this.createController(s.audioTrackController,ne);var Re=s.audioStreamController;Re&&ne.push(new Re(this,K,Z)),this.subtitleTrackController=this.createController(s.subtitleTrackController,ne);var Ge=s.subtitleStreamController;Ge&&ne.push(new Ge(this,K,Z)),this.createController(s.timelineController,he),Z.emeController=this.emeController=this.createController(s.emeController,he),this.cmcdController=this.createController(s.cmcdController,he),this.latencyController=this.createController(_t,he),this.coreComponents=he}d.isSupported=function(){return function(){var n=pr();if(!n)return!1;var s=pn(),i=n&&typeof n.isTypeSupported=="function"&&n.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),a=!s||s.prototype&&typeof s.prototype.appendBuffer=="function"&&typeof s.prototype.remove=="function";return!!i&&!!a}()};var l,e,t,r=d.prototype;return r.createController=function(n,s){if(n){var i=new n(this);return s&&s.push(i),i}return null},r.on=function(n,s,i){i===void 0&&(i=this),this._emitter.on(n,s,i)},r.once=function(n,s,i){i===void 0&&(i=this),this._emitter.once(n,s,i)},r.removeAllListeners=function(n){this._emitter.removeAllListeners(n)},r.off=function(n,s,i,a){i===void 0&&(i=this),this._emitter.off(n,s,i,a)},r.listeners=function(n){return this._emitter.listeners(n)},r.emit=function(n,s,i){return this._emitter.emit(n,s,i)},r.trigger=function(n,s){if(this.config.debug)return this.emit(n,n,s);try{return this.emit(n,n,s)}catch(i){_.logger.error("An internal error happened while handling event "+n+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(p.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:n,error:i})}return!1},r.listenerCount=function(n){return this._emitter.listenerCount(n)},r.destroy=function(){_.logger.log("destroy"),this.trigger(p.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(n){return n.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(n){return n.destroy()}),this.coreComponents.length=0},r.attachMedia=function(n){_.logger.log("attachMedia"),this._media=n,this.trigger(p.Events.MEDIA_ATTACHING,{media:n})},r.detachMedia=function(){_.logger.log("detachMedia"),this.trigger(p.Events.MEDIA_DETACHING,void 0),this._media=null},r.loadSource=function(n){this.stopLoad();var s=this.media,i=this.url,a=this.url=H.buildAbsoluteURL(self.location.href,n,{alwaysNormalize:!0});_.logger.log("loadSource:"+a),s&&i&&i!==a&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(s)),this.trigger(p.Events.MANIFEST_LOADING,{url:n})},r.startLoad=function(n){n===void 0&&(n=-1),_.logger.log("startLoad("+n+")"),this.networkControllers.forEach(function(s){s.startLoad(n)})},r.stopLoad=function(){_.logger.log("stopLoad"),this.networkControllers.forEach(function(n){n.stopLoad()})},r.swapAudioCodec=function(){_.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},r.recoverMediaError=function(){_.logger.log("recoverMediaError");var n=this._media;this.detachMedia(),n&&this.attachMedia(n)},r.removeLevel=function(n,s){s===void 0&&(s=0),this.levelController.removeLevel(n,s)},l=d,t=[{key:"version",get:function(){return"1.3.1"}},{key:"Events",get:function(){return p.Events}},{key:"ErrorTypes",get:function(){return I.ErrorTypes}},{key:"ErrorDetails",get:function(){return I.ErrorDetails}},{key:"DefaultConfig",get:function(){return d.defaultConfig?d.defaultConfig:Oa},set:function(n){d.defaultConfig=n}}],(e=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(n){_.logger.log("set currentLevel:"+n),this.loadLevel=n,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(n){_.logger.log("set nextLevel:"+n),this.levelController.manualLevel=n,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(n){_.logger.log("set loadLevel:"+n),this.levelController.manualLevel=n}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(n){this.levelController.nextLoadLevel=n}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(n){_.logger.log("set firstLevel:"+n),this.levelController.firstLevel=n}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(n){_.logger.log("set startLevel:"+n),n!==-1&&(n=Math.max(n,this.minAutoLevel)),this.levelController.startLevel=n}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(n){var s=!!n;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(n){this._autoLevelCapping!==n&&(_.logger.log("set autoLevelCapping:"+n),this._autoLevelCapping=n)}},{key:"bandwidthEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(n){Ht.indexOf(n)>-1&&(this._maxHdcpLevel=n)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var n=this.levels,s=this.config.minAutoBitrate;if(!n)return 0;for(var i=n.length,a=0;a<i;a++)if(n[a].maxBitrate>=s)return a;return 0}},{key:"maxAutoLevel",get:function(){var n,s=this.levels,i=this.autoLevelCapping,a=this.maxHdcpLevel;if(n=i===-1&&s&&s.length?s.length-1:i,a)for(var u=n;u--;){var h=s[u].attrs["HDCP-LEVEL"];if(h&&h<=a)return u}return n}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(n){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,n)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var n=this.audioTrackController;return n?n.audioTracks:[]}},{key:"audioTrack",get:function(){var n=this.audioTrackController;return n?n.audioTrack:-1},set:function(n){var s=this.audioTrackController;s&&(s.audioTrack=n)}},{key:"subtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTrack:-1},set:function(n){var s=this.subtitleTrackController;s&&(s.subtitleTrack=n)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var n=this.subtitleTrackController;return!!n&&n.subtitleDisplay},set:function(n){var s=this.subtitleTrackController;s&&(s.subtitleDisplay=n)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(n){this.config.lowLatencyMode=n}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&Xn(l.prototype,e),t&&Xn(l,t),Object.defineProperty(l,"prototype",{writable:!1}),d}();Qn.defaultConfig=void 0},923:(w,L,R)=>{R.r(L),R.d(L,{BaseSegment:()=>ie,ElementaryStreamTypes:()=>B,Fragment:()=>q,Part:()=>j});var B,H=R(965),N=R(945),p=R(408);function I(re,X){re.prototype=Object.create(X.prototype),re.prototype.constructor=re,_(re,X)}function _(re,X){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(z,$){return z.__proto__=$,z},_(re,X)}function de(re,X){for(var z=0;z<X.length;z++){var $=X[z];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(re,typeof(ve=function(be,Ne){if(typeof be!="object"||be===null)return be;var J=be[Symbol.toPrimitive];if(J!==void 0){var A=J.call(be,Ne);if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(be)}($.key,"string"))=="symbol"?ve:String(ve),$)}var ve}function Q(re,X,z){return X&&de(re.prototype,X),z&&de(re,z),Object.defineProperty(re,"prototype",{writable:!1}),re}(function(re){re.AUDIO="audio",re.VIDEO="video",re.AUDIOVIDEO="audiovideo"})(B||(B={}));var ie=function(){function re(X){var z;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((z={})[B.AUDIO]=null,z[B.VIDEO]=null,z[B.AUDIOVIDEO]=null,z),this.baseurl=X}return re.prototype.setByteRange=function(X,z){var $=X.split("@",2),ve=[];$.length===1?ve[0]=z?z.byteRangeEndOffset:0:ve[0]=parseInt($[1]),ve[1]=parseInt($[0])+ve[0],this._byteRange=ve},Q(re,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,N.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(X){this._url=X}}]),re}(),q=function(re){function X($,ve){var be;return(be=re.call(this,ve)||this)._decryptdata=null,be.rawProgramDateTime=null,be.programDateTime=null,be.tagList=[],be.duration=0,be.sn=0,be.levelkeys=void 0,be.type=void 0,be.loader=null,be.keyLoader=null,be.level=-1,be.cc=0,be.startPTS=void 0,be.endPTS=void 0,be.appendedPTS=void 0,be.startDTS=void 0,be.endDTS=void 0,be.start=0,be.deltaPTS=void 0,be.maxStartPTS=void 0,be.minEndPTS=void 0,be.stats=new p.LoadStats,be.urlId=0,be.data=void 0,be.bitrateTest=!1,be.title=null,be.initSegment=null,be.endList=void 0,be.type=$,be}I(X,re);var z=X.prototype;return z.setKeyFormat=function($){if(this.levelkeys){var ve=this.levelkeys[$];ve&&!this._decryptdata&&(this._decryptdata=ve.getDecryptData(this.sn))}},z.abortRequests=function(){var $,ve;($=this.loader)===null||$===void 0||$.abort(),(ve=this.keyLoader)===null||ve===void 0||ve.abort()},z.setElementaryStreamInfo=function($,ve,be,Ne,J,A){A===void 0&&(A=!1);var G=this.elementaryStreams,O=G[$];O?(O.startPTS=Math.min(O.startPTS,ve),O.endPTS=Math.max(O.endPTS,be),O.startDTS=Math.min(O.startDTS,Ne),O.endDTS=Math.max(O.endDTS,J)):G[$]={startPTS:ve,endPTS:be,startDTS:Ne,endDTS:J,partial:A}},z.clearElementaryStreamInfo=function(){var $=this.elementaryStreams;$[B.AUDIO]=null,$[B.VIDEO]=null,$[B.AUDIOVIDEO]=null},Q(X,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var $=this.levelkeys.identity;if($)this._decryptdata=$.getDecryptData(this.sn);else{var ve=Object.keys(this.levelkeys);if(ve.length===1)return this._decryptdata=this.levelkeys[ve[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,H.isFiniteNumber)(this.programDateTime))return null;var $=(0,H.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*$}},{key:"encrypted",get:function(){var $;if(($=this._decryptdata)!==null&&$!==void 0&&$.encrypted)return!0;if(this.levelkeys){var ve=Object.keys(this.levelkeys),be=ve.length;if(be>1||be===1&&this.levelkeys[ve[0]].encrypted)return!0}return!1}}]),X}(ie),j=function(re){function X(z,$,ve,be,Ne){var J;(J=re.call(this,ve)||this).fragOffset=0,J.duration=0,J.gap=!1,J.independent=!1,J.relurl=void 0,J.fragment=void 0,J.index=void 0,J.stats=new p.LoadStats,J.duration=z.decimalFloatingPoint("DURATION"),J.gap=z.bool("GAP"),J.independent=z.bool("INDEPENDENT"),J.relurl=z.enumeratedString("URI"),J.fragment=$,J.index=be;var A=z.enumeratedString("BYTERANGE");return A&&J.setByteRange(A,Ne),Ne&&(J.fragOffset=Ne.fragOffset+Ne.duration),J}return I(X,re),Q(X,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var z=this.elementaryStreams;return!!(z.audio||z.video||z.audiovideo)}}]),X}(ie)},408:(w,L,R)=>{R.r(L),R.d(L,{LoadStats:()=>B});var B=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},965:(w,L,R)=>{R.r(L),R.d(L,{MAX_SAFE_INTEGER:()=>H,isFiniteNumber:()=>B});var B=Number.isFinite||function(N){return typeof N=="number"&&isFinite(N)},H=Number.MAX_SAFE_INTEGER||9007199254740991},524:(w,L,R)=>{R.r(L),R.d(L,{default:()=>z,flushTextTrackMetadataCueSamples:()=>ve,flushTextTrackUserdataCueSamples:()=>be,normalizePts:()=>$});var B=R(965);const H=function(){function A(){}return A.getSilentFrame=function(G,O){if(G==="mp4a.40.2"){if(O===1)return new Uint8Array([0,200,0,128,35,128]);if(O===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(O===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(O===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(O===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(O===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(O===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(O===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(O===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},A}();var N=Math.pow(2,32)-1,p=function(){function A(){}return A.init=function(){var G;for(G in A.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},A.types)A.types.hasOwnProperty(G)&&(A.types[G]=[G.charCodeAt(0),G.charCodeAt(1),G.charCodeAt(2),G.charCodeAt(3)]);var O=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),se=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);A.HDLR_TYPES={video:O,audio:se};var ye=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),me=new Uint8Array([0,0,0,0,0,0,0,0]);A.STTS=A.STSC=A.STCO=me,A.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),A.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),A.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),A.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var ge=new Uint8Array([105,115,111,109]),Pe=new Uint8Array([97,118,99,49]),xe=new Uint8Array([0,0,0,1]);A.FTYP=A.box(A.types.ftyp,ge,xe,ge,Pe),A.DINF=A.box(A.types.dinf,A.box(A.types.dref,ye))},A.box=function(G){for(var O=8,se=arguments.length,ye=new Array(se>1?se-1:0),me=1;me<se;me++)ye[me-1]=arguments[me];for(var ge=ye.length,Pe=ge;ge--;)O+=ye[ge].byteLength;var xe=new Uint8Array(O);for(xe[0]=O>>24&255,xe[1]=O>>16&255,xe[2]=O>>8&255,xe[3]=255&O,xe.set(G,4),ge=0,O=8;ge<Pe;ge++)xe.set(ye[ge],O),O+=ye[ge].byteLength;return xe},A.hdlr=function(G){return A.box(A.types.hdlr,A.HDLR_TYPES[G])},A.mdat=function(G){return A.box(A.types.mdat,G)},A.mdhd=function(G,O){O*=G;var se=Math.floor(O/(N+1)),ye=Math.floor(O%(N+1));return A.box(A.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,G>>24&255,G>>16&255,G>>8&255,255&G,se>>24,se>>16&255,se>>8&255,255&se,ye>>24,ye>>16&255,ye>>8&255,255&ye,85,196,0,0]))},A.mdia=function(G){return A.box(A.types.mdia,A.mdhd(G.timescale,G.duration),A.hdlr(G.type),A.minf(G))},A.mfhd=function(G){return A.box(A.types.mfhd,new Uint8Array([0,0,0,0,G>>24,G>>16&255,G>>8&255,255&G]))},A.minf=function(G){return G.type==="audio"?A.box(A.types.minf,A.box(A.types.smhd,A.SMHD),A.DINF,A.stbl(G)):A.box(A.types.minf,A.box(A.types.vmhd,A.VMHD),A.DINF,A.stbl(G))},A.moof=function(G,O,se){return A.box(A.types.moof,A.mfhd(G),A.traf(se,O))},A.moov=function(G){for(var O=G.length,se=[];O--;)se[O]=A.trak(G[O]);return A.box.apply(null,[A.types.moov,A.mvhd(G[0].timescale,G[0].duration)].concat(se).concat(A.mvex(G)))},A.mvex=function(G){for(var O=G.length,se=[];O--;)se[O]=A.trex(G[O]);return A.box.apply(null,[A.types.mvex].concat(se))},A.mvhd=function(G,O){O*=G;var se=Math.floor(O/(N+1)),ye=Math.floor(O%(N+1)),me=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,G>>24&255,G>>16&255,G>>8&255,255&G,se>>24,se>>16&255,se>>8&255,255&se,ye>>24,ye>>16&255,ye>>8&255,255&ye,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return A.box(A.types.mvhd,me)},A.sdtp=function(G){var O,se,ye=G.samples||[],me=new Uint8Array(4+ye.length);for(O=0;O<ye.length;O++)se=ye[O].flags,me[O+4]=se.dependsOn<<4|se.isDependedOn<<2|se.hasRedundancy;return A.box(A.types.sdtp,me)},A.stbl=function(G){return A.box(A.types.stbl,A.stsd(G),A.box(A.types.stts,A.STTS),A.box(A.types.stsc,A.STSC),A.box(A.types.stsz,A.STSZ),A.box(A.types.stco,A.STCO))},A.avc1=function(G){var O,se,ye,me=[],ge=[];for(O=0;O<G.sps.length;O++)ye=(se=G.sps[O]).byteLength,me.push(ye>>>8&255),me.push(255&ye),me=me.concat(Array.prototype.slice.call(se));for(O=0;O<G.pps.length;O++)ye=(se=G.pps[O]).byteLength,ge.push(ye>>>8&255),ge.push(255&ye),ge=ge.concat(Array.prototype.slice.call(se));var Pe=A.box(A.types.avcC,new Uint8Array([1,me[3],me[4],me[5],255,224|G.sps.length].concat(me).concat([G.pps.length]).concat(ge))),xe=G.width,Fe=G.height,_e=G.pixelRatio[0],$e=G.pixelRatio[1];return A.box(A.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,xe>>8&255,255&xe,Fe>>8&255,255&Fe,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),Pe,A.box(A.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),A.box(A.types.pasp,new Uint8Array([_e>>24,_e>>16&255,_e>>8&255,255&_e,$e>>24,$e>>16&255,$e>>8&255,255&$e])))},A.esds=function(G){var O=G.config.length;return new Uint8Array([0,0,0,0,3,23+O,0,1,0,4,15+O,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([O]).concat(G.config).concat([6,1,2]))},A.mp4a=function(G){var O=G.samplerate;return A.box(A.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,G.channelCount,0,16,0,0,0,0,O>>8&255,255&O,0,0]),A.box(A.types.esds,A.esds(G)))},A.mp3=function(G){var O=G.samplerate;return A.box(A.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,G.channelCount,0,16,0,0,0,0,O>>8&255,255&O,0,0]))},A.stsd=function(G){return G.type==="audio"?G.segmentCodec==="mp3"&&G.codec==="mp3"?A.box(A.types.stsd,A.STSD,A.mp3(G)):A.box(A.types.stsd,A.STSD,A.mp4a(G)):A.box(A.types.stsd,A.STSD,A.avc1(G))},A.tkhd=function(G){var O=G.id,se=G.duration*G.timescale,ye=G.width,me=G.height,ge=Math.floor(se/(N+1)),Pe=Math.floor(se%(N+1));return A.box(A.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,O>>24&255,O>>16&255,O>>8&255,255&O,0,0,0,0,ge>>24,ge>>16&255,ge>>8&255,255&ge,Pe>>24,Pe>>16&255,Pe>>8&255,255&Pe,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,ye>>8&255,255&ye,0,0,me>>8&255,255&me,0,0]))},A.traf=function(G,O){var se=A.sdtp(G),ye=G.id,me=Math.floor(O/(N+1)),ge=Math.floor(O%(N+1));return A.box(A.types.traf,A.box(A.types.tfhd,new Uint8Array([0,0,0,0,ye>>24,ye>>16&255,ye>>8&255,255&ye])),A.box(A.types.tfdt,new Uint8Array([1,0,0,0,me>>24,me>>16&255,me>>8&255,255&me,ge>>24,ge>>16&255,ge>>8&255,255&ge])),A.trun(G,se.length+16+20+8+16+8+8),se)},A.trak=function(G){return G.duration=G.duration||4294967295,A.box(A.types.trak,A.tkhd(G),A.mdia(G))},A.trex=function(G){var O=G.id;return A.box(A.types.trex,new Uint8Array([0,0,0,0,O>>24,O>>16&255,O>>8&255,255&O,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},A.trun=function(G,O){var se,ye,me,ge,Pe,xe,Fe=G.samples||[],_e=Fe.length,$e=12+16*_e,at=new Uint8Array($e);for(O+=8+$e,at.set([G.type==="video"?1:0,0,15,1,_e>>>24&255,_e>>>16&255,_e>>>8&255,255&_e,O>>>24&255,O>>>16&255,O>>>8&255,255&O],0),se=0;se<_e;se++)me=(ye=Fe[se]).duration,ge=ye.size,Pe=ye.flags,xe=ye.cts,at.set([me>>>24&255,me>>>16&255,me>>>8&255,255&me,ge>>>24&255,ge>>>16&255,ge>>>8&255,255&ge,Pe.isLeading<<2|Pe.dependsOn,Pe.isDependedOn<<6|Pe.hasRedundancy<<4|Pe.paddingValue<<1|Pe.isNonSync,61440&Pe.degradPrio,15&Pe.degradPrio,xe>>>24&255,xe>>>16&255,xe>>>8&255,255&xe],12+16*se);return A.box(A.types.trun,at)},A.initSegment=function(G){A.types||A.init();var O=A.moov(G),se=new Uint8Array(A.FTYP.byteLength+O.byteLength);return se.set(A.FTYP),se.set(O,A.FTYP.byteLength),se},A}();p.types=void 0,p.HDLR_TYPES=void 0,p.STTS=void 0,p.STSC=void 0,p.STCO=void 0,p.STSZ=void 0,p.VMHD=void 0,p.SMHD=void 0,p.STSD=void 0,p.FTYP=void 0,p.DINF=void 0;const I=p;var _=R(851),de=R(973),Q=R(93),ie=R(308),q=R(673);function j(){return j=Object.assign?Object.assign.bind():function(A){for(var G=1;G<arguments.length;G++){var O=arguments[G];for(var se in O)Object.prototype.hasOwnProperty.call(O,se)&&(A[se]=O[se])}return A},j.apply(this,arguments)}var re=null,X=null,z=function(){function A(O,se,ye,me){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=O,this.config=se,this.typeSupported=ye,this.ISGenerated=!1,re===null){var ge=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);re=ge?parseInt(ge[1]):0}if(X===null){var Pe=navigator.userAgent.match(/Safari\/(\d+)/i);X=Pe?parseInt(Pe[1]):0}}var G=A.prototype;return G.destroy=function(){},G.resetTimeStamp=function(O){Q.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=O},G.resetNextTimestamp=function(){Q.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},G.resetInitSegment=function(){Q.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},G.getVideoStartPts=function(O){var se=!1,ye=O.reduce(function(me,ge){var Pe=ge.pts-me;return Pe<-4294967296?(se=!0,$(me,ge.pts)):Pe>0?me:ge.pts},O[0].pts);return se&&Q.logger.debug("PTS rollover detected"),ye},G.remux=function(O,se,ye,me,ge,Pe,xe,Fe){var _e,$e,at,te,ce,ee,Se=ge,Te=ge,we=O.pid>-1,Le=se.pid>-1,Ce=se.samples.length,oe=O.samples.length>0,Ee=xe&&Ce>0||Ce>1;if((!we||oe)&&(!Le||Ee)||this.ISGenerated||xe){this.ISGenerated||(at=this.generateIS(O,se,ge));var Be,Ve=this.isVideoContiguous,st=-1;if(Ee&&(st=function(ht){for(var it=0;it<ht.length;it++)if(ht[it].key)return it;return-1}(se.samples),!Ve&&this.config.forceKeyFrameOnDiscontinuity))if(ee=!0,st>0){Q.logger.warn("[mp4-remuxer]: Dropped "+st+" out of "+Ce+" video samples due to a missing keyframe");var et=this.getVideoStartPts(se.samples);se.samples=se.samples.slice(st),se.dropped+=st,Be=Te+=(se.samples[0].pts-et)/se.inputTimeScale}else st===-1&&(Q.logger.warn("[mp4-remuxer]: No keyframe found out of "+Ce+" video samples"),ee=!1);if(this.ISGenerated){if(oe&&Ee){var yt=this.getVideoStartPts(se.samples),gt=($(O.samples[0].pts,yt)-yt)/se.inputTimeScale;Se+=Math.max(0,gt),Te+=Math.max(0,-gt)}if(oe){if(O.samplerate||(Q.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),at=this.generateIS(O,se,ge)),$e=this.remuxAudio(O,Se,this.isAudioContiguous,Pe,Le||Ee||Fe===ie.PlaylistLevelType.AUDIO?Te:void 0),Ee){var ct=$e?$e.endPTS-$e.startPTS:0;se.inputTimeScale||(Q.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),at=this.generateIS(O,se,ge)),_e=this.remuxVideo(se,Te,Ve,ct)}}else Ee&&(_e=this.remuxVideo(se,Te,Ve,0));_e&&(_e.firstKeyFrame=st,_e.independent=st!==-1,_e.firstKeyFramePTS=Be)}}return this.ISGenerated&&(ye.samples.length&&(ce=ve(ye,ge,this._initPTS,this._initDTS)),me.samples.length&&(te=be(me,ge,this._initPTS))),{audio:$e,video:_e,initSegment:at,independent:ee,text:te,id3:ce}},G.generateIS=function(O,se,ye){var me,ge,Pe,xe=O.samples,Fe=se.samples,_e=this.typeSupported,$e={},at=!(0,B.isFiniteNumber)(this._initPTS),te="audio/mp4";if(at&&(me=ge=1/0),O.config&&xe.length&&(O.timescale=O.samplerate,O.segmentCodec==="mp3"&&(_e.mpeg?(te="audio/mpeg",O.codec=""):_e.mp3&&(O.codec="mp3")),$e.audio={id:"audio",container:te,codec:O.codec,initSegment:O.segmentCodec==="mp3"&&_e.mpeg?new Uint8Array(0):I.initSegment([O]),metadata:{channelCount:O.channelCount}},at&&(Pe=O.inputTimeScale,me=ge=xe[0].pts-Math.round(Pe*ye))),se.sps&&se.pps&&Fe.length&&(se.timescale=se.inputTimeScale,$e.video={id:"main",container:"video/mp4",codec:se.codec,initSegment:I.initSegment([se]),metadata:{width:se.width,height:se.height}},at)){Pe=se.inputTimeScale;var ce=this.getVideoStartPts(Fe),ee=Math.round(Pe*ye);ge=Math.min(ge,$(Fe[0].dts,ce)-ee),me=Math.min(me,ce-ee)}if(Object.keys($e).length)return this.ISGenerated=!0,at&&(this._initPTS=me,this._initDTS=ge),{tracks:$e,initPTS:me,timescale:Pe}},G.remuxVideo=function(O,se,ye,me){var ge,Pe,xe=O.inputTimeScale,Fe=O.samples,_e=[],$e=Fe.length,at=this._initPTS,te=this.nextAvcDts,ce=8,ee=this.videoSampleDuration,Se=Number.POSITIVE_INFINITY,Te=Number.NEGATIVE_INFINITY,we=!1;ye&&te!==null||(te=se*xe-(Fe[0].pts-$(Fe[0].dts,Fe[0].pts)));for(var Le=0;Le<$e;Le++){var Ce=Fe[Le];Ce.pts=$(Ce.pts-at,te),Ce.dts=$(Ce.dts-at,te),Ce.dts<Fe[Le>0?Le-1:Le].dts&&(we=!0)}we&&Fe.sort(function(xt,Yt){var gi=xt.dts-Yt.dts,Wt=xt.pts-Yt.pts;return gi||Wt}),ge=Fe[0].dts;var oe=Fe[Fe.length-1].dts-ge,Ee=oe?Math.round(oe/($e-1)):ee||O.inputTimeScale/30;if(ye){var Be=ge-te,Ve=Be>Ee,st=Be<-1;if((Ve||st)&&(Ve?Q.logger.warn("AVC: "+(0,q.toMsFromMpegTsClock)(Be,!0)+" ms ("+Be+"dts) hole between fragments detected, filling it"):Q.logger.warn("AVC: "+(0,q.toMsFromMpegTsClock)(-Be,!0)+" ms ("+Be+"dts) overlapping between fragments detected"),!st||te>Fe[0].pts)){ge=te;var et=Fe[0].pts-Be;Fe[0].dts=ge,Fe[0].pts=et,Q.logger.log("Video: First PTS/DTS adjusted: "+(0,q.toMsFromMpegTsClock)(et,!0)+"/"+(0,q.toMsFromMpegTsClock)(ge,!0)+", delta: "+(0,q.toMsFromMpegTsClock)(Be,!0)+" ms")}}ge=Math.max(0,ge);for(var yt=0,gt=0,ct=0;ct<$e;ct++){for(var ht=Fe[ct],it=ht.units,Qe=it.length,pt=0,Et=0;Et<Qe;Et++)pt+=it[Et].data.length;gt+=pt,yt+=Qe,ht.length=pt,ht.dts=Math.max(ht.dts,ge),Se=Math.min(ht.pts,Se),Te=Math.max(ht.pts,Te)}Pe=Fe[$e-1].dts;var _t,Mt=gt+4*yt+8;try{_t=new Uint8Array(Mt)}catch{return void this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:de.ErrorTypes.MUX_ERROR,details:de.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Mt,reason:"fail allocating video mdat "+Mt})}var It=new DataView(_t.buffer);It.setUint32(0,Mt),_t.set(I.types.mdat,4);for(var Ht=!1,W=Number.POSITIVE_INFINITY,M=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,x=Number.NEGATIVE_INFINITY,C=0;C<$e;C++){for(var U=Fe[C],V=U.units,Y=0,ae=0,fe=V.length;ae<fe;ae++){var pe=V[ae],ke=pe.data,Ue=pe.data.byteLength;It.setUint32(ce,Ue),ce+=4,_t.set(ke,ce),ce+=Ue,Y+=4+Ue}var De=void 0;if(C<$e-1)ee=Fe[C+1].dts-U.dts,De=Fe[C+1].pts-U.pts;else{var je=this.config,ze=C>0?U.dts-Fe[C-1].dts:Ee;if(De=C>0?U.pts-Fe[C-1].pts:Ee,je.stretchShortVideoTrack&&this.nextAudioPts!==null){var ot=Math.floor(je.maxBufferHole*xe),Ke=(me?Se+me*xe:this.nextAudioPts)-U.pts;Ke>ot?((ee=Ke-ze)<0?ee=ze:Ht=!0,Q.logger.log("[mp4-remuxer]: It is approximately "+Ke/90+" ms to the next segment; using duration "+ee/90+" ms for the last video frame.")):ee=ze}else ee=ze}var mt=Math.round(U.pts-U.dts);W=Math.min(W,ee),b=Math.max(b,ee),M=Math.min(M,De),x=Math.max(x,De),_e.push(new Ne(U.key,ee,Y,mt))}if(_e.length){if(re){if(re<70){var Ut=_e[0].flags;Ut.dependsOn=2,Ut.isNonSync=0}}else if(X&&x-M<b-W&&Ee/b<.025&&_e[0].cts===0){Q.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var At=ge,Tt=0,Lt=_e.length;Tt<Lt;Tt++){var He=At+_e[Tt].duration,jt=At+_e[Tt].cts;if(Tt<Lt-1){var ri=He+_e[Tt+1].cts;_e[Tt].duration=ri-jt}else _e[Tt].duration=Tt?_e[Tt-1].duration:Ee;_e[Tt].cts=0,At=He}}}ee=Ht||!ee?Ee:ee,this.nextAvcDts=te=Pe+ee,this.videoSampleDuration=ee,this.isVideoContiguous=!0;var wt={data1:I.moof(O.sequenceNumber++,ge,j({},O,{samples:_e})),data2:_t,startPTS:Se/xe,endPTS:(Te+ee)/xe,startDTS:ge/xe,endDTS:te/xe,type:"video",hasAudio:!1,hasVideo:!0,nb:_e.length,dropped:O.dropped};return O.samples=[],O.dropped=0,wt},G.remuxAudio=function(O,se,ye,me,ge){var Pe=O.inputTimeScale,xe=Pe/(O.samplerate?O.samplerate:Pe),Fe=O.segmentCodec==="aac"?1024:1152,_e=Fe*xe,$e=this._initPTS,at=O.segmentCodec==="mp3"&&this.typeSupported.mpeg,te=[],ce=ge!==void 0,ee=O.samples,Se=at?0:8,Te=this.nextAudioPts||-1,we=se*Pe;if(this.isAudioContiguous=ye=ye||ee.length&&Te>0&&(me&&Math.abs(we-Te)<9e3||Math.abs($(ee[0].pts-$e,we)-Te)<20*_e),ee.forEach(function(ae){ae.pts=$(ae.pts-$e,we)}),!ye||Te<0){if(ee=ee.filter(function(ae){return ae.pts>=0}),!ee.length)return;Te=ge===0?0:me&&!ce?Math.max(0,we):ee[0].pts}if(O.segmentCodec==="aac")for(var Le=this.config.maxAudioFramesDrift,Ce=0,oe=Te;Ce<ee.length;Ce++){var Ee=ee[Ce],Be=Ee.pts,Ve=Be-oe,st=Math.abs(1e3*Ve/Pe);if(Ve<=-Le*_e&&ce)Ce===0&&(Q.logger.warn("Audio frame @ "+(Be/Pe).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Ve/Pe)+" ms."),this.nextAudioPts=Te=oe=Be);else if(Ve>=Le*_e&&st<1e4&&ce){var et=Math.round(Ve/_e);(oe=Be-et*_e)<0&&(et--,oe+=_e),Ce===0&&(this.nextAudioPts=Te=oe),Q.logger.warn("[mp4-remuxer]: Injecting "+et+" audio frame @ "+(oe/Pe).toFixed(3)+"s due to "+Math.round(1e3*Ve/Pe)+" ms gap.");for(var yt=0;yt<et;yt++){var gt=Math.max(oe,0),ct=H.getSilentFrame(O.manifestCodec||O.codec,O.channelCount);ct||(Q.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ct=Ee.unit.subarray()),ee.splice(Ce,0,{unit:ct,pts:gt}),oe+=_e,Ce++}}Ee.pts=oe,oe+=_e}for(var ht,it=null,Qe=null,pt=0,Et=ee.length;Et--;)pt+=ee[Et].unit.byteLength;for(var _t=0,Mt=ee.length;_t<Mt;_t++){var It=ee[_t],Ht=It.unit,W=It.pts;if(Qe!==null)te[_t-1].duration=Math.round((W-Qe)/xe);else{if(ye&&O.segmentCodec==="aac"&&(W=Te),it=W,!(pt>0))return;pt+=Se;try{ht=new Uint8Array(pt)}catch{return void this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:de.ErrorTypes.MUX_ERROR,details:de.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:pt,reason:"fail allocating audio mdat "+pt})}at||(new DataView(ht.buffer).setUint32(0,pt),ht.set(I.types.mdat,4))}ht.set(Ht,Se);var M=Ht.byteLength;Se+=M,te.push(new Ne(!0,Fe,M,0)),Qe=W}var b=te.length;if(b){var x=te[te.length-1];this.nextAudioPts=Te=Qe+xe*x.duration;var C=at?new Uint8Array(0):I.moof(O.sequenceNumber++,it/xe,j({},O,{samples:te}));O.samples=[];var U=it/Pe,V=Te/Pe,Y={data1:C,data2:ht,startPTS:U,endPTS:V,startDTS:U,endDTS:V,type:"audio",hasAudio:!0,hasVideo:!1,nb:b};return this.isAudioContiguous=!0,Y}},G.remuxEmptyAudio=function(O,se,ye,me){var ge=O.inputTimeScale,Pe=ge/(O.samplerate?O.samplerate:ge),xe=this.nextAudioPts,Fe=(xe!==null?xe:me.startDTS*ge)+this._initDTS,_e=me.endDTS*ge+this._initDTS,$e=1024*Pe,at=Math.ceil((_e-Fe)/$e),te=H.getSilentFrame(O.manifestCodec||O.codec,O.channelCount);if(Q.logger.warn("[mp4-remuxer]: remux empty Audio"),te){for(var ce=[],ee=0;ee<at;ee++){var Se=Fe+ee*$e;ce.push({unit:te,pts:Se,dts:Se})}return O.samples=ce,this.remuxAudio(O,se,ye,!1)}Q.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},A}();function $(A,G){var O;if(G===null)return A;for(O=G<A?-8589934592:8589934592;Math.abs(A-G)>4294967296;)A+=O;return A}function ve(A,G,O,se){var ye=A.samples.length;if(ye){for(var me=A.inputTimeScale,ge=0;ge<ye;ge++){var Pe=A.samples[ge];Pe.pts=$(Pe.pts-O,G*me)/me,Pe.dts=$(Pe.dts-se,G*me)/me}var xe=A.samples;return A.samples=[],{samples:xe}}}function be(A,G,O){var se=A.samples.length;if(se){for(var ye=A.inputTimeScale,me=0;me<se;me++){var ge=A.samples[me];ge.pts=$(ge.pts-O,G*ye)/ye}A.samples.sort(function(xe,Fe){return xe.pts-Fe.pts});var Pe=A.samples;return A.samples=[],{samples:Pe}}}var Ne=function(A,G,O,se){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=G,this.size=O,this.cts=se,this.flags=new J(A)},J=function(A){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=A?2:1,this.isNonSync=A?0:1}},856:(w,L,R)=>{var B;R.r(L),R.d(L,{MetadataSchema:()=>B}),function(H){H.audioId3="org.id3",H.dateRange="com.apple.quicktime.HLS",H.emsg="https://aomedia.org/emsg/ID3"}(B||(B={}))},308:(w,L,R)=>{var B,H;R.r(L),R.d(L,{PlaylistContextType:()=>B,PlaylistLevelType:()=>H}),function(N){N.MANIFEST="manifest",N.LEVEL="level",N.AUDIO_TRACK="audioTrack",N.SUBTITLE_TRACK="subtitleTrack"}(B||(B={})),function(N){N.MAIN="main",N.AUDIO="audio",N.SUBTITLE="subtitle"}(H||(H={}))},300:(w,L,R)=>{R.r(L),R.d(L,{default:()=>B});const B={hexDump:function(H){for(var N="",p=0;p<H.length;p++){var I=H[p].toString(16);I.length<2&&(I="0"+I),N+=I}return N}}},93:(w,L,R)=>{R.r(L),R.d(L,{enableLogs:()=>I,logger:()=>_});var B=function(){},H={trace:B,debug:B,log:B,warn:B,info:B,error:B},N=H;function p(de){var Q=self.console[de];return Q?Q.bind(self.console,"["+de+"] >"):B}function I(de,Q){if(self.console&&de===!0||typeof de=="object"){(function(ie){for(var q=arguments.length,j=new Array(q>1?q-1:0),re=1;re<q;re++)j[re-1]=arguments[re];j.forEach(function(X){N[X]=ie[X]?ie[X].bind(ie):p(X)})})(de,"debug","log","info","warn","error");try{N.log('Debug logs enabled for "'+Q+'"')}catch{N=H}}else N=H}var _=H},63:(w,L,R)=>{R.r(L),R.d(L,{RemuxerTrackIdConfig:()=>Q,appendUint8Array:()=>ye,bin2str:()=>ie,computeRawDurationFromSamples:()=>G,discardEPB:()=>xe,findBox:()=>z,getDuration:()=>A,getStartDTS:()=>J,mp4Box:()=>_e,mp4pssh:()=>$e,offsetStartDTS:()=>O,parseEmsg:()=>Fe,parseInitSegment:()=>ve,parsePssh:()=>at,parseSEIMessageFromNALu:()=>Pe,parseSamples:()=>me,parseSegmentIndex:()=>$,parseSinf:()=>Ne,patchEncyptionData:()=>be,readSint32:()=>re,readUint16:()=>q,readUint32:()=>j,segmentValidRange:()=>se,writeUint32:()=>X});var B=R(923),H=R(145),N=R(181),p=R(93),I=R(300),_=Math.pow(2,32)-1,de=[].push,Q={video:1,audio:2,id3:3,text:4};function ie(te){return String.fromCharCode.apply(null,te)}function q(te,ce){var ee=te[ce]<<8|te[ce+1];return ee<0?65536+ee:ee}function j(te,ce){var ee=re(te,ce);return ee<0?4294967296+ee:ee}function re(te,ce){return te[ce]<<24|te[ce+1]<<16|te[ce+2]<<8|te[ce+3]}function X(te,ce,ee){te[ce]=ee>>24,te[ce+1]=ee>>16&255,te[ce+2]=ee>>8&255,te[ce+3]=255&ee}function z(te,ce){var ee=[];if(!ce.length)return ee;for(var Se=te.byteLength,Te=0;Te<Se;){var we=j(te,Te),Le=we>1?Te+we:Se;if(ie(te.subarray(Te+4,Te+8))===ce[0])if(ce.length===1)ee.push(te.subarray(Te+8,Le));else{var Ce=z(te.subarray(Te+8,Le),ce.slice(1));Ce.length&&de.apply(ee,Ce)}Te=Le}return ee}function $(te){var ce=[],ee=te[0],Se=8,Te=j(te,Se);Se+=4,Se+=ee===0?8:16,Se+=2;var we=te.length+0,Le=q(te,Se);Se+=2;for(var Ce=0;Ce<Le;Ce++){var oe=Se,Ee=j(te,oe);oe+=4;var Be=2147483647&Ee;if((2147483648&Ee)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var Ve=j(te,oe);oe+=4,ce.push({referenceSize:Be,subsegmentDuration:Ve,info:{duration:Ve/Te,start:we,end:we+Be-1}}),we+=Be,Se=oe+=4}return{earliestPresentationTime:0,timescale:Te,version:ee,referencesCount:Le,references:ce}}function ve(te){for(var ce=[],ee=z(te,["moov","trak"]),Se=0;Se<ee.length;Se++){var Te=ee[Se],we=z(Te,["tkhd"])[0];if(we){var Le=we[0],Ce=Le===0?12:20,oe=j(we,Ce),Ee=z(Te,["mdia","mdhd"])[0];if(Ee){var Be=j(Ee,Ce=(Le=Ee[0])===0?12:20),Ve=z(Te,["mdia","hdlr"])[0];if(Ve){var st=ie(Ve.subarray(8,12)),et={soun:B.ElementaryStreamTypes.AUDIO,vide:B.ElementaryStreamTypes.VIDEO}[st];if(et){var yt=z(Te,["mdia","minf","stbl","stsd"])[0],gt=void 0;yt&&(gt=ie(yt.subarray(12,16))),ce[oe]={timescale:Be,type:et},ce[et]={timescale:Be,id:oe,codec:gt}}}}}}return z(te,["moov","mvex","trex"]).forEach(function(ct){var ht=j(ct,4),it=ce[ht];it&&(it.default={duration:j(ct,12),flags:j(ct,20)})}),ce}function be(te,ce){if(!te||!ce)return te;var ee=ce.keyId;return ee&&ce.isCommonEncryption&&z(te,["moov","trak"]).forEach(function(Se){var Te=z(Se,["mdia","minf","stbl","stsd"])[0].subarray(8),we=z(Te,["enca"]),Le=we.length>0;Le||(we=z(Te,["encv"])),we.forEach(function(Ce){z(Le?Ce.subarray(28):Ce.subarray(78),["sinf"]).forEach(function(oe){var Ee=Ne(oe);if(Ee){var Be=Ee.subarray(8,24);Be.some(function(Ve){return Ve!==0})||(p.logger.log("[eme] Patching keyId in 'enc"+(Le?"a":"v")+">sinf>>tenc' box: "+I.default.hexDump(Be)+" -> "+I.default.hexDump(ee)),Ee.set(ee,8))}})})}),te}function Ne(te){var ce=z(te,["schm"])[0];if(ce){var ee=ie(ce.subarray(4,8));if(ee==="cbcs"||ee==="cenc")return z(te,["schi","tenc"])[0]}return p.logger.error("[eme] missing 'schm' box"),null}function J(te,ce){return z(ce,["moof","traf"]).reduce(function(ee,Se){var Te=z(Se,["tfdt"])[0],we=Te[0],Le=z(Se,["tfhd"]).reduce(function(Ce,oe){var Ee=j(oe,4),Be=te[Ee];if(Be){var Ve=j(Te,4);we===1&&(Ve*=Math.pow(2,32),Ve+=j(Te,8));var st=Ve/(Be.timescale||9e4);if(isFinite(st)&&(Ce===null||st<Ce))return st}return Ce},null);return Le!==null&&isFinite(Le)&&(ee===null||Le<ee)?Le:ee},null)||0}function A(te,ce){for(var ee=0,Se=0,Te=0,we=z(te,["moof","traf"]),Le=0;Le<we.length;Le++){var Ce=we[Le],oe=z(Ce,["tfhd"])[0],Ee=ce[j(oe,4)];if(Ee){var Be=Ee.default,Ve=j(oe,0)|(Be==null?void 0:Be.flags),st=Be==null?void 0:Be.duration;8&Ve&&(st=j(oe,2&Ve?12:8));for(var et=Ee.timescale||9e4,yt=z(Ce,["trun"]),gt=0;gt<yt.length;gt++)!(ee=G(yt[gt]))&&st&&(ee=st*j(yt[gt],4)),Ee.type===B.ElementaryStreamTypes.VIDEO?Se+=ee/et:Ee.type===B.ElementaryStreamTypes.AUDIO&&(Te+=ee/et)}}if(Se===0&&Te===0){for(var ct=0,ht=z(te,["sidx"]),it=0;it<ht.length;it++){var Qe=$(ht[it]);Qe!=null&&Qe.references&&(ct+=Qe.references.reduce(function(pt,Et){return pt+Et.info.duration||0},0))}return ct}return Se||Te}function G(te){var ce=j(te,0),ee=8;1&ce&&(ee+=4),4&ce&&(ee+=4);for(var Se=0,Te=j(te,4),we=0;we<Te;we++)256&ce&&(Se+=j(te,ee),ee+=4),512&ce&&(ee+=4),1024&ce&&(ee+=4),2048&ce&&(ee+=4);return Se}function O(te,ce,ee){z(ce,["moof","traf"]).forEach(function(Se){z(Se,["tfhd"]).forEach(function(Te){var we=j(Te,4),Le=te[we];if(Le){var Ce=Le.timescale||9e4;z(Se,["tfdt"]).forEach(function(oe){var Ee=oe[0],Be=j(oe,4);if(Ee===0)Be-=ee*Ce,X(oe,4,Be=Math.max(Be,0));else{Be*=Math.pow(2,32),Be+=j(oe,8),Be-=ee*Ce,Be=Math.max(Be,0);var Ve=Math.floor(Be/(_+1)),st=Math.floor(Be%(_+1));X(oe,4,Ve),X(oe,8,st)}})}})})}function se(te){var ce={valid:null,remainder:null},ee=z(te,["moof"]);if(!ee)return ce;if(ee.length<2)return ce.remainder=te,ce;var Se=ee[ee.length-1];return ce.valid=(0,H.sliceUint8)(te,0,Se.byteOffset-8),ce.remainder=(0,H.sliceUint8)(te,Se.byteOffset-8),ce}function ye(te,ce){var ee=new Uint8Array(te.length+ce.length);return ee.set(te),ee.set(ce,te.length),ee}function me(te,ce){var ee=[],Se=ce.samples,Te=ce.timescale,we=ce.id,Le=!1;return z(Se,["moof"]).map(function(Ce){var oe=Ce.byteOffset-8;z(Ce,["traf"]).map(function(Ee){var Be=z(Ee,["tfdt"]).map(function(Ve){var st=Ve[0],et=j(Ve,4);return st===1&&(et*=Math.pow(2,32),et+=j(Ve,8)),et/Te})[0];return Be!==void 0&&(te=Be),z(Ee,["tfhd"]).map(function(Ve){var st=j(Ve,4),et=16777215&j(Ve,0),yt=0,gt=(16&et)!=0,ct=0,ht=(32&et)!=0,it=8;st===we&&(1&et&&(it+=8),2&et&&(it+=4),8&et&&(yt=j(Ve,it),it+=4),gt&&(ct=j(Ve,it),it+=4),ht&&(it+=4),ce.type==="video"&&(Le=function(Qe){if(!Qe)return!1;var pt=Qe.indexOf("."),Et=pt<0?Qe:Qe.substring(0,pt);return Et==="hvc1"||Et==="hev1"||Et==="dvh1"||Et==="dvhe"}(ce.codec)),z(Ee,["trun"]).map(function(Qe){var pt=Qe[0],Et=16777215&j(Qe,0),_t=(1&Et)!=0,Mt=0,It=(4&Et)!=0,Ht=(256&Et)!=0,W=0,M=(512&Et)!=0,b=0,x=(1024&Et)!=0,C=(2048&Et)!=0,U=0,V=j(Qe,4),Y=8;_t&&(Mt=j(Qe,Y),Y+=4),It&&(Y+=4);for(var ae=Mt+oe,fe=0;fe<V;fe++){if(Ht?(W=j(Qe,Y),Y+=4):W=yt,M?(b=j(Qe,Y),Y+=4):b=ct,x&&(Y+=4),C&&(U=pt===0?j(Qe,Y):re(Qe,Y),Y+=4),ce.type===B.ElementaryStreamTypes.VIDEO)for(var pe=0;pe<b;){var ke=j(Se,ae);ge(Le,Se[ae+=4])&&Pe(Se.subarray(ae,ae+ke),Le?2:1,te+U/Te,ee),ae+=ke,pe+=ke+4}te+=W/Te}}))})})}),ee}function ge(te,ce){if(te){var ee=ce>>1&63;return ee===39||ee===40}return(31&ce)==6}function Pe(te,ce,ee,Se){var Te=xe(te),we=0;we+=ce;for(var Le=0,Ce=0,oe=!1,Ee=0;we<Te.length;){Le=0;do{if(we>=Te.length)break;Le+=Ee=Te[we++]}while(Ee===255);Ce=0;do{if(we>=Te.length)break;Ce+=Ee=Te[we++]}while(Ee===255);var Be=Te.length-we;if(!oe&&Le===4&&we<Te.length){if(oe=!0,Te[we++]===181){var Ve=q(Te,we);if(we+=2,Ve===49){var st=j(Te,we);if(we+=4,st===1195456820){var et=Te[we++];if(et===3){var yt=Te[we++],gt=64&yt,ct=gt?2+3*(31&yt):0,ht=new Uint8Array(ct);if(gt){ht[0]=yt;for(var it=1;it<ct;it++)ht[it]=Te[we++]}Se.push({type:et,payloadType:Le,pts:ee,bytes:ht})}}}}}else if(Le===5&&Ce<Be){if(oe=!0,Ce>16){for(var Qe=[],pt=0;pt<16;pt++){var Et=Te[we++].toString(16);Qe.push(Et.length==1?"0"+Et:Et),pt!==3&&pt!==5&&pt!==7&&pt!==9||Qe.push("-")}for(var _t=Ce-16,Mt=new Uint8Array(_t),It=0;It<_t;It++)Mt[It]=Te[we++];Se.push({payloadType:Le,pts:ee,uuid:Qe.join(""),userData:(0,N.utf8ArrayToStr)(Mt),userDataBytes:Mt})}}else if(Ce<Be)we+=Ce;else if(Ce>Be)break}}function xe(te){for(var ce=te.byteLength,ee=[],Se=1;Se<ce-2;)te[Se]===0&&te[Se+1]===0&&te[Se+2]===3?(ee.push(Se+2),Se+=2):Se++;if(ee.length===0)return te;var Te=ce-ee.length,we=new Uint8Array(Te),Le=0;for(Se=0;Se<Te;Le++,Se++)Le===ee[0]&&(Le++,ee.shift()),we[Se]=te[Le];return we}function Fe(te){var ce=te[0],ee="",Se="",Te=0,we=0,Le=0,Ce=0,oe=0,Ee=0;if(ce===0){for(;ie(te.subarray(Ee,Ee+1))!=="\0";)ee+=ie(te.subarray(Ee,Ee+1)),Ee+=1;for(ee+=ie(te.subarray(Ee,Ee+1)),Ee+=1;ie(te.subarray(Ee,Ee+1))!=="\0";)Se+=ie(te.subarray(Ee,Ee+1)),Ee+=1;Se+=ie(te.subarray(Ee,Ee+1)),Ee+=1,Te=j(te,12),we=j(te,16),Ce=j(te,20),oe=j(te,24),Ee=28}else if(ce===1){Te=j(te,Ee+=4);var Be=j(te,Ee+=4),Ve=j(te,Ee+=4);for(Ee+=4,Le=Math.pow(2,32)*Be+Ve,Number.isSafeInteger(Le)||(Le=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),Ce=j(te,Ee),oe=j(te,Ee+=4),Ee+=4;ie(te.subarray(Ee,Ee+1))!=="\0";)ee+=ie(te.subarray(Ee,Ee+1)),Ee+=1;for(ee+=ie(te.subarray(Ee,Ee+1)),Ee+=1;ie(te.subarray(Ee,Ee+1))!=="\0";)Se+=ie(te.subarray(Ee,Ee+1)),Ee+=1;Se+=ie(te.subarray(Ee,Ee+1)),Ee+=1}return{schemeIdUri:ee,value:Se,timeScale:Te,presentationTime:Le,presentationTimeDelta:we,eventDuration:Ce,id:oe,payload:te.subarray(Ee,te.byteLength)}}function _e(te){for(var ce=arguments.length,ee=new Array(ce>1?ce-1:0),Se=1;Se<ce;Se++)ee[Se-1]=arguments[Se];for(var Te=ee.length,we=8,Le=Te;Le--;)we+=ee[Le].byteLength;var Ce=new Uint8Array(we);for(Ce[0]=we>>24&255,Ce[1]=we>>16&255,Ce[2]=we>>8&255,Ce[3]=255&we,Ce.set(te,4),Le=0,we=8;Le<Te;Le++)Ce.set(ee[Le],we),we+=ee[Le].byteLength;return Ce}function $e(te,ce,ee){if(te.byteLength!==16)throw new RangeError("Invalid system id");var Se,Te,we;if(ce){Se=1,Te=new Uint8Array(16*ce.length);for(var Le=0;Le<ce.length;Le++){var Ce=ce[Le];if(Ce.byteLength!==16)throw new RangeError("Invalid key");Te.set(Ce,16*Le)}}else Se=0,Te=new Uint8Array;Se>0?(we=new Uint8Array(4),ce.length>0&&new DataView(we.buffer).setUint32(0,ce.length,!1)):we=new Uint8Array;var oe=new Uint8Array(4);return ee&&ee.byteLength>0&&new DataView(oe.buffer).setUint32(0,ee.byteLength,!1),_e([112,115,115,104],new Uint8Array([Se,0,0,0]),te,we,Te,oe,ee||new Uint8Array)}function at(te){if(!(te instanceof ArrayBuffer)||te.byteLength<32)return null;var ce={version:0,systemId:"",kids:null,data:null},ee=new DataView(te),Se=ee.getUint32(0);if(te.byteLength!==Se&&Se>44||ee.getUint32(4)!==1886614376||(ce.version=ee.getUint32(8)>>>24,ce.version>1))return null;ce.systemId=I.default.hexDump(new Uint8Array(te,12,16));var Te=ee.getUint32(28);if(ce.version===0){if(Se-32<Te)return null;ce.data=new Uint8Array(te,32,Te)}else if(ce.version===1){ce.kids=[];for(var we=0;we<Te;we++)ce.kids.push(new Uint8Array(te,32+16*we,16))}return ce}},673:(w,L,R)=>{function B(I,_,de,Q){de===void 0&&(de=1),Q===void 0&&(Q=!1);var ie=I*_*de;return Q?Math.round(ie):ie}function H(I,_,de,Q){return de===void 0&&(de=1),Q===void 0&&(Q=!1),B(I,_,1/de,Q)}function N(I,_){return _===void 0&&(_=!1),B(I,1e3,11111111111111112e-21,_)}function p(I,_){return _===void 0&&(_=1),B(I,9e4,1/_)}R.r(L),R.d(L,{toMpegTsClockFromTimescale:()=>p,toMsFromMpegTsClock:()=>N,toTimescaleFromBase:()=>B,toTimescaleFromScale:()=>H})},145:(w,L,R)=>{function B(H,N,p){return Uint8Array.prototype.slice?H.slice(N,p):new Uint8Array(Array.prototype.slice.call(H,N,p))}R.r(L),R.d(L,{sliceUint8:()=>B})},729:w=>{var L=Object.prototype.hasOwnProperty,R="~";function B(){}function H(_,de,Q){this.fn=_,this.context=de,this.once=Q||!1}function N(_,de,Q,ie,q){if(typeof Q!="function")throw new TypeError("The listener must be a function");var j=new H(Q,ie||_,q),re=R?R+de:de;return _._events[re]?_._events[re].fn?_._events[re]=[_._events[re],j]:_._events[re].push(j):(_._events[re]=j,_._eventsCount++),_}function p(_,de){--_._eventsCount==0?_._events=new B:delete _._events[de]}function I(){this._events=new B,this._eventsCount=0}Object.create&&(B.prototype=Object.create(null),new B().__proto__||(R=!1)),I.prototype.eventNames=function(){var _,de,Q=[];if(this._eventsCount===0)return Q;for(de in _=this._events)L.call(_,de)&&Q.push(R?de.slice(1):de);return Object.getOwnPropertySymbols?Q.concat(Object.getOwnPropertySymbols(_)):Q},I.prototype.listeners=function(_){var de=R?R+_:_,Q=this._events[de];if(!Q)return[];if(Q.fn)return[Q.fn];for(var ie=0,q=Q.length,j=new Array(q);ie<q;ie++)j[ie]=Q[ie].fn;return j},I.prototype.listenerCount=function(_){var de=R?R+_:_,Q=this._events[de];return Q?Q.fn?1:Q.length:0},I.prototype.emit=function(_,de,Q,ie,q,j){var re=R?R+_:_;if(!this._events[re])return!1;var X,z,$=this._events[re],ve=arguments.length;if($.fn){switch($.once&&this.removeListener(_,$.fn,void 0,!0),ve){case 1:return $.fn.call($.context),!0;case 2:return $.fn.call($.context,de),!0;case 3:return $.fn.call($.context,de,Q),!0;case 4:return $.fn.call($.context,de,Q,ie),!0;case 5:return $.fn.call($.context,de,Q,ie,q),!0;case 6:return $.fn.call($.context,de,Q,ie,q,j),!0}for(z=1,X=new Array(ve-1);z<ve;z++)X[z-1]=arguments[z];$.fn.apply($.context,X)}else{var be,Ne=$.length;for(z=0;z<Ne;z++)switch($[z].once&&this.removeListener(_,$[z].fn,void 0,!0),ve){case 1:$[z].fn.call($[z].context);break;case 2:$[z].fn.call($[z].context,de);break;case 3:$[z].fn.call($[z].context,de,Q);break;case 4:$[z].fn.call($[z].context,de,Q,ie);break;default:if(!X)for(be=1,X=new Array(ve-1);be<ve;be++)X[be-1]=arguments[be];$[z].fn.apply($[z].context,X)}}return!0},I.prototype.on=function(_,de,Q){return N(this,_,de,Q,!1)},I.prototype.once=function(_,de,Q){return N(this,_,de,Q,!0)},I.prototype.removeListener=function(_,de,Q,ie){var q=R?R+_:_;if(!this._events[q])return this;if(!de)return p(this,q),this;var j=this._events[q];if(j.fn)j.fn!==de||ie&&!j.once||Q&&j.context!==Q||p(this,q);else{for(var re=0,X=[],z=j.length;re<z;re++)(j[re].fn!==de||ie&&!j[re].once||Q&&j[re].context!==Q)&&X.push(j[re]);X.length?this._events[q]=X.length===1?X[0]:X:p(this,q)}return this},I.prototype.removeAllListeners=function(_){var de;return _?(de=R?R+_:_,this._events[de]&&p(this,de)):(this._events=new B,this._eventsCount=0),this},I.prototype.off=I.prototype.removeListener,I.prototype.addListener=I.prototype.on,I.prefixed=R,I.EventEmitter=I,w.exports=I},945:function(w){var L,R,B,H,N;L=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,R=/^(?=([^\/?#]*))\1([^]*)$/,B=/(?:\/|^)\.(?=\/)/g,H=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,N={buildAbsoluteURL:function(p,I,_){if(_=_||{},p=p.trim(),!(I=I.trim())){if(!_.alwaysNormalize)return p;var de=N.parseURL(p);if(!de)throw new Error("Error trying to parse base URL.");return de.path=N.normalizePath(de.path),N.buildURLFromParts(de)}var Q=N.parseURL(I);if(!Q)throw new Error("Error trying to parse relative URL.");if(Q.scheme)return _.alwaysNormalize?(Q.path=N.normalizePath(Q.path),N.buildURLFromParts(Q)):I;var ie=N.parseURL(p);if(!ie)throw new Error("Error trying to parse base URL.");if(!ie.netLoc&&ie.path&&ie.path[0]!=="/"){var q=R.exec(ie.path);ie.netLoc=q[1],ie.path=q[2]}ie.netLoc&&!ie.path&&(ie.path="/");var j={scheme:ie.scheme,netLoc:Q.netLoc,path:null,params:Q.params,query:Q.query,fragment:Q.fragment};if(!Q.netLoc&&(j.netLoc=ie.netLoc,Q.path[0]!=="/"))if(Q.path){var re=ie.path,X=re.substring(0,re.lastIndexOf("/")+1)+Q.path;j.path=N.normalizePath(X)}else j.path=ie.path,Q.params||(j.params=ie.params,Q.query||(j.query=ie.query));return j.path===null&&(j.path=_.alwaysNormalize?N.normalizePath(Q.path):Q.path),N.buildURLFromParts(j)},parseURL:function(p){var I=L.exec(p);return I?{scheme:I[1]||"",netLoc:I[2]||"",path:I[3]||"",params:I[4]||"",query:I[5]||"",fragment:I[6]||""}:null},normalizePath:function(p){for(p=p.split("").reverse().join("").replace(B,"");p.length!==(p=p.replace(H,"")).length;);return p.split("").reverse().join("")},buildURLFromParts:function(p){return p.scheme+p.netLoc+p.path+p.params+p.query+p.fragment}},w.exports=N}},v={};function E(w){var L=v[w];if(L!==void 0)return L.exports;var R=v[w]={exports:{}};return c[w].call(R.exports,R,R.exports,E),R.exports}E.m=c,E.n=w=>{var L=w&&w.__esModule?()=>w.default:()=>w;return E.d(L,{a:L}),L},E.d=(w,L)=>{for(var R in L)E.o(L,R)&&!E.o(w,R)&&Object.defineProperty(w,R,{enumerable:!0,get:L[R]})},E.o=(w,L)=>Object.prototype.hasOwnProperty.call(w,L),E.r=w=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(w,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(w,"__esModule",{value:!0})};var T=E(76);return T.default})())})(Ya);const Wa=qa(Xr);function Me(o,g,c){return g in o?Object.defineProperty(o,g,{value:c,enumerable:!0,configurable:!0,writable:!0}):o[g]=c,o}function $a(o,g){if(!(o instanceof g))throw new TypeError("Cannot call a class as a function")}function Jn(o,g){for(var c=0;c<g.length;c++){var v=g[c];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(o,v.key,v)}}function za(o,g,c){return g&&Jn(o.prototype,g),c&&Jn(o,c),o}function Xa(o,g,c){return g in o?Object.defineProperty(o,g,{value:c,enumerable:!0,configurable:!0,writable:!0}):o[g]=c,o}function Zn(o,g){var c=Object.keys(o);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(o);g&&(v=v.filter(function(E){return Object.getOwnPropertyDescriptor(o,E).enumerable})),c.push.apply(c,v)}return c}function es(o){for(var g=1;g<arguments.length;g++){var c=arguments[g]!=null?arguments[g]:{};g%2?Zn(Object(c),!0).forEach(function(v){Xa(o,v,c[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(c)):Zn(Object(c)).forEach(function(v){Object.defineProperty(o,v,Object.getOwnPropertyDescriptor(c,v))})}return o}var ts={addCSS:!0,thumbWidth:15,watch:!0};function Qa(o,g){return function(){return Array.from(document.querySelectorAll(g)).includes(this)}.call(o,g)}function Ja(o,g){if(o&&g){var c=new Event(g,{bubbles:!0});o.dispatchEvent(c)}}var Hi=function(o){return o!=null?o.constructor:null},sn=function(o,g){return!!(o&&g&&o instanceof g)},os=function(o){return o==null},ls=function(o){return Hi(o)===Object},Za=function(o){return Hi(o)===Number&&!Number.isNaN(o)},us=function(o){return Hi(o)===String},eo=function(o){return Hi(o)===Boolean},to=function(o){return Hi(o)===Function},cs=function(o){return Array.isArray(o)},hs=function(o){return sn(o,NodeList)},io=function(o){return sn(o,Element)},ro=function(o){return sn(o,Event)},no=function(o){return os(o)||(us(o)||cs(o)||hs(o))&&!o.length||ls(o)&&!Object.keys(o).length},Gt={nullOrUndefined:os,object:ls,number:Za,string:us,boolean:eo,function:to,array:cs,nodeList:hs,element:io,event:ro,empty:no};function so(o){var g="".concat(o).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return g?Math.max(0,(g[1]?g[1].length:0)-(g[2]?+g[2]:0)):0}function ao(o,g){if(1>g){var c=so(g);return parseFloat(o.toFixed(c))}return Math.round(o/g)*g}var oo=function(){function o(g,c){$a(this,o),Gt.element(g)?this.element=g:Gt.string(g)&&(this.element=document.querySelector(g)),Gt.element(this.element)&&Gt.empty(this.element.rangeTouch)&&(this.config=es({},ts,{},c),this.init())}return za(o,[{key:"init",value:function(){o.enabled&&(this.config.addCSS&&(this.element.style.userSelect="none",this.element.style.webKitUserSelect="none",this.element.style.touchAction="manipulation"),this.listeners(!0),this.element.rangeTouch=this)}},{key:"destroy",value:function(){o.enabled&&(this.config.addCSS&&(this.element.style.userSelect="",this.element.style.webKitUserSelect="",this.element.style.touchAction=""),this.listeners(!1),this.element.rangeTouch=null)}},{key:"listeners",value:function(g){var c=this,v=g?"addEventListener":"removeEventListener";["touchstart","touchmove","touchend"].forEach(function(E){c.element[v](E,function(T){return c.set(T)},!1)})}},{key:"get",value:function(g){if(!o.enabled||!Gt.event(g))return null;var c,v=g.target,E=g.changedTouches[0],T=parseFloat(v.getAttribute("min"))||0,w=parseFloat(v.getAttribute("max"))||100,L=parseFloat(v.getAttribute("step"))||1,R=v.getBoundingClientRect(),B=100/R.width*(this.config.thumbWidth/2)/100;return 0>(c=100/R.width*(E.clientX-R.left))?c=0:100<c&&(c=100),50>c?c-=(100-2*c)*B:50<c&&(c+=2*(c-50)*B),T+ao(c/100*(w-T),L)}},{key:"set",value:function(g){o.enabled&&Gt.event(g)&&!g.target.disabled&&(g.preventDefault(),g.target.value=this.get(g),Ja(g.target,g.type==="touchend"?"change":"input"))}}],[{key:"setup",value:function(g){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},v=null;if(Gt.empty(g)||Gt.string(g)?v=Array.from(document.querySelectorAll(Gt.string(g)?g:'input[type="range"]')):Gt.element(g)?v=[g]:Gt.nodeList(g)?v=Array.from(g):Gt.array(g)&&(v=g.filter(Gt.element)),Gt.empty(v))return null;var E=es({},ts,{},c);if(Gt.string(g)&&E.watch){var T=new MutationObserver(function(w){Array.from(w).forEach(function(L){Array.from(L.addedNodes).forEach(function(R){Gt.element(R)&&Qa(R,g)&&new o(R,E)})})});T.observe(document.body,{childList:!0,subtree:!0})}return v.map(function(w){return new o(w,c)})}},{key:"enabled",get:function(){return"ontouchstart"in document.documentElement}}]),o}();const Vi=o=>o!=null?o.constructor:null,ui=(o,g)=>Boolean(o&&g&&o instanceof g),an=o=>o==null,ds=o=>Vi(o)===Object,lo=o=>Vi(o)===Number&&!Number.isNaN(o),ar=o=>Vi(o)===String,uo=o=>Vi(o)===Boolean,fs=o=>typeof o=="function",gs=o=>Array.isArray(o),co=o=>ui(o,WeakMap),ps=o=>ui(o,NodeList),ho=o=>Vi(o)===Text,fo=o=>ui(o,Event),go=o=>ui(o,KeyboardEvent),po=o=>ui(o,window.TextTrackCue)||ui(o,window.VTTCue),mo=o=>ui(o,TextTrack)||!an(o)&&ar(o.kind),vo=o=>ui(o,Promise)&&fs(o.then),yo=o=>o!==null&&typeof o=="object"&&o.nodeType===1&&typeof o.style=="object"&&typeof o.ownerDocument=="object",ms=o=>an(o)||(ar(o)||gs(o)||ps(o))&&!o.length||ds(o)&&!Object.keys(o).length,Eo=o=>{if(ui(o,window.URL))return!0;if(!ar(o))return!1;let g=o;o.startsWith("http://")&&o.startsWith("https://")||(g=`http://${o}`);try{return!ms(new URL(g).hostname)}catch{return!1}};var D={nullOrUndefined:an,object:ds,number:lo,string:ar,boolean:uo,function:fs,array:gs,weakMap:co,nodeList:ps,element:yo,textNode:ho,event:fo,keyboardEvent:go,cue:po,track:mo,promise:vo,url:Eo,empty:ms};const Qr=(()=>{const o=document.createElement("span"),g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},c=Object.keys(g).find(v=>o.style[v]!==void 0);return!!D.string(c)&&g[c]})();function vs(o,g){setTimeout(()=>{try{o.hidden=!0,o.offsetHeight,o.hidden=!1}catch{}},g)}const Bt={isIE:Boolean(window.document.documentMode),isEdge:/Edge/g.test(navigator.userAgent),isWebkit:"WebkitAppearance"in document.documentElement.style&&!/Edge/g.test(navigator.userAgent),isIPhone:/iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1,isIos:/iPad|iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1};function bo(o){return JSON.parse(JSON.stringify(o))}function ys(o,g){return g.split(".").reduce((c,v)=>c&&c[v],o)}function Ct(o={},...g){if(!g.length)return o;const c=g.shift();return D.object(c)?(Object.keys(c).forEach(v=>{D.object(c[v])?(Object.keys(o).includes(v)||Object.assign(o,{[v]:{}}),Ct(o[v],c[v])):Object.assign(o,{[v]:c[v]})}),Ct(o,...g)):o}function Es(o,g){const c=o.length?o:[o];Array.from(c).reverse().forEach((v,E)=>{const T=E>0?g.cloneNode(!0):g,w=v.parentNode,L=v.nextSibling;T.appendChild(v),L?w.insertBefore(T,L):w.appendChild(T)})}function Jr(o,g){D.element(o)&&!D.empty(g)&&Object.entries(g).filter(([,c])=>!D.nullOrUndefined(c)).forEach(([c,v])=>o.setAttribute(c,v))}function qe(o,g,c){const v=document.createElement(o);return D.object(g)&&Jr(v,g),D.string(c)&&(v.innerText=c),v}function To(o,g){D.element(o)&&D.element(g)&&g.parentNode.insertBefore(o,g.nextSibling)}function is(o,g,c,v){D.element(g)&&g.appendChild(qe(o,c,v))}function li(o){D.nodeList(o)||D.array(o)?Array.from(o).forEach(li):D.element(o)&&D.element(o.parentNode)&&o.parentNode.removeChild(o)}function er(o){if(!D.element(o))return;let{length:g}=o.childNodes;for(;g>0;)o.removeChild(o.lastChild),g-=1}function rr(o,g){return D.element(g)&&D.element(g.parentNode)&&D.element(o)?(g.parentNode.replaceChild(o,g),o):null}function ei(o,g){if(!D.string(o)||D.empty(o))return{};const c={},v=Ct({},g);return o.split(",").forEach(E=>{const T=E.trim(),w=T.replace(".",""),L=T.replace(/[[\]]/g,"").split("="),[R]=L,B=L.length>1?L[1].replace(/["']/g,""):"";switch(T.charAt(0)){case".":D.string(v.class)?c.class=`${v.class} ${w}`:c.class=w;break;case"#":c.id=T.replace("#","");break;case"[":c[R]=B}}),Ct(v,c)}function Ei(o,g){if(!D.element(o))return;let c=g;D.boolean(c)||(c=!o.hidden),o.hidden=c}function ut(o,g,c){if(D.nodeList(o))return Array.from(o).map(v=>ut(v,g,c));if(D.element(o)){let v="toggle";return c!==void 0&&(v=c?"add":"remove"),o.classList[v](g),o.classList.contains(g)}return!1}function nr(o,g){return D.element(o)&&o.classList.contains(g)}function bi(o,g){const{prototype:c}=Element;return(c.matches||c.webkitMatchesSelector||c.mozMatchesSelector||c.msMatchesSelector||function(){return Array.from(document.querySelectorAll(g)).includes(this)}).call(o,g)}function So(o,g){const{prototype:c}=Element;return(c.closest||function(){let v=this;do{if(bi.matches(v,g))return v;v=v.parentElement||v.parentNode}while(v!==null&&v.nodeType===1);return null}).call(o,g)}function Di(o){return this.elements.container.querySelectorAll(o)}function Ft(o){return this.elements.container.querySelector(o)}function Yr(o=null,g=!1){D.element(o)&&(o.focus({preventScroll:!0}),g&&ut(o,this.config.classNames.tabFocus))}const rs={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"},Dt={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check(o,g,c){const v=Bt.isIPhone&&c&&Dt.playsinline,E=Dt[o]||g!=="html5";return{api:E,ui:E&&Dt.rangeInput&&(o!=="video"||!Bt.isIPhone||v)}},pip:!(Bt.isIPhone||!D.function(qe("video").webkitSetPresentationMode)&&(!document.pictureInPictureEnabled||qe("video").disablePictureInPicture)),airplay:D.function(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime(o){if(D.empty(o))return!1;const[g]=o.split("/");let c=o;if(!this.isHTML5||g!==this.type)return!1;Object.keys(rs).includes(c)&&(c+=`; codecs="${rs[o]}"`);try{return Boolean(c&&this.media.canPlayType(c).replace(/no/,""))}catch{return!1}},textTracks:"textTracks"in document.createElement("video"),rangeInput:(()=>{const o=document.createElement("input");return o.type="range",o.type==="range"})(),touch:"ontouchstart"in document.documentElement,transitions:Qr!==!1,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches},ko=(()=>{let o=!1;try{const g=Object.defineProperty({},"passive",{get:()=>(o=!0,null)});window.addEventListener("test",null,g),window.removeEventListener("test",null,g)}catch{}return o})();function Ii(o,g,c,v=!1,E=!0,T=!1){if(!o||!("addEventListener"in o)||D.empty(g)||!D.function(c))return;const w=g.split(" ");let L=T;ko&&(L={passive:E,capture:T}),w.forEach(R=>{this&&this.eventListeners&&v&&this.eventListeners.push({element:o,type:R,callback:c,options:L}),o[v?"addEventListener":"removeEventListener"](R,c,L)})}function dt(o,g="",c,v=!0,E=!1){Ii.call(this,o,g,c,!0,v,E)}function or(o,g="",c,v=!0,E=!1){Ii.call(this,o,g,c,!1,v,E)}function on(o,g="",c,v=!0,E=!1){const T=(...w)=>{or(o,g,T,v,E),c.apply(this,w)};Ii.call(this,o,g,T,!0,v,E)}function We(o,g="",c=!1,v={}){if(!D.element(o)||D.empty(g))return;const E=new CustomEvent(g,{bubbles:c,detail:{...v,plyr:this}});o.dispatchEvent(E)}function Ao(){this&&this.eventListeners&&(this.eventListeners.forEach(o=>{const{element:g,type:c,callback:v,options:E}=o;g.removeEventListener(c,v,E)}),this.eventListeners=[])}function wo(){return new Promise(o=>this.ready?setTimeout(o,0):dt.call(this,this.elements.container,"ready",o)).then(()=>{})}function ii(o){D.promise(o)&&o.then(null,()=>{})}function Zr(o){return D.array(o)?o.filter((g,c)=>o.indexOf(g)===c):o}function bs(o,g){return D.array(o)&&o.length?o.reduce((c,v)=>Math.abs(v-g)<Math.abs(c-g)?v:c):null}function Ts(o){return!(!window||!window.CSS)&&window.CSS.supports(o)}const ns=[[1,1],[4,3],[3,4],[5,4],[4,5],[3,2],[2,3],[16,10],[10,16],[16,9],[9,16],[21,9],[9,21],[32,9],[9,32]].reduce((o,[g,c])=>({...o,[g/c]:[g,c]}),{});function Ss(o){return D.array(o)||D.string(o)&&o.includes(":")?(D.array(o)?o:o.split(":")).map(Number).every(D.number):!1}function sr(o){if(!D.array(o)||!o.every(D.number))return null;const[g,c]=o,v=(T,w)=>w===0?T:v(w,T%w),E=v(g,c);return[g/E,c/E]}function ln(o){const g=v=>Ss(v)?v.split(":").map(Number):null;let c=g(o);if(c===null&&(c=g(this.config.ratio)),c===null&&!D.empty(this.embed)&&D.array(this.embed.ratio)&&({ratio:c}=this.embed),c===null&&this.isHTML5){const{videoWidth:v,videoHeight:E}=this.media;c=[v,E]}return sr(c)}function Ri(o){if(!this.isVideo)return{};const{wrapper:g}=this.elements,c=ln.call(this,o);if(!D.array(c))return{};const[v,E]=sr(c),T=100/v*E;if(Ts(`aspect-ratio: ${v}/${E}`)?g.style.aspectRatio=`${v}/${E}`:g.style.paddingBottom=`${T}%`,this.isVimeo&&!this.config.vimeo.premium&&this.supported.ui){const w=100/this.media.offsetWidth*parseInt(window.getComputedStyle(this.media).paddingBottom,10),L=(w-T)/(w/50);this.fullscreen.active?g.style.paddingBottom=null:this.media.style.transform=`translateY(-${L}%)`}else this.isHTML5&&g.classList.add(this.config.classNames.videoFixedRatio);return{padding:T,ratio:c}}function ks(o,g,c=.05){const v=o/g,E=bs(Object.keys(ns),v);return Math.abs(E-v)<=c?ns[E]:[o,g]}function Lo(){return[Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)]}const fi={getSources(){return this.isHTML5?Array.from(this.media.querySelectorAll("source")).filter(o=>{const g=o.getAttribute("type");return!!D.empty(g)||Dt.mime.call(this,g)}):[]},getQualityOptions(){return this.config.quality.forced?this.config.quality.options:fi.getSources.call(this).map(o=>Number(o.getAttribute("size"))).filter(Boolean)},setup(){if(!this.isHTML5)return;const o=this;o.options.speed=o.config.speed.options,D.empty(this.config.ratio)||Ri.call(o),Object.defineProperty(o.media,"quality",{get(){const g=fi.getSources.call(o).find(c=>c.getAttribute("src")===o.source);return g&&Number(g.getAttribute("size"))},set(g){if(o.quality!==g){if(o.config.quality.forced&&D.function(o.config.quality.onChange))o.config.quality.onChange(g);else{const c=fi.getSources.call(o).find(R=>Number(R.getAttribute("size"))===g);if(!c)return;const{currentTime:v,paused:E,preload:T,readyState:w,playbackRate:L}=o.media;o.media.src=c.getAttribute("src"),(T!=="none"||w)&&(o.once("loadedmetadata",()=>{o.speed=L,o.currentTime=v,E||ii(o.play())}),o.media.load())}We.call(o,o.media,"qualitychange",!1,{quality:g})}}})},cancelRequests(){this.isHTML5&&(li(fi.getSources.call(this)),this.media.setAttribute("src",this.config.blankVideo),this.media.load(),this.debug.log("Cancelled network requests"))}};function Do(o){return`${o}-${Math.floor(1e4*Math.random())}`}function en(o,...g){return D.empty(o)?o:o.toString().replace(/{(\d+)}/g,(c,v)=>g[v].toString())}function Io(o,g){return o===0||g===0||Number.isNaN(o)||Number.isNaN(g)?0:(o/g*100).toFixed(2)}const Ki=(o="",g="",c="")=>o.replace(new RegExp(g.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),c.toString()),As=(o="")=>o.toString().replace(/\w\S*/g,g=>g.charAt(0).toUpperCase()+g.slice(1).toLowerCase());function Ro(o=""){let g=o.toString();return g=Ki(g,"-"," "),g=Ki(g,"_"," "),g=As(g),Ki(g," ","")}function Co(o=""){let g=o.toString();return g=Ro(g),g.charAt(0).toLowerCase()+g.slice(1)}function _o(o){const g=document.createDocumentFragment(),c=document.createElement("div");return g.appendChild(c),c.innerHTML=o,g.firstChild.innerText}function Po(o){const g=document.createElement("div");return g.appendChild(o),g.innerHTML}const ss={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"},Nt={get(o="",g={}){if(D.empty(o)||D.empty(g))return"";let c=ys(g.i18n,o);if(D.empty(c))return Object.keys(ss).includes(o)?ss[o]:"";const v={"{seektime}":g.seekTime,"{title}":g.title};return Object.entries(v).forEach(([E,T])=>{c=Ki(c,E,T)}),c}};class Gi{constructor(g){Me(this,"get",c=>{if(!Gi.supported||!this.enabled)return null;const v=window.localStorage.getItem(this.key);if(D.empty(v))return null;const E=JSON.parse(v);return D.string(c)&&c.length?E[c]:E}),Me(this,"set",c=>{if(!Gi.supported||!this.enabled||!D.object(c))return;let v=this.get();D.empty(v)&&(v={}),Ct(v,c);try{window.localStorage.setItem(this.key,JSON.stringify(v))}catch{}}),this.enabled=g.config.storage.enabled,this.key=g.config.storage.key}static get supported(){try{if(!("localStorage"in window))return!1;const g="___test";return window.localStorage.setItem(g,g),window.localStorage.removeItem(g),!0}catch{return!1}}}function qi(o,g="text"){return new Promise((c,v)=>{try{const E=new XMLHttpRequest;if(!("withCredentials"in E))return;E.addEventListener("load",()=>{if(g==="text")try{c(JSON.parse(E.responseText))}catch{c(E.responseText)}else c(E.response)}),E.addEventListener("error",()=>{throw new Error(E.status)}),E.open("GET",o,!0),E.responseType=g,E.send()}catch(E){v(E)}})}function ws(o,g){if(!D.string(o))return;const c=D.string(g);let v=!1;const E=()=>document.getElementById(g)!==null,T=(w,L)=>{w.innerHTML=L,c&&E()||document.body.insertAdjacentElement("afterbegin",w)};if(!c||!E()){const w=Gi.supported,L=document.createElement("div");if(L.setAttribute("hidden",""),c&&L.setAttribute("id",g),w){const R=window.localStorage.getItem(`cache-${g}`);if(v=R!==null,v){const B=JSON.parse(R);T(L,B.content)}}qi(o).then(R=>{if(!D.empty(R)){if(w)try{window.localStorage.setItem(`cache-${g}`,JSON.stringify({content:R}))}catch{}T(L,R)}}).catch(()=>{})}}const Ls=o=>Math.trunc(o/60/60%60,10),Oo=o=>Math.trunc(o%60,10);function lr(o=0,g=!1,c=!1){if(!D.number(o))return lr(void 0,g,c);const v=R=>`0${R}`.slice(-2);let E=Ls(o);const T=(w=o,Math.trunc(w/60%60,10));var w;const L=Oo(o);return E=g||E>0?`${E}:`:"",`${c&&o>0?"-":""}${E}${v(T)}:${v(L)}`}const Oe={getIconUrl(){const o=new URL(this.config.iconUrl,window.location),g=window.location.host?window.location.host:window.top.location.host,c=o.host!==g||Bt.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:c}},findElements(){try{return this.elements.controls=Ft.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:Di.call(this,this.config.selectors.buttons.play),pause:Ft.call(this,this.config.selectors.buttons.pause),restart:Ft.call(this,this.config.selectors.buttons.restart),rewind:Ft.call(this,this.config.selectors.buttons.rewind),fastForward:Ft.call(this,this.config.selectors.buttons.fastForward),mute:Ft.call(this,this.config.selectors.buttons.mute),pip:Ft.call(this,this.config.selectors.buttons.pip),airplay:Ft.call(this,this.config.selectors.buttons.airplay),settings:Ft.call(this,this.config.selectors.buttons.settings),captions:Ft.call(this,this.config.selectors.buttons.captions),fullscreen:Ft.call(this,this.config.selectors.buttons.fullscreen)},this.elements.progress=Ft.call(this,this.config.selectors.progress),this.elements.inputs={seek:Ft.call(this,this.config.selectors.inputs.seek),volume:Ft.call(this,this.config.selectors.inputs.volume)},this.elements.display={buffer:Ft.call(this,this.config.selectors.display.buffer),currentTime:Ft.call(this,this.config.selectors.display.currentTime),duration:Ft.call(this,this.config.selectors.display.duration)},D.element(this.elements.progress)&&(this.elements.display.seekTooltip=this.elements.progress.querySelector(`.${this.config.classNames.tooltip}`)),!0}catch(o){return this.debug.warn("It looks like there is a problem with your custom controls HTML",o),this.toggleNativeControls(!0),!1}},createIcon(o,g){const c="http://www.w3.org/2000/svg",v=Oe.getIconUrl.call(this),E=`${v.cors?"":v.url}#${this.config.iconPrefix}`,T=document.createElementNS(c,"svg");Jr(T,Ct(g,{"aria-hidden":"true",focusable:"false"}));const w=document.createElementNS(c,"use"),L=`${E}-${o}`;return"href"in w&&w.setAttributeNS("http://www.w3.org/1999/xlink","href",L),w.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",L),T.appendChild(w),T},createLabel(o,g={}){const c=Nt.get(o,this.config);return qe("span",{...g,class:[g.class,this.config.classNames.hidden].filter(Boolean).join(" ")},c)},createBadge(o){if(D.empty(o))return null;const g=qe("span",{class:this.config.classNames.menu.value});return g.appendChild(qe("span",{class:this.config.classNames.menu.badge},o)),g},createButton(o,g){const c=Ct({},g);let v=Co(o);const E={element:"button",toggle:!1,label:null,icon:null,labelPressed:null,iconPressed:null};switch(["element","icon","label"].forEach(w=>{Object.keys(c).includes(w)&&(E[w]=c[w],delete c[w])}),E.element!=="button"||Object.keys(c).includes("type")||(c.type="button"),Object.keys(c).includes("class")?c.class.split(" ").some(w=>w===this.config.classNames.control)||Ct(c,{class:`${c.class} ${this.config.classNames.control}`}):c.class=this.config.classNames.control,o){case"play":E.toggle=!0,E.label="play",E.labelPressed="pause",E.icon="play",E.iconPressed="pause";break;case"mute":E.toggle=!0,E.label="mute",E.labelPressed="unmute",E.icon="volume",E.iconPressed="muted";break;case"captions":E.toggle=!0,E.label="enableCaptions",E.labelPressed="disableCaptions",E.icon="captions-off",E.iconPressed="captions-on";break;case"fullscreen":E.toggle=!0,E.label="enterFullscreen",E.labelPressed="exitFullscreen",E.icon="enter-fullscreen",E.iconPressed="exit-fullscreen";break;case"play-large":c.class+=` ${this.config.classNames.control}--overlaid`,v="play",E.label="play",E.icon="play";break;default:D.empty(E.label)&&(E.label=v),D.empty(E.icon)&&(E.icon=o)}const T=qe(E.element);return E.toggle?(T.appendChild(Oe.createIcon.call(this,E.iconPressed,{class:"icon--pressed"})),T.appendChild(Oe.createIcon.call(this,E.icon,{class:"icon--not-pressed"})),T.appendChild(Oe.createLabel.call(this,E.labelPressed,{class:"label--pressed"})),T.appendChild(Oe.createLabel.call(this,E.label,{class:"label--not-pressed"}))):(T.appendChild(Oe.createIcon.call(this,E.icon)),T.appendChild(Oe.createLabel.call(this,E.label))),Ct(c,ei(this.config.selectors.buttons[v],c)),Jr(T,c),v==="play"?(D.array(this.elements.buttons[v])||(this.elements.buttons[v]=[]),this.elements.buttons[v].push(T)):this.elements.buttons[v]=T,T},createRange(o,g){const c=qe("input",Ct(ei(this.config.selectors.inputs[o]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":Nt.get(o,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},g));return this.elements.inputs[o]=c,Oe.updateRangeFill.call(this,c),oo.setup(c),c},createProgress(o,g){const c=qe("progress",Ct(ei(this.config.selectors.display[o]),{min:0,max:100,value:0,role:"progressbar","aria-hidden":!0},g));if(o!=="volume"){c.appendChild(qe("span",null,"0"));const v={played:"played",buffer:"buffered"}[o],E=v?Nt.get(v,this.config):"";c.innerText=`% ${E.toLowerCase()}`}return this.elements.display[o]=c,c},createTime(o,g){const c=ei(this.config.selectors.display[o],g),v=qe("div",Ct(c,{class:`${c.class?c.class:""} ${this.config.classNames.display.time} `.trim(),"aria-label":Nt.get(o,this.config)}),"00:00");return this.elements.display[o]=v,v},bindMenuItemShortcuts(o,g){dt.call(this,o,"keydown keyup",c=>{if(!["Space","ArrowUp","ArrowDown","ArrowRight"].includes(c.key)||(c.preventDefault(),c.stopPropagation(),c.type==="keydown"))return;const v=bi(o,'[role="menuitemradio"]');if(!v&&["Space","ArrowRight"].includes(c.key))Oe.showMenuPanel.call(this,g,!0);else{let E;c.key!=="Space"&&(c.key==="ArrowDown"||v&&c.key==="ArrowRight"?(E=o.nextElementSibling,D.element(E)||(E=o.parentNode.firstElementChild)):(E=o.previousElementSibling,D.element(E)||(E=o.parentNode.lastElementChild)),Yr.call(this,E,!0))}},!1),dt.call(this,o,"keyup",c=>{c.key==="Return"&&Oe.focusFirstMenuItem.call(this,null,!0)})},createMenuItem({value:o,list:g,type:c,title:v,badge:E=null,checked:T=!1}){const w=ei(this.config.selectors.inputs[c]),L=qe("button",Ct(w,{type:"button",role:"menuitemradio",class:`${this.config.classNames.control} ${w.class?w.class:""}`.trim(),"aria-checked":T,value:o})),R=qe("span");R.innerHTML=v,D.element(E)&&R.appendChild(E),L.appendChild(R),Object.defineProperty(L,"checked",{enumerable:!0,get:()=>L.getAttribute("aria-checked")==="true",set(B){B&&Array.from(L.parentNode.children).filter(H=>bi(H,'[role="menuitemradio"]')).forEach(H=>H.setAttribute("aria-checked","false")),L.setAttribute("aria-checked",B?"true":"false")}}),this.listeners.bind(L,"click keyup",B=>{if(!D.keyboardEvent(B)||B.key==="Space"){switch(B.preventDefault(),B.stopPropagation(),L.checked=!0,c){case"language":this.currentTrack=Number(o);break;case"quality":this.quality=o;break;case"speed":this.speed=parseFloat(o)}Oe.showMenuPanel.call(this,"home",D.keyboardEvent(B))}},c,!1),Oe.bindMenuItemShortcuts.call(this,L,c),g.appendChild(L)},formatTime(o=0,g=!1){return D.number(o)?lr(o,Ls(this.duration)>0,g):o},updateTimeDisplay(o=null,g=0,c=!1){D.element(o)&&D.number(g)&&(o.innerText=Oe.formatTime(g,c))},updateVolume(){this.supported.ui&&(D.element(this.elements.inputs.volume)&&Oe.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),D.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||this.volume===0))},setRange(o,g=0){D.element(o)&&(o.value=g,Oe.updateRangeFill.call(this,o))},updateProgress(o){if(!this.supported.ui||!D.event(o))return;let g=0;const c=(v,E)=>{const T=D.number(E)?E:0,w=D.element(v)?v:this.elements.display.buffer;if(D.element(w)){w.value=T;const L=w.getElementsByTagName("span")[0];D.element(L)&&(L.childNodes[0].nodeValue=T)}};if(o)switch(o.type){case"timeupdate":case"seeking":case"seeked":g=Io(this.currentTime,this.duration),o.type==="timeupdate"&&Oe.setRange.call(this,this.elements.inputs.seek,g);break;case"playing":case"progress":c(this.elements.display.buffer,100*this.buffered)}},updateRangeFill(o){const g=D.event(o)?o.target:o;if(D.element(g)&&g.getAttribute("type")==="range"){if(bi(g,this.config.selectors.inputs.seek)){g.setAttribute("aria-valuenow",this.currentTime);const c=Oe.formatTime(this.currentTime),v=Oe.formatTime(this.duration),E=Nt.get("seekLabel",this.config);g.setAttribute("aria-valuetext",E.replace("{currentTime}",c).replace("{duration}",v))}else if(bi(g,this.config.selectors.inputs.volume)){const c=100*g.value;g.setAttribute("aria-valuenow",c),g.setAttribute("aria-valuetext",`${c.toFixed(1)}%`)}else g.setAttribute("aria-valuenow",g.value);Bt.isWebkit&&g.style.setProperty("--value",g.value/g.max*100+"%")}},updateSeekTooltip(o){var g,c;if(!this.config.tooltips.seek||!D.element(this.elements.inputs.seek)||!D.element(this.elements.display.seekTooltip)||this.duration===0)return;const v=this.elements.display.seekTooltip,E=`${this.config.classNames.tooltip}--visible`,T=H=>ut(v,E,H);if(this.touch)return void T(!1);let w=0;const L=this.elements.progress.getBoundingClientRect();if(D.event(o))w=100/L.width*(o.pageX-L.left);else{if(!nr(v,E))return;w=parseFloat(v.style.left,10)}w<0?w=0:w>100&&(w=100);const R=this.duration/100*w;v.innerText=Oe.formatTime(R);const B=(g=this.config.markers)===null||g===void 0||(c=g.points)===null||c===void 0?void 0:c.find(({time:H})=>H===Math.round(R));B&&v.insertAdjacentHTML("afterbegin",`${B.label}<br>`),v.style.left=`${w}%`,D.event(o)&&["mouseenter","mouseleave"].includes(o.type)&&T(o.type==="mouseenter")},timeUpdate(o){const g=!D.element(this.elements.display.duration)&&this.config.invertTime;Oe.updateTimeDisplay.call(this,this.elements.display.currentTime,g?this.duration-this.currentTime:this.currentTime,g),o&&o.type==="timeupdate"&&this.media.seeking||Oe.updateProgress.call(this,o)},durationUpdate(){if(!this.supported.ui||!this.config.invertTime&&this.currentTime)return;if(this.duration>=2**32)return Ei(this.elements.display.currentTime,!0),void Ei(this.elements.progress,!0);D.element(this.elements.inputs.seek)&&this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration);const o=D.element(this.elements.display.duration);!o&&this.config.displayDuration&&this.paused&&Oe.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration),o&&Oe.updateTimeDisplay.call(this,this.elements.display.duration,this.duration),this.config.markers.enabled&&Oe.setMarkers.call(this),Oe.updateSeekTooltip.call(this)},toggleMenuButton(o,g){Ei(this.elements.settings.buttons[o],!g)},updateSetting(o,g,c){const v=this.elements.settings.panels[o];let E=null,T=g;if(o==="captions")E=this.currentTrack;else{if(E=D.empty(c)?this[o]:c,D.empty(E)&&(E=this.config[o].default),!D.empty(this.options[o])&&!this.options[o].includes(E))return void this.debug.warn(`Unsupported value of '${E}' for ${o}`);if(!this.config[o].options.includes(E))return void this.debug.warn(`Disabled value of '${E}' for ${o}`)}if(D.element(T)||(T=v&&v.querySelector('[role="menu"]')),!D.element(T))return;this.elements.settings.buttons[o].querySelector(`.${this.config.classNames.menu.value}`).innerHTML=Oe.getLabel.call(this,o,E);const w=T&&T.querySelector(`[value="${E}"]`);D.element(w)&&(w.checked=!0)},getLabel(o,g){switch(o){case"speed":return g===1?Nt.get("normal",this.config):`${g}&times;`;case"quality":if(D.number(g)){const c=Nt.get(`qualityLabel.${g}`,this.config);return c.length?c:`${g}p`}return As(g);case"captions":return ft.getLabel.call(this);default:return null}},setQualityMenu(o){if(!D.element(this.elements.settings.panels.quality))return;const g="quality",c=this.elements.settings.panels.quality.querySelector('[role="menu"]');D.array(o)&&(this.options.quality=Zr(o).filter(T=>this.config.quality.options.includes(T)));const v=!D.empty(this.options.quality)&&this.options.quality.length>1;if(Oe.toggleMenuButton.call(this,g,v),er(c),Oe.checkMenu.call(this),!v)return;const E=T=>{const w=Nt.get(`qualityBadge.${T}`,this.config);return w.length?Oe.createBadge.call(this,w):null};this.options.quality.sort((T,w)=>{const L=this.config.quality.options;return L.indexOf(T)>L.indexOf(w)?1:-1}).forEach(T=>{Oe.createMenuItem.call(this,{value:T,list:c,type:g,title:Oe.getLabel.call(this,"quality",T),badge:E(T)})}),Oe.updateSetting.call(this,g,c)},setCaptionsMenu(){if(!D.element(this.elements.settings.panels.captions))return;const o="captions",g=this.elements.settings.panels.captions.querySelector('[role="menu"]'),c=ft.getTracks.call(this),v=Boolean(c.length);if(Oe.toggleMenuButton.call(this,o,v),er(g),Oe.checkMenu.call(this),!v)return;const E=c.map((T,w)=>({value:w,checked:this.captions.toggled&&this.currentTrack===w,title:ft.getLabel.call(this,T),badge:T.language&&Oe.createBadge.call(this,T.language.toUpperCase()),list:g,type:"language"}));E.unshift({value:-1,checked:!this.captions.toggled,title:Nt.get("disabled",this.config),list:g,type:"language"}),E.forEach(Oe.createMenuItem.bind(this)),Oe.updateSetting.call(this,o,g)},setSpeedMenu(){if(!D.element(this.elements.settings.panels.speed))return;const o="speed",g=this.elements.settings.panels.speed.querySelector('[role="menu"]');this.options.speed=this.options.speed.filter(v=>v>=this.minimumSpeed&&v<=this.maximumSpeed);const c=!D.empty(this.options.speed)&&this.options.speed.length>1;Oe.toggleMenuButton.call(this,o,c),er(g),Oe.checkMenu.call(this),c&&(this.options.speed.forEach(v=>{Oe.createMenuItem.call(this,{value:v,list:g,type:o,title:Oe.getLabel.call(this,"speed",v)})}),Oe.updateSetting.call(this,o,g))},checkMenu(){const{buttons:o}=this.elements.settings,g=!D.empty(o)&&Object.values(o).some(c=>!c.hidden);Ei(this.elements.settings.menu,!g)},focusFirstMenuItem(o,g=!1){if(this.elements.settings.popup.hidden)return;let c=o;D.element(c)||(c=Object.values(this.elements.settings.panels).find(E=>!E.hidden));const v=c.querySelector('[role^="menuitem"]');Yr.call(this,v,g)},toggleMenu(o){const{popup:g}=this.elements.settings,c=this.elements.buttons.settings;if(!D.element(g)||!D.element(c))return;const{hidden:v}=g;let E=v;if(D.boolean(o))E=o;else if(D.keyboardEvent(o)&&o.key==="Escape")E=!1;else if(D.event(o)){const T=D.function(o.composedPath)?o.composedPath()[0]:o.target,w=g.contains(T);if(w||!w&&o.target!==c&&E)return}c.setAttribute("aria-expanded",E),Ei(g,!E),ut(this.elements.container,this.config.classNames.menu.open,E),E&&D.keyboardEvent(o)?Oe.focusFirstMenuItem.call(this,null,!0):E||v||Yr.call(this,c,D.keyboardEvent(o))},getMenuSize(o){const g=o.cloneNode(!0);g.style.position="absolute",g.style.opacity=0,g.removeAttribute("hidden"),o.parentNode.appendChild(g);const c=g.scrollWidth,v=g.scrollHeight;return li(g),{width:c,height:v}},showMenuPanel(o="",g=!1){const c=this.elements.container.querySelector(`#plyr-settings-${this.id}-${o}`);if(!D.element(c))return;const v=c.parentNode,E=Array.from(v.children).find(T=>!T.hidden);if(Dt.transitions&&!Dt.reducedMotion){v.style.width=`${E.scrollWidth}px`,v.style.height=`${E.scrollHeight}px`;const T=Oe.getMenuSize.call(this,c),w=L=>{L.target===v&&["width","height"].includes(L.propertyName)&&(v.style.width="",v.style.height="",or.call(this,v,Qr,w))};dt.call(this,v,Qr,w),v.style.width=`${T.width}px`,v.style.height=`${T.height}px`}Ei(E,!0),Ei(c,!1),Oe.focusFirstMenuItem.call(this,c,g)},setDownloadUrl(){const o=this.elements.buttons.download;D.element(o)&&o.setAttribute("href",this.download)},create(o){const{bindMenuItemShortcuts:g,createButton:c,createProgress:v,createRange:E,createTime:T,setQualityMenu:w,setSpeedMenu:L,showMenuPanel:R}=Oe;this.elements.controls=null,D.array(this.config.controls)&&this.config.controls.includes("play-large")&&this.elements.container.appendChild(c.call(this,"play-large"));const B=qe("div",ei(this.config.selectors.controls.wrapper));this.elements.controls=B;const H={class:"plyr__controls__item"};return Zr(D.array(this.config.controls)?this.config.controls:[]).forEach(N=>{if(N==="restart"&&B.appendChild(c.call(this,"restart",H)),N==="rewind"&&B.appendChild(c.call(this,"rewind",H)),N==="play"&&B.appendChild(c.call(this,"play",H)),N==="fast-forward"&&B.appendChild(c.call(this,"fast-forward",H)),N==="progress"){const p=qe("div",{class:`${H.class} plyr__progress__container`}),I=qe("div",ei(this.config.selectors.progress));if(I.appendChild(E.call(this,"seek",{id:`plyr-seek-${o.id}`})),I.appendChild(v.call(this,"buffer")),this.config.tooltips.seek){const _=qe("span",{class:this.config.classNames.tooltip},"00:00");I.appendChild(_),this.elements.display.seekTooltip=_}this.elements.progress=I,p.appendChild(this.elements.progress),B.appendChild(p)}if(N==="current-time"&&B.appendChild(T.call(this,"currentTime",H)),N==="duration"&&B.appendChild(T.call(this,"duration",H)),N==="mute"||N==="volume"){let{volume:p}=this.elements;if(D.element(p)&&B.contains(p)||(p=qe("div",Ct({},H,{class:`${H.class} plyr__volume`.trim()})),this.elements.volume=p,B.appendChild(p)),N==="mute"&&p.appendChild(c.call(this,"mute")),N==="volume"&&!Bt.isIos){const I={max:1,step:.05,value:this.config.volume};p.appendChild(E.call(this,"volume",Ct(I,{id:`plyr-volume-${o.id}`})))}}if(N==="captions"&&B.appendChild(c.call(this,"captions",H)),N==="settings"&&!D.empty(this.config.settings)){const p=qe("div",Ct({},H,{class:`${H.class} plyr__menu`.trim(),hidden:""}));p.appendChild(c.call(this,"settings",{"aria-haspopup":!0,"aria-controls":`plyr-settings-${o.id}`,"aria-expanded":!1}));const I=qe("div",{class:"plyr__menu__container",id:`plyr-settings-${o.id}`,hidden:""}),_=qe("div"),de=qe("div",{id:`plyr-settings-${o.id}-home`}),Q=qe("div",{role:"menu"});de.appendChild(Q),_.appendChild(de),this.elements.settings.panels.home=de,this.config.settings.forEach(ie=>{const q=qe("button",Ct(ei(this.config.selectors.buttons.settings),{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--forward`,role:"menuitem","aria-haspopup":!0,hidden:""}));g.call(this,q,ie),dt.call(this,q,"click",()=>{R.call(this,ie,!1)});const j=qe("span",null,Nt.get(ie,this.config)),re=qe("span",{class:this.config.classNames.menu.value});re.innerHTML=o[ie],j.appendChild(re),q.appendChild(j),Q.appendChild(q);const X=qe("div",{id:`plyr-settings-${o.id}-${ie}`,hidden:""}),z=qe("button",{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--back`});z.appendChild(qe("span",{"aria-hidden":!0},Nt.get(ie,this.config))),z.appendChild(qe("span",{class:this.config.classNames.hidden},Nt.get("menuBack",this.config))),dt.call(this,X,"keydown",$=>{$.key==="ArrowLeft"&&($.preventDefault(),$.stopPropagation(),R.call(this,"home",!0))},!1),dt.call(this,z,"click",()=>{R.call(this,"home",!1)}),X.appendChild(z),X.appendChild(qe("div",{role:"menu"})),_.appendChild(X),this.elements.settings.buttons[ie]=q,this.elements.settings.panels[ie]=X}),I.appendChild(_),p.appendChild(I),B.appendChild(p),this.elements.settings.popup=I,this.elements.settings.menu=p}if(N==="pip"&&Dt.pip&&B.appendChild(c.call(this,"pip",H)),N==="airplay"&&Dt.airplay&&B.appendChild(c.call(this,"airplay",H)),N==="download"){const p=Ct({},H,{element:"a",href:this.download,target:"_blank"});this.isHTML5&&(p.download="");const{download:I}=this.config.urls;!D.url(I)&&this.isEmbed&&Ct(p,{icon:`logo-${this.provider}`,label:this.provider}),B.appendChild(c.call(this,"download",p))}N==="fullscreen"&&B.appendChild(c.call(this,"fullscreen",H))}),this.isHTML5&&w.call(this,fi.getQualityOptions.call(this)),L.call(this),B},inject(){if(this.config.loadSprite){const E=Oe.getIconUrl.call(this);E.cors&&ws(E.url,"sprite-plyr")}this.id=Math.floor(1e4*Math.random());let o=null;this.elements.controls=null;const g={id:this.id,seektime:this.config.seekTime,title:this.config.title};let c=!0;D.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this,g)),this.config.controls||(this.config.controls=[]),D.element(this.config.controls)||D.string(this.config.controls)?o=this.config.controls:(o=Oe.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:ft.getLabel.call(this)}),c=!1);let v;if(c&&D.string(this.config.controls)&&(o=(E=>{let T=E;return Object.entries(g).forEach(([w,L])=>{T=Ki(T,`{${w}}`,L)}),T})(o)),D.string(this.config.selectors.controls.container)&&(v=document.querySelector(this.config.selectors.controls.container)),D.element(v)||(v=this.elements.container),v[D.element(o)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",o),D.element(this.elements.controls)||Oe.findElements.call(this),!D.empty(this.elements.buttons)){const E=T=>{const w=this.config.classNames.controlPressed;T.setAttribute("aria-pressed","false"),Object.defineProperty(T,"pressed",{configurable:!0,enumerable:!0,get:()=>nr(T,w),set(L=!1){ut(T,w,L),T.setAttribute("aria-pressed",L?"true":"false")}})};Object.values(this.elements.buttons).filter(Boolean).forEach(T=>{D.array(T)||D.nodeList(T)?Array.from(T).filter(Boolean).forEach(E):E(T)})}if(Bt.isEdge&&vs(v),this.config.tooltips.controls){const{classNames:E,selectors:T}=this.config,w=`${T.controls.wrapper} ${T.labels} .${E.hidden}`,L=Di.call(this,w);Array.from(L).forEach(R=>{ut(R,this.config.classNames.hidden,!1),ut(R,this.config.classNames.tooltip,!0)})}},setMediaMetadata(){try{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new window.MediaMetadata({title:this.config.mediaMetadata.title,artist:this.config.mediaMetadata.artist,album:this.config.mediaMetadata.album,artwork:this.config.mediaMetadata.artwork}))}catch{}},setMarkers(){var o,g;if(!this.duration||this.elements.markers)return;const c=(o=this.config.markers)===null||o===void 0||(g=o.points)===null||g===void 0?void 0:g.filter(({time:R})=>R>0&&R<this.duration);if(c==null||!c.length)return;const v=document.createDocumentFragment(),E=document.createDocumentFragment();let T=null;const w=`${this.config.classNames.tooltip}--visible`,L=R=>ut(T,w,R);c.forEach(R=>{const B=qe("span",{class:this.config.classNames.marker},""),H=R.time/this.duration*100+"%";T&&(B.addEventListener("mouseenter",()=>{R.label||(T.style.left=H,T.innerHTML=R.label,L(!0))}),B.addEventListener("mouseleave",()=>{L(!1)})),B.addEventListener("click",()=>{this.currentTime=R.time}),B.style.left=H,E.appendChild(B)}),v.appendChild(E),this.config.tooltips.seek||(T=qe("span",{class:this.config.classNames.tooltip},""),v.appendChild(T)),this.elements.markers={points:E,tip:T},this.elements.progress.appendChild(v)}};function Ds(o,g=!0){let c=o;if(g){const v=document.createElement("a");v.href=c,c=v.href}try{return new URL(c)}catch{return null}}function Is(o){const g=new URLSearchParams;return D.object(o)&&Object.entries(o).forEach(([c,v])=>{g.set(c,v)}),g}const ft={setup(){if(!this.supported.ui)return;if(!this.isVideo||this.isYouTube||this.isHTML5&&!Dt.textTracks)return void(D.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&Oe.setCaptionsMenu.call(this));if(D.element(this.elements.captions)||(this.elements.captions=qe("div",ei(this.config.selectors.captions)),this.elements.captions.setAttribute("dir","auto"),To(this.elements.captions,this.elements.wrapper)),Bt.isIE&&window.URL){const v=this.media.querySelectorAll("track");Array.from(v).forEach(E=>{const T=E.getAttribute("src"),w=Ds(T);w!==null&&w.hostname!==window.location.href.hostname&&["http:","https:"].includes(w.protocol)&&qi(T,"blob").then(L=>{E.setAttribute("src",window.URL.createObjectURL(L))}).catch(()=>{li(E)})})}const o=Zr((navigator.languages||[navigator.language||navigator.userLanguage||"en"]).map(v=>v.split("-")[0]));let g=(this.storage.get("language")||this.config.captions.language||"auto").toLowerCase();g==="auto"&&([g]=o);let c=this.storage.get("captions");if(D.boolean(c)||({active:c}=this.config.captions),Object.assign(this.captions,{toggled:!1,active:c,language:g,languages:o}),this.isHTML5){const v=this.config.captions.update?"addtrack removetrack":"removetrack";dt.call(this,this.media.textTracks,v,ft.update.bind(this))}setTimeout(ft.update.bind(this),0)},update(){const o=ft.getTracks.call(this,!0),{active:g,language:c,meta:v,currentTrackNode:E}=this.captions,T=Boolean(o.find(w=>w.language===c));this.isHTML5&&this.isVideo&&o.filter(w=>!v.get(w)).forEach(w=>{this.debug.log("Track added",w),v.set(w,{default:w.mode==="showing"}),w.mode==="showing"&&(w.mode="hidden"),dt.call(this,w,"cuechange",()=>ft.updateCues.call(this))}),(T&&this.language!==c||!o.includes(E))&&(ft.setLanguage.call(this,c),ft.toggle.call(this,g&&T)),this.elements&&ut(this.elements.container,this.config.classNames.captions.enabled,!D.empty(o)),D.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&Oe.setCaptionsMenu.call(this)},toggle(o,g=!0){if(!this.supported.ui)return;const{toggled:c}=this.captions,v=this.config.classNames.captions.active,E=D.nullOrUndefined(o)?!c:o;if(E!==c){if(g||(this.captions.active=E,this.storage.set({captions:E})),!this.language&&E&&!g){const T=ft.getTracks.call(this),w=ft.findTrack.call(this,[this.captions.language,...this.captions.languages],!0);return this.captions.language=w.language,void ft.set.call(this,T.indexOf(w))}this.elements.buttons.captions&&(this.elements.buttons.captions.pressed=E),ut(this.elements.container,v,E),this.captions.toggled=E,Oe.updateSetting.call(this,"captions"),We.call(this,this.media,E?"captionsenabled":"captionsdisabled")}setTimeout(()=>{E&&this.captions.toggled&&(this.captions.currentTrackNode.mode="hidden")})},set(o,g=!0){const c=ft.getTracks.call(this);if(o!==-1)if(D.number(o))if(o in c){if(this.captions.currentTrack!==o){this.captions.currentTrack=o;const v=c[o],{language:E}=v||{};this.captions.currentTrackNode=v,Oe.updateSetting.call(this,"captions"),g||(this.captions.language=E,this.storage.set({language:E})),this.isVimeo&&this.embed.enableTextTrack(E),We.call(this,this.media,"languagechange")}ft.toggle.call(this,!0,g),this.isHTML5&&this.isVideo&&ft.updateCues.call(this)}else this.debug.warn("Track not found",o);else this.debug.warn("Invalid caption argument",o);else ft.toggle.call(this,!1,g)},setLanguage(o,g=!0){if(!D.string(o))return void this.debug.warn("Invalid language argument",o);const c=o.toLowerCase();this.captions.language=c;const v=ft.getTracks.call(this),E=ft.findTrack.call(this,[c]);ft.set.call(this,v.indexOf(E),g)},getTracks(o=!1){return Array.from((this.media||{}).textTracks||[]).filter(g=>!this.isHTML5||o||this.captions.meta.has(g)).filter(g=>["captions","subtitles"].includes(g.kind))},findTrack(o,g=!1){const c=ft.getTracks.call(this),v=w=>Number((this.captions.meta.get(w)||{}).default),E=Array.from(c).sort((w,L)=>v(L)-v(w));let T;return o.every(w=>(T=E.find(L=>L.language===w),!T)),T||(g?E[0]:void 0)},getCurrentTrack(){return ft.getTracks.call(this)[this.currentTrack]},getLabel(o){let g=o;return!D.track(g)&&Dt.textTracks&&this.captions.toggled&&(g=ft.getCurrentTrack.call(this)),D.track(g)?D.empty(g.label)?D.empty(g.language)?Nt.get("enabled",this.config):o.language.toUpperCase():g.label:Nt.get("disabled",this.config)},updateCues(o){if(!this.supported.ui)return;if(!D.element(this.elements.captions))return void this.debug.warn("No captions element to render to");if(!D.nullOrUndefined(o)&&!Array.isArray(o))return void this.debug.warn("updateCues: Invalid input",o);let g=o;if(!g){const v=ft.getCurrentTrack.call(this);g=Array.from((v||{}).activeCues||[]).map(E=>E.getCueAsHTML()).map(Po)}const c=g.map(v=>v.trim()).join(`
`);if(c!==this.elements.captions.innerHTML){er(this.elements.captions);const v=qe("span",ei(this.config.selectors.caption));v.innerHTML=c,this.elements.captions.appendChild(v),We.call(this,this.media,"cuechange")}}},Rs={enabled:!0,title:"",debug:!1,autoplay:!1,autopause:!0,playsinline:!0,seekTime:10,volume:1,muted:!1,duration:null,displayDuration:!0,invertTime:!0,toggleInvert:!0,ratio:null,clickToPlay:!0,hideControls:!0,resetOnEnd:!1,disableContextMenu:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/3.7.3/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240],forced:!1,onChange:null},loop:{active:!1},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]},keyboard:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},captions:{active:!1,language:"auto",update:!1},fullscreen:{enabled:!0,fallback:!0,iosNative:!1},storage:{enabled:!0,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",pip:"PIP",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/oembed.json?url={0}"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption"},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",videoFixedRatio:"plyr__video-wrapper--fixed-ratio",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",paused:"plyr--paused",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",marker:"plyr__progress__marker",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isIos:"plyr--is-ios",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},tabFocus:"plyr__tab-focus",previewThumbnails:{thumbContainer:"plyr__preview-thumb",thumbContainerShown:"plyr__preview-thumb--is-shown",imageContainer:"plyr__preview-thumb__image-container",timeContainer:"plyr__preview-thumb__time-container",scrubbingContainer:"plyr__preview-scrubbing",scrubbingContainerShown:"plyr__preview-scrubbing--is-shown"}},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id",hash:"data-plyr-embed-hash"}},ads:{enabled:!1,publisherId:"",tagUrl:""},previewThumbnails:{enabled:!1,src:""},vimeo:{byline:!1,portrait:!1,title:!1,speed:!0,transparent:!1,customControls:!0,referrerPolicy:null,premium:!1},youtube:{rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,customControls:!0,noCookie:!1},mediaMetadata:{title:"",artist:"",album:"",artwork:[]},markers:{enabled:!1,points:[]}},Wr={active:"picture-in-picture",inactive:"inline"},di={html5:"html5",youtube:"youtube",vimeo:"vimeo"},$r={audio:"audio",video:"video"};function xo(o){return/^(https?:\/\/)?(www\.)?(youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(o)?di.youtube:/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(o)?di.vimeo:null}const zr=()=>{};class Fo{constructor(g=!1){this.enabled=window.console&&g,this.enabled&&this.log("Debugging enabled")}get log(){return this.enabled?Function.prototype.bind.call(console.log,console):zr}get warn(){return this.enabled?Function.prototype.bind.call(console.warn,console):zr}get error(){return this.enabled?Function.prototype.bind.call(console.error,console):zr}}class ti{constructor(g){Me(this,"onChange",()=>{if(!this.enabled)return;const c=this.player.elements.buttons.fullscreen;D.element(c)&&(c.pressed=this.active);const v=this.target===this.player.media?this.target:this.player.elements.container;We.call(this.player,v,this.active?"enterfullscreen":"exitfullscreen",!0)}),Me(this,"toggleFallback",(c=!1)=>{if(c?this.scrollPosition={x:window.scrollX||0,y:window.scrollY||0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=c?"hidden":"",ut(this.target,this.player.config.classNames.fullscreen.fallback,c),Bt.isIos){let v=document.head.querySelector('meta[name="viewport"]');const E="viewport-fit=cover";v||(v=document.createElement("meta"),v.setAttribute("name","viewport"));const T=D.string(v.content)&&v.content.includes(E);c?(this.cleanupViewport=!T,T||(v.content+=`,${E}`)):this.cleanupViewport&&(v.content=v.content.split(",").filter(w=>w.trim()!==E).join(","))}this.onChange()}),Me(this,"trapFocus",c=>{if(Bt.isIos||!this.active||c.key!=="Tab")return;const v=document.activeElement,E=Di.call(this.player,"a[href], button:not(:disabled), input:not(:disabled), [tabindex]"),[T]=E,w=E[E.length-1];v!==w||c.shiftKey?v===T&&c.shiftKey&&(w.focus(),c.preventDefault()):(T.focus(),c.preventDefault())}),Me(this,"update",()=>{if(this.enabled){let c;c=this.forceFallback?"Fallback (forced)":ti.native?"Native":"Fallback",this.player.debug.log(`${c} fullscreen enabled`)}else this.player.debug.log("Fullscreen not supported and fallback disabled");ut(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.enabled)}),Me(this,"enter",()=>{this.enabled&&(Bt.isIos&&this.player.config.fullscreen.iosNative?this.player.isVimeo?this.player.embed.requestFullscreen():this.target.webkitEnterFullscreen():!ti.native||this.forceFallback?this.toggleFallback(!0):this.prefix?D.empty(this.prefix)||this.target[`${this.prefix}Request${this.property}`]():this.target.requestFullscreen({navigationUI:"hide"}))}),Me(this,"exit",()=>{if(this.enabled)if(Bt.isIos&&this.player.config.fullscreen.iosNative)this.target.webkitExitFullscreen(),ii(this.player.play());else if(!ti.native||this.forceFallback)this.toggleFallback(!1);else if(this.prefix){if(!D.empty(this.prefix)){const c=this.prefix==="moz"?"Cancel":"Exit";document[`${this.prefix}${c}${this.property}`]()}}else(document.cancelFullScreen||document.exitFullscreen).call(document)}),Me(this,"toggle",()=>{this.active?this.exit():this.enter()}),this.player=g,this.prefix=ti.prefix,this.property=ti.property,this.scrollPosition={x:0,y:0},this.forceFallback=g.config.fullscreen.fallback==="force",this.player.elements.fullscreen=g.config.fullscreen.container&&So(this.player.elements.container,g.config.fullscreen.container),dt.call(this.player,document,this.prefix==="ms"?"MSFullscreenChange":`${this.prefix}fullscreenchange`,()=>{this.onChange()}),dt.call(this.player,this.player.elements.container,"dblclick",c=>{D.element(this.player.elements.controls)&&this.player.elements.controls.contains(c.target)||this.player.listeners.proxy(c,this.toggle,"fullscreen")}),dt.call(this,this.player.elements.container,"keydown",c=>this.trapFocus(c)),this.update()}static get native(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}get usingNative(){return ti.native&&!this.forceFallback}static get prefix(){if(D.function(document.exitFullscreen))return"";let g="";return["webkit","moz","ms"].some(c=>!(!D.function(document[`${c}ExitFullscreen`])&&!D.function(document[`${c}CancelFullScreen`]))&&(g=c,!0)),g}static get property(){return this.prefix==="moz"?"FullScreen":"Fullscreen"}get enabled(){return(ti.native||this.player.config.fullscreen.fallback)&&this.player.config.fullscreen.enabled&&this.player.supported.ui&&this.player.isVideo}get active(){if(!this.enabled)return!1;if(!ti.native||this.forceFallback)return nr(this.target,this.player.config.classNames.fullscreen.fallback);const g=this.prefix?this.target.getRootNode()[`${this.prefix}${this.property}Element`]:this.target.getRootNode().fullscreenElement;return g&&g.shadowRoot?g===this.target.getRootNode().host:g===this.target}get target(){return Bt.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.fullscreen||this.player.elements.container}}function tr(o,g=1){return new Promise((c,v)=>{const E=new Image,T=()=>{delete E.onload,delete E.onerror,(E.naturalWidth>=g?c:v)(E)};Object.assign(E,{onload:T,onerror:T,src:o})})}const bt={addStyleHook(){ut(this.elements.container,this.config.selectors.container.replace(".",""),!0),ut(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls(o=!1){o&&this.isHTML5?this.media.setAttribute("controls",""):this.media.removeAttribute("controls")},build(){if(this.listeners.media(),!this.supported.ui)return this.debug.warn(`Basic support only for ${this.provider} ${this.type}`),void bt.toggleNativeControls.call(this,!0);D.element(this.elements.controls)||(Oe.inject.call(this),this.listeners.controls()),bt.toggleNativeControls.call(this),this.isHTML5&&ft.setup.call(this),this.volume=null,this.muted=null,this.loop=null,this.quality=null,this.speed=null,Oe.updateVolume.call(this),Oe.timeUpdate.call(this),Oe.durationUpdate.call(this),bt.checkPlaying.call(this),ut(this.elements.container,this.config.classNames.pip.supported,Dt.pip&&this.isHTML5&&this.isVideo),ut(this.elements.container,this.config.classNames.airplay.supported,Dt.airplay&&this.isHTML5),ut(this.elements.container,this.config.classNames.isIos,Bt.isIos),ut(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0,setTimeout(()=>{We.call(this,this.media,"ready")},0),bt.setTitle.call(this),this.poster&&bt.setPoster.call(this,this.poster,!1).catch(()=>{}),this.config.duration&&Oe.durationUpdate.call(this),this.config.mediaMetadata&&Oe.setMediaMetadata.call(this)},setTitle(){let o=Nt.get("play",this.config);if(D.string(this.config.title)&&!D.empty(this.config.title)&&(o+=`, ${this.config.title}`),Array.from(this.elements.buttons.play||[]).forEach(g=>{g.setAttribute("aria-label",o)}),this.isEmbed){const g=Ft.call(this,"iframe");if(!D.element(g))return;const c=D.empty(this.config.title)?"video":this.config.title,v=Nt.get("frameTitle",this.config);g.setAttribute("title",v.replace("{title}",c))}},togglePoster(o){ut(this.elements.container,this.config.classNames.posterEnabled,o)},setPoster(o,g=!0){return g&&this.poster?Promise.reject(new Error("Poster already set")):(this.media.setAttribute("data-poster",o),this.elements.poster.removeAttribute("hidden"),wo.call(this).then(()=>tr(o)).catch(c=>{throw o===this.poster&&bt.togglePoster.call(this,!1),c}).then(()=>{if(o!==this.poster)throw new Error("setPoster cancelled by later call to setPoster")}).then(()=>(Object.assign(this.elements.poster.style,{backgroundImage:`url('${o}')`,backgroundSize:""}),bt.togglePoster.call(this,!0),o)))},checkPlaying(o){ut(this.elements.container,this.config.classNames.playing,this.playing),ut(this.elements.container,this.config.classNames.paused,this.paused),ut(this.elements.container,this.config.classNames.stopped,this.stopped),Array.from(this.elements.buttons.play||[]).forEach(g=>{Object.assign(g,{pressed:this.playing}),g.setAttribute("aria-label",Nt.get(this.playing?"pause":"play",this.config))}),D.event(o)&&o.type==="timeupdate"||bt.toggleControls.call(this)},checkLoading(o){this.loading=["stalled","waiting"].includes(o.type),clearTimeout(this.timers.loading),this.timers.loading=setTimeout(()=>{ut(this.elements.container,this.config.classNames.loading,this.loading),bt.toggleControls.call(this)},this.loading?250:0)},toggleControls(o){const{controls:g}=this.elements;if(g&&this.config.hideControls){const c=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(Boolean(o||this.loading||this.paused||g.pressed||g.hover||c))}},migrateStyles(){Object.values({...this.media.style}).filter(o=>!D.empty(o)&&D.string(o)&&o.startsWith("--plyr")).forEach(o=>{this.elements.container.style.setProperty(o,this.media.style.getPropertyValue(o)),this.media.style.removeProperty(o)}),D.empty(this.media.style)&&this.media.removeAttribute("style")}};class Mo{constructor(g){Me(this,"firstTouch",()=>{const{player:c}=this,{elements:v}=c;c.touch=!0,ut(v.container,c.config.classNames.isTouch,!0)}),Me(this,"setTabFocus",c=>{const{player:v}=this,{elements:E}=v,{key:T,type:w,timeStamp:L}=c;if(clearTimeout(this.focusTimer),w==="keydown"&&T!=="Tab")return;w==="keydown"&&(this.lastKeyDown=L);const R=L-this.lastKeyDown<=20;(w!=="focus"||R)&&((()=>{const B=v.config.classNames.tabFocus;ut(Di.call(v,`.${B}`),B,!1)})(),w!=="focusout"&&(this.focusTimer=setTimeout(()=>{const B=document.activeElement;E.container.contains(B)&&ut(document.activeElement,v.config.classNames.tabFocus,!0)},10)))}),Me(this,"global",(c=!0)=>{const{player:v}=this;v.config.keyboard.global&&Ii.call(v,window,"keydown keyup",this.handleKey,c,!1),Ii.call(v,document.body,"click",this.toggleMenu,c),on.call(v,document.body,"touchstart",this.firstTouch),Ii.call(v,document.body,"keydown focus blur focusout",this.setTabFocus,c,!1,!0)}),Me(this,"container",()=>{const{player:c}=this,{config:v,elements:E,timers:T}=c;!v.keyboard.global&&v.keyboard.focused&&dt.call(c,E.container,"keydown keyup",this.handleKey,!1),dt.call(c,E.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",R=>{const{controls:B}=E;B&&R.type==="enterfullscreen"&&(B.pressed=!1,B.hover=!1);let H=0;["touchstart","touchmove","mousemove"].includes(R.type)&&(bt.toggleControls.call(c,!0),H=c.touch?3e3:2e3),clearTimeout(T.controls),T.controls=setTimeout(()=>bt.toggleControls.call(c,!1),H)});const w=()=>{if(!c.isVimeo||c.config.vimeo.premium)return;const R=E.wrapper,{active:B}=c.fullscreen,[H,N]=ln.call(c),p=Ts(`aspect-ratio: ${H} / ${N}`);if(!B)return void(p?(R.style.width=null,R.style.height=null):(R.style.maxWidth=null,R.style.margin=null));const[I,_]=Lo(),de=I/_>H/N;p?(R.style.width=de?"auto":"100%",R.style.height=de?"100%":"auto"):(R.style.maxWidth=de?_/N*H+"px":null,R.style.margin=de?"0 auto":null)},L=()=>{clearTimeout(T.resized),T.resized=setTimeout(w,50)};dt.call(c,E.container,"enterfullscreen exitfullscreen",R=>{const{target:B}=c.fullscreen;B===E.container&&(!c.isEmbed&&D.empty(c.config.ratio)||(w(),(R.type==="enterfullscreen"?dt:or).call(c,window,"resize",L)))})}),Me(this,"media",()=>{const{player:c}=this,{elements:v}=c;if(dt.call(c,c.media,"timeupdate seeking seeked",T=>Oe.timeUpdate.call(c,T)),dt.call(c,c.media,"durationchange loadeddata loadedmetadata",T=>Oe.durationUpdate.call(c,T)),dt.call(c,c.media,"ended",()=>{c.isHTML5&&c.isVideo&&c.config.resetOnEnd&&(c.restart(),c.pause())}),dt.call(c,c.media,"progress playing seeking seeked",T=>Oe.updateProgress.call(c,T)),dt.call(c,c.media,"volumechange",T=>Oe.updateVolume.call(c,T)),dt.call(c,c.media,"playing play pause ended emptied timeupdate",T=>bt.checkPlaying.call(c,T)),dt.call(c,c.media,"waiting canplay seeked playing",T=>bt.checkLoading.call(c,T)),c.supported.ui&&c.config.clickToPlay&&!c.isAudio){const T=Ft.call(c,`.${c.config.classNames.video}`);if(!D.element(T))return;dt.call(c,v.container,"click",w=>{([v.container,T].includes(w.target)||T.contains(w.target))&&(c.touch&&c.config.hideControls||(c.ended?(this.proxy(w,c.restart,"restart"),this.proxy(w,()=>{ii(c.play())},"play")):this.proxy(w,()=>{ii(c.togglePlay())},"play")))})}c.supported.ui&&c.config.disableContextMenu&&dt.call(c,v.wrapper,"contextmenu",T=>{T.preventDefault()},!1),dt.call(c,c.media,"volumechange",()=>{c.storage.set({volume:c.volume,muted:c.muted})}),dt.call(c,c.media,"ratechange",()=>{Oe.updateSetting.call(c,"speed"),c.storage.set({speed:c.speed})}),dt.call(c,c.media,"qualitychange",T=>{Oe.updateSetting.call(c,"quality",null,T.detail.quality)}),dt.call(c,c.media,"ready qualitychange",()=>{Oe.setDownloadUrl.call(c)});const E=c.config.events.concat(["keyup","keydown"]).join(" ");dt.call(c,c.media,E,T=>{let{detail:w={}}=T;T.type==="error"&&(w=c.media.error),We.call(c,v.container,T.type,!0,w)})}),Me(this,"proxy",(c,v,E)=>{const{player:T}=this,w=T.config.listeners[E];let L=!0;D.function(w)&&(L=w.call(T,c)),L!==!1&&D.function(v)&&v.call(T,c)}),Me(this,"bind",(c,v,E,T,w=!0)=>{const{player:L}=this,R=L.config.listeners[T],B=D.function(R);dt.call(L,c,v,H=>this.proxy(H,E,T),w&&!B)}),Me(this,"controls",()=>{const{player:c}=this,{elements:v}=c,E=Bt.isIE?"change":"input";if(v.buttons.play&&Array.from(v.buttons.play).forEach(T=>{this.bind(T,"click",()=>{ii(c.togglePlay())},"play")}),this.bind(v.buttons.restart,"click",c.restart,"restart"),this.bind(v.buttons.rewind,"click",()=>{c.lastSeekTime=Date.now(),c.rewind()},"rewind"),this.bind(v.buttons.fastForward,"click",()=>{c.lastSeekTime=Date.now(),c.forward()},"fastForward"),this.bind(v.buttons.mute,"click",()=>{c.muted=!c.muted},"mute"),this.bind(v.buttons.captions,"click",()=>c.toggleCaptions()),this.bind(v.buttons.download,"click",()=>{We.call(c,c.media,"download")},"download"),this.bind(v.buttons.fullscreen,"click",()=>{c.fullscreen.toggle()},"fullscreen"),this.bind(v.buttons.pip,"click",()=>{c.pip="toggle"},"pip"),this.bind(v.buttons.airplay,"click",c.airplay,"airplay"),this.bind(v.buttons.settings,"click",T=>{T.stopPropagation(),T.preventDefault(),Oe.toggleMenu.call(c,T)},null,!1),this.bind(v.buttons.settings,"keyup",T=>{["Space","Enter"].includes(T.key)&&(T.key!=="Enter"?(T.preventDefault(),T.stopPropagation(),Oe.toggleMenu.call(c,T)):Oe.focusFirstMenuItem.call(c,null,!0))},null,!1),this.bind(v.settings.menu,"keydown",T=>{T.key==="Escape"&&Oe.toggleMenu.call(c,T)}),this.bind(v.inputs.seek,"mousedown mousemove",T=>{const w=v.progress.getBoundingClientRect(),L=100/w.width*(T.pageX-w.left);T.currentTarget.setAttribute("seek-value",L)}),this.bind(v.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",T=>{const w=T.currentTarget,L="play-on-seeked";if(D.keyboardEvent(T)&&!["ArrowLeft","ArrowRight"].includes(T.key))return;c.lastSeekTime=Date.now();const R=w.hasAttribute(L),B=["mouseup","touchend","keyup"].includes(T.type);R&&B?(w.removeAttribute(L),ii(c.play())):!B&&c.playing&&(w.setAttribute(L,""),c.pause())}),Bt.isIos){const T=Di.call(c,'input[type="range"]');Array.from(T).forEach(w=>this.bind(w,E,L=>vs(L.target)))}this.bind(v.inputs.seek,E,T=>{const w=T.currentTarget;let L=w.getAttribute("seek-value");D.empty(L)&&(L=w.value),w.removeAttribute("seek-value"),c.currentTime=L/w.max*c.duration},"seek"),this.bind(v.progress,"mouseenter mouseleave mousemove",T=>Oe.updateSeekTooltip.call(c,T)),this.bind(v.progress,"mousemove touchmove",T=>{const{previewThumbnails:w}=c;w&&w.loaded&&w.startMove(T)}),this.bind(v.progress,"mouseleave touchend click",()=>{const{previewThumbnails:T}=c;T&&T.loaded&&T.endMove(!1,!0)}),this.bind(v.progress,"mousedown touchstart",T=>{const{previewThumbnails:w}=c;w&&w.loaded&&w.startScrubbing(T)}),this.bind(v.progress,"mouseup touchend",T=>{const{previewThumbnails:w}=c;w&&w.loaded&&w.endScrubbing(T)}),Bt.isWebkit&&Array.from(Di.call(c,'input[type="range"]')).forEach(T=>{this.bind(T,"input",w=>Oe.updateRangeFill.call(c,w.target))}),c.config.toggleInvert&&!D.element(v.display.duration)&&this.bind(v.display.currentTime,"click",()=>{c.currentTime!==0&&(c.config.invertTime=!c.config.invertTime,Oe.timeUpdate.call(c))}),this.bind(v.inputs.volume,E,T=>{c.volume=T.target.value},"volume"),this.bind(v.controls,"mouseenter mouseleave",T=>{v.controls.hover=!c.touch&&T.type==="mouseenter"}),v.fullscreen&&Array.from(v.fullscreen.children).filter(T=>!T.contains(v.container)).forEach(T=>{this.bind(T,"mouseenter mouseleave",w=>{v.controls&&(v.controls.hover=!c.touch&&w.type==="mouseenter")})}),this.bind(v.controls,"mousedown mouseup touchstart touchend touchcancel",T=>{v.controls.pressed=["mousedown","touchstart"].includes(T.type)}),this.bind(v.controls,"focusin",()=>{const{config:T,timers:w}=c;ut(v.controls,T.classNames.noTransition,!0),bt.toggleControls.call(c,!0),setTimeout(()=>{ut(v.controls,T.classNames.noTransition,!1)},0);const L=this.touch?3e3:4e3;clearTimeout(w.controls),w.controls=setTimeout(()=>bt.toggleControls.call(c,!1),L)}),this.bind(v.inputs.volume,"wheel",T=>{const w=T.webkitDirectionInvertedFromDevice,[L,R]=[T.deltaX,-T.deltaY].map(N=>w?-N:N),B=Math.sign(Math.abs(L)>Math.abs(R)?L:R);c.increaseVolume(B/50);const{volume:H}=c.media;(B===1&&H<1||B===-1&&H>0)&&T.preventDefault()},"volume",!1)}),this.player=g,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.handleKey=this.handleKey.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.setTabFocus=this.setTabFocus.bind(this),this.firstTouch=this.firstTouch.bind(this)}handleKey(g){const{player:c}=this,{elements:v}=c,{key:E,type:T,altKey:w,ctrlKey:L,metaKey:R,shiftKey:B}=g,H=T==="keydown",N=H&&E===this.lastKey;if(!(w||L||R||B)&&E){if(H){const I=document.activeElement;if(D.element(I)){const{editable:_}=c.config.selectors,{seek:de}=v.inputs;if(I!==de&&bi(I,_)||g.key==="Space"&&bi(I,'button, [role^="menuitem"]'))return}switch(["Space","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","0","1","2","3","4","5","6","7","8","9","c","f","k","l","m"].includes(E)&&(g.preventDefault(),g.stopPropagation()),E){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":N||(p=parseInt(E,10),c.currentTime=c.duration/10*p);break;case"Space":case"k":N||ii(c.togglePlay());break;case"ArrowUp":c.increaseVolume(.1);break;case"ArrowDown":c.decreaseVolume(.1);break;case"m":N||(c.muted=!c.muted);break;case"ArrowRight":c.forward();break;case"ArrowLeft":c.rewind();break;case"f":c.fullscreen.toggle();break;case"c":N||c.toggleCaptions();break;case"l":c.loop=!c.loop}E==="Escape"&&!c.fullscreen.usingNative&&c.fullscreen.active&&c.fullscreen.toggle(),this.lastKey=E}else this.lastKey=null;var p}}toggleMenu(g){Oe.toggleMenu.call(this.player,g)}}function No(o,g){return o(g={exports:{}},g.exports),g.exports}var Uo=No(function(o,g){o.exports=function(){var c=function(){},v={},E={},T={};function w(p,I){p=p.push?p:[p];var _,de,Q,ie=[],q=p.length,j=q;for(_=function(re,X){X.length&&ie.push(re),--j||I(ie)};q--;)de=p[q],(Q=E[de])?_(de,Q):(T[de]=T[de]||[]).push(_)}function L(p,I){if(p){var _=T[p];if(E[p]=I,_)for(;_.length;)_[0](p,I),_.splice(0,1)}}function R(p,I){p.call&&(p={success:p}),I.length?(p.error||c)(I):(p.success||c)(p)}function B(p,I,_,de){var Q,ie,q=document,j=_.async,re=(_.numRetries||0)+1,X=_.before||c,z=p.replace(/[\?|#].*$/,""),$=p.replace(/^(css|img)!/,"");de=de||0,/(^css!|\.css$)/.test(z)?((ie=q.createElement("link")).rel="stylesheet",ie.href=$,(Q="hideFocus"in ie)&&ie.relList&&(Q=0,ie.rel="preload",ie.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(z)?(ie=q.createElement("img")).src=$:((ie=q.createElement("script")).src=p,ie.async=j===void 0||j),ie.onload=ie.onerror=ie.onbeforeload=function(ve){var be=ve.type[0];if(Q)try{ie.sheet.cssText.length||(be="e")}catch(Ne){Ne.code!=18&&(be="e")}if(be=="e"){if((de+=1)<re)return B(p,I,_,de)}else if(ie.rel=="preload"&&ie.as=="style")return ie.rel="stylesheet";I(p,be,ve.defaultPrevented)},X(p,ie)!==!1&&q.head.appendChild(ie)}function H(p,I,_){var de,Q,ie=(p=p.push?p:[p]).length,q=ie,j=[];for(de=function(re,X,z){if(X=="e"&&j.push(re),X=="b"){if(!z)return;j.push(re)}--ie||I(j)},Q=0;Q<q;Q++)B(p[Q],de,_)}function N(p,I,_){var de,Q;if(I&&I.trim&&(de=I),Q=(de?_:I)||{},de){if(de in v)throw"LoadJS";v[de]=!0}function ie(q,j){H(p,function(re){R(Q,re),q&&R({success:q,error:j},re),L(de,re)},Q)}if(Q.returnPromise)return new Promise(ie);ie()}return N.ready=function(p,I){return w(p,function(_){R(I,_)}),N},N.done=function(p){L(p,[])},N.reset=function(){v={},E={},T={}},N.isDefined=function(p){return p in v},N}()});function un(o){return new Promise((g,c)=>{Uo(o,{success:g,error:c})})}function Bo(o){return D.empty(o)?null:D.number(Number(o))?o:o.match(/^.*(vimeo.com\/|video\/)(\d+).*/)?RegExp.$2:o}function Ko(o){const g=o.match(/^.*(vimeo.com\/|video\/)(\d+)(\?.*&*h=|\/)+([\d,a-f]+)/);return g&&g.length===5?g[4]:null}function Ui(o){o&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===o&&(this.media.paused=!o,We.call(this,this.media,o?"play":"pause"))}const tn={setup(){const o=this;ut(o.elements.wrapper,o.config.classNames.embed,!0),o.options.speed=o.config.speed.options,Ri.call(o),D.object(window.Vimeo)?tn.ready.call(o):un(o.config.urls.vimeo.sdk).then(()=>{tn.ready.call(o)}).catch(g=>{o.debug.warn("Vimeo SDK (player.js) failed to load",g)})},ready(){const o=this,g=o.config.vimeo,{premium:c,referrerPolicy:v,...E}=g;let T=o.media.getAttribute("src"),w="";D.empty(T)?(T=o.media.getAttribute(o.config.attributes.embed.id),w=o.media.getAttribute(o.config.attributes.embed.hash)):w=Ko(T);const L=w?{h:w}:{};c&&Object.assign(E,{controls:!1,sidedock:!1});const R=Is({loop:o.config.loop.active,autoplay:o.autoplay,muted:o.muted,gesture:"media",playsinline:!this.config.fullscreen.iosNative,...L,...E}),B=Bo(T),H=qe("iframe"),N=en(o.config.urls.vimeo.iframe,B,R);if(H.setAttribute("src",N),H.setAttribute("allowfullscreen",""),H.setAttribute("allow",["autoplay","fullscreen","picture-in-picture","encrypted-media","accelerometer","gyroscope"].join("; ")),D.empty(v)||H.setAttribute("referrerPolicy",v),c||!g.customControls)H.setAttribute("data-poster",o.poster),o.media=rr(H,o.media);else{const q=qe("div",{class:o.config.classNames.embedContainer,"data-poster":o.poster});q.appendChild(H),o.media=rr(q,o.media)}g.customControls||qi(en(o.config.urls.vimeo.api,N)).then(q=>{!D.empty(q)&&q.thumbnail_url&&bt.setPoster.call(o,q.thumbnail_url).catch(()=>{})}),o.embed=new window.Vimeo.Player(H,{autopause:o.config.autopause,muted:o.muted}),o.media.paused=!0,o.media.currentTime=0,o.supported.ui&&o.embed.disableTextTrack(),o.media.play=()=>(Ui.call(o,!0),o.embed.play()),o.media.pause=()=>(Ui.call(o,!1),o.embed.pause()),o.media.stop=()=>{o.pause(),o.currentTime=0};let{currentTime:p}=o.media;Object.defineProperty(o.media,"currentTime",{get:()=>p,set(q){const{embed:j,media:re,paused:X,volume:z}=o,$=X&&!j.hasPlayed;re.seeking=!0,We.call(o,re,"seeking"),Promise.resolve($&&j.setVolume(0)).then(()=>j.setCurrentTime(q)).then(()=>$&&j.pause()).then(()=>$&&j.setVolume(z)).catch(()=>{})}});let I=o.config.speed.selected;Object.defineProperty(o.media,"playbackRate",{get:()=>I,set(q){o.embed.setPlaybackRate(q).then(()=>{I=q,We.call(o,o.media,"ratechange")}).catch(()=>{o.options.speed=[1]})}});let{volume:_}=o.config;Object.defineProperty(o.media,"volume",{get:()=>_,set(q){o.embed.setVolume(q).then(()=>{_=q,We.call(o,o.media,"volumechange")})}});let{muted:de}=o.config;Object.defineProperty(o.media,"muted",{get:()=>de,set(q){const j=!!D.boolean(q)&&q;o.embed.setVolume(j?0:o.config.volume).then(()=>{de=j,We.call(o,o.media,"volumechange")})}});let Q,{loop:ie}=o.config;Object.defineProperty(o.media,"loop",{get:()=>ie,set(q){const j=D.boolean(q)?q:o.config.loop.active;o.embed.setLoop(j).then(()=>{ie=j})}}),o.embed.getVideoUrl().then(q=>{Q=q,Oe.setDownloadUrl.call(o)}).catch(q=>{this.debug.warn(q)}),Object.defineProperty(o.media,"currentSrc",{get:()=>Q}),Object.defineProperty(o.media,"ended",{get:()=>o.currentTime===o.duration}),Promise.all([o.embed.getVideoWidth(),o.embed.getVideoHeight()]).then(q=>{const[j,re]=q;o.embed.ratio=ks(j,re),Ri.call(this)}),o.embed.setAutopause(o.config.autopause).then(q=>{o.config.autopause=q}),o.embed.getVideoTitle().then(q=>{o.config.title=q,bt.setTitle.call(this)}),o.embed.getCurrentTime().then(q=>{p=q,We.call(o,o.media,"timeupdate")}),o.embed.getDuration().then(q=>{o.media.duration=q,We.call(o,o.media,"durationchange")}),o.embed.getTextTracks().then(q=>{o.media.textTracks=q,ft.setup.call(o)}),o.embed.on("cuechange",({cues:q=[]})=>{const j=q.map(re=>_o(re.text));ft.updateCues.call(o,j)}),o.embed.on("loaded",()=>{o.embed.getPaused().then(q=>{Ui.call(o,!q),q||We.call(o,o.media,"playing")}),D.element(o.embed.element)&&o.supported.ui&&o.embed.element.setAttribute("tabindex",-1)}),o.embed.on("bufferstart",()=>{We.call(o,o.media,"waiting")}),o.embed.on("bufferend",()=>{We.call(o,o.media,"playing")}),o.embed.on("play",()=>{Ui.call(o,!0),We.call(o,o.media,"playing")}),o.embed.on("pause",()=>{Ui.call(o,!1)}),o.embed.on("timeupdate",q=>{o.media.seeking=!1,p=q.seconds,We.call(o,o.media,"timeupdate")}),o.embed.on("progress",q=>{o.media.buffered=q.percent,We.call(o,o.media,"progress"),parseInt(q.percent,10)===1&&We.call(o,o.media,"canplaythrough"),o.embed.getDuration().then(j=>{j!==o.media.duration&&(o.media.duration=j,We.call(o,o.media,"durationchange"))})}),o.embed.on("seeked",()=>{o.media.seeking=!1,We.call(o,o.media,"seeked")}),o.embed.on("ended",()=>{o.media.paused=!0,We.call(o,o.media,"ended")}),o.embed.on("error",q=>{o.media.error=q,We.call(o,o.media,"error")}),g.customControls&&setTimeout(()=>bt.build.call(o),0)}};function Go(o){return D.empty(o)?null:o.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/)?RegExp.$2:o}function Bi(o){o&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===o&&(this.media.paused=!o,We.call(this,this.media,o?"play":"pause"))}function jo(o){return o.noCookie?"https://www.youtube-nocookie.com":window.location.protocol==="http:"?"http://www.youtube.com":void 0}const ir={setup(){if(ut(this.elements.wrapper,this.config.classNames.embed,!0),D.object(window.YT)&&D.function(window.YT.Player))ir.ready.call(this);else{const o=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{D.function(o)&&o(),ir.ready.call(this)},un(this.config.urls.youtube.sdk).catch(g=>{this.debug.warn("YouTube API failed to load",g)})}},getTitle(o){qi(en(this.config.urls.youtube.api,o)).then(g=>{if(D.object(g)){const{title:c,height:v,width:E}=g;this.config.title=c,bt.setTitle.call(this),this.embed.ratio=ks(E,v)}Ri.call(this)}).catch(()=>{Ri.call(this)})},ready(){const o=this,g=o.config.youtube,c=o.media&&o.media.getAttribute("id");if(!D.empty(c)&&c.startsWith("youtube-"))return;let v=o.media.getAttribute("src");D.empty(v)&&(v=o.media.getAttribute(this.config.attributes.embed.id));const E=Go(v),T=qe("div",{id:Do(o.provider),"data-poster":g.customControls?o.poster:void 0});if(o.media=rr(T,o.media),g.customControls){const w=L=>`https://i.ytimg.com/vi/${E}/${L}default.jpg`;tr(w("maxres"),121).catch(()=>tr(w("sd"),121)).catch(()=>tr(w("hq"))).then(L=>bt.setPoster.call(o,L.src)).then(L=>{L.includes("maxres")||(o.elements.poster.style.backgroundSize="cover")}).catch(()=>{})}o.embed=new window.YT.Player(o.media,{videoId:E,host:jo(g),playerVars:Ct({},{autoplay:o.config.autoplay?1:0,hl:o.config.hl,controls:o.supported.ui&&g.customControls?0:1,disablekb:1,playsinline:o.config.fullscreen.iosNative?0:1,cc_load_policy:o.captions.active?1:0,cc_lang_pref:o.config.captions.language,widget_referrer:window?window.location.href:null},g),events:{onError(w){if(!o.media.error){const L=w.data,R={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[L]||"An unknown error occured";o.media.error={code:L,message:R},We.call(o,o.media,"error")}},onPlaybackRateChange(w){const L=w.target;o.media.playbackRate=L.getPlaybackRate(),We.call(o,o.media,"ratechange")},onReady(w){if(D.function(o.media.play))return;const L=w.target;ir.getTitle.call(o,E),o.media.play=()=>{Bi.call(o,!0),L.playVideo()},o.media.pause=()=>{Bi.call(o,!1),L.pauseVideo()},o.media.stop=()=>{L.stopVideo()},o.media.duration=L.getDuration(),o.media.paused=!0,o.media.currentTime=0,Object.defineProperty(o.media,"currentTime",{get:()=>Number(L.getCurrentTime()),set(N){o.paused&&!o.embed.hasPlayed&&o.embed.mute(),o.media.seeking=!0,We.call(o,o.media,"seeking"),L.seekTo(N)}}),Object.defineProperty(o.media,"playbackRate",{get:()=>L.getPlaybackRate(),set(N){L.setPlaybackRate(N)}});let{volume:R}=o.config;Object.defineProperty(o.media,"volume",{get:()=>R,set(N){R=N,L.setVolume(100*R),We.call(o,o.media,"volumechange")}});let{muted:B}=o.config;Object.defineProperty(o.media,"muted",{get:()=>B,set(N){const p=D.boolean(N)?N:B;B=p,L[p?"mute":"unMute"](),L.setVolume(100*R),We.call(o,o.media,"volumechange")}}),Object.defineProperty(o.media,"currentSrc",{get:()=>L.getVideoUrl()}),Object.defineProperty(o.media,"ended",{get:()=>o.currentTime===o.duration});const H=L.getAvailablePlaybackRates();o.options.speed=H.filter(N=>o.config.speed.options.includes(N)),o.supported.ui&&g.customControls&&o.media.setAttribute("tabindex",-1),We.call(o,o.media,"timeupdate"),We.call(o,o.media,"durationchange"),clearInterval(o.timers.buffering),o.timers.buffering=setInterval(()=>{o.media.buffered=L.getVideoLoadedFraction(),(o.media.lastBuffered===null||o.media.lastBuffered<o.media.buffered)&&We.call(o,o.media,"progress"),o.media.lastBuffered=o.media.buffered,o.media.buffered===1&&(clearInterval(o.timers.buffering),We.call(o,o.media,"canplaythrough"))},200),g.customControls&&setTimeout(()=>bt.build.call(o),50)},onStateChange(w){const L=w.target;switch(clearInterval(o.timers.playing),o.media.seeking&&[1,2].includes(w.data)&&(o.media.seeking=!1,We.call(o,o.media,"seeked")),w.data){case-1:We.call(o,o.media,"timeupdate"),o.media.buffered=L.getVideoLoadedFraction(),We.call(o,o.media,"progress");break;case 0:Bi.call(o,!1),o.media.loop?(L.stopVideo(),L.playVideo()):We.call(o,o.media,"ended");break;case 1:g.customControls&&!o.config.autoplay&&o.media.paused&&!o.embed.hasPlayed?o.media.pause():(Bi.call(o,!0),We.call(o,o.media,"playing"),o.timers.playing=setInterval(()=>{We.call(o,o.media,"timeupdate")},50),o.media.duration!==L.getDuration()&&(o.media.duration=L.getDuration(),We.call(o,o.media,"durationchange")));break;case 2:o.muted||o.embed.unMute(),Bi.call(o,!1);break;case 3:We.call(o,o.media,"waiting")}We.call(o,o.elements.container,"statechange",!1,{code:w.data})}}})}},Cs={setup(){this.media?(ut(this.elements.container,this.config.classNames.type.replace("{0}",this.type),!0),ut(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),!0),this.isEmbed&&ut(this.elements.container,this.config.classNames.type.replace("{0}","video"),!0),this.isVideo&&(this.elements.wrapper=qe("div",{class:this.config.classNames.video}),Es(this.media,this.elements.wrapper),this.elements.poster=qe("div",{class:this.config.classNames.poster}),this.elements.wrapper.appendChild(this.elements.poster)),this.isHTML5?fi.setup.call(this):this.isYouTube?ir.setup.call(this):this.isVimeo&&tn.setup.call(this)):this.debug.warn("No media element found!")}};class Ho{constructor(g){Me(this,"load",()=>{this.enabled&&(D.object(window.google)&&D.object(window.google.ima)?this.ready():un(this.player.config.urls.googleIMA.sdk).then(()=>{this.ready()}).catch(()=>{this.trigger("error",new Error("Google IMA SDK failed to load"))}))}),Me(this,"ready",()=>{var c;this.enabled||((c=this).manager&&c.manager.destroy(),c.elements.displayContainer&&c.elements.displayContainer.destroy(),c.elements.container.remove()),this.startSafetyTimer(12e3,"ready()"),this.managerPromise.then(()=>{this.clearSafetyTimer("onAdsManagerLoaded()")}),this.listeners(),this.setupIMA()}),Me(this,"setupIMA",()=>{this.elements.container=qe("div",{class:this.player.config.classNames.ads}),this.player.elements.container.appendChild(this.elements.container),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(this.player.config.ads.language),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playsinline),this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container,this.player.media),this.loader=new google.ima.AdsLoader(this.elements.displayContainer),this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,c=>this.onAdsManagerLoaded(c),!1),this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,c=>this.onAdError(c),!1),this.requestAds()}),Me(this,"requestAds",()=>{const{container:c}=this.player.elements;try{const v=new google.ima.AdsRequest;v.adTagUrl=this.tagUrl,v.linearAdSlotWidth=c.offsetWidth,v.linearAdSlotHeight=c.offsetHeight,v.nonLinearAdSlotWidth=c.offsetWidth,v.nonLinearAdSlotHeight=c.offsetHeight,v.forceNonLinearFullSlot=!1,v.setAdWillPlayMuted(!this.player.muted),this.loader.requestAds(v)}catch(v){this.onAdError(v)}}),Me(this,"pollCountdown",(c=!1)=>{if(!c)return clearInterval(this.countdownTimer),void this.elements.container.removeAttribute("data-badge-text");this.countdownTimer=setInterval(()=>{const v=lr(Math.max(this.manager.getRemainingTime(),0)),E=`${Nt.get("advertisement",this.player.config)} - ${v}`;this.elements.container.setAttribute("data-badge-text",E)},100)}),Me(this,"onAdsManagerLoaded",c=>{if(!this.enabled)return;const v=new google.ima.AdsRenderingSettings;v.restoreCustomPlaybackStateOnAdBreakComplete=!0,v.enablePreloading=!0,this.manager=c.getAdsManager(this.player,v),this.cuePoints=this.manager.getCuePoints(),this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,E=>this.onAdError(E)),Object.keys(google.ima.AdEvent.Type).forEach(E=>{this.manager.addEventListener(google.ima.AdEvent.Type[E],T=>this.onAdEvent(T))}),this.trigger("loaded")}),Me(this,"addCuePoints",()=>{D.empty(this.cuePoints)||this.cuePoints.forEach(c=>{if(c!==0&&c!==-1&&c<this.player.duration){const v=this.player.elements.progress;if(D.element(v)){const E=100/this.player.duration*c,T=qe("span",{class:this.player.config.classNames.cues});T.style.left=`${E.toString()}%`,v.appendChild(T)}}})}),Me(this,"onAdEvent",c=>{const{container:v}=this.player.elements,E=c.getAd(),T=c.getAdData();switch((w=>{We.call(this.player,this.player.media,`ads${w.replace(/_/g,"").toLowerCase()}`)})(c.type),c.type){case google.ima.AdEvent.Type.LOADED:this.trigger("loaded"),this.pollCountdown(!0),E.isLinear()||(E.width=v.offsetWidth,E.height=v.offsetHeight);break;case google.ima.AdEvent.Type.STARTED:this.manager.setVolume(this.player.volume);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:this.player.ended?this.loadAds():this.loader.contentComplete();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this.pollCountdown(),this.resumeContent();break;case google.ima.AdEvent.Type.LOG:T.adError&&this.player.debug.warn(`Non-fatal ad error: ${T.adError.getMessage()}`)}}),Me(this,"onAdError",c=>{this.cancel(),this.player.debug.warn("Ads error",c)}),Me(this,"listeners",()=>{const{container:c}=this.player.elements;let v;this.player.on("canplay",()=>{this.addCuePoints()}),this.player.on("ended",()=>{this.loader.contentComplete()}),this.player.on("timeupdate",()=>{v=this.player.currentTime}),this.player.on("seeked",()=>{const E=this.player.currentTime;D.empty(this.cuePoints)||this.cuePoints.forEach((T,w)=>{v<T&&T<E&&(this.manager.discardAdBreak(),this.cuePoints.splice(w,1))})}),window.addEventListener("resize",()=>{this.manager&&this.manager.resize(c.offsetWidth,c.offsetHeight,google.ima.ViewMode.NORMAL)})}),Me(this,"play",()=>{const{container:c}=this.player.elements;this.managerPromise||this.resumeContent(),this.managerPromise.then(()=>{this.manager.setVolume(this.player.volume),this.elements.displayContainer.initialize();try{this.initialized||(this.manager.init(c.offsetWidth,c.offsetHeight,google.ima.ViewMode.NORMAL),this.manager.start()),this.initialized=!0}catch(v){this.onAdError(v)}}).catch(()=>{})}),Me(this,"resumeContent",()=>{this.elements.container.style.zIndex="",this.playing=!1,ii(this.player.media.play())}),Me(this,"pauseContent",()=>{this.elements.container.style.zIndex=3,this.playing=!0,this.player.media.pause()}),Me(this,"cancel",()=>{this.initialized&&this.resumeContent(),this.trigger("error"),this.loadAds()}),Me(this,"loadAds",()=>{this.managerPromise.then(()=>{this.manager&&this.manager.destroy(),this.managerPromise=new Promise(c=>{this.on("loaded",c),this.player.debug.log(this.manager)}),this.initialized=!1,this.requestAds()}).catch(()=>{})}),Me(this,"trigger",(c,...v)=>{const E=this.events[c];D.array(E)&&E.forEach(T=>{D.function(T)&&T.apply(this,v)})}),Me(this,"on",(c,v)=>(D.array(this.events[c])||(this.events[c]=[]),this.events[c].push(v),this)),Me(this,"startSafetyTimer",(c,v)=>{this.player.debug.log(`Safety timer invoked from: ${v}`),this.safetyTimer=setTimeout(()=>{this.cancel(),this.clearSafetyTimer("startSafetyTimer()")},c)}),Me(this,"clearSafetyTimer",c=>{D.nullOrUndefined(this.safetyTimer)||(this.player.debug.log(`Safety timer cleared from: ${c}`),clearTimeout(this.safetyTimer),this.safetyTimer=null)}),this.player=g,this.config=g.config.ads,this.playing=!1,this.initialized=!1,this.elements={container:null,displayContainer:null},this.manager=null,this.loader=null,this.cuePoints=null,this.events={},this.safetyTimer=null,this.countdownTimer=null,this.managerPromise=new Promise((c,v)=>{this.on("loaded",c),this.on("error",v)}),this.load()}get enabled(){const{config:g}=this;return this.player.isHTML5&&this.player.isVideo&&g.enabled&&(!D.empty(g.publisherId)||D.url(g.tagUrl))}get tagUrl(){const{config:g}=this;return D.url(g.tagUrl)?g.tagUrl:`https://go.aniview.com/api/adserver6/vast/?${Is({AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:g.publisherId})}`}}function _s(o=0,g=0,c=255){return Math.min(Math.max(o,g),c)}const Vo=o=>{const g=[];return o.split(/\r\n\r\n|\n\n|\r\r/).forEach(c=>{const v={};c.split(/\r\n|\n|\r/).forEach(E=>{if(D.number(v.startTime)){if(!D.empty(E.trim())&&D.empty(v.text)){const T=E.trim().split("#xywh=");[v.text]=T,T[1]&&([v.x,v.y,v.w,v.h]=T[1].split(","))}}else{const T=E.match(/([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})( ?--> ?)([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})/);T&&(v.startTime=60*Number(T[1]||0)*60+60*Number(T[2])+Number(T[3])+Number(`0.${T[4]}`),v.endTime=60*Number(T[6]||0)*60+60*Number(T[7])+Number(T[8])+Number(`0.${T[9]}`))}}),v.text&&g.push(v)}),g},as=(o,g)=>{const c={};return o>g.width/g.height?(c.width=g.width,c.height=1/o*g.width):(c.height=g.height,c.width=o*g.height),c};class rn{constructor(g){Me(this,"load",()=>{this.player.elements.display.seekTooltip&&(this.player.elements.display.seekTooltip.hidden=this.enabled),this.enabled&&this.getThumbnails().then(()=>{this.enabled&&(this.render(),this.determineContainerAutoSizing(),this.loaded=!0)})}),Me(this,"getThumbnails",()=>new Promise(c=>{const{src:v}=this.player.config.previewThumbnails;if(D.empty(v))throw new Error("Missing previewThumbnails.src config attribute");const E=()=>{this.thumbnails.sort((T,w)=>T.height-w.height),this.player.debug.log("Preview thumbnails",this.thumbnails),c()};if(D.function(v))v(T=>{this.thumbnails=T,E()});else{const T=(D.string(v)?[v]:v).map(w=>this.getThumbnail(w));Promise.all(T).then(E)}})),Me(this,"getThumbnail",c=>new Promise(v=>{qi(c).then(E=>{const T={frames:Vo(E),height:null,urlPrefix:""};T.frames[0].text.startsWith("/")||T.frames[0].text.startsWith("http://")||T.frames[0].text.startsWith("https://")||(T.urlPrefix=c.substring(0,c.lastIndexOf("/")+1));const w=new Image;w.onload=()=>{T.height=w.naturalHeight,T.width=w.naturalWidth,this.thumbnails.push(T),v()},w.src=T.urlPrefix+T.frames[0].text})})),Me(this,"startMove",c=>{if(this.loaded&&D.event(c)&&["touchmove","mousemove"].includes(c.type)&&this.player.media.duration){if(c.type==="touchmove")this.seekTime=this.player.media.duration*(this.player.elements.inputs.seek.value/100);else{var v,E;const T=this.player.elements.progress.getBoundingClientRect(),w=100/T.width*(c.pageX-T.left);this.seekTime=this.player.media.duration*(w/100),this.seekTime<0&&(this.seekTime=0),this.seekTime>this.player.media.duration-1&&(this.seekTime=this.player.media.duration-1),this.mousePosX=c.pageX,this.elements.thumb.time.innerText=lr(this.seekTime);const L=(v=this.player.config.markers)===null||v===void 0||(E=v.points)===null||E===void 0?void 0:E.find(({time:R})=>R===Math.round(this.seekTime));L&&this.elements.thumb.time.insertAdjacentHTML("afterbegin",`${L.label}<br>`)}this.showImageAtCurrentTime()}}),Me(this,"endMove",()=>{this.toggleThumbContainer(!1,!0)}),Me(this,"startScrubbing",c=>{(D.nullOrUndefined(c.button)||c.button===!1||c.button===0)&&(this.mouseDown=!0,this.player.media.duration&&(this.toggleScrubbingContainer(!0),this.toggleThumbContainer(!1,!0),this.showImageAtCurrentTime()))}),Me(this,"endScrubbing",()=>{this.mouseDown=!1,Math.ceil(this.lastTime)===Math.ceil(this.player.media.currentTime)?this.toggleScrubbingContainer(!1):on.call(this.player,this.player.media,"timeupdate",()=>{this.mouseDown||this.toggleScrubbingContainer(!1)})}),Me(this,"listeners",()=>{this.player.on("play",()=>{this.toggleThumbContainer(!1,!0)}),this.player.on("seeked",()=>{this.toggleThumbContainer(!1)}),this.player.on("timeupdate",()=>{this.lastTime=this.player.media.currentTime})}),Me(this,"render",()=>{this.elements.thumb.container=qe("div",{class:this.player.config.classNames.previewThumbnails.thumbContainer}),this.elements.thumb.imageContainer=qe("div",{class:this.player.config.classNames.previewThumbnails.imageContainer}),this.elements.thumb.container.appendChild(this.elements.thumb.imageContainer);const c=qe("div",{class:this.player.config.classNames.previewThumbnails.timeContainer});this.elements.thumb.time=qe("span",{},"00:00"),c.appendChild(this.elements.thumb.time),this.elements.thumb.imageContainer.appendChild(c),D.element(this.player.elements.progress)&&this.player.elements.progress.appendChild(this.elements.thumb.container),this.elements.scrubbing.container=qe("div",{class:this.player.config.classNames.previewThumbnails.scrubbingContainer}),this.player.elements.wrapper.appendChild(this.elements.scrubbing.container)}),Me(this,"destroy",()=>{this.elements.thumb.container&&this.elements.thumb.container.remove(),this.elements.scrubbing.container&&this.elements.scrubbing.container.remove()}),Me(this,"showImageAtCurrentTime",()=>{this.mouseDown?this.setScrubbingContainerSize():this.setThumbContainerSizeAndPos();const c=this.thumbnails[0].frames.findIndex(T=>this.seekTime>=T.startTime&&this.seekTime<=T.endTime),v=c>=0;let E=0;this.mouseDown||this.toggleThumbContainer(v),v&&(this.thumbnails.forEach((T,w)=>{this.loadedImages.includes(T.frames[c].text)&&(E=w)}),c!==this.showingThumb&&(this.showingThumb=c,this.loadImage(E)))}),Me(this,"loadImage",(c=0)=>{const v=this.showingThumb,E=this.thumbnails[c],{urlPrefix:T}=E,w=E.frames[v],L=E.frames[v].text,R=T+L;if(this.currentImageElement&&this.currentImageElement.dataset.filename===L)this.showImage(this.currentImageElement,w,c,v,L,!1),this.currentImageElement.dataset.index=v,this.removeOldImages(this.currentImageElement);else{this.loadingImage&&this.usingSprites&&(this.loadingImage.onload=null);const B=new Image;B.src=R,B.dataset.index=v,B.dataset.filename=L,this.showingThumbFilename=L,this.player.debug.log(`Loading image: ${R}`),B.onload=()=>this.showImage(B,w,c,v,L,!0),this.loadingImage=B,this.removeOldImages(B)}}),Me(this,"showImage",(c,v,E,T,w,L=!0)=>{this.player.debug.log(`Showing thumb: ${w}. num: ${T}. qual: ${E}. newimg: ${L}`),this.setImageSizeAndOffset(c,v),L&&(this.currentImageContainer.appendChild(c),this.currentImageElement=c,this.loadedImages.includes(w)||this.loadedImages.push(w)),this.preloadNearby(T,!0).then(this.preloadNearby(T,!1)).then(this.getHigherQuality(E,c,v,w))}),Me(this,"removeOldImages",c=>{Array.from(this.currentImageContainer.children).forEach(v=>{if(v.tagName.toLowerCase()!=="img")return;const E=this.usingSprites?500:1e3;if(v.dataset.index!==c.dataset.index&&!v.dataset.deleting){v.dataset.deleting=!0;const{currentImageContainer:T}=this;setTimeout(()=>{T.removeChild(v),this.player.debug.log(`Removing thumb: ${v.dataset.filename}`)},E)}})}),Me(this,"preloadNearby",(c,v=!0)=>new Promise(E=>{setTimeout(()=>{const T=this.thumbnails[0].frames[c].text;if(this.showingThumbFilename===T){let w;w=v?this.thumbnails[0].frames.slice(c):this.thumbnails[0].frames.slice(0,c).reverse();let L=!1;w.forEach(R=>{const B=R.text;if(B!==T&&!this.loadedImages.includes(B)){L=!0,this.player.debug.log(`Preloading thumb filename: ${B}`);const{urlPrefix:H}=this.thumbnails[0],N=H+B,p=new Image;p.src=N,p.onload=()=>{this.player.debug.log(`Preloaded thumb filename: ${B}`),this.loadedImages.includes(B)||this.loadedImages.push(B),E()}}}),L||E()}},300)})),Me(this,"getHigherQuality",(c,v,E,T)=>{if(c<this.thumbnails.length-1){let w=v.naturalHeight;this.usingSprites&&(w=E.h),w<this.thumbContainerHeight&&setTimeout(()=>{this.showingThumbFilename===T&&(this.player.debug.log(`Showing higher quality thumb for: ${T}`),this.loadImage(c+1))},300)}}),Me(this,"toggleThumbContainer",(c=!1,v=!1)=>{const E=this.player.config.classNames.previewThumbnails.thumbContainerShown;this.elements.thumb.container.classList.toggle(E,c),!c&&v&&(this.showingThumb=null,this.showingThumbFilename=null)}),Me(this,"toggleScrubbingContainer",(c=!1)=>{const v=this.player.config.classNames.previewThumbnails.scrubbingContainerShown;this.elements.scrubbing.container.classList.toggle(v,c),c||(this.showingThumb=null,this.showingThumbFilename=null)}),Me(this,"determineContainerAutoSizing",()=>{(this.elements.thumb.imageContainer.clientHeight>20||this.elements.thumb.imageContainer.clientWidth>20)&&(this.sizeSpecifiedInCSS=!0)}),Me(this,"setThumbContainerSizeAndPos",()=>{const{imageContainer:c}=this.elements.thumb;if(this.sizeSpecifiedInCSS){if(c.clientHeight>20&&c.clientWidth<20){const v=Math.floor(c.clientHeight*this.thumbAspectRatio);c.style.width=`${v}px`}else if(c.clientHeight<20&&c.clientWidth>20){const v=Math.floor(c.clientWidth/this.thumbAspectRatio);c.style.height=`${v}px`}}else{const v=Math.floor(this.thumbContainerHeight*this.thumbAspectRatio);c.style.height=`${this.thumbContainerHeight}px`,c.style.width=`${v}px`}this.setThumbContainerPos()}),Me(this,"setThumbContainerPos",()=>{const c=this.player.elements.progress.getBoundingClientRect(),v=this.player.elements.container.getBoundingClientRect(),{container:E}=this.elements.thumb,T=v.left-c.left+10,w=v.right-c.left-E.clientWidth-10,L=this.mousePosX-c.left-E.clientWidth/2,R=_s(L,T,w);E.style.left=`${R}px`,E.style.setProperty("--preview-arrow-offset",L-R+"px")}),Me(this,"setScrubbingContainerSize",()=>{const{width:c,height:v}=as(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});this.elements.scrubbing.container.style.width=`${c}px`,this.elements.scrubbing.container.style.height=`${v}px`}),Me(this,"setImageSizeAndOffset",(c,v)=>{if(!this.usingSprites)return;const E=this.thumbContainerHeight/v.h;c.style.height=c.naturalHeight*E+"px",c.style.width=c.naturalWidth*E+"px",c.style.left=`-${v.x*E}px`,c.style.top=`-${v.y*E}px`}),this.player=g,this.thumbnails=[],this.loaded=!1,this.lastMouseMoveTime=Date.now(),this.mouseDown=!1,this.loadedImages=[],this.elements={thumb:{},scrubbing:{}},this.load()}get enabled(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.previewThumbnails.enabled}get currentImageContainer(){return this.mouseDown?this.elements.scrubbing.container:this.elements.thumb.imageContainer}get usingSprites(){return Object.keys(this.thumbnails[0].frames[0]).includes("w")}get thumbAspectRatio(){return this.usingSprites?this.thumbnails[0].frames[0].w/this.thumbnails[0].frames[0].h:this.thumbnails[0].width/this.thumbnails[0].height}get thumbContainerHeight(){if(this.mouseDown){const{height:g}=as(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});return g}return this.sizeSpecifiedInCSS?this.elements.thumb.imageContainer.clientHeight:Math.floor(this.player.media.clientWidth/this.thumbAspectRatio/4)}get currentImageElement(){return this.mouseDown?this.currentScrubbingImageElement:this.currentThumbnailImageElement}set currentImageElement(g){this.mouseDown?this.currentScrubbingImageElement=g:this.currentThumbnailImageElement=g}}const nn={insertElements(o,g){D.string(g)?is(o,this.media,{src:g}):D.array(g)&&g.forEach(c=>{is(o,this.media,c)})},change(o){ys(o,"sources.length")?(fi.cancelRequests.call(this),this.destroy.call(this,()=>{this.options.quality=[],li(this.media),this.media=null,D.element(this.elements.container)&&this.elements.container.removeAttribute("class");const{sources:g,type:c}=o,[{provider:v=di.html5,src:E}]=g,T=v==="html5"?c:"div",w=v==="html5"?{}:{src:E};Object.assign(this,{provider:v,type:c,supported:Dt.check(c,v,this.config.playsinline),media:qe(T,w)}),this.elements.container.appendChild(this.media),D.boolean(o.autoplay)&&(this.config.autoplay=o.autoplay),this.isHTML5&&(this.config.crossorigin&&this.media.setAttribute("crossorigin",""),this.config.autoplay&&this.media.setAttribute("autoplay",""),D.empty(o.poster)||(this.poster=o.poster),this.config.loop.active&&this.media.setAttribute("loop",""),this.config.muted&&this.media.setAttribute("muted",""),this.config.playsinline&&this.media.setAttribute("playsinline","")),bt.addStyleHook.call(this),this.isHTML5&&nn.insertElements.call(this,"source",g),this.config.title=o.title,Cs.setup.call(this),this.isHTML5&&Object.keys(o).includes("tracks")&&nn.insertElements.call(this,"track",o.tracks),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&bt.build.call(this),this.isHTML5&&this.media.load(),D.empty(o.previewThumbnails)||(Object.assign(this.config.previewThumbnails,o.previewThumbnails),this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new rn(this))),this.fullscreen.update()},!0)):this.debug.warn("Invalid source format")}};class ji{constructor(g,c){if(Me(this,"play",()=>D.function(this.media.play)?(this.ads&&this.ads.enabled&&this.ads.managerPromise.then(()=>this.ads.play()).catch(()=>ii(this.media.play())),this.media.play()):null),Me(this,"pause",()=>this.playing&&D.function(this.media.pause)?this.media.pause():null),Me(this,"togglePlay",L=>(D.boolean(L)?L:!this.playing)?this.play():this.pause()),Me(this,"stop",()=>{this.isHTML5?(this.pause(),this.restart()):D.function(this.media.stop)&&this.media.stop()}),Me(this,"restart",()=>{this.currentTime=0}),Me(this,"rewind",L=>{this.currentTime-=D.number(L)?L:this.config.seekTime}),Me(this,"forward",L=>{this.currentTime+=D.number(L)?L:this.config.seekTime}),Me(this,"increaseVolume",L=>{const R=this.media.muted?0:this.volume;this.volume=R+(D.number(L)?L:0)}),Me(this,"decreaseVolume",L=>{this.increaseVolume(-L)}),Me(this,"airplay",()=>{Dt.airplay&&this.media.webkitShowPlaybackTargetPicker()}),Me(this,"toggleControls",L=>{if(this.supported.ui&&!this.isAudio){const R=nr(this.elements.container,this.config.classNames.hideControls),B=L===void 0?void 0:!L,H=ut(this.elements.container,this.config.classNames.hideControls,B);if(H&&D.array(this.config.controls)&&this.config.controls.includes("settings")&&!D.empty(this.config.settings)&&Oe.toggleMenu.call(this,!1),H!==R){const N=H?"controlshidden":"controlsshown";We.call(this,this.media,N)}return!H}return!1}),Me(this,"on",(L,R)=>{dt.call(this,this.elements.container,L,R)}),Me(this,"once",(L,R)=>{on.call(this,this.elements.container,L,R)}),Me(this,"off",(L,R)=>{or(this.elements.container,L,R)}),Me(this,"destroy",(L,R=!1)=>{if(!this.ready)return;const B=()=>{document.body.style.overflow="",this.embed=null,R?(Object.keys(this.elements).length&&(li(this.elements.buttons.play),li(this.elements.captions),li(this.elements.controls),li(this.elements.wrapper),this.elements.buttons.play=null,this.elements.captions=null,this.elements.controls=null,this.elements.wrapper=null),D.function(L)&&L()):(Ao.call(this),fi.cancelRequests.call(this),rr(this.elements.original,this.elements.container),We.call(this,this.elements.original,"destroyed",!0),D.function(L)&&L.call(this.elements.original),this.ready=!1,setTimeout(()=>{this.elements=null,this.media=null},200))};this.stop(),clearTimeout(this.timers.loading),clearTimeout(this.timers.controls),clearTimeout(this.timers.resized),this.isHTML5?(bt.toggleNativeControls.call(this,!0),B()):this.isYouTube?(clearInterval(this.timers.buffering),clearInterval(this.timers.playing),this.embed!==null&&D.function(this.embed.destroy)&&this.embed.destroy(),B()):this.isVimeo&&(this.embed!==null&&this.embed.unload().then(B),setTimeout(B,200))}),Me(this,"supports",L=>Dt.mime.call(this,L)),this.timers={},this.ready=!1,this.loading=!1,this.failed=!1,this.touch=Dt.touch,this.media=g,D.string(this.media)&&(this.media=document.querySelectorAll(this.media)),(window.jQuery&&this.media instanceof jQuery||D.nodeList(this.media)||D.array(this.media))&&(this.media=this.media[0]),this.config=Ct({},Rs,ji.defaults,c||{},(()=>{try{return JSON.parse(this.media.getAttribute("data-plyr-config"))}catch{return{}}})()),this.elements={container:null,fullscreen:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}},this.captions={active:null,currentTrack:-1,meta:new WeakMap},this.fullscreen={active:!1},this.options={speed:[],quality:[]},this.debug=new Fo(this.config.debug),this.debug.log("Config",this.config),this.debug.log("Support",Dt),D.nullOrUndefined(this.media)||!D.element(this.media))return void this.debug.error("Setup failed: no suitable element passed");if(this.media.plyr)return void this.debug.warn("Target already setup");if(!this.config.enabled)return void this.debug.error("Setup failed: disabled by config");if(!Dt.check().api)return void this.debug.error("Setup failed: no support");const v=this.media.cloneNode(!0);v.autoplay=!1,this.elements.original=v;const E=this.media.tagName.toLowerCase();let T=null,w=null;switch(E){case"div":if(T=this.media.querySelector("iframe"),D.element(T)){if(w=Ds(T.getAttribute("src")),this.provider=xo(w.toString()),this.elements.container=this.media,this.media=T,this.elements.container.className="",w.search.length){const L=["1","true"];L.includes(w.searchParams.get("autoplay"))&&(this.config.autoplay=!0),L.includes(w.searchParams.get("loop"))&&(this.config.loop.active=!0),this.isYouTube?(this.config.playsinline=L.includes(w.searchParams.get("playsinline")),this.config.youtube.hl=w.searchParams.get("hl")):this.config.playsinline=!0}}else this.provider=this.media.getAttribute(this.config.attributes.embed.provider),this.media.removeAttribute(this.config.attributes.embed.provider);if(D.empty(this.provider)||!Object.values(di).includes(this.provider))return void this.debug.error("Setup failed: Invalid provider");this.type=$r.video;break;case"video":case"audio":this.type=E,this.provider=di.html5,this.media.hasAttribute("crossorigin")&&(this.config.crossorigin=!0),this.media.hasAttribute("autoplay")&&(this.config.autoplay=!0),(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline"))&&(this.config.playsinline=!0),this.media.hasAttribute("muted")&&(this.config.muted=!0),this.media.hasAttribute("loop")&&(this.config.loop.active=!0);break;default:return void this.debug.error("Setup failed: unsupported type")}this.supported=Dt.check(this.type,this.provider,this.config.playsinline),this.supported.api?(this.eventListeners=[],this.listeners=new Mo(this),this.storage=new Gi(this),this.media.plyr=this,D.element(this.elements.container)||(this.elements.container=qe("div",{tabindex:0}),Es(this.media,this.elements.container)),bt.migrateStyles.call(this),bt.addStyleHook.call(this),Cs.setup.call(this),this.config.debug&&dt.call(this,this.elements.container,this.config.events.join(" "),L=>{this.debug.log(`event: ${L.type}`)}),this.fullscreen=new ti(this),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&bt.build.call(this),this.listeners.container(),this.listeners.global(),this.config.ads.enabled&&(this.ads=new Ho(this)),this.isHTML5&&this.config.autoplay&&this.once("canplay",()=>ii(this.play())),this.lastSeekTime=0,this.config.previewThumbnails.enabled&&(this.previewThumbnails=new rn(this))):this.debug.error("Setup failed: no support")}get isHTML5(){return this.provider===di.html5}get isEmbed(){return this.isYouTube||this.isVimeo}get isYouTube(){return this.provider===di.youtube}get isVimeo(){return this.provider===di.vimeo}get isVideo(){return this.type===$r.video}get isAudio(){return this.type===$r.audio}get playing(){return Boolean(this.ready&&!this.paused&&!this.ended)}get paused(){return Boolean(this.media.paused)}get stopped(){return Boolean(this.paused&&this.currentTime===0)}get ended(){return Boolean(this.media.ended)}set currentTime(g){if(!this.duration)return;const c=D.number(g)&&g>0;this.media.currentTime=c?Math.min(g,this.duration):0,this.debug.log(`Seeking to ${this.currentTime} seconds`)}get currentTime(){return Number(this.media.currentTime)}get buffered(){const{buffered:g}=this.media;return D.number(g)?g:g&&g.length&&this.duration>0?g.end(0)/this.duration:0}get seeking(){return Boolean(this.media.seeking)}get duration(){const g=parseFloat(this.config.duration),c=(this.media||{}).duration,v=D.number(c)&&c!==1/0?c:0;return g||v}set volume(g){let c=g;D.string(c)&&(c=Number(c)),D.number(c)||(c=this.storage.get("volume")),D.number(c)||({volume:c}=this.config),c>1&&(c=1),c<0&&(c=0),this.config.volume=c,this.media.volume=c,!D.empty(g)&&this.muted&&c>0&&(this.muted=!1)}get volume(){return Number(this.media.volume)}set muted(g){let c=g;D.boolean(c)||(c=this.storage.get("muted")),D.boolean(c)||(c=this.config.muted),this.config.muted=c,this.media.muted=c}get muted(){return Boolean(this.media.muted)}get hasAudio(){return!this.isHTML5||!!this.isAudio||Boolean(this.media.mozHasAudio)||Boolean(this.media.webkitAudioDecodedByteCount)||Boolean(this.media.audioTracks&&this.media.audioTracks.length)}set speed(g){let c=null;D.number(g)&&(c=g),D.number(c)||(c=this.storage.get("speed")),D.number(c)||(c=this.config.speed.selected);const{minimumSpeed:v,maximumSpeed:E}=this;c=_s(c,v,E),this.config.speed.selected=c,setTimeout(()=>{this.media&&(this.media.playbackRate=c)},0)}get speed(){return Number(this.media.playbackRate)}get minimumSpeed(){return this.isYouTube?Math.min(...this.options.speed):this.isVimeo?.5:.0625}get maximumSpeed(){return this.isYouTube?Math.max(...this.options.speed):this.isVimeo?2:16}set quality(g){const c=this.config.quality,v=this.options.quality;if(!v.length)return;let E=[!D.empty(g)&&Number(g),this.storage.get("quality"),c.selected,c.default].find(D.number),T=!0;if(!v.includes(E)){const w=bs(v,E);this.debug.warn(`Unsupported quality option: ${E}, using ${w} instead`),E=w,T=!1}c.selected=E,this.media.quality=E,T&&this.storage.set({quality:E})}get quality(){return this.media.quality}set loop(g){const c=D.boolean(g)?g:this.config.loop.active;this.config.loop.active=c,this.media.loop=c}get loop(){return Boolean(this.media.loop)}set source(g){nn.change.call(this,g)}get source(){return this.media.currentSrc}get download(){const{download:g}=this.config.urls;return D.url(g)?g:this.source}set download(g){D.url(g)&&(this.config.urls.download=g,Oe.setDownloadUrl.call(this))}set poster(g){this.isVideo?bt.setPoster.call(this,g,!1).catch(()=>{}):this.debug.warn("Poster can only be set for video")}get poster(){return this.isVideo?this.media.getAttribute("poster")||this.media.getAttribute("data-poster"):null}get ratio(){if(!this.isVideo)return null;const g=sr(ln.call(this));return D.array(g)?g.join(":"):g}set ratio(g){this.isVideo?D.string(g)&&Ss(g)?(this.config.ratio=sr(g),Ri.call(this)):this.debug.error(`Invalid aspect ratio specified (${g})`):this.debug.warn("Aspect ratio can only be set for video")}set autoplay(g){this.config.autoplay=D.boolean(g)?g:this.config.autoplay}get autoplay(){return Boolean(this.config.autoplay)}toggleCaptions(g){ft.toggle.call(this,g,!1)}set currentTrack(g){ft.set.call(this,g,!1),ft.setup.call(this)}get currentTrack(){const{toggled:g,currentTrack:c}=this.captions;return g?c:-1}set language(g){ft.setLanguage.call(this,g,!1)}get language(){return(ft.getCurrentTrack.call(this)||{}).language}set pip(g){if(!Dt.pip)return;const c=D.boolean(g)?g:!this.pip;D.function(this.media.webkitSetPresentationMode)&&this.media.webkitSetPresentationMode(c?Wr.active:Wr.inactive),D.function(this.media.requestPictureInPicture)&&(!this.pip&&c?this.media.requestPictureInPicture():this.pip&&!c&&document.exitPictureInPicture())}get pip(){return Dt.pip?D.empty(this.media.webkitPresentationMode)?this.media===document.pictureInPictureElement:this.media.webkitPresentationMode===Wr.active:null}setPreviewThumbnails(g){this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),Object.assign(this.config.previewThumbnails,g),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new rn(this))}static supported(g,c,v){return Dt.check(g,c,v)}static loadSprite(g,c){return ws(g,c)}static setup(g,c={}){let v=null;return D.string(g)?v=Array.from(document.querySelectorAll(g)):D.nodeList(g)?v=Array.from(g):D.array(g)&&(v=g.filter(D.element)),D.empty(v)?null:v.map(E=>new ji(E,c))}}ji.defaults=bo(Rs);const qo={data(){return{currentEpisode:this.$router.currentRoute.value.params.episode.toString(),language:this.$router.currentRoute.value.params.lang,animeId:this.$router.currentRoute.value.params.id,player:{volume:100,currentTime:0,duration:0,paused:!0,controls:!0,muted:!1,src:"",video:null},video:Ka(),title:"",innerHeight:window.innerHeight,innerWidth:window.innerWidth}},async mounted(){if(this.language!="vf"&&this.language!="vostfr")return this.$router.push("/");let o=xa[this.language].find(c=>c.id.toString()===this.animeId);const g=async c=>{if(document.title="Episode "+this.currentEpisode+" - "+c.title,!c){this.$router.back();return}let E=(await Ua(c.url)).episodes.find(R=>R.episode.toString()==this.currentEpisode);if(!E)return this.$router.push("/");let T=await Ba("https://neko-sama.fr"+E.url);if(!T)return this.$router.push("/");this.video={mp4:!1,uri:T.uri,available:!0,baseurl:T.baseurl};const w=Fa(parseInt(this.animeId.toString()),parseInt(this.currentEpisode.toString()),this.language),L=new ji("#playme",{storage:{enabled:!0,key:"videoPlayer"},autoplay:!0});if(this.title=c.title,this.$refs.player.style.aspectRatio=`${this.innerWidth}/${this.innerHeight}`,window.addEventListener("resize",()=>{this.$refs.player.style.aspectRatio=`${this.innerWidth}/${this.innerHeight}`}),document.addEventListener("keypress",R=>{switch(R.code){case"Space":L.paused?L.play():L.pause();break;case"KeyF":L.fullscreen.toggle();break;case"KeyM":L.muted=!L.muted;break}}),this.video&&this.video.available){let R=new Wa;R.loadSource(this.video.uri),R.attachMedia(this.$refs.player),setTimeout(()=>{w?this.$refs.player.currentTime=w.time:(this.$refs.player.currentTime=0,this.$refs.player.play()),this.$refs.player&&this.$refs.player.paused&&this.$refs.player.play()},1e3),this.$refs.player.addEventListener("timeupdate",()=>{Ma({id:parseInt(this.animeId.toString()),episode:parseInt(this.currentEpisode.toString()),time:this.$refs.player.currentTime,lang:this.language})}),this.$refs.player.addEventListener("ended",async()=>{this.$refs.player.currentTime=0,this.$router.replace(`/anime/${this.language}/${this.animeId}/episode/${parseInt(this.currentEpisode.toString())+1}`),this.currentEpisode=(parseInt(this.currentEpisode.toString())+1).toString(),await g(c)})}};await g(o)}},Yo={ref:"player",id:"playme",autoplay:"true","data-plyr-config":'{ "title": "{{ this.title }}" }'};function Wo(o,g,c,v,E,T){return Ga(),ja("div",null,[Ha("video",Yo,null,512)])}const Qo=Na(qo,[["render",Wo]]);export{Qo as default};
