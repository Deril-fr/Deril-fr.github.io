import{r as S}from"./removeDuplicates-4a376775.js";import{c as L,d as A}from"./index-40e0cab7.js";import{D as O,O as h,K as p,U as I}from"./vendor-7c7bf4c4.js";async function U(a){let t=await N(!1);t.find(i=>i.id===a.id&&i.lang===a.lang)&&(t=t.filter(i=>i.id!==a.id||i.lang!==a.lang)),t.push(a),localStorage.setItem("lastUpdated",String(Date.now())),localStorage.setItem("animeList",JSON.stringify(S(t)))}function D(a,t,i){const s=localStorage.getItem("animeList");return(s?JSON.parse(s):[]).find(n=>n.id===a&&n.episode===t&&n.lang===i)}async function N(a=!0){const t=localStorage.getItem("animeList"),i=localStorage.getItem("lastUpdated");let s=[];if(a){const n=L.currentUser;if(n){const r=O(A,"users",n.uid),c=await h(r);if(c){const e=c.data();if(e)if(t){if(e.animeList&&e.animeList.length>0){let g=JSON.parse(t),m=!1;if(g.length!==e.animeList.length)m=!0;else for(let o=0;o<e.animeList.length;o++){const l=e.animeList[o],d=g.find(f=>f.id===l.id&&f.lang===l.lang);if(d&&(d.episode!==l.episode||d.time!==l.time)){m=!0;break}}m&&(i&&e.updatedAt?Number(i)<e.updatedAt?(localStorage.setItem("animeList",JSON.stringify(e.animeList)),localStorage.setItem("lastUpdated",String(e.updatedAt))):(await p(r,{animeList:JSON.parse(t),updatedAt:Date.now()}),localStorage.setItem("lastUpdated",String(Date.now()))):(await p(r,{animeList:JSON.parse(t),updatedAt:Date.now()}),localStorage.setItem("lastUpdated",String(e.updatedAt))))}}else s=e.animeList?e.animeList:[],localStorage.setItem("animeList",JSON.stringify(s));else t&&I(r,{animeList:JSON.parse(t),updatedAt:Date.now()})}}}return t?JSON.parse(t):s}export{N as a,D as g,U as s};
