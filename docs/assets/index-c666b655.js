(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const p of i)if(p.type==="childList")for(const O of p.addedNodes)O.tagName==="LINK"&&O.rel==="modulepreload"&&n(O)}).observe(document,{childList:!0,subtree:!0});function r(i){const p={};return i.integrity&&(p.integrity=i.integrity),i.referrerpolicy&&(p.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?p.credentials="include":i.crossorigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function n(i){if(i.ep)return;i.ep=!0;const p=r(i);fetch(i.href,p)}})();function Bs(e,t){const r=Object.create(null),n=e.split(",");for(let i=0;i<n.length;i++)r[n[i]]=!0;return t?i=>!!r[i.toLowerCase()]:i=>!!r[i]}function ws(e){if(Se(e)){const t={};for(let r=0;r<e.length;r++){const n=e[r],i=je(n)?$c(n):ws(n);if(i)for(const p in i)t[p]=i[p]}return t}else{if(je(e))return e;if(Ue(e))return e}}const jc=/;(?![^(]*\))/g,Xc=/:([^]+)/,Qc=/\/\*.*?\*\//gs;function $c(e){const t={};return e.replace(Qc,"").split(jc).forEach(r=>{if(r){const n=r.split(Xc);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t}function Us(e){let t="";if(je(e))t=e;else if(Se(e))for(let r=0;r<e.length;r++){const n=Us(e[r]);n&&(t+=n+" ")}else if(Ue(e))for(const r in e)e[r]&&(t+=r+" ");return t.trim()}const zc="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",qc=Bs(zc);function iu(e){return!!e||e===""}const Yt=e=>je(e)?e:e==null?"":Se(e)||Ue(e)&&(e.toString===uu||!Ie(e.toString))?JSON.stringify(e,su,2):String(e),su=(e,t)=>t&&t.__v_isRef?su(e,t.value):Fr(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((r,[n,i])=>(r[`${n} =>`]=i,r),{})}:au(t)?{[`Set(${t.size})`]:[...t.values()]}:Ue(t)&&!Se(t)&&!lu(t)?String(t):t,we={},Mr=[],Ct=()=>{},Jc=()=>!1,Zc=/^on[^a-z]/,mi=e=>Zc.test(e),Hs=e=>e.startsWith("onUpdate:"),tt=Object.assign,Ks=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},ef=Object.prototype.hasOwnProperty,De=(e,t)=>ef.call(e,t),Se=Array.isArray,Fr=e=>Ei(e)==="[object Map]",au=e=>Ei(e)==="[object Set]",Ie=e=>typeof e=="function",je=e=>typeof e=="string",Ws=e=>typeof e=="symbol",Ue=e=>e!==null&&typeof e=="object",ou=e=>Ue(e)&&Ie(e.then)&&Ie(e.catch),uu=Object.prototype.toString,Ei=e=>uu.call(e),tf=e=>Ei(e).slice(8,-1),lu=e=>Ei(e)==="[object Object]",Gs=e=>je(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Xn=Bs(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),vi=e=>{const t=Object.create(null);return r=>t[r]||(t[r]=e(r))},rf=/-(\w)/g,Ht=vi(e=>e.replace(rf,(t,r)=>r?r.toUpperCase():"")),nf=/\B([A-Z])/g,Xr=vi(e=>e.replace(nf,"-$1").toLowerCase()),pi=vi(e=>e.charAt(0).toUpperCase()+e.slice(1)),Wi=vi(e=>e?`on${pi(e)}`:""),pn=(e,t)=>!Object.is(e,t),Gi=(e,t)=>{for(let r=0;r<e.length;r++)e[r](t)},ei=(e,t,r)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:r})},cu=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let Pa;const sf=()=>Pa||(Pa=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Pt;class af{constructor(t=!1){this.detached=t,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Pt,!t&&Pt&&(this.index=(Pt.scopes||(Pt.scopes=[])).push(this)-1)}run(t){if(this.active){const r=Pt;try{return Pt=this,t()}finally{Pt=r}}}on(){Pt=this}off(){Pt=this.parent}stop(t){if(this.active){let r,n;for(r=0,n=this.effects.length;r<n;r++)this.effects[r].stop();for(r=0,n=this.cleanups.length;r<n;r++)this.cleanups[r]();if(this.scopes)for(r=0,n=this.scopes.length;r<n;r++)this.scopes[r].stop(!0);if(!this.detached&&this.parent&&!t){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.parent=void 0,this.active=!1}}}function of(e,t=Pt){t&&t.active&&t.effects.push(e)}const Ys=e=>{const t=new Set(e);return t.w=0,t.n=0,t},fu=e=>(e.w&ir)>0,du=e=>(e.n&ir)>0,uf=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=ir},lf=e=>{const{deps:t}=e;if(t.length){let r=0;for(let n=0;n<t.length;n++){const i=t[n];fu(i)&&!du(i)?i.delete(e):t[r++]=i,i.w&=~ir,i.n&=~ir}t.length=r}},ls=new WeakMap;let sn=0,ir=1;const cs=30;let St;const Er=Symbol(""),fs=Symbol("");class Vs{constructor(t,r=null,n){this.fn=t,this.scheduler=r,this.active=!0,this.deps=[],this.parent=void 0,of(this,n)}run(){if(!this.active)return this.fn();let t=St,r=tr;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=St,St=this,tr=!0,ir=1<<++sn,sn<=cs?uf(this):Na(this),this.fn()}finally{sn<=cs&&lf(this),ir=1<<--sn,St=this.parent,tr=r,this.parent=void 0,this.deferStop&&this.stop()}}stop(){St===this?this.deferStop=!0:this.active&&(Na(this),this.onStop&&this.onStop(),this.active=!1)}}function Na(e){const{deps:t}=e;if(t.length){for(let r=0;r<t.length;r++)t[r].delete(e);t.length=0}}let tr=!0;const hu=[];function Qr(){hu.push(tr),tr=!1}function $r(){const e=hu.pop();tr=e===void 0?!0:e}function ft(e,t,r){if(tr&&St){let n=ls.get(e);n||ls.set(e,n=new Map);let i=n.get(r);i||n.set(r,i=Ys()),gu(i)}}function gu(e,t){let r=!1;sn<=cs?du(e)||(e.n|=ir,r=!fu(e)):r=!e.has(St),r&&(e.add(St),St.deps.push(e))}function Xt(e,t,r,n,i,p){const O=ls.get(e);if(!O)return;let I=[];if(t==="clear")I=[...O.values()];else if(r==="length"&&Se(e)){const s=cu(n);O.forEach((R,A)=>{(A==="length"||A>=s)&&I.push(R)})}else switch(r!==void 0&&I.push(O.get(r)),t){case"add":Se(e)?Gs(r)&&I.push(O.get("length")):(I.push(O.get(Er)),Fr(e)&&I.push(O.get(fs)));break;case"delete":Se(e)||(I.push(O.get(Er)),Fr(e)&&I.push(O.get(fs)));break;case"set":Fr(e)&&I.push(O.get(Er));break}if(I.length===1)I[0]&&ds(I[0]);else{const s=[];for(const R of I)R&&s.push(...R);ds(Ys(s))}}function ds(e,t){const r=Se(e)?e:[...e];for(const n of r)n.computed&&Ma(n);for(const n of r)n.computed||Ma(n)}function Ma(e,t){(e!==St||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const cf=Bs("__proto__,__v_isRef,__isVue"),mu=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(Ws)),ff=js(),df=js(!1,!0),hf=js(!0),Fa=gf();function gf(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...r){const n=Pe(this);for(let p=0,O=this.length;p<O;p++)ft(n,"get",p+"");const i=n[t](...r);return i===-1||i===!1?n[t](...r.map(Pe)):i}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...r){Qr();const n=Pe(this)[t].apply(this,r);return $r(),n}}),e}function js(e=!1,t=!1){return function(n,i,p){if(i==="__v_isReactive")return!e;if(i==="__v_isReadonly")return e;if(i==="__v_isShallow")return t;if(i==="__v_raw"&&p===(e?t?Rf:_u:t?Tu:pu).get(n))return n;const O=Se(n);if(!e&&O&&De(Fa,i))return Reflect.get(Fa,i,p);const I=Reflect.get(n,i,p);return(Ws(i)?mu.has(i):cf(i))||(e||ft(n,"get",i),t)?I:Xe(I)?O&&Gs(i)?I:I.value:Ue(I)?e?Au(I):yr(I):I}}const mf=Eu(),Ef=Eu(!0);function Eu(e=!1){return function(r,n,i,p){let O=r[n];if(Hr(O)&&Xe(O)&&!Xe(i))return!1;if(!e&&(!ti(i)&&!Hr(i)&&(O=Pe(O),i=Pe(i)),!Se(r)&&Xe(O)&&!Xe(i)))return O.value=i,!0;const I=Se(r)&&Gs(n)?Number(n)<r.length:De(r,n),s=Reflect.set(r,n,i,p);return r===Pe(p)&&(I?pn(i,O)&&Xt(r,"set",n,i):Xt(r,"add",n,i)),s}}function vf(e,t){const r=De(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&r&&Xt(e,"delete",t,void 0),n}function pf(e,t){const r=Reflect.has(e,t);return(!Ws(t)||!mu.has(t))&&ft(e,"has",t),r}function Tf(e){return ft(e,"iterate",Se(e)?"length":Er),Reflect.ownKeys(e)}const vu={get:ff,set:mf,deleteProperty:vf,has:pf,ownKeys:Tf},_f={get:hf,set(e,t){return!0},deleteProperty(e,t){return!0}},Af=tt({},vu,{get:df,set:Ef}),Xs=e=>e,Ti=e=>Reflect.getPrototypeOf(e);function kn(e,t,r=!1,n=!1){e=e.__v_raw;const i=Pe(e),p=Pe(t);r||(t!==p&&ft(i,"get",t),ft(i,"get",p));const{has:O}=Ti(i),I=n?Xs:r?zs:Tn;if(O.call(i,t))return I(e.get(t));if(O.call(i,p))return I(e.get(p));e!==i&&e.get(t)}function Bn(e,t=!1){const r=this.__v_raw,n=Pe(r),i=Pe(e);return t||(e!==i&&ft(n,"has",e),ft(n,"has",i)),e===i?r.has(e):r.has(e)||r.has(i)}function wn(e,t=!1){return e=e.__v_raw,!t&&ft(Pe(e),"iterate",Er),Reflect.get(e,"size",e)}function ka(e){e=Pe(e);const t=Pe(this);return Ti(t).has.call(t,e)||(t.add(e),Xt(t,"add",e,e)),this}function Ba(e,t){t=Pe(t);const r=Pe(this),{has:n,get:i}=Ti(r);let p=n.call(r,e);p||(e=Pe(e),p=n.call(r,e));const O=i.call(r,e);return r.set(e,t),p?pn(t,O)&&Xt(r,"set",e,t):Xt(r,"add",e,t),this}function wa(e){const t=Pe(this),{has:r,get:n}=Ti(t);let i=r.call(t,e);i||(e=Pe(e),i=r.call(t,e)),n&&n.call(t,e);const p=t.delete(e);return i&&Xt(t,"delete",e,void 0),p}function Ua(){const e=Pe(this),t=e.size!==0,r=e.clear();return t&&Xt(e,"clear",void 0,void 0),r}function Un(e,t){return function(n,i){const p=this,O=p.__v_raw,I=Pe(O),s=t?Xs:e?zs:Tn;return!e&&ft(I,"iterate",Er),O.forEach((R,A)=>n.call(i,s(R),s(A),p))}}function Hn(e,t,r){return function(...n){const i=this.__v_raw,p=Pe(i),O=Fr(p),I=e==="entries"||e===Symbol.iterator&&O,s=e==="keys"&&O,R=i[e](...n),A=r?Xs:t?zs:Tn;return!t&&ft(p,"iterate",s?fs:Er),{next(){const{value:w,done:D}=R.next();return D?{value:w,done:D}:{value:I?[A(w[0]),A(w[1])]:A(w),done:D}},[Symbol.iterator](){return this}}}}function $t(e){return function(...t){return e==="delete"?!1:this}}function yf(){const e={get(p){return kn(this,p)},get size(){return wn(this)},has:Bn,add:ka,set:Ba,delete:wa,clear:Ua,forEach:Un(!1,!1)},t={get(p){return kn(this,p,!1,!0)},get size(){return wn(this)},has:Bn,add:ka,set:Ba,delete:wa,clear:Ua,forEach:Un(!1,!0)},r={get(p){return kn(this,p,!0)},get size(){return wn(this,!0)},has(p){return Bn.call(this,p,!0)},add:$t("add"),set:$t("set"),delete:$t("delete"),clear:$t("clear"),forEach:Un(!0,!1)},n={get(p){return kn(this,p,!0,!0)},get size(){return wn(this,!0)},has(p){return Bn.call(this,p,!0)},add:$t("add"),set:$t("set"),delete:$t("delete"),clear:$t("clear"),forEach:Un(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(p=>{e[p]=Hn(p,!1,!1),r[p]=Hn(p,!0,!1),t[p]=Hn(p,!1,!0),n[p]=Hn(p,!0,!0)}),[e,r,t,n]}const[bf,Sf,xf,If]=yf();function Qs(e,t){const r=t?e?If:xf:e?Sf:bf;return(n,i,p)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?n:Reflect.get(De(r,i)&&i in n?r:n,i,p)}const Cf={get:Qs(!1,!1)},Lf={get:Qs(!1,!0)},Df={get:Qs(!0,!1)},pu=new WeakMap,Tu=new WeakMap,_u=new WeakMap,Rf=new WeakMap;function Of(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Pf(e){return e.__v_skip||!Object.isExtensible(e)?0:Of(tf(e))}function yr(e){return Hr(e)?e:$s(e,!1,vu,Cf,pu)}function Nf(e){return $s(e,!1,Af,Lf,Tu)}function Au(e){return $s(e,!0,_f,Df,_u)}function $s(e,t,r,n,i){if(!Ue(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const p=i.get(e);if(p)return p;const O=Pf(e);if(O===0)return e;const I=new Proxy(e,O===2?n:r);return i.set(e,I),I}function kr(e){return Hr(e)?kr(e.__v_raw):!!(e&&e.__v_isReactive)}function Hr(e){return!!(e&&e.__v_isReadonly)}function ti(e){return!!(e&&e.__v_isShallow)}function yu(e){return kr(e)||Hr(e)}function Pe(e){const t=e&&e.__v_raw;return t?Pe(t):e}function bu(e){return ei(e,"__v_skip",!0),e}const Tn=e=>Ue(e)?yr(e):e,zs=e=>Ue(e)?Au(e):e;function Su(e){tr&&St&&(e=Pe(e),gu(e.dep||(e.dep=Ys())))}function xu(e,t){e=Pe(e),e.dep&&ds(e.dep)}function Xe(e){return!!(e&&e.__v_isRef===!0)}function pr(e){return Iu(e,!1)}function Mf(e){return Iu(e,!0)}function Iu(e,t){return Xe(e)?e:new Ff(e,t)}class Ff{constructor(t,r){this.__v_isShallow=r,this.dep=void 0,this.__v_isRef=!0,this._rawValue=r?t:Pe(t),this._value=r?t:Tn(t)}get value(){return Su(this),this._value}set value(t){const r=this.__v_isShallow||ti(t)||Hr(t);t=r?t:Pe(t),pn(t,this._rawValue)&&(this._rawValue=t,this._value=r?t:Tn(t),xu(this))}}function kt(e){return Xe(e)?e.value:e}const kf={get:(e,t,r)=>kt(Reflect.get(e,t,r)),set:(e,t,r,n)=>{const i=e[t];return Xe(i)&&!Xe(r)?(i.value=r,!0):Reflect.set(e,t,r,n)}};function Cu(e){return kr(e)?e:new Proxy(e,kf)}var Lu;class Bf{constructor(t,r,n,i){this._setter=r,this.dep=void 0,this.__v_isRef=!0,this[Lu]=!1,this._dirty=!0,this.effect=new Vs(t,()=>{this._dirty||(this._dirty=!0,xu(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=n}get value(){const t=Pe(this);return Su(t),(t._dirty||!t._cacheable)&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}Lu="__v_isReadonly";function wf(e,t,r=!1){let n,i;const p=Ie(e);return p?(n=e,i=Ct):(n=e.get,i=e.set),new Bf(n,i,p||!i,r)}function rr(e,t,r,n){let i;try{i=n?e(...n):e()}catch(p){_i(p,t,r)}return i}function Lt(e,t,r,n){if(Ie(e)){const p=rr(e,t,r,n);return p&&ou(p)&&p.catch(O=>{_i(O,t,r)}),p}const i=[];for(let p=0;p<e.length;p++)i.push(Lt(e[p],t,r,n));return i}function _i(e,t,r,n=!0){const i=t?t.vnode:null;if(t){let p=t.parent;const O=t.proxy,I=r;for(;p;){const R=p.ec;if(R){for(let A=0;A<R.length;A++)if(R[A](e,O,I)===!1)return}p=p.parent}const s=t.appContext.config.errorHandler;if(s){rr(s,null,10,[e,O,I]);return}}Uf(e,r,i,n)}function Uf(e,t,r,n=!0){console.error(e)}let _n=!1,hs=!1;const Je=[];let Mt=0;const Br=[];let Gt=null,fr=0;const Du=Promise.resolve();let qs=null;function Ru(e){const t=qs||Du;return e?t.then(this?e.bind(this):e):t}function Hf(e){let t=Mt+1,r=Je.length;for(;t<r;){const n=t+r>>>1;An(Je[n])<e?t=n+1:r=n}return t}function Js(e){(!Je.length||!Je.includes(e,_n&&e.allowRecurse?Mt+1:Mt))&&(e.id==null?Je.push(e):Je.splice(Hf(e.id),0,e),Ou())}function Ou(){!_n&&!hs&&(hs=!0,qs=Du.then(Nu))}function Kf(e){const t=Je.indexOf(e);t>Mt&&Je.splice(t,1)}function Wf(e){Se(e)?Br.push(...e):(!Gt||!Gt.includes(e,e.allowRecurse?fr+1:fr))&&Br.push(e),Ou()}function Ha(e,t=_n?Mt+1:0){for(;t<Je.length;t++){const r=Je[t];r&&r.pre&&(Je.splice(t,1),t--,r())}}function Pu(e){if(Br.length){const t=[...new Set(Br)];if(Br.length=0,Gt){Gt.push(...t);return}for(Gt=t,Gt.sort((r,n)=>An(r)-An(n)),fr=0;fr<Gt.length;fr++)Gt[fr]();Gt=null,fr=0}}const An=e=>e.id==null?1/0:e.id,Gf=(e,t)=>{const r=An(e)-An(t);if(r===0){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return r};function Nu(e){hs=!1,_n=!0,Je.sort(Gf);const t=Ct;try{for(Mt=0;Mt<Je.length;Mt++){const r=Je[Mt];r&&r.active!==!1&&rr(r,null,14)}}finally{Mt=0,Je.length=0,Pu(),_n=!1,qs=null,(Je.length||Br.length)&&Nu()}}function Yf(e,t,...r){if(e.isUnmounted)return;const n=e.vnode.props||we;let i=r;const p=t.startsWith("update:"),O=p&&t.slice(7);if(O&&O in n){const A=`${O==="modelValue"?"model":O}Modifiers`,{number:w,trim:D}=n[A]||we;D&&(i=r.map(K=>je(K)?K.trim():K)),w&&(i=r.map(cu))}let I,s=n[I=Wi(t)]||n[I=Wi(Ht(t))];!s&&p&&(s=n[I=Wi(Xr(t))]),s&&Lt(s,e,6,i);const R=n[I+"Once"];if(R){if(!e.emitted)e.emitted={};else if(e.emitted[I])return;e.emitted[I]=!0,Lt(R,e,6,i)}}function Mu(e,t,r=!1){const n=t.emitsCache,i=n.get(e);if(i!==void 0)return i;const p=e.emits;let O={},I=!1;if(!Ie(e)){const s=R=>{const A=Mu(R,t,!0);A&&(I=!0,tt(O,A))};!r&&t.mixins.length&&t.mixins.forEach(s),e.extends&&s(e.extends),e.mixins&&e.mixins.forEach(s)}return!p&&!I?(Ue(e)&&n.set(e,null),null):(Se(p)?p.forEach(s=>O[s]=null):tt(O,p),Ue(e)&&n.set(e,O),O)}function Ai(e,t){return!e||!mi(t)?!1:(t=t.slice(2).replace(/Once$/,""),De(e,t[0].toLowerCase()+t.slice(1))||De(e,Xr(t))||De(e,t))}let xt=null,Fu=null;function ri(e){const t=xt;return xt=e,Fu=e&&e.type.__scopeId||null,t}function Vf(e,t=xt,r){if(!t||e._n)return e;const n=(...i)=>{n._d&&$a(-1);const p=ri(t);let O;try{O=e(...i)}finally{ri(p),n._d&&$a(1)}return O};return n._n=!0,n._c=!0,n._d=!0,n}function Yi(e){const{type:t,vnode:r,proxy:n,withProxy:i,props:p,propsOptions:[O],slots:I,attrs:s,emit:R,render:A,renderCache:w,data:D,setupState:K,ctx:k,inheritAttrs:F}=e;let B,P;const N=ri(e);try{if(r.shapeFlag&4){const M=i||n;B=Nt(A.call(M,M,w,p,K,D,k)),P=s}else{const M=t;B=Nt(M.length>1?M(p,{attrs:s,slots:I,emit:R}):M(p,null)),P=t.props?s:jf(s)}}catch(M){un.length=0,_i(M,e,1),B=lt(Tr)}let g=B;if(P&&F!==!1){const M=Object.keys(P),{shapeFlag:S}=g;M.length&&S&7&&(O&&M.some(Hs)&&(P=Xf(P,O)),g=Kr(g,P))}return r.dirs&&(g=Kr(g),g.dirs=g.dirs?g.dirs.concat(r.dirs):r.dirs),r.transition&&(g.transition=r.transition),B=g,ri(N),B}const jf=e=>{let t;for(const r in e)(r==="class"||r==="style"||mi(r))&&((t||(t={}))[r]=e[r]);return t},Xf=(e,t)=>{const r={};for(const n in e)(!Hs(n)||!(n.slice(9)in t))&&(r[n]=e[n]);return r};function Qf(e,t,r){const{props:n,children:i,component:p}=e,{props:O,children:I,patchFlag:s}=t,R=p.emitsOptions;if(t.dirs||t.transition)return!0;if(r&&s>=0){if(s&1024)return!0;if(s&16)return n?Ka(n,O,R):!!O;if(s&8){const A=t.dynamicProps;for(let w=0;w<A.length;w++){const D=A[w];if(O[D]!==n[D]&&!Ai(R,D))return!0}}}else return(i||I)&&(!I||!I.$stable)?!0:n===O?!1:n?O?Ka(n,O,R):!0:!!O;return!1}function Ka(e,t,r){const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!0;for(let i=0;i<n.length;i++){const p=n[i];if(t[p]!==e[p]&&!Ai(r,p))return!0}return!1}function $f({vnode:e,parent:t},r){for(;t&&t.subTree===e;)(e=t.vnode).el=r,t=t.parent}const zf=e=>e.__isSuspense;function qf(e,t){t&&t.pendingBranch?Se(e)?t.effects.push(...e):t.effects.push(e):Wf(e)}function Qn(e,t){if(ze){let r=ze.provides;const n=ze.parent&&ze.parent.provides;n===r&&(r=ze.provides=Object.create(n)),r[e]=t}}function Vt(e,t,r=!1){const n=ze||xt;if(n){const i=n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides;if(i&&e in i)return i[e];if(arguments.length>1)return r&&Ie(t)?t.call(n.proxy):t}}const Kn={};function $n(e,t,r){return ku(e,t,r)}function ku(e,t,{immediate:r,deep:n,flush:i,onTrack:p,onTrigger:O}=we){const I=ze;let s,R=!1,A=!1;if(Xe(e)?(s=()=>e.value,R=ti(e)):kr(e)?(s=()=>e,n=!0):Se(e)?(A=!0,R=e.some(g=>kr(g)||ti(g)),s=()=>e.map(g=>{if(Xe(g))return g.value;if(kr(g))return Or(g);if(Ie(g))return rr(g,I,2)})):Ie(e)?t?s=()=>rr(e,I,2):s=()=>{if(!(I&&I.isUnmounted))return w&&w(),Lt(e,I,3,[D])}:s=Ct,t&&n){const g=s;s=()=>Or(g())}let w,D=g=>{w=P.onStop=()=>{rr(g,I,4)}},K;if(bn)if(D=Ct,t?r&&Lt(t,I,3,[s(),A?[]:void 0,D]):s(),i==="sync"){const g=Gd();K=g.__watcherHandles||(g.__watcherHandles=[])}else return Ct;let k=A?new Array(e.length).fill(Kn):Kn;const F=()=>{if(P.active)if(t){const g=P.run();(n||R||(A?g.some((M,S)=>pn(M,k[S])):pn(g,k)))&&(w&&w(),Lt(t,I,3,[g,k===Kn?void 0:A&&k[0]===Kn?[]:k,D]),k=g)}else P.run()};F.allowRecurse=!!t;let B;i==="sync"?B=F:i==="post"?B=()=>st(F,I&&I.suspense):(F.pre=!0,I&&(F.id=I.uid),B=()=>Js(F));const P=new Vs(s,B);t?r?F():k=P.run():i==="post"?st(P.run.bind(P),I&&I.suspense):P.run();const N=()=>{P.stop(),I&&I.scope&&Ks(I.scope.effects,P)};return K&&K.push(N),N}function Jf(e,t,r){const n=this.proxy,i=je(e)?e.includes(".")?Bu(n,e):()=>n[e]:e.bind(n,n);let p;Ie(t)?p=t:(p=t.handler,r=t);const O=ze;Wr(this);const I=ku(i,p.bind(n),r);return O?Wr(O):vr(),I}function Bu(e,t){const r=t.split(".");return()=>{let n=e;for(let i=0;i<r.length&&n;i++)n=n[r[i]];return n}}function Or(e,t){if(!Ue(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),Xe(e))Or(e.value,t);else if(Se(e))for(let r=0;r<e.length;r++)Or(e[r],t);else if(au(e)||Fr(e))e.forEach(r=>{Or(r,t)});else if(lu(e))for(const r in e)Or(e[r],t);return e}function br(e){return Ie(e)?{setup:e,name:e.name}:e}const zn=e=>!!e.type.__asyncLoader,wu=e=>e.type.__isKeepAlive;function Zf(e,t){Uu(e,"a",t)}function ed(e,t){Uu(e,"da",t)}function Uu(e,t,r=ze){const n=e.__wdc||(e.__wdc=()=>{let i=r;for(;i;){if(i.isDeactivated)return;i=i.parent}return e()});if(yi(t,n,r),r){let i=r.parent;for(;i&&i.parent;)wu(i.parent.vnode)&&td(n,t,r,i),i=i.parent}}function td(e,t,r,n){const i=yi(t,e,n,!0);Wu(()=>{Ks(n[t],i)},r)}function yi(e,t,r=ze,n=!1){if(r){const i=r[e]||(r[e]=[]),p=t.__weh||(t.__weh=(...O)=>{if(r.isUnmounted)return;Qr(),Wr(r);const I=Lt(t,r,e,O);return vr(),$r(),I});return n?i.unshift(p):i.push(p),p}}const Qt=e=>(t,r=ze)=>(!bn||e==="sp")&&yi(e,(...n)=>t(...n),r),rd=Qt("bm"),Hu=Qt("m"),nd=Qt("bu"),Ku=Qt("u"),id=Qt("bum"),Wu=Qt("um"),sd=Qt("sp"),ad=Qt("rtg"),od=Qt("rtc");function ud(e,t=ze){yi("ec",e,t)}function or(e,t,r,n){const i=e.dirs,p=t&&t.dirs;for(let O=0;O<i.length;O++){const I=i[O];p&&(I.oldValue=p[O].value);let s=I.dir[n];s&&(Qr(),Lt(s,r,8,[e.el,I,e,t]),$r())}}const Gu="components";function ld(e,t){return fd(Gu,e,!0,t)||e}const cd=Symbol();function fd(e,t,r=!0,n=!1){const i=xt||ze;if(i){const p=i.type;if(e===Gu){const I=Hd(p,!1);if(I&&(I===t||I===Ht(t)||I===pi(Ht(t))))return p}const O=Wa(i[e]||p[e],t)||Wa(i.appContext[e],t);return!O&&n?p:O}}function Wa(e,t){return e&&(e[t]||e[Ht(t)]||e[pi(Ht(t))])}function Yu(e,t,r,n){let i;const p=r&&r[n];if(Se(e)||je(e)){i=new Array(e.length);for(let O=0,I=e.length;O<I;O++)i[O]=t(e[O],O,void 0,p&&p[O])}else if(typeof e=="number"){i=new Array(e);for(let O=0;O<e;O++)i[O]=t(O+1,O,void 0,p&&p[O])}else if(Ue(e))if(e[Symbol.iterator])i=Array.from(e,(O,I)=>t(O,I,void 0,p&&p[I]));else{const O=Object.keys(e);i=new Array(O.length);for(let I=0,s=O.length;I<s;I++){const R=O[I];i[I]=t(e[R],R,I,p&&p[I])}}else i=[];return r&&(r[n]=i),i}const gs=e=>e?rl(e)?na(e)||e.proxy:gs(e.parent):null,on=tt(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>gs(e.parent),$root:e=>gs(e.root),$emit:e=>e.emit,$options:e=>Zs(e),$forceUpdate:e=>e.f||(e.f=()=>Js(e.update)),$nextTick:e=>e.n||(e.n=Ru.bind(e.proxy)),$watch:e=>Jf.bind(e)}),Vi=(e,t)=>e!==we&&!e.__isScriptSetup&&De(e,t),dd={get({_:e},t){const{ctx:r,setupState:n,data:i,props:p,accessCache:O,type:I,appContext:s}=e;let R;if(t[0]!=="$"){const K=O[t];if(K!==void 0)switch(K){case 1:return n[t];case 2:return i[t];case 4:return r[t];case 3:return p[t]}else{if(Vi(n,t))return O[t]=1,n[t];if(i!==we&&De(i,t))return O[t]=2,i[t];if((R=e.propsOptions[0])&&De(R,t))return O[t]=3,p[t];if(r!==we&&De(r,t))return O[t]=4,r[t];ms&&(O[t]=0)}}const A=on[t];let w,D;if(A)return t==="$attrs"&&ft(e,"get",t),A(e);if((w=I.__cssModules)&&(w=w[t]))return w;if(r!==we&&De(r,t))return O[t]=4,r[t];if(D=s.config.globalProperties,De(D,t))return D[t]},set({_:e},t,r){const{data:n,setupState:i,ctx:p}=e;return Vi(i,t)?(i[t]=r,!0):n!==we&&De(n,t)?(n[t]=r,!0):De(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(p[t]=r,!0)},has({_:{data:e,setupState:t,accessCache:r,ctx:n,appContext:i,propsOptions:p}},O){let I;return!!r[O]||e!==we&&De(e,O)||Vi(t,O)||(I=p[0])&&De(I,O)||De(n,O)||De(on,O)||De(i.config.globalProperties,O)},defineProperty(e,t,r){return r.get!=null?e._.accessCache[t]=0:De(r,"value")&&this.set(e,t,r.value,null),Reflect.defineProperty(e,t,r)}};let ms=!0;function hd(e){const t=Zs(e),r=e.proxy,n=e.ctx;ms=!1,t.beforeCreate&&Ga(t.beforeCreate,e,"bc");const{data:i,computed:p,methods:O,watch:I,provide:s,inject:R,created:A,beforeMount:w,mounted:D,beforeUpdate:K,updated:k,activated:F,deactivated:B,beforeDestroy:P,beforeUnmount:N,destroyed:g,unmounted:M,render:S,renderTracked:f,renderTriggered:E,errorCaptured:d,serverPrefetch:l,expose:b,inheritAttrs:h,components:u,directives:m,filters:y}=t;if(R&&gd(R,n,null,e.appContext.config.unwrapInjectedRef),O)for(const a in O){const T=O[a];Ie(T)&&(n[a]=T.bind(r))}if(i){const a=i.call(r,r);Ue(a)&&(e.data=yr(a))}if(ms=!0,p)for(const a in p){const T=p[a],o=Ie(T)?T.bind(r,r):Ie(T.get)?T.get.bind(r,r):Ct,_=!Ie(T)&&Ie(T.set)?T.set.bind(r):Ct,L=vt({get:o,set:_});Object.defineProperty(n,a,{enumerable:!0,configurable:!0,get:()=>L.value,set:x=>L.value=x})}if(I)for(const a in I)Vu(I[a],n,r,a);if(s){const a=Ie(s)?s.call(r):s;Reflect.ownKeys(a).forEach(T=>{Qn(T,a[T])})}A&&Ga(A,e,"c");function c(a,T){Se(T)?T.forEach(o=>a(o.bind(r))):T&&a(T.bind(r))}if(c(rd,w),c(Hu,D),c(nd,K),c(Ku,k),c(Zf,F),c(ed,B),c(ud,d),c(od,f),c(ad,E),c(id,N),c(Wu,M),c(sd,l),Se(b))if(b.length){const a=e.exposed||(e.exposed={});b.forEach(T=>{Object.defineProperty(a,T,{get:()=>r[T],set:o=>r[T]=o})})}else e.exposed||(e.exposed={});S&&e.render===Ct&&(e.render=S),h!=null&&(e.inheritAttrs=h),u&&(e.components=u),m&&(e.directives=m)}function gd(e,t,r=Ct,n=!1){Se(e)&&(e=Es(e));for(const i in e){const p=e[i];let O;Ue(p)?"default"in p?O=Vt(p.from||i,p.default,!0):O=Vt(p.from||i):O=Vt(p),Xe(O)&&n?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>O.value,set:I=>O.value=I}):t[i]=O}}function Ga(e,t,r){Lt(Se(e)?e.map(n=>n.bind(t.proxy)):e.bind(t.proxy),t,r)}function Vu(e,t,r,n){const i=n.includes(".")?Bu(r,n):()=>r[n];if(je(e)){const p=t[e];Ie(p)&&$n(i,p)}else if(Ie(e))$n(i,e.bind(r));else if(Ue(e))if(Se(e))e.forEach(p=>Vu(p,t,r,n));else{const p=Ie(e.handler)?e.handler.bind(r):t[e.handler];Ie(p)&&$n(i,p,e)}}function Zs(e){const t=e.type,{mixins:r,extends:n}=t,{mixins:i,optionsCache:p,config:{optionMergeStrategies:O}}=e.appContext,I=p.get(t);let s;return I?s=I:!i.length&&!r&&!n?s=t:(s={},i.length&&i.forEach(R=>ni(s,R,O,!0)),ni(s,t,O)),Ue(t)&&p.set(t,s),s}function ni(e,t,r,n=!1){const{mixins:i,extends:p}=t;p&&ni(e,p,r,!0),i&&i.forEach(O=>ni(e,O,r,!0));for(const O in t)if(!(n&&O==="expose")){const I=md[O]||r&&r[O];e[O]=I?I(e[O],t[O]):t[O]}return e}const md={data:Ya,props:cr,emits:cr,methods:cr,computed:cr,beforeCreate:et,created:et,beforeMount:et,mounted:et,beforeUpdate:et,updated:et,beforeDestroy:et,beforeUnmount:et,destroyed:et,unmounted:et,activated:et,deactivated:et,errorCaptured:et,serverPrefetch:et,components:cr,directives:cr,watch:vd,provide:Ya,inject:Ed};function Ya(e,t){return t?e?function(){return tt(Ie(e)?e.call(this,this):e,Ie(t)?t.call(this,this):t)}:t:e}function Ed(e,t){return cr(Es(e),Es(t))}function Es(e){if(Se(e)){const t={};for(let r=0;r<e.length;r++)t[e[r]]=e[r];return t}return e}function et(e,t){return e?[...new Set([].concat(e,t))]:t}function cr(e,t){return e?tt(tt(Object.create(null),e),t):t}function vd(e,t){if(!e)return t;if(!t)return e;const r=tt(Object.create(null),e);for(const n in t)r[n]=et(e[n],t[n]);return r}function pd(e,t,r,n=!1){const i={},p={};ei(p,Si,1),e.propsDefaults=Object.create(null),ju(e,t,i,p);for(const O in e.propsOptions[0])O in i||(i[O]=void 0);r?e.props=n?i:Nf(i):e.type.props?e.props=i:e.props=p,e.attrs=p}function Td(e,t,r,n){const{props:i,attrs:p,vnode:{patchFlag:O}}=e,I=Pe(i),[s]=e.propsOptions;let R=!1;if((n||O>0)&&!(O&16)){if(O&8){const A=e.vnode.dynamicProps;for(let w=0;w<A.length;w++){let D=A[w];if(Ai(e.emitsOptions,D))continue;const K=t[D];if(s)if(De(p,D))K!==p[D]&&(p[D]=K,R=!0);else{const k=Ht(D);i[k]=vs(s,I,k,K,e,!1)}else K!==p[D]&&(p[D]=K,R=!0)}}}else{ju(e,t,i,p)&&(R=!0);let A;for(const w in I)(!t||!De(t,w)&&((A=Xr(w))===w||!De(t,A)))&&(s?r&&(r[w]!==void 0||r[A]!==void 0)&&(i[w]=vs(s,I,w,void 0,e,!0)):delete i[w]);if(p!==I)for(const w in p)(!t||!De(t,w))&&(delete p[w],R=!0)}R&&Xt(e,"set","$attrs")}function ju(e,t,r,n){const[i,p]=e.propsOptions;let O=!1,I;if(t)for(let s in t){if(Xn(s))continue;const R=t[s];let A;i&&De(i,A=Ht(s))?!p||!p.includes(A)?r[A]=R:(I||(I={}))[A]=R:Ai(e.emitsOptions,s)||(!(s in n)||R!==n[s])&&(n[s]=R,O=!0)}if(p){const s=Pe(r),R=I||we;for(let A=0;A<p.length;A++){const w=p[A];r[w]=vs(i,s,w,R[w],e,!De(R,w))}}return O}function vs(e,t,r,n,i,p){const O=e[r];if(O!=null){const I=De(O,"default");if(I&&n===void 0){const s=O.default;if(O.type!==Function&&Ie(s)){const{propsDefaults:R}=i;r in R?n=R[r]:(Wr(i),n=R[r]=s.call(null,t),vr())}else n=s}O[0]&&(p&&!I?n=!1:O[1]&&(n===""||n===Xr(r))&&(n=!0))}return n}function Xu(e,t,r=!1){const n=t.propsCache,i=n.get(e);if(i)return i;const p=e.props,O={},I=[];let s=!1;if(!Ie(e)){const A=w=>{s=!0;const[D,K]=Xu(w,t,!0);tt(O,D),K&&I.push(...K)};!r&&t.mixins.length&&t.mixins.forEach(A),e.extends&&A(e.extends),e.mixins&&e.mixins.forEach(A)}if(!p&&!s)return Ue(e)&&n.set(e,Mr),Mr;if(Se(p))for(let A=0;A<p.length;A++){const w=Ht(p[A]);Va(w)&&(O[w]=we)}else if(p)for(const A in p){const w=Ht(A);if(Va(w)){const D=p[A],K=O[w]=Se(D)||Ie(D)?{type:D}:Object.assign({},D);if(K){const k=Qa(Boolean,K.type),F=Qa(String,K.type);K[0]=k>-1,K[1]=F<0||k<F,(k>-1||De(K,"default"))&&I.push(w)}}}const R=[O,I];return Ue(e)&&n.set(e,R),R}function Va(e){return e[0]!=="$"}function ja(e){const t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:e===null?"null":""}function Xa(e,t){return ja(e)===ja(t)}function Qa(e,t){return Se(t)?t.findIndex(r=>Xa(r,e)):Ie(t)&&Xa(t,e)?0:-1}const Qu=e=>e[0]==="_"||e==="$stable",ea=e=>Se(e)?e.map(Nt):[Nt(e)],_d=(e,t,r)=>{if(t._n)return t;const n=Vf((...i)=>ea(t(...i)),r);return n._c=!1,n},$u=(e,t,r)=>{const n=e._ctx;for(const i in e){if(Qu(i))continue;const p=e[i];if(Ie(p))t[i]=_d(i,p,n);else if(p!=null){const O=ea(p);t[i]=()=>O}}},zu=(e,t)=>{const r=ea(t);e.slots.default=()=>r},Ad=(e,t)=>{if(e.vnode.shapeFlag&32){const r=t._;r?(e.slots=Pe(t),ei(t,"_",r)):$u(t,e.slots={})}else e.slots={},t&&zu(e,t);ei(e.slots,Si,1)},yd=(e,t,r)=>{const{vnode:n,slots:i}=e;let p=!0,O=we;if(n.shapeFlag&32){const I=t._;I?r&&I===1?p=!1:(tt(i,t),!r&&I===1&&delete i._):(p=!t.$stable,$u(t,i)),O=t}else t&&(zu(e,t),O={default:1});if(p)for(const I in i)!Qu(I)&&!(I in O)&&delete i[I]};function qu(){return{app:null,config:{isNativeTag:Jc,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let bd=0;function Sd(e,t){return function(n,i=null){Ie(n)||(n=Object.assign({},n)),i!=null&&!Ue(i)&&(i=null);const p=qu(),O=new Set;let I=!1;const s=p.app={_uid:bd++,_component:n,_props:i,_container:null,_context:p,_instance:null,version:Yd,get config(){return p.config},set config(R){},use(R,...A){return O.has(R)||(R&&Ie(R.install)?(O.add(R),R.install(s,...A)):Ie(R)&&(O.add(R),R(s,...A))),s},mixin(R){return p.mixins.includes(R)||p.mixins.push(R),s},component(R,A){return A?(p.components[R]=A,s):p.components[R]},directive(R,A){return A?(p.directives[R]=A,s):p.directives[R]},mount(R,A,w){if(!I){const D=lt(n,i);return D.appContext=p,A&&t?t(D,R):e(D,R,w),I=!0,s._container=R,R.__vue_app__=s,na(D.component)||D.component.proxy}},unmount(){I&&(e(null,s._container),delete s._container.__vue_app__)},provide(R,A){return p.provides[R]=A,s}};return s}}function ps(e,t,r,n,i=!1){if(Se(e)){e.forEach((D,K)=>ps(D,t&&(Se(t)?t[K]:t),r,n,i));return}if(zn(n)&&!i)return;const p=n.shapeFlag&4?na(n.component)||n.component.proxy:n.el,O=i?null:p,{i:I,r:s}=e,R=t&&t.r,A=I.refs===we?I.refs={}:I.refs,w=I.setupState;if(R!=null&&R!==s&&(je(R)?(A[R]=null,De(w,R)&&(w[R]=null)):Xe(R)&&(R.value=null)),Ie(s))rr(s,I,12,[O,A]);else{const D=je(s),K=Xe(s);if(D||K){const k=()=>{if(e.f){const F=D?De(w,s)?w[s]:A[s]:s.value;i?Se(F)&&Ks(F,p):Se(F)?F.includes(p)||F.push(p):D?(A[s]=[p],De(w,s)&&(w[s]=A[s])):(s.value=[p],e.k&&(A[e.k]=s.value))}else D?(A[s]=O,De(w,s)&&(w[s]=O)):K&&(s.value=O,e.k&&(A[e.k]=O))};O?(k.id=-1,st(k,r)):k()}}}const st=qf;function xd(e){return Id(e)}function Id(e,t){const r=sf();r.__VUE__=!0;const{insert:n,remove:i,patchProp:p,createElement:O,createText:I,createComment:s,setText:R,setElementText:A,parentNode:w,nextSibling:D,setScopeId:K=Ct,insertStaticContent:k}=e,F=(V,Q,ee,Z=null,re=null,ae=null,le=!1,ne=null,ie=!!Q.dynamicChildren)=>{if(V===Q)return;V&&!Zr(V,Q)&&(Z=Y(V),x(V,re,ae,!0),V=null),Q.patchFlag===-2&&(ie=!1,Q.dynamicChildren=null);const{type:oe,ref:ge,shapeFlag:he}=Q;switch(oe){case bi:B(V,Q,ee,Z);break;case Tr:P(V,Q,ee,Z);break;case ji:V==null&&N(Q,ee,Z,le);break;case yt:u(V,Q,ee,Z,re,ae,le,ne,ie);break;default:he&1?S(V,Q,ee,Z,re,ae,le,ne,ie):he&6?m(V,Q,ee,Z,re,ae,le,ne,ie):(he&64||he&128)&&oe.process(V,Q,ee,Z,re,ae,le,ne,ie,X)}ge!=null&&re&&ps(ge,V&&V.ref,ae,Q||V,!Q)},B=(V,Q,ee,Z)=>{if(V==null)n(Q.el=I(Q.children),ee,Z);else{const re=Q.el=V.el;Q.children!==V.children&&R(re,Q.children)}},P=(V,Q,ee,Z)=>{V==null?n(Q.el=s(Q.children||""),ee,Z):Q.el=V.el},N=(V,Q,ee,Z)=>{[V.el,V.anchor]=k(V.children,Q,ee,Z,V.el,V.anchor)},g=({el:V,anchor:Q},ee,Z)=>{let re;for(;V&&V!==Q;)re=D(V),n(V,ee,Z),V=re;n(Q,ee,Z)},M=({el:V,anchor:Q})=>{let ee;for(;V&&V!==Q;)ee=D(V),i(V),V=ee;i(Q)},S=(V,Q,ee,Z,re,ae,le,ne,ie)=>{le=le||Q.type==="svg",V==null?f(Q,ee,Z,re,ae,le,ne,ie):l(V,Q,re,ae,le,ne,ie)},f=(V,Q,ee,Z,re,ae,le,ne)=>{let ie,oe;const{type:ge,props:he,shapeFlag:me,transition:Ee,dirs:pe}=V;if(ie=V.el=O(V.type,ae,he&&he.is,he),me&8?A(ie,V.children):me&16&&d(V.children,ie,null,Z,re,ae&&ge!=="foreignObject",le,ne),pe&&or(V,null,Z,"created"),he){for(const _e in he)_e!=="value"&&!Xn(_e)&&p(ie,_e,null,he[_e],ae,V.children,Z,re,G);"value"in he&&p(ie,"value",null,he.value),(oe=he.onVnodeBeforeMount)&&Ot(oe,Z,V)}E(ie,V,V.scopeId,le,Z),pe&&or(V,null,Z,"beforeMount");const Te=(!re||re&&!re.pendingBranch)&&Ee&&!Ee.persisted;Te&&Ee.beforeEnter(ie),n(ie,Q,ee),((oe=he&&he.onVnodeMounted)||Te||pe)&&st(()=>{oe&&Ot(oe,Z,V),Te&&Ee.enter(ie),pe&&or(V,null,Z,"mounted")},re)},E=(V,Q,ee,Z,re)=>{if(ee&&K(V,ee),Z)for(let ae=0;ae<Z.length;ae++)K(V,Z[ae]);if(re){let ae=re.subTree;if(Q===ae){const le=re.vnode;E(V,le,le.scopeId,le.slotScopeIds,re.parent)}}},d=(V,Q,ee,Z,re,ae,le,ne,ie=0)=>{for(let oe=ie;oe<V.length;oe++){const ge=V[oe]=ne?Zt(V[oe]):Nt(V[oe]);F(null,ge,Q,ee,Z,re,ae,le,ne)}},l=(V,Q,ee,Z,re,ae,le)=>{const ne=Q.el=V.el;let{patchFlag:ie,dynamicChildren:oe,dirs:ge}=Q;ie|=V.patchFlag&16;const he=V.props||we,me=Q.props||we;let Ee;ee&&ur(ee,!1),(Ee=me.onVnodeBeforeUpdate)&&Ot(Ee,ee,Q,V),ge&&or(Q,V,ee,"beforeUpdate"),ee&&ur(ee,!0);const pe=re&&Q.type!=="foreignObject";if(oe?b(V.dynamicChildren,oe,ne,ee,Z,pe,ae):le||T(V,Q,ne,null,ee,Z,pe,ae,!1),ie>0){if(ie&16)h(ne,Q,he,me,ee,Z,re);else if(ie&2&&he.class!==me.class&&p(ne,"class",null,me.class,re),ie&4&&p(ne,"style",he.style,me.style,re),ie&8){const Te=Q.dynamicProps;for(let _e=0;_e<Te.length;_e++){const ye=Te[_e],Le=he[ye],ke=me[ye];(ke!==Le||ye==="value")&&p(ne,ye,Le,ke,re,V.children,ee,Z,G)}}ie&1&&V.children!==Q.children&&A(ne,Q.children)}else!le&&oe==null&&h(ne,Q,he,me,ee,Z,re);((Ee=me.onVnodeUpdated)||ge)&&st(()=>{Ee&&Ot(Ee,ee,Q,V),ge&&or(Q,V,ee,"updated")},Z)},b=(V,Q,ee,Z,re,ae,le)=>{for(let ne=0;ne<Q.length;ne++){const ie=V[ne],oe=Q[ne],ge=ie.el&&(ie.type===yt||!Zr(ie,oe)||ie.shapeFlag&70)?w(ie.el):ee;F(ie,oe,ge,null,Z,re,ae,le,!0)}},h=(V,Q,ee,Z,re,ae,le)=>{if(ee!==Z){if(ee!==we)for(const ne in ee)!Xn(ne)&&!(ne in Z)&&p(V,ne,ee[ne],null,le,Q.children,re,ae,G);for(const ne in Z){if(Xn(ne))continue;const ie=Z[ne],oe=ee[ne];ie!==oe&&ne!=="value"&&p(V,ne,oe,ie,le,Q.children,re,ae,G)}"value"in Z&&p(V,"value",ee.value,Z.value)}},u=(V,Q,ee,Z,re,ae,le,ne,ie)=>{const oe=Q.el=V?V.el:I(""),ge=Q.anchor=V?V.anchor:I("");let{patchFlag:he,dynamicChildren:me,slotScopeIds:Ee}=Q;Ee&&(ne=ne?ne.concat(Ee):Ee),V==null?(n(oe,ee,Z),n(ge,ee,Z),d(Q.children,ee,ge,re,ae,le,ne,ie)):he>0&&he&64&&me&&V.dynamicChildren?(b(V.dynamicChildren,me,ee,re,ae,le,ne),(Q.key!=null||re&&Q===re.subTree)&&Ju(V,Q,!0)):T(V,Q,ee,ge,re,ae,le,ne,ie)},m=(V,Q,ee,Z,re,ae,le,ne,ie)=>{Q.slotScopeIds=ne,V==null?Q.shapeFlag&512?re.ctx.activate(Q,ee,Z,le,ie):y(Q,ee,Z,re,ae,le,ie):v(V,Q,ie)},y=(V,Q,ee,Z,re,ae,le)=>{const ne=V.component=Fd(V,Z,re);if(wu(V)&&(ne.ctx.renderer=X),kd(ne),ne.asyncDep){if(re&&re.registerDep(ne,c),!V.el){const ie=ne.subTree=lt(Tr);P(null,ie,Q,ee)}return}c(ne,V,Q,ee,re,ae,le)},v=(V,Q,ee)=>{const Z=Q.component=V.component;if(Qf(V,Q,ee))if(Z.asyncDep&&!Z.asyncResolved){a(Z,Q,ee);return}else Z.next=Q,Kf(Z.update),Z.update();else Q.el=V.el,Z.vnode=Q},c=(V,Q,ee,Z,re,ae,le)=>{const ne=()=>{if(V.isMounted){let{next:ge,bu:he,u:me,parent:Ee,vnode:pe}=V,Te=ge,_e;ur(V,!1),ge?(ge.el=pe.el,a(V,ge,le)):ge=pe,he&&Gi(he),(_e=ge.props&&ge.props.onVnodeBeforeUpdate)&&Ot(_e,Ee,ge,pe),ur(V,!0);const ye=Yi(V),Le=V.subTree;V.subTree=ye,F(Le,ye,w(Le.el),Y(Le),V,re,ae),ge.el=ye.el,Te===null&&$f(V,ye.el),me&&st(me,re),(_e=ge.props&&ge.props.onVnodeUpdated)&&st(()=>Ot(_e,Ee,ge,pe),re)}else{let ge;const{el:he,props:me}=Q,{bm:Ee,m:pe,parent:Te}=V,_e=zn(Q);if(ur(V,!1),Ee&&Gi(Ee),!_e&&(ge=me&&me.onVnodeBeforeMount)&&Ot(ge,Te,Q),ur(V,!0),he&&J){const ye=()=>{V.subTree=Yi(V),J(he,V.subTree,V,re,null)};_e?Q.type.__asyncLoader().then(()=>!V.isUnmounted&&ye()):ye()}else{const ye=V.subTree=Yi(V);F(null,ye,ee,Z,V,re,ae),Q.el=ye.el}if(pe&&st(pe,re),!_e&&(ge=me&&me.onVnodeMounted)){const ye=Q;st(()=>Ot(ge,Te,ye),re)}(Q.shapeFlag&256||Te&&zn(Te.vnode)&&Te.vnode.shapeFlag&256)&&V.a&&st(V.a,re),V.isMounted=!0,Q=ee=Z=null}},ie=V.effect=new Vs(ne,()=>Js(oe),V.scope),oe=V.update=()=>ie.run();oe.id=V.uid,ur(V,!0),oe()},a=(V,Q,ee)=>{Q.component=V;const Z=V.vnode.props;V.vnode=Q,V.next=null,Td(V,Q.props,Z,ee),yd(V,Q.children,ee),Qr(),Ha(),$r()},T=(V,Q,ee,Z,re,ae,le,ne,ie=!1)=>{const oe=V&&V.children,ge=V?V.shapeFlag:0,he=Q.children,{patchFlag:me,shapeFlag:Ee}=Q;if(me>0){if(me&128){_(oe,he,ee,Z,re,ae,le,ne,ie);return}else if(me&256){o(oe,he,ee,Z,re,ae,le,ne,ie);return}}Ee&8?(ge&16&&G(oe,re,ae),he!==oe&&A(ee,he)):ge&16?Ee&16?_(oe,he,ee,Z,re,ae,le,ne,ie):G(oe,re,ae,!0):(ge&8&&A(ee,""),Ee&16&&d(he,ee,Z,re,ae,le,ne,ie))},o=(V,Q,ee,Z,re,ae,le,ne,ie)=>{V=V||Mr,Q=Q||Mr;const oe=V.length,ge=Q.length,he=Math.min(oe,ge);let me;for(me=0;me<he;me++){const Ee=Q[me]=ie?Zt(Q[me]):Nt(Q[me]);F(V[me],Ee,ee,null,re,ae,le,ne,ie)}oe>ge?G(V,re,ae,!0,!1,he):d(Q,ee,Z,re,ae,le,ne,ie,he)},_=(V,Q,ee,Z,re,ae,le,ne,ie)=>{let oe=0;const ge=Q.length;let he=V.length-1,me=ge-1;for(;oe<=he&&oe<=me;){const Ee=V[oe],pe=Q[oe]=ie?Zt(Q[oe]):Nt(Q[oe]);if(Zr(Ee,pe))F(Ee,pe,ee,null,re,ae,le,ne,ie);else break;oe++}for(;oe<=he&&oe<=me;){const Ee=V[he],pe=Q[me]=ie?Zt(Q[me]):Nt(Q[me]);if(Zr(Ee,pe))F(Ee,pe,ee,null,re,ae,le,ne,ie);else break;he--,me--}if(oe>he){if(oe<=me){const Ee=me+1,pe=Ee<ge?Q[Ee].el:Z;for(;oe<=me;)F(null,Q[oe]=ie?Zt(Q[oe]):Nt(Q[oe]),ee,pe,re,ae,le,ne,ie),oe++}}else if(oe>me)for(;oe<=he;)x(V[oe],re,ae,!0),oe++;else{const Ee=oe,pe=oe,Te=new Map;for(oe=pe;oe<=me;oe++){const Ne=Q[oe]=ie?Zt(Q[oe]):Nt(Q[oe]);Ne.key!=null&&Te.set(Ne.key,oe)}let _e,ye=0;const Le=me-pe+1;let ke=!1,He=0;const Ke=new Array(Le);for(oe=0;oe<Le;oe++)Ke[oe]=0;for(oe=Ee;oe<=he;oe++){const Ne=V[oe];if(ye>=Le){x(Ne,re,ae,!0);continue}let Ge;if(Ne.key!=null)Ge=Te.get(Ne.key);else for(_e=pe;_e<=me;_e++)if(Ke[_e-pe]===0&&Zr(Ne,Q[_e])){Ge=_e;break}Ge===void 0?x(Ne,re,ae,!0):(Ke[Ge-pe]=oe+1,Ge>=He?He=Ge:ke=!0,F(Ne,Q[Ge],ee,null,re,ae,le,ne,ie),ye++)}const ct=ke?Cd(Ke):Mr;for(_e=ct.length-1,oe=Le-1;oe>=0;oe--){const Ne=pe+oe,Ge=Q[Ne],rt=Ne+1<ge?Q[Ne+1].el:Z;Ke[oe]===0?F(null,Ge,ee,rt,re,ae,le,ne,ie):ke&&(_e<0||oe!==ct[_e]?L(Ge,ee,rt,2):_e--)}}},L=(V,Q,ee,Z,re=null)=>{const{el:ae,type:le,transition:ne,children:ie,shapeFlag:oe}=V;if(oe&6){L(V.component.subTree,Q,ee,Z);return}if(oe&128){V.suspense.move(Q,ee,Z);return}if(oe&64){le.move(V,Q,ee,X);return}if(le===yt){n(ae,Q,ee);for(let he=0;he<ie.length;he++)L(ie[he],Q,ee,Z);n(V.anchor,Q,ee);return}if(le===ji){g(V,Q,ee);return}if(Z!==2&&oe&1&&ne)if(Z===0)ne.beforeEnter(ae),n(ae,Q,ee),st(()=>ne.enter(ae),re);else{const{leave:he,delayLeave:me,afterLeave:Ee}=ne,pe=()=>n(ae,Q,ee),Te=()=>{he(ae,()=>{pe(),Ee&&Ee()})};me?me(ae,pe,Te):Te()}else n(ae,Q,ee)},x=(V,Q,ee,Z=!1,re=!1)=>{const{type:ae,props:le,ref:ne,children:ie,dynamicChildren:oe,shapeFlag:ge,patchFlag:he,dirs:me}=V;if(ne!=null&&ps(ne,null,ee,V,!0),ge&256){Q.ctx.deactivate(V);return}const Ee=ge&1&&me,pe=!zn(V);let Te;if(pe&&(Te=le&&le.onVnodeBeforeUnmount)&&Ot(Te,Q,V),ge&6)U(V.component,ee,Z);else{if(ge&128){V.suspense.unmount(ee,Z);return}Ee&&or(V,null,Q,"beforeUnmount"),ge&64?V.type.remove(V,Q,ee,re,X,Z):oe&&(ae!==yt||he>0&&he&64)?G(oe,Q,ee,!1,!0):(ae===yt&&he&384||!re&&ge&16)&&G(ie,Q,ee),Z&&H(V)}(pe&&(Te=le&&le.onVnodeUnmounted)||Ee)&&st(()=>{Te&&Ot(Te,Q,V),Ee&&or(V,null,Q,"unmounted")},ee)},H=V=>{const{type:Q,el:ee,anchor:Z,transition:re}=V;if(Q===yt){W(ee,Z);return}if(Q===ji){M(V);return}const ae=()=>{i(ee),re&&!re.persisted&&re.afterLeave&&re.afterLeave()};if(V.shapeFlag&1&&re&&!re.persisted){const{leave:le,delayLeave:ne}=re,ie=()=>le(ee,ae);ne?ne(V.el,ae,ie):ie()}else ae()},W=(V,Q)=>{let ee;for(;V!==Q;)ee=D(V),i(V),V=ee;i(Q)},U=(V,Q,ee)=>{const{bum:Z,scope:re,update:ae,subTree:le,um:ne}=V;Z&&Gi(Z),re.stop(),ae&&(ae.active=!1,x(le,V,Q,ee)),ne&&st(ne,Q),st(()=>{V.isUnmounted=!0},Q),Q&&Q.pendingBranch&&!Q.isUnmounted&&V.asyncDep&&!V.asyncResolved&&V.suspenseId===Q.pendingId&&(Q.deps--,Q.deps===0&&Q.resolve())},G=(V,Q,ee,Z=!1,re=!1,ae=0)=>{for(let le=ae;le<V.length;le++)x(V[le],Q,ee,Z,re)},Y=V=>V.shapeFlag&6?Y(V.component.subTree):V.shapeFlag&128?V.suspense.next():D(V.anchor||V.el),j=(V,Q,ee)=>{V==null?Q._vnode&&x(Q._vnode,null,null,!0):F(Q._vnode||null,V,Q,null,null,null,ee),Ha(),Pu(),Q._vnode=V},X={p:F,um:x,m:L,r:H,mt:y,mc:d,pc:T,pbc:b,n:Y,o:e};let q,J;return t&&([q,J]=t(X)),{render:j,hydrate:q,createApp:Sd(j,q)}}function ur({effect:e,update:t},r){e.allowRecurse=t.allowRecurse=r}function Ju(e,t,r=!1){const n=e.children,i=t.children;if(Se(n)&&Se(i))for(let p=0;p<n.length;p++){const O=n[p];let I=i[p];I.shapeFlag&1&&!I.dynamicChildren&&((I.patchFlag<=0||I.patchFlag===32)&&(I=i[p]=Zt(i[p]),I.el=O.el),r||Ju(O,I)),I.type===bi&&(I.el=O.el)}}function Cd(e){const t=e.slice(),r=[0];let n,i,p,O,I;const s=e.length;for(n=0;n<s;n++){const R=e[n];if(R!==0){if(i=r[r.length-1],e[i]<R){t[n]=i,r.push(n);continue}for(p=0,O=r.length-1;p<O;)I=p+O>>1,e[r[I]]<R?p=I+1:O=I;R<e[r[p]]&&(p>0&&(t[n]=r[p-1]),r[p]=n)}}for(p=r.length,O=r[p-1];p-- >0;)r[p]=O,O=t[O];return r}const Ld=e=>e.__isTeleport,yt=Symbol(void 0),bi=Symbol(void 0),Tr=Symbol(void 0),ji=Symbol(void 0),un=[];let It=null;function pt(e=!1){un.push(It=e?null:[])}function Dd(){un.pop(),It=un[un.length-1]||null}let yn=1;function $a(e){yn+=e}function Zu(e){return e.dynamicChildren=yn>0?It||Mr:null,Dd(),yn>0&&It&&It.push(e),e}function Bt(e,t,r,n,i,p){return Zu(Oe(e,t,r,n,i,p,!0))}function el(e,t,r,n,i){return Zu(lt(e,t,r,n,i,!0))}function Ts(e){return e?e.__v_isVNode===!0:!1}function Zr(e,t){return e.type===t.type&&e.key===t.key}const Si="__vInternal",tl=({key:e})=>e??null,qn=({ref:e,ref_key:t,ref_for:r})=>e!=null?je(e)||Xe(e)||Ie(e)?{i:xt,r:e,k:t,f:!!r}:e:null;function Oe(e,t=null,r=null,n=0,i=null,p=e===yt?0:1,O=!1,I=!1){const s={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&tl(t),ref:t&&qn(t),scopeId:Fu,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:p,patchFlag:n,dynamicProps:i,dynamicChildren:null,appContext:null,ctx:xt};return I?(ra(s,r),p&128&&e.normalize(s)):r&&(s.shapeFlag|=je(r)?8:16),yn>0&&!O&&It&&(s.patchFlag>0||p&6)&&s.patchFlag!==32&&It.push(s),s}const lt=Rd;function Rd(e,t=null,r=null,n=0,i=null,p=!1){if((!e||e===cd)&&(e=Tr),Ts(e)){const I=Kr(e,t,!0);return r&&ra(I,r),yn>0&&!p&&It&&(I.shapeFlag&6?It[It.indexOf(e)]=I:It.push(I)),I.patchFlag|=-2,I}if(Kd(e)&&(e=e.__vccOpts),t){t=Od(t);let{class:I,style:s}=t;I&&!je(I)&&(t.class=Us(I)),Ue(s)&&(yu(s)&&!Se(s)&&(s=tt({},s)),t.style=ws(s))}const O=je(e)?1:zf(e)?128:Ld(e)?64:Ue(e)?4:Ie(e)?2:0;return Oe(e,t,r,n,i,O,p,!0)}function Od(e){return e?yu(e)||Si in e?tt({},e):e:null}function Kr(e,t,r=!1){const{props:n,ref:i,patchFlag:p,children:O}=e,I=t?Pd(n||{},t):n;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:I,key:I&&tl(I),ref:t&&t.ref?r&&i?Se(i)?i.concat(qn(t)):[i,qn(t)]:qn(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:O,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==yt?p===-1?16:p|16:p,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Kr(e.ssContent),ssFallback:e.ssFallback&&Kr(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx}}function _s(e=" ",t=0){return lt(bi,null,e,t)}function ta(e="",t=!1){return t?(pt(),el(Tr,null,e)):lt(Tr,null,e)}function Nt(e){return e==null||typeof e=="boolean"?lt(Tr):Se(e)?lt(yt,null,e.slice()):typeof e=="object"?Zt(e):lt(bi,null,String(e))}function Zt(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Kr(e)}function ra(e,t){let r=0;const{shapeFlag:n}=e;if(t==null)t=null;else if(Se(t))r=16;else if(typeof t=="object")if(n&65){const i=t.default;i&&(i._c&&(i._d=!1),ra(e,i()),i._c&&(i._d=!0));return}else{r=32;const i=t._;!i&&!(Si in t)?t._ctx=xt:i===3&&xt&&(xt.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else Ie(t)?(t={default:t,_ctx:xt},r=32):(t=String(t),n&64?(r=16,t=[_s(t)]):r=8);e.children=t,e.shapeFlag|=r}function Pd(...e){const t={};for(let r=0;r<e.length;r++){const n=e[r];for(const i in n)if(i==="class")t.class!==n.class&&(t.class=Us([t.class,n.class]));else if(i==="style")t.style=ws([t.style,n.style]);else if(mi(i)){const p=t[i],O=n[i];O&&p!==O&&!(Se(p)&&p.includes(O))&&(t[i]=p?[].concat(p,O):O)}else i!==""&&(t[i]=n[i])}return t}function Ot(e,t,r,n=null){Lt(e,t,7,[r,n])}const Nd=qu();let Md=0;function Fd(e,t,r){const n=e.type,i=(t?t.appContext:e.appContext)||Nd,p={uid:Md++,vnode:e,type:n,parent:t,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new af(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Xu(n,i),emitsOptions:Mu(n,i),emit:null,emitted:null,propsDefaults:we,inheritAttrs:n.inheritAttrs,ctx:we,data:we,props:we,attrs:we,slots:we,refs:we,setupState:we,setupContext:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return p.ctx={_:p},p.root=t?t.root:p,p.emit=Yf.bind(null,p),e.ce&&e.ce(p),p}let ze=null;const Wr=e=>{ze=e,e.scope.on()},vr=()=>{ze&&ze.scope.off(),ze=null};function rl(e){return e.vnode.shapeFlag&4}let bn=!1;function kd(e,t=!1){bn=t;const{props:r,children:n}=e.vnode,i=rl(e);pd(e,r,i,t),Ad(e,n);const p=i?Bd(e,t):void 0;return bn=!1,p}function Bd(e,t){const r=e.type;e.accessCache=Object.create(null),e.proxy=bu(new Proxy(e.ctx,dd));const{setup:n}=r;if(n){const i=e.setupContext=n.length>1?Ud(e):null;Wr(e),Qr();const p=rr(n,e,0,[e.props,i]);if($r(),vr(),ou(p)){if(p.then(vr,vr),t)return p.then(O=>{za(e,O,t)}).catch(O=>{_i(O,e,0)});e.asyncDep=p}else za(e,p,t)}else nl(e,t)}function za(e,t,r){Ie(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:Ue(t)&&(e.setupState=Cu(t)),nl(e,r)}let qa;function nl(e,t,r){const n=e.type;if(!e.render){if(!t&&qa&&!n.render){const i=n.template||Zs(e).template;if(i){const{isCustomElement:p,compilerOptions:O}=e.appContext.config,{delimiters:I,compilerOptions:s}=n,R=tt(tt({isCustomElement:p,delimiters:I},O),s);n.render=qa(i,R)}}e.render=n.render||Ct}Wr(e),Qr(),hd(e),$r(),vr()}function wd(e){return new Proxy(e.attrs,{get(t,r){return ft(e,"get","$attrs"),t[r]}})}function Ud(e){const t=n=>{e.exposed=n||{}};let r;return{get attrs(){return r||(r=wd(e))},slots:e.slots,emit:e.emit,expose:t}}function na(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Cu(bu(e.exposed)),{get(t,r){if(r in t)return t[r];if(r in on)return on[r](e)},has(t,r){return r in t||r in on}}))}function Hd(e,t=!0){return Ie(e)?e.displayName||e.name:e.name||t&&e.__name}function Kd(e){return Ie(e)&&"__vccOpts"in e}const vt=(e,t)=>wf(e,t,bn);function il(e,t,r){const n=arguments.length;return n===2?Ue(t)&&!Se(t)?Ts(t)?lt(e,null,[t]):lt(e,t):lt(e,null,t):(n>3?r=Array.prototype.slice.call(arguments,2):n===3&&Ts(r)&&(r=[r]),lt(e,t,r))}const Wd=Symbol(""),Gd=()=>Vt(Wd),Yd="3.2.45",Vd="http://www.w3.org/2000/svg",dr=typeof document<"u"?document:null,Ja=dr&&dr.createElement("template"),jd={insert:(e,t,r)=>{t.insertBefore(e,r||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,r,n)=>{const i=t?dr.createElementNS(Vd,e):dr.createElement(e,r?{is:r}:void 0);return e==="select"&&n&&n.multiple!=null&&i.setAttribute("multiple",n.multiple),i},createText:e=>dr.createTextNode(e),createComment:e=>dr.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>dr.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,r,n,i,p){const O=r?r.previousSibling:t.lastChild;if(i&&(i===p||i.nextSibling))for(;t.insertBefore(i.cloneNode(!0),r),!(i===p||!(i=i.nextSibling)););else{Ja.innerHTML=n?`<svg>${e}</svg>`:e;const I=Ja.content;if(n){const s=I.firstChild;for(;s.firstChild;)I.appendChild(s.firstChild);I.removeChild(s)}t.insertBefore(I,r)}return[O?O.nextSibling:t.firstChild,r?r.previousSibling:t.lastChild]}};function Xd(e,t,r){const n=e._vtc;n&&(t=(t?[t,...n]:[...n]).join(" ")),t==null?e.removeAttribute("class"):r?e.setAttribute("class",t):e.className=t}function Qd(e,t,r){const n=e.style,i=je(r);if(r&&!i){for(const p in r)As(n,p,r[p]);if(t&&!je(t))for(const p in t)r[p]==null&&As(n,p,"")}else{const p=n.display;i?t!==r&&(n.cssText=r):t&&e.removeAttribute("style"),"_vod"in e&&(n.display=p)}}const Za=/\s*!important$/;function As(e,t,r){if(Se(r))r.forEach(n=>As(e,t,n));else if(r==null&&(r=""),t.startsWith("--"))e.setProperty(t,r);else{const n=$d(e,t);Za.test(r)?e.setProperty(Xr(n),r.replace(Za,""),"important"):e[n]=r}}const eo=["Webkit","Moz","ms"],Xi={};function $d(e,t){const r=Xi[t];if(r)return r;let n=Ht(t);if(n!=="filter"&&n in e)return Xi[t]=n;n=pi(n);for(let i=0;i<eo.length;i++){const p=eo[i]+n;if(p in e)return Xi[t]=p}return t}const to="http://www.w3.org/1999/xlink";function zd(e,t,r,n,i){if(n&&t.startsWith("xlink:"))r==null?e.removeAttributeNS(to,t.slice(6,t.length)):e.setAttributeNS(to,t,r);else{const p=qc(t);r==null||p&&!iu(r)?e.removeAttribute(t):e.setAttribute(t,p?"":r)}}function qd(e,t,r,n,i,p,O){if(t==="innerHTML"||t==="textContent"){n&&O(n,i,p),e[t]=r??"";return}if(t==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=r;const s=r??"";(e.value!==s||e.tagName==="OPTION")&&(e.value=s),r==null&&e.removeAttribute(t);return}let I=!1;if(r===""||r==null){const s=typeof e[t];s==="boolean"?r=iu(r):r==null&&s==="string"?(r="",I=!0):s==="number"&&(r=0,I=!0)}try{e[t]=r}catch{}I&&e.removeAttribute(t)}function Jd(e,t,r,n){e.addEventListener(t,r,n)}function Zd(e,t,r,n){e.removeEventListener(t,r,n)}function eh(e,t,r,n,i=null){const p=e._vei||(e._vei={}),O=p[t];if(n&&O)O.value=n;else{const[I,s]=th(t);if(n){const R=p[t]=ih(n,i);Jd(e,I,R,s)}else O&&(Zd(e,I,O,s),p[t]=void 0)}}const ro=/(?:Once|Passive|Capture)$/;function th(e){let t;if(ro.test(e)){t={};let n;for(;n=e.match(ro);)e=e.slice(0,e.length-n[0].length),t[n[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Xr(e.slice(2)),t]}let Qi=0;const rh=Promise.resolve(),nh=()=>Qi||(rh.then(()=>Qi=0),Qi=Date.now());function ih(e,t){const r=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=r.attached)return;Lt(sh(n,r.value),t,5,[n])};return r.value=e,r.attached=nh(),r}function sh(e,t){if(Se(t)){const r=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{r.call(e),e._stopped=!0},t.map(n=>i=>!i._stopped&&n&&n(i))}else return t}const no=/^on[a-z]/,ah=(e,t,r,n,i=!1,p,O,I,s)=>{t==="class"?Xd(e,n,i):t==="style"?Qd(e,r,n):mi(t)?Hs(t)||eh(e,t,r,n,O):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):oh(e,t,n,i))?qd(e,t,n,p,O,I,s):(t==="true-value"?e._trueValue=n:t==="false-value"&&(e._falseValue=n),zd(e,t,n,i))};function oh(e,t,r,n){return n?!!(t==="innerHTML"||t==="textContent"||t in e&&no.test(t)&&Ie(r)):t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||no.test(t)&&je(r)?!1:t in e}const uh=tt({patchProp:ah},jd);let io;function lh(){return io||(io=xd(uh))}const ch=(...e)=>{const t=lh().createApp(...e),{mount:r}=t;return t.mount=n=>{const i=fh(n);if(!i)return;const p=t._component;!Ie(p)&&!p.render&&!p.template&&(p.template=i.innerHTML),i.innerHTML="";const O=r(i,!1,i instanceof SVGElement);return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),O},t};function fh(e){return je(e)?document.querySelector(e):e}var sl=(e=>(e.vf="vf",e.vostfr="vostfr",e))(sl||{});const Sn=yr({vf:[],vostfr:[]});yr({language:sl.vostfr});const dh={class:"bg-zinc-900 text-white min-h-screen px-10"},hh={key:0,class:"w-screen h-screen grid justify-items-center items-center"},gh=Oe("div",{class:"bg-red-900 bg-opacity-50 p-5 rounded"},[Oe("h1",null,[_s("L'extension "),Oe("span",{class:"text-red-500"},"Allow CORS"),_s(" est requise pour utiliser notre site web")])],-1),mh=[gh],Eh=br({__name:"App",setup(e){let t=pr(!1);return fetch("https://neko-sama.fr/animes-search-vf.json").then(r=>r.json()).then(r=>{Sn.vf=r,t.value=!0}),t&&fetch("https://neko-sama.fr/animes-search-vostfr.json").then(r=>r.json()).then(r=>{Sn.vostfr=r}),(r,n)=>{const i=ld("RouterView");return pt(),Bt("main",dh,[kt(t)==!1?(pt(),Bt("div",hh,mh)):(pt(),el(i,{key:1}))])}}});/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const Rr=typeof window<"u";function vh(e){return e.__esModule||e[Symbol.toStringTag]==="Module"}const Me=Object.assign;function $i(e,t){const r={};for(const n in t){const i=t[n];r[n]=Dt(i)?i.map(e):e(i)}return r}const ln=()=>{},Dt=Array.isArray,ph=/\/$/,Th=e=>e.replace(ph,"");function zi(e,t,r="/"){let n,i={},p="",O="";const I=t.indexOf("#");let s=t.indexOf("?");return I<s&&I>=0&&(s=-1),s>-1&&(n=t.slice(0,s),p=t.slice(s+1,I>-1?I:t.length),i=e(p)),I>-1&&(n=n||t.slice(0,I),O=t.slice(I,t.length)),n=bh(n??t,r),{fullPath:n+(p&&"?")+p+O,path:n,query:i,hash:O}}function _h(e,t){const r=t.query?e(t.query):"";return t.path+(r&&"?")+r+(t.hash||"")}function so(e,t){return!t||!e.toLowerCase().startsWith(t.toLowerCase())?e:e.slice(t.length)||"/"}function Ah(e,t,r){const n=t.matched.length-1,i=r.matched.length-1;return n>-1&&n===i&&Gr(t.matched[n],r.matched[i])&&al(t.params,r.params)&&e(t.query)===e(r.query)&&t.hash===r.hash}function Gr(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function al(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!yh(e[r],t[r]))return!1;return!0}function yh(e,t){return Dt(e)?ao(e,t):Dt(t)?ao(t,e):e===t}function ao(e,t){return Dt(t)?e.length===t.length&&e.every((r,n)=>r===t[n]):e.length===1&&e[0]===t}function bh(e,t){if(e.startsWith("/"))return e;if(!e)return t;const r=t.split("/"),n=e.split("/");let i=r.length-1,p,O;for(p=0;p<n.length;p++)if(O=n[p],O!==".")if(O==="..")i>1&&i--;else break;return r.slice(0,i).join("/")+"/"+n.slice(p-(p===n.length?1:0)).join("/")}var xn;(function(e){e.pop="pop",e.push="push"})(xn||(xn={}));var cn;(function(e){e.back="back",e.forward="forward",e.unknown=""})(cn||(cn={}));function Sh(e){if(!e)if(Rr){const t=document.querySelector("base");e=t&&t.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),Th(e)}const xh=/^[^#]+#/;function Ih(e,t){return e.replace(xh,"#")+t}function Ch(e,t){const r=document.documentElement.getBoundingClientRect(),n=e.getBoundingClientRect();return{behavior:t.behavior,left:n.left-r.left-(t.left||0),top:n.top-r.top-(t.top||0)}}const xi=()=>({left:window.pageXOffset,top:window.pageYOffset});function Lh(e){let t;if("el"in e){const r=e.el,n=typeof r=="string"&&r.startsWith("#"),i=typeof r=="string"?n?document.getElementById(r.slice(1)):document.querySelector(r):r;if(!i)return;t=Ch(i,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(t.left!=null?t.left:window.pageXOffset,t.top!=null?t.top:window.pageYOffset)}function oo(e,t){return(history.state?history.state.position-t:-1)+e}const ys=new Map;function Dh(e,t){ys.set(e,t)}function Rh(e){const t=ys.get(e);return ys.delete(e),t}let Oh=()=>location.protocol+"//"+location.host;function ol(e,t){const{pathname:r,search:n,hash:i}=t,p=e.indexOf("#");if(p>-1){let I=i.includes(e.slice(p))?e.slice(p).length:1,s=i.slice(I);return s[0]!=="/"&&(s="/"+s),so(s,"")}return so(r,e)+n+i}function Ph(e,t,r,n){let i=[],p=[],O=null;const I=({state:D})=>{const K=ol(e,location),k=r.value,F=t.value;let B=0;if(D){if(r.value=K,t.value=D,O&&O===k){O=null;return}B=F?D.position-F.position:0}else n(K);i.forEach(P=>{P(r.value,k,{delta:B,type:xn.pop,direction:B?B>0?cn.forward:cn.back:cn.unknown})})};function s(){O=r.value}function R(D){i.push(D);const K=()=>{const k=i.indexOf(D);k>-1&&i.splice(k,1)};return p.push(K),K}function A(){const{history:D}=window;D.state&&D.replaceState(Me({},D.state,{scroll:xi()}),"")}function w(){for(const D of p)D();p=[],window.removeEventListener("popstate",I),window.removeEventListener("beforeunload",A)}return window.addEventListener("popstate",I),window.addEventListener("beforeunload",A),{pauseListeners:s,listen:R,destroy:w}}function uo(e,t,r,n=!1,i=!1){return{back:e,current:t,forward:r,replaced:n,position:window.history.length,scroll:i?xi():null}}function Nh(e){const{history:t,location:r}=window,n={value:ol(e,r)},i={value:t.state};i.value||p(n.value,{back:null,current:n.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0);function p(s,R,A){const w=e.indexOf("#"),D=w>-1?(r.host&&document.querySelector("base")?e:e.slice(w))+s:Oh()+e+s;try{t[A?"replaceState":"pushState"](R,"",D),i.value=R}catch(K){console.error(K),r[A?"replace":"assign"](D)}}function O(s,R){const A=Me({},t.state,uo(i.value.back,s,i.value.forward,!0),R,{position:i.value.position});p(s,A,!0),n.value=s}function I(s,R){const A=Me({},i.value,t.state,{forward:s,scroll:xi()});p(A.current,A,!0);const w=Me({},uo(n.value,s,null),{position:A.position+1},R);p(s,w,!1),n.value=s}return{location:n,state:i,push:I,replace:O}}function Mh(e){e=Sh(e);const t=Nh(e),r=Ph(e,t.state,t.location,t.replace);function n(p,O=!0){O||r.pauseListeners(),history.go(p)}const i=Me({location:"",base:e,go:n,createHref:Ih.bind(null,e)},t,r);return Object.defineProperty(i,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(i,"state",{enumerable:!0,get:()=>t.state.value}),i}function Fh(e){return typeof e=="string"||e&&typeof e=="object"}function ul(e){return typeof e=="string"||typeof e=="symbol"}const zt={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},ll=Symbol("");var lo;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(lo||(lo={}));function Yr(e,t){return Me(new Error,{type:e,[ll]:!0},t)}function Kt(e,t){return e instanceof Error&&ll in e&&(t==null||!!(e.type&t))}const co="[^/]+?",kh={sensitive:!1,strict:!1,start:!0,end:!0},Bh=/[.+*?^${}()[\]/\\]/g;function wh(e,t){const r=Me({},kh,t),n=[];let i=r.start?"^":"";const p=[];for(const R of e){const A=R.length?[]:[90];r.strict&&!R.length&&(i+="/");for(let w=0;w<R.length;w++){const D=R[w];let K=40+(r.sensitive?.25:0);if(D.type===0)w||(i+="/"),i+=D.value.replace(Bh,"\\$&"),K+=40;else if(D.type===1){const{value:k,repeatable:F,optional:B,regexp:P}=D;p.push({name:k,repeatable:F,optional:B});const N=P||co;if(N!==co){K+=10;try{new RegExp(`(${N})`)}catch(M){throw new Error(`Invalid custom RegExp for param "${k}" (${N}): `+M.message)}}let g=F?`((?:${N})(?:/(?:${N}))*)`:`(${N})`;w||(g=B&&R.length<2?`(?:/${g})`:"/"+g),B&&(g+="?"),i+=g,K+=20,B&&(K+=-8),F&&(K+=-20),N===".*"&&(K+=-50)}A.push(K)}n.push(A)}if(r.strict&&r.end){const R=n.length-1;n[R][n[R].length-1]+=.7000000000000001}r.strict||(i+="/?"),r.end?i+="$":r.strict&&(i+="(?:/|$)");const O=new RegExp(i,r.sensitive?"":"i");function I(R){const A=R.match(O),w={};if(!A)return null;for(let D=1;D<A.length;D++){const K=A[D]||"",k=p[D-1];w[k.name]=K&&k.repeatable?K.split("/"):K}return w}function s(R){let A="",w=!1;for(const D of e){(!w||!A.endsWith("/"))&&(A+="/"),w=!1;for(const K of D)if(K.type===0)A+=K.value;else if(K.type===1){const{value:k,repeatable:F,optional:B}=K,P=k in R?R[k]:"";if(Dt(P)&&!F)throw new Error(`Provided param "${k}" is an array but it is not repeatable (* or + modifiers)`);const N=Dt(P)?P.join("/"):P;if(!N)if(B)D.length<2&&(A.endsWith("/")?A=A.slice(0,-1):w=!0);else throw new Error(`Missing required param "${k}"`);A+=N}}return A||"/"}return{re:O,score:n,keys:p,parse:I,stringify:s}}function Uh(e,t){let r=0;for(;r<e.length&&r<t.length;){const n=t[r]-e[r];if(n)return n;r++}return e.length<t.length?e.length===1&&e[0]===40+40?-1:1:e.length>t.length?t.length===1&&t[0]===40+40?1:-1:0}function Hh(e,t){let r=0;const n=e.score,i=t.score;for(;r<n.length&&r<i.length;){const p=Uh(n[r],i[r]);if(p)return p;r++}if(Math.abs(i.length-n.length)===1){if(fo(n))return 1;if(fo(i))return-1}return i.length-n.length}function fo(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const Kh={type:0,value:""},Wh=/[a-zA-Z0-9_]/;function Gh(e){if(!e)return[[]];if(e==="/")return[[Kh]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(K){throw new Error(`ERR (${r})/"${R}": ${K}`)}let r=0,n=r;const i=[];let p;function O(){p&&i.push(p),p=[]}let I=0,s,R="",A="";function w(){R&&(r===0?p.push({type:0,value:R}):r===1||r===2||r===3?(p.length>1&&(s==="*"||s==="+")&&t(`A repeatable param (${R}) must be alone in its segment. eg: '/:ids+.`),p.push({type:1,value:R,regexp:A,repeatable:s==="*"||s==="+",optional:s==="*"||s==="?"})):t("Invalid state to consume buffer"),R="")}function D(){R+=s}for(;I<e.length;){if(s=e[I++],s==="\\"&&r!==2){n=r,r=4;continue}switch(r){case 0:s==="/"?(R&&w(),O()):s===":"?(w(),r=1):D();break;case 4:D(),r=n;break;case 1:s==="("?r=2:Wh.test(s)?D():(w(),r=0,s!=="*"&&s!=="?"&&s!=="+"&&I--);break;case 2:s===")"?A[A.length-1]=="\\"?A=A.slice(0,-1)+s:r=3:A+=s;break;case 3:w(),r=0,s!=="*"&&s!=="?"&&s!=="+"&&I--,A="";break;default:t("Unknown state");break}}return r===2&&t(`Unfinished custom RegExp for param "${R}"`),w(),O(),i}function Yh(e,t,r){const n=wh(Gh(e.path),r),i=Me(n,{record:e,parent:t,children:[],alias:[]});return t&&!i.record.aliasOf==!t.record.aliasOf&&t.children.push(i),i}function Vh(e,t){const r=[],n=new Map;t=mo({strict:!1,end:!0,sensitive:!1},t);function i(A){return n.get(A)}function p(A,w,D){const K=!D,k=jh(A);k.aliasOf=D&&D.record;const F=mo(t,A),B=[k];if("alias"in A){const g=typeof A.alias=="string"?[A.alias]:A.alias;for(const M of g)B.push(Me({},k,{components:D?D.record.components:k.components,path:M,aliasOf:D?D.record:k}))}let P,N;for(const g of B){const{path:M}=g;if(w&&M[0]!=="/"){const S=w.record.path,f=S[S.length-1]==="/"?"":"/";g.path=w.record.path+(M&&f+M)}if(P=Yh(g,w,F),D?D.alias.push(P):(N=N||P,N!==P&&N.alias.push(P),K&&A.name&&!go(P)&&O(A.name)),k.children){const S=k.children;for(let f=0;f<S.length;f++)p(S[f],P,D&&D.children[f])}D=D||P,(P.record.components&&Object.keys(P.record.components).length||P.record.name||P.record.redirect)&&s(P)}return N?()=>{O(N)}:ln}function O(A){if(ul(A)){const w=n.get(A);w&&(n.delete(A),r.splice(r.indexOf(w),1),w.children.forEach(O),w.alias.forEach(O))}else{const w=r.indexOf(A);w>-1&&(r.splice(w,1),A.record.name&&n.delete(A.record.name),A.children.forEach(O),A.alias.forEach(O))}}function I(){return r}function s(A){let w=0;for(;w<r.length&&Hh(A,r[w])>=0&&(A.record.path!==r[w].record.path||!cl(A,r[w]));)w++;r.splice(w,0,A),A.record.name&&!go(A)&&n.set(A.record.name,A)}function R(A,w){let D,K={},k,F;if("name"in A&&A.name){if(D=n.get(A.name),!D)throw Yr(1,{location:A});F=D.record.name,K=Me(ho(w.params,D.keys.filter(N=>!N.optional).map(N=>N.name)),A.params&&ho(A.params,D.keys.map(N=>N.name))),k=D.stringify(K)}else if("path"in A)k=A.path,D=r.find(N=>N.re.test(k)),D&&(K=D.parse(k),F=D.record.name);else{if(D=w.name?n.get(w.name):r.find(N=>N.re.test(w.path)),!D)throw Yr(1,{location:A,currentLocation:w});F=D.record.name,K=Me({},w.params,A.params),k=D.stringify(K)}const B=[];let P=D;for(;P;)B.unshift(P.record),P=P.parent;return{name:F,path:k,params:K,matched:B,meta:Qh(B)}}return e.forEach(A=>p(A)),{addRoute:p,resolve:R,removeRoute:O,getRoutes:I,getRecordMatcher:i}}function ho(e,t){const r={};for(const n of t)n in e&&(r[n]=e[n]);return r}function jh(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:Xh(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}}}function Xh(e){const t={},r=e.props||!1;if("component"in e)t.default=r;else for(const n in e.components)t[n]=typeof r=="boolean"?r:r[n];return t}function go(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function Qh(e){return e.reduce((t,r)=>Me(t,r.meta),{})}function mo(e,t){const r={};for(const n in e)r[n]=n in t?t[n]:e[n];return r}function cl(e,t){return t.children.some(r=>r===e||cl(e,r))}const fl=/#/g,$h=/&/g,zh=/\//g,qh=/=/g,Jh=/\?/g,dl=/\+/g,Zh=/%5B/g,e0=/%5D/g,hl=/%5E/g,t0=/%60/g,gl=/%7B/g,r0=/%7C/g,ml=/%7D/g,n0=/%20/g;function ia(e){return encodeURI(""+e).replace(r0,"|").replace(Zh,"[").replace(e0,"]")}function i0(e){return ia(e).replace(gl,"{").replace(ml,"}").replace(hl,"^")}function bs(e){return ia(e).replace(dl,"%2B").replace(n0,"+").replace(fl,"%23").replace($h,"%26").replace(t0,"`").replace(gl,"{").replace(ml,"}").replace(hl,"^")}function s0(e){return bs(e).replace(qh,"%3D")}function a0(e){return ia(e).replace(fl,"%23").replace(Jh,"%3F")}function o0(e){return e==null?"":a0(e).replace(zh,"%2F")}function ii(e){try{return decodeURIComponent(""+e)}catch{}return""+e}function u0(e){const t={};if(e===""||e==="?")return t;const n=(e[0]==="?"?e.slice(1):e).split("&");for(let i=0;i<n.length;++i){const p=n[i].replace(dl," "),O=p.indexOf("="),I=ii(O<0?p:p.slice(0,O)),s=O<0?null:ii(p.slice(O+1));if(I in t){let R=t[I];Dt(R)||(R=t[I]=[R]),R.push(s)}else t[I]=s}return t}function Eo(e){let t="";for(let r in e){const n=e[r];if(r=s0(r),n==null){n!==void 0&&(t+=(t.length?"&":"")+r);continue}(Dt(n)?n.map(p=>p&&bs(p)):[n&&bs(n)]).forEach(p=>{p!==void 0&&(t+=(t.length?"&":"")+r,p!=null&&(t+="="+p))})}return t}function l0(e){const t={};for(const r in e){const n=e[r];n!==void 0&&(t[r]=Dt(n)?n.map(i=>i==null?null:""+i):n==null?n:""+n)}return t}const c0=Symbol(""),vo=Symbol(""),sa=Symbol(""),El=Symbol(""),Ss=Symbol("");function en(){let e=[];function t(n){return e.push(n),()=>{const i=e.indexOf(n);i>-1&&e.splice(i,1)}}function r(){e=[]}return{add:t,list:()=>e,reset:r}}function er(e,t,r,n,i){const p=n&&(n.enterCallbacks[i]=n.enterCallbacks[i]||[]);return()=>new Promise((O,I)=>{const s=w=>{w===!1?I(Yr(4,{from:r,to:t})):w instanceof Error?I(w):Fh(w)?I(Yr(2,{from:t,to:w})):(p&&n.enterCallbacks[i]===p&&typeof w=="function"&&p.push(w),O())},R=e.call(n&&n.instances[i],t,r,s);let A=Promise.resolve(R);e.length<3&&(A=A.then(s)),A.catch(w=>I(w))})}function qi(e,t,r,n){const i=[];for(const p of e)for(const O in p.components){let I=p.components[O];if(!(t!=="beforeRouteEnter"&&!p.instances[O]))if(f0(I)){const R=(I.__vccOpts||I)[t];R&&i.push(er(R,r,n,p,O))}else{let s=I();i.push(()=>s.then(R=>{if(!R)return Promise.reject(new Error(`Couldn't resolve component "${O}" at "${p.path}"`));const A=vh(R)?R.default:R;p.components[O]=A;const D=(A.__vccOpts||A)[t];return D&&er(D,r,n,p,O)()}))}}return i}function f0(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function po(e){const t=Vt(sa),r=Vt(El),n=vt(()=>t.resolve(kt(e.to))),i=vt(()=>{const{matched:s}=n.value,{length:R}=s,A=s[R-1],w=r.matched;if(!A||!w.length)return-1;const D=w.findIndex(Gr.bind(null,A));if(D>-1)return D;const K=To(s[R-2]);return R>1&&To(A)===K&&w[w.length-1].path!==K?w.findIndex(Gr.bind(null,s[R-2])):D}),p=vt(()=>i.value>-1&&m0(r.params,n.value.params)),O=vt(()=>i.value>-1&&i.value===r.matched.length-1&&al(r.params,n.value.params));function I(s={}){return g0(s)?t[kt(e.replace)?"replace":"push"](kt(e.to)).catch(ln):Promise.resolve()}return{route:n,href:vt(()=>n.value.href),isActive:p,isExactActive:O,navigate:I}}const d0=br({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:po,setup(e,{slots:t}){const r=yr(po(e)),{options:n}=Vt(sa),i=vt(()=>({[_o(e.activeClass,n.linkActiveClass,"router-link-active")]:r.isActive,[_o(e.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:r.isExactActive}));return()=>{const p=t.default&&t.default(r);return e.custom?p:il("a",{"aria-current":r.isExactActive?e.ariaCurrentValue:null,href:r.href,onClick:r.navigate,class:i.value},p)}}}),h0=d0;function g0(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function m0(e,t){for(const r in t){const n=t[r],i=e[r];if(typeof n=="string"){if(n!==i)return!1}else if(!Dt(i)||i.length!==n.length||n.some((p,O)=>p!==i[O]))return!1}return!0}function To(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const _o=(e,t,r)=>e??t??r,E0=br({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:r}){const n=Vt(Ss),i=vt(()=>e.route||n.value),p=Vt(vo,0),O=vt(()=>{let R=kt(p);const{matched:A}=i.value;let w;for(;(w=A[R])&&!w.components;)R++;return R}),I=vt(()=>i.value.matched[O.value]);Qn(vo,vt(()=>O.value+1)),Qn(c0,I),Qn(Ss,i);const s=pr();return $n(()=>[s.value,I.value,e.name],([R,A,w],[D,K,k])=>{A&&(A.instances[w]=R,K&&K!==A&&R&&R===D&&(A.leaveGuards.size||(A.leaveGuards=K.leaveGuards),A.updateGuards.size||(A.updateGuards=K.updateGuards))),R&&A&&(!K||!Gr(A,K)||!D)&&(A.enterCallbacks[w]||[]).forEach(F=>F(R))},{flush:"post"}),()=>{const R=i.value,A=e.name,w=I.value,D=w&&w.components[A];if(!D)return Ao(r.default,{Component:D,route:R});const K=w.props[A],k=K?K===!0?R.params:typeof K=="function"?K(R):K:null,B=il(D,Me({},k,t,{onVnodeUnmounted:P=>{P.component.isUnmounted&&(w.instances[A]=null)},ref:s}));return Ao(r.default,{Component:B,route:R})||B}}});function Ao(e,t){if(!e)return null;const r=e(t);return r.length===1?r[0]:r}const v0=E0;function p0(e){const t=Vh(e.routes,e),r=e.parseQuery||u0,n=e.stringifyQuery||Eo,i=e.history,p=en(),O=en(),I=en(),s=Mf(zt);let R=zt;Rr&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const A=$i.bind(null,U=>""+U),w=$i.bind(null,o0),D=$i.bind(null,ii);function K(U,G){let Y,j;return ul(U)?(Y=t.getRecordMatcher(U),j=G):j=U,t.addRoute(j,Y)}function k(U){const G=t.getRecordMatcher(U);G&&t.removeRoute(G)}function F(){return t.getRoutes().map(U=>U.record)}function B(U){return!!t.getRecordMatcher(U)}function P(U,G){if(G=Me({},G||s.value),typeof U=="string"){const V=zi(r,U,G.path),Q=t.resolve({path:V.path},G),ee=i.createHref(V.fullPath);return Me(V,Q,{params:D(Q.params),hash:ii(V.hash),redirectedFrom:void 0,href:ee})}let Y;if("path"in U)Y=Me({},U,{path:zi(r,U.path,G.path).path});else{const V=Me({},U.params);for(const Q in V)V[Q]==null&&delete V[Q];Y=Me({},U,{params:w(U.params)}),G.params=w(G.params)}const j=t.resolve(Y,G),X=U.hash||"";j.params=A(D(j.params));const q=_h(n,Me({},U,{hash:i0(X),path:j.path})),J=i.createHref(q);return Me({fullPath:q,hash:X,query:n===Eo?l0(U.query):U.query||{}},j,{redirectedFrom:void 0,href:J})}function N(U){return typeof U=="string"?zi(r,U,s.value.path):Me({},U)}function g(U,G){if(R!==U)return Yr(8,{from:G,to:U})}function M(U){return E(U)}function S(U){return M(Me(N(U),{replace:!0}))}function f(U){const G=U.matched[U.matched.length-1];if(G&&G.redirect){const{redirect:Y}=G;let j=typeof Y=="function"?Y(U):Y;return typeof j=="string"&&(j=j.includes("?")||j.includes("#")?j=N(j):{path:j},j.params={}),Me({query:U.query,hash:U.hash,params:"path"in j?{}:U.params},j)}}function E(U,G){const Y=R=P(U),j=s.value,X=U.state,q=U.force,J=U.replace===!0,V=f(Y);if(V)return E(Me(N(V),{state:typeof V=="object"?Me({},X,V.state):X,force:q,replace:J}),G||Y);const Q=Y;Q.redirectedFrom=G;let ee;return!q&&Ah(n,j,Y)&&(ee=Yr(16,{to:Q,from:j}),_(j,j,!0,!1)),(ee?Promise.resolve(ee):l(Q,j)).catch(Z=>Kt(Z)?Kt(Z,2)?Z:o(Z):a(Z,Q,j)).then(Z=>{if(Z){if(Kt(Z,2))return E(Me({replace:J},N(Z.to),{state:typeof Z.to=="object"?Me({},X,Z.to.state):X,force:q}),G||Q)}else Z=h(Q,j,!0,J,X);return b(Q,j,Z),Z})}function d(U,G){const Y=g(U,G);return Y?Promise.reject(Y):Promise.resolve()}function l(U,G){let Y;const[j,X,q]=T0(U,G);Y=qi(j.reverse(),"beforeRouteLeave",U,G);for(const V of j)V.leaveGuards.forEach(Q=>{Y.push(er(Q,U,G))});const J=d.bind(null,U,G);return Y.push(J),Lr(Y).then(()=>{Y=[];for(const V of p.list())Y.push(er(V,U,G));return Y.push(J),Lr(Y)}).then(()=>{Y=qi(X,"beforeRouteUpdate",U,G);for(const V of X)V.updateGuards.forEach(Q=>{Y.push(er(Q,U,G))});return Y.push(J),Lr(Y)}).then(()=>{Y=[];for(const V of U.matched)if(V.beforeEnter&&!G.matched.includes(V))if(Dt(V.beforeEnter))for(const Q of V.beforeEnter)Y.push(er(Q,U,G));else Y.push(er(V.beforeEnter,U,G));return Y.push(J),Lr(Y)}).then(()=>(U.matched.forEach(V=>V.enterCallbacks={}),Y=qi(q,"beforeRouteEnter",U,G),Y.push(J),Lr(Y))).then(()=>{Y=[];for(const V of O.list())Y.push(er(V,U,G));return Y.push(J),Lr(Y)}).catch(V=>Kt(V,8)?V:Promise.reject(V))}function b(U,G,Y){for(const j of I.list())j(U,G,Y)}function h(U,G,Y,j,X){const q=g(U,G);if(q)return q;const J=G===zt,V=Rr?history.state:{};Y&&(j||J?i.replace(U.fullPath,Me({scroll:J&&V&&V.scroll},X)):i.push(U.fullPath,X)),s.value=U,_(U,G,Y,J),o()}let u;function m(){u||(u=i.listen((U,G,Y)=>{if(!W.listening)return;const j=P(U),X=f(j);if(X){E(Me(X,{replace:!0}),j).catch(ln);return}R=j;const q=s.value;Rr&&Dh(oo(q.fullPath,Y.delta),xi()),l(j,q).catch(J=>Kt(J,12)?J:Kt(J,2)?(E(J.to,j).then(V=>{Kt(V,20)&&!Y.delta&&Y.type===xn.pop&&i.go(-1,!1)}).catch(ln),Promise.reject()):(Y.delta&&i.go(-Y.delta,!1),a(J,j,q))).then(J=>{J=J||h(j,q,!1),J&&(Y.delta&&!Kt(J,8)?i.go(-Y.delta,!1):Y.type===xn.pop&&Kt(J,20)&&i.go(-1,!1)),b(j,q,J)}).catch(ln)}))}let y=en(),v=en(),c;function a(U,G,Y){o(U);const j=v.list();return j.length?j.forEach(X=>X(U,G,Y)):console.error(U),Promise.reject(U)}function T(){return c&&s.value!==zt?Promise.resolve():new Promise((U,G)=>{y.add([U,G])})}function o(U){return c||(c=!U,m(),y.list().forEach(([G,Y])=>U?Y(U):G()),y.reset()),U}function _(U,G,Y,j){const{scrollBehavior:X}=e;if(!Rr||!X)return Promise.resolve();const q=!Y&&Rh(oo(U.fullPath,0))||(j||!Y)&&history.state&&history.state.scroll||null;return Ru().then(()=>X(U,G,q)).then(J=>J&&Lh(J)).catch(J=>a(J,U,G))}const L=U=>i.go(U);let x;const H=new Set,W={currentRoute:s,listening:!0,addRoute:K,removeRoute:k,hasRoute:B,getRoutes:F,resolve:P,options:e,push:M,replace:S,go:L,back:()=>L(-1),forward:()=>L(1),beforeEach:p.add,beforeResolve:O.add,afterEach:I.add,onError:v.add,isReady:T,install(U){const G=this;U.component("RouterLink",h0),U.component("RouterView",v0),U.config.globalProperties.$router=G,Object.defineProperty(U.config.globalProperties,"$route",{enumerable:!0,get:()=>kt(s)}),Rr&&!x&&s.value===zt&&(x=!0,M(i.location).catch(X=>{}));const Y={};for(const X in zt)Y[X]=vt(()=>s.value[X]);U.provide(sa,G),U.provide(El,yr(Y)),U.provide(Ss,s);const j=U.unmount;H.add(U),U.unmount=function(){H.delete(U),H.size<1&&(R=zt,u&&u(),u=null,s.value=zt,x=!1,c=!1),j()}}};return W}function Lr(e){return e.reduce((t,r)=>t.then(()=>r()),Promise.resolve())}function T0(e,t){const r=[],n=[],i=[],p=Math.max(t.matched.length,e.matched.length);for(let O=0;O<p;O++){const I=t.matched[O];I&&(e.matched.find(R=>Gr(R,I))?n.push(I):r.push(I));const s=e.matched[O];s&&(t.matched.find(R=>Gr(R,s))||i.push(s))}return[r,n,i]}const _0=["href"],A0={class:"w-full"},y0=["src"],b0={class:"mt-5 grid"},S0={class:"text-lg font-bold whitespace-nowrap text-ellipsis overflow-hidden"},x0=br({__name:"AnimeCardComponent",props:{anime:null},setup(e){const t=e;return(r,n)=>(pt(),Bt("a",{href:`/anime/${t.anime.id}`},[Oe("div",A0,[Oe("img",{class:"w-full rounded object-cover aspect-[9/13]",src:t.anime.url_image,alt:""},null,8,y0),Oe("div",b0,[Oe("h5",S0,Yt(t.anime.title),1),Oe("h6",null,Yt(t.anime.start_date_year)+" - "+Yt(t.anime.nb_eps),1)])])],8,_0))}});function I0(e,t){const r=[];for(let n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r}const C0={key:0,class:"grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-6 gap-10"},L0=br({__name:"HomeView",setup(e){let t=pr([]),r=pr(0);return Hu(()=>{let n=setInterval(()=>{t.value=I0(Sn.vostfr,20)},100);t.value.length>0&&clearInterval(n)}),(n,i)=>kt(t)?(pt(),Bt("div",C0,[(pt(!0),Bt(yt,null,Yu(kt(t)[kt(r)],p=>(pt(),Bt("div",{key:p.id},[lt(x0,{anime:p},null,8,["anime"])]))),128)),Oe("button",{onClick:i[0]||(i[0]=p=>Xe(r)?r.value--:r--)},"prev"),Oe("button",{onClick:i[1]||(i[1]=p=>Xe(r)?r.value++:r++)},"next")])):ta("",!0)}}),aa={xml:!1,decodeEntities:!0},yo={_useHtmlParser2:!0,xmlMode:!0};function xs(e){return e!=null&&e.xml?typeof e.xml=="boolean"?yo:{...yo,...e.xml}:e??void 0}var Re;(function(e){e.Root="root",e.Text="text",e.Directive="directive",e.Comment="comment",e.Script="script",e.Style="style",e.Tag="tag",e.CDATA="cdata",e.Doctype="doctype"})(Re||(Re={}));function D0(e){return e.type===Re.Tag||e.type===Re.Script||e.type===Re.Style}const R0=Re.Root,O0=Re.Text,P0=Re.Directive,N0=Re.Comment,M0=Re.Script,F0=Re.Style,k0=Re.Tag,B0=Re.CDATA,w0=Re.Doctype;class vl{constructor(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}get parentNode(){return this.parent}set parentNode(t){this.parent=t}get previousSibling(){return this.prev}set previousSibling(t){this.prev=t}get nextSibling(){return this.next}set nextSibling(t){this.next=t}cloneNode(t=!1){return si(this,t)}}class oa extends vl{constructor(t){super(),this.data=t}get nodeValue(){return this.data}set nodeValue(t){this.data=t}}class In extends oa{constructor(){super(...arguments),this.type=Re.Text}get nodeType(){return 3}}class ua extends oa{constructor(){super(...arguments),this.type=Re.Comment}get nodeType(){return 8}}class la extends oa{constructor(t,r){super(r),this.name=t,this.type=Re.Directive}get nodeType(){return 1}}class ca extends vl{constructor(t){super(),this.children=t}get firstChild(){var t;return(t=this.children[0])!==null&&t!==void 0?t:null}get lastChild(){return this.children.length>0?this.children[this.children.length-1]:null}get childNodes(){return this.children}set childNodes(t){this.children=t}}class pl extends ca{constructor(){super(...arguments),this.type=Re.CDATA}get nodeType(){return 4}}class _r extends ca{constructor(){super(...arguments),this.type=Re.Root}get nodeType(){return 9}}let fa=class extends ca{constructor(t,r,n=[],i=t==="script"?Re.Script:t==="style"?Re.Style:Re.Tag){super(n),this.name=t,this.attribs=r,this.type=i}get nodeType(){return 1}get tagName(){return this.name}set tagName(t){this.name=t}get attributes(){return Object.keys(this.attribs).map(t=>{var r,n;return{name:t,value:this.attribs[t],namespace:(r=this["x-attribsNamespace"])===null||r===void 0?void 0:r[t],prefix:(n=this["x-attribsPrefix"])===null||n===void 0?void 0:n[t]}})}};function be(e){return D0(e)}function Ii(e){return e.type===Re.CDATA}function wt(e){return e.type===Re.Text}function Ci(e){return e.type===Re.Comment}function Is(e){return e.type===Re.Directive}function Sr(e){return e.type===Re.Root}function Qe(e){return Object.prototype.hasOwnProperty.call(e,"children")}function si(e,t=!1){let r;if(wt(e))r=new In(e.data);else if(Ci(e))r=new ua(e.data);else if(be(e)){const n=t?Ji(e.children):[],i=new fa(e.name,{...e.attribs},n);n.forEach(p=>p.parent=i),e.namespace!=null&&(i.namespace=e.namespace),e["x-attribsNamespace"]&&(i["x-attribsNamespace"]={...e["x-attribsNamespace"]}),e["x-attribsPrefix"]&&(i["x-attribsPrefix"]={...e["x-attribsPrefix"]}),r=i}else if(Ii(e)){const n=t?Ji(e.children):[],i=new pl(n);n.forEach(p=>p.parent=i),r=i}else if(Sr(e)){const n=t?Ji(e.children):[],i=new _r(n);n.forEach(p=>p.parent=i),e["x-mode"]&&(i["x-mode"]=e["x-mode"]),r=i}else if(Is(e)){const n=new la(e.name,e.data);e["x-name"]!=null&&(n["x-name"]=e["x-name"],n["x-publicId"]=e["x-publicId"],n["x-systemId"]=e["x-systemId"]),r=n}else throw new Error(`Not implemented yet: ${e.type}`);return r.startIndex=e.startIndex,r.endIndex=e.endIndex,e.sourceCodeLocation!=null&&(r.sourceCodeLocation=e.sourceCodeLocation),r}function Ji(e){const t=e.map(r=>si(r,!0));for(let r=1;r<t.length;r++)t[r].prev=t[r-1],t[r-1].next=t[r];return t}const bo={withStartIndices:!1,withEndIndices:!1,xmlMode:!1};class U0{constructor(t,r,n){this.dom=[],this.root=new _r(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof r=="function"&&(n=r,r=bo),typeof t=="object"&&(r=t,t=void 0),this.callback=t??null,this.options=r??bo,this.elementCB=n??null}onparserinit(t){this.parser=t}onreset(){this.dom=[],this.root=new _r(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null}onend(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))}onerror(t){this.handleCallback(t)}onclosetag(){this.lastNode=null;const t=this.tagStack.pop();this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(t)}onopentag(t,r){const n=this.options.xmlMode?Re.Tag:void 0,i=new fa(t,r,void 0,n);this.addNode(i),this.tagStack.push(i)}ontext(t){const{lastNode:r}=this;if(r&&r.type===Re.Text)r.data+=t,this.options.withEndIndices&&(r.endIndex=this.parser.endIndex);else{const n=new In(t);this.addNode(n),this.lastNode=n}}oncomment(t){if(this.lastNode&&this.lastNode.type===Re.Comment){this.lastNode.data+=t;return}const r=new ua(t);this.addNode(r),this.lastNode=r}oncommentend(){this.lastNode=null}oncdatastart(){const t=new In(""),r=new pl([t]);this.addNode(r),t.parent=r,this.lastNode=t}oncdataend(){this.lastNode=null}onprocessinginstruction(t,r){const n=new la(t,r);this.addNode(n)}handleCallback(t){if(typeof this.callback=="function")this.callback(t,this.dom);else if(t)throw t}addNode(t){const r=this.tagStack[this.tagStack.length-1],n=r.children[r.children.length-1];this.options.withStartIndices&&(t.startIndex=this.parser.startIndex),this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),r.children.push(t),n&&(t.prev=n,n.next=t),t.parent=r,this.lastNode=null}}const qt=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(e=>e.charCodeAt(0))),H0=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(e=>e.charCodeAt(0)));var Zi;const K0=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),So=(Zi=String.fromCodePoint)!==null&&Zi!==void 0?Zi:function(e){let t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|e&1023),t+=String.fromCharCode(e),t};function W0(e){var t;return e>=55296&&e<=57343||e>1114111?65533:(t=K0.get(e))!==null&&t!==void 0?t:e}var xo;(function(e){e[e.NUM=35]="NUM",e[e.SEMI=59]="SEMI",e[e.ZERO=48]="ZERO",e[e.NINE=57]="NINE",e[e.LOWER_A=97]="LOWER_A",e[e.LOWER_F=102]="LOWER_F",e[e.LOWER_X=120]="LOWER_X",e[e.To_LOWER_BIT=32]="To_LOWER_BIT"})(xo||(xo={}));var jt;(function(e){e[e.VALUE_LENGTH=49152]="VALUE_LENGTH",e[e.BRANCH_LENGTH=16256]="BRANCH_LENGTH",e[e.JUMP_TABLE=127]="JUMP_TABLE"})(jt||(jt={}));function Tl(e,t,r,n){const i=(t&jt.BRANCH_LENGTH)>>7,p=t&jt.JUMP_TABLE;if(i===0)return p!==0&&n===p?r:-1;if(p){const s=n-p;return s<0||s>=i?-1:e[r+s]-1}let O=r,I=O+i-1;for(;O<=I;){const s=O+I>>>1,R=e[s];if(R<n)O=s+1;else if(R>n)I=s-1;else return e[s+i]}return-1}const Io=/["&'<>$\x80-\uFFFF]/g,G0=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]),Y0=String.prototype.codePointAt!=null?(e,t)=>e.codePointAt(t):(e,t)=>(e.charCodeAt(t)&64512)===55296?(e.charCodeAt(t)-55296)*1024+e.charCodeAt(t+1)-56320+65536:e.charCodeAt(t);function _l(e){let t="",r=0,n;for(;(n=Io.exec(e))!==null;){const i=n.index,p=e.charCodeAt(i),O=G0.get(p);O!==void 0?(t+=e.substring(r,i)+O,r=i+1):(t+=`${e.substring(r,i)}&#x${Y0(e,i).toString(16)};`,r=Io.lastIndex+=Number((p&64512)===55296))}return t+e.substr(r)}function Al(e,t){return function(n){let i,p=0,O="";for(;i=e.exec(n);)p!==i.index&&(O+=n.substring(p,i.index)),O+=t.get(i[0].charCodeAt(0)),p=i.index+1;return O+n.substring(p)}}const yl=Al(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),bl=Al(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]])),V0=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(e=>[e.toLowerCase(),e])),j0=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),X0=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function Q0(e){return e.replace(/"/g,"&quot;")}function $0(e,t){var r;if(!e)return;const n=((r=t.encodeEntities)!==null&&r!==void 0?r:t.decodeEntities)===!1?Q0:t.xmlMode||t.encodeEntities!=="utf8"?_l:yl;return Object.keys(e).map(i=>{var p,O;const I=(p=e[i])!==null&&p!==void 0?p:"";return t.xmlMode==="foreign"&&(i=(O=j0.get(i))!==null&&O!==void 0?O:i),!t.emptyAttrs&&!t.xmlMode&&I===""?i:`${i}="${n(I)}"`}).join(" ")}const Co=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function Li(e,t={}){const r="length"in e?e:[e];let n="";for(let i=0;i<r.length;i++)n+=z0(r[i],t);return n}function z0(e,t){switch(e.type){case R0:return Li(e.children,t);case w0:case P0:return eg(e);case N0:return ng(e);case B0:return rg(e);case M0:case F0:case k0:return Z0(e,t);case O0:return tg(e,t)}}const q0=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),J0=new Set(["svg","math"]);function Z0(e,t){var r;t.xmlMode==="foreign"&&(e.name=(r=V0.get(e.name))!==null&&r!==void 0?r:e.name,e.parent&&q0.has(e.parent.name)&&(t={...t,xmlMode:!1})),!t.xmlMode&&J0.has(e.name)&&(t={...t,xmlMode:"foreign"});let n=`<${e.name}`;const i=$0(e.attribs,t);return i&&(n+=` ${i}`),e.children.length===0&&(t.xmlMode?t.selfClosingTags!==!1:t.selfClosingTags&&Co.has(e.name))?(t.xmlMode||(n+=" "),n+="/>"):(n+=">",e.children.length>0&&(n+=Li(e.children,t)),(t.xmlMode||!Co.has(e.name))&&(n+=`</${e.name}>`)),n}function eg(e){return`<${e.data}>`}function tg(e,t){var r;let n=e.data||"";return((r=t.encodeEntities)!==null&&r!==void 0?r:t.decodeEntities)!==!1&&!(!t.xmlMode&&e.parent&&X0.has(e.parent.name))&&(n=t.xmlMode||t.encodeEntities!=="utf8"?_l(n):bl(n)),n}function rg(e){return`<![CDATA[${e.children[0].data}]]>`}function ng(e){return`<!--${e.data}-->`}function Sl(e,t){return Li(e,t)}function ig(e,t){return Qe(e)?e.children.map(r=>Sl(r,t)).join(""):""}function Jn(e){return Array.isArray(e)?e.map(Jn).join(""):be(e)?e.name==="br"?`
`:Jn(e.children):Ii(e)?Jn(e.children):wt(e)?e.data:""}function Vr(e){return Array.isArray(e)?e.map(Vr).join(""):Qe(e)&&!Ci(e)?Vr(e.children):wt(e)?e.data:""}function ai(e){return Array.isArray(e)?e.map(ai).join(""):Qe(e)&&(e.type===Re.Tag||Ii(e))?ai(e.children):wt(e)?e.data:""}function Di(e){return Qe(e)?e.children:[]}function xl(e){return e.parent||null}function Il(e){const t=xl(e);if(t!=null)return Di(t);const r=[e];let{prev:n,next:i}=e;for(;n!=null;)r.unshift(n),{prev:n}=n;for(;i!=null;)r.push(i),{next:i}=i;return r}function sg(e,t){var r;return(r=e.attribs)===null||r===void 0?void 0:r[t]}function ag(e,t){return e.attribs!=null&&Object.prototype.hasOwnProperty.call(e.attribs,t)&&e.attribs[t]!=null}function og(e){return e.name}function da(e){let{next:t}=e;for(;t!==null&&!be(t);)({next:t}=t);return t}function ha(e){let{prev:t}=e;for(;t!==null&&!be(t);)({prev:t}=t);return t}function xr(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){const t=e.parent.children;t.splice(t.lastIndexOf(e),1)}}function ug(e,t){const r=t.prev=e.prev;r&&(r.next=t);const n=t.next=e.next;n&&(n.prev=t);const i=t.parent=e.parent;if(i){const p=i.children;p[p.lastIndexOf(e)]=t,e.parent=null}}function lg(e,t){if(xr(t),t.next=null,t.parent=e,e.children.push(t)>1){const r=e.children[e.children.length-2];r.next=t,t.prev=r}else t.prev=null}function cg(e,t){xr(t);const{parent:r}=e,n=e.next;if(t.next=n,t.prev=e,e.next=t,t.parent=r,n){if(n.prev=t,r){const i=r.children;i.splice(i.lastIndexOf(n),0,t)}}else r&&r.children.push(t)}function fg(e,t){if(xr(t),t.parent=e,t.prev=null,e.children.unshift(t)!==1){const r=e.children[1];r.prev=t,t.next=r}else t.next=null}function dg(e,t){xr(t);const{parent:r}=e;if(r){const n=r.children;n.splice(n.indexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=r,t.prev=e.prev,t.next=e,e.prev=t}function Ri(e,t,r=!0,n=1/0){return Array.isArray(t)||(t=[t]),Oi(e,t,r,n)}function Oi(e,t,r,n){const i=[];for(const p of t){if(e(p)&&(i.push(p),--n<=0))break;if(r&&Qe(p)&&p.children.length>0){const O=Oi(e,p.children,r,n);if(i.push(...O),n-=O.length,n<=0)break}}return i}function hg(e,t){return t.find(e)}function ga(e,t,r=!0){let n=null;for(let i=0;i<t.length&&!n;i++){const p=t[i];if(be(p))e(p)?n=p:r&&p.children.length>0&&(n=ga(e,p.children,!0));else continue}return n}function Cl(e,t){return t.some(r=>be(r)&&(e(r)||r.children.length>0&&Cl(e,r.children)))}function gg(e,t){var r;const n=[],i=t.filter(be);let p;for(;p=i.shift();){const O=(r=p.children)===null||r===void 0?void 0:r.filter(be);O&&O.length>0&&i.unshift(...O),e(p)&&n.push(p)}return n}const oi={tag_name(e){return typeof e=="function"?t=>be(t)&&e(t.name):e==="*"?be:t=>be(t)&&t.name===e},tag_type(e){return typeof e=="function"?t=>e(t.type):t=>t.type===e},tag_contains(e){return typeof e=="function"?t=>wt(t)&&e(t.data):t=>wt(t)&&t.data===e}};function Ll(e,t){return typeof t=="function"?r=>be(r)&&t(r.attribs[e]):r=>be(r)&&r.attribs[e]===t}function mg(e,t){return r=>e(r)||t(r)}function Dl(e){const t=Object.keys(e).map(r=>{const n=e[r];return Object.prototype.hasOwnProperty.call(oi,r)?oi[r](n):Ll(r,n)});return t.length===0?null:t.reduce(mg)}function Eg(e,t){const r=Dl(e);return r?r(t):!0}function vg(e,t,r,n=1/0){const i=Dl(e);return i?Ri(i,t,r,n):[]}function pg(e,t,r=!0){return Array.isArray(t)||(t=[t]),ga(Ll("id",e),t,r)}function zr(e,t,r=!0,n=1/0){return Ri(oi.tag_name(e),t,r,n)}function Tg(e,t,r=!0,n=1/0){return Ri(oi.tag_type(e),t,r,n)}function _g(e){let t=e.length;for(;--t>=0;){const r=e[t];if(t>0&&e.lastIndexOf(r,t-1)>=0){e.splice(t,1);continue}for(let n=r.parent;n;n=n.parent)if(e.includes(n)){e.splice(t,1);break}}return e}var Et;(function(e){e[e.DISCONNECTED=1]="DISCONNECTED",e[e.PRECEDING=2]="PRECEDING",e[e.FOLLOWING=4]="FOLLOWING",e[e.CONTAINS=8]="CONTAINS",e[e.CONTAINED_BY=16]="CONTAINED_BY"})(Et||(Et={}));function Rl(e,t){const r=[],n=[];if(e===t)return 0;let i=Qe(e)?e:e.parent;for(;i;)r.unshift(i),i=i.parent;for(i=Qe(t)?t:t.parent;i;)n.unshift(i),i=i.parent;const p=Math.min(r.length,n.length);let O=0;for(;O<p&&r[O]===n[O];)O++;if(O===0)return Et.DISCONNECTED;const I=r[O-1],s=I.children,R=r[O],A=n[O];return s.indexOf(R)>s.indexOf(A)?I===t?Et.FOLLOWING|Et.CONTAINED_BY:Et.FOLLOWING:I===e?Et.PRECEDING|Et.CONTAINS:Et.PRECEDING}function qr(e){return e=e.filter((t,r,n)=>!n.includes(t,r+1)),e.sort((t,r)=>{const n=Rl(t,r);return n&Et.PRECEDING?-1:n&Et.FOLLOWING?1:0}),e}function Ag(e){const t=ui(Ig,e);return t?t.name==="feed"?yg(t):bg(t):null}function yg(e){var t;const r=e.children,n={type:"atom",items:zr("entry",r).map(O=>{var I;const{children:s}=O,R={media:Ol(s)};at(R,"id","id",s),at(R,"title","title",s);const A=(I=ui("link",s))===null||I===void 0?void 0:I.attribs.href;A&&(R.link=A);const w=mr("summary",s)||mr("content",s);w&&(R.description=w);const D=mr("updated",s);return D&&(R.pubDate=new Date(D)),R})};at(n,"id","id",r),at(n,"title","title",r);const i=(t=ui("link",r))===null||t===void 0?void 0:t.attribs.href;i&&(n.link=i),at(n,"description","subtitle",r);const p=mr("updated",r);return p&&(n.updated=new Date(p)),at(n,"author","email",r,!0),n}function bg(e){var t,r;const n=(r=(t=ui("channel",e.children))===null||t===void 0?void 0:t.children)!==null&&r!==void 0?r:[],i={type:e.name.substr(0,3),id:"",items:zr("item",e.children).map(O=>{const{children:I}=O,s={media:Ol(I)};at(s,"id","guid",I),at(s,"title","title",I),at(s,"link","link",I),at(s,"description","description",I);const R=mr("pubDate",I);return R&&(s.pubDate=new Date(R)),s})};at(i,"title","title",n),at(i,"link","link",n),at(i,"description","description",n);const p=mr("lastBuildDate",n);return p&&(i.updated=new Date(p)),at(i,"author","managingEditor",n,!0),i}const Sg=["url","type","lang"],xg=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function Ol(e){return zr("media:content",e).map(t=>{const{attribs:r}=t,n={medium:r.medium,isDefault:!!r.isDefault};for(const i of Sg)r[i]&&(n[i]=r[i]);for(const i of xg)r[i]&&(n[i]=parseInt(r[i],10));return r.expression&&(n.expression=r.expression),n})}function ui(e,t){return zr(e,t,!0,1)[0]}function mr(e,t,r=!1){return Vr(zr(e,t,r,1)).trim()}function at(e,t,r,n,i=!1){const p=mr(r,n,i);p&&(e[t]=p)}function Ig(e){return e==="rss"||e==="feed"||e==="rdf:RDF"}const Pi=Object.freeze(Object.defineProperty({__proto__:null,get DocumentPosition(){return Et},append:cg,appendChild:lg,compareDocumentPosition:Rl,existsOne:Cl,filter:Ri,find:Oi,findAll:gg,findOne:ga,findOneChild:hg,getAttributeValue:sg,getChildren:Di,getElementById:pg,getElements:vg,getElementsByTagName:zr,getElementsByTagType:Tg,getFeed:Ag,getInnerHTML:ig,getName:og,getOuterHTML:Sl,getParent:xl,getSiblings:Il,getText:Jn,hasAttrib:ag,hasChildren:Qe,innerText:ai,isCDATA:Ii,isComment:Ci,isDocument:Sr,isTag:be,isText:wt,nextElementSibling:da,prepend:dg,prependChild:fg,prevElementSibling:ha,removeElement:xr,removeSubsets:_g,replaceElement:ug,testElement:Eg,textContent:Vr,uniqueSort:qr},Symbol.toStringTag,{value:"Module"}));function Pl(e,t,r){return e?e(t??e._root.children,null,void 0,r).toString():""}function Cg(e,t){return!t&&typeof e=="object"&&e!=null&&!("length"in e)&&!("type"in e)}function Lg(e,t){const r=Cg(e)?(t=e,void 0):e,n={...aa,...this===null||this===void 0?void 0:this._options,...xs(t??{})};return Pl(this,r,n)}function Dg(e){const t={...this._options,xmlMode:!0};return Pl(this,e,t)}function Cn(e){const t=e||(this?this.root():[]);let r="";for(let n=0;n<t.length;n++)r+=Vr(t[n]);return r}function Rg(e,t,r=typeof t=="boolean"?t:!1){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(r=t);const n=this.load(e,aa,!1);return r||n("script").remove(),n.root()[0].children.slice()}function Og(){return this(this._root)}function Nl(e,t){if(t===e)return!1;let r=t;for(;r&&r!==r.parent;)if(r=r.parent,r===e)return!0;return!1}function Pg(e,t){if(!Lo(e)||!Lo(t))return;let r=e.length;const n=+t.length;for(let i=0;i<n;i++)e[r++]=t[i];return e.length=r,e}function Lo(e){if(Array.isArray(e))return!0;if(typeof e!="object"||!Object.prototype.hasOwnProperty.call(e,"length")||typeof e.length!="number"||e.length<0)return!1;for(let t=0;t<e.length;t++)if(!(t in e))return!1;return!0}const Ng=Object.freeze(Object.defineProperty({__proto__:null,contains:Nl,html:Lg,merge:Pg,parseHTML:Rg,root:Og,text:Cn,xml:Dg},Symbol.toStringTag,{value:"Module"}));function Ut(e){return e.cheerio!=null}function Mg(e){return e.replace(/[_.-](\w|$)/g,(t,r)=>r.toUpperCase())}function Fg(e){return e.replace(/[A-Z]/g,"-$&").toLowerCase()}function We(e,t){const r=e.length;for(let n=0;n<r;n++)t(e[n],n);return e}function Cs(e){const t="length"in e?Array.prototype.map.call(e,n=>si(n,!0)):[si(e,!0)],r=new _r(t);return t.forEach(n=>{n.parent=r}),t}var hr;(function(e){e[e.LowerA=97]="LowerA",e[e.LowerZ=122]="LowerZ",e[e.UpperA=65]="UpperA",e[e.UpperZ=90]="UpperZ",e[e.Exclamation=33]="Exclamation"})(hr||(hr={}));function Ls(e){const t=e.indexOf("<");if(t<0||t>e.length-3)return!1;const r=e.charCodeAt(t+1);return(r>=hr.LowerA&&r<=hr.LowerZ||r>=hr.UpperA&&r<=hr.UpperZ||r===hr.Exclamation)&&e.includes(">",t+2)}const wr=Object.prototype.hasOwnProperty,Ln=/\s+/,es="data-",Do={null:null,true:!0,false:!1},ma=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,kg=/^{[^]*}$|^\[[^]*]$/;function li(e,t,r){var n;if(!(!e||!be(e))){if((n=e.attribs)!==null&&n!==void 0||(e.attribs={}),!t)return e.attribs;if(wr.call(e.attribs,t))return!r&&ma.test(t)?t:e.attribs[t];if(e.name==="option"&&t==="value")return Cn(e.children);if(e.name==="input"&&(e.attribs.type==="radio"||e.attribs.type==="checkbox")&&t==="value")return"on"}}function Ur(e,t,r){r===null?Ml(e,t):e.attribs[t]=`${r}`}function Bg(e,t){if(typeof e=="object"||t!==void 0){if(typeof t=="function"){if(typeof e!="string")throw new Error("Bad combination of arguments.");return We(this,(r,n)=>{be(r)&&Ur(r,e,t.call(r,n,r.attribs[e]))})}return We(this,r=>{be(r)&&(typeof e=="object"?Object.keys(e).forEach(n=>{const i=e[n];Ur(r,n,i)}):Ur(r,e,t))})}return arguments.length>1?this:li(this[0],e,this.options.xmlMode)}function Ro(e,t,r){return t in e?e[t]:!r&&ma.test(t)?li(e,t,!1)!==void 0:li(e,t,r)}function ts(e,t,r,n){t in e?e[t]=r:Ur(e,t,!n&&ma.test(t)?r?"":null:`${r}`)}function wg(e,t){var r;if(typeof e=="string"&&t===void 0){const n=this[0];if(!n||!be(n))return;switch(e){case"style":{const i=this.css(),p=Object.keys(i);return p.forEach((O,I)=>{i[I]=O}),i.length=p.length,i}case"tagName":case"nodeName":return n.name.toUpperCase();case"href":case"src":{const i=(r=n.attribs)===null||r===void 0?void 0:r[e];return typeof URL<"u"&&(e==="href"&&(n.tagName==="a"||n.name==="link")||e==="src"&&(n.tagName==="img"||n.tagName==="iframe"||n.tagName==="audio"||n.tagName==="video"||n.tagName==="source"))&&i!==void 0&&this.options.baseURI?new URL(i,this.options.baseURI).href:i}case"innerText":return ai(n);case"textContent":return Vr(n);case"outerHTML":return this.clone().wrap("<container />").parent().html();case"innerHTML":return this.html();default:return Ro(n,e,this.options.xmlMode)}}if(typeof e=="object"||t!==void 0){if(typeof t=="function"){if(typeof e=="object")throw new Error("Bad combination of arguments.");return We(this,(n,i)=>{be(n)&&ts(n,e,t.call(n,i,Ro(n,e,this.options.xmlMode)),this.options.xmlMode)})}return We(this,n=>{be(n)&&(typeof e=="object"?Object.keys(e).forEach(i=>{const p=e[i];ts(n,i,p,this.options.xmlMode)}):ts(n,e,t,this.options.xmlMode))})}}function Oo(e,t,r){var n;const i=e;(n=i.data)!==null&&n!==void 0||(i.data={}),typeof t=="object"?Object.assign(i.data,t):typeof t=="string"&&r!==void 0&&(i.data[t]=r)}function Po(e,t){let r,n,i;t==null?(r=Object.keys(e.attribs).filter(p=>p.startsWith(es)),n=r.map(p=>Mg(p.slice(es.length)))):(r=[es+Fg(t)],n=[t]);for(let p=0;p<r.length;++p){const O=r[p],I=n[p];if(wr.call(e.attribs,O)&&!wr.call(e.data,I)){if(i=e.attribs[O],wr.call(Do,i))i=Do[i];else if(i===String(Number(i)))i=Number(i);else if(kg.test(i))try{i=JSON.parse(i)}catch{}e.data[I]=i}}return t==null?e.data:i}function Ug(e,t){var r;const n=this[0];if(!n||!be(n))return;const i=n;return(r=i.data)!==null&&r!==void 0||(i.data={}),e?typeof e=="object"||t!==void 0?(We(this,p=>{be(p)&&(typeof e=="object"?Oo(p,e):Oo(p,e,t))}),this):wr.call(i.data,e)?i.data[e]:Po(i,e):Po(i)}function Hg(e){const t=arguments.length===0,r=this[0];if(!r||!be(r))return t?void 0:this;switch(r.name){case"textarea":return this.text(e);case"select":{const n=this.find("option:selected");if(!t){if(this.attr("multiple")==null&&typeof e=="object")return this;this.find("option").removeAttr("selected");const i=typeof e!="object"?[e]:e;for(let p=0;p<i.length;p++)this.find(`option[value="${i[p]}"]`).attr("selected","");return this}return this.attr("multiple")?n.toArray().map(i=>Cn(i.children)):n.attr("value")}case"input":case"option":return t?this.attr("value"):this.attr("value",e)}}function Ml(e,t){!e.attribs||!wr.call(e.attribs,t)||delete e.attribs[t]}function ci(e){return e?e.trim().split(Ln):[]}function Kg(e){const t=ci(e);for(let r=0;r<t.length;r++)We(this,n=>{be(n)&&Ml(n,t[r])});return this}function Wg(e){return this.toArray().some(t=>{const r=be(t)&&t.attribs.class;let n=-1;if(r&&e.length)for(;(n=r.indexOf(e,n+1))>-1;){const i=n+e.length;if((n===0||Ln.test(r[n-1]))&&(i===r.length||Ln.test(r[i])))return!0}return!1})}function Fl(e){if(typeof e=="function")return We(this,(n,i)=>{if(be(n)){const p=n.attribs.class||"";Fl.call([n],e.call(n,i,p))}});if(!e||typeof e!="string")return this;const t=e.split(Ln),r=this.length;for(let n=0;n<r;n++){const i=this[n];if(!be(i))continue;const p=li(i,"class",!1);if(!p)Ur(i,"class",t.join(" ").trim());else{let O=` ${p} `;for(let I=0;I<t.length;I++){const s=`${t[I]} `;O.includes(` ${s}`)||(O+=s)}Ur(i,"class",O.trim())}}return this}function kl(e){if(typeof e=="function")return We(this,(i,p)=>{be(i)&&kl.call([i],e.call(i,p,i.attribs.class||""))});const t=ci(e),r=t.length,n=arguments.length===0;return We(this,i=>{if(be(i))if(n)i.attribs.class="";else{const p=ci(i.attribs.class);let O=!1;for(let I=0;I<r;I++){const s=p.indexOf(t[I]);s>=0&&(p.splice(s,1),O=!0,I--)}O&&(i.attribs.class=p.join(" "))}})}function Bl(e,t){if(typeof e=="function")return We(this,(O,I)=>{be(O)&&Bl.call([O],e.call(O,I,O.attribs.class||"",t),t)});if(!e||typeof e!="string")return this;const r=e.split(Ln),n=r.length,i=typeof t=="boolean"?t?1:-1:0,p=this.length;for(let O=0;O<p;O++){const I=this[O];if(!be(I))continue;const s=ci(I.attribs.class);for(let R=0;R<n;R++){const A=s.indexOf(r[R]);i>=0&&A<0?s.push(r[R]):i<=0&&A>=0&&s.splice(A,1)}I.attribs.class=s.join(" ")}return this}const Gg=Object.freeze(Object.defineProperty({__proto__:null,addClass:Fl,attr:Bg,data:Ug,hasClass:Wg,prop:wg,removeAttr:Kg,removeClass:kl,toggleClass:Bl,val:Hg},Symbol.toStringTag,{value:"Module"}));var Ae;(function(e){e.Attribute="attribute",e.Pseudo="pseudo",e.PseudoElement="pseudo-element",e.Tag="tag",e.Universal="universal",e.Adjacent="adjacent",e.Child="child",e.Descendant="descendant",e.Parent="parent",e.Sibling="sibling",e.ColumnCombinator="column-combinator"})(Ae||(Ae={}));var Ve;(function(e){e.Any="any",e.Element="element",e.End="end",e.Equals="equals",e.Exists="exists",e.Hyphen="hyphen",e.Not="not",e.Start="start"})(Ve||(Ve={}));const No=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,Yg=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,Vg=new Map([[126,Ve.Element],[94,Ve.Start],[36,Ve.End],[42,Ve.Any],[33,Ve.Not],[124,Ve.Hyphen]]),jg=new Set(["has","not","matches","is","where","host","host-context"]);function fn(e){switch(e.type){case Ae.Adjacent:case Ae.Child:case Ae.Descendant:case Ae.Parent:case Ae.Sibling:case Ae.ColumnCombinator:return!0;default:return!1}}const Xg=new Set(["contains","icontains"]);function Qg(e,t,r){const n=parseInt(t,16)-65536;return n!==n||r?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)}function tn(e){return e.replace(Yg,Qg)}function rs(e){return e===39||e===34}function Mo(e){return e===32||e===9||e===10||e===12||e===13}function Ni(e){const t=[],r=wl(t,`${e}`,0);if(r<e.length)throw new Error(`Unmatched selector: ${e.slice(r)}`);return t}function wl(e,t,r){let n=[];function i(D){const K=t.slice(r+D).match(No);if(!K)throw new Error(`Expected name, found ${t.slice(r)}`);const[k]=K;return r+=D+k.length,tn(k)}function p(D){for(r+=D;r<t.length&&Mo(t.charCodeAt(r));)r++}function O(){r+=1;const D=r;let K=1;for(;K>0&&r<t.length;r++)t.charCodeAt(r)===40&&!I(r)?K++:t.charCodeAt(r)===41&&!I(r)&&K--;if(K)throw new Error("Parenthesis not matched");return tn(t.slice(D,r-1))}function I(D){let K=0;for(;t.charCodeAt(--D)===92;)K++;return(K&1)===1}function s(){if(n.length>0&&fn(n[n.length-1]))throw new Error("Did not expect successive traversals.")}function R(D){if(n.length>0&&n[n.length-1].type===Ae.Descendant){n[n.length-1].type=D;return}s(),n.push({type:D})}function A(D,K){n.push({type:Ae.Attribute,name:D,action:K,value:i(1),namespace:null,ignoreCase:"quirks"})}function w(){if(n.length&&n[n.length-1].type===Ae.Descendant&&n.pop(),n.length===0)throw new Error("Empty sub-selector");e.push(n)}if(p(0),t.length===r)return r;e:for(;r<t.length;){const D=t.charCodeAt(r);switch(D){case 32:case 9:case 10:case 12:case 13:{(n.length===0||n[0].type!==Ae.Descendant)&&(s(),n.push({type:Ae.Descendant})),p(1);break}case 62:{R(Ae.Child),p(1);break}case 60:{R(Ae.Parent),p(1);break}case 126:{R(Ae.Sibling),p(1);break}case 43:{R(Ae.Adjacent),p(1);break}case 46:{A("class",Ve.Element);break}case 35:{A("id",Ve.Equals);break}case 91:{p(1);let K,k=null;t.charCodeAt(r)===124?K=i(1):t.startsWith("*|",r)?(k="*",K=i(2)):(K=i(0),t.charCodeAt(r)===124&&t.charCodeAt(r+1)!==61&&(k=K,K=i(1))),p(0);let F=Ve.Exists;const B=Vg.get(t.charCodeAt(r));if(B){if(F=B,t.charCodeAt(r+1)!==61)throw new Error("Expected `=`");p(2)}else t.charCodeAt(r)===61&&(F=Ve.Equals,p(1));let P="",N=null;if(F!=="exists"){if(rs(t.charCodeAt(r))){const S=t.charCodeAt(r);let f=r+1;for(;f<t.length&&(t.charCodeAt(f)!==S||I(f));)f+=1;if(t.charCodeAt(f)!==S)throw new Error("Attribute value didn't end");P=tn(t.slice(r+1,f)),r=f+1}else{const S=r;for(;r<t.length&&(!Mo(t.charCodeAt(r))&&t.charCodeAt(r)!==93||I(r));)r+=1;P=tn(t.slice(S,r))}p(0);const M=t.charCodeAt(r)|32;M===115?(N=!1,p(1)):M===105&&(N=!0,p(1))}if(t.charCodeAt(r)!==93)throw new Error("Attribute selector didn't terminate");r+=1;const g={type:Ae.Attribute,name:K,action:F,value:P,namespace:k,ignoreCase:N};n.push(g);break}case 58:{if(t.charCodeAt(r+1)===58){n.push({type:Ae.PseudoElement,name:i(2).toLowerCase(),data:t.charCodeAt(r)===40?O():null});continue}const K=i(1).toLowerCase();let k=null;if(t.charCodeAt(r)===40)if(jg.has(K)){if(rs(t.charCodeAt(r+1)))throw new Error(`Pseudo-selector ${K} cannot be quoted`);if(k=[],r=wl(k,t,r+1),t.charCodeAt(r)!==41)throw new Error(`Missing closing parenthesis in :${K} (${t})`);r+=1}else{if(k=O(),Xg.has(K)){const F=k.charCodeAt(0);F===k.charCodeAt(k.length-1)&&rs(F)&&(k=k.slice(1,-1))}k=tn(k)}n.push({type:Ae.Pseudo,name:K,data:k});break}case 44:{w(),n=[],p(1);break}default:{if(t.startsWith("/*",r)){const F=t.indexOf("*/",r+2);if(F<0)throw new Error("Comment was not terminated");r=F+2,n.length===0&&p(0);break}let K=null,k;if(D===42)r+=1,k="*";else if(D===124){if(k="",t.charCodeAt(r+1)===124){R(Ae.ColumnCombinator),p(2);break}}else if(No.test(t.slice(r)))k=i(0);else break e;t.charCodeAt(r)===124&&t.charCodeAt(r+1)!==124&&(K=k,t.charCodeAt(r+1)===42?(k="*",r+=2):k=i(1)),n.push(k==="*"?{type:Ae.Universal,namespace:K}:{type:Ae.Tag,name:k,namespace:K})}}}return w(),r}var $g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zg(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var xe={trueFunc:function(){return!0},falseFunc:function(){return!1}};const Ul=new Map([[Ae.Universal,50],[Ae.Tag,30],[Ae.Attribute,1],[Ae.Pseudo,0]]);function Ea(e){return!Ul.has(e.type)}const qg=new Map([[Ve.Exists,10],[Ve.Equals,8],[Ve.Not,7],[Ve.Start,6],[Ve.End,6],[Ve.Any,5]]);function Jg(e){const t=e.map(Hl);for(let r=1;r<e.length;r++){const n=t[r];if(!(n<0))for(let i=r-1;i>=0&&n<t[i];i--){const p=e[i+1];e[i+1]=e[i],e[i]=p,t[i+1]=t[i],t[i]=n}}}function Hl(e){var t,r;let n=(t=Ul.get(e.type))!==null&&t!==void 0?t:-1;return e.type===Ae.Attribute?(n=(r=qg.get(e.action))!==null&&r!==void 0?r:4,e.action===Ve.Equals&&e.name==="id"&&(n=9),e.ignoreCase&&(n>>=1)):e.type===Ae.Pseudo&&(e.data?e.name==="has"||e.name==="contains"?n=0:Array.isArray(e.data)?(n=Math.min(...e.data.map(i=>Math.min(...i.map(Hl)))),n<0&&(n=0)):n=2:n=3),n}const Zg=/[-[\]{}()*+?.,\\^$|#\s]/g;function Fo(e){return e.replace(Zg,"\\$&")}const em=new Set(["accept","accept-charset","align","alink","axis","bgcolor","charset","checked","clear","codetype","color","compact","declare","defer","dir","direction","disabled","enctype","face","frame","hreflang","http-equiv","lang","language","link","media","method","multiple","nohref","noresize","noshade","nowrap","readonly","rel","rev","rules","scope","scrolling","selected","shape","target","text","type","valign","valuetype","vlink"]);function lr(e,t){return typeof e.ignoreCase=="boolean"?e.ignoreCase:e.ignoreCase==="quirks"?!!t.quirksMode:!t.xmlMode&&em.has(e.name)}const tm={equals(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:p}=t;return lr(t,r)?(p=p.toLowerCase(),O=>{const I=n.getAttributeValue(O,i);return I!=null&&I.length===p.length&&I.toLowerCase()===p&&e(O)}):O=>n.getAttributeValue(O,i)===p&&e(O)},hyphen(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:p}=t;const O=p.length;return lr(t,r)?(p=p.toLowerCase(),function(s){const R=n.getAttributeValue(s,i);return R!=null&&(R.length===O||R.charAt(O)==="-")&&R.substr(0,O).toLowerCase()===p&&e(s)}):function(s){const R=n.getAttributeValue(s,i);return R!=null&&(R.length===O||R.charAt(O)==="-")&&R.substr(0,O)===p&&e(s)}},element(e,t,r){const{adapter:n}=r,{name:i,value:p}=t;if(/\s/.test(p))return xe.falseFunc;const O=new RegExp(`(?:^|\\s)${Fo(p)}(?:$|\\s)`,lr(t,r)?"i":"");return function(s){const R=n.getAttributeValue(s,i);return R!=null&&R.length>=p.length&&O.test(R)&&e(s)}},exists(e,{name:t},{adapter:r}){return n=>r.hasAttrib(n,t)&&e(n)},start(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:p}=t;const O=p.length;return O===0?xe.falseFunc:lr(t,r)?(p=p.toLowerCase(),I=>{const s=n.getAttributeValue(I,i);return s!=null&&s.length>=O&&s.substr(0,O).toLowerCase()===p&&e(I)}):I=>{var s;return!!(!((s=n.getAttributeValue(I,i))===null||s===void 0)&&s.startsWith(p))&&e(I)}},end(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:p}=t;const O=-p.length;return O===0?xe.falseFunc:lr(t,r)?(p=p.toLowerCase(),I=>{var s;return((s=n.getAttributeValue(I,i))===null||s===void 0?void 0:s.substr(O).toLowerCase())===p&&e(I)}):I=>{var s;return!!(!((s=n.getAttributeValue(I,i))===null||s===void 0)&&s.endsWith(p))&&e(I)}},any(e,t,r){const{adapter:n}=r,{name:i,value:p}=t;if(p==="")return xe.falseFunc;if(lr(t,r)){const O=new RegExp(Fo(p),"i");return function(s){const R=n.getAttributeValue(s,i);return R!=null&&R.length>=p.length&&O.test(R)&&e(s)}}return O=>{var I;return!!(!((I=n.getAttributeValue(O,i))===null||I===void 0)&&I.includes(p))&&e(O)}},not(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:p}=t;return p===""?O=>!!n.getAttributeValue(O,i)&&e(O):lr(t,r)?(p=p.toLowerCase(),O=>{const I=n.getAttributeValue(O,i);return(I==null||I.length!==p.length||I.toLowerCase()!==p)&&e(O)}):O=>n.getAttributeValue(O,i)!==p&&e(O)}},rm=new Set([9,10,12,13,32]),ko="0".charCodeAt(0),nm="9".charCodeAt(0);function im(e){if(e=e.trim().toLowerCase(),e==="even")return[2,0];if(e==="odd")return[2,1];let t=0,r=0,n=p(),i=O();if(t<e.length&&e.charAt(t)==="n"&&(t++,r=n*(i??1),I(),t<e.length?(n=p(),I(),i=O()):n=i=0),i===null||t<e.length)throw new Error(`n-th rule couldn't be parsed ('${e}')`);return[r,n*i];function p(){return e.charAt(t)==="-"?(t++,-1):(e.charAt(t)==="+"&&t++,1)}function O(){const s=t;let R=0;for(;t<e.length&&e.charCodeAt(t)>=ko&&e.charCodeAt(t)<=nm;)R=R*10+(e.charCodeAt(t)-ko),t++;return t===s?null:R}function I(){for(;t<e.length&&rm.has(e.charCodeAt(t));)t++}}function sm(e){const t=e[0],r=e[1]-1;if(r<0&&t<=0)return xe.falseFunc;if(t===-1)return p=>p<=r;if(t===0)return p=>p===r;if(t===1)return r<0?xe.trueFunc:p=>p>=r;const n=Math.abs(t),i=(r%n+n)%n;return t>1?p=>p>=r&&p%n===i:p=>p<=r&&p%n===i}function Wn(e){return sm(im(e))}function Gn(e,t){return r=>{const n=t.getParent(r);return n!=null&&t.isTag(n)&&e(r)}}const Ds={contains(e,t,{adapter:r}){return function(i){return e(i)&&r.getText(i).includes(t)}},icontains(e,t,{adapter:r}){const n=t.toLowerCase();return function(p){return e(p)&&r.getText(p).toLowerCase().includes(n)}},"nth-child"(e,t,{adapter:r,equals:n}){const i=Wn(t);return i===xe.falseFunc?xe.falseFunc:i===xe.trueFunc?Gn(e,r):function(O){const I=r.getSiblings(O);let s=0;for(let R=0;R<I.length&&!n(O,I[R]);R++)r.isTag(I[R])&&s++;return i(s)&&e(O)}},"nth-last-child"(e,t,{adapter:r,equals:n}){const i=Wn(t);return i===xe.falseFunc?xe.falseFunc:i===xe.trueFunc?Gn(e,r):function(O){const I=r.getSiblings(O);let s=0;for(let R=I.length-1;R>=0&&!n(O,I[R]);R--)r.isTag(I[R])&&s++;return i(s)&&e(O)}},"nth-of-type"(e,t,{adapter:r,equals:n}){const i=Wn(t);return i===xe.falseFunc?xe.falseFunc:i===xe.trueFunc?Gn(e,r):function(O){const I=r.getSiblings(O);let s=0;for(let R=0;R<I.length;R++){const A=I[R];if(n(O,A))break;r.isTag(A)&&r.getName(A)===r.getName(O)&&s++}return i(s)&&e(O)}},"nth-last-of-type"(e,t,{adapter:r,equals:n}){const i=Wn(t);return i===xe.falseFunc?xe.falseFunc:i===xe.trueFunc?Gn(e,r):function(O){const I=r.getSiblings(O);let s=0;for(let R=I.length-1;R>=0;R--){const A=I[R];if(n(O,A))break;r.isTag(A)&&r.getName(A)===r.getName(O)&&s++}return i(s)&&e(O)}},root(e,t,{adapter:r}){return n=>{const i=r.getParent(n);return(i==null||!r.isTag(i))&&e(n)}},scope(e,t,r,n){const{equals:i}=r;return!n||n.length===0?Ds.root(e,t,r):n.length===1?p=>i(n[0],p)&&e(p):p=>n.includes(p)&&e(p)},hover:ns("isHovered"),visited:ns("isVisited"),active:ns("isActive")};function ns(e){return function(r,n,{adapter:i}){const p=i[e];return typeof p!="function"?xe.falseFunc:function(I){return p(I)&&r(I)}}}const Bo={empty(e,{adapter:t}){return!t.getChildren(e).some(r=>t.isTag(r)||t.getText(r)!=="")},"first-child"(e,{adapter:t,equals:r}){if(t.prevElementSibling)return t.prevElementSibling(e)==null;const n=t.getSiblings(e).find(i=>t.isTag(i));return n!=null&&r(e,n)},"last-child"(e,{adapter:t,equals:r}){const n=t.getSiblings(e);for(let i=n.length-1;i>=0;i--){if(r(e,n[i]))return!0;if(t.isTag(n[i]))break}return!1},"first-of-type"(e,{adapter:t,equals:r}){const n=t.getSiblings(e),i=t.getName(e);for(let p=0;p<n.length;p++){const O=n[p];if(r(e,O))return!0;if(t.isTag(O)&&t.getName(O)===i)break}return!1},"last-of-type"(e,{adapter:t,equals:r}){const n=t.getSiblings(e),i=t.getName(e);for(let p=n.length-1;p>=0;p--){const O=n[p];if(r(e,O))return!0;if(t.isTag(O)&&t.getName(O)===i)break}return!1},"only-of-type"(e,{adapter:t,equals:r}){const n=t.getName(e);return t.getSiblings(e).every(i=>r(e,i)||!t.isTag(i)||t.getName(i)!==n)},"only-child"(e,{adapter:t,equals:r}){return t.getSiblings(e).every(n=>r(e,n)||!t.isTag(n))}};function wo(e,t,r,n){if(r===null){if(e.length>n)throw new Error(`Pseudo-class :${t} requires an argument`)}else if(e.length===n)throw new Error(`Pseudo-class :${t} doesn't have any arguments`)}const am={"any-link":":is(a, area, link)[href]",link:":any-link:not(:visited)",disabled:`:is(
        :is(button, input, select, textarea, optgroup, option)[disabled],
        optgroup[disabled] > option,
        fieldset[disabled]:not(fieldset[disabled] legend:first-of-type *)
    )`,enabled:":not(:disabled)",checked:":is(:is(input[type=radio], input[type=checkbox])[checked], option:selected)",required:":is(input, select, textarea)[required]",optional:":is(input, select, textarea):not([required])",selected:"option:is([selected], select:not([multiple]):not(:has(> option[selected])) > :first-of-type)",checkbox:"[type=checkbox]",file:"[type=file]",password:"[type=password]",radio:"[type=radio]",reset:"[type=reset]",image:"[type=image]",submit:"[type=submit]",parent:":not(:empty)",header:":is(h1, h2, h3, h4, h5, h6)",button:":is(button, input[type=button])",input:":is(input, textarea, select, button)",text:"input:is(:not([type!='']), [type=text])"},Kl={};function om(e,t){return e===xe.falseFunc?xe.falseFunc:r=>t.isTag(r)&&e(r)}function Wl(e,t){const r=t.getSiblings(e);if(r.length<=1)return[];const n=r.indexOf(e);return n<0||n===r.length-1?[]:r.slice(n+1).filter(t.isTag)}function Rs(e){return{xmlMode:!!e.xmlMode,lowerCaseAttributeNames:!!e.lowerCaseAttributeNames,lowerCaseTags:!!e.lowerCaseTags,quirksMode:!!e.quirksMode,cacheResults:!!e.cacheResults,pseudos:e.pseudos,adapter:e.adapter,equals:e.equals}}const is=(e,t,r,n,i)=>{const p=i(t,Rs(r),n);return p===xe.trueFunc?e:p===xe.falseFunc?xe.falseFunc:O=>p(O)&&e(O)},ss={is,matches:is,where:is,not(e,t,r,n,i){const p=i(t,Rs(r),n);return p===xe.falseFunc?e:p===xe.trueFunc?xe.falseFunc:O=>!p(O)&&e(O)},has(e,t,r,n,i){const{adapter:p}=r,O=Rs(r);O.relativeSelector=!0;const I=t.some(A=>A.some(Ea))?[Kl]:void 0,s=i(t,O,I);if(s===xe.falseFunc)return xe.falseFunc;const R=om(s,p);if(I&&s!==xe.trueFunc){const{shouldTestNextSiblings:A=!1}=s;return w=>{if(!e(w))return!1;I[0]=w;const D=p.getChildren(w),K=A?[...D,...Wl(w,p)]:D;return p.existsOne(R,K)}}return A=>e(A)&&p.existsOne(R,p.getChildren(A))}};function um(e,t,r,n,i){var p;const{name:O,data:I}=t;if(Array.isArray(I)){if(!(O in ss))throw new Error(`Unknown pseudo-class :${O}(${I})`);return ss[O](e,I,r,n,i)}const s=(p=r.pseudos)===null||p===void 0?void 0:p[O],R=typeof s=="string"?s:am[O];if(typeof R=="string"){if(I!=null)throw new Error(`Pseudo ${O} doesn't have any arguments`);const A=Ni(R);return ss.is(e,A,r,n,i)}if(typeof s=="function")return wo(s,O,I,1),A=>s(A,I)&&e(A);if(O in Ds)return Ds[O](e,I,r,n);if(O in Bo){const A=Bo[O];return wo(A,O,I,2),w=>A(w,r,I)&&e(w)}throw new Error(`Unknown pseudo-class :${O}`)}function as(e,t){const r=t.getParent(e);return r&&t.isTag(r)?r:null}function lm(e,t,r,n,i){const{adapter:p,equals:O}=r;switch(t.type){case Ae.PseudoElement:throw new Error("Pseudo-elements are not supported by css-select");case Ae.ColumnCombinator:throw new Error("Column combinators are not yet supported by css-select");case Ae.Attribute:{if(t.namespace!=null)throw new Error("Namespaced attributes are not yet supported by css-select");return(!r.xmlMode||r.lowerCaseAttributeNames)&&(t.name=t.name.toLowerCase()),tm[t.action](e,t,r)}case Ae.Pseudo:return um(e,t,r,n,i);case Ae.Tag:{if(t.namespace!=null)throw new Error("Namespaced tag names are not yet supported by css-select");let{name:I}=t;return(!r.xmlMode||r.lowerCaseTags)&&(I=I.toLowerCase()),function(R){return p.getName(R)===I&&e(R)}}case Ae.Descendant:{if(r.cacheResults===!1||typeof WeakSet>"u")return function(R){let A=R;for(;A=as(A,p);)if(e(A))return!0;return!1};const I=new WeakSet;return function(R){let A=R;for(;A=as(A,p);)if(!I.has(A)){if(p.isTag(A)&&e(A))return!0;I.add(A)}return!1}}case"_flexibleDescendant":return function(s){let R=s;do if(e(R))return!0;while(R=as(R,p));return!1};case Ae.Parent:return function(s){return p.getChildren(s).some(R=>p.isTag(R)&&e(R))};case Ae.Child:return function(s){const R=p.getParent(s);return R!=null&&p.isTag(R)&&e(R)};case Ae.Sibling:return function(s){const R=p.getSiblings(s);for(let A=0;A<R.length;A++){const w=R[A];if(O(s,w))break;if(p.isTag(w)&&e(w))return!0}return!1};case Ae.Adjacent:return p.prevElementSibling?function(s){const R=p.prevElementSibling(s);return R!=null&&e(R)}:function(s){const R=p.getSiblings(s);let A;for(let w=0;w<R.length;w++){const D=R[w];if(O(s,D))break;p.isTag(D)&&(A=D)}return!!A&&e(A)};case Ae.Universal:{if(t.namespace!=null&&t.namespace!=="*")throw new Error("Namespaced universal selectors are not yet supported by css-select");return e}}}function Gl(e){return e.type===Ae.Pseudo&&(e.name==="scope"||Array.isArray(e.data)&&e.data.some(t=>t.some(Gl)))}const cm={type:Ae.Descendant},fm={type:"_flexibleDescendant"},dm={type:Ae.Pseudo,name:"scope",data:null};function hm(e,{adapter:t},r){const n=!!(r!=null&&r.every(i=>{const p=t.isTag(i)&&t.getParent(i);return i===Kl||p&&t.isTag(p)}));for(const i of e){if(!(i.length>0&&Ea(i[0])&&i[0].type!==Ae.Descendant))if(n&&!i.some(Gl))i.unshift(cm);else continue;i.unshift(dm)}}function Yl(e,t,r){var n;e.forEach(Jg),r=(n=t.context)!==null&&n!==void 0?n:r;const i=Array.isArray(r),p=r&&(Array.isArray(r)?r:[r]);if(t.relativeSelector!==!1)hm(e,t,p);else if(e.some(s=>s.length>0&&Ea(s[0])))throw new Error("Relative selectors are not allowed when the `relativeSelector` option is disabled");let O=!1;const I=e.map(s=>{if(s.length>=2){const[R,A]=s;R.type!==Ae.Pseudo||R.name!=="scope"||(i&&A.type===Ae.Descendant?s[1]=fm:(A.type===Ae.Adjacent||A.type===Ae.Sibling)&&(O=!0))}return gm(s,t,p)}).reduce(mm,xe.falseFunc);return I.shouldTestNextSiblings=O,I}function gm(e,t,r){var n;return e.reduce((i,p)=>i===xe.falseFunc?xe.falseFunc:lm(i,p,t,r,Yl),(n=t.rootFunc)!==null&&n!==void 0?n:xe.trueFunc)}function mm(e,t){return t===xe.falseFunc||e===xe.trueFunc?e:e===xe.falseFunc||t===xe.trueFunc?t:function(n){return e(n)||t(n)}}const Vl=(e,t)=>e===t,Em={adapter:Pi,equals:Vl};function vm(e){var t,r,n,i;const p=e??Em;return(t=p.adapter)!==null&&t!==void 0||(p.adapter=Pi),(r=p.equals)!==null&&r!==void 0||(p.equals=(i=(n=p.adapter)===null||n===void 0?void 0:n.equals)!==null&&i!==void 0?i:Vl),p}function pm(e){return function(r,n,i){const p=vm(n);return e(r,p,i)}}const va=pm(Yl);function jl(e,t,r=!1){return r&&(e=Tm(e,t)),Array.isArray(e)?t.removeSubsets(e):t.getChildren(e)}function Tm(e,t){const r=Array.isArray(e)?e.slice(0):[e],n=r.length;for(let i=0;i<n;i++){const p=Wl(r[i],t);r.push(...p)}return r}const _m=new Set(["first","last","eq","gt","nth","lt","even","odd"]);function fi(e){return e.type!=="pseudo"?!1:_m.has(e.name)?!0:e.name==="not"&&Array.isArray(e.data)?e.data.some(t=>t.some(fi)):!1}function Am(e,t,r){const n=t!=null?parseInt(t,10):NaN;switch(e){case"first":return 1;case"nth":case"eq":return isFinite(n)?n>=0?n+1:1/0:0;case"lt":return isFinite(n)?n>=0?Math.min(n,r):1/0:0;case"gt":return isFinite(n)?1/0:0;case"odd":return 2*r;case"even":return 2*r-1;case"last":case"not":return 1/0}}function ym(e){for(;e.parent;)e=e.parent;return e}function pa(e){const t=[],r=[];for(const n of e)n.some(fi)?t.push(n):r.push(n);return[r,t]}const bm={type:Ae.Universal,namespace:null},Sm={type:Ae.Pseudo,name:"scope",data:null};function Xl(e,t,r={}){return Ql([e],t,r)}function Ql(e,t,r={}){if(typeof t=="function")return e.some(t);const[n,i]=pa(Ni(t));return n.length>0&&e.some(va(n,r))||i.some(p=>ql(p,e,r).length>0)}function xm(e,t,r,n){const i=typeof r=="string"?parseInt(r,10):NaN;switch(e){case"first":case"lt":return t;case"last":return t.length>0?[t[t.length-1]]:t;case"nth":case"eq":return isFinite(i)&&Math.abs(i)<t.length?[i<0?t[t.length+i]:t[i]]:[];case"gt":return isFinite(i)?t.slice(i+1):[];case"even":return t.filter((p,O)=>O%2===0);case"odd":return t.filter((p,O)=>O%2===1);case"not":{const p=new Set(zl(r,t,n));return t.filter(O=>!p.has(O))}}}function $l(e,t,r={}){return zl(Ni(e),t,r)}function zl(e,t,r){if(t.length===0)return[];const[n,i]=pa(e);let p;if(n.length){const O=Ps(t,n,r);if(i.length===0)return O;O.length&&(p=new Set(O))}for(let O=0;O<i.length&&(p==null?void 0:p.size)!==t.length;O++){const I=i[O];if((p?t.filter(A=>be(A)&&!p.has(A)):t).length===0)break;const R=ql(I,t,r);if(R.length)if(p)R.forEach(A=>p.add(A));else{if(O===i.length-1)return R;p=new Set(R)}}return typeof p<"u"?p.size===t.length?t:t.filter(O=>p.has(O)):[]}function ql(e,t,r){var n;if(e.some(fn)){const i=(n=r.root)!==null&&n!==void 0?n:ym(t[0]),p={...r,context:t,relativeSelector:!1};return e.push(Sm),di(i,e,p,!0,t.length)}return di(t,e,r,!1,t.length)}function Im(e,t,r={},n=1/0){if(typeof e=="function")return Jl(t,e);const[i,p]=pa(Ni(e)),O=p.map(I=>di(t,I,r,!0,n));return i.length&&O.push(Os(t,i,r,n)),O.length===0?[]:O.length===1?O[0]:qr(O.reduce((I,s)=>[...I,...s]))}function di(e,t,r,n,i){const p=t.findIndex(fi),O=t.slice(0,p),I=t[p],s=t.length-1===p?i:1/0,R=Am(I.name,I.data,s);if(R===0)return[];const w=(O.length===0&&!Array.isArray(e)?Di(e).filter(be):O.length===0?(Array.isArray(e)?e:[e]).filter(be):n||O.some(fn)?Os(e,[O],r,R):Ps(e,[O],r)).slice(0,R);let D=xm(I.name,w,I.data,r);if(D.length===0||t.length===p+1)return D;const K=t.slice(p+1),k=K.some(fn);if(k){if(fn(K[0])){const{type:F}=K[0];(F===Ae.Sibling||F===Ae.Adjacent)&&(D=jl(D,Pi,!0)),K.unshift(bm)}r={...r,relativeSelector:!1,rootFunc:F=>D.includes(F)}}else r.rootFunc&&r.rootFunc!==xe.trueFunc&&(r={...r,rootFunc:xe.trueFunc});return K.some(fi)?di(D,K,r,!1,i):k?Os(D,[K],r,i):Ps(D,[K],r)}function Os(e,t,r,n){const i=va(t,r,e);return Jl(e,i,n)}function Jl(e,t,r=1/0){const n=jl(e,Pi,t.shouldTestNextSiblings);return Oi(i=>be(i)&&t(i),n,!0,r)}function Ps(e,t,r){const n=(Array.isArray(e)?e:[e]).filter(be);if(n.length===0)return n;const i=va(t,r);return i===xe.trueFunc?n:n.filter(i)}const Cm=/^\s*[~+]/;function Lm(e){var t;if(!e)return this._make([]);const r=this.toArray();if(typeof e!="string"){const p=Ut(e)?e.toArray():[e];return this._make(p.filter(O=>r.some(I=>Nl(I,O))))}const n=Cm.test(e)?r:this.children().toArray(),i={context:r,root:(t=this._root)===null||t===void 0?void 0:t[0],xmlMode:this.options.xmlMode,lowerCaseTags:this.options.lowerCaseTags,lowerCaseAttributeNames:this.options.lowerCaseAttributeNames,pseudos:this.options.pseudos,quirksMode:this.options.quirksMode};return this._make(Im(e,n,i))}function Ta(e){return function(t,...r){return function(n){var i;let p=e(t,this);return n&&(p=ya(p,n,this.options.xmlMode,(i=this._root)===null||i===void 0?void 0:i[0])),this._make(this.length>1&&p.length>1?r.reduce((O,I)=>I(O),p):p)}}}const Rn=Ta((e,t)=>{const r=[];for(let n=0;n<t.length;n++){const i=e(t[n]);r.push(i)}return new Array().concat(...r)}),_a=Ta((e,t)=>{const r=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i!==null&&r.push(i)}return r});function Aa(e,...t){let r=null;const n=Ta((i,p)=>{const O=[];return We(p,I=>{for(let s;(s=i(I))&&!(r!=null&&r(s,O.length));I=s)O.push(s)}),O})(e,...t);return function(i,p){r=typeof i=="string"?I=>Xl(I,i,this.options):i?On(i):null;const O=n.call(this,p);return r=null,O}}function Jr(e){return Array.from(new Set(e))}const Dm=_a(({parent:e})=>e&&!Sr(e)?e:null,Jr),Rm=Rn(e=>{const t=[];for(;e.parent&&!Sr(e.parent);)t.push(e.parent),e=e.parent;return t},qr,e=>e.reverse()),Om=Aa(({parent:e})=>e&&!Sr(e)?e:null,qr,e=>e.reverse());function Pm(e){var t;const r=[];if(!e)return this._make(r);const n={xmlMode:this.options.xmlMode,root:(t=this._root)===null||t===void 0?void 0:t[0]},i=typeof e=="string"?p=>Xl(p,e,n):On(e);return We(this,p=>{for(;p&&be(p);){if(i(p,0)){r.includes(p)||r.push(p);break}p=p.parent}}),this._make(r)}const Nm=_a(e=>da(e)),Mm=Rn(e=>{const t=[];for(;e.next;)e=e.next,be(e)&&t.push(e);return t},Jr),Fm=Aa(e=>da(e),Jr),km=_a(e=>ha(e)),Bm=Rn(e=>{const t=[];for(;e.prev;)e=e.prev,be(e)&&t.push(e);return t},Jr),wm=Aa(e=>ha(e),Jr),Um=Rn(e=>Il(e).filter(t=>be(t)&&t!==e),qr),Hm=Rn(e=>Di(e).filter(be),Jr);function Km(){const e=this.toArray().reduce((t,r)=>Qe(r)?t.concat(r.children):t,[]);return this._make(e)}function Wm(e){let t=0;const r=this.length;for(;t<r&&e.call(this[t],t,this[t])!==!1;)++t;return this}function Gm(e){let t=[];for(let r=0;r<this.length;r++){const n=this[r],i=e.call(n,r,n);i!=null&&(t=t.concat(i))}return this._make(t)}function On(e){return typeof e=="function"?(t,r)=>e.call(t,r,t):Ut(e)?t=>Array.prototype.includes.call(e,t):function(t){return e===t}}function Ym(e){var t;return this._make(ya(this.toArray(),e,this.options.xmlMode,(t=this._root)===null||t===void 0?void 0:t[0]))}function ya(e,t,r,n){return typeof t=="string"?$l(t,e,{xmlMode:r,root:n}):e.filter(On(t))}function Vm(e){const t=this.toArray();return typeof e=="string"?Ql(t.filter(be),e,this.options):e?t.some(On(e)):!1}function jm(e){let t=this.toArray();if(typeof e=="string"){const r=new Set($l(e,t,this.options));t=t.filter(n=>!r.has(n))}else{const r=On(e);t=t.filter((n,i)=>!r(n,i))}return this._make(t)}function Xm(e){return this.filter(typeof e=="string"?`:has(${e})`:(t,r)=>this._make(r).find(e).length>0)}function Qm(){return this.length>1?this._make(this[0]):this}function $m(){return this.length>0?this._make(this[this.length-1]):this}function zm(e){var t;return e=+e,e===0&&this.length<=1?this:(e<0&&(e=this.length+e),this._make((t=this[e])!==null&&t!==void 0?t:[]))}function qm(e){return e==null?this.toArray():this[e<0?this.length+e:e]}function Jm(){return Array.prototype.slice.call(this)}function Zm(e){let t,r;return e==null?(t=this.parent().children(),r=this[0]):typeof e=="string"?(t=this._make(e),r=this[0]):(t=this,r=Ut(e)?e[0]:e),Array.prototype.indexOf.call(t,r)}function eE(e,t){return this._make(Array.prototype.slice.call(this,e,t))}function tE(){var e;return(e=this.prevObject)!==null&&e!==void 0?e:this._make([])}function rE(e,t){const r=this._make(e,t),n=qr([...this.get(),...r.get()]);return this._make(n)}function nE(e){return this.prevObject?this.add(e?this.prevObject.filter(e):this.prevObject):this}const iE=Object.freeze(Object.defineProperty({__proto__:null,add:rE,addBack:nE,children:Hm,closest:Pm,contents:Km,each:Wm,end:tE,eq:zm,filter:Ym,filterArray:ya,find:Lm,first:Qm,get:qm,has:Xm,index:Zm,is:Vm,last:$m,map:Gm,next:Nm,nextAll:Mm,nextUntil:Fm,not:jm,parent:Dm,parents:Rm,parentsUntil:Om,prev:km,prevAll:Bm,prevUntil:wm,siblings:Um,slice:eE,toArray:Jm},Symbol.toStringTag,{value:"Module"}));function sE(e){return function(r,n,i,p){if(typeof Buffer<"u"&&Buffer.isBuffer(r)&&(r=r.toString()),typeof r=="string")return e(r,n,i,p);const O=r;if(!Array.isArray(O)&&Sr(O))return O;const I=new _r([]);return Ar(O,I),I}}function Ar(e,t){const r=Array.isArray(e)?e:[e];t?t.children=r:t=null;for(let n=0;n<r.length;n++){const i=r[n];i.parent&&i.parent.children!==r&&xr(i),t?(i.prev=r[n-1]||null,i.next=r[n+1]||null):i.prev=i.next=null,i.parent=t}return t}function aE(e,t){return e==null?[]:Ut(e)?t?Cs(e.get()):e.get():Array.isArray(e)?e.reduce((r,n)=>r.concat(this._makeDomArray(n,t)),[]):typeof e=="string"?this._parse(e,this.options,!1,null).children:t?Cs([e]):[e]}function Zl(e){return function(...t){const r=this.length-1;return We(this,(n,i)=>{if(!Qe(n))return;const p=typeof t[0]=="function"?t[0].call(n,i,this._render(n.children)):t,O=this._makeDomArray(p,i<r);e(O,n.children,n)})}}function sr(e,t,r,n,i){var p,O;const I=[t,r,...n],s=t===0?null:e[t-1],R=t+r>=e.length?null:e[t+r];for(let A=0;A<n.length;++A){const w=n[A],D=w.parent;if(D){const k=D.children.indexOf(w);k>-1&&(D.children.splice(k,1),i===D&&t>k&&I[0]--)}w.parent=i,w.prev&&(w.prev.next=(p=w.next)!==null&&p!==void 0?p:null),w.next&&(w.next.prev=(O=w.prev)!==null&&O!==void 0?O:null),w.prev=A===0?s:n[A-1],w.next=A===n.length-1?R:n[A+1]}return s&&(s.next=n[0]),R&&(R.prev=n[n.length-1]),e.splice(...I)}function oE(e){return(Ut(e)?e:this._make(e)).append(this),this}function uE(e){return(Ut(e)?e:this._make(e)).prepend(this),this}const lE=Zl((e,t,r)=>{sr(t,t.length,0,e,r)}),cE=Zl((e,t,r)=>{sr(t,0,0,e,r)});function ec(e){return function(t){const r=this.length-1,n=this.parents().last();for(let i=0;i<this.length;i++){const p=this[i],O=typeof t=="function"?t.call(p,i,p):typeof t=="string"&&!Ls(t)?n.find(t).clone():t,[I]=this._makeDomArray(O,i<r);if(!I||!Qe(I))continue;let s=I,R=0;for(;R<s.children.length;){const A=s.children[R];be(A)?(s=A,R=0):R++}e(p,s,[I])}return this}}const fE=ec((e,t,r)=>{const{parent:n}=e;if(!n)return;const i=n.children,p=i.indexOf(e);Ar([e],t),sr(i,p,0,r,n)}),dE=ec((e,t,r)=>{Qe(e)&&(Ar(e.children,t),Ar(r,e))});function hE(e){return this.parent(e).not("body").each((t,r)=>{this._make(r).replaceWith(r.children)}),this}function gE(e){const t=this[0];if(t){const r=this._make(typeof e=="function"?e.call(t,0,t):e).insertBefore(t);let n;for(let p=0;p<r.length;p++)r[p].type==="tag"&&(n=r[p]);let i=0;for(;n&&i<n.children.length;){const p=n.children[i];p.type==="tag"?(n=p,i=0):i++}n&&this._make(n).append(this)}return this}function mE(...e){const t=this.length-1;return We(this,(r,n)=>{const{parent:i}=r;if(!Qe(r)||!i)return;const p=i.children,O=p.indexOf(r);if(O<0)return;const I=typeof e[0]=="function"?e[0].call(r,n,this._render(r.children)):e,s=this._makeDomArray(I,n<t);sr(p,O+1,0,s,i)})}function EE(e){typeof e=="string"&&(e=this._make(e)),this.remove();const t=[];return this._makeDomArray(e).forEach(r=>{const n=this.clone().toArray(),{parent:i}=r;if(!i)return;const p=i.children,O=p.indexOf(r);O<0||(sr(p,O+1,0,n,i),t.push(...n))}),this._make(t)}function vE(...e){const t=this.length-1;return We(this,(r,n)=>{const{parent:i}=r;if(!Qe(r)||!i)return;const p=i.children,O=p.indexOf(r);if(O<0)return;const I=typeof e[0]=="function"?e[0].call(r,n,this._render(r.children)):e,s=this._makeDomArray(I,n<t);sr(p,O,0,s,i)})}function pE(e){const t=this._make(e);this.remove();const r=[];return We(t,n=>{const i=this.clone().toArray(),{parent:p}=n;if(!p)return;const O=p.children,I=O.indexOf(n);I<0||(sr(O,I,0,i,p),r.push(...i))}),this._make(r)}function TE(e){const t=e?this.filter(e):this;return We(t,r=>{xr(r),r.prev=r.next=r.parent=null}),this}function _E(e){return We(this,(t,r)=>{const{parent:n}=t;if(!n)return;const i=n.children,p=typeof e=="function"?e.call(t,r,t):e,O=this._makeDomArray(p);Ar(O,null);const I=i.indexOf(t);sr(i,I,1,O,n),O.includes(t)||(t.parent=t.prev=t.next=null)})}function AE(){return We(this,e=>{Qe(e)&&(e.children.forEach(t=>{t.next=t.prev=t.parent=null}),e.children.length=0)})}function yE(e){if(e===void 0){const t=this[0];return!t||!Qe(t)?null:this._render(t.children)}return We(this,t=>{if(!Qe(t))return;t.children.forEach(n=>{n.next=n.prev=n.parent=null});const r=Ut(e)?e.toArray():this._parse(`${e}`,this.options,!1,t).children;Ar(r,t)})}function bE(){return this._render(this)}function SE(e){return e===void 0?Cn(this):typeof e=="function"?We(this,(t,r)=>this._make(t).text(e.call(t,r,Cn([t])))):We(this,t=>{if(!Qe(t))return;t.children.forEach(n=>{n.next=n.prev=n.parent=null});const r=new In(`${e}`);Ar(r,t)})}function xE(){return this._make(Cs(this.get()))}const IE=Object.freeze(Object.defineProperty({__proto__:null,_makeDomArray:aE,after:mE,append:lE,appendTo:oE,before:vE,clone:xE,empty:AE,html:yE,insertAfter:EE,insertBefore:pE,prepend:cE,prependTo:uE,remove:TE,replaceWith:_E,text:SE,toString:bE,unwrap:hE,wrap:fE,wrapAll:gE,wrapInner:dE},Symbol.toStringTag,{value:"Module"}));function CE(e,t){if(e!=null&&t!=null||typeof e=="object"&&!Array.isArray(e))return We(this,(r,n)=>{be(r)&&tc(r,e,t,n)});if(this.length!==0)return rc(this[0],e)}function tc(e,t,r,n){if(typeof t=="string"){const i=rc(e),p=typeof r=="function"?r.call(e,n,i[t]):r;p===""?delete i[t]:p!=null&&(i[t]=p),e.attribs.style=LE(i)}else typeof t=="object"&&Object.keys(t).forEach((i,p)=>{tc(e,i,t[i],p)})}function rc(e,t){if(!e||!be(e))return;const r=DE(e.attribs.style);if(typeof t=="string")return r[t];if(Array.isArray(t)){const n={};return t.forEach(i=>{r[i]!=null&&(n[i]=r[i])}),n}return r}function LE(e){return Object.keys(e).reduce((t,r)=>`${t}${t?" ":""}${r}: ${e[r]};`,"")}function DE(e){if(e=(e||"").trim(),!e)return{};const t={};let r;for(const n of e.split(";")){const i=n.indexOf(":");if(i<1||i===n.length-1){const p=n.trimEnd();p.length>0&&r!==void 0&&(t[r]+=`;${p}`)}else r=n.slice(0,i).trim(),t[r]=n.slice(i+1).trim()}return t}const RE=Object.freeze(Object.defineProperty({__proto__:null,css:CE},Symbol.toStringTag,{value:"Module"})),Uo="input,select,textarea,keygen",OE=/%20/g,Ho=/\r?\n/g;function PE(){return this.serializeArray().map(r=>`${encodeURIComponent(r.name)}=${encodeURIComponent(r.value)}`).join("&").replace(OE,"+")}function NE(){return this.map((e,t)=>{const r=this._make(t);return be(t)&&t.name==="form"?r.find(Uo).toArray():r.filter(Uo).toArray()}).filter('[name!=""]:enabled:not(:submit, :button, :image, :reset, :file):matches([checked], :not(:checkbox, :radio))').map((e,t)=>{var r;const n=this._make(t),i=n.attr("name"),p=(r=n.val())!==null&&r!==void 0?r:"";return Array.isArray(p)?p.map(O=>({name:i,value:O.replace(Ho,`\r
`)})):{name:i,value:p.replace(Ho,`\r
`)}}).toArray()}const ME=Object.freeze(Object.defineProperty({__proto__:null,serialize:PE,serializeArray:NE},Symbol.toStringTag,{value:"Module"}));class Pn{constructor(t,r,n){if(this.length=0,this.options=n,this._root=r,t){for(let i=0;i<t.length;i++)this[i]=t[i];this.length=t.length}}}Pn.prototype.cheerio="[cheerio object]";Pn.prototype.splice=Array.prototype.splice;Pn.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator];Object.assign(Pn.prototype,Gg,iE,IE,RE,ME);function FE(e,t){return function r(n,i,p=!0){if(n==null)throw new Error("cheerio.load() expects a string");const O={...aa,...xs(i)},I=e(n,O,p,null);class s extends Pn{_make(w,D){const K=R(w,D);return K.prevObject=this,K}_parse(w,D,K,k){return e(w,D,K,k)}_render(w){return t(w,this.options)}}function R(A,w,D=I,K){if(A&&Ut(A))return A;const k={...O,...xs(K)},F=typeof D=="string"?[e(D,k,!1,null)]:"length"in D?D:[D],B=Ut(F)?F:new s(F,null,k);if(B._root=B,!A)return new s(void 0,B,k);const P=typeof A=="string"&&Ls(A)?e(A,k,!1,null).children:kE(A)?[A]:Array.isArray(A)?A:void 0,N=new s(P,B,k);if(P)return N;if(typeof A!="string")throw new Error("Unexpected type of selector");let g=A;const M=w?typeof w=="string"?Ls(w)?new s([e(w,k,!1,null)],B,k):(g=`${w} ${g}`,B):Ut(w)?w:new s(Array.isArray(w)?w:[w],B,k):B;return M?M.find(g):N}return Object.assign(R,Ng,{load:r,_root:I,_options:O,fn:s.prototype,prototype:s.prototype}),R}}function kE(e){return!!e.name||e.type==="root"||e.type==="text"||e.type==="comment"}const BE=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),Be="";var $;(function(e){e[e.EOF=-1]="EOF",e[e.NULL=0]="NULL",e[e.TABULATION=9]="TABULATION",e[e.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",e[e.LINE_FEED=10]="LINE_FEED",e[e.FORM_FEED=12]="FORM_FEED",e[e.SPACE=32]="SPACE",e[e.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",e[e.QUOTATION_MARK=34]="QUOTATION_MARK",e[e.NUMBER_SIGN=35]="NUMBER_SIGN",e[e.AMPERSAND=38]="AMPERSAND",e[e.APOSTROPHE=39]="APOSTROPHE",e[e.HYPHEN_MINUS=45]="HYPHEN_MINUS",e[e.SOLIDUS=47]="SOLIDUS",e[e.DIGIT_0=48]="DIGIT_0",e[e.DIGIT_9=57]="DIGIT_9",e[e.SEMICOLON=59]="SEMICOLON",e[e.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",e[e.EQUALS_SIGN=61]="EQUALS_SIGN",e[e.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",e[e.LATIN_CAPITAL_F=70]="LATIN_CAPITAL_F",e[e.LATIN_CAPITAL_X=88]="LATIN_CAPITAL_X",e[e.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",e[e.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",e[e.GRAVE_ACCENT=96]="GRAVE_ACCENT",e[e.LATIN_SMALL_A=97]="LATIN_SMALL_A",e[e.LATIN_SMALL_F=102]="LATIN_SMALL_F",e[e.LATIN_SMALL_X=120]="LATIN_SMALL_X",e[e.LATIN_SMALL_Z=122]="LATIN_SMALL_Z",e[e.REPLACEMENT_CHARACTER=65533]="REPLACEMENT_CHARACTER"})($=$||($={}));const nt={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function nc(e){return e>=55296&&e<=57343}function wE(e){return e>=56320&&e<=57343}function UE(e,t){return(e-55296)*1024+9216+t}function ic(e){return e!==32&&e!==10&&e!==13&&e!==9&&e!==12&&e>=1&&e<=31||e>=127&&e<=159}function sc(e){return e>=64976&&e<=65007||BE.has(e)}var ue;(function(e){e.controlCharacterInInputStream="control-character-in-input-stream",e.noncharacterInInputStream="noncharacter-in-input-stream",e.surrogateInInputStream="surrogate-in-input-stream",e.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",e.endTagWithAttributes="end-tag-with-attributes",e.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",e.unexpectedSolidusInTag="unexpected-solidus-in-tag",e.unexpectedNullCharacter="unexpected-null-character",e.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",e.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",e.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",e.missingEndTagName="missing-end-tag-name",e.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",e.unknownNamedCharacterReference="unknown-named-character-reference",e.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",e.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",e.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",e.eofBeforeTagName="eof-before-tag-name",e.eofInTag="eof-in-tag",e.missingAttributeValue="missing-attribute-value",e.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",e.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",e.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",e.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",e.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",e.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",e.missingDoctypePublicIdentifier="missing-doctype-public-identifier",e.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",e.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",e.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",e.cdataInHtmlContent="cdata-in-html-content",e.incorrectlyOpenedComment="incorrectly-opened-comment",e.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",e.eofInDoctype="eof-in-doctype",e.nestedComment="nested-comment",e.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",e.eofInComment="eof-in-comment",e.incorrectlyClosedComment="incorrectly-closed-comment",e.eofInCdata="eof-in-cdata",e.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",e.nullCharacterReference="null-character-reference",e.surrogateCharacterReference="surrogate-character-reference",e.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",e.controlCharacterReference="control-character-reference",e.noncharacterCharacterReference="noncharacter-character-reference",e.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",e.missingDoctypeName="missing-doctype-name",e.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",e.duplicateAttribute="duplicate-attribute",e.nonConformingDoctype="non-conforming-doctype",e.missingDoctype="missing-doctype",e.misplacedDoctype="misplaced-doctype",e.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",e.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",e.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",e.openElementsLeftAfterEof="open-elements-left-after-eof",e.abandonedHeadElementChild="abandoned-head-element-child",e.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",e.nestedNoscriptInHead="nested-noscript-in-head",e.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(ue=ue||(ue={}));const HE=1<<16;class KE{constructor(t){this.handler=t,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=HE,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+Number(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(t){const{line:r,col:n,offset:i}=this;return{code:t,startLine:r,endLine:r,startCol:n,endCol:n,startOffset:i,endOffset:i}}_err(t){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(t)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(t){if(this.pos!==this.html.length-1){const r=this.html.charCodeAt(this.pos+1);if(wE(r))return this.pos++,this._addGap(),UE(t,r)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,$.EOF;return this._err(ue.surrogateInInputStream),t}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(t,r){this.html.length>0?this.html+=t:this.html=t,this.endOfChunkHit=!1,this.lastChunkWritten=r}insertHtmlAtCurrentPos(t){this.html=this.html.substring(0,this.pos+1)+t+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(t,r){if(this.pos+t.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(r)return this.html.startsWith(t,this.pos);for(let n=0;n<t.length;n++)if((this.html.charCodeAt(this.pos+n)|32)!==t.charCodeAt(n))return!1;return!0}peek(t){const r=this.pos+t;if(r>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,$.EOF;const n=this.html.charCodeAt(r);return n===$.CARRIAGE_RETURN?$.LINE_FEED:n}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,$.EOF;let t=this.html.charCodeAt(this.pos);return t===$.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,$.LINE_FEED):t===$.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,nc(t)&&(t=this._processSurrogate(t)),this.handler.onParseError===null||t>31&&t<127||t===$.LINE_FEED||t===$.CARRIAGE_RETURN||t>159&&t<64976||this._checkForProblematicCharacters(t),t)}_checkForProblematicCharacters(t){ic(t)?this._err(ue.controlCharacterInInputStream):sc(t)&&this._err(ue.noncharacterInInputStream)}retreat(t){for(this.pos-=t;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var Ce;(function(e){e[e.CHARACTER=0]="CHARACTER",e[e.NULL_CHARACTER=1]="NULL_CHARACTER",e[e.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",e[e.START_TAG=3]="START_TAG",e[e.END_TAG=4]="END_TAG",e[e.COMMENT=5]="COMMENT",e[e.DOCTYPE=6]="DOCTYPE",e[e.EOF=7]="EOF",e[e.HIBERNATION=8]="HIBERNATION"})(Ce=Ce||(Ce={}));function ac(e,t){for(let r=e.attrs.length-1;r>=0;r--)if(e.attrs[r].name===t)return e.attrs[r].value;return null}var ce;(function(e){e.HTML="http://www.w3.org/1999/xhtml",e.MATHML="http://www.w3.org/1998/Math/MathML",e.SVG="http://www.w3.org/2000/svg",e.XLINK="http://www.w3.org/1999/xlink",e.XML="http://www.w3.org/XML/1998/namespace",e.XMLNS="http://www.w3.org/2000/xmlns/"})(ce=ce||(ce={}));var nr;(function(e){e.TYPE="type",e.ACTION="action",e.ENCODING="encoding",e.PROMPT="prompt",e.NAME="name",e.COLOR="color",e.FACE="face",e.SIZE="size"})(nr=nr||(nr={}));var ot;(function(e){e.NO_QUIRKS="no-quirks",e.QUIRKS="quirks",e.LIMITED_QUIRKS="limited-quirks"})(ot=ot||(ot={}));var se;(function(e){e.A="a",e.ADDRESS="address",e.ANNOTATION_XML="annotation-xml",e.APPLET="applet",e.AREA="area",e.ARTICLE="article",e.ASIDE="aside",e.B="b",e.BASE="base",e.BASEFONT="basefont",e.BGSOUND="bgsound",e.BIG="big",e.BLOCKQUOTE="blockquote",e.BODY="body",e.BR="br",e.BUTTON="button",e.CAPTION="caption",e.CENTER="center",e.CODE="code",e.COL="col",e.COLGROUP="colgroup",e.DD="dd",e.DESC="desc",e.DETAILS="details",e.DIALOG="dialog",e.DIR="dir",e.DIV="div",e.DL="dl",e.DT="dt",e.EM="em",e.EMBED="embed",e.FIELDSET="fieldset",e.FIGCAPTION="figcaption",e.FIGURE="figure",e.FONT="font",e.FOOTER="footer",e.FOREIGN_OBJECT="foreignObject",e.FORM="form",e.FRAME="frame",e.FRAMESET="frameset",e.H1="h1",e.H2="h2",e.H3="h3",e.H4="h4",e.H5="h5",e.H6="h6",e.HEAD="head",e.HEADER="header",e.HGROUP="hgroup",e.HR="hr",e.HTML="html",e.I="i",e.IMG="img",e.IMAGE="image",e.INPUT="input",e.IFRAME="iframe",e.KEYGEN="keygen",e.LABEL="label",e.LI="li",e.LINK="link",e.LISTING="listing",e.MAIN="main",e.MALIGNMARK="malignmark",e.MARQUEE="marquee",e.MATH="math",e.MENU="menu",e.META="meta",e.MGLYPH="mglyph",e.MI="mi",e.MO="mo",e.MN="mn",e.MS="ms",e.MTEXT="mtext",e.NAV="nav",e.NOBR="nobr",e.NOFRAMES="noframes",e.NOEMBED="noembed",e.NOSCRIPT="noscript",e.OBJECT="object",e.OL="ol",e.OPTGROUP="optgroup",e.OPTION="option",e.P="p",e.PARAM="param",e.PLAINTEXT="plaintext",e.PRE="pre",e.RB="rb",e.RP="rp",e.RT="rt",e.RTC="rtc",e.RUBY="ruby",e.S="s",e.SCRIPT="script",e.SECTION="section",e.SELECT="select",e.SOURCE="source",e.SMALL="small",e.SPAN="span",e.STRIKE="strike",e.STRONG="strong",e.STYLE="style",e.SUB="sub",e.SUMMARY="summary",e.SUP="sup",e.TABLE="table",e.TBODY="tbody",e.TEMPLATE="template",e.TEXTAREA="textarea",e.TFOOT="tfoot",e.TD="td",e.TH="th",e.THEAD="thead",e.TITLE="title",e.TR="tr",e.TRACK="track",e.TT="tt",e.U="u",e.UL="ul",e.SVG="svg",e.VAR="var",e.WBR="wbr",e.XMP="xmp"})(se=se||(se={}));var C;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.A=1]="A",e[e.ADDRESS=2]="ADDRESS",e[e.ANNOTATION_XML=3]="ANNOTATION_XML",e[e.APPLET=4]="APPLET",e[e.AREA=5]="AREA",e[e.ARTICLE=6]="ARTICLE",e[e.ASIDE=7]="ASIDE",e[e.B=8]="B",e[e.BASE=9]="BASE",e[e.BASEFONT=10]="BASEFONT",e[e.BGSOUND=11]="BGSOUND",e[e.BIG=12]="BIG",e[e.BLOCKQUOTE=13]="BLOCKQUOTE",e[e.BODY=14]="BODY",e[e.BR=15]="BR",e[e.BUTTON=16]="BUTTON",e[e.CAPTION=17]="CAPTION",e[e.CENTER=18]="CENTER",e[e.CODE=19]="CODE",e[e.COL=20]="COL",e[e.COLGROUP=21]="COLGROUP",e[e.DD=22]="DD",e[e.DESC=23]="DESC",e[e.DETAILS=24]="DETAILS",e[e.DIALOG=25]="DIALOG",e[e.DIR=26]="DIR",e[e.DIV=27]="DIV",e[e.DL=28]="DL",e[e.DT=29]="DT",e[e.EM=30]="EM",e[e.EMBED=31]="EMBED",e[e.FIELDSET=32]="FIELDSET",e[e.FIGCAPTION=33]="FIGCAPTION",e[e.FIGURE=34]="FIGURE",e[e.FONT=35]="FONT",e[e.FOOTER=36]="FOOTER",e[e.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",e[e.FORM=38]="FORM",e[e.FRAME=39]="FRAME",e[e.FRAMESET=40]="FRAMESET",e[e.H1=41]="H1",e[e.H2=42]="H2",e[e.H3=43]="H3",e[e.H4=44]="H4",e[e.H5=45]="H5",e[e.H6=46]="H6",e[e.HEAD=47]="HEAD",e[e.HEADER=48]="HEADER",e[e.HGROUP=49]="HGROUP",e[e.HR=50]="HR",e[e.HTML=51]="HTML",e[e.I=52]="I",e[e.IMG=53]="IMG",e[e.IMAGE=54]="IMAGE",e[e.INPUT=55]="INPUT",e[e.IFRAME=56]="IFRAME",e[e.KEYGEN=57]="KEYGEN",e[e.LABEL=58]="LABEL",e[e.LI=59]="LI",e[e.LINK=60]="LINK",e[e.LISTING=61]="LISTING",e[e.MAIN=62]="MAIN",e[e.MALIGNMARK=63]="MALIGNMARK",e[e.MARQUEE=64]="MARQUEE",e[e.MATH=65]="MATH",e[e.MENU=66]="MENU",e[e.META=67]="META",e[e.MGLYPH=68]="MGLYPH",e[e.MI=69]="MI",e[e.MO=70]="MO",e[e.MN=71]="MN",e[e.MS=72]="MS",e[e.MTEXT=73]="MTEXT",e[e.NAV=74]="NAV",e[e.NOBR=75]="NOBR",e[e.NOFRAMES=76]="NOFRAMES",e[e.NOEMBED=77]="NOEMBED",e[e.NOSCRIPT=78]="NOSCRIPT",e[e.OBJECT=79]="OBJECT",e[e.OL=80]="OL",e[e.OPTGROUP=81]="OPTGROUP",e[e.OPTION=82]="OPTION",e[e.P=83]="P",e[e.PARAM=84]="PARAM",e[e.PLAINTEXT=85]="PLAINTEXT",e[e.PRE=86]="PRE",e[e.RB=87]="RB",e[e.RP=88]="RP",e[e.RT=89]="RT",e[e.RTC=90]="RTC",e[e.RUBY=91]="RUBY",e[e.S=92]="S",e[e.SCRIPT=93]="SCRIPT",e[e.SECTION=94]="SECTION",e[e.SELECT=95]="SELECT",e[e.SOURCE=96]="SOURCE",e[e.SMALL=97]="SMALL",e[e.SPAN=98]="SPAN",e[e.STRIKE=99]="STRIKE",e[e.STRONG=100]="STRONG",e[e.STYLE=101]="STYLE",e[e.SUB=102]="SUB",e[e.SUMMARY=103]="SUMMARY",e[e.SUP=104]="SUP",e[e.TABLE=105]="TABLE",e[e.TBODY=106]="TBODY",e[e.TEMPLATE=107]="TEMPLATE",e[e.TEXTAREA=108]="TEXTAREA",e[e.TFOOT=109]="TFOOT",e[e.TD=110]="TD",e[e.TH=111]="TH",e[e.THEAD=112]="THEAD",e[e.TITLE=113]="TITLE",e[e.TR=114]="TR",e[e.TRACK=115]="TRACK",e[e.TT=116]="TT",e[e.U=117]="U",e[e.UL=118]="UL",e[e.SVG=119]="SVG",e[e.VAR=120]="VAR",e[e.WBR=121]="WBR",e[e.XMP=122]="XMP"})(C=C||(C={}));const WE=new Map([[se.A,C.A],[se.ADDRESS,C.ADDRESS],[se.ANNOTATION_XML,C.ANNOTATION_XML],[se.APPLET,C.APPLET],[se.AREA,C.AREA],[se.ARTICLE,C.ARTICLE],[se.ASIDE,C.ASIDE],[se.B,C.B],[se.BASE,C.BASE],[se.BASEFONT,C.BASEFONT],[se.BGSOUND,C.BGSOUND],[se.BIG,C.BIG],[se.BLOCKQUOTE,C.BLOCKQUOTE],[se.BODY,C.BODY],[se.BR,C.BR],[se.BUTTON,C.BUTTON],[se.CAPTION,C.CAPTION],[se.CENTER,C.CENTER],[se.CODE,C.CODE],[se.COL,C.COL],[se.COLGROUP,C.COLGROUP],[se.DD,C.DD],[se.DESC,C.DESC],[se.DETAILS,C.DETAILS],[se.DIALOG,C.DIALOG],[se.DIR,C.DIR],[se.DIV,C.DIV],[se.DL,C.DL],[se.DT,C.DT],[se.EM,C.EM],[se.EMBED,C.EMBED],[se.FIELDSET,C.FIELDSET],[se.FIGCAPTION,C.FIGCAPTION],[se.FIGURE,C.FIGURE],[se.FONT,C.FONT],[se.FOOTER,C.FOOTER],[se.FOREIGN_OBJECT,C.FOREIGN_OBJECT],[se.FORM,C.FORM],[se.FRAME,C.FRAME],[se.FRAMESET,C.FRAMESET],[se.H1,C.H1],[se.H2,C.H2],[se.H3,C.H3],[se.H4,C.H4],[se.H5,C.H5],[se.H6,C.H6],[se.HEAD,C.HEAD],[se.HEADER,C.HEADER],[se.HGROUP,C.HGROUP],[se.HR,C.HR],[se.HTML,C.HTML],[se.I,C.I],[se.IMG,C.IMG],[se.IMAGE,C.IMAGE],[se.INPUT,C.INPUT],[se.IFRAME,C.IFRAME],[se.KEYGEN,C.KEYGEN],[se.LABEL,C.LABEL],[se.LI,C.LI],[se.LINK,C.LINK],[se.LISTING,C.LISTING],[se.MAIN,C.MAIN],[se.MALIGNMARK,C.MALIGNMARK],[se.MARQUEE,C.MARQUEE],[se.MATH,C.MATH],[se.MENU,C.MENU],[se.META,C.META],[se.MGLYPH,C.MGLYPH],[se.MI,C.MI],[se.MO,C.MO],[se.MN,C.MN],[se.MS,C.MS],[se.MTEXT,C.MTEXT],[se.NAV,C.NAV],[se.NOBR,C.NOBR],[se.NOFRAMES,C.NOFRAMES],[se.NOEMBED,C.NOEMBED],[se.NOSCRIPT,C.NOSCRIPT],[se.OBJECT,C.OBJECT],[se.OL,C.OL],[se.OPTGROUP,C.OPTGROUP],[se.OPTION,C.OPTION],[se.P,C.P],[se.PARAM,C.PARAM],[se.PLAINTEXT,C.PLAINTEXT],[se.PRE,C.PRE],[se.RB,C.RB],[se.RP,C.RP],[se.RT,C.RT],[se.RTC,C.RTC],[se.RUBY,C.RUBY],[se.S,C.S],[se.SCRIPT,C.SCRIPT],[se.SECTION,C.SECTION],[se.SELECT,C.SELECT],[se.SOURCE,C.SOURCE],[se.SMALL,C.SMALL],[se.SPAN,C.SPAN],[se.STRIKE,C.STRIKE],[se.STRONG,C.STRONG],[se.STYLE,C.STYLE],[se.SUB,C.SUB],[se.SUMMARY,C.SUMMARY],[se.SUP,C.SUP],[se.TABLE,C.TABLE],[se.TBODY,C.TBODY],[se.TEMPLATE,C.TEMPLATE],[se.TEXTAREA,C.TEXTAREA],[se.TFOOT,C.TFOOT],[se.TD,C.TD],[se.TH,C.TH],[se.THEAD,C.THEAD],[se.TITLE,C.TITLE],[se.TR,C.TR],[se.TRACK,C.TRACK],[se.TT,C.TT],[se.U,C.U],[se.UL,C.UL],[se.SVG,C.SVG],[se.VAR,C.VAR],[se.WBR,C.WBR],[se.XMP,C.XMP]]);function Mi(e){var t;return(t=WE.get(e))!==null&&t!==void 0?t:C.UNKNOWN}const de=C,GE={[ce.HTML]:new Set([de.ADDRESS,de.APPLET,de.AREA,de.ARTICLE,de.ASIDE,de.BASE,de.BASEFONT,de.BGSOUND,de.BLOCKQUOTE,de.BODY,de.BR,de.BUTTON,de.CAPTION,de.CENTER,de.COL,de.COLGROUP,de.DD,de.DETAILS,de.DIR,de.DIV,de.DL,de.DT,de.EMBED,de.FIELDSET,de.FIGCAPTION,de.FIGURE,de.FOOTER,de.FORM,de.FRAME,de.FRAMESET,de.H1,de.H2,de.H3,de.H4,de.H5,de.H6,de.HEAD,de.HEADER,de.HGROUP,de.HR,de.HTML,de.IFRAME,de.IMG,de.INPUT,de.LI,de.LINK,de.LISTING,de.MAIN,de.MARQUEE,de.MENU,de.META,de.NAV,de.NOEMBED,de.NOFRAMES,de.NOSCRIPT,de.OBJECT,de.OL,de.P,de.PARAM,de.PLAINTEXT,de.PRE,de.SCRIPT,de.SECTION,de.SELECT,de.SOURCE,de.STYLE,de.SUMMARY,de.TABLE,de.TBODY,de.TD,de.TEMPLATE,de.TEXTAREA,de.TFOOT,de.TH,de.THEAD,de.TITLE,de.TR,de.TRACK,de.UL,de.WBR,de.XMP]),[ce.MATHML]:new Set([de.MI,de.MO,de.MN,de.MS,de.MTEXT,de.ANNOTATION_XML]),[ce.SVG]:new Set([de.TITLE,de.FOREIGN_OBJECT,de.DESC]),[ce.XLINK]:new Set,[ce.XML]:new Set,[ce.XMLNS]:new Set};function oc(e){return e===de.H1||e===de.H2||e===de.H3||e===de.H4||e===de.H5||e===de.H6}const YE=new Set([se.STYLE,se.SCRIPT,se.XMP,se.IFRAME,se.NOEMBED,se.NOFRAMES,se.PLAINTEXT]);function VE(e,t){return YE.has(e)||t&&e===se.NOSCRIPT}const jE=new Map([[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);var z;(function(e){e[e.DATA=0]="DATA",e[e.RCDATA=1]="RCDATA",e[e.RAWTEXT=2]="RAWTEXT",e[e.SCRIPT_DATA=3]="SCRIPT_DATA",e[e.PLAINTEXT=4]="PLAINTEXT",e[e.TAG_OPEN=5]="TAG_OPEN",e[e.END_TAG_OPEN=6]="END_TAG_OPEN",e[e.TAG_NAME=7]="TAG_NAME",e[e.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",e[e.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",e[e.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",e[e.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",e[e.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",e[e.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",e[e.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",e[e.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",e[e.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",e[e.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",e[e.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",e[e.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",e[e.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",e[e.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",e[e.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",e[e.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",e[e.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",e[e.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",e[e.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",e[e.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",e[e.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",e[e.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",e[e.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",e[e.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",e[e.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",e[e.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",e[e.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",e[e.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",e[e.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",e[e.BOGUS_COMMENT=40]="BOGUS_COMMENT",e[e.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",e[e.COMMENT_START=42]="COMMENT_START",e[e.COMMENT_START_DASH=43]="COMMENT_START_DASH",e[e.COMMENT=44]="COMMENT",e[e.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",e[e.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",e[e.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",e[e.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",e[e.COMMENT_END_DASH=49]="COMMENT_END_DASH",e[e.COMMENT_END=50]="COMMENT_END",e[e.COMMENT_END_BANG=51]="COMMENT_END_BANG",e[e.DOCTYPE=52]="DOCTYPE",e[e.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",e[e.DOCTYPE_NAME=54]="DOCTYPE_NAME",e[e.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",e[e.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",e[e.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",e[e.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",e[e.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",e[e.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",e[e.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",e[e.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",e[e.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",e[e.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",e[e.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",e[e.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",e[e.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",e[e.CDATA_SECTION=68]="CDATA_SECTION",e[e.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",e[e.CDATA_SECTION_END=70]="CDATA_SECTION_END",e[e.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",e[e.NAMED_CHARACTER_REFERENCE=72]="NAMED_CHARACTER_REFERENCE",e[e.AMBIGUOUS_AMPERSAND=73]="AMBIGUOUS_AMPERSAND",e[e.NUMERIC_CHARACTER_REFERENCE=74]="NUMERIC_CHARACTER_REFERENCE",e[e.HEXADEMICAL_CHARACTER_REFERENCE_START=75]="HEXADEMICAL_CHARACTER_REFERENCE_START",e[e.HEXADEMICAL_CHARACTER_REFERENCE=76]="HEXADEMICAL_CHARACTER_REFERENCE",e[e.DECIMAL_CHARACTER_REFERENCE=77]="DECIMAL_CHARACTER_REFERENCE",e[e.NUMERIC_CHARACTER_REFERENCE_END=78]="NUMERIC_CHARACTER_REFERENCE_END"})(z||(z={}));const ut={DATA:z.DATA,RCDATA:z.RCDATA,RAWTEXT:z.RAWTEXT,SCRIPT_DATA:z.SCRIPT_DATA,PLAINTEXT:z.PLAINTEXT,CDATA_SECTION:z.CDATA_SECTION};function dn(e){return e>=$.DIGIT_0&&e<=$.DIGIT_9}function an(e){return e>=$.LATIN_CAPITAL_A&&e<=$.LATIN_CAPITAL_Z}function XE(e){return e>=$.LATIN_SMALL_A&&e<=$.LATIN_SMALL_Z}function Jt(e){return XE(e)||an(e)}function Ns(e){return Jt(e)||dn(e)}function uc(e){return e>=$.LATIN_CAPITAL_A&&e<=$.LATIN_CAPITAL_F}function lc(e){return e>=$.LATIN_SMALL_A&&e<=$.LATIN_SMALL_F}function QE(e){return dn(e)||uc(e)||lc(e)}function Yn(e){return e+32}function cc(e){return e===$.SPACE||e===$.LINE_FEED||e===$.TABULATION||e===$.FORM_FEED}function $E(e){return e===$.EQUALS_SIGN||Ns(e)}function Ko(e){return cc(e)||e===$.SOLIDUS||e===$.GREATER_THAN_SIGN}let zE=class{constructor(t,r){this.options=t,this.handler=r,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=z.DATA,this.returnState=z.DATA,this.charRefCode=-1,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new KE(r),this.currentLocation=this.getCurrentLocation(-1)}_err(t){var r,n;(n=(r=this.handler).onParseError)===null||n===void 0||n.call(r,this.preprocessor.getError(t))}getCurrentLocation(t){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-t,startOffset:this.preprocessor.offset-t,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const t=this._consume();this._ensureHibernation()||this._callState(t)}this.inLoop=!1}}pause(){this.paused=!0}resume(t){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||t==null||t())}write(t,r,n){this.active=!0,this.preprocessor.write(t,r),this._runParsingLoop(),this.paused||n==null||n()}insertHtmlAtCurrentPos(t){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(t),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this._unconsume(this.consumedAfterSnapshot),this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_unconsume(t){this.consumedAfterSnapshot-=t,this.preprocessor.retreat(t)}_reconsumeInState(t,r){this.state=t,this._callState(r)}_advanceBy(t){this.consumedAfterSnapshot+=t;for(let r=0;r<t;r++)this.preprocessor.advance()}_consumeSequenceIfMatch(t,r){return this.preprocessor.startsWith(t,r)?(this._advanceBy(t.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:Ce.START_TAG,tagName:"",tagID:C.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:Ce.END_TAG,tagName:"",tagID:C.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(t){this.currentToken={type:Ce.COMMENT,data:"",location:this.getCurrentLocation(t)}}_createDoctypeToken(t){this.currentToken={type:Ce.DOCTYPE,name:t,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(t,r){this.currentCharacterToken={type:t,chars:r,location:this.currentLocation}}_createAttr(t){this.currentAttr={name:t,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var t,r;const n=this.currentToken;if(ac(n,this.currentAttr.name)===null){if(n.attrs.push(this.currentAttr),n.location&&this.currentLocation){const i=(t=(r=n.location).attrs)!==null&&t!==void 0?t:r.attrs=Object.create(null);i[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(ue.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(t){this._emitCurrentCharacterToken(t.location),this.currentToken=null,t.location&&(t.location.endLine=this.preprocessor.line,t.location.endCol=this.preprocessor.col+1,t.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const t=this.currentToken;this.prepareToken(t),t.tagID=Mi(t.tagName),t.type===Ce.START_TAG?(this.lastStartTagName=t.tagName,this.handler.onStartTag(t)):(t.attrs.length>0&&this._err(ue.endTagWithAttributes),t.selfClosing&&this._err(ue.endTagWithTrailingSolidus),this.handler.onEndTag(t)),this.preprocessor.dropParsedChunk()}emitCurrentComment(t){this.prepareToken(t),this.handler.onComment(t),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(t){this.prepareToken(t),this.handler.onDoctype(t),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(t){if(this.currentCharacterToken){switch(t&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=t.startLine,this.currentCharacterToken.location.endCol=t.startCol,this.currentCharacterToken.location.endOffset=t.startOffset),this.currentCharacterToken.type){case Ce.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case Ce.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case Ce.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const t=this.getCurrentLocation(0);t&&(t.endLine=t.startLine,t.endCol=t.startCol,t.endOffset=t.startOffset),this._emitCurrentCharacterToken(t),this.handler.onEof({type:Ce.EOF,location:t}),this.active=!1}_appendCharToCurrentCharacterToken(t,r){if(this.currentCharacterToken)if(this.currentCharacterToken.type!==t)this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();else{this.currentCharacterToken.chars+=r;return}this._createCharacterToken(t,r)}_emitCodePoint(t){const r=cc(t)?Ce.WHITESPACE_CHARACTER:t===$.NULL?Ce.NULL_CHARACTER:Ce.CHARACTER;this._appendCharToCurrentCharacterToken(r,String.fromCodePoint(t))}_emitChars(t){this._appendCharToCurrentCharacterToken(Ce.CHARACTER,t)}_matchNamedCharacterReference(t){let r=null,n=0,i=!1;for(let p=0,O=qt[0];p>=0&&(p=Tl(qt,O,p+1,t),!(p<0));t=this._consume()){n+=1,O=qt[p];const I=O&jt.VALUE_LENGTH;if(I){const s=(I>>14)-1;if(t!==$.SEMICOLON&&this._isCharacterReferenceInAttribute()&&$E(this.preprocessor.peek(1))?(r=[$.AMPERSAND],p+=s):(r=s===0?[qt[p]&~jt.VALUE_LENGTH]:s===1?[qt[++p]]:[qt[++p],qt[++p]],n=0,i=t!==$.SEMICOLON),s===0){this._consume();break}}}return this._unconsume(n),i&&!this.preprocessor.endOfChunkHit&&this._err(ue.missingSemicolonAfterCharacterReference),this._unconsume(1),r}_isCharacterReferenceInAttribute(){return this.returnState===z.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===z.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===z.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(t){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(t):this._emitCodePoint(t)}_callState(t){switch(this.state){case z.DATA:{this._stateData(t);break}case z.RCDATA:{this._stateRcdata(t);break}case z.RAWTEXT:{this._stateRawtext(t);break}case z.SCRIPT_DATA:{this._stateScriptData(t);break}case z.PLAINTEXT:{this._statePlaintext(t);break}case z.TAG_OPEN:{this._stateTagOpen(t);break}case z.END_TAG_OPEN:{this._stateEndTagOpen(t);break}case z.TAG_NAME:{this._stateTagName(t);break}case z.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(t);break}case z.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(t);break}case z.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(t);break}case z.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(t);break}case z.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(t);break}case z.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(t);break}case z.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(t);break}case z.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(t);break}case z.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(t);break}case z.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(t);break}case z.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(t);break}case z.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(t);break}case z.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(t);break}case z.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(t);break}case z.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(t);break}case z.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(t);break}case z.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(t);break}case z.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(t);break}case z.ATTRIBUTE_NAME:{this._stateAttributeName(t);break}case z.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(t);break}case z.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(t);break}case z.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(t);break}case z.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(t);break}case z.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(t);break}case z.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(t);break}case z.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(t);break}case z.BOGUS_COMMENT:{this._stateBogusComment(t);break}case z.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(t);break}case z.COMMENT_START:{this._stateCommentStart(t);break}case z.COMMENT_START_DASH:{this._stateCommentStartDash(t);break}case z.COMMENT:{this._stateComment(t);break}case z.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(t);break}case z.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(t);break}case z.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(t);break}case z.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(t);break}case z.COMMENT_END_DASH:{this._stateCommentEndDash(t);break}case z.COMMENT_END:{this._stateCommentEnd(t);break}case z.COMMENT_END_BANG:{this._stateCommentEndBang(t);break}case z.DOCTYPE:{this._stateDoctype(t);break}case z.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(t);break}case z.DOCTYPE_NAME:{this._stateDoctypeName(t);break}case z.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(t);break}case z.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(t);break}case z.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(t);break}case z.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(t);break}case z.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(t);break}case z.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(t);break}case z.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(t);break}case z.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(t);break}case z.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(t);break}case z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(t);break}case z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(t);break}case z.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(t);break}case z.BOGUS_DOCTYPE:{this._stateBogusDoctype(t);break}case z.CDATA_SECTION:{this._stateCdataSection(t);break}case z.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(t);break}case z.CDATA_SECTION_END:{this._stateCdataSectionEnd(t);break}case z.CHARACTER_REFERENCE:{this._stateCharacterReference(t);break}case z.NAMED_CHARACTER_REFERENCE:{this._stateNamedCharacterReference(t);break}case z.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(t);break}case z.NUMERIC_CHARACTER_REFERENCE:{this._stateNumericCharacterReference(t);break}case z.HEXADEMICAL_CHARACTER_REFERENCE_START:{this._stateHexademicalCharacterReferenceStart(t);break}case z.HEXADEMICAL_CHARACTER_REFERENCE:{this._stateHexademicalCharacterReference(t);break}case z.DECIMAL_CHARACTER_REFERENCE:{this._stateDecimalCharacterReference(t);break}case z.NUMERIC_CHARACTER_REFERENCE_END:{this._stateNumericCharacterReferenceEnd(t);break}default:throw new Error("Unknown state")}}_stateData(t){switch(t){case $.LESS_THAN_SIGN:{this.state=z.TAG_OPEN;break}case $.AMPERSAND:{this.returnState=z.DATA,this.state=z.CHARACTER_REFERENCE;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this._emitCodePoint(t);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateRcdata(t){switch(t){case $.AMPERSAND:{this.returnState=z.RCDATA,this.state=z.CHARACTER_REFERENCE;break}case $.LESS_THAN_SIGN:{this.state=z.RCDATA_LESS_THAN_SIGN;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this._emitChars(Be);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateRawtext(t){switch(t){case $.LESS_THAN_SIGN:{this.state=z.RAWTEXT_LESS_THAN_SIGN;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this._emitChars(Be);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptData(t){switch(t){case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_LESS_THAN_SIGN;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this._emitChars(Be);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_statePlaintext(t){switch(t){case $.NULL:{this._err(ue.unexpectedNullCharacter),this._emitChars(Be);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateTagOpen(t){if(Jt(t))this._createStartTagToken(),this.state=z.TAG_NAME,this._stateTagName(t);else switch(t){case $.EXCLAMATION_MARK:{this.state=z.MARKUP_DECLARATION_OPEN;break}case $.SOLIDUS:{this.state=z.END_TAG_OPEN;break}case $.QUESTION_MARK:{this._err(ue.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=z.BOGUS_COMMENT,this._stateBogusComment(t);break}case $.EOF:{this._err(ue.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(ue.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=z.DATA,this._stateData(t)}}_stateEndTagOpen(t){if(Jt(t))this._createEndTagToken(),this.state=z.TAG_NAME,this._stateTagName(t);else switch(t){case $.GREATER_THAN_SIGN:{this._err(ue.missingEndTagName),this.state=z.DATA;break}case $.EOF:{this._err(ue.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(ue.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=z.BOGUS_COMMENT,this._stateBogusComment(t)}}_stateTagName(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=z.BEFORE_ATTRIBUTE_NAME;break}case $.SOLIDUS:{this.state=z.SELF_CLOSING_START_TAG;break}case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentTagToken();break}case $.NULL:{this._err(ue.unexpectedNullCharacter),r.tagName+=Be;break}case $.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:r.tagName+=String.fromCodePoint(an(t)?Yn(t):t)}}_stateRcdataLessThanSign(t){t===$.SOLIDUS?this.state=z.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=z.RCDATA,this._stateRcdata(t))}_stateRcdataEndTagOpen(t){Jt(t)?(this.state=z.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(t)):(this._emitChars("</"),this.state=z.RCDATA,this._stateRcdata(t))}handleSpecialEndTag(t){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const r=this.currentToken;switch(r.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=z.BEFORE_ATTRIBUTE_NAME,!1;case $.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=z.SELF_CLOSING_START_TAG,!1;case $.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=z.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=z.RCDATA,this._stateRcdata(t))}_stateRawtextLessThanSign(t){t===$.SOLIDUS?this.state=z.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=z.RAWTEXT,this._stateRawtext(t))}_stateRawtextEndTagOpen(t){Jt(t)?(this.state=z.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(t)):(this._emitChars("</"),this.state=z.RAWTEXT,this._stateRawtext(t))}_stateRawtextEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=z.RAWTEXT,this._stateRawtext(t))}_stateScriptDataLessThanSign(t){switch(t){case $.SOLIDUS:{this.state=z.SCRIPT_DATA_END_TAG_OPEN;break}case $.EXCLAMATION_MARK:{this.state=z.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=z.SCRIPT_DATA,this._stateScriptData(t)}}_stateScriptDataEndTagOpen(t){Jt(t)?(this.state=z.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(t)):(this._emitChars("</"),this.state=z.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=z.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscapeStart(t){t===$.HYPHEN_MINUS?(this.state=z.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=z.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscapeStartDash(t){t===$.HYPHEN_MINUS?(this.state=z.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=z.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscaped(t){switch(t){case $.HYPHEN_MINUS:{this.state=z.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this._emitChars(Be);break}case $.EOF:{this._err(ue.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptDataEscapedDash(t){switch(t){case $.HYPHEN_MINUS:{this.state=z.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this.state=z.SCRIPT_DATA_ESCAPED,this._emitChars(Be);break}case $.EOF:{this._err(ue.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=z.SCRIPT_DATA_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataEscapedDashDash(t){switch(t){case $.HYPHEN_MINUS:{this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case $.GREATER_THAN_SIGN:{this.state=z.SCRIPT_DATA,this._emitChars(">");break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this.state=z.SCRIPT_DATA_ESCAPED,this._emitChars(Be);break}case $.EOF:{this._err(ue.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=z.SCRIPT_DATA_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataEscapedLessThanSign(t){t===$.SOLIDUS?this.state=z.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:Jt(t)?(this._emitChars("<"),this.state=z.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(t)):(this._emitChars("<"),this.state=z.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataEscapedEndTagOpen(t){Jt(t)?(this.state=z.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(t)):(this._emitChars("</"),this.state=z.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataEscapedEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=z.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataDoubleEscapeStart(t){if(this.preprocessor.startsWith(nt.SCRIPT,!1)&&Ko(this.preprocessor.peek(nt.SCRIPT.length))){this._emitCodePoint(t);for(let r=0;r<nt.SCRIPT.length;r++)this._emitCodePoint(this._consume());this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=z.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataDoubleEscaped(t){switch(t){case $.HYPHEN_MINUS:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this._emitChars(Be);break}case $.EOF:{this._err(ue.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedDash(t){switch(t){case $.HYPHEN_MINUS:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(Be);break}case $.EOF:{this._err(ue.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedDashDash(t){switch(t){case $.HYPHEN_MINUS:{this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case $.GREATER_THAN_SIGN:{this.state=z.SCRIPT_DATA,this._emitChars(">");break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(Be);break}case $.EOF:{this._err(ue.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedLessThanSign(t){t===$.SOLIDUS?(this.state=z.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(t))}_stateScriptDataDoubleEscapeEnd(t){if(this.preprocessor.startsWith(nt.SCRIPT,!1)&&Ko(this.preprocessor.peek(nt.SCRIPT.length))){this._emitCodePoint(t);for(let r=0;r<nt.SCRIPT.length;r++)this._emitCodePoint(this._consume());this.state=z.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(t))}_stateBeforeAttributeName(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.SOLIDUS:case $.GREATER_THAN_SIGN:case $.EOF:{this.state=z.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(t);break}case $.EQUALS_SIGN:{this._err(ue.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=z.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=z.ATTRIBUTE_NAME,this._stateAttributeName(t)}}_stateAttributeName(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:case $.SOLIDUS:case $.GREATER_THAN_SIGN:case $.EOF:{this._leaveAttrName(),this.state=z.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(t);break}case $.EQUALS_SIGN:{this._leaveAttrName(),this.state=z.BEFORE_ATTRIBUTE_VALUE;break}case $.QUOTATION_MARK:case $.APOSTROPHE:case $.LESS_THAN_SIGN:{this._err(ue.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(t);break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this.currentAttr.name+=Be;break}default:this.currentAttr.name+=String.fromCodePoint(an(t)?Yn(t):t)}}_stateAfterAttributeName(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.SOLIDUS:{this.state=z.SELF_CLOSING_START_TAG;break}case $.EQUALS_SIGN:{this.state=z.BEFORE_ATTRIBUTE_VALUE;break}case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentTagToken();break}case $.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=z.ATTRIBUTE_NAME,this._stateAttributeName(t)}}_stateBeforeAttributeValue(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.QUOTATION_MARK:{this.state=z.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case $.APOSTROPHE:{this.state=z.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(ue.missingAttributeValue),this.state=z.DATA,this.emitCurrentTagToken();break}default:this.state=z.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(t)}}_stateAttributeValueDoubleQuoted(t){switch(t){case $.QUOTATION_MARK:{this.state=z.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case $.AMPERSAND:{this.returnState=z.ATTRIBUTE_VALUE_DOUBLE_QUOTED,this.state=z.CHARACTER_REFERENCE;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this.currentAttr.value+=Be;break}case $.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAttributeValueSingleQuoted(t){switch(t){case $.APOSTROPHE:{this.state=z.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case $.AMPERSAND:{this.returnState=z.ATTRIBUTE_VALUE_SINGLE_QUOTED,this.state=z.CHARACTER_REFERENCE;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this.currentAttr.value+=Be;break}case $.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAttributeValueUnquoted(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this._leaveAttrValue(),this.state=z.BEFORE_ATTRIBUTE_NAME;break}case $.AMPERSAND:{this.returnState=z.ATTRIBUTE_VALUE_UNQUOTED,this.state=z.CHARACTER_REFERENCE;break}case $.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=z.DATA,this.emitCurrentTagToken();break}case $.NULL:{this._err(ue.unexpectedNullCharacter),this.currentAttr.value+=Be;break}case $.QUOTATION_MARK:case $.APOSTROPHE:case $.LESS_THAN_SIGN:case $.EQUALS_SIGN:case $.GRAVE_ACCENT:{this._err(ue.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(t);break}case $.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAfterAttributeValueQuoted(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this._leaveAttrValue(),this.state=z.BEFORE_ATTRIBUTE_NAME;break}case $.SOLIDUS:{this._leaveAttrValue(),this.state=z.SELF_CLOSING_START_TAG;break}case $.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=z.DATA,this.emitCurrentTagToken();break}case $.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:this._err(ue.missingWhitespaceBetweenAttributes),this.state=z.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(t)}}_stateSelfClosingStartTag(t){switch(t){case $.GREATER_THAN_SIGN:{const r=this.currentToken;r.selfClosing=!0,this.state=z.DATA,this.emitCurrentTagToken();break}case $.EOF:{this._err(ue.eofInTag),this._emitEOFToken();break}default:this._err(ue.unexpectedSolidusInTag),this.state=z.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(t)}}_stateBogusComment(t){const r=this.currentToken;switch(t){case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentComment(r);break}case $.EOF:{this.emitCurrentComment(r),this._emitEOFToken();break}case $.NULL:{this._err(ue.unexpectedNullCharacter),r.data+=Be;break}default:r.data+=String.fromCodePoint(t)}}_stateMarkupDeclarationOpen(t){this._consumeSequenceIfMatch(nt.DASH_DASH,!0)?(this._createCommentToken(nt.DASH_DASH.length+1),this.state=z.COMMENT_START):this._consumeSequenceIfMatch(nt.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(nt.DOCTYPE.length+1),this.state=z.DOCTYPE):this._consumeSequenceIfMatch(nt.CDATA_START,!0)?this.inForeignNode?this.state=z.CDATA_SECTION:(this._err(ue.cdataInHtmlContent),this._createCommentToken(nt.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=z.BOGUS_COMMENT):this._ensureHibernation()||(this._err(ue.incorrectlyOpenedComment),this._createCommentToken(2),this.state=z.BOGUS_COMMENT,this._stateBogusComment(t))}_stateCommentStart(t){switch(t){case $.HYPHEN_MINUS:{this.state=z.COMMENT_START_DASH;break}case $.GREATER_THAN_SIGN:{this._err(ue.abruptClosingOfEmptyComment),this.state=z.DATA;const r=this.currentToken;this.emitCurrentComment(r);break}default:this.state=z.COMMENT,this._stateComment(t)}}_stateCommentStartDash(t){const r=this.currentToken;switch(t){case $.HYPHEN_MINUS:{this.state=z.COMMENT_END;break}case $.GREATER_THAN_SIGN:{this._err(ue.abruptClosingOfEmptyComment),this.state=z.DATA,this.emitCurrentComment(r);break}case $.EOF:{this._err(ue.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+="-",this.state=z.COMMENT,this._stateComment(t)}}_stateComment(t){const r=this.currentToken;switch(t){case $.HYPHEN_MINUS:{this.state=z.COMMENT_END_DASH;break}case $.LESS_THAN_SIGN:{r.data+="<",this.state=z.COMMENT_LESS_THAN_SIGN;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),r.data+=Be;break}case $.EOF:{this._err(ue.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+=String.fromCodePoint(t)}}_stateCommentLessThanSign(t){const r=this.currentToken;switch(t){case $.EXCLAMATION_MARK:{r.data+="!",this.state=z.COMMENT_LESS_THAN_SIGN_BANG;break}case $.LESS_THAN_SIGN:{r.data+="<";break}default:this.state=z.COMMENT,this._stateComment(t)}}_stateCommentLessThanSignBang(t){t===$.HYPHEN_MINUS?this.state=z.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=z.COMMENT,this._stateComment(t))}_stateCommentLessThanSignBangDash(t){t===$.HYPHEN_MINUS?this.state=z.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=z.COMMENT_END_DASH,this._stateCommentEndDash(t))}_stateCommentLessThanSignBangDashDash(t){t!==$.GREATER_THAN_SIGN&&t!==$.EOF&&this._err(ue.nestedComment),this.state=z.COMMENT_END,this._stateCommentEnd(t)}_stateCommentEndDash(t){const r=this.currentToken;switch(t){case $.HYPHEN_MINUS:{this.state=z.COMMENT_END;break}case $.EOF:{this._err(ue.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+="-",this.state=z.COMMENT,this._stateComment(t)}}_stateCommentEnd(t){const r=this.currentToken;switch(t){case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentComment(r);break}case $.EXCLAMATION_MARK:{this.state=z.COMMENT_END_BANG;break}case $.HYPHEN_MINUS:{r.data+="-";break}case $.EOF:{this._err(ue.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+="--",this.state=z.COMMENT,this._stateComment(t)}}_stateCommentEndBang(t){const r=this.currentToken;switch(t){case $.HYPHEN_MINUS:{r.data+="--!",this.state=z.COMMENT_END_DASH;break}case $.GREATER_THAN_SIGN:{this._err(ue.incorrectlyClosedComment),this.state=z.DATA,this.emitCurrentComment(r);break}case $.EOF:{this._err(ue.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+="--!",this.state=z.COMMENT,this._stateComment(t)}}_stateDoctype(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=z.BEFORE_DOCTYPE_NAME;break}case $.GREATER_THAN_SIGN:{this.state=z.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(t);break}case $.EOF:{this._err(ue.eofInDoctype),this._createDoctypeToken(null);const r=this.currentToken;r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingWhitespaceBeforeDoctypeName),this.state=z.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(t)}}_stateBeforeDoctypeName(t){if(an(t))this._createDoctypeToken(String.fromCharCode(Yn(t))),this.state=z.DOCTYPE_NAME;else switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.NULL:{this._err(ue.unexpectedNullCharacter),this._createDoctypeToken(Be),this.state=z.DOCTYPE_NAME;break}case $.GREATER_THAN_SIGN:{this._err(ue.missingDoctypeName),this._createDoctypeToken(null);const r=this.currentToken;r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.EOF:{this._err(ue.eofInDoctype),this._createDoctypeToken(null);const r=this.currentToken;r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(t)),this.state=z.DOCTYPE_NAME}}_stateDoctypeName(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=z.AFTER_DOCTYPE_NAME;break}case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.NULL:{this._err(ue.unexpectedNullCharacter),r.name+=Be;break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.name+=String.fromCodePoint(an(t)?Yn(t):t)}}_stateAfterDoctypeName(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(nt.PUBLIC,!1)?this.state=z.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(nt.SYSTEM,!1)?this.state=z.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(ue.invalidCharacterSequenceAfterDoctypeName),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t))}}_stateAfterDoctypePublicKeyword(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=z.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case $.QUOTATION_MARK:{this._err(ue.missingWhitespaceAfterDoctypePublicKeyword),r.publicId="",this.state=z.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{this._err(ue.missingWhitespaceAfterDoctypePublicKeyword),r.publicId="",this.state=z.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(ue.missingDoctypePublicIdentifier),r.forceQuirks=!0,this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingQuoteBeforeDoctypePublicIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBeforeDoctypePublicIdentifier(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.QUOTATION_MARK:{r.publicId="",this.state=z.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{r.publicId="",this.state=z.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(ue.missingDoctypePublicIdentifier),r.forceQuirks=!0,this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingQuoteBeforeDoctypePublicIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateDoctypePublicIdentifierDoubleQuoted(t){const r=this.currentToken;switch(t){case $.QUOTATION_MARK:{this.state=z.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),r.publicId+=Be;break}case $.GREATER_THAN_SIGN:{this._err(ue.abruptDoctypePublicIdentifier),r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.publicId+=String.fromCodePoint(t)}}_stateDoctypePublicIdentifierSingleQuoted(t){const r=this.currentToken;switch(t){case $.APOSTROPHE:{this.state=z.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),r.publicId+=Be;break}case $.GREATER_THAN_SIGN:{this._err(ue.abruptDoctypePublicIdentifier),r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.publicId+=String.fromCodePoint(t)}}_stateAfterDoctypePublicIdentifier(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=z.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.QUOTATION_MARK:{this._err(ue.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{this._err(ue.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingQuoteBeforeDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBetweenDoctypePublicAndSystemIdentifiers(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.GREATER_THAN_SIGN:{this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.QUOTATION_MARK:{r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingQuoteBeforeDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateAfterDoctypeSystemKeyword(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=z.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case $.QUOTATION_MARK:{this._err(ue.missingWhitespaceAfterDoctypeSystemKeyword),r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{this._err(ue.missingWhitespaceAfterDoctypeSystemKeyword),r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(ue.missingDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingQuoteBeforeDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBeforeDoctypeSystemIdentifier(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.QUOTATION_MARK:{r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(ue.missingDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.missingQuoteBeforeDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateDoctypeSystemIdentifierDoubleQuoted(t){const r=this.currentToken;switch(t){case $.QUOTATION_MARK:{this.state=z.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),r.systemId+=Be;break}case $.GREATER_THAN_SIGN:{this._err(ue.abruptDoctypeSystemIdentifier),r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.systemId+=String.fromCodePoint(t)}}_stateDoctypeSystemIdentifierSingleQuoted(t){const r=this.currentToken;switch(t){case $.APOSTROPHE:{this.state=z.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case $.NULL:{this._err(ue.unexpectedNullCharacter),r.systemId+=Be;break}case $.GREATER_THAN_SIGN:{this._err(ue.abruptDoctypeSystemIdentifier),r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.systemId+=String.fromCodePoint(t)}}_stateAfterDoctypeSystemIdentifier(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.GREATER_THAN_SIGN:{this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.EOF:{this._err(ue.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(ue.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBogusDoctype(t){const r=this.currentToken;switch(t){case $.GREATER_THAN_SIGN:{this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.NULL:{this._err(ue.unexpectedNullCharacter);break}case $.EOF:{this.emitCurrentDoctype(r),this._emitEOFToken();break}}}_stateCdataSection(t){switch(t){case $.RIGHT_SQUARE_BRACKET:{this.state=z.CDATA_SECTION_BRACKET;break}case $.EOF:{this._err(ue.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateCdataSectionBracket(t){t===$.RIGHT_SQUARE_BRACKET?this.state=z.CDATA_SECTION_END:(this._emitChars("]"),this.state=z.CDATA_SECTION,this._stateCdataSection(t))}_stateCdataSectionEnd(t){switch(t){case $.GREATER_THAN_SIGN:{this.state=z.DATA;break}case $.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=z.CDATA_SECTION,this._stateCdataSection(t)}}_stateCharacterReference(t){t===$.NUMBER_SIGN?this.state=z.NUMERIC_CHARACTER_REFERENCE:Ns(t)?(this.state=z.NAMED_CHARACTER_REFERENCE,this._stateNamedCharacterReference(t)):(this._flushCodePointConsumedAsCharacterReference($.AMPERSAND),this._reconsumeInState(this.returnState,t))}_stateNamedCharacterReference(t){const r=this._matchNamedCharacterReference(t);if(!this._ensureHibernation())if(r){for(let n=0;n<r.length;n++)this._flushCodePointConsumedAsCharacterReference(r[n]);this.state=this.returnState}else this._flushCodePointConsumedAsCharacterReference($.AMPERSAND),this.state=z.AMBIGUOUS_AMPERSAND}_stateAmbiguousAmpersand(t){Ns(t)?this._flushCodePointConsumedAsCharacterReference(t):(t===$.SEMICOLON&&this._err(ue.unknownNamedCharacterReference),this._reconsumeInState(this.returnState,t))}_stateNumericCharacterReference(t){this.charRefCode=0,t===$.LATIN_SMALL_X||t===$.LATIN_CAPITAL_X?this.state=z.HEXADEMICAL_CHARACTER_REFERENCE_START:dn(t)?(this.state=z.DECIMAL_CHARACTER_REFERENCE,this._stateDecimalCharacterReference(t)):(this._err(ue.absenceOfDigitsInNumericCharacterReference),this._flushCodePointConsumedAsCharacterReference($.AMPERSAND),this._flushCodePointConsumedAsCharacterReference($.NUMBER_SIGN),this._reconsumeInState(this.returnState,t))}_stateHexademicalCharacterReferenceStart(t){QE(t)?(this.state=z.HEXADEMICAL_CHARACTER_REFERENCE,this._stateHexademicalCharacterReference(t)):(this._err(ue.absenceOfDigitsInNumericCharacterReference),this._flushCodePointConsumedAsCharacterReference($.AMPERSAND),this._flushCodePointConsumedAsCharacterReference($.NUMBER_SIGN),this._unconsume(2),this.state=this.returnState)}_stateHexademicalCharacterReference(t){uc(t)?this.charRefCode=this.charRefCode*16+t-55:lc(t)?this.charRefCode=this.charRefCode*16+t-87:dn(t)?this.charRefCode=this.charRefCode*16+t-48:t===$.SEMICOLON?this.state=z.NUMERIC_CHARACTER_REFERENCE_END:(this._err(ue.missingSemicolonAfterCharacterReference),this.state=z.NUMERIC_CHARACTER_REFERENCE_END,this._stateNumericCharacterReferenceEnd(t))}_stateDecimalCharacterReference(t){dn(t)?this.charRefCode=this.charRefCode*10+t-48:t===$.SEMICOLON?this.state=z.NUMERIC_CHARACTER_REFERENCE_END:(this._err(ue.missingSemicolonAfterCharacterReference),this.state=z.NUMERIC_CHARACTER_REFERENCE_END,this._stateNumericCharacterReferenceEnd(t))}_stateNumericCharacterReferenceEnd(t){if(this.charRefCode===$.NULL)this._err(ue.nullCharacterReference),this.charRefCode=$.REPLACEMENT_CHARACTER;else if(this.charRefCode>1114111)this._err(ue.characterReferenceOutsideUnicodeRange),this.charRefCode=$.REPLACEMENT_CHARACTER;else if(nc(this.charRefCode))this._err(ue.surrogateCharacterReference),this.charRefCode=$.REPLACEMENT_CHARACTER;else if(sc(this.charRefCode))this._err(ue.noncharacterCharacterReference);else if(ic(this.charRefCode)||this.charRefCode===$.CARRIAGE_RETURN){this._err(ue.controlCharacterReference);const r=jE.get(this.charRefCode);r!==void 0&&(this.charRefCode=r)}this._flushCodePointConsumedAsCharacterReference(this.charRefCode),this._reconsumeInState(this.returnState,t)}};const fc=new Set([C.DD,C.DT,C.LI,C.OPTGROUP,C.OPTION,C.P,C.RB,C.RP,C.RT,C.RTC]),Wo=new Set([...fc,C.CAPTION,C.COLGROUP,C.TBODY,C.TD,C.TFOOT,C.TH,C.THEAD,C.TR]),Vn=new Map([[C.APPLET,ce.HTML],[C.CAPTION,ce.HTML],[C.HTML,ce.HTML],[C.MARQUEE,ce.HTML],[C.OBJECT,ce.HTML],[C.TABLE,ce.HTML],[C.TD,ce.HTML],[C.TEMPLATE,ce.HTML],[C.TH,ce.HTML],[C.ANNOTATION_XML,ce.MATHML],[C.MI,ce.MATHML],[C.MN,ce.MATHML],[C.MO,ce.MATHML],[C.MS,ce.MATHML],[C.MTEXT,ce.MATHML],[C.DESC,ce.SVG],[C.FOREIGN_OBJECT,ce.SVG],[C.TITLE,ce.SVG]]),qE=[C.H1,C.H2,C.H3,C.H4,C.H5,C.H6],JE=[C.TR,C.TEMPLATE,C.HTML],ZE=[C.TBODY,C.TFOOT,C.THEAD,C.TEMPLATE,C.HTML],ev=[C.TABLE,C.TEMPLATE,C.HTML],tv=[C.TD,C.TH];class rv{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(t,r,n){this.treeAdapter=r,this.handler=n,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=C.UNKNOWN,this.current=t}_indexOf(t){return this.items.lastIndexOf(t,this.stackTop)}_isInTemplate(){return this.currentTagId===C.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===ce.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(t,r){this.stackTop++,this.items[this.stackTop]=t,this.current=t,this.tagIDs[this.stackTop]=r,this.currentTagId=r,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(t,r,!0)}pop(){const t=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,!0)}replace(t,r){const n=this._indexOf(t);this.items[n]=r,n===this.stackTop&&(this.current=r)}insertAfter(t,r,n){const i=this._indexOf(t)+1;this.items.splice(i,0,r),this.tagIDs.splice(i,0,n),this.stackTop++,i===this.stackTop&&this._updateCurrentElement(),this.handler.onItemPush(this.current,this.currentTagId,i===this.stackTop)}popUntilTagNamePopped(t){let r=this.stackTop+1;do r=this.tagIDs.lastIndexOf(t,r-1);while(r>0&&this.treeAdapter.getNamespaceURI(this.items[r])!==ce.HTML);this.shortenToLength(r<0?0:r)}shortenToLength(t){for(;this.stackTop>=t;){const r=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(r,this.stackTop<t)}}popUntilElementPopped(t){const r=this._indexOf(t);this.shortenToLength(r<0?0:r)}popUntilPopped(t,r){const n=this._indexOfTagNames(t,r);this.shortenToLength(n<0?0:n)}popUntilNumberedHeaderPopped(){this.popUntilPopped(qE,ce.HTML)}popUntilTableCellPopped(){this.popUntilPopped(tv,ce.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(t,r){for(let n=this.stackTop;n>=0;n--)if(t.includes(this.tagIDs[n])&&this.treeAdapter.getNamespaceURI(this.items[n])===r)return n;return-1}clearBackTo(t,r){const n=this._indexOfTagNames(t,r);this.shortenToLength(n+1)}clearBackToTableContext(){this.clearBackTo(ev,ce.HTML)}clearBackToTableBodyContext(){this.clearBackTo(ZE,ce.HTML)}clearBackToTableRowContext(){this.clearBackTo(JE,ce.HTML)}remove(t){const r=this._indexOf(t);r>=0&&(r===this.stackTop?this.pop():(this.items.splice(r,1),this.tagIDs.splice(r,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===C.BODY?this.items[1]:null}contains(t){return this._indexOf(t)>-1}getCommonAncestor(t){const r=this._indexOf(t)-1;return r>=0?this.items[r]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===C.HTML}hasInScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r],i=this.treeAdapter.getNamespaceURI(this.items[r]);if(n===t&&i===ce.HTML)return!0;if(Vn.get(n)===i)return!1}return!0}hasNumberedHeaderInScope(){for(let t=this.stackTop;t>=0;t--){const r=this.tagIDs[t],n=this.treeAdapter.getNamespaceURI(this.items[t]);if(oc(r)&&n===ce.HTML)return!0;if(Vn.get(r)===n)return!1}return!0}hasInListItemScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r],i=this.treeAdapter.getNamespaceURI(this.items[r]);if(n===t&&i===ce.HTML)return!0;if((n===C.UL||n===C.OL)&&i===ce.HTML||Vn.get(n)===i)return!1}return!0}hasInButtonScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r],i=this.treeAdapter.getNamespaceURI(this.items[r]);if(n===t&&i===ce.HTML)return!0;if(n===C.BUTTON&&i===ce.HTML||Vn.get(n)===i)return!1}return!0}hasInTableScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r];if(this.treeAdapter.getNamespaceURI(this.items[r])===ce.HTML){if(n===t)return!0;if(n===C.TABLE||n===C.TEMPLATE||n===C.HTML)return!1}}return!0}hasTableBodyContextInTableScope(){for(let t=this.stackTop;t>=0;t--){const r=this.tagIDs[t];if(this.treeAdapter.getNamespaceURI(this.items[t])===ce.HTML){if(r===C.TBODY||r===C.THEAD||r===C.TFOOT)return!0;if(r===C.TABLE||r===C.HTML)return!1}}return!0}hasInSelectScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r];if(this.treeAdapter.getNamespaceURI(this.items[r])===ce.HTML){if(n===t)return!0;if(n!==C.OPTION&&n!==C.OPTGROUP)return!1}}return!0}generateImpliedEndTags(){for(;fc.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;Wo.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(t){for(;this.currentTagId!==t&&Wo.has(this.currentTagId);)this.pop()}}const os=3;var bt;(function(e){e[e.Marker=0]="Marker",e[e.Element=1]="Element"})(bt=bt||(bt={}));const Go={type:bt.Marker};class nv{constructor(t){this.treeAdapter=t,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(t,r){const n=[],i=r.length,p=this.treeAdapter.getTagName(t),O=this.treeAdapter.getNamespaceURI(t);for(let I=0;I<this.entries.length;I++){const s=this.entries[I];if(s.type===bt.Marker)break;const{element:R}=s;if(this.treeAdapter.getTagName(R)===p&&this.treeAdapter.getNamespaceURI(R)===O){const A=this.treeAdapter.getAttrList(R);A.length===i&&n.push({idx:I,attrs:A})}}return n}_ensureNoahArkCondition(t){if(this.entries.length<os)return;const r=this.treeAdapter.getAttrList(t),n=this._getNoahArkConditionCandidates(t,r);if(n.length<os)return;const i=new Map(r.map(O=>[O.name,O.value]));let p=0;for(let O=0;O<n.length;O++){const I=n[O];I.attrs.every(s=>i.get(s.name)===s.value)&&(p+=1,p>=os&&this.entries.splice(I.idx,1))}}insertMarker(){this.entries.unshift(Go)}pushElement(t,r){this._ensureNoahArkCondition(t),this.entries.unshift({type:bt.Element,element:t,token:r})}insertElementAfterBookmark(t,r){const n=this.entries.indexOf(this.bookmark);this.entries.splice(n,0,{type:bt.Element,element:t,token:r})}removeEntry(t){const r=this.entries.indexOf(t);r>=0&&this.entries.splice(r,1)}clearToLastMarker(){const t=this.entries.indexOf(Go);t>=0?this.entries.splice(0,t+1):this.entries.length=0}getElementEntryInScopeWithTagName(t){const r=this.entries.find(n=>n.type===bt.Marker||this.treeAdapter.getTagName(n.element)===t);return r&&r.type===bt.Element?r:null}getElementEntry(t){return this.entries.find(r=>r.type===bt.Element&&r.element===t)}}function Yo(e){return{nodeName:"#text",value:e,parentNode:null}}const gr={createDocument(){return{nodeName:"#document",mode:ot.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(e,t,r){return{nodeName:e,tagName:e,attrs:r,namespaceURI:t,childNodes:[],parentNode:null}},createCommentNode(e){return{nodeName:"#comment",data:e,parentNode:null}},appendChild(e,t){e.childNodes.push(t),t.parentNode=e},insertBefore(e,t,r){const n=e.childNodes.indexOf(r);e.childNodes.splice(n,0,t),t.parentNode=e},setTemplateContent(e,t){e.content=t},getTemplateContent(e){return e.content},setDocumentType(e,t,r,n){const i=e.childNodes.find(p=>p.nodeName==="#documentType");if(i)i.name=t,i.publicId=r,i.systemId=n;else{const p={nodeName:"#documentType",name:t,publicId:r,systemId:n,parentNode:null};gr.appendChild(e,p)}},setDocumentMode(e,t){e.mode=t},getDocumentMode(e){return e.mode},detachNode(e){if(e.parentNode){const t=e.parentNode.childNodes.indexOf(e);e.parentNode.childNodes.splice(t,1),e.parentNode=null}},insertText(e,t){if(e.childNodes.length>0){const r=e.childNodes[e.childNodes.length-1];if(gr.isTextNode(r)){r.value+=t;return}}gr.appendChild(e,Yo(t))},insertTextBefore(e,t,r){const n=e.childNodes[e.childNodes.indexOf(r)-1];n&&gr.isTextNode(n)?n.value+=t:gr.insertBefore(e,Yo(t),r)},adoptAttributes(e,t){const r=new Set(e.attrs.map(n=>n.name));for(let n=0;n<t.length;n++)r.has(t[n].name)||e.attrs.push(t[n])},getFirstChild(e){return e.childNodes[0]},getChildNodes(e){return e.childNodes},getParentNode(e){return e.parentNode},getAttrList(e){return e.attrs},getTagName(e){return e.tagName},getNamespaceURI(e){return e.namespaceURI},getTextNodeContent(e){return e.value},getCommentNodeContent(e){return e.data},getDocumentTypeNodeName(e){return e.name},getDocumentTypeNodePublicId(e){return e.publicId},getDocumentTypeNodeSystemId(e){return e.systemId},isTextNode(e){return e.nodeName==="#text"},isCommentNode(e){return e.nodeName==="#comment"},isDocumentTypeNode(e){return e.nodeName==="#documentType"},isElementNode(e){return Object.prototype.hasOwnProperty.call(e,"tagName")},setNodeSourceCodeLocation(e,t){e.sourceCodeLocation=t},getNodeSourceCodeLocation(e){return e.sourceCodeLocation},updateNodeSourceCodeLocation(e,t){e.sourceCodeLocation={...e.sourceCodeLocation,...t}}},dc="html",iv="about:legacy-compat",sv="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",hc=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],av=[...hc,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],ov=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),gc=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],uv=[...gc,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function Vo(e,t){return t.some(r=>e.startsWith(r))}function lv(e){return e.name===dc&&e.publicId===null&&(e.systemId===null||e.systemId===iv)}function cv(e){if(e.name!==dc)return ot.QUIRKS;const{systemId:t}=e;if(t&&t.toLowerCase()===sv)return ot.QUIRKS;let{publicId:r}=e;if(r!==null){if(r=r.toLowerCase(),ov.has(r))return ot.QUIRKS;let n=t===null?av:hc;if(Vo(r,n))return ot.QUIRKS;if(n=t===null?gc:uv,Vo(r,n))return ot.LIMITED_QUIRKS}return ot.NO_QUIRKS}const jo={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},fv="definitionurl",dv="definitionURL",hv=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),gv=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:ce.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:ce.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:ce.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:ce.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:ce.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:ce.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:ce.XLINK}],["xml:base",{prefix:"xml",name:"base",namespace:ce.XML}],["xml:lang",{prefix:"xml",name:"lang",namespace:ce.XML}],["xml:space",{prefix:"xml",name:"space",namespace:ce.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:ce.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:ce.XMLNS}]]),mv=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(e=>[e.toLowerCase(),e])),Ev=new Set([C.B,C.BIG,C.BLOCKQUOTE,C.BODY,C.BR,C.CENTER,C.CODE,C.DD,C.DIV,C.DL,C.DT,C.EM,C.EMBED,C.H1,C.H2,C.H3,C.H4,C.H5,C.H6,C.HEAD,C.HR,C.I,C.IMG,C.LI,C.LISTING,C.MENU,C.META,C.NOBR,C.OL,C.P,C.PRE,C.RUBY,C.S,C.SMALL,C.SPAN,C.STRONG,C.STRIKE,C.SUB,C.SUP,C.TABLE,C.TT,C.U,C.UL,C.VAR]);function vv(e){const t=e.tagID;return t===C.FONT&&e.attrs.some(({name:n})=>n===nr.COLOR||n===nr.SIZE||n===nr.FACE)||Ev.has(t)}function mc(e){for(let t=0;t<e.attrs.length;t++)if(e.attrs[t].name===fv){e.attrs[t].name=dv;break}}function Ec(e){for(let t=0;t<e.attrs.length;t++){const r=hv.get(e.attrs[t].name);r!=null&&(e.attrs[t].name=r)}}function ba(e){for(let t=0;t<e.attrs.length;t++){const r=gv.get(e.attrs[t].name);r&&(e.attrs[t].prefix=r.prefix,e.attrs[t].name=r.name,e.attrs[t].namespace=r.namespace)}}function pv(e){const t=mv.get(e.tagName);t!=null&&(e.tagName=t,e.tagID=Mi(e.tagName))}function Tv(e,t){return t===ce.MATHML&&(e===C.MI||e===C.MO||e===C.MN||e===C.MS||e===C.MTEXT)}function _v(e,t,r){if(t===ce.MATHML&&e===C.ANNOTATION_XML){for(let n=0;n<r.length;n++)if(r[n].name===nr.ENCODING){const i=r[n].value.toLowerCase();return i===jo.TEXT_HTML||i===jo.APPLICATION_XML}}return t===ce.SVG&&(e===C.FOREIGN_OBJECT||e===C.DESC||e===C.TITLE)}function Av(e,t,r,n){return(!n||n===ce.HTML)&&_v(e,t,r)||(!n||n===ce.MATHML)&&Tv(e,t)}const yv="hidden",bv=8,Sv=3;var te;(function(e){e[e.INITIAL=0]="INITIAL",e[e.BEFORE_HTML=1]="BEFORE_HTML",e[e.BEFORE_HEAD=2]="BEFORE_HEAD",e[e.IN_HEAD=3]="IN_HEAD",e[e.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",e[e.AFTER_HEAD=5]="AFTER_HEAD",e[e.IN_BODY=6]="IN_BODY",e[e.TEXT=7]="TEXT",e[e.IN_TABLE=8]="IN_TABLE",e[e.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",e[e.IN_CAPTION=10]="IN_CAPTION",e[e.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",e[e.IN_TABLE_BODY=12]="IN_TABLE_BODY",e[e.IN_ROW=13]="IN_ROW",e[e.IN_CELL=14]="IN_CELL",e[e.IN_SELECT=15]="IN_SELECT",e[e.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",e[e.IN_TEMPLATE=17]="IN_TEMPLATE",e[e.AFTER_BODY=18]="AFTER_BODY",e[e.IN_FRAMESET=19]="IN_FRAMESET",e[e.AFTER_FRAMESET=20]="AFTER_FRAMESET",e[e.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",e[e.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(te||(te={}));const xv={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},vc=new Set([C.TABLE,C.TBODY,C.TFOOT,C.THEAD,C.TR]),Xo={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:gr,onParseError:null};let pc=class{constructor(t,r,n=null,i=null){this.fragmentContext=n,this.scriptHandler=i,this.currentToken=null,this.stopped=!1,this.insertionMode=te.INITIAL,this.originalInsertionMode=te.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...Xo,...t},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=r??this.treeAdapter.createDocument(),this.tokenizer=new zE(this.options,this),this.activeFormattingElements=new nv(this.treeAdapter),this.fragmentContextID=n?Mi(this.treeAdapter.getTagName(n)):C.UNKNOWN,this._setContextModes(n??this.document,this.fragmentContextID),this.openElements=new rv(this.document,this.treeAdapter,this)}static parse(t,r){const n=new this(r);return n.tokenizer.write(t,!0),n.document}static getFragmentParser(t,r){const n={...Xo,...r};t??(t=n.treeAdapter.createElement(se.TEMPLATE,ce.HTML,[]));const i=n.treeAdapter.createElement("documentmock",ce.HTML,[]),p=new this(n,i,t);return p.fragmentContextID===C.TEMPLATE&&p.tmplInsertionModeStack.unshift(te.IN_TEMPLATE),p._initTokenizerForFragmentParsing(),p._insertFakeRootElement(),p._resetInsertionMode(),p._findFormInFragmentContext(),p}getFragment(){const t=this.treeAdapter.getFirstChild(this.document),r=this.treeAdapter.createDocumentFragment();return this._adoptNodes(t,r),r}_err(t,r,n){var i;if(!this.onParseError)return;const p=(i=t.location)!==null&&i!==void 0?i:xv,O={code:r,startLine:p.startLine,startCol:p.startCol,startOffset:p.startOffset,endLine:n?p.startLine:p.endLine,endCol:n?p.startCol:p.endCol,endOffset:n?p.startOffset:p.endOffset};this.onParseError(O)}onItemPush(t,r,n){var i,p;(p=(i=this.treeAdapter).onItemPush)===null||p===void 0||p.call(i,t),n&&this.openElements.stackTop>0&&this._setContextModes(t,r)}onItemPop(t,r){var n,i;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(t,this.currentToken),(i=(n=this.treeAdapter).onItemPop)===null||i===void 0||i.call(n,t,this.openElements.current),r){let p,O;this.openElements.stackTop===0&&this.fragmentContext?(p=this.fragmentContext,O=this.fragmentContextID):{current:p,currentTagId:O}=this.openElements,this._setContextModes(p,O)}}_setContextModes(t,r){const n=t===this.document||this.treeAdapter.getNamespaceURI(t)===ce.HTML;this.currentNotInHTML=!n,this.tokenizer.inForeignNode=!n&&!this._isIntegrationPoint(r,t)}_switchToTextParsing(t,r){this._insertElement(t,ce.HTML),this.tokenizer.state=r,this.originalInsertionMode=this.insertionMode,this.insertionMode=te.TEXT}switchToPlaintextParsing(){this.insertionMode=te.TEXT,this.originalInsertionMode=te.IN_BODY,this.tokenizer.state=ut.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let t=this.fragmentContext;for(;t;){if(this.treeAdapter.getTagName(t)===se.FORM){this.formElement=t;break}t=this.treeAdapter.getParentNode(t)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==ce.HTML))switch(this.fragmentContextID){case C.TITLE:case C.TEXTAREA:{this.tokenizer.state=ut.RCDATA;break}case C.STYLE:case C.XMP:case C.IFRAME:case C.NOEMBED:case C.NOFRAMES:case C.NOSCRIPT:{this.tokenizer.state=ut.RAWTEXT;break}case C.SCRIPT:{this.tokenizer.state=ut.SCRIPT_DATA;break}case C.PLAINTEXT:{this.tokenizer.state=ut.PLAINTEXT;break}}}_setDocumentType(t){const r=t.name||"",n=t.publicId||"",i=t.systemId||"";if(this.treeAdapter.setDocumentType(this.document,r,n,i),t.location){const O=this.treeAdapter.getChildNodes(this.document).find(I=>this.treeAdapter.isDocumentTypeNode(I));O&&this.treeAdapter.setNodeSourceCodeLocation(O,t.location)}}_attachElementToTree(t,r){if(this.options.sourceCodeLocationInfo){const n=r&&{...r,startTag:r};this.treeAdapter.setNodeSourceCodeLocation(t,n)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(t);else{const n=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(n,t)}}_appendElement(t,r){const n=this.treeAdapter.createElement(t.tagName,r,t.attrs);this._attachElementToTree(n,t.location)}_insertElement(t,r){const n=this.treeAdapter.createElement(t.tagName,r,t.attrs);this._attachElementToTree(n,t.location),this.openElements.push(n,t.tagID)}_insertFakeElement(t,r){const n=this.treeAdapter.createElement(t,ce.HTML,[]);this._attachElementToTree(n,null),this.openElements.push(n,r)}_insertTemplate(t){const r=this.treeAdapter.createElement(t.tagName,ce.HTML,t.attrs),n=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(r,n),this._attachElementToTree(r,t.location),this.openElements.push(r,t.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(n,null)}_insertFakeRootElement(){const t=this.treeAdapter.createElement(se.HTML,ce.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(t,null),this.treeAdapter.appendChild(this.openElements.current,t),this.openElements.push(t,C.HTML)}_appendCommentNode(t,r){const n=this.treeAdapter.createCommentNode(t.data);this.treeAdapter.appendChild(r,n),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(n,t.location)}_insertCharacters(t){let r,n;if(this._shouldFosterParentOnInsertion()?({parent:r,beforeElement:n}=this._findFosterParentingLocation(),n?this.treeAdapter.insertTextBefore(r,t.chars,n):this.treeAdapter.insertText(r,t.chars)):(r=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(r,t.chars)),!t.location)return;const i=this.treeAdapter.getChildNodes(r),p=n?i.lastIndexOf(n):i.length,O=i[p-1];if(this.treeAdapter.getNodeSourceCodeLocation(O)){const{endLine:s,endCol:R,endOffset:A}=t.location;this.treeAdapter.updateNodeSourceCodeLocation(O,{endLine:s,endCol:R,endOffset:A})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(O,t.location)}_adoptNodes(t,r){for(let n=this.treeAdapter.getFirstChild(t);n;n=this.treeAdapter.getFirstChild(t))this.treeAdapter.detachNode(n),this.treeAdapter.appendChild(r,n)}_setEndLocation(t,r){if(this.treeAdapter.getNodeSourceCodeLocation(t)&&r.location){const n=r.location,i=this.treeAdapter.getTagName(t),p=r.type===Ce.END_TAG&&i===r.tagName?{endTag:{...n},endLine:n.endLine,endCol:n.endCol,endOffset:n.endOffset}:{endLine:n.startLine,endCol:n.startCol,endOffset:n.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(t,p)}}shouldProcessStartTagTokenInForeignContent(t){if(!this.currentNotInHTML)return!1;let r,n;return this.openElements.stackTop===0&&this.fragmentContext?(r=this.fragmentContext,n=this.fragmentContextID):{current:r,currentTagId:n}=this.openElements,t.tagID===C.SVG&&this.treeAdapter.getTagName(r)===se.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(r)===ce.MATHML?!1:this.tokenizer.inForeignNode||(t.tagID===C.MGLYPH||t.tagID===C.MALIGNMARK)&&!this._isIntegrationPoint(n,r,ce.HTML)}_processToken(t){switch(t.type){case Ce.CHARACTER:{this.onCharacter(t);break}case Ce.NULL_CHARACTER:{this.onNullCharacter(t);break}case Ce.COMMENT:{this.onComment(t);break}case Ce.DOCTYPE:{this.onDoctype(t);break}case Ce.START_TAG:{this._processStartTag(t);break}case Ce.END_TAG:{this.onEndTag(t);break}case Ce.EOF:{this.onEof(t);break}case Ce.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(t);break}}}_isIntegrationPoint(t,r,n){const i=this.treeAdapter.getNamespaceURI(r),p=this.treeAdapter.getAttrList(r);return Av(t,i,p,n)}_reconstructActiveFormattingElements(){const t=this.activeFormattingElements.entries.length;if(t){const r=this.activeFormattingElements.entries.findIndex(i=>i.type===bt.Marker||this.openElements.contains(i.element)),n=r<0?t-1:r-1;for(let i=n;i>=0;i--){const p=this.activeFormattingElements.entries[i];this._insertElement(p.token,this.treeAdapter.getNamespaceURI(p.element)),p.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=te.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(C.P),this.openElements.popUntilTagNamePopped(C.P)}_resetInsertionMode(){for(let t=this.openElements.stackTop;t>=0;t--)switch(t===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[t]){case C.TR:{this.insertionMode=te.IN_ROW;return}case C.TBODY:case C.THEAD:case C.TFOOT:{this.insertionMode=te.IN_TABLE_BODY;return}case C.CAPTION:{this.insertionMode=te.IN_CAPTION;return}case C.COLGROUP:{this.insertionMode=te.IN_COLUMN_GROUP;return}case C.TABLE:{this.insertionMode=te.IN_TABLE;return}case C.BODY:{this.insertionMode=te.IN_BODY;return}case C.FRAMESET:{this.insertionMode=te.IN_FRAMESET;return}case C.SELECT:{this._resetInsertionModeForSelect(t);return}case C.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case C.HTML:{this.insertionMode=this.headElement?te.AFTER_HEAD:te.BEFORE_HEAD;return}case C.TD:case C.TH:{if(t>0){this.insertionMode=te.IN_CELL;return}break}case C.HEAD:{if(t>0){this.insertionMode=te.IN_HEAD;return}break}}this.insertionMode=te.IN_BODY}_resetInsertionModeForSelect(t){if(t>0)for(let r=t-1;r>0;r--){const n=this.openElements.tagIDs[r];if(n===C.TEMPLATE)break;if(n===C.TABLE){this.insertionMode=te.IN_SELECT_IN_TABLE;return}}this.insertionMode=te.IN_SELECT}_isElementCausesFosterParenting(t){return vc.has(t)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let t=this.openElements.stackTop;t>=0;t--){const r=this.openElements.items[t];switch(this.openElements.tagIDs[t]){case C.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(r)===ce.HTML)return{parent:this.treeAdapter.getTemplateContent(r),beforeElement:null};break}case C.TABLE:{const n=this.treeAdapter.getParentNode(r);return n?{parent:n,beforeElement:r}:{parent:this.openElements.items[t-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(t){const r=this._findFosterParentingLocation();r.beforeElement?this.treeAdapter.insertBefore(r.parent,t,r.beforeElement):this.treeAdapter.appendChild(r.parent,t)}_isSpecialElement(t,r){const n=this.treeAdapter.getNamespaceURI(t);return GE[n].has(r)}onCharacter(t){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){tT(this,t);return}switch(this.insertionMode){case te.INITIAL:{rn(this,t);break}case te.BEFORE_HTML:{hn(this,t);break}case te.BEFORE_HEAD:{gn(this,t);break}case te.IN_HEAD:{mn(this,t);break}case te.IN_HEAD_NO_SCRIPT:{En(this,t);break}case te.AFTER_HEAD:{vn(this,t);break}case te.IN_BODY:case te.IN_CAPTION:case te.IN_CELL:case te.IN_TEMPLATE:{_c(this,t);break}case te.TEXT:case te.IN_SELECT:case te.IN_SELECT_IN_TABLE:{this._insertCharacters(t);break}case te.IN_TABLE:case te.IN_TABLE_BODY:case te.IN_ROW:{us(this,t);break}case te.IN_TABLE_TEXT:{Ic(this,t);break}case te.IN_COLUMN_GROUP:{hi(this,t);break}case te.AFTER_BODY:{gi(this,t);break}case te.AFTER_AFTER_BODY:{Zn(this,t);break}}}onNullCharacter(t){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){eT(this,t);return}switch(this.insertionMode){case te.INITIAL:{rn(this,t);break}case te.BEFORE_HTML:{hn(this,t);break}case te.BEFORE_HEAD:{gn(this,t);break}case te.IN_HEAD:{mn(this,t);break}case te.IN_HEAD_NO_SCRIPT:{En(this,t);break}case te.AFTER_HEAD:{vn(this,t);break}case te.TEXT:{this._insertCharacters(t);break}case te.IN_TABLE:case te.IN_TABLE_BODY:case te.IN_ROW:{us(this,t);break}case te.IN_COLUMN_GROUP:{hi(this,t);break}case te.AFTER_BODY:{gi(this,t);break}case te.AFTER_AFTER_BODY:{Zn(this,t);break}}}onComment(t){if(this.skipNextNewLine=!1,this.currentNotInHTML){Ms(this,t);return}switch(this.insertionMode){case te.INITIAL:case te.BEFORE_HTML:case te.BEFORE_HEAD:case te.IN_HEAD:case te.IN_HEAD_NO_SCRIPT:case te.AFTER_HEAD:case te.IN_BODY:case te.IN_TABLE:case te.IN_CAPTION:case te.IN_COLUMN_GROUP:case te.IN_TABLE_BODY:case te.IN_ROW:case te.IN_CELL:case te.IN_SELECT:case te.IN_SELECT_IN_TABLE:case te.IN_TEMPLATE:case te.IN_FRAMESET:case te.AFTER_FRAMESET:{Ms(this,t);break}case te.IN_TABLE_TEXT:{nn(this,t);break}case te.AFTER_BODY:{Pv(this,t);break}case te.AFTER_AFTER_BODY:case te.AFTER_AFTER_FRAMESET:{Nv(this,t);break}}}onDoctype(t){switch(this.skipNextNewLine=!1,this.insertionMode){case te.INITIAL:{Mv(this,t);break}case te.BEFORE_HEAD:case te.IN_HEAD:case te.IN_HEAD_NO_SCRIPT:case te.AFTER_HEAD:{this._err(t,ue.misplacedDoctype);break}case te.IN_TABLE_TEXT:{nn(this,t);break}}}onStartTag(t){this.skipNextNewLine=!1,this.currentToken=t,this._processStartTag(t),t.selfClosing&&!t.ackSelfClosing&&this._err(t,ue.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(t){this.shouldProcessStartTagTokenInForeignContent(t)?rT(this,t):this._startTagOutsideForeignContent(t)}_startTagOutsideForeignContent(t){switch(this.insertionMode){case te.INITIAL:{rn(this,t);break}case te.BEFORE_HTML:{Fv(this,t);break}case te.BEFORE_HEAD:{Bv(this,t);break}case te.IN_HEAD:{Rt(this,t);break}case te.IN_HEAD_NO_SCRIPT:{Hv(this,t);break}case te.AFTER_HEAD:{Wv(this,t);break}case te.IN_BODY:{Ze(this,t);break}case te.IN_TABLE:{jr(this,t);break}case te.IN_TABLE_TEXT:{nn(this,t);break}case te.IN_CAPTION:{wp(this,t);break}case te.IN_COLUMN_GROUP:{Ia(this,t);break}case te.IN_TABLE_BODY:{Bi(this,t);break}case te.IN_ROW:{wi(this,t);break}case te.IN_CELL:{Kp(this,t);break}case te.IN_SELECT:{Dc(this,t);break}case te.IN_SELECT_IN_TABLE:{Gp(this,t);break}case te.IN_TEMPLATE:{Vp(this,t);break}case te.AFTER_BODY:{Xp(this,t);break}case te.IN_FRAMESET:{Qp(this,t);break}case te.AFTER_FRAMESET:{zp(this,t);break}case te.AFTER_AFTER_BODY:{Jp(this,t);break}case te.AFTER_AFTER_FRAMESET:{Zp(this,t);break}}}onEndTag(t){this.skipNextNewLine=!1,this.currentToken=t,this.currentNotInHTML?nT(this,t):this._endTagOutsideForeignContent(t)}_endTagOutsideForeignContent(t){switch(this.insertionMode){case te.INITIAL:{rn(this,t);break}case te.BEFORE_HTML:{kv(this,t);break}case te.BEFORE_HEAD:{wv(this,t);break}case te.IN_HEAD:{Uv(this,t);break}case te.IN_HEAD_NO_SCRIPT:{Kv(this,t);break}case te.AFTER_HEAD:{Gv(this,t);break}case te.IN_BODY:{ki(this,t);break}case te.TEXT:{Lp(this,t);break}case te.IN_TABLE:{Dn(this,t);break}case te.IN_TABLE_TEXT:{nn(this,t);break}case te.IN_CAPTION:{Up(this,t);break}case te.IN_COLUMN_GROUP:{Hp(this,t);break}case te.IN_TABLE_BODY:{Fs(this,t);break}case te.IN_ROW:{Lc(this,t);break}case te.IN_CELL:{Wp(this,t);break}case te.IN_SELECT:{Rc(this,t);break}case te.IN_SELECT_IN_TABLE:{Yp(this,t);break}case te.IN_TEMPLATE:{jp(this,t);break}case te.AFTER_BODY:{Pc(this,t);break}case te.IN_FRAMESET:{$p(this,t);break}case te.AFTER_FRAMESET:{qp(this,t);break}case te.AFTER_AFTER_BODY:{Zn(this,t);break}}}onEof(t){switch(this.insertionMode){case te.INITIAL:{rn(this,t);break}case te.BEFORE_HTML:{hn(this,t);break}case te.BEFORE_HEAD:{gn(this,t);break}case te.IN_HEAD:{mn(this,t);break}case te.IN_HEAD_NO_SCRIPT:{En(this,t);break}case te.AFTER_HEAD:{vn(this,t);break}case te.IN_BODY:case te.IN_TABLE:case te.IN_CAPTION:case te.IN_COLUMN_GROUP:case te.IN_TABLE_BODY:case te.IN_ROW:case te.IN_CELL:case te.IN_SELECT:case te.IN_SELECT_IN_TABLE:{Sc(this,t);break}case te.TEXT:{Dp(this,t);break}case te.IN_TABLE_TEXT:{nn(this,t);break}case te.IN_TEMPLATE:{Oc(this,t);break}case te.AFTER_BODY:case te.IN_FRAMESET:case te.AFTER_FRAMESET:case te.AFTER_AFTER_BODY:case te.AFTER_AFTER_FRAMESET:{xa(this,t);break}}}onWhitespaceCharacter(t){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,t.chars.charCodeAt(0)===$.LINE_FEED)){if(t.chars.length===1)return;t.chars=t.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(t);return}switch(this.insertionMode){case te.IN_HEAD:case te.IN_HEAD_NO_SCRIPT:case te.AFTER_HEAD:case te.TEXT:case te.IN_COLUMN_GROUP:case te.IN_SELECT:case te.IN_SELECT_IN_TABLE:case te.IN_FRAMESET:case te.AFTER_FRAMESET:{this._insertCharacters(t);break}case te.IN_BODY:case te.IN_CAPTION:case te.IN_CELL:case te.IN_TEMPLATE:case te.AFTER_BODY:case te.AFTER_AFTER_BODY:case te.AFTER_AFTER_FRAMESET:{Tc(this,t);break}case te.IN_TABLE:case te.IN_TABLE_BODY:case te.IN_ROW:{us(this,t);break}case te.IN_TABLE_TEXT:{xc(this,t);break}}}};function Iv(e,t){let r=e.activeFormattingElements.getElementEntryInScopeWithTagName(t.tagName);return r?e.openElements.contains(r.element)?e.openElements.hasInScope(t.tagID)||(r=null):(e.activeFormattingElements.removeEntry(r),r=null):bc(e,t),r}function Cv(e,t){let r=null,n=e.openElements.stackTop;for(;n>=0;n--){const i=e.openElements.items[n];if(i===t.element)break;e._isSpecialElement(i,e.openElements.tagIDs[n])&&(r=i)}return r||(e.openElements.shortenToLength(n<0?0:n),e.activeFormattingElements.removeEntry(t)),r}function Lv(e,t,r){let n=t,i=e.openElements.getCommonAncestor(t);for(let p=0,O=i;O!==r;p++,O=i){i=e.openElements.getCommonAncestor(O);const I=e.activeFormattingElements.getElementEntry(O),s=I&&p>=Sv;!I||s?(s&&e.activeFormattingElements.removeEntry(I),e.openElements.remove(O)):(O=Dv(e,I),n===t&&(e.activeFormattingElements.bookmark=I),e.treeAdapter.detachNode(n),e.treeAdapter.appendChild(O,n),n=O)}return n}function Dv(e,t){const r=e.treeAdapter.getNamespaceURI(t.element),n=e.treeAdapter.createElement(t.token.tagName,r,t.token.attrs);return e.openElements.replace(t.element,n),t.element=n,n}function Rv(e,t,r){const n=e.treeAdapter.getTagName(t),i=Mi(n);if(e._isElementCausesFosterParenting(i))e._fosterParentElement(r);else{const p=e.treeAdapter.getNamespaceURI(t);i===C.TEMPLATE&&p===ce.HTML&&(t=e.treeAdapter.getTemplateContent(t)),e.treeAdapter.appendChild(t,r)}}function Ov(e,t,r){const n=e.treeAdapter.getNamespaceURI(r.element),{token:i}=r,p=e.treeAdapter.createElement(i.tagName,n,i.attrs);e._adoptNodes(t,p),e.treeAdapter.appendChild(t,p),e.activeFormattingElements.insertElementAfterBookmark(p,i),e.activeFormattingElements.removeEntry(r),e.openElements.remove(r.element),e.openElements.insertAfter(t,p,i.tagID)}function Sa(e,t){for(let r=0;r<bv;r++){const n=Iv(e,t);if(!n)break;const i=Cv(e,n);if(!i)break;e.activeFormattingElements.bookmark=n;const p=Lv(e,i,n.element),O=e.openElements.getCommonAncestor(n.element);e.treeAdapter.detachNode(p),O&&Rv(e,O,p),Ov(e,i,n)}}function Ms(e,t){e._appendCommentNode(t,e.openElements.currentTmplContentOrNode)}function Pv(e,t){e._appendCommentNode(t,e.openElements.items[0])}function Nv(e,t){e._appendCommentNode(t,e.document)}function xa(e,t){if(e.stopped=!0,t.location){const r=e.fragmentContext?0:2;for(let n=e.openElements.stackTop;n>=r;n--)e._setEndLocation(e.openElements.items[n],t);if(!e.fragmentContext&&e.openElements.stackTop>=0){const n=e.openElements.items[0],i=e.treeAdapter.getNodeSourceCodeLocation(n);if(i&&!i.endTag&&(e._setEndLocation(n,t),e.openElements.stackTop>=1)){const p=e.openElements.items[1],O=e.treeAdapter.getNodeSourceCodeLocation(p);O&&!O.endTag&&e._setEndLocation(p,t)}}}}function Mv(e,t){e._setDocumentType(t);const r=t.forceQuirks?ot.QUIRKS:cv(t);lv(t)||e._err(t,ue.nonConformingDoctype),e.treeAdapter.setDocumentMode(e.document,r),e.insertionMode=te.BEFORE_HTML}function rn(e,t){e._err(t,ue.missingDoctype,!0),e.treeAdapter.setDocumentMode(e.document,ot.QUIRKS),e.insertionMode=te.BEFORE_HTML,e._processToken(t)}function Fv(e,t){t.tagID===C.HTML?(e._insertElement(t,ce.HTML),e.insertionMode=te.BEFORE_HEAD):hn(e,t)}function kv(e,t){const r=t.tagID;(r===C.HTML||r===C.HEAD||r===C.BODY||r===C.BR)&&hn(e,t)}function hn(e,t){e._insertFakeRootElement(),e.insertionMode=te.BEFORE_HEAD,e._processToken(t)}function Bv(e,t){switch(t.tagID){case C.HTML:{Ze(e,t);break}case C.HEAD:{e._insertElement(t,ce.HTML),e.headElement=e.openElements.current,e.insertionMode=te.IN_HEAD;break}default:gn(e,t)}}function wv(e,t){const r=t.tagID;r===C.HEAD||r===C.BODY||r===C.HTML||r===C.BR?gn(e,t):e._err(t,ue.endTagWithoutMatchingOpenElement)}function gn(e,t){e._insertFakeElement(se.HEAD,C.HEAD),e.headElement=e.openElements.current,e.insertionMode=te.IN_HEAD,e._processToken(t)}function Rt(e,t){switch(t.tagID){case C.HTML:{Ze(e,t);break}case C.BASE:case C.BASEFONT:case C.BGSOUND:case C.LINK:case C.META:{e._appendElement(t,ce.HTML),t.ackSelfClosing=!0;break}case C.TITLE:{e._switchToTextParsing(t,ut.RCDATA);break}case C.NOSCRIPT:{e.options.scriptingEnabled?e._switchToTextParsing(t,ut.RAWTEXT):(e._insertElement(t,ce.HTML),e.insertionMode=te.IN_HEAD_NO_SCRIPT);break}case C.NOFRAMES:case C.STYLE:{e._switchToTextParsing(t,ut.RAWTEXT);break}case C.SCRIPT:{e._switchToTextParsing(t,ut.SCRIPT_DATA);break}case C.TEMPLATE:{e._insertTemplate(t),e.activeFormattingElements.insertMarker(),e.framesetOk=!1,e.insertionMode=te.IN_TEMPLATE,e.tmplInsertionModeStack.unshift(te.IN_TEMPLATE);break}case C.HEAD:{e._err(t,ue.misplacedStartTagForHeadElement);break}default:mn(e,t)}}function Uv(e,t){switch(t.tagID){case C.HEAD:{e.openElements.pop(),e.insertionMode=te.AFTER_HEAD;break}case C.BODY:case C.BR:case C.HTML:{mn(e,t);break}case C.TEMPLATE:{Ir(e,t);break}default:e._err(t,ue.endTagWithoutMatchingOpenElement)}}function Ir(e,t){e.openElements.tmplCount>0?(e.openElements.generateImpliedEndTagsThoroughly(),e.openElements.currentTagId!==C.TEMPLATE&&e._err(t,ue.closingOfElementWithOpenChildElements),e.openElements.popUntilTagNamePopped(C.TEMPLATE),e.activeFormattingElements.clearToLastMarker(),e.tmplInsertionModeStack.shift(),e._resetInsertionMode()):e._err(t,ue.endTagWithoutMatchingOpenElement)}function mn(e,t){e.openElements.pop(),e.insertionMode=te.AFTER_HEAD,e._processToken(t)}function Hv(e,t){switch(t.tagID){case C.HTML:{Ze(e,t);break}case C.BASEFONT:case C.BGSOUND:case C.HEAD:case C.LINK:case C.META:case C.NOFRAMES:case C.STYLE:{Rt(e,t);break}case C.NOSCRIPT:{e._err(t,ue.nestedNoscriptInHead);break}default:En(e,t)}}function Kv(e,t){switch(t.tagID){case C.NOSCRIPT:{e.openElements.pop(),e.insertionMode=te.IN_HEAD;break}case C.BR:{En(e,t);break}default:e._err(t,ue.endTagWithoutMatchingOpenElement)}}function En(e,t){const r=t.type===Ce.EOF?ue.openElementsLeftAfterEof:ue.disallowedContentInNoscriptInHead;e._err(t,r),e.openElements.pop(),e.insertionMode=te.IN_HEAD,e._processToken(t)}function Wv(e,t){switch(t.tagID){case C.HTML:{Ze(e,t);break}case C.BODY:{e._insertElement(t,ce.HTML),e.framesetOk=!1,e.insertionMode=te.IN_BODY;break}case C.FRAMESET:{e._insertElement(t,ce.HTML),e.insertionMode=te.IN_FRAMESET;break}case C.BASE:case C.BASEFONT:case C.BGSOUND:case C.LINK:case C.META:case C.NOFRAMES:case C.SCRIPT:case C.STYLE:case C.TEMPLATE:case C.TITLE:{e._err(t,ue.abandonedHeadElementChild),e.openElements.push(e.headElement,C.HEAD),Rt(e,t),e.openElements.remove(e.headElement);break}case C.HEAD:{e._err(t,ue.misplacedStartTagForHeadElement);break}default:vn(e,t)}}function Gv(e,t){switch(t.tagID){case C.BODY:case C.HTML:case C.BR:{vn(e,t);break}case C.TEMPLATE:{Ir(e,t);break}default:e._err(t,ue.endTagWithoutMatchingOpenElement)}}function vn(e,t){e._insertFakeElement(se.BODY,C.BODY),e.insertionMode=te.IN_BODY,Fi(e,t)}function Fi(e,t){switch(t.type){case Ce.CHARACTER:{_c(e,t);break}case Ce.WHITESPACE_CHARACTER:{Tc(e,t);break}case Ce.COMMENT:{Ms(e,t);break}case Ce.START_TAG:{Ze(e,t);break}case Ce.END_TAG:{ki(e,t);break}case Ce.EOF:{Sc(e,t);break}}}function Tc(e,t){e._reconstructActiveFormattingElements(),e._insertCharacters(t)}function _c(e,t){e._reconstructActiveFormattingElements(),e._insertCharacters(t),e.framesetOk=!1}function Yv(e,t){e.openElements.tmplCount===0&&e.treeAdapter.adoptAttributes(e.openElements.items[0],t.attrs)}function Vv(e,t){const r=e.openElements.tryPeekProperlyNestedBodyElement();r&&e.openElements.tmplCount===0&&(e.framesetOk=!1,e.treeAdapter.adoptAttributes(r,t.attrs))}function jv(e,t){const r=e.openElements.tryPeekProperlyNestedBodyElement();e.framesetOk&&r&&(e.treeAdapter.detachNode(r),e.openElements.popAllUpToHtmlElement(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_FRAMESET)}function Xv(e,t){e.openElements.hasInButtonScope(C.P)&&e._closePElement(),e._insertElement(t,ce.HTML)}function Qv(e,t){e.openElements.hasInButtonScope(C.P)&&e._closePElement(),oc(e.openElements.currentTagId)&&e.openElements.pop(),e._insertElement(t,ce.HTML)}function $v(e,t){e.openElements.hasInButtonScope(C.P)&&e._closePElement(),e._insertElement(t,ce.HTML),e.skipNextNewLine=!0,e.framesetOk=!1}function zv(e,t){const r=e.openElements.tmplCount>0;(!e.formElement||r)&&(e.openElements.hasInButtonScope(C.P)&&e._closePElement(),e._insertElement(t,ce.HTML),r||(e.formElement=e.openElements.current))}function qv(e,t){e.framesetOk=!1;const r=t.tagID;for(let n=e.openElements.stackTop;n>=0;n--){const i=e.openElements.tagIDs[n];if(r===C.LI&&i===C.LI||(r===C.DD||r===C.DT)&&(i===C.DD||i===C.DT)){e.openElements.generateImpliedEndTagsWithExclusion(i),e.openElements.popUntilTagNamePopped(i);break}if(i!==C.ADDRESS&&i!==C.DIV&&i!==C.P&&e._isSpecialElement(e.openElements.items[n],i))break}e.openElements.hasInButtonScope(C.P)&&e._closePElement(),e._insertElement(t,ce.HTML)}function Jv(e,t){e.openElements.hasInButtonScope(C.P)&&e._closePElement(),e._insertElement(t,ce.HTML),e.tokenizer.state=ut.PLAINTEXT}function Zv(e,t){e.openElements.hasInScope(C.BUTTON)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(C.BUTTON)),e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.framesetOk=!1}function ep(e,t){const r=e.activeFormattingElements.getElementEntryInScopeWithTagName(se.A);r&&(Sa(e,t),e.openElements.remove(r.element),e.activeFormattingElements.removeEntry(r)),e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function tp(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function rp(e,t){e._reconstructActiveFormattingElements(),e.openElements.hasInScope(C.NOBR)&&(Sa(e,t),e._reconstructActiveFormattingElements()),e._insertElement(t,ce.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function np(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.activeFormattingElements.insertMarker(),e.framesetOk=!1}function ip(e,t){e.treeAdapter.getDocumentMode(e.document)!==ot.QUIRKS&&e.openElements.hasInButtonScope(C.P)&&e._closePElement(),e._insertElement(t,ce.HTML),e.framesetOk=!1,e.insertionMode=te.IN_TABLE}function Ac(e,t){e._reconstructActiveFormattingElements(),e._appendElement(t,ce.HTML),e.framesetOk=!1,t.ackSelfClosing=!0}function yc(e){const t=ac(e,nr.TYPE);return t!=null&&t.toLowerCase()===yv}function sp(e,t){e._reconstructActiveFormattingElements(),e._appendElement(t,ce.HTML),yc(t)||(e.framesetOk=!1),t.ackSelfClosing=!0}function ap(e,t){e._appendElement(t,ce.HTML),t.ackSelfClosing=!0}function op(e,t){e.openElements.hasInButtonScope(C.P)&&e._closePElement(),e._appendElement(t,ce.HTML),e.framesetOk=!1,t.ackSelfClosing=!0}function up(e,t){t.tagName=se.IMG,t.tagID=C.IMG,Ac(e,t)}function lp(e,t){e._insertElement(t,ce.HTML),e.skipNextNewLine=!0,e.tokenizer.state=ut.RCDATA,e.originalInsertionMode=e.insertionMode,e.framesetOk=!1,e.insertionMode=te.TEXT}function cp(e,t){e.openElements.hasInButtonScope(C.P)&&e._closePElement(),e._reconstructActiveFormattingElements(),e.framesetOk=!1,e._switchToTextParsing(t,ut.RAWTEXT)}function fp(e,t){e.framesetOk=!1,e._switchToTextParsing(t,ut.RAWTEXT)}function Qo(e,t){e._switchToTextParsing(t,ut.RAWTEXT)}function dp(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.framesetOk=!1,e.insertionMode=e.insertionMode===te.IN_TABLE||e.insertionMode===te.IN_CAPTION||e.insertionMode===te.IN_TABLE_BODY||e.insertionMode===te.IN_ROW||e.insertionMode===te.IN_CELL?te.IN_SELECT_IN_TABLE:te.IN_SELECT}function hp(e,t){e.openElements.currentTagId===C.OPTION&&e.openElements.pop(),e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML)}function gp(e,t){e.openElements.hasInScope(C.RUBY)&&e.openElements.generateImpliedEndTags(),e._insertElement(t,ce.HTML)}function mp(e,t){e.openElements.hasInScope(C.RUBY)&&e.openElements.generateImpliedEndTagsWithExclusion(C.RTC),e._insertElement(t,ce.HTML)}function Ep(e,t){e._reconstructActiveFormattingElements(),mc(t),ba(t),t.selfClosing?e._appendElement(t,ce.MATHML):e._insertElement(t,ce.MATHML),t.ackSelfClosing=!0}function vp(e,t){e._reconstructActiveFormattingElements(),Ec(t),ba(t),t.selfClosing?e._appendElement(t,ce.SVG):e._insertElement(t,ce.SVG),t.ackSelfClosing=!0}function $o(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML)}function Ze(e,t){switch(t.tagID){case C.I:case C.S:case C.B:case C.U:case C.EM:case C.TT:case C.BIG:case C.CODE:case C.FONT:case C.SMALL:case C.STRIKE:case C.STRONG:{tp(e,t);break}case C.A:{ep(e,t);break}case C.H1:case C.H2:case C.H3:case C.H4:case C.H5:case C.H6:{Qv(e,t);break}case C.P:case C.DL:case C.OL:case C.UL:case C.DIV:case C.DIR:case C.NAV:case C.MAIN:case C.MENU:case C.ASIDE:case C.CENTER:case C.FIGURE:case C.FOOTER:case C.HEADER:case C.HGROUP:case C.DIALOG:case C.DETAILS:case C.ADDRESS:case C.ARTICLE:case C.SECTION:case C.SUMMARY:case C.FIELDSET:case C.BLOCKQUOTE:case C.FIGCAPTION:{Xv(e,t);break}case C.LI:case C.DD:case C.DT:{qv(e,t);break}case C.BR:case C.IMG:case C.WBR:case C.AREA:case C.EMBED:case C.KEYGEN:{Ac(e,t);break}case C.HR:{op(e,t);break}case C.RB:case C.RTC:{gp(e,t);break}case C.RT:case C.RP:{mp(e,t);break}case C.PRE:case C.LISTING:{$v(e,t);break}case C.XMP:{cp(e,t);break}case C.SVG:{vp(e,t);break}case C.HTML:{Yv(e,t);break}case C.BASE:case C.LINK:case C.META:case C.STYLE:case C.TITLE:case C.SCRIPT:case C.BGSOUND:case C.BASEFONT:case C.TEMPLATE:{Rt(e,t);break}case C.BODY:{Vv(e,t);break}case C.FORM:{zv(e,t);break}case C.NOBR:{rp(e,t);break}case C.MATH:{Ep(e,t);break}case C.TABLE:{ip(e,t);break}case C.INPUT:{sp(e,t);break}case C.PARAM:case C.TRACK:case C.SOURCE:{ap(e,t);break}case C.IMAGE:{up(e,t);break}case C.BUTTON:{Zv(e,t);break}case C.APPLET:case C.OBJECT:case C.MARQUEE:{np(e,t);break}case C.IFRAME:{fp(e,t);break}case C.SELECT:{dp(e,t);break}case C.OPTION:case C.OPTGROUP:{hp(e,t);break}case C.NOEMBED:{Qo(e,t);break}case C.FRAMESET:{jv(e,t);break}case C.TEXTAREA:{lp(e,t);break}case C.NOSCRIPT:{e.options.scriptingEnabled?Qo(e,t):$o(e,t);break}case C.PLAINTEXT:{Jv(e,t);break}case C.COL:case C.TH:case C.TD:case C.TR:case C.HEAD:case C.FRAME:case C.TBODY:case C.TFOOT:case C.THEAD:case C.CAPTION:case C.COLGROUP:break;default:$o(e,t)}}function pp(e,t){if(e.openElements.hasInScope(C.BODY)&&(e.insertionMode=te.AFTER_BODY,e.options.sourceCodeLocationInfo)){const r=e.openElements.tryPeekProperlyNestedBodyElement();r&&e._setEndLocation(r,t)}}function Tp(e,t){e.openElements.hasInScope(C.BODY)&&(e.insertionMode=te.AFTER_BODY,Pc(e,t))}function _p(e,t){const r=t.tagID;e.openElements.hasInScope(r)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(r))}function Ap(e){const t=e.openElements.tmplCount>0,{formElement:r}=e;t||(e.formElement=null),(r||t)&&e.openElements.hasInScope(C.FORM)&&(e.openElements.generateImpliedEndTags(),t?e.openElements.popUntilTagNamePopped(C.FORM):r&&e.openElements.remove(r))}function yp(e){e.openElements.hasInButtonScope(C.P)||e._insertFakeElement(se.P,C.P),e._closePElement()}function bp(e){e.openElements.hasInListItemScope(C.LI)&&(e.openElements.generateImpliedEndTagsWithExclusion(C.LI),e.openElements.popUntilTagNamePopped(C.LI))}function Sp(e,t){const r=t.tagID;e.openElements.hasInScope(r)&&(e.openElements.generateImpliedEndTagsWithExclusion(r),e.openElements.popUntilTagNamePopped(r))}function xp(e){e.openElements.hasNumberedHeaderInScope()&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilNumberedHeaderPopped())}function Ip(e,t){const r=t.tagID;e.openElements.hasInScope(r)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(r),e.activeFormattingElements.clearToLastMarker())}function Cp(e){e._reconstructActiveFormattingElements(),e._insertFakeElement(se.BR,C.BR),e.openElements.pop(),e.framesetOk=!1}function bc(e,t){const r=t.tagName,n=t.tagID;for(let i=e.openElements.stackTop;i>0;i--){const p=e.openElements.items[i],O=e.openElements.tagIDs[i];if(n===O&&(n!==C.UNKNOWN||e.treeAdapter.getTagName(p)===r)){e.openElements.generateImpliedEndTagsWithExclusion(n),e.openElements.stackTop>=i&&e.openElements.shortenToLength(i);break}if(e._isSpecialElement(p,O))break}}function ki(e,t){switch(t.tagID){case C.A:case C.B:case C.I:case C.S:case C.U:case C.EM:case C.TT:case C.BIG:case C.CODE:case C.FONT:case C.NOBR:case C.SMALL:case C.STRIKE:case C.STRONG:{Sa(e,t);break}case C.P:{yp(e);break}case C.DL:case C.UL:case C.OL:case C.DIR:case C.DIV:case C.NAV:case C.PRE:case C.MAIN:case C.MENU:case C.ASIDE:case C.BUTTON:case C.CENTER:case C.FIGURE:case C.FOOTER:case C.HEADER:case C.HGROUP:case C.DIALOG:case C.ADDRESS:case C.ARTICLE:case C.DETAILS:case C.SECTION:case C.SUMMARY:case C.LISTING:case C.FIELDSET:case C.BLOCKQUOTE:case C.FIGCAPTION:{_p(e,t);break}case C.LI:{bp(e);break}case C.DD:case C.DT:{Sp(e,t);break}case C.H1:case C.H2:case C.H3:case C.H4:case C.H5:case C.H6:{xp(e);break}case C.BR:{Cp(e);break}case C.BODY:{pp(e,t);break}case C.HTML:{Tp(e,t);break}case C.FORM:{Ap(e);break}case C.APPLET:case C.OBJECT:case C.MARQUEE:{Ip(e,t);break}case C.TEMPLATE:{Ir(e,t);break}default:bc(e,t)}}function Sc(e,t){e.tmplInsertionModeStack.length>0?Oc(e,t):xa(e,t)}function Lp(e,t){var r;t.tagID===C.SCRIPT&&((r=e.scriptHandler)===null||r===void 0||r.call(e,e.openElements.current)),e.openElements.pop(),e.insertionMode=e.originalInsertionMode}function Dp(e,t){e._err(t,ue.eofInElementThatCanContainOnlyText),e.openElements.pop(),e.insertionMode=e.originalInsertionMode,e.onEof(t)}function us(e,t){if(vc.has(e.openElements.currentTagId))switch(e.pendingCharacterTokens.length=0,e.hasNonWhitespacePendingCharacterToken=!1,e.originalInsertionMode=e.insertionMode,e.insertionMode=te.IN_TABLE_TEXT,t.type){case Ce.CHARACTER:{Ic(e,t);break}case Ce.WHITESPACE_CHARACTER:{xc(e,t);break}}else Nn(e,t)}function Rp(e,t){e.openElements.clearBackToTableContext(),e.activeFormattingElements.insertMarker(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_CAPTION}function Op(e,t){e.openElements.clearBackToTableContext(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_COLUMN_GROUP}function Pp(e,t){e.openElements.clearBackToTableContext(),e._insertFakeElement(se.COLGROUP,C.COLGROUP),e.insertionMode=te.IN_COLUMN_GROUP,Ia(e,t)}function Np(e,t){e.openElements.clearBackToTableContext(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_TABLE_BODY}function Mp(e,t){e.openElements.clearBackToTableContext(),e._insertFakeElement(se.TBODY,C.TBODY),e.insertionMode=te.IN_TABLE_BODY,Bi(e,t)}function Fp(e,t){e.openElements.hasInTableScope(C.TABLE)&&(e.openElements.popUntilTagNamePopped(C.TABLE),e._resetInsertionMode(),e._processStartTag(t))}function kp(e,t){yc(t)?e._appendElement(t,ce.HTML):Nn(e,t),t.ackSelfClosing=!0}function Bp(e,t){!e.formElement&&e.openElements.tmplCount===0&&(e._insertElement(t,ce.HTML),e.formElement=e.openElements.current,e.openElements.pop())}function jr(e,t){switch(t.tagID){case C.TD:case C.TH:case C.TR:{Mp(e,t);break}case C.STYLE:case C.SCRIPT:case C.TEMPLATE:{Rt(e,t);break}case C.COL:{Pp(e,t);break}case C.FORM:{Bp(e,t);break}case C.TABLE:{Fp(e,t);break}case C.TBODY:case C.TFOOT:case C.THEAD:{Np(e,t);break}case C.INPUT:{kp(e,t);break}case C.CAPTION:{Rp(e,t);break}case C.COLGROUP:{Op(e,t);break}default:Nn(e,t)}}function Dn(e,t){switch(t.tagID){case C.TABLE:{e.openElements.hasInTableScope(C.TABLE)&&(e.openElements.popUntilTagNamePopped(C.TABLE),e._resetInsertionMode());break}case C.TEMPLATE:{Ir(e,t);break}case C.BODY:case C.CAPTION:case C.COL:case C.COLGROUP:case C.HTML:case C.TBODY:case C.TD:case C.TFOOT:case C.TH:case C.THEAD:case C.TR:break;default:Nn(e,t)}}function Nn(e,t){const r=e.fosterParentingEnabled;e.fosterParentingEnabled=!0,Fi(e,t),e.fosterParentingEnabled=r}function xc(e,t){e.pendingCharacterTokens.push(t)}function Ic(e,t){e.pendingCharacterTokens.push(t),e.hasNonWhitespacePendingCharacterToken=!0}function nn(e,t){let r=0;if(e.hasNonWhitespacePendingCharacterToken)for(;r<e.pendingCharacterTokens.length;r++)Nn(e,e.pendingCharacterTokens[r]);else for(;r<e.pendingCharacterTokens.length;r++)e._insertCharacters(e.pendingCharacterTokens[r]);e.insertionMode=e.originalInsertionMode,e._processToken(t)}const Cc=new Set([C.CAPTION,C.COL,C.COLGROUP,C.TBODY,C.TD,C.TFOOT,C.TH,C.THEAD,C.TR]);function wp(e,t){const r=t.tagID;Cc.has(r)?e.openElements.hasInTableScope(C.CAPTION)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(C.CAPTION),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=te.IN_TABLE,jr(e,t)):Ze(e,t)}function Up(e,t){const r=t.tagID;switch(r){case C.CAPTION:case C.TABLE:{e.openElements.hasInTableScope(C.CAPTION)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(C.CAPTION),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=te.IN_TABLE,r===C.TABLE&&Dn(e,t));break}case C.BODY:case C.COL:case C.COLGROUP:case C.HTML:case C.TBODY:case C.TD:case C.TFOOT:case C.TH:case C.THEAD:case C.TR:break;default:ki(e,t)}}function Ia(e,t){switch(t.tagID){case C.HTML:{Ze(e,t);break}case C.COL:{e._appendElement(t,ce.HTML),t.ackSelfClosing=!0;break}case C.TEMPLATE:{Rt(e,t);break}default:hi(e,t)}}function Hp(e,t){switch(t.tagID){case C.COLGROUP:{e.openElements.currentTagId===C.COLGROUP&&(e.openElements.pop(),e.insertionMode=te.IN_TABLE);break}case C.TEMPLATE:{Ir(e,t);break}case C.COL:break;default:hi(e,t)}}function hi(e,t){e.openElements.currentTagId===C.COLGROUP&&(e.openElements.pop(),e.insertionMode=te.IN_TABLE,e._processToken(t))}function Bi(e,t){switch(t.tagID){case C.TR:{e.openElements.clearBackToTableBodyContext(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_ROW;break}case C.TH:case C.TD:{e.openElements.clearBackToTableBodyContext(),e._insertFakeElement(se.TR,C.TR),e.insertionMode=te.IN_ROW,wi(e,t);break}case C.CAPTION:case C.COL:case C.COLGROUP:case C.TBODY:case C.TFOOT:case C.THEAD:{e.openElements.hasTableBodyContextInTableScope()&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE,jr(e,t));break}default:jr(e,t)}}function Fs(e,t){const r=t.tagID;switch(t.tagID){case C.TBODY:case C.TFOOT:case C.THEAD:{e.openElements.hasInTableScope(r)&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE);break}case C.TABLE:{e.openElements.hasTableBodyContextInTableScope()&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE,Dn(e,t));break}case C.BODY:case C.CAPTION:case C.COL:case C.COLGROUP:case C.HTML:case C.TD:case C.TH:case C.TR:break;default:Dn(e,t)}}function wi(e,t){switch(t.tagID){case C.TH:case C.TD:{e.openElements.clearBackToTableRowContext(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_CELL,e.activeFormattingElements.insertMarker();break}case C.CAPTION:case C.COL:case C.COLGROUP:case C.TBODY:case C.TFOOT:case C.THEAD:case C.TR:{e.openElements.hasInTableScope(C.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE_BODY,Bi(e,t));break}default:jr(e,t)}}function Lc(e,t){switch(t.tagID){case C.TR:{e.openElements.hasInTableScope(C.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE_BODY);break}case C.TABLE:{e.openElements.hasInTableScope(C.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE_BODY,Fs(e,t));break}case C.TBODY:case C.TFOOT:case C.THEAD:{(e.openElements.hasInTableScope(t.tagID)||e.openElements.hasInTableScope(C.TR))&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE_BODY,Fs(e,t));break}case C.BODY:case C.CAPTION:case C.COL:case C.COLGROUP:case C.HTML:case C.TD:case C.TH:break;default:Dn(e,t)}}function Kp(e,t){const r=t.tagID;Cc.has(r)?(e.openElements.hasInTableScope(C.TD)||e.openElements.hasInTableScope(C.TH))&&(e._closeTableCell(),wi(e,t)):Ze(e,t)}function Wp(e,t){const r=t.tagID;switch(r){case C.TD:case C.TH:{e.openElements.hasInTableScope(r)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(r),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=te.IN_ROW);break}case C.TABLE:case C.TBODY:case C.TFOOT:case C.THEAD:case C.TR:{e.openElements.hasInTableScope(r)&&(e._closeTableCell(),Lc(e,t));break}case C.BODY:case C.CAPTION:case C.COL:case C.COLGROUP:case C.HTML:break;default:ki(e,t)}}function Dc(e,t){switch(t.tagID){case C.HTML:{Ze(e,t);break}case C.OPTION:{e.openElements.currentTagId===C.OPTION&&e.openElements.pop(),e._insertElement(t,ce.HTML);break}case C.OPTGROUP:{e.openElements.currentTagId===C.OPTION&&e.openElements.pop(),e.openElements.currentTagId===C.OPTGROUP&&e.openElements.pop(),e._insertElement(t,ce.HTML);break}case C.INPUT:case C.KEYGEN:case C.TEXTAREA:case C.SELECT:{e.openElements.hasInSelectScope(C.SELECT)&&(e.openElements.popUntilTagNamePopped(C.SELECT),e._resetInsertionMode(),t.tagID!==C.SELECT&&e._processStartTag(t));break}case C.SCRIPT:case C.TEMPLATE:{Rt(e,t);break}}}function Rc(e,t){switch(t.tagID){case C.OPTGROUP:{e.openElements.stackTop>0&&e.openElements.currentTagId===C.OPTION&&e.openElements.tagIDs[e.openElements.stackTop-1]===C.OPTGROUP&&e.openElements.pop(),e.openElements.currentTagId===C.OPTGROUP&&e.openElements.pop();break}case C.OPTION:{e.openElements.currentTagId===C.OPTION&&e.openElements.pop();break}case C.SELECT:{e.openElements.hasInSelectScope(C.SELECT)&&(e.openElements.popUntilTagNamePopped(C.SELECT),e._resetInsertionMode());break}case C.TEMPLATE:{Ir(e,t);break}}}function Gp(e,t){const r=t.tagID;r===C.CAPTION||r===C.TABLE||r===C.TBODY||r===C.TFOOT||r===C.THEAD||r===C.TR||r===C.TD||r===C.TH?(e.openElements.popUntilTagNamePopped(C.SELECT),e._resetInsertionMode(),e._processStartTag(t)):Dc(e,t)}function Yp(e,t){const r=t.tagID;r===C.CAPTION||r===C.TABLE||r===C.TBODY||r===C.TFOOT||r===C.THEAD||r===C.TR||r===C.TD||r===C.TH?e.openElements.hasInTableScope(r)&&(e.openElements.popUntilTagNamePopped(C.SELECT),e._resetInsertionMode(),e.onEndTag(t)):Rc(e,t)}function Vp(e,t){switch(t.tagID){case C.BASE:case C.BASEFONT:case C.BGSOUND:case C.LINK:case C.META:case C.NOFRAMES:case C.SCRIPT:case C.STYLE:case C.TEMPLATE:case C.TITLE:{Rt(e,t);break}case C.CAPTION:case C.COLGROUP:case C.TBODY:case C.TFOOT:case C.THEAD:{e.tmplInsertionModeStack[0]=te.IN_TABLE,e.insertionMode=te.IN_TABLE,jr(e,t);break}case C.COL:{e.tmplInsertionModeStack[0]=te.IN_COLUMN_GROUP,e.insertionMode=te.IN_COLUMN_GROUP,Ia(e,t);break}case C.TR:{e.tmplInsertionModeStack[0]=te.IN_TABLE_BODY,e.insertionMode=te.IN_TABLE_BODY,Bi(e,t);break}case C.TD:case C.TH:{e.tmplInsertionModeStack[0]=te.IN_ROW,e.insertionMode=te.IN_ROW,wi(e,t);break}default:e.tmplInsertionModeStack[0]=te.IN_BODY,e.insertionMode=te.IN_BODY,Ze(e,t)}}function jp(e,t){t.tagID===C.TEMPLATE&&Ir(e,t)}function Oc(e,t){e.openElements.tmplCount>0?(e.openElements.popUntilTagNamePopped(C.TEMPLATE),e.activeFormattingElements.clearToLastMarker(),e.tmplInsertionModeStack.shift(),e._resetInsertionMode(),e.onEof(t)):xa(e,t)}function Xp(e,t){t.tagID===C.HTML?Ze(e,t):gi(e,t)}function Pc(e,t){var r;if(t.tagID===C.HTML){if(e.fragmentContext||(e.insertionMode=te.AFTER_AFTER_BODY),e.options.sourceCodeLocationInfo&&e.openElements.tagIDs[0]===C.HTML){e._setEndLocation(e.openElements.items[0],t);const n=e.openElements.items[1];n&&!(!((r=e.treeAdapter.getNodeSourceCodeLocation(n))===null||r===void 0)&&r.endTag)&&e._setEndLocation(n,t)}}else gi(e,t)}function gi(e,t){e.insertionMode=te.IN_BODY,Fi(e,t)}function Qp(e,t){switch(t.tagID){case C.HTML:{Ze(e,t);break}case C.FRAMESET:{e._insertElement(t,ce.HTML);break}case C.FRAME:{e._appendElement(t,ce.HTML),t.ackSelfClosing=!0;break}case C.NOFRAMES:{Rt(e,t);break}}}function $p(e,t){t.tagID===C.FRAMESET&&!e.openElements.isRootHtmlElementCurrent()&&(e.openElements.pop(),!e.fragmentContext&&e.openElements.currentTagId!==C.FRAMESET&&(e.insertionMode=te.AFTER_FRAMESET))}function zp(e,t){switch(t.tagID){case C.HTML:{Ze(e,t);break}case C.NOFRAMES:{Rt(e,t);break}}}function qp(e,t){t.tagID===C.HTML&&(e.insertionMode=te.AFTER_AFTER_FRAMESET)}function Jp(e,t){t.tagID===C.HTML?Ze(e,t):Zn(e,t)}function Zn(e,t){e.insertionMode=te.IN_BODY,Fi(e,t)}function Zp(e,t){switch(t.tagID){case C.HTML:{Ze(e,t);break}case C.NOFRAMES:{Rt(e,t);break}}}function eT(e,t){t.chars=Be,e._insertCharacters(t)}function tT(e,t){e._insertCharacters(t),e.framesetOk=!1}function Nc(e){for(;e.treeAdapter.getNamespaceURI(e.openElements.current)!==ce.HTML&&!e._isIntegrationPoint(e.openElements.currentTagId,e.openElements.current);)e.openElements.pop()}function rT(e,t){if(vv(t))Nc(e),e._startTagOutsideForeignContent(t);else{const r=e._getAdjustedCurrentElement(),n=e.treeAdapter.getNamespaceURI(r);n===ce.MATHML?mc(t):n===ce.SVG&&(pv(t),Ec(t)),ba(t),t.selfClosing?e._appendElement(t,n):e._insertElement(t,n),t.ackSelfClosing=!0}}function nT(e,t){if(t.tagID===C.P||t.tagID===C.BR){Nc(e),e._endTagOutsideForeignContent(t);return}for(let r=e.openElements.stackTop;r>0;r--){const n=e.openElements.items[r];if(e.treeAdapter.getNamespaceURI(n)===ce.HTML){e._endTagOutsideForeignContent(t);break}const i=e.treeAdapter.getTagName(n);if(i.toLowerCase()===t.tagName){t.tagName=i,e.openElements.shortenToLength(r);break}}}const iT=new Set([se.AREA,se.BASE,se.BASEFONT,se.BGSOUND,se.BR,se.COL,se.EMBED,se.FRAME,se.HR,se.IMG,se.INPUT,se.KEYGEN,se.LINK,se.META,se.PARAM,se.SOURCE,se.TRACK,se.WBR]);function sT(e,t){return t.treeAdapter.isElementNode(e)&&t.treeAdapter.getNamespaceURI(e)===ce.HTML&&iT.has(t.treeAdapter.getTagName(e))}const aT={treeAdapter:gr,scriptingEnabled:!0};function oT(e,t){const r={...aT,...t};return Mc(e,r)}function uT(e,t){let r="";const n=t.treeAdapter.isElementNode(e)&&t.treeAdapter.getTagName(e)===se.TEMPLATE&&t.treeAdapter.getNamespaceURI(e)===ce.HTML?t.treeAdapter.getTemplateContent(e):e,i=t.treeAdapter.getChildNodes(n);if(i)for(const p of i)r+=Mc(p,t);return r}function Mc(e,t){return t.treeAdapter.isElementNode(e)?lT(e,t):t.treeAdapter.isTextNode(e)?fT(e,t):t.treeAdapter.isCommentNode(e)?dT(e,t):t.treeAdapter.isDocumentTypeNode(e)?hT(e,t):""}function lT(e,t){const r=t.treeAdapter.getTagName(e);return`<${r}${cT(e,t)}>${sT(e,t)?"":`${uT(e,t)}</${r}>`}`}function cT(e,{treeAdapter:t}){let r="";for(const n of t.getAttrList(e)){if(r+=" ",!n.namespace)r+=n.name;else switch(n.namespace){case ce.XML:{r+=`xml:${n.name}`;break}case ce.XMLNS:{n.name!=="xmlns"&&(r+="xmlns:"),r+=n.name;break}case ce.XLINK:{r+=`xlink:${n.name}`;break}default:r+=`${n.prefix}:${n.name}`}r+=`="${yl(n.value)}"`}return r}function fT(e,t){const{treeAdapter:r}=t,n=r.getTextNodeContent(e),i=r.getParentNode(e),p=i&&r.isElementNode(i)&&r.getTagName(i);return p&&r.getNamespaceURI(i)===ce.HTML&&VE(p,t.scriptingEnabled)?n:bl(n)}function dT(e,{treeAdapter:t}){return`<!--${t.getCommentNodeContent(e)}-->`}function hT(e,{treeAdapter:t}){return`<!DOCTYPE ${t.getDocumentTypeNodeName(e)}>`}function gT(e,t){return pc.parse(e,t)}function mT(e,t,r){typeof e=="string"&&(r=t,t=e,e=null);const n=pc.getFragmentParser(e,r);return n.tokenizer.write(t,!0),n.getFragment()}function zo(e){return new In(e)}function qo(e){const t=e.includes('"')?"'":'"';return t+e+t}function ET(e,t,r){let n="!DOCTYPE ";return e&&(n+=e),t?n+=` PUBLIC ${qo(t)}`:r&&(n+=" SYSTEM"),r&&(n+=` ${qo(r)}`),n}const Pr={isCommentNode:Ci,isElementNode:be,isTextNode:wt,createDocument(){const e=new _r([]);return e["x-mode"]=ot.NO_QUIRKS,e},createDocumentFragment(){return new _r([])},createElement(e,t,r){const n=Object.create(null),i=Object.create(null),p=Object.create(null);for(let I=0;I<r.length;I++){const s=r[I].name;n[s]=r[I].value,i[s]=r[I].namespace,p[s]=r[I].prefix}const O=new fa(e,n,[]);return O.namespace=t,O["x-attribsNamespace"]=i,O["x-attribsPrefix"]=p,O},createCommentNode(e){return new ua(e)},appendChild(e,t){const r=e.children[e.children.length-1];r&&(r.next=t,t.prev=r),e.children.push(t),t.parent=e},insertBefore(e,t,r){const n=e.children.indexOf(r),{prev:i}=r;i&&(i.next=t,t.prev=i),r.prev=t,t.next=r,e.children.splice(n,0,t),t.parent=e},setTemplateContent(e,t){Pr.appendChild(e,t)},getTemplateContent(e){return e.children[0]},setDocumentType(e,t,r,n){const i=ET(t,r,n);let p=e.children.find(O=>Is(O)&&O.name==="!doctype");p?p.data=i??null:(p=new la("!doctype",i),Pr.appendChild(e,p)),p["x-name"]=t??void 0,p["x-publicId"]=r??void 0,p["x-systemId"]=n??void 0},setDocumentMode(e,t){e["x-mode"]=t},getDocumentMode(e){return e["x-mode"]},detachNode(e){if(e.parent){const t=e.parent.children.indexOf(e),{prev:r,next:n}=e;e.prev=null,e.next=null,r&&(r.next=n),n&&(n.prev=r),e.parent.children.splice(t,1),e.parent=null}},insertText(e,t){const r=e.children[e.children.length-1];r&&wt(r)?r.data+=t:Pr.appendChild(e,zo(t))},insertTextBefore(e,t,r){const n=e.children[e.children.indexOf(r)-1];n&&wt(n)?n.data+=t:Pr.insertBefore(e,zo(t),r)},adoptAttributes(e,t){for(let r=0;r<t.length;r++){const n=t[r].name;typeof e.attribs[n]>"u"&&(e.attribs[n]=t[r].value,e["x-attribsNamespace"][n]=t[r].namespace,e["x-attribsPrefix"][n]=t[r].prefix)}},getFirstChild(e){return e.children[0]},getChildNodes(e){return e.children},getParentNode(e){return e.parent},getAttrList(e){return e.attributes},getTagName(e){return e.name},getNamespaceURI(e){return e.namespace},getTextNodeContent(e){return e.data},getCommentNodeContent(e){return e.data},getDocumentTypeNodeName(e){var t;return(t=e["x-name"])!==null&&t!==void 0?t:""},getDocumentTypeNodePublicId(e){var t;return(t=e["x-publicId"])!==null&&t!==void 0?t:""},getDocumentTypeNodeSystemId(e){var t;return(t=e["x-systemId"])!==null&&t!==void 0?t:""},isDocumentTypeNode(e){return Is(e)&&e.name==="!doctype"},setNodeSourceCodeLocation(e,t){t&&(e.startIndex=t.startOffset,e.endIndex=t.endOffset),e.sourceCodeLocation=t},getNodeSourceCodeLocation(e){return e.sourceCodeLocation},updateNodeSourceCodeLocation(e,t){t.endOffset!=null&&(e.endIndex=t.endOffset),e.sourceCodeLocation={...e.sourceCodeLocation,...t}}};function vT(e,t,r,n){const i={scriptingEnabled:typeof t.scriptingEnabled=="boolean"?t.scriptingEnabled:!0,treeAdapter:Pr,sourceCodeLocationInfo:t.sourceCodeLocationInfo};return r?gT(e,i):mT(n,e,i)}const pT={treeAdapter:Pr};function TT(e){const t="length"in e?e:[e];for(let n=0;n<t.length;n+=1){const i=t[n];Sr(i)&&Array.prototype.splice.call(t,n,1,...i.children)}let r="";for(let n=0;n<t.length;n+=1){const i=t[n];r+=oT(i,pT)}return r}var ve;(function(e){e[e.Tab=9]="Tab",e[e.NewLine=10]="NewLine",e[e.FormFeed=12]="FormFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.Num=35]="Num",e[e.Amp=38]="Amp",e[e.SingleQuote=39]="SingleQuote",e[e.DoubleQuote=34]="DoubleQuote",e[e.Dash=45]="Dash",e[e.Slash=47]="Slash",e[e.Zero=48]="Zero",e[e.Nine=57]="Nine",e[e.Semi=59]="Semi",e[e.Lt=60]="Lt",e[e.Eq=61]="Eq",e[e.Gt=62]="Gt",e[e.Questionmark=63]="Questionmark",e[e.UpperA=65]="UpperA",e[e.LowerA=97]="LowerA",e[e.UpperF=70]="UpperF",e[e.LowerF=102]="LowerF",e[e.UpperZ=90]="UpperZ",e[e.LowerZ=122]="LowerZ",e[e.LowerX=120]="LowerX",e[e.OpeningSquareBracket=91]="OpeningSquareBracket"})(ve||(ve={}));var fe;(function(e){e[e.Text=1]="Text",e[e.BeforeTagName=2]="BeforeTagName",e[e.InTagName=3]="InTagName",e[e.InSelfClosingTag=4]="InSelfClosingTag",e[e.BeforeClosingTagName=5]="BeforeClosingTagName",e[e.InClosingTagName=6]="InClosingTagName",e[e.AfterClosingTagName=7]="AfterClosingTagName",e[e.BeforeAttributeName=8]="BeforeAttributeName",e[e.InAttributeName=9]="InAttributeName",e[e.AfterAttributeName=10]="AfterAttributeName",e[e.BeforeAttributeValue=11]="BeforeAttributeValue",e[e.InAttributeValueDq=12]="InAttributeValueDq",e[e.InAttributeValueSq=13]="InAttributeValueSq",e[e.InAttributeValueNq=14]="InAttributeValueNq",e[e.BeforeDeclaration=15]="BeforeDeclaration",e[e.InDeclaration=16]="InDeclaration",e[e.InProcessingInstruction=17]="InProcessingInstruction",e[e.BeforeComment=18]="BeforeComment",e[e.CDATASequence=19]="CDATASequence",e[e.InSpecialComment=20]="InSpecialComment",e[e.InCommentLike=21]="InCommentLike",e[e.BeforeSpecialS=22]="BeforeSpecialS",e[e.SpecialStartSequence=23]="SpecialStartSequence",e[e.InSpecialTag=24]="InSpecialTag",e[e.BeforeEntity=25]="BeforeEntity",e[e.BeforeNumericEntity=26]="BeforeNumericEntity",e[e.InNamedEntity=27]="InNamedEntity",e[e.InNumericEntity=28]="InNumericEntity",e[e.InHexEntity=29]="InHexEntity"})(fe||(fe={}));function Wt(e){return e===ve.Space||e===ve.NewLine||e===ve.Tab||e===ve.FormFeed||e===ve.CarriageReturn}function jn(e){return e===ve.Slash||e===ve.Gt||Wt(e)}function Jo(e){return e>=ve.Zero&&e<=ve.Nine}function _T(e){return e>=ve.LowerA&&e<=ve.LowerZ||e>=ve.UpperA&&e<=ve.UpperZ}function AT(e){return e>=ve.UpperA&&e<=ve.UpperF||e>=ve.LowerA&&e<=ve.LowerF}var Ft;(function(e){e[e.NoValue=0]="NoValue",e[e.Unquoted=1]="Unquoted",e[e.Single=2]="Single",e[e.Double=3]="Double"})(Ft||(Ft={}));const it={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])};class yT{constructor({xmlMode:t=!1,decodeEntities:r=!0},n){this.cbs=n,this.state=fe.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=fe.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=t,this.decodeEntities=r,this.entityTrie=t?H0:qt}reset(){this.state=fe.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=fe.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(t){this.offset+=this.buffer.length,this.buffer=t,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}getIndex(){return this.index}getSectionStart(){return this.sectionStart}stateText(t){t===ve.Lt||!this.decodeEntities&&this.fastForwardTo(ve.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=fe.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&t===ve.Amp&&(this.state=fe.BeforeEntity)}stateSpecialStartSequence(t){const r=this.sequenceIndex===this.currentSequence.length;if(!(r?jn(t):(t|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!r){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=fe.InTagName,this.stateInTagName(t)}stateInSpecialTag(t){if(this.sequenceIndex===this.currentSequence.length){if(t===ve.Gt||Wt(t)){const r=this.index-this.currentSequence.length;if(this.sectionStart<r){const n=this.index;this.index=r,this.cbs.ontext(this.sectionStart,r),this.index=n}this.isSpecial=!1,this.sectionStart=r+2,this.stateInClosingTagName(t);return}this.sequenceIndex=0}(t|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===it.TitleEnd?this.decodeEntities&&t===ve.Amp&&(this.state=fe.BeforeEntity):this.fastForwardTo(ve.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=Number(t===ve.Lt)}stateCDATASequence(t){t===it.Cdata[this.sequenceIndex]?++this.sequenceIndex===it.Cdata.length&&(this.state=fe.InCommentLike,this.currentSequence=it.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=fe.InDeclaration,this.stateInDeclaration(t))}fastForwardTo(t){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===t)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(t){t===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===it.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=fe.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):t!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(t){return this.xmlMode?!jn(t):_T(t)}startSpecial(t,r){this.isSpecial=!0,this.currentSequence=t,this.sequenceIndex=r,this.state=fe.SpecialStartSequence}stateBeforeTagName(t){if(t===ve.ExclamationMark)this.state=fe.BeforeDeclaration,this.sectionStart=this.index+1;else if(t===ve.Questionmark)this.state=fe.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(t)){const r=t|32;this.sectionStart=this.index,!this.xmlMode&&r===it.TitleEnd[2]?this.startSpecial(it.TitleEnd,3):this.state=!this.xmlMode&&r===it.ScriptEnd[2]?fe.BeforeSpecialS:fe.InTagName}else t===ve.Slash?this.state=fe.BeforeClosingTagName:(this.state=fe.Text,this.stateText(t))}stateInTagName(t){jn(t)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=fe.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateBeforeClosingTagName(t){Wt(t)||(t===ve.Gt?this.state=fe.Text:(this.state=this.isTagStartChar(t)?fe.InClosingTagName:fe.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(t){(t===ve.Gt||Wt(t))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=fe.AfterClosingTagName,this.stateAfterClosingTagName(t))}stateAfterClosingTagName(t){(t===ve.Gt||this.fastForwardTo(ve.Gt))&&(this.state=fe.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(t){t===ve.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=fe.InSpecialTag,this.sequenceIndex=0):this.state=fe.Text,this.baseState=this.state,this.sectionStart=this.index+1):t===ve.Slash?this.state=fe.InSelfClosingTag:Wt(t)||(this.state=fe.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(t){t===ve.Gt?(this.cbs.onselfclosingtag(this.index),this.state=fe.Text,this.baseState=fe.Text,this.sectionStart=this.index+1,this.isSpecial=!1):Wt(t)||(this.state=fe.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateInAttributeName(t){(t===ve.Eq||jn(t))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=fe.AfterAttributeName,this.stateAfterAttributeName(t))}stateAfterAttributeName(t){t===ve.Eq?this.state=fe.BeforeAttributeValue:t===ve.Slash||t===ve.Gt?(this.cbs.onattribend(Ft.NoValue,this.index),this.state=fe.BeforeAttributeName,this.stateBeforeAttributeName(t)):Wt(t)||(this.cbs.onattribend(Ft.NoValue,this.index),this.state=fe.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(t){t===ve.DoubleQuote?(this.state=fe.InAttributeValueDq,this.sectionStart=this.index+1):t===ve.SingleQuote?(this.state=fe.InAttributeValueSq,this.sectionStart=this.index+1):Wt(t)||(this.sectionStart=this.index,this.state=fe.InAttributeValueNq,this.stateInAttributeValueNoQuotes(t))}handleInAttributeValue(t,r){t===r||!this.decodeEntities&&this.fastForwardTo(r)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(r===ve.DoubleQuote?Ft.Double:Ft.Single,this.index),this.state=fe.BeforeAttributeName):this.decodeEntities&&t===ve.Amp&&(this.baseState=this.state,this.state=fe.BeforeEntity)}stateInAttributeValueDoubleQuotes(t){this.handleInAttributeValue(t,ve.DoubleQuote)}stateInAttributeValueSingleQuotes(t){this.handleInAttributeValue(t,ve.SingleQuote)}stateInAttributeValueNoQuotes(t){Wt(t)||t===ve.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(Ft.Unquoted,this.index),this.state=fe.BeforeAttributeName,this.stateBeforeAttributeName(t)):this.decodeEntities&&t===ve.Amp&&(this.baseState=this.state,this.state=fe.BeforeEntity)}stateBeforeDeclaration(t){t===ve.OpeningSquareBracket?(this.state=fe.CDATASequence,this.sequenceIndex=0):this.state=t===ve.Dash?fe.BeforeComment:fe.InDeclaration}stateInDeclaration(t){(t===ve.Gt||this.fastForwardTo(ve.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=fe.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(t){(t===ve.Gt||this.fastForwardTo(ve.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=fe.Text,this.sectionStart=this.index+1)}stateBeforeComment(t){t===ve.Dash?(this.state=fe.InCommentLike,this.currentSequence=it.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=fe.InDeclaration}stateInSpecialComment(t){(t===ve.Gt||this.fastForwardTo(ve.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=fe.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(t){const r=t|32;r===it.ScriptEnd[3]?this.startSpecial(it.ScriptEnd,4):r===it.StyleEnd[3]?this.startSpecial(it.StyleEnd,4):(this.state=fe.InTagName,this.stateInTagName(t))}stateBeforeEntity(t){this.entityExcess=1,this.entityResult=0,t===ve.Num?this.state=fe.BeforeNumericEntity:t===ve.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=fe.InNamedEntity,this.stateInNamedEntity(t))}stateInNamedEntity(t){if(this.entityExcess+=1,this.trieIndex=Tl(this.entityTrie,this.trieCurrent,this.trieIndex+1,t),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];const r=this.trieCurrent&jt.VALUE_LENGTH;if(r){const n=(r>>14)-1;if(!this.allowLegacyEntity()&&t!==ve.Semi)this.trieIndex+=n;else{const i=this.index-this.entityExcess+1;i>this.sectionStart&&this.emitPartial(this.sectionStart,i),this.entityResult=this.trieIndex,this.trieIndex+=n,this.entityExcess=0,this.sectionStart=this.index+1,n===0&&this.emitNamedEntity()}}}emitNamedEntity(){if(this.state=this.baseState,this.entityResult===0)return;switch((this.entityTrie[this.entityResult]&jt.VALUE_LENGTH)>>14){case 1:this.emitCodePoint(this.entityTrie[this.entityResult]&~jt.VALUE_LENGTH);break;case 2:this.emitCodePoint(this.entityTrie[this.entityResult+1]);break;case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}stateBeforeNumericEntity(t){(t|32)===ve.LowerX?(this.entityExcess++,this.state=fe.InHexEntity):(this.state=fe.InNumericEntity,this.stateInNumericEntity(t))}emitNumericEntity(t){const r=this.index-this.entityExcess-1;r+2+Number(this.state===fe.InHexEntity)!==this.index&&(r>this.sectionStart&&this.emitPartial(this.sectionStart,r),this.sectionStart=this.index+Number(t),this.emitCodePoint(W0(this.entityResult))),this.state=this.baseState}stateInNumericEntity(t){t===ve.Semi?this.emitNumericEntity(!0):Jo(t)?(this.entityResult=this.entityResult*10+(t-ve.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}stateInHexEntity(t){t===ve.Semi?this.emitNumericEntity(!0):Jo(t)?(this.entityResult=this.entityResult*16+(t-ve.Zero),this.entityExcess++):AT(t)?(this.entityResult=this.entityResult*16+((t|32)-ve.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}allowLegacyEntity(){return!this.xmlMode&&(this.baseState===fe.Text||this.baseState===fe.InSpecialTag)}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===fe.Text||this.state===fe.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===fe.InAttributeValueDq||this.state===fe.InAttributeValueSq||this.state===fe.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const t=this.buffer.charCodeAt(this.index-this.offset);this.state===fe.Text?this.stateText(t):this.state===fe.SpecialStartSequence?this.stateSpecialStartSequence(t):this.state===fe.InSpecialTag?this.stateInSpecialTag(t):this.state===fe.CDATASequence?this.stateCDATASequence(t):this.state===fe.InAttributeValueDq?this.stateInAttributeValueDoubleQuotes(t):this.state===fe.InAttributeName?this.stateInAttributeName(t):this.state===fe.InCommentLike?this.stateInCommentLike(t):this.state===fe.InSpecialComment?this.stateInSpecialComment(t):this.state===fe.BeforeAttributeName?this.stateBeforeAttributeName(t):this.state===fe.InTagName?this.stateInTagName(t):this.state===fe.InClosingTagName?this.stateInClosingTagName(t):this.state===fe.BeforeTagName?this.stateBeforeTagName(t):this.state===fe.AfterAttributeName?this.stateAfterAttributeName(t):this.state===fe.InAttributeValueSq?this.stateInAttributeValueSingleQuotes(t):this.state===fe.BeforeAttributeValue?this.stateBeforeAttributeValue(t):this.state===fe.BeforeClosingTagName?this.stateBeforeClosingTagName(t):this.state===fe.AfterClosingTagName?this.stateAfterClosingTagName(t):this.state===fe.BeforeSpecialS?this.stateBeforeSpecialS(t):this.state===fe.InAttributeValueNq?this.stateInAttributeValueNoQuotes(t):this.state===fe.InSelfClosingTag?this.stateInSelfClosingTag(t):this.state===fe.InDeclaration?this.stateInDeclaration(t):this.state===fe.BeforeDeclaration?this.stateBeforeDeclaration(t):this.state===fe.BeforeComment?this.stateBeforeComment(t):this.state===fe.InProcessingInstruction?this.stateInProcessingInstruction(t):this.state===fe.InNamedEntity?this.stateInNamedEntity(t):this.state===fe.BeforeEntity?this.stateBeforeEntity(t):this.state===fe.InHexEntity?this.stateInHexEntity(t):this.state===fe.InNumericEntity?this.stateInNumericEntity(t):this.stateBeforeNumericEntity(t),this.index++}this.cleanup()}finish(){this.state===fe.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const t=this.buffer.length+this.offset;this.state===fe.InCommentLike?this.currentSequence===it.CdataEnd?this.cbs.oncdata(this.sectionStart,t,0):this.cbs.oncomment(this.sectionStart,t,0):this.state===fe.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===fe.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===fe.InTagName||this.state===fe.BeforeAttributeName||this.state===fe.BeforeAttributeValue||this.state===fe.AfterAttributeName||this.state===fe.InAttributeName||this.state===fe.InAttributeValueSq||this.state===fe.InAttributeValueDq||this.state===fe.InAttributeValueNq||this.state===fe.InClosingTagName||this.cbs.ontext(this.sectionStart,t)}emitPartial(t,r){this.baseState!==fe.Text&&this.baseState!==fe.InSpecialTag?this.cbs.onattribdata(t,r):this.cbs.ontext(t,r)}emitCodePoint(t){this.baseState!==fe.Text&&this.baseState!==fe.InSpecialTag?this.cbs.onattribentity(t):this.cbs.ontextentity(t)}}const Dr=new Set(["input","option","optgroup","select","button","datalist","textarea"]),Fe=new Set(["p"]),Zo=new Set(["thead","tbody"]),eu=new Set(["dd","dt"]),tu=new Set(["rt","rp"]),bT=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",Fe],["h1",Fe],["h2",Fe],["h3",Fe],["h4",Fe],["h5",Fe],["h6",Fe],["select",Dr],["input",Dr],["output",Dr],["button",Dr],["datalist",Dr],["textarea",Dr],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",eu],["dt",eu],["address",Fe],["article",Fe],["aside",Fe],["blockquote",Fe],["details",Fe],["div",Fe],["dl",Fe],["fieldset",Fe],["figcaption",Fe],["figure",Fe],["footer",Fe],["form",Fe],["header",Fe],["hr",Fe],["main",Fe],["nav",Fe],["ol",Fe],["pre",Fe],["section",Fe],["table",Fe],["ul",Fe],["rt",tu],["rp",tu],["tbody",Zo],["tfoot",Zo]]),ST=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),ru=new Set(["math","svg"]),nu=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),xT=/\s|\//;class IT{constructor(t,r={}){var n,i,p,O,I;this.options=r,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=t??{},this.lowerCaseTagNames=(n=r.lowerCaseTags)!==null&&n!==void 0?n:!r.xmlMode,this.lowerCaseAttributeNames=(i=r.lowerCaseAttributeNames)!==null&&i!==void 0?i:!r.xmlMode,this.tokenizer=new((p=r.Tokenizer)!==null&&p!==void 0?p:yT)(this.options,this),(I=(O=this.cbs).onparserinit)===null||I===void 0||I.call(O,this)}ontext(t,r){var n,i;const p=this.getSlice(t,r);this.endIndex=r-1,(i=(n=this.cbs).ontext)===null||i===void 0||i.call(n,p),this.startIndex=r}ontextentity(t){var r,n;const i=this.tokenizer.getSectionStart();this.endIndex=i-1,(n=(r=this.cbs).ontext)===null||n===void 0||n.call(r,So(t)),this.startIndex=i}isVoidElement(t){return!this.options.xmlMode&&ST.has(t)}onopentagname(t,r){this.endIndex=r;let n=this.getSlice(t,r);this.lowerCaseTagNames&&(n=n.toLowerCase()),this.emitOpenTag(n)}emitOpenTag(t){var r,n,i,p;this.openTagStart=this.startIndex,this.tagname=t;const O=!this.options.xmlMode&&bT.get(t);if(O)for(;this.stack.length>0&&O.has(this.stack[this.stack.length-1]);){const I=this.stack.pop();(n=(r=this.cbs).onclosetag)===null||n===void 0||n.call(r,I,!0)}this.isVoidElement(t)||(this.stack.push(t),ru.has(t)?this.foreignContext.push(!0):nu.has(t)&&this.foreignContext.push(!1)),(p=(i=this.cbs).onopentagname)===null||p===void 0||p.call(i,t),this.cbs.onopentag&&(this.attribs={})}endOpenTag(t){var r,n;this.startIndex=this.openTagStart,this.attribs&&((n=(r=this.cbs).onopentag)===null||n===void 0||n.call(r,this.tagname,this.attribs,t),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(t){this.endIndex=t,this.endOpenTag(!1),this.startIndex=t+1}onclosetag(t,r){var n,i,p,O,I,s;this.endIndex=r;let R=this.getSlice(t,r);if(this.lowerCaseTagNames&&(R=R.toLowerCase()),(ru.has(R)||nu.has(R))&&this.foreignContext.pop(),this.isVoidElement(R))!this.options.xmlMode&&R==="br"&&((i=(n=this.cbs).onopentagname)===null||i===void 0||i.call(n,"br"),(O=(p=this.cbs).onopentag)===null||O===void 0||O.call(p,"br",{},!0),(s=(I=this.cbs).onclosetag)===null||s===void 0||s.call(I,"br",!1));else{const A=this.stack.lastIndexOf(R);if(A!==-1)if(this.cbs.onclosetag){let w=this.stack.length-A;for(;w--;)this.cbs.onclosetag(this.stack.pop(),w!==0)}else this.stack.length=A;else!this.options.xmlMode&&R==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=r+1}onselfclosingtag(t){this.endIndex=t,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=t+1):this.onopentagend(t)}closeCurrentTag(t){var r,n;const i=this.tagname;this.endOpenTag(t),this.stack[this.stack.length-1]===i&&((n=(r=this.cbs).onclosetag)===null||n===void 0||n.call(r,i,!t),this.stack.pop())}onattribname(t,r){this.startIndex=t;const n=this.getSlice(t,r);this.attribname=this.lowerCaseAttributeNames?n.toLowerCase():n}onattribdata(t,r){this.attribvalue+=this.getSlice(t,r)}onattribentity(t){this.attribvalue+=So(t)}onattribend(t,r){var n,i;this.endIndex=r,(i=(n=this.cbs).onattribute)===null||i===void 0||i.call(n,this.attribname,this.attribvalue,t===Ft.Double?'"':t===Ft.Single?"'":t===Ft.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(t){const r=t.search(xT);let n=r<0?t:t.substr(0,r);return this.lowerCaseTagNames&&(n=n.toLowerCase()),n}ondeclaration(t,r){this.endIndex=r;const n=this.getSlice(t,r);if(this.cbs.onprocessinginstruction){const i=this.getInstructionName(n);this.cbs.onprocessinginstruction(`!${i}`,`!${n}`)}this.startIndex=r+1}onprocessinginstruction(t,r){this.endIndex=r;const n=this.getSlice(t,r);if(this.cbs.onprocessinginstruction){const i=this.getInstructionName(n);this.cbs.onprocessinginstruction(`?${i}`,`?${n}`)}this.startIndex=r+1}oncomment(t,r,n){var i,p,O,I;this.endIndex=r,(p=(i=this.cbs).oncomment)===null||p===void 0||p.call(i,this.getSlice(t,r-n)),(I=(O=this.cbs).oncommentend)===null||I===void 0||I.call(O),this.startIndex=r+1}oncdata(t,r,n){var i,p,O,I,s,R,A,w,D,K;this.endIndex=r;const k=this.getSlice(t,r-n);this.options.xmlMode||this.options.recognizeCDATA?((p=(i=this.cbs).oncdatastart)===null||p===void 0||p.call(i),(I=(O=this.cbs).ontext)===null||I===void 0||I.call(O,k),(R=(s=this.cbs).oncdataend)===null||R===void 0||R.call(s)):((w=(A=this.cbs).oncomment)===null||w===void 0||w.call(A,`[CDATA[${k}]]`),(K=(D=this.cbs).oncommentend)===null||K===void 0||K.call(D)),this.startIndex=r+1}onend(){var t,r;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let n=this.stack.length;n>0;this.cbs.onclosetag(this.stack[--n],!0));}(r=(t=this.cbs).onend)===null||r===void 0||r.call(t)}reset(){var t,r,n,i;(r=(t=this.cbs).onreset)===null||r===void 0||r.call(t),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(i=(n=this.cbs).onparserinit)===null||i===void 0||i.call(n,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(t){this.reset(),this.end(t)}getSlice(t,r){for(;t-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let n=this.buffers[0].slice(t-this.bufferOffset,r-this.bufferOffset);for(;r-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),n+=this.buffers[0].slice(0,r-this.bufferOffset);return n}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(t){var r,n;if(this.ended){(n=(r=this.cbs).onerror)===null||n===void 0||n.call(r,new Error(".write() after done!"));return}this.buffers.push(t),this.tokenizer.running&&(this.tokenizer.write(t),this.writeIndex++)}end(t){var r,n;if(this.ended){(n=(r=this.cbs).onerror)===null||n===void 0||n.call(r,Error(".end() after done!"));return}t&&this.write(t),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(t){this.write(t)}done(t){this.end(t)}}function CT(e,t){const r=new U0(void 0,t);return new IT(r,t).end(e),r.root}const LT=sE((e,t,r,n)=>t.xmlMode||t._useHtmlParser2?CT(e,t):vT(e,t,r,n)),DT=FE(LT,(e,t)=>t.xmlMode||t._useHtmlParser2?Li(e,t):TT(e));DT([]);async function RT(e){var w,D,K,k,F;const t=await(await fetch(e)).text(),r=(w=/(else {\n(.*)video\[0] = ')(.*)(';)/gm.exec(t))==null?void 0:w[3],n=await(await fetch(r)).text();let i=(D=/(https:\/\/www\.pstream\.net\/u\/player-script.*)(" type)/gm.exec(n))==null?void 0:D[1],p="https://www.pstream.net";if(i||(i=(K=/(https:\/\/veestream\.net\/u\/player-script.*)(" type)/gm.exec(n))==null?void 0:K[1],p="https://veestream.net"),i||(i=(k=/(https:\/\/fusevideo\.net\/u\/player-script.*)(" type)/gm.exec(n))==null?void 0:k[1],p="https://fusevideo.net"),!i)return!1;const O=await(await fetch(i)).text(),I=(F=/e.parseJSON\(atob\(t\).slice\(2\)\)\}\(\"([^;]*)"\),/gm.exec(O))==null?void 0:F[1],s=JSON.parse(atob(I).slice(2)),R=s.mmmmmmmmmmmmmmmmmmmm,A=s.subtitlesvtt;return{uri:R,subtitles:A,baseurl:p}}function OT(e){return new DOMParser().parseFromString(e,"text/html").body.textContent||""}function PT(e){return Number(e.replace("Ep. ",""))}async function Fc(e){var R,A;const r=await(await fetch("https://neko-sama.fr"+e)).text(),n=/var episodes = (.+)\;/gm.exec(r);let i=[],p="",O="";n&&(i=JSON.parse(n[1]).map(D=>({episode:PT(D.episode.toString()),time:D.time,title:D.title,url:D.url,url_image:D.url_image})));const I=(R=/(<div class="synopsis">\n<p>\n)(.*)/gm.exec(r))==null?void 0:R[2];I&&(p=I);const s=(A=/(<div id="head" style="background-image: url\()(.*)(\);)/gm.exec(r))==null?void 0:A[2];return s&&(O=s),{synopsis:OT(p.replace("<br/>",`
`).replace("<br />",`
`).replace("<br>",`
`)),episodes:i,coverURL:O}}const NT={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-10"},MT={class:"flex flex-col"},FT=["src"],kT={class:"mt-5"},BT={class:"text-lg font-bold whitespace-nowrap text-ellipsis overflow-hidden"},wT={class:"flex flex-col"},UT=Oe("h1",{class:"text-2xl font-bold"},"Synopsis",-1),HT={class:"mt-5"},KT={class:"mt-5"},WT=Oe("h1",{class:"text-2xl font-bold"},"Episodes",-1),GT={class:"mt-5 grid grid-cols-1 md:grid-cols-2 gap-10"},YT=["href"],VT={class:"w-full"},jT=["src"],XT={class:"mt-5 grid"},QT={class:"text-lg font-bold whitespace-nowrap text-ellipsis overflow-hidden"},$T=br({__name:"AnimeView",setup(e){const t=Nr.currentRoute.value.params.id,r=pr(void 0),n=pr({synopsis:"",episodes:[],coverURL:""});if(typeof t=="string"){let i=Sn.vostfr.find(p=>p.id==parseInt(t));i&&(r.value=i,Fc(i.url).then(p=>{n.value=p}))}return(i,p)=>r.value?(pt(),Bt("div",NT,[Oe("div",MT,[Oe("img",{class:"w-full rounded object-cover aspect-[13/9]",src:n.value.coverURL,alt:""},null,8,FT),Oe("div",kT,[Oe("h5",BT,Yt(r.value.title),1),Oe("h6",null,Yt(r.value.start_date_year)+" - "+Yt(r.value.nb_eps),1)])]),Oe("div",wT,[UT,Oe("p",HT,Yt(n.value.synopsis),1),Oe("div",KT,[WT,Oe("div",GT,[(pt(!0),Bt(yt,null,Yu(n.value.episodes,O=>(pt(),Bt("div",{key:O.episode},[Oe("a",{href:`/anime/${r.value.id}/episode/${O.episode}`},[Oe("div",VT,[Oe("img",{class:"w-full rounded object-cover aspect-[13/9]",src:O.url_image,alt:""},null,8,jT),Oe("div",XT,[Oe("h5",QT,Yt(O.title),1),Oe("h6",null,"Ep. "+Yt(O.episode),1)])])],8,YT)]))),128))])])])])):ta("",!0)}});var ks={},zT={get exports(){return ks},set exports(e){ks=e}};(function(e,t){typeof window<"u"&&function(n,i){e.exports=i()}($g,()=>(()=>{var r={"./src/config.ts":(O,I,s)=>{s.r(I),s.d(I,{enableStreamingMode:()=>T,hlsDefaultConfig:()=>v,mergeConfig:()=>a});var R=s("./src/controller/abr-controller.ts"),A=s("./src/controller/audio-stream-controller.ts"),w=s("./src/controller/audio-track-controller.ts"),D=s("./src/controller/subtitle-stream-controller.ts"),K=s("./src/controller/subtitle-track-controller.ts"),k=s("./src/controller/buffer-controller.ts"),F=s("./src/controller/timeline-controller.ts"),B=s("./src/controller/cap-level-controller.ts"),P=s("./src/controller/fps-controller.ts"),N=s("./src/controller/eme-controller.ts"),g=s("./src/controller/cmcd-controller.ts"),M=s("./src/utils/xhr-loader.ts"),S=s("./src/utils/fetch-loader.ts"),f=s("./src/utils/cues.ts"),E=s("./src/utils/mediakeys-helper.ts"),d=s("./src/utils/logger.ts");function l(){return l=Object.assign?Object.assign.bind():function(o){for(var _=1;_<arguments.length;_++){var L=arguments[_];for(var x in L)Object.prototype.hasOwnProperty.call(L,x)&&(o[x]=L[x])}return o},l.apply(this,arguments)}function b(o,_){var L=Object.keys(o);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(o);_&&(x=x.filter(function(H){return Object.getOwnPropertyDescriptor(o,H).enumerable})),L.push.apply(L,x)}return L}function h(o){for(var _=1;_<arguments.length;_++){var L=arguments[_]!=null?arguments[_]:{};_%2?b(Object(L),!0).forEach(function(x){u(o,x,L[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(L)):b(Object(L)).forEach(function(x){Object.defineProperty(o,x,Object.getOwnPropertyDescriptor(L,x))})}return o}function u(o,_,L){return _=m(_),_ in o?Object.defineProperty(o,_,{value:L,enumerable:!0,configurable:!0,writable:!0}):o[_]=L,o}function m(o){var _=y(o,"string");return typeof _=="symbol"?_:String(_)}function y(o,_){if(typeof o!="object"||o===null)return o;var L=o[Symbol.toPrimitive];if(L!==void 0){var x=L.call(o,_||"default");if(typeof x!="object")return x;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(o)}var v=h(h({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:M.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:R.default,bufferController:k.default,capLevelController:B.default,fpsController:P.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:E.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},c()),{},{subtitleStreamController:D.SubtitleStreamController,subtitleTrackController:K.default,timelineController:F.TimelineController,audioStreamController:A.default,audioTrackController:w.default,emeController:N.default,cmcdController:g.default});function c(){return{cueHandler:f.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function a(o,_){if((_.liveSyncDurationCount||_.liveMaxLatencyDurationCount)&&(_.liveSyncDuration||_.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(_.liveMaxLatencyDurationCount!==void 0&&(_.liveSyncDurationCount===void 0||_.liveMaxLatencyDurationCount<=_.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(_.liveMaxLatencyDuration!==void 0&&(_.liveSyncDuration===void 0||_.liveMaxLatencyDuration<=_.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return l({},o,_)}function T(o){var _=o.loader;if(_!==S.default&&_!==M.default)d.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),o.progressive=!1;else{var L=(0,S.fetchSupported)();L&&(o.loader=S.default,o.progressive=!0,o.enableSoftwareAES=!0,d.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>M});var R=s("./src/polyfills/number.ts"),A=s("./src/utils/ewma-bandwidth-estimator.ts"),w=s("./src/events.ts"),D=s("./src/errors.ts"),K=s("./src/types/loader.ts"),k=s("./src/utils/logger.ts");function F(S,f){for(var E=0;E<f.length;E++){var d=f[E];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(S,P(d.key),d)}}function B(S,f,E){return f&&F(S.prototype,f),E&&F(S,E),Object.defineProperty(S,"prototype",{writable:!1}),S}function P(S){var f=N(S,"string");return typeof f=="symbol"?f:String(f)}function N(S,f){if(typeof S!="object"||S===null)return S;var E=S[Symbol.toPrimitive];if(E!==void 0){var d=E.call(S,f||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(S)}var g=function(){function S(E){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=E;var d=E.config;this.bwEstimator=new A.default(d.abrEwmaSlowVoD,d.abrEwmaFastVoD,d.abrEwmaDefaultEstimate),this.registerListeners()}var f=S.prototype;return f.registerListeners=function(){var d=this.hls;d.on(w.Events.FRAG_LOADING,this.onFragLoading,this),d.on(w.Events.FRAG_LOADED,this.onFragLoaded,this),d.on(w.Events.FRAG_BUFFERED,this.onFragBuffered,this),d.on(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.on(w.Events.ERROR,this.onError,this)},f.unregisterListeners=function(){var d=this.hls;d.off(w.Events.FRAG_LOADING,this.onFragLoading,this),d.off(w.Events.FRAG_LOADED,this.onFragLoaded,this),d.off(w.Events.FRAG_BUFFERED,this.onFragBuffered,this),d.off(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.off(w.Events.ERROR,this.onError,this)},f.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},f.onFragLoading=function(d,l){var b=l.frag;if(b.type===K.PlaylistLevelType.MAIN&&!this.timer){var h;this.fragCurrent=b,this.partCurrent=(h=l.part)!=null?h:null,this.timer=self.setInterval(this.onCheck,100)}},f.onLevelLoaded=function(d,l){var b=this.hls.config;l.details.live?this.bwEstimator.update(b.abrEwmaSlowLive,b.abrEwmaFastLive):this.bwEstimator.update(b.abrEwmaSlowVoD,b.abrEwmaFastVoD)},f._abandonRulesCheck=function(){var d=this.fragCurrent,l=this.partCurrent,b=this.hls,h=b.autoLevelEnabled,u=b.media;if(!(!d||!u)){var m=l?l.stats:d.stats,y=l?l.duration:d.duration;if(m.aborted||m.loaded&&m.loaded===m.total||d.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!h||u.paused||!u.playbackRate||!u.readyState)){var v=b.mainForwardBufferInfo;if(v!==null){var c=performance.now()-m.loading.start,a=Math.abs(u.playbackRate);if(!(c<=500*y/a)){var T=m.loaded&&m.loading.first,o=this.bwEstimator.getEstimate(),_=b.levels,L=b.minAutoLevel,x=_[d.level],H=m.total||Math.max(m.loaded,Math.round(y*x.maxBitrate/8)),W=T?m.loaded*1e3/c:0,U=W?(H-m.loaded)/W:H*8/o,G=v.len/a;if(!(U<=G)){var Y=Number.POSITIVE_INFINITY,j;for(j=d.level-1;j>L;j--){var X=_[j].maxBitrate;if(Y=W?y*X/(8*.8*W):y*X/o,Y<G)break}Y>=U||(k.logger.warn("Fragment "+d.sn+(l?" part "+l.index:"")+" of level "+d.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+j+`
      Current BW estimate: `+((0,R.isFiniteNumber)(o)?(o/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+U.toFixed(3)+` s
      Estimated load time for the next fragment: `+Y.toFixed(3)+` s
      Time to underbuffer: `+G.toFixed(3)+" s"),b.nextLoadLevel=j,T&&this.bwEstimator.sample(c,m.loaded),this.clearTimer(),(d.loader||d.keyLoader)&&(this.fragCurrent=this.partCurrent=null,d.abortRequests()),b.trigger(w.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:d,part:l,stats:m}))}}}}}},f.onFragLoaded=function(d,l){var b=l.frag,h=l.part;if(b.type===K.PlaylistLevelType.MAIN&&(0,R.isFiniteNumber)(b.sn)){var u=h?h.stats:b.stats,m=h?h.duration:b.duration;if(this.clearTimer(),this.lastLoadedFragLevel=b.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var y=this.hls.levels[b.level],v=(y.loaded?y.loaded.bytes:0)+u.loaded,c=(y.loaded?y.loaded.duration:0)+m;y.loaded={bytes:v,duration:c},y.realBitrate=Math.round(8*v/c)}if(b.bitrateTest){var a={stats:u,frag:b,part:h,id:b.type};this.onFragBuffered(w.Events.FRAG_BUFFERED,a)}}},f.onFragBuffered=function(d,l){var b=l.frag,h=l.part,u=h?h.stats:b.stats;if(!u.aborted&&!(b.type!==K.PlaylistLevelType.MAIN||b.sn==="initSegment")){var m=u.parsing.end-u.loading.start;this.bwEstimator.sample(m,u.loaded),u.bwEstimate=this.bwEstimator.getEstimate(),b.bitrateTest?this.bitrateTestDelay=m/1e3:this.bitrateTestDelay=0}},f.onError=function(d,l){var b;if(((b=l.frag)===null||b===void 0?void 0:b.type)===K.PlaylistLevelType.MAIN){if(l.type===D.ErrorTypes.KEY_SYSTEM_ERROR){this.clearTimer();return}switch(l.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer();break}}},f.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},f.getNextABRAutoLevel=function(){var d=this.fragCurrent,l=this.partCurrent,b=this.hls,h=b.maxAutoLevel,u=b.config,m=b.minAutoLevel,y=b.media,v=l?l.duration:d?d.duration:0,c=y&&y.playbackRate!==0?Math.abs(y.playbackRate):1,a=this.bwEstimator?this.bwEstimator.getEstimate():u.abrEwmaDefaultEstimate,T=b.mainForwardBufferInfo,o=(T?T.len:0)/c,_=this.findBestLevel(a,m,h,o,u.abrBandWidthFactor,u.abrBandWidthUpFactor);if(_>=0)return _;k.logger.trace((o?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var L=v?Math.min(v,u.maxStarvationDelay):u.maxStarvationDelay,x=u.abrBandWidthFactor,H=u.abrBandWidthUpFactor;if(!o){var W=this.bitrateTestDelay;if(W){var U=v?Math.min(v,u.maxLoadingDelay):u.maxLoadingDelay;L=U-W,k.logger.trace("bitrate test took "+Math.round(1e3*W)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*L)+" ms"),x=H=1}}return _=this.findBestLevel(a,m,h,o+L,x,H),Math.max(_,0)},f.findBestLevel=function(d,l,b,h,u,m){for(var y,v=this.fragCurrent,c=this.partCurrent,a=this.lastLoadedFragLevel,T=this.hls.levels,o=T[a],_=!!(o!=null&&(y=o.details)!==null&&y!==void 0&&y.live),L=o==null?void 0:o.codecSet,x=c?c.duration:v?v.duration:0,H=b;H>=l;H--){var W=T[H];if(!(!W||L&&W.codecSet!==L)){var U=W.details,G=(c?U==null?void 0:U.partTarget:U==null?void 0:U.averagetargetduration)||x,Y=void 0;H<=a?Y=u*d:Y=m*d;var j=T[H].maxBitrate,X=j*G/Y;if(k.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+H+"/"+Math.round(Y)+"/"+j+"/"+G+"/"+h+"/"+X),Y>j&&(X===0||!(0,R.isFiniteNumber)(X)||_&&!this.bitrateTestDelay||X<h))return H}}return-1},B(S,[{key:"nextAutoLevel",get:function(){var d=this._nextAutoLevel,l=this.bwEstimator;if(d!==-1&&!l.canEstimate())return d;var b=this.getNextABRAutoLevel();return d!==-1&&this.hls.levels[b].loadError?d:(d!==-1&&(b=Math.min(d,b)),b)},set:function(d){this._nextAutoLevel=d}}]),S}();const M=g},"./src/controller/audio-stream-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>u});var R=s("./src/polyfills/number.ts"),A=s("./src/controller/base-stream-controller.ts"),w=s("./src/events.ts"),D=s("./src/utils/buffer-helper.ts"),K=s("./src/controller/fragment-tracker.ts"),k=s("./src/types/level.ts"),F=s("./src/types/loader.ts"),B=s("./src/loader/fragment.ts"),P=s("./src/demux/chunk-cache.ts"),N=s("./src/demux/transmuxer-interface.ts"),g=s("./src/types/transmuxer.ts"),M=s("./src/controller/fragment-finders.ts"),S=s("./src/utils/discontinuities.ts"),f=s("./src/errors.ts");function E(){return E=Object.assign?Object.assign.bind():function(m){for(var y=1;y<arguments.length;y++){var v=arguments[y];for(var c in v)Object.prototype.hasOwnProperty.call(v,c)&&(m[c]=v[c])}return m},E.apply(this,arguments)}function d(m,y){m.prototype=Object.create(y.prototype),m.prototype.constructor=m,l(m,y)}function l(m,y){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,a){return c.__proto__=a,c},l(m,y)}var b=100,h=function(m){d(y,m);function y(c,a,T){var o;return o=m.call(this,c,a,T,"[audio-stream-controller]")||this,o.videoBuffer=null,o.videoTrackCC=-1,o.waitingVideoCC=-1,o.audioSwitch=!1,o.trackId=-1,o.waitingData=null,o.mainDetails=null,o.bufferFlushed=!1,o.cachedTrackLoadedData=null,o._registerListeners(),o}var v=y.prototype;return v.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},v._registerListeners=function(){var a=this.hls;a.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(w.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.on(w.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(w.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(w.Events.ERROR,this.onError,this),a.on(w.Events.BUFFER_RESET,this.onBufferReset,this),a.on(w.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(w.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(w.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(w.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var a=this.hls;a.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(w.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.off(w.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(w.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(w.Events.ERROR,this.onError,this),a.off(w.Events.BUFFER_RESET,this.onBufferReset,this),a.off(w.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(w.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(w.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(w.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onInitPtsFound=function(a,T){var o=T.frag,_=T.id,L=T.initPTS;if(_==="main"){var x=o.cc;this.initPTS[o.cc]=L,this.log("InitPTS for cc: "+x+" found from main: "+L),this.videoTrackCC=x,this.state===A.State.WAITING_INIT_PTS&&this.tick()}},v.startLoad=function(a){if(!this.levels){this.startPosition=a,this.state=A.State.STOPPED;return}var T=this.lastCurrentTime;this.stopLoad(),this.setInterval(b),this.fragLoadError=0,T>0&&a===-1?(this.log("Override startPosition with lastCurrentTime @"+T.toFixed(3)),a=T,this.state=A.State.IDLE):(this.loadedmetadata=!1,this.state=A.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()},v.doTick=function(){switch(this.state){case A.State.IDLE:this.doTickIdle();break;case A.State.WAITING_TRACK:{var a,T=this.levels,o=this.trackId,_=T==null||(a=T[o])===null||a===void 0?void 0:a.details;if(_){if(this.waitForCdnTuneIn(_))break;this.state=A.State.WAITING_INIT_PTS}break}case A.State.FRAG_LOADING_WAITING_RETRY:{var L,x=performance.now(),H=this.retryDate;(!H||x>=H||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=A.State.IDLE);break}case A.State.WAITING_INIT_PTS:{var W=this.waitingData;if(W){var U=W.frag,G=W.part,Y=W.cache,j=W.complete;if(this.initPTS[U.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=A.State.FRAG_LOADING;var X=Y.flush(),q={frag:U,part:G,payload:X,networkDetails:null};this._handleFragmentLoadProgress(q),j&&m.prototype._handleFragmentLoadComplete.call(this,q)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+U.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var J=this.getLoadPosition(),V=D.BufferHelper.bufferInfo(this.mediaBuffer,J,this.config.maxBufferHole),Q=(0,M.fragmentWithinToleranceTest)(V.end,this.config.maxFragLookUpTolerance,U);Q<0&&(this.log("Waiting fragment cc ("+U.cc+") @ "+U.start+" cancelled because another fragment at "+V.end+" is needed"),this.clearWaitingFragment())}}else this.state=A.State.IDLE}}this.onTickEnd()},v.clearWaitingFragment=function(){var a=this.waitingData;a&&(this.fragmentTracker.removeFragment(a.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=A.State.IDLE)},v.resetLoadingState=function(){this.clearWaitingFragment(),m.prototype.resetLoadingState.call(this)},v.onTickEnd=function(){var a=this.media;!a||!a.readyState||(this.lastCurrentTime=a.currentTime)},v.doTickIdle=function(){var a=this.hls,T=this.levels,o=this.media,_=this.trackId,L=a.config;if(!(!T||!T[_])&&!(!o&&(this.startFragRequested||!L.startFragPrefetch))){var x=T[_],H=x.details;if(!H||H.live&&this.levelLastLoaded!==_||this.waitForCdnTuneIn(H)){this.state=A.State.WAITING_TRACK;return}var W=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&W&&(this.bufferFlushed=!1,this.afterBufferFlushed(W,B.ElementaryStreamTypes.AUDIO,F.PlaylistLevelType.AUDIO));var U=this.getFwdBufferInfo(W,F.PlaylistLevelType.AUDIO);if(U!==null){var G=this.audioSwitch;if(!G&&this._streamEnded(U,H)){a.trigger(w.Events.BUFFER_EOS,{type:"audio"}),this.state=A.State.ENDED;return}var Y=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,F.PlaylistLevelType.MAIN),j=U.len,X=this.getMaxBufferLength(Y==null?void 0:Y.len);if(!(j>=X&&!G)){var q=H.fragments,J=q[0].start,V=U.end;if(G&&o){var Q=this.getLoadPosition();V=Q,H.PTSKnown&&Q<J&&(U.end>J||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),o.currentTime=J+.05)}if(!(Y&&V>Y.end+H.targetduration)&&!((!Y||!Y.len)&&U.len)){var ee=this.getNextFragment(V,H);if(!ee){this.bufferFlushed=!0;return}this.loadFragment(ee,H,V)}}}}},v.getMaxBufferLength=function(a){var T=m.prototype.getMaxBufferLength.call(this);return a?Math.max(T,a):T},v.onMediaDetaching=function(){this.videoBuffer=null,m.prototype.onMediaDetaching.call(this)},v.onAudioTracksUpdated=function(a,T){var o=T.audioTracks;this.resetTransmuxer(),this.levels=o.map(function(_){return new k.Level(_)})},v.onAudioTrackSwitching=function(a,T){var o=!!T.url;this.trackId=T.id;var _=this.fragCurrent;_&&_.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),o?this.setInterval(b):this.resetTransmuxer(),o?(this.audioSwitch=!0,this.state=A.State.IDLE):this.state=A.State.STOPPED,this.tick()},v.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},v.onLevelLoaded=function(a,T){this.mainDetails=T.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(w.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},v.onAudioTrackLoaded=function(a,T){var o;if(this.mainDetails==null){this.cachedTrackLoadedData=T;return}var _=this.levels,L=T.details,x=T.id;if(!_){this.warn("Audio tracks were reset while loading level "+x);return}this.log("Track "+x+" loaded ["+L.startSN+","+L.endSN+"],duration:"+L.totalduration);var H=_[x],W=0;if(L.live||(o=H.details)!==null&&o!==void 0&&o.live){var U=this.mainDetails;if(L.fragments[0]||(L.deltaUpdateFailed=!0),L.deltaUpdateFailed||!U)return;!H.details&&L.hasProgramDateTime&&U.hasProgramDateTime?((0,S.alignMediaPlaylistByPDT)(L,U),W=L.fragments[0].start):W=this.alignPlaylists(L,H.details)}H.details=L,this.levelLastLoaded=x,!this.startFragRequested&&(this.mainDetails||!L.live)&&this.setStartPosition(H.details,W),this.state===A.State.WAITING_TRACK&&!this.waitForCdnTuneIn(L)&&(this.state=A.State.IDLE),this.tick()},v._handleFragmentLoadProgress=function(a){var T,o=a.frag,_=a.part,L=a.payload,x=this.config,H=this.trackId,W=this.levels;if(!W){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+o.sn+" of level "+o.level+" will not be buffered");return}var U=W[H];console.assert(U,"Audio track is defined on fragment load progress");var G=U.details;console.assert(G,"Audio track details are defined on fragment load progress");var Y=x.defaultAudioCodec||U.audioCodec||"mp4a.40.2",j=this.transmuxer;j||(j=this.transmuxer=new N.default(this.hls,F.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var X=this.initPTS[o.cc],q=(T=o.initSegment)===null||T===void 0?void 0:T.data;if(X!==void 0){var J=!1,V=_?_.index:-1,Q=V!==-1,ee=new g.ChunkMetadata(o.level,o.sn,o.stats.chunkCount,L.byteLength,V,Q);j.push(L,q,Y,"",o,_,G.totalduration,J,ee,X)}else{this.log("Unknown video PTS for cc "+o.cc+", waiting for video PTS before demuxing audio frag "+o.sn+" of ["+G.startSN+" ,"+G.endSN+"],track "+H);var Z=this.waitingData=this.waitingData||{frag:o,part:_,cache:new P.default,complete:!1},re=Z.cache;re.push(new Uint8Array(L)),this.waitingVideoCC=this.videoTrackCC,this.state=A.State.WAITING_INIT_PTS}},v._handleFragmentLoadComplete=function(a){if(this.waitingData){this.waitingData.complete=!0;return}m.prototype._handleFragmentLoadComplete.call(this,a)},v.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},v.onBufferCreated=function(a,T){var o=T.tracks.audio;o&&(this.mediaBuffer=o.buffer||null),T.tracks.video&&(this.videoBuffer=T.tracks.video.buffer||null)},v.onFragBuffered=function(a,T){var o=T.frag,_=T.part;if(o.type!==F.PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&o.type===F.PlaylistLevelType.MAIN){var L;(L=this.videoBuffer||this.media)!==null&&L!==void 0&&L.buffered.length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(o)){this.warn("Fragment "+o.sn+(_?" p: "+_.index:"")+" of level "+o.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}o.sn!=="initSegment"&&(this.fragPrevious=o,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(w.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(o,_)},v.onError=function(a,T){if(T.type===f.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(F.PlaylistLevelType.AUDIO,T);return}switch(T.details){case f.ErrorDetails.FRAG_LOAD_ERROR:case f.ErrorDetails.FRAG_LOAD_TIMEOUT:case f.ErrorDetails.FRAG_PARSING_ERROR:case f.ErrorDetails.KEY_LOAD_ERROR:case f.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(F.PlaylistLevelType.AUDIO,T);break;case f.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case f.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==A.State.ERROR&&this.state!==A.State.STOPPED&&(this.state=T.fatal?A.State.ERROR:A.State.IDLE,this.warn(T.details+" while loading frag, switching to "+this.state+" state"));break;case f.ErrorDetails.BUFFER_FULL_ERROR:if(T.parent==="audio"&&(this.state===A.State.PARSING||this.state===A.State.PARSED)){var o=!0,_=this.getFwdBufferInfo(this.mediaBuffer,F.PlaylistLevelType.AUDIO);_&&_.len>.5&&(o=!this.reduceMaxBufferLength(_.len)),o&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,m.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},v.onBufferFlushed=function(a,T){var o=T.type;o===B.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===A.State.ENDED&&(this.state=A.State.IDLE))},v._handleTransmuxComplete=function(a){var T,o="audio",_=this.hls,L=a.remuxResult,x=a.chunkMeta,H=this.getCurrentContext(x);if(!H){this.warn("The loading context changed while buffering fragment "+x.sn+" of level "+x.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(x.level);return}var W=H.frag,U=H.part,G=H.level.details,Y=L.audio,j=L.text,X=L.id3,q=L.initSegment;if(!(this.fragContextChanged(W)||!G)){if(this.state=A.State.PARSING,this.audioSwitch&&Y&&this.completeAudioSwitch(),q!=null&&q.tracks&&(this._bufferInitSegment(q.tracks,W,x),_.trigger(w.Events.FRAG_PARSING_INIT_SEGMENT,{frag:W,id:o,tracks:q.tracks})),Y){var J=Y.startPTS,V=Y.endPTS,Q=Y.startDTS,ee=Y.endDTS;U&&(U.elementaryStreams[B.ElementaryStreamTypes.AUDIO]={startPTS:J,endPTS:V,startDTS:Q,endDTS:ee}),W.setElementaryStreamInfo(B.ElementaryStreamTypes.AUDIO,J,V,Q,ee),this.bufferFragmentData(Y,W,U,x)}if(X!=null&&(T=X.samples)!==null&&T!==void 0&&T.length){var Z=E({id:o,frag:W,details:G},X);_.trigger(w.Events.FRAG_PARSING_METADATA,Z)}if(j){var re=E({id:o,frag:W,details:G},j);_.trigger(w.Events.FRAG_PARSING_USERDATA,re)}}},v._bufferInitSegment=function(a,T,o){if(this.state===A.State.PARSING){a.video&&delete a.video;var _=a.audio;if(_){_.levelCodec=_.codec,_.id="audio",this.log("Init audio buffer, container:"+_.container+", codecs[parsed]=["+_.codec+"]"),this.hls.trigger(w.Events.BUFFER_CODECS,a);var L=_.initSegment;if(L!=null&&L.byteLength){var x={type:"audio",frag:T,part:null,chunkMeta:o,parent:T.type,data:L};this.hls.trigger(w.Events.BUFFER_APPENDING,x)}this.tick()}}},v.loadFragment=function(a,T,o){var _=this.fragmentTracker.getState(a);this.fragCurrent=a,(this.audioSwitch||_===K.FragmentState.NOT_LOADED||_===K.FragmentState.PARTIAL)&&(a.sn==="initSegment"?this._loadInitSegment(a,T):T.live&&!(0,R.isFiniteNumber)(this.initPTS[a.cc])?(this.log("Waiting for video PTS in continuity counter "+a.cc+" of live stream before loading audio fragment "+a.sn+" of level "+this.trackId),this.state=A.State.WAITING_INIT_PTS):(this.startFragRequested=!0,m.prototype.loadFragment.call(this,a,T,o)))},v.completeAudioSwitch=function(){var a=this.hls,T=this.media,o=this.trackId;T&&(this.log("Switching audio track : flushing all audio"),m.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,a.trigger(w.Events.AUDIO_TRACK_SWITCHED,{id:o})},y}(A.default);const u=h},"./src/controller/audio-track-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>M});var R=s("./src/events.ts"),A=s("./src/errors.ts"),w=s("./src/controller/base-playlist-controller.ts"),D=s("./src/types/loader.ts");function K(S,f){for(var E=0;E<f.length;E++){var d=f[E];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(S,F(d.key),d)}}function k(S,f,E){return f&&K(S.prototype,f),E&&K(S,E),Object.defineProperty(S,"prototype",{writable:!1}),S}function F(S){var f=B(S,"string");return typeof f=="symbol"?f:String(f)}function B(S,f){if(typeof S!="object"||S===null)return S;var E=S[Symbol.toPrimitive];if(E!==void 0){var d=E.call(S,f||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(S)}function P(S,f){S.prototype=Object.create(f.prototype),S.prototype.constructor=S,N(S,f)}function N(S,f){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,l){return d.__proto__=l,d},N(S,f)}var g=function(S){P(f,S);function f(d){var l;return l=S.call(this,d,"[audio-track-controller]")||this,l.tracks=[],l.groupId=null,l.tracksInGroup=[],l.trackId=-1,l.trackName="",l.selectDefaultTrack=!0,l.registerListeners(),l}var E=f.prototype;return E.registerListeners=function(){var l=this.hls;l.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.on(R.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),l.on(R.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){var l=this.hls;l.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),l.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.off(R.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),l.off(R.Events.ERROR,this.onError,this)},E.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,S.prototype.destroy.call(this)},E.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},E.onManifestParsed=function(l,b){this.tracks=b.audioTracks||[]},E.onAudioTrackLoaded=function(l,b){var h=b.id,u=b.details,m=this.tracksInGroup[h];if(!m){this.warn("Invalid audio track id "+h);return}var y=m.details;m.details=b.details,this.log("audioTrack "+h+" loaded ["+u.startSN+"-"+u.endSN+"]"),h===this.trackId&&(this.retryCount=0,this.playlistLoaded(h,b,y))},E.onLevelLoading=function(l,b){this.switchLevel(b.level)},E.onLevelSwitching=function(l,b){this.switchLevel(b.level)},E.switchLevel=function(l){var b=this.hls.levels[l];if(b!=null&&b.audioGroupIds){var h=b.audioGroupIds[b.urlId];if(this.groupId!==h){this.groupId=h;var u=this.tracks.filter(function(y){return!h||y.groupId===h});this.selectDefaultTrack&&!u.some(function(y){return y.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;var m={audioTracks:u};this.log("Updating audio tracks, "+u.length+' track(s) found in "'+h+'" group-id'),this.hls.trigger(R.Events.AUDIO_TRACKS_UPDATED,m),this.selectInitialTrack()}}},E.onError=function(l,b){S.prototype.onError.call(this,l,b),!(b.fatal||!b.context)&&b.context.type===D.PlaylistContextType.AUDIO_TRACK&&b.context.id===this.trackId&&b.context.groupId===this.groupId&&this.retryLoadingOrFail(b)},E.setAudioTrack=function(l){var b=this.tracksInGroup;if(l<0||l>=b.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var h=b[this.trackId];this.log("Now switching to audio-track index "+l);var u=b[l],m=u.id,y=u.groupId,v=y===void 0?"":y,c=u.name,a=u.type,T=u.url;if(this.trackId=l,this.trackName=c,this.selectDefaultTrack=!1,this.hls.trigger(R.Events.AUDIO_TRACK_SWITCHING,{id:m,groupId:v,name:c,type:a,url:T}),!(u.details&&!u.details.live)){var o=this.switchParams(u.url,h==null?void 0:h.details);this.loadPlaylist(o)}},E.selectInitialTrack=function(){var l=this.tracksInGroup;console.assert(l.length,"Initial audio track should be selected when tracks are known");var b=this.trackName,h=this.findTrackId(b)||this.findTrackId();h!==-1?this.setAudioTrack(h):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(R.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},E.findTrackId=function(l){for(var b=this.tracksInGroup,h=0;h<b.length;h++){var u=b[h];if((!this.selectDefaultTrack||u.default)&&(!l||l===u.name))return u.id}return-1},E.loadPlaylist=function(l){S.prototype.loadPlaylist.call(this);var b=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(b)){var h=b.id,u=b.groupId,m=b.url;if(l)try{m=l.addDirectives(m)}catch(y){this.warn("Could not construct new URL with HLS Delivery Directives: "+y)}this.log("loading audio-track playlist for id: "+h),this.clearTimer(),this.hls.trigger(R.Events.AUDIO_TRACK_LOADING,{url:m,id:h,groupId:u,deliveryDirectives:l||null})}},k(f,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(l){this.selectDefaultTrack=!1,this.setAudioTrack(l)}}]),f}(w.default);const M=g},"./src/controller/base-playlist-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>K});var R=s("./src/types/level.ts"),A=s("./src/controller/level-helper.ts"),w=s("./src/utils/logger.ts"),D=s("./src/errors.ts"),K=function(){function k(B,P){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=w.logger.log.bind(w.logger,P+":"),this.warn=w.logger.warn.bind(w.logger,P+":"),this.hls=B}var F=k.prototype;return F.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},F.onError=function(P,N){N.fatal&&(N.type===D.ErrorTypes.NETWORK_ERROR||N.type===D.ErrorTypes.KEY_SYSTEM_ERROR)&&this.stopLoad()},F.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},F.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},F.stopLoad=function(){this.canLoad=!1,this.clearTimer()},F.switchParams=function(P,N){var g=N==null?void 0:N.renditionReports;if(g)for(var M=0;M<g.length;M++){var S=g[M],f=void 0;try{f=new self.URL(S.URI,N.url).href}catch(b){w.logger.warn("Could not construct new URL for Rendition Report: "+b),f=S.URI||""}if(f===P.slice(-f.length)){var E=parseInt(S["LAST-MSN"])||(N==null?void 0:N.lastPartSn),d=parseInt(S["LAST-PART"])||(N==null?void 0:N.lastPartIndex);if(this.hls.config.lowLatencyMode){var l=Math.min(N.age-N.partTarget,N.targetduration);d>=0&&l>N.partTarget&&(d+=1)}return new R.HlsUrlParameters(E,d>=0?d:void 0,R.HlsSkip.No)}}},F.loadPlaylist=function(P){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},F.shouldLoadTrack=function(P){return this.canLoad&&P&&!!P.url&&(!P.details||P.details.live)},F.playlistLoaded=function(P,N,g){var M=this,S=N.details,f=N.stats,E=self.performance.now(),d=f.loading.first?Math.max(0,E-f.loading.first):0;if(S.advancedDateTime=Date.now()-d,S.live||g!=null&&g.live){if(S.reloaded(g),g&&this.log("live playlist "+P+" "+(S.advanced?"REFRESHED "+S.lastPartSn+"-"+S.lastPartIndex:"MISSED")),g&&S.fragments.length>0&&(0,A.mergeDetails)(g,S),!this.canLoad||!S.live)return;var l,b=void 0,h=void 0;if(S.canBlockReload&&S.endSN&&S.advanced){var u=this.hls.config.lowLatencyMode,m=S.lastPartSn,y=S.endSN,v=S.lastPartIndex,c=v!==-1,a=m===y,T=u?0:v;c?(b=a?y+1:m,h=a?T:v+1):b=y+1;var o=S.age,_=o+S.ageHeader,L=Math.min(_-S.partTarget,S.targetduration*1.5);if(L>0){if(g&&L>g.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+g.tuneInGoal+" to: "+L+" with playlist age: "+S.age),L=0;else{var x=Math.floor(L/S.targetduration);if(b+=x,h!==void 0){var H=Math.round(L%S.targetduration/S.partTarget);h+=H}this.log("CDN Tune-in age: "+S.ageHeader+"s last advanced "+o.toFixed(2)+"s goal: "+L+" skip sn "+x+" to part "+h)}S.tuneInGoal=L}if(l=this.getDeliveryDirectives(S,N.deliveryDirectives,b,h),u||!a){this.loadPlaylist(l);return}}else l=this.getDeliveryDirectives(S,N.deliveryDirectives,b,h);var W=this.hls.mainForwardBufferInfo,U=W?W.end-W.len:0,G=(S.edge-U)*1e3,Y=(0,A.computeReloadInterval)(S,G);S.updated?E>this.requestScheduled+Y&&(this.requestScheduled=f.loading.start):this.requestScheduled=-1,b!==void 0&&S.canBlockReload?this.requestScheduled=f.loading.first+Y-(S.partTarget*1e3||1e3):this.requestScheduled=(this.requestScheduled===-1?E:this.requestScheduled)+Y;var j=this.requestScheduled-E;j=Math.max(0,j),this.log("reload live playlist "+P+" in "+Math.round(j)+" ms"),this.timer=self.setTimeout(function(){return M.loadPlaylist(l)},j)}else this.clearTimer()},F.getDeliveryDirectives=function(P,N,g,M){var S=(0,R.getSkipValue)(P,g);return N!=null&&N.skip&&P.deltaUpdateFailed&&(g=N.msn,M=N.part,S=R.HlsSkip.No),new R.HlsUrlParameters(g,M,S)},F.retryLoadingOrFail=function(P){var N=this,g=this.hls.config,M=this.retryCount<g.levelLoadingMaxRetry;if(M){var S;if(this.requestScheduled=-1,this.retryCount++,P.details.indexOf("LoadTimeOut")>-1&&(S=P.context)!==null&&S!==void 0&&S.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+P.details+'"'),this.loadPlaylist();else{var f=Math.min(Math.pow(2,this.retryCount)*g.levelLoadingRetryDelay,g.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return N.loadPlaylist()},f),this.warn("retry playlist loading #"+this.retryCount+" in "+f+' ms after "'+P.details+'"')}}else this.warn('cannot recover from error "'+P.details+'"'),this.clearTimer(),P.fatal=!0;return M},k}()},"./src/controller/base-stream-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{State:()=>c,default:()=>a});var R=s("./src/polyfills/number.ts"),A=s("./src/task-loop.ts"),w=s("./src/controller/fragment-tracker.ts"),D=s("./src/utils/buffer-helper.ts"),K=s("./src/utils/logger.ts"),k=s("./src/events.ts"),F=s("./src/errors.ts"),B=s("./src/types/transmuxer.ts"),P=s("./src/utils/mp4-tools.ts"),N=s("./src/utils/discontinuities.ts"),g=s("./src/controller/fragment-finders.ts"),M=s("./src/controller/level-helper.ts"),S=s("./src/loader/fragment-loader.ts"),f=s("./src/crypt/decrypter.ts"),E=s("./src/utils/time-ranges.ts"),d=s("./src/types/loader.ts");function l(T,o){for(var _=0;_<o.length;_++){var L=o[_];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(T,h(L.key),L)}}function b(T,o,_){return o&&l(T.prototype,o),_&&l(T,_),Object.defineProperty(T,"prototype",{writable:!1}),T}function h(T){var o=u(T,"string");return typeof o=="symbol"?o:String(o)}function u(T,o){if(typeof T!="object"||T===null)return T;var _=T[Symbol.toPrimitive];if(_!==void 0){var L=_.call(T,o||"default");if(typeof L!="object")return L;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(T)}function m(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function y(T,o){T.prototype=Object.create(o.prototype),T.prototype.constructor=T,v(T,o)}function v(T,o){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(L,x){return L.__proto__=x,L},v(T,o)}var c={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},a=function(T){y(o,T);function o(L,x,H,W){var U;return U=T.call(this)||this,U.hls=void 0,U.fragPrevious=null,U.fragCurrent=null,U.fragmentTracker=void 0,U.transmuxer=null,U._state=c.STOPPED,U.media=null,U.mediaBuffer=null,U.config=void 0,U.bitrateTest=!1,U.lastCurrentTime=0,U.nextLoadPosition=0,U.startPosition=0,U.loadedmetadata=!1,U.fragLoadError=0,U.retryDate=0,U.levels=null,U.fragmentLoader=void 0,U.keyLoader=void 0,U.levelLastLoaded=null,U.startFragRequested=!1,U.decrypter=void 0,U.initPTS=[],U.onvseeking=null,U.onvended=null,U.logPrefix="",U.log=void 0,U.warn=void 0,U.logPrefix=W,U.log=K.logger.log.bind(K.logger,W+":"),U.warn=K.logger.warn.bind(K.logger,W+":"),U.hls=L,U.fragmentLoader=new S.default(L.config),U.keyLoader=H,U.fragmentTracker=x,U.config=L.config,U.decrypter=new f.default(L.config),L.on(k.Events.LEVEL_SWITCHING,U.onLevelSwitching,m(U)),U}var _=o.prototype;return _.doTick=function(){this.onTickEnd()},_.onTickEnd=function(){},_.startLoad=function(x){},_.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var x=this.fragCurrent;x&&(x.abortRequests(),this.fragmentTracker.removeFragment(x)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=c.STOPPED},_._streamEnded=function(x,H){if(H.live||x.nextStart||!x.end||!this.media)return!1;var W=H.partList;if(W!=null&&W.length){var U=W[W.length-1],G=D.BufferHelper.isBuffered(this.media,U.start+U.duration/2);return G}var Y=H.fragments[H.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(Y)},_.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var x;return(x=this.levels[this.levelLastLoaded])===null||x===void 0?void 0:x.details}},_.onMediaAttached=function(x,H){var W=this.media=this.mediaBuffer=H.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),W.addEventListener("seeking",this.onvseeking),W.addEventListener("ended",this.onvended);var U=this.config;this.levels&&U.autoStartLoad&&this.state===c.STOPPED&&this.startLoad(U.startPosition)},_.onMediaDetaching=function(){var x=this.media;x!=null&&x.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),x&&this.onvseeking&&this.onvended&&(x.removeEventListener("seeking",this.onvseeking),x.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},_.onMediaSeeking=function(){var x=this.config,H=this.fragCurrent,W=this.media,U=this.mediaBuffer,G=this.state,Y=W?W.currentTime:0,j=D.BufferHelper.bufferInfo(U||W,Y,x.maxBufferHole);if(this.log("media seeking to "+((0,R.isFiniteNumber)(Y)?Y.toFixed(3):Y)+", state: "+G),this.state===c.ENDED)this.resetLoadingState();else if(H){var X=x.maxFragLookUpTolerance,q=H.start-X,J=H.start+H.duration+X;if(!j.len||J<j.start||q>j.end){var V=Y>J;(Y<q||V)&&(V&&H.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),H.abortRequests()),this.resetLoadingState())}}W&&(this.lastCurrentTime=Y),!this.loadedmetadata&&!j.len&&(this.nextLoadPosition=this.startPosition=Y),this.tickImmediate()},_.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},_.onLevelSwitching=function(x,H){this.fragLoadError=0},_.onHandlerDestroying=function(){this.stopLoad(),T.prototype.onHandlerDestroying.call(this)},_.onHandlerDestroyed=function(){this.state=c.STOPPED,this.hls.off(k.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,T.prototype.onHandlerDestroyed.call(this)},_.loadFragment=function(x,H,W){this._loadFragForPlayback(x,H,W)},_._loadFragForPlayback=function(x,H,W){var U=this,G=function(j){if(U.fragContextChanged(x)){U.warn("Fragment "+x.sn+(j.part?" p: "+j.part.index:"")+" of level "+x.level+" was dropped during download."),U.fragmentTracker.removeFragment(x);return}x.stats.chunkCount++,U._handleFragmentLoadProgress(j)};this._doFragLoad(x,H,W,G).then(function(Y){if(Y){U.fragLoadError=0;var j=U.state;if(U.fragContextChanged(x)){(j===c.FRAG_LOADING||!U.fragCurrent&&j===c.PARSING)&&(U.fragmentTracker.removeFragment(x),U.state=c.IDLE);return}"payload"in Y&&(U.log("Loaded fragment "+x.sn+" of level "+x.level),U.hls.trigger(k.Events.FRAG_LOADED,Y)),U._handleFragmentLoadComplete(Y)}}).catch(function(Y){U.state===c.STOPPED||U.state===c.ERROR||(U.warn(Y),U.resetFragmentLoading(x))})},_.flushMainBuffer=function(x,H,W){if(W===void 0&&(W=null),!!(x-H)){var U={startOffset:x,endOffset:H,type:W};this.fragLoadError=0,this.hls.trigger(k.Events.BUFFER_FLUSHING,U)}},_._loadInitSegment=function(x,H){var W=this;this._doFragLoad(x,H).then(function(U){if(!U||W.fragContextChanged(x)||!W.levels)throw new Error("init load aborted");return U}).then(function(U){var G=W.hls,Y=U.payload,j=x.decryptdata;if(Y&&Y.byteLength>0&&j&&j.key&&j.iv&&j.method==="AES-128"){var X=self.performance.now();return W.decrypter.decrypt(new Uint8Array(Y),j.key.buffer,j.iv.buffer).then(function(q){var J=self.performance.now();return G.trigger(k.Events.FRAG_DECRYPTED,{frag:x,payload:q,stats:{tstart:X,tdecrypt:J}}),U.payload=q,U})}return U}).then(function(U){var G=W.fragCurrent,Y=W.hls,j=W.levels;if(!j)throw new Error("init load aborted, missing levels");var X=j[x.level].details;console.assert(X,"Level details are defined when init segment is loaded");var q=x.stats;W.state=c.IDLE,W.fragLoadError=0,x.data=new Uint8Array(U.payload),q.parsing.start=q.buffering.start=self.performance.now(),q.parsing.end=q.buffering.end=self.performance.now(),U.frag===G&&Y.trigger(k.Events.FRAG_BUFFERED,{stats:q,frag:G,part:null,id:x.type}),W.tick()}).catch(function(U){W.state===c.STOPPED||W.state===c.ERROR||(W.warn(U),W.resetFragmentLoading(x))})},_.fragContextChanged=function(x){var H=this.fragCurrent;return!x||!H||x.level!==H.level||x.sn!==H.sn||x.urlId!==H.urlId},_.fragBufferedComplete=function(x,H){var W,U,G=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+x.type+" sn: "+x.sn+(H?" part: "+H.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+x.level+" "+(G?E.default.toString(D.BufferHelper.getBuffered(G)):"(detached)")),this.state=c.IDLE,G&&(!this.loadedmetadata&&x.type==d.PlaylistLevelType.MAIN&&G.buffered.length&&((W=this.fragCurrent)===null||W===void 0?void 0:W.sn)===((U=this.fragPrevious)===null||U===void 0?void 0:U.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},_.seekToStartPos=function(){},_._handleFragmentLoadComplete=function(x){var H=this.transmuxer;if(H){var W=x.frag,U=x.part,G=x.partsLoaded,Y=!G||G.length===0||G.some(function(X){return!X}),j=new B.ChunkMetadata(W.level,W.sn,W.stats.chunkCount+1,0,U?U.index:-1,!Y);H.flush(j)}},_._handleFragmentLoadProgress=function(x){},_._doFragLoad=function(x,H,W,U){var G,Y=this;if(W===void 0&&(W=null),!this.levels)throw new Error("frag load aborted, missing levels");var j=null;if(x.encrypted&&!((G=x.decryptdata)!==null&&G!==void 0&&G.key)?(this.log("Loading key for "+x.sn+" of ["+H.startSN+"-"+H.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+x.level),this.state=c.KEY_LOADING,this.fragCurrent=x,j=this.keyLoader.load(x).then(function(Q){if(!Y.fragContextChanged(Q.frag))return Y.hls.trigger(k.Events.KEY_LOADED,Q),Q}),this.hls.trigger(k.Events.KEY_LOADING,{frag:x}),this.throwIfFragContextChanged("KEY_LOADING")):!x.encrypted&&H.encryptedFragments.length&&this.keyLoader.loadClear(x,H.encryptedFragments),W=Math.max(x.start,W||0),this.config.lowLatencyMode&&H){var X=H.partList;if(X&&U){W>x.end&&H.fragmentHint&&(x=H.fragmentHint);var q=this.getNextPart(X,x,W);if(q>-1){var J=X[q];return this.log("Loading part sn: "+x.sn+" p: "+J.index+" cc: "+x.cc+" of playlist ["+H.startSN+"-"+H.endSN+"] parts [0-"+q+"-"+(X.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+x.level+", target: "+parseFloat(W.toFixed(3))),this.nextLoadPosition=J.start+J.duration,this.state=c.FRAG_LOADING,this.hls.trigger(k.Events.FRAG_LOADING,{frag:x,part:X[q],targetBufferTime:W}),this.throwIfFragContextChanged("FRAG_LOADING parts"),j?j.then(function(Q){return!Q||Y.fragContextChanged(Q.frag)?null:Y.doFragPartsLoad(x,X,q,U)}).catch(function(Q){return Y.handleFragLoadError(Q)}):this.doFragPartsLoad(x,X,q,U).catch(function(Q){return Y.handleFragLoadError(Q)})}else if(!x.url||this.loadedEndOfParts(X,W))return Promise.resolve(null)}}this.log("Loading fragment "+x.sn+" cc: "+x.cc+" "+(H?"of ["+H.startSN+"-"+H.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+x.level+", target: "+parseFloat(W.toFixed(3))),(0,R.isFiniteNumber)(x.sn)&&!this.bitrateTest&&(this.nextLoadPosition=x.start+x.duration),this.state=c.FRAG_LOADING,this.hls.trigger(k.Events.FRAG_LOADING,{frag:x,targetBufferTime:W}),this.throwIfFragContextChanged("FRAG_LOADING");var V=this.config.progressive;return V&&j?j.then(function(Q){return!Q||Y.fragContextChanged(Q==null?void 0:Q.frag)?null:Y.fragmentLoader.load(x,U)}).catch(function(Q){return Y.handleFragLoadError(Q)}):Promise.all([this.fragmentLoader.load(x,V?U:void 0),j]).then(function(Q){var ee=Q[0];return!V&&ee&&U&&U(ee),ee}).catch(function(Q){return Y.handleFragLoadError(Q)})},_.throwIfFragContextChanged=function(x){if(this.fragCurrent===null)throw new Error("frag load aborted, context changed in "+x)},_.doFragPartsLoad=function(x,H,W,U){var G=this;return new Promise(function(Y,j){var X=[],q=function J(V){var Q=H[V];G.fragmentLoader.loadPart(x,Q,U).then(function(ee){X[Q.index]=ee;var Z=ee.part;G.hls.trigger(k.Events.FRAG_LOADED,ee);var re=H[V+1];if(re&&re.fragment===x)J(V+1);else return Y({frag:x,part:Z,partsLoaded:X})}).catch(j)};q(W)})},_.handleFragLoadError=function(x){if("data"in x){var H=x.data;x.data&&H.details===F.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(H.frag,H.part):this.hls.trigger(k.Events.ERROR,H)}else this.hls.trigger(k.Events.ERROR,{type:F.ErrorTypes.OTHER_ERROR,details:F.ErrorDetails.INTERNAL_EXCEPTION,err:x,fatal:!0});return null},_._handleTransmuxerFlush=function(x){var H=this.getCurrentContext(x);if(!H||this.state!==c.PARSING){!this.fragCurrent&&this.state!==c.STOPPED&&this.state!==c.ERROR&&(this.state=c.IDLE);return}var W=H.frag,U=H.part,G=H.level,Y=self.performance.now();W.stats.parsing.end=Y,U&&(U.stats.parsing.end=Y),this.updateLevelTiming(W,U,G,x.partial)},_.getCurrentContext=function(x){var H=this.levels,W=x.level,U=x.sn,G=x.part;if(!H||!H[W])return this.warn("Levels object was unset while buffering fragment "+U+" of level "+W+". The current chunk will not be buffered."),null;var Y=H[W],j=G>-1?(0,M.getPartWith)(Y,U,G):null,X=j?j.fragment:(0,M.getFragmentWithSN)(Y,U,this.fragCurrent);return X?{frag:X,part:j,level:Y}:null},_.bufferFragmentData=function(x,H,W,U){if(!(!x||this.state!==c.PARSING)){var G=x.data1,Y=x.data2,j=G;if(G&&Y&&(j=(0,P.appendUint8Array)(G,Y)),!(!j||!j.length)){var X={type:x.type,frag:H,part:W,chunkMeta:U,parent:H.type,data:j};this.hls.trigger(k.Events.BUFFER_APPENDING,X),x.dropped&&x.independent&&!W&&this.flushBufferGap(H)}}},_.flushBufferGap=function(x){var H=this.media;if(H){if(!D.BufferHelper.isBuffered(H,H.currentTime)){this.flushMainBuffer(0,x.start);return}var W=H.currentTime,U=D.BufferHelper.bufferInfo(H,W,0),G=x.duration,Y=Math.min(this.config.maxFragLookUpTolerance*2,G*.25),j=Math.max(Math.min(x.start-Y,U.end-Y),W+Y);x.start-j>Y&&this.flushMainBuffer(j,x.start)}},_.getFwdBufferInfo=function(x,H){var W=this.config,U=this.getLoadPosition();if(!(0,R.isFiniteNumber)(U))return null;var G=D.BufferHelper.bufferInfo(x,U,W.maxBufferHole);if(G.len===0&&G.nextStart!==void 0){var Y=this.fragmentTracker.getBufferedFrag(U,H);if(Y&&G.nextStart<Y.end)return D.BufferHelper.bufferInfo(x,U,Math.max(G.nextStart,W.maxBufferHole))}return G},_.getMaxBufferLength=function(x){var H=this.config,W;return x?W=Math.max(8*H.maxBufferSize/x,H.maxBufferLength):W=H.maxBufferLength,Math.min(W,H.maxMaxBufferLength)},_.reduceMaxBufferLength=function(x){var H=this.config,W=x||H.maxBufferLength;return H.maxMaxBufferLength>=W?(H.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+H.maxMaxBufferLength+"s"),!0):!1},_.getNextFragment=function(x,H){var W=H.fragments,U=W.length;if(!U)return null;var G=this.config,Y=W[0].start,j;if(H.live){var X=G.initialLiveManifestSize;if(U<X)return this.warn("Not enough fragments to start playback (have: "+U+", need: "+X+")"),null;!H.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(j=this.getInitialLiveFragment(H,W),this.startPosition=j?this.hls.liveSyncPosition||j.start:x)}else x<=Y&&(j=W[0]);if(!j){var q=G.lowLatencyMode?H.partEnd:H.fragmentEnd;j=this.getFragmentAtPosition(x,q,H)}return this.mapToInitFragWhenRequired(j)},_.mapToInitFragWhenRequired=function(x){return x!=null&&x.initSegment&&!(x!=null&&x.initSegment.data)&&!this.bitrateTest?x.initSegment:x},_.getNextPart=function(x,H,W){for(var U=-1,G=!1,Y=!0,j=0,X=x.length;j<X;j++){var q=x[j];if(Y=Y&&!q.independent,U>-1&&W<q.start)break;var J=q.loaded;J?U=-1:(G||q.independent||Y)&&q.fragment===H&&(U=j),G=J}return U},_.loadedEndOfParts=function(x,H){var W=x[x.length-1];return W&&H>W.start&&W.loaded},_.getInitialLiveFragment=function(x,H){var W=this.fragPrevious,U=null;if(W){if(x.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+W.programDateTime),U=(0,g.findFragmentByPDT)(H,W.endProgramDateTime,this.config.maxFragLookUpTolerance)),!U){var G=W.sn+1;if(G>=x.startSN&&G<=x.endSN){var Y=H[G-x.startSN];W.cc===Y.cc&&(U=Y,this.log("Live playlist, switching playlist, load frag with next SN: "+U.sn))}U||(U=(0,g.findFragWithCC)(H,W.cc),U&&this.log("Live playlist, switching playlist, load frag with same CC: "+U.sn))}}else{var j=this.hls.liveSyncPosition;j!==null&&(U=this.getFragmentAtPosition(j,this.bitrateTest?x.fragmentEnd:x.edge,x))}return U},_.getFragmentAtPosition=function(x,H,W){var U=this.config,G=this.fragPrevious,Y=W.fragments,j=W.endSN,X=W.fragmentHint,q=U.maxFragLookUpTolerance,J=!!(U.lowLatencyMode&&W.partList&&X);J&&X&&!this.bitrateTest&&(Y=Y.concat(X),j=X.sn);var V;if(x<H){var Q=x>H-q?0:q;V=(0,g.findFragmentByPTS)(G,Y,x,Q)}else V=Y[Y.length-1];if(V){var ee=V.sn-W.startSN;if(this.fragmentTracker.getState(V)===w.FragmentState.OK&&(G=V),G&&V.sn===G.sn&&!J){var Z=G&&V.level===G.level;if(Z){var re=Y[ee+1];V.sn<j&&this.fragmentTracker.getState(re)!==w.FragmentState.OK?(this.log("SN "+V.sn+" just loaded, load next one: "+re.sn),V=re):V=null}}}return V},_.synchronizeToLiveEdge=function(x){var H=this.config,W=this.media;if(W){var U=this.hls.liveSyncPosition,G=W.currentTime,Y=x.fragments[0].start,j=x.edge,X=G>=Y-H.maxFragLookUpTolerance&&G<=j;if(U!==null&&W.duration>U&&(G<U||!X)){var q=H.liveMaxLatencyDuration!==void 0?H.liveMaxLatencyDuration:H.liveMaxLatencyDurationCount*x.targetduration;(!X&&W.readyState<4||G<j-q)&&(this.loadedmetadata||(this.nextLoadPosition=U),W.readyState&&(this.warn("Playback: "+G.toFixed(3)+" is located too far from the end of live sliding playlist: "+j+", reset currentTime to : "+U.toFixed(3)),W.currentTime=U))}}},_.alignPlaylists=function(x,H){var W=this.levels,U=this.levelLastLoaded,G=this.fragPrevious,Y=U!==null?W[U]:null,j=x.fragments.length;if(!j)return this.warn("No fragments in live playlist"),0;var X=x.fragments[0].start,q=!H,J=x.alignedSliding&&(0,R.isFiniteNumber)(X);if(q||!J&&!X){(0,N.alignStream)(G,Y,x);var V=x.fragments[0].start;return this.log("Live playlist sliding: "+V.toFixed(2)+" start-sn: "+(H?H.startSN:"na")+"->"+x.startSN+" prev-sn: "+(G?G.sn:"na")+" fragments: "+j),V}return X},_.waitForCdnTuneIn=function(x){var H=3;return x.live&&x.canBlockReload&&x.partTarget&&x.tuneInGoal>Math.max(x.partHoldBack,x.partTarget*H)},_.setStartPosition=function(x,H){var W=this.startPosition;if(W<H&&(W=-1),W===-1||this.lastCurrentTime===-1){var U=x.startTimeOffset;(0,R.isFiniteNumber)(U)?(W=H+U,U<0&&(W+=x.totalduration),W=Math.min(Math.max(H,W),H+x.totalduration),this.log("Start time offset "+U+" found in playlist, adjust startPosition to "+W),this.startPosition=W):x.live?W=this.hls.liveSyncPosition||H:this.startPosition=W=0,this.lastCurrentTime=W}this.nextLoadPosition=W},_.getLoadPosition=function(){var x=this.media,H=0;return this.loadedmetadata&&x?H=x.currentTime:this.nextLoadPosition&&(H=this.nextLoadPosition),H},_.handleFragLoadAborted=function(x,H){this.transmuxer&&x.sn!=="initSegment"&&x.stats.aborted&&(this.warn("Fragment "+x.sn+(H?" part"+H.index:"")+" of level "+x.level+" was aborted"),this.resetFragmentLoading(x))},_.resetFragmentLoading=function(x){(!this.fragCurrent||!this.fragContextChanged(x)&&this.state!==c.FRAG_LOADING_WAITING_RETRY)&&(this.state=c.IDLE)},_.onFragmentOrKeyLoadError=function(x,H){if(H.fatal){this.stopLoad(),this.state=c.ERROR;return}var W=this.config;if(H.chunkMeta){var U=this.getCurrentContext(H.chunkMeta);U&&(H.frag=U.frag,H.levelRetry=!0,this.fragLoadError=W.fragLoadingMaxRetry)}var G=H.frag;if(!(!G||G.type!==x)){var Y=this.fragCurrent;if(console.assert(Y&&G.sn===Y.sn&&G.level===Y.level&&G.urlId===Y.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=W.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var j=Math.min(Math.pow(2,this.fragLoadError)*W.fragLoadingRetryDelay,W.fragLoadingMaxRetryTimeout);this.warn("Fragment "+G.sn+" of "+x+" "+G.level+" failed to load, retrying in "+j+"ms"),this.retryDate=self.performance.now()+j,this.fragLoadError++,this.state=c.FRAG_LOADING_WAITING_RETRY}else H.levelRetry?(x===d.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=c.IDLE):(K.logger.error(H.details+" reaches max retry, redispatch as fatal ..."),H.fatal=!0,this.hls.stopLoad(),this.state=c.ERROR)}},_.afterBufferFlushed=function(x,H,W){if(x){var U=D.BufferHelper.getBuffered(x);this.fragmentTracker.detectEvictedFragments(H,U,W),this.state===c.ENDED&&this.resetLoadingState()}},_.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=c.IDLE},_.resetStartWhenNotLoaded=function(x){if(!this.loadedmetadata){this.startFragRequested=!1;var H=this.levels?this.levels[x].details:null;H!=null&&H.live?(this.startPosition=-1,this.setStartPosition(H,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},_.updateLevelTiming=function(x,H,W,U){var G=this,Y=W.details;console.assert(!!Y,"level.details must be defined");var j=Object.keys(x.elementaryStreams).reduce(function(X,q){var J=x.elementaryStreams[q];if(J){var V=J.endPTS-J.startPTS;if(V<=0)return G.warn("Could not parse fragment "+x.sn+" "+q+" duration reliably ("+V+")"),X||!1;var Q=U?0:(0,M.updateFragPTSDTS)(Y,x,J.startPTS,J.endPTS,J.startDTS,J.endDTS);return G.hls.trigger(k.Events.LEVEL_PTS_UPDATED,{details:Y,level:W,drift:Q,type:q,frag:x,start:J.startPTS,end:J.endPTS}),!0}return X},!1);j||(this.warn("Found no media in fragment "+x.sn+" of level "+W.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=c.PARSED,this.hls.trigger(k.Events.FRAG_PARSED,{frag:x,part:H})},_.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},b(o,[{key:"state",get:function(){return this._state},set:function(x){var H=this._state;H!==x&&(this._state=x,this.log(H+"->"+x))}}]),o}(A.default)},"./src/controller/buffer-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>g});var R=s("./src/polyfills/number.ts"),A=s("./src/events.ts"),w=s("./src/utils/logger.ts"),D=s("./src/errors.ts"),K=s("./src/utils/buffer-helper.ts"),k=s("./src/utils/mediasource-helper.ts"),F=s("./src/loader/fragment.ts"),B=s("./src/controller/buffer-operation-queue.ts"),P=(0,k.getMediaSource)(),N=/([ha]vc.)(?:\.[^.,]+)+/,g=function(){function M(f){var E=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var d=E.hls,l=E.media,b=E.mediaSource;w.logger.log("[buffer-controller]: Media source opened"),l&&(E.updateMediaElementDuration(),d.trigger(A.Events.MEDIA_ATTACHED,{media:l})),b&&b.removeEventListener("sourceopen",E._onMediaSourceOpen),E.checkPendingTracks()},this._onMediaSourceClose=function(){w.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){w.logger.log("[buffer-controller]: Media source ended")},this.hls=f,this._initSourceBuffer(),this.registerListeners()}var S=M.prototype;return S.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},S.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},S.registerListeners=function(){var E=this.hls;E.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),E.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),E.on(A.Events.BUFFER_RESET,this.onBufferReset,this),E.on(A.Events.BUFFER_APPENDING,this.onBufferAppending,this),E.on(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),E.on(A.Events.BUFFER_EOS,this.onBufferEos,this),E.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),E.on(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this),E.on(A.Events.FRAG_PARSED,this.onFragParsed,this),E.on(A.Events.FRAG_CHANGED,this.onFragChanged,this)},S.unregisterListeners=function(){var E=this.hls;E.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),E.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),E.off(A.Events.BUFFER_RESET,this.onBufferReset,this),E.off(A.Events.BUFFER_APPENDING,this.onBufferAppending,this),E.off(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),E.off(A.Events.BUFFER_EOS,this.onBufferEos,this),E.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),E.off(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this),E.off(A.Events.FRAG_PARSED,this.onFragParsed,this),E.off(A.Events.FRAG_CHANGED,this.onFragChanged,this)},S._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new B.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},S.onManifestParsed=function(E,d){var l=2;(d.audio&&!d.video||!d.altAudio)&&(l=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=l,this.details=null,w.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},S.onMediaAttaching=function(E,d){var l=this.media=d.media;if(l&&P){var b=this.mediaSource=new P;b.addEventListener("sourceopen",this._onMediaSourceOpen),b.addEventListener("sourceended",this._onMediaSourceEnded),b.addEventListener("sourceclose",this._onMediaSourceClose),l.src=self.URL.createObjectURL(b),this._objectUrl=l.src}},S.onMediaDetaching=function(){var E=this.media,d=this.mediaSource,l=this._objectUrl;if(d){if(w.logger.log("[buffer-controller]: media source detaching"),d.readyState==="open")try{d.endOfStream()}catch(b){w.logger.warn("[buffer-controller]: onMediaDetaching: "+b.message+" while calling endOfStream")}this.onBufferReset(),d.removeEventListener("sourceopen",this._onMediaSourceOpen),d.removeEventListener("sourceended",this._onMediaSourceEnded),d.removeEventListener("sourceclose",this._onMediaSourceClose),E&&(l&&self.URL.revokeObjectURL(l),E.src===l?(E.removeAttribute("src"),E.load()):w.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(A.Events.MEDIA_DETACHED,void 0)},S.onBufferReset=function(){var E=this;this.getSourceBufferTypes().forEach(function(d){var l=E.sourceBuffer[d];try{l&&(E.removeBufferListeners(d),E.mediaSource&&E.mediaSource.removeSourceBuffer(l),E.sourceBuffer[d]=void 0)}catch(b){w.logger.warn("[buffer-controller]: Failed to reset the "+d+" buffer",b)}}),this._initSourceBuffer()},S.onBufferCodecs=function(E,d){var l=this,b=this.getSourceBufferTypes().length;Object.keys(d).forEach(function(h){if(b){var u=l.tracks[h];if(u&&typeof u.buffer.changeType=="function"){var m=d[h],y=m.id,v=m.codec,c=m.levelCodec,a=m.container,T=m.metadata,o=(u.levelCodec||u.codec).replace(N,"$1"),_=(c||v).replace(N,"$1");if(o!==_){var L=a+";codecs="+(c||v);l.appendChangeType(h,L),w.logger.log("[buffer-controller]: switching codec "+o+" to "+_),l.tracks[h]={buffer:u.buffer,codec:v,container:a,levelCodec:c,metadata:T,id:y}}}}else l.pendingTracks[h]=d[h]}),!b&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},S.appendChangeType=function(E,d){var l=this,b=this.operationQueue,h={execute:function(){var m=l.sourceBuffer[E];m&&(w.logger.log("[buffer-controller]: changing "+E+" sourceBuffer type to "+d),m.changeType(d)),b.shiftAndExecuteNext(E)},onStart:function(){},onComplete:function(){},onError:function(m){w.logger.warn("[buffer-controller]: Failed to change "+E+" SourceBuffer type",m)}};b.append(h,E)},S.onBufferAppending=function(E,d){var l=this,b=this.hls,h=this.operationQueue,u=this.tracks,m=d.data,y=d.type,v=d.frag,c=d.part,a=d.chunkMeta,T=a.buffering[y],o=self.performance.now();T.start=o;var _=v.stats.buffering,L=c?c.stats.buffering:null;_.start===0&&(_.start=o),L&&L.start===0&&(L.start=o);var x=u.audio,H=!1;y==="audio"&&(x==null?void 0:x.container)==="audio/mpeg"&&(H=!this.lastMpegAudioChunk||a.id===1||this.lastMpegAudioChunk.sn!==a.sn,this.lastMpegAudioChunk=a);var W=v.start,U={execute:function(){if(T.executeStart=self.performance.now(),H){var Y=l.sourceBuffer[y];if(Y){var j=W-Y.timestampOffset;Math.abs(j)>=.1&&(w.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+W+" (delta: "+j+") sn: "+v.sn+")"),Y.timestampOffset=W)}}l.appendExecutor(m,y)},onStart:function(){},onComplete:function(){var Y=self.performance.now();T.executeEnd=T.end=Y,_.first===0&&(_.first=Y),L&&L.first===0&&(L.first=Y);var j=l.sourceBuffer,X={};for(var q in j)X[q]=K.BufferHelper.getBuffered(j[q]);l.appendError=0,l.hls.trigger(A.Events.BUFFER_APPENDED,{type:y,frag:v,part:c,chunkMeta:a,parent:v.type,timeRanges:X})},onError:function(Y){w.logger.error("[buffer-controller]: Error encountered while trying to append to the "+y+" SourceBuffer",Y);var j={type:D.ErrorTypes.MEDIA_ERROR,parent:v.type,details:D.ErrorDetails.BUFFER_APPEND_ERROR,err:Y,fatal:!1};Y.code===DOMException.QUOTA_EXCEEDED_ERR?j.details=D.ErrorDetails.BUFFER_FULL_ERROR:(l.appendError++,j.details=D.ErrorDetails.BUFFER_APPEND_ERROR,l.appendError>b.config.appendErrorMaxRetry&&(w.logger.error("[buffer-controller]: Failed "+b.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),j.fatal=!0,b.stopLoad())),b.trigger(A.Events.ERROR,j)}};h.append(U,y)},S.onBufferFlushing=function(E,d){var l=this,b=this.operationQueue,h=function(m){return{execute:l.removeExecutor.bind(l,m,d.startOffset,d.endOffset),onStart:function(){},onComplete:function(){l.hls.trigger(A.Events.BUFFER_FLUSHED,{type:m})},onError:function(v){w.logger.warn("[buffer-controller]: Failed to remove from "+m+" SourceBuffer",v)}}};d.type?b.append(h(d.type),d.type):this.getSourceBufferTypes().forEach(function(u){b.append(h(u),u)})},S.onFragParsed=function(E,d){var l=this,b=d.frag,h=d.part,u=[],m=h?h.elementaryStreams:b.elementaryStreams;m[F.ElementaryStreamTypes.AUDIOVIDEO]?u.push("audiovideo"):(m[F.ElementaryStreamTypes.AUDIO]&&u.push("audio"),m[F.ElementaryStreamTypes.VIDEO]&&u.push("video"));var y=function(){var c=self.performance.now();b.stats.buffering.end=c,h&&(h.stats.buffering.end=c);var a=h?h.stats:b.stats;l.hls.trigger(A.Events.FRAG_BUFFERED,{frag:b,part:h,stats:a,id:b.type})};u.length===0&&w.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+b.type+" level: "+b.level+" sn: "+b.sn),this.blockBuffers(y,u)},S.onFragChanged=function(E,d){this.flushBackBuffer()},S.onBufferEos=function(E,d){var l=this,b=this.getSourceBufferTypes().reduce(function(h,u){var m=l.sourceBuffer[u];return m&&(!d.type||d.type===u)&&(m.ending=!0,m.ended||(m.ended=!0,w.logger.log("[buffer-controller]: "+u+" sourceBuffer now EOS"))),h&&!!(!m||m.ended)},!0);b&&(w.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){l.getSourceBufferTypes().forEach(function(u){var m=l.sourceBuffer[u];m&&(m.ending=!1)});var h=l.mediaSource;if(!h||h.readyState!=="open"){h&&w.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+h.readyState);return}w.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),h.endOfStream()}))},S.onLevelUpdated=function(E,d){var l=d.details;l.fragments.length&&(this.details=l,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},S.flushBackBuffer=function(){var E=this.hls,d=this.details,l=this.media,b=this.sourceBuffer;if(!(!l||d===null)){var h=this.getSourceBufferTypes();if(h.length){var u=d.live&&E.config.liveBackBufferLength!==null?E.config.liveBackBufferLength:E.config.backBufferLength;if(!(!(0,R.isFiniteNumber)(u)||u<0)){var m=l.currentTime,y=d.levelTargetDuration,v=Math.max(u,y),c=Math.floor(m/y)*y-v;h.forEach(function(a){var T=b[a];if(T){var o=K.BufferHelper.getBuffered(T);if(o.length>0&&c>o.start(0)){if(E.trigger(A.Events.BACK_BUFFER_REACHED,{bufferEnd:c}),d.live)E.trigger(A.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:c});else if(T.ended&&o.end(o.length-1)-m<y*2){w.logger.info("[buffer-controller]: Cannot flush "+a+" back buffer while SourceBuffer is in ended state");return}E.trigger(A.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:c,type:a})}}})}}}},S.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var E=this.details,d=this.hls,l=this.media,b=this.mediaSource,h=E.fragments[0].start+E.totalduration,u=l.duration,m=(0,R.isFiniteNumber)(b.duration)?b.duration:0;E.live&&d.config.liveDurationInfinity?(w.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),b.duration=1/0,this.updateSeekableRange(E)):(h>m&&h>u||!(0,R.isFiniteNumber)(u))&&(w.logger.log("[buffer-controller]: Updating Media Source duration to "+h.toFixed(3)),b.duration=h)}},S.updateSeekableRange=function(E){var d=this.mediaSource,l=E.fragments,b=l.length;if(b&&E.live&&d!==null&&d!==void 0&&d.setLiveSeekableRange){var h=Math.max(0,l[0].start),u=Math.max(h,h+E.totalduration);d.setLiveSeekableRange(h,u)}},S.checkPendingTracks=function(){var E=this.bufferCodecEventsExpected,d=this.operationQueue,l=this.pendingTracks,b=Object.keys(l).length;if(b&&!E||b===2){this.createSourceBuffers(l),this.pendingTracks={};var h=this.getSourceBufferTypes();if(h.length===0){this.hls.trigger(A.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}h.forEach(function(u){d.executeNext(u)})}},S.createSourceBuffers=function(E){var d=this.sourceBuffer,l=this.mediaSource;if(!l)throw Error("createSourceBuffers called when mediaSource was null");var b=0;for(var h in E)if(!d[h]){var u=E[h];if(!u)throw Error("source buffer exists for track "+h+", however track does not");var m=u.levelCodec||u.codec,y=u.container+";codecs="+m;w.logger.log("[buffer-controller]: creating sourceBuffer("+y+")");try{var v=d[h]=l.addSourceBuffer(y),c=h;this.addBufferListener(c,"updatestart",this._onSBUpdateStart),this.addBufferListener(c,"updateend",this._onSBUpdateEnd),this.addBufferListener(c,"error",this._onSBUpdateError),this.tracks[h]={buffer:v,codec:m,container:u.container,levelCodec:u.levelCodec,metadata:u.metadata,id:u.id},b++}catch(a){w.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+a.message),this.hls.trigger(A.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:a,mimeType:y})}}b&&this.hls.trigger(A.Events.BUFFER_CREATED,{tracks:this.tracks})},S._onSBUpdateStart=function(E){var d=this.operationQueue,l=d.current(E);l.onStart()},S._onSBUpdateEnd=function(E){var d=this.operationQueue,l=d.current(E);l.onComplete(),d.shiftAndExecuteNext(E)},S._onSBUpdateError=function(E,d){w.logger.error("[buffer-controller]: "+E+" SourceBuffer error",d),this.hls.trigger(A.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var l=this.operationQueue.current(E);l&&l.onError(d)},S.removeExecutor=function(E,d,l){var b=this.media,h=this.mediaSource,u=this.operationQueue,m=this.sourceBuffer,y=m[E];if(!b||!h||!y){w.logger.warn("[buffer-controller]: Attempting to remove from the "+E+" SourceBuffer, but it does not exist"),u.shiftAndExecuteNext(E);return}var v=(0,R.isFiniteNumber)(b.duration)?b.duration:1/0,c=(0,R.isFiniteNumber)(h.duration)?h.duration:1/0,a=Math.max(0,d),T=Math.min(l,v,c);T>a&&!y.ending?(y.ended=!1,w.logger.log("[buffer-controller]: Removing ["+a+","+T+"] from the "+E+" SourceBuffer"),console.assert(!y.updating,E+" sourceBuffer must not be updating"),y.remove(a,T)):u.shiftAndExecuteNext(E)},S.appendExecutor=function(E,d){var l=this.operationQueue,b=this.sourceBuffer,h=b[d];if(!h){w.logger.warn("[buffer-controller]: Attempting to append to the "+d+" SourceBuffer, but it does not exist"),l.shiftAndExecuteNext(d);return}h.ended=!1,console.assert(!h.updating,d+" sourceBuffer must not be updating"),h.appendBuffer(E)},S.blockBuffers=function(E,d){var l=this;if(d===void 0&&(d=this.getSourceBufferTypes()),!d.length){w.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(E);return}var b=this.operationQueue,h=d.map(function(u){return b.appendBlocker(u)});Promise.all(h).then(function(){E(),d.forEach(function(u){var m=l.sourceBuffer[u];(!m||!m.updating)&&b.shiftAndExecuteNext(u)})})},S.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},S.addBufferListener=function(E,d,l){var b=this.sourceBuffer[E];if(b){var h=l.bind(this,E);this.listeners[E].push({event:d,listener:h}),b.addEventListener(d,h)}},S.removeBufferListeners=function(E){var d=this.sourceBuffer[E];d&&this.listeners[E].forEach(function(l){d.removeEventListener(l.event,l.listener)})},M}()},"./src/controller/buffer-operation-queue.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>A});var R=s("./src/utils/logger.ts"),A=function(){function w(K){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=K}var D=w.prototype;return D.append=function(k,F){var B=this.queues[F];B.push(k),B.length===1&&this.buffers[F]&&this.executeNext(F)},D.insertAbort=function(k,F){var B=this.queues[F];B.unshift(k),this.executeNext(F)},D.appendBlocker=function(k){var F,B=new Promise(function(N){F=N}),P={execute:F,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(P,k),B},D.executeNext=function(k){var F=this.buffers,B=this.queues,P=F[k],N=B[k];if(N.length){var g=N[0];try{g.execute()}catch(M){R.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),g.onError(M),(!P||!P.updating)&&(N.shift(),this.executeNext(k))}}},D.shiftAndExecuteNext=function(k){this.queues[k].shift(),this.executeNext(k)},D.current=function(k){return this.queues[k][0]},w}()},"./src/controller/cap-level-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>F});var R=s("./src/events.ts");function A(B,P){for(var N=0;N<P.length;N++){var g=P[N];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(B,D(g.key),g)}}function w(B,P,N){return P&&A(B.prototype,P),N&&A(B,N),Object.defineProperty(B,"prototype",{writable:!1}),B}function D(B){var P=K(B,"string");return typeof P=="symbol"?P:String(P)}function K(B,P){if(typeof B!="object"||B===null)return B;var N=B[Symbol.toPrimitive];if(N!==void 0){var g=N.call(B,P||"default");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return(P==="string"?String:Number)(B)}var k=function(){function B(N){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=N,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var P=B.prototype;return P.setStreamController=function(g){this.streamController=g},P.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},P.registerListeners=function(){var g=this.hls;g.on(R.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},P.unregisterListener=function(){var g=this.hls;g.off(R.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},P.onFpsDropLevelCapping=function(g,M){B.isLevelAllowed(M.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(M.droppedLevel)},P.onMediaAttaching=function(g,M){this.media=M.media instanceof HTMLVideoElement?M.media:null,this.clientRect=null},P.onManifestParsed=function(g,M){var S=this.hls;this.restrictedLevels=[],this.firstLevel=M.firstLevel,S.config.capLevelToPlayerSize&&M.video&&this.startCapping()},P.onBufferCodecs=function(g,M){var S=this.hls;S.config.capLevelToPlayerSize&&M.video&&this.startCapping()},P.onMediaDetaching=function(){this.stopCapping()},P.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var g=this.hls.levels;if(g.length){var M=this.hls;M.autoLevelCapping=this.getMaxLevel(g.length-1),M.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=M.autoLevelCapping}}},P.getMaxLevel=function(g){var M=this,S=this.hls.levels;if(!S.length)return-1;var f=S.filter(function(E,d){return B.isLevelAllowed(d,M.restrictedLevels)&&d<=g});return this.clientRect=null,B.getMaxLevelByMediaSize(f,this.mediaWidth,this.mediaHeight)},P.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},P.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},P.getDimensions=function(){if(this.clientRect)return this.clientRect;var g=this.media,M={width:0,height:0};if(g){var S=g.getBoundingClientRect();M.width=S.width,M.height=S.height,!M.width&&!M.height&&(M.width=S.right-S.left||g.width||0,M.height=S.bottom-S.top||g.height||0)}return this.clientRect=M,M},B.isLevelAllowed=function(g,M){return M===void 0&&(M=[]),M.indexOf(g)===-1},B.getMaxLevelByMediaSize=function(g,M,S){if(!g||!g.length)return-1;for(var f=function(h,u){return u?h.width!==u.width||h.height!==u.height:!0},E=g.length-1,d=0;d<g.length;d+=1){var l=g[d];if((l.width>=M||l.height>=S)&&f(l,g[d+1])){E=d;break}}return E},w(B,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var g=1;if(!this.hls.config.ignoreDevicePixelRatio)try{g=self.devicePixelRatio}catch{}return g}}]),B}();const F=k},"./src/controller/cmcd-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>S});var R=s("./src/events.ts"),A=s("./src/types/cmcd.ts"),w=s("./src/utils/buffer-helper.ts"),D=s("./src/utils/logger.ts");function K(f,E){for(var d=0;d<E.length;d++){var l=E[d];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(f,F(l.key),l)}}function k(f,E,d){return E&&K(f.prototype,E),d&&K(f,d),Object.defineProperty(f,"prototype",{writable:!1}),f}function F(f){var E=B(f,"string");return typeof E=="symbol"?E:String(E)}function B(f,E){if(typeof f!="object"||f===null)return f;var d=f[Symbol.toPrimitive];if(d!==void 0){var l=d.call(f,E||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(E==="string"?String:Number)(f)}function P(f,E){var d=typeof Symbol<"u"&&f[Symbol.iterator]||f["@@iterator"];if(d)return(d=d.call(f)).next.bind(d);if(Array.isArray(f)||(d=N(f))||E&&f&&typeof f.length=="number"){d&&(f=d);var l=0;return function(){return l>=f.length?{done:!0}:{done:!1,value:f[l++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function N(f,E){if(f){if(typeof f=="string")return g(f,E);var d=Object.prototype.toString.call(f).slice(8,-1);if(d==="Object"&&f.constructor&&(d=f.constructor.name),d==="Map"||d==="Set")return Array.from(f);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return g(f,E)}}function g(f,E){(E==null||E>f.length)&&(E=f.length);for(var d=0,l=new Array(E);d<E;d++)l[d]=f[d];return l}function M(){return M=Object.assign?Object.assign.bind():function(f){for(var E=1;E<arguments.length;E++){var d=arguments[E];for(var l in d)Object.prototype.hasOwnProperty.call(d,l)&&(f[l]=d[l])}return f},M.apply(this,arguments)}var S=function(){function f(d){var l=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){l.initialized&&(l.starved=!0),l.buffering=!0},this.onPlaying=function(){l.initialized||(l.initialized=!0),l.buffering=!1},this.applyPlaylistData=function(u){try{l.apply(u,{ot:A.CMCDObjectType.MANIFEST,su:!l.initialized})}catch(m){D.logger.warn("Could not generate manifest CMCD data.",m)}},this.applyFragmentData=function(u){try{var m=u.frag,y=l.hls.levels[m.level],v=l.getObjectType(m),c={d:m.duration*1e3,ot:v};(v===A.CMCDObjectType.VIDEO||v===A.CMCDObjectType.AUDIO||v==A.CMCDObjectType.MUXED)&&(c.br=y.bitrate/1e3,c.tb=l.getTopBandwidth(v)/1e3,c.bl=l.getBufferLength(v)),l.apply(u,c)}catch(a){D.logger.warn("Could not generate segment CMCD data.",a)}},this.hls=d;var b=this.config=d.config,h=b.cmcd;h!=null&&(b.pLoader=this.createPlaylistLoader(),b.fLoader=this.createFragmentLoader(),this.sid=h.sessionId||f.uuid(),this.cid=h.contentId,this.useHeaders=h.useHeaders===!0,this.registerListeners())}var E=f.prototype;return E.registerListeners=function(){var l=this.hls;l.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),l.on(R.Events.BUFFER_CREATED,this.onBufferCreated,this)},E.unregisterListeners=function(){var l=this.hls;l.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),l.off(R.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},E.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},E.onMediaAttached=function(l,b){this.media=b.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},E.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},E.onBufferCreated=function(l,b){var h,u;this.audioBuffer=(h=b.tracks.audio)===null||h===void 0?void 0:h.buffer,this.videoBuffer=(u=b.tracks.video)===null||u===void 0?void 0:u.buffer},E.createData=function(){var l;return{v:A.CMCDVersion,sf:A.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(l=this.media)===null||l===void 0?void 0:l.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},E.apply=function(l,b){b===void 0&&(b={}),M(b,this.createData());var h=b.ot===A.CMCDObjectType.INIT||b.ot===A.CMCDObjectType.VIDEO||b.ot===A.CMCDObjectType.MUXED;if(this.starved&&h&&(b.bs=!0,b.su=!0,this.starved=!1),b.su==null&&(b.su=this.buffering),this.useHeaders){var u=f.toHeaders(b);if(!Object.keys(u).length)return;l.headers||(l.headers={}),M(l.headers,u)}else{var m=f.toQuery(b);if(!m)return;l.url=f.appendQueryToUri(l.url,m)}},E.getObjectType=function(l){var b=l.type;if(b==="subtitle")return A.CMCDObjectType.TIMED_TEXT;if(l.sn==="initSegment")return A.CMCDObjectType.INIT;if(b==="audio")return A.CMCDObjectType.AUDIO;if(b==="main")return this.hls.audioTracks.length?A.CMCDObjectType.VIDEO:A.CMCDObjectType.MUXED},E.getTopBandwidth=function(l){var b=0,h,u=this.hls;if(l===A.CMCDObjectType.AUDIO)h=u.audioTracks;else{var m=u.maxAutoLevel,y=m>-1?m+1:u.levels.length;h=u.levels.slice(0,y)}for(var v=P(h),c;!(c=v()).done;){var a=c.value;a.bitrate>b&&(b=a.bitrate)}return b>0?b:NaN},E.getBufferLength=function(l){var b=this.hls.media,h=l===A.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!h||!b)return NaN;var u=w.BufferHelper.bufferInfo(h,b.currentTime,this.config.maxBufferHole);return u.len*1e3},E.createPlaylistLoader=function(){var l=this.config.pLoader,b=this.applyPlaylistData,h=l||this.config.loader;return function(){function u(y){this.loader=void 0,this.loader=new h(y)}var m=u.prototype;return m.destroy=function(){this.loader.destroy()},m.abort=function(){this.loader.abort()},m.load=function(v,c,a){b(v),this.loader.load(v,c,a)},k(u,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),u}()},E.createFragmentLoader=function(){var l=this.config.fLoader,b=this.applyFragmentData,h=l||this.config.loader;return function(){function u(y){this.loader=void 0,this.loader=new h(y)}var m=u.prototype;return m.destroy=function(){this.loader.destroy()},m.abort=function(){this.loader.abort()},m.load=function(v,c,a){b(v),this.loader.load(v,c,a)},k(u,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),u}()},f.uuid=function(){var l=URL.createObjectURL(new Blob),b=l.toString();return URL.revokeObjectURL(l),b.slice(b.lastIndexOf("/")+1)},f.serialize=function(l){for(var b=[],h=function(U){return!Number.isNaN(U)&&U!=null&&U!==""&&U!==!1},u=function(U){return Math.round(U)},m=function(U){return u(U/100)*100},y=function(U){return encodeURIComponent(U)},v={br:u,d:u,bl:m,dl:m,mtp:m,nor:y,rtp:m,tb:u},c=Object.keys(l||{}).sort(),a=P(c),T;!(T=a()).done;){var o=T.value,_=l[o];if(h(_)&&!(o==="v"&&_===1)&&!(o=="pr"&&_===1)){var L=v[o];L&&(_=L(_));var x=typeof _,H=void 0;o==="ot"||o==="sf"||o==="st"?H=o+"="+_:x==="boolean"?H=o:x==="number"?H=o+"="+_:H=o+"="+JSON.stringify(_),b.push(H)}}return b.join(",")},f.toHeaders=function(l){for(var b=Object.keys(l),h={},u=["Object","Request","Session","Status"],m=[{},{},{},{}],y={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},v=0,c=b;v<c.length;v++){var a=c[v],T=y[a]!=null?y[a]:1;m[T][a]=l[a]}for(var o=0;o<m.length;o++){var _=f.serialize(m[o]);_&&(h["CMCD-"+u[o]]=_)}return h},f.toQuery=function(l){return"CMCD="+encodeURIComponent(f.serialize(l))},f.appendQueryToUri=function(l,b){if(!b)return l;var h=l.includes("?")?"&":"?";return""+l+h+b},f}()},"./src/controller/eme-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>v});var R=s("./src/events.ts"),A=s("./src/errors.ts"),w=s("./src/utils/logger.ts"),D=s("./src/utils/mediakeys-helper.ts"),K=s("./src/utils/keysystem-util.ts"),k=s("./src/utils/numeric-encoding-utils.ts"),F=s("./src/loader/level-key.ts"),B=s("./src/utils/hex.ts"),P=s("./src/utils/mp4-tools.ts"),N=s("./node_modules/eventemitter3/index.js"),g=s.n(N);function M(c,a){c.prototype=Object.create(a.prototype),c.prototype.constructor=c,l(c,a)}function S(c){var a=typeof Map=="function"?new Map:void 0;return S=function(o){if(o===null||!d(o))return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a<"u"){if(a.has(o))return a.get(o);a.set(o,_)}function _(){return f(o,arguments,b(this).constructor)}return _.prototype=Object.create(o.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),l(_,o)},S(c)}function f(c,a,T){return E()?f=Reflect.construct.bind():f=function(_,L,x){var H=[null];H.push.apply(H,L);var W=Function.bind.apply(_,H),U=new W;return x&&l(U,x.prototype),U},f.apply(null,arguments)}function E(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function d(c){return Function.toString.call(c).indexOf("[native code]")!==-1}function l(c,a){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,_){return o.__proto__=_,o},l(c,a)}function b(c){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(T){return T.__proto__||Object.getPrototypeOf(T)},b(c)}var h=3,u="[eme]",m=function(){function c(T){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=c.CDMCleanupPromise?[c.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=w.logger.debug.bind(w.logger,u),this.log=w.logger.log.bind(w.logger,u),this.warn=w.logger.warn.bind(w.logger,u),this.error=w.logger.error.bind(w.logger,u),this.hls=T,this.config=T.config,this.registerListeners()}var a=c.prototype;return a.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},a.registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},a.unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},a.getLicenseServerUrl=function(o){var _=this.config,L=_.drmSystems,x=_.widevineLicenseUrl,H=L[o];if(H)return H.licenseUrl;if(o===D.KeySystems.WIDEVINE&&x)return x;throw new Error('no license server URL configured for key-system "'+o+'"')},a.getServerCertificateUrl=function(o){var _=this.config.drmSystems,L=_[o];if(L)return L.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+o+'"]')},a.attemptKeySystemAccess=function(o){var _=this,L=this.hls.levels,x=function(G,Y,j){return!!G&&j.indexOf(G)===Y},H=L.map(function(U){return U.audioCodec}).filter(x),W=L.map(function(U){return U.videoCodec}).filter(x);return H.length+W.length===0&&W.push("avc1.42e01e"),new Promise(function(U,G){var Y=function j(X){var q=X.shift();_.getMediaKeysPromise(q,H,W).then(function(J){return U({keySystem:q,mediaKeys:J})}).catch(function(J){X.length?j(X):J instanceof y?G(J):G(new y({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:J,fatal:!0},J.message))})};Y(o)})},a.requestMediaKeySystemAccess=function(o,_){var L=this.config.requestMediaKeySystemAccessFunc;if(typeof L!="function"){var x="Configured requestMediaKeySystemAccess is not a function "+L;return D.requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(x="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(x))}return L(o,_)},a.getMediaKeysPromise=function(o,_,L){var x=this,H=(0,D.getSupportedMediaKeySystemConfigurations)(o,_,L,this.config.drmSystemOptions),W=this.keySystemAccessPromises[o],U=W==null?void 0:W.keySystemAccess;if(!U){this.log('Requesting encrypted media "'+o+'" key-system access with config: '+JSON.stringify(H)),U=this.requestMediaKeySystemAccess(o,H);var G=this.keySystemAccessPromises[o]={keySystemAccess:U};return U.catch(function(Y){x.log('Failed to obtain access to key-system "'+o+'": '+Y)}),U.then(function(Y){x.log('Access for key-system "'+Y.keySystem+'" obtained');var j=x.fetchServerCertificate(o);return x.log('Create media-keys for "'+o+'"'),G.mediaKeys=Y.createMediaKeys().then(function(X){return x.log('Media-keys created for "'+o+'"'),j.then(function(q){return q?x.setMediaKeysServerCertificate(X,o,q):X})}),G.mediaKeys.catch(function(X){x.error('Failed to create media-keys for "'+o+'"}: '+X)}),G.mediaKeys})}return U.then(function(){return W.mediaKeys})},a.createMediaKeySessionContext=function(o){var _=o.decryptdata,L=o.keySystem,x=o.mediaKeys;console.assert(!!x,"mediaKeys is defined"),this.log('Creating key-system session "'+L+'" keyId: '+B.default.hexDump(_.keyId||[]));var H=x.createSession(),W={decryptdata:_,keySystem:L,mediaKeys:x,mediaKeysSession:H,keyStatus:"status-pending"};return this.mediaKeySessions.push(W),W},a.renewKeySession=function(o){var _=o.decryptdata;if(_.pssh){var L=this.createMediaKeySessionContext(o),x=this.getKeyIdString(_),H="cenc";this.keyIdToKeySessionPromise[x]=this.generateRequestWithPreferredKeySession(L,H,_.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(o)},a.getKeyIdString=function(o){if(!o)throw new Error("Could not read keyId of undefined decryptdata");if(o.keyId===null)throw new Error("keyId is null");return B.default.hexDump(o.keyId)},a.updateKeySession=function(o,_){var L,x=o.mediaKeysSession;return this.log('Updating key-session "'+x.sessionId+'" for keyID '+B.default.hexDump(((L=o.decryptdata)===null||L===void 0?void 0:L.keyId)||[])+`
      } (data length: `+(_&&_.byteLength)+")"),x.update(_)},a.selectKeySystemFormat=function(o){var _=Object.keys(o.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+o.sn+" "+o.type+": "+o.level+") key formats "+_.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(_)),this.keyFormatPromise},a.getKeyFormatPromise=function(o){var _=this;return new Promise(function(L,x){var H=(0,D.getKeySystemsForConfig)(_.config),W=o.map(D.keySystemFormatToKeySystemDomain).filter(function(U){return!!U&&H.indexOf(U)!==-1});return _.getKeySystemSelectionPromise(W).then(function(U){var G=U.keySystem,Y=(0,D.keySystemDomainToKeySystemFormat)(G);Y?L(Y):x(new Error('Unable to find format for key-system "'+G+'"'))}).catch(x)})},a.loadKey=function(o){var _=this,L=o.keyInfo.decryptdata,x=this.getKeyIdString(L),H="(keyId: "+x+' format: "'+L.keyFormat+'" method: '+L.method+" uri: "+L.uri+")";this.log("Starting session for key "+H);var W=this.keyIdToKeySessionPromise[x];return W||(W=this.keyIdToKeySessionPromise[x]=this.getKeySystemForKeyPromise(L).then(function(U){var G=U.keySystem,Y=U.mediaKeys;return _.throwIfDestroyed(),_.log("Handle encrypted media sn: "+o.frag.sn+" "+o.frag.type+": "+o.frag.level+" using key "+H),_.attemptSetMediaKeys(G,Y).then(function(){_.throwIfDestroyed();var j=_.createMediaKeySessionContext({keySystem:G,mediaKeys:Y,decryptdata:L}),X="cenc";return _.generateRequestWithPreferredKeySession(j,X,L.pssh,"playlist-key")})}),W.catch(function(U){return _.handleError(U)})),W},a.throwIfDestroyed=function(o){if(!this.hls)throw new Error("invalid state")},a.handleError=function(o){this.hls&&(this.error(o.message),o instanceof y?this.hls.trigger(R.Events.ERROR,o.data):this.hls.trigger(R.Events.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:o,fatal:!0}))},a.getKeySystemForKeyPromise=function(o){var _=this.getKeyIdString(o),L=this.keyIdToKeySessionPromise[_];if(!L){var x=(0,D.keySystemFormatToKeySystemDomain)(o.keyFormat),H=x?[x]:(0,D.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(H)}return L},a.getKeySystemSelectionPromise=function(o){if(o.length||(o=(0,D.getKeySystemsForConfig)(this.config)),o.length===0)throw new y({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(o)},a._onMediaEncrypted=function(o){var _=this,L=o.initDataType,x=o.initData;if(this.debug('"'+o.type+'" event: init data type: "'+L+'"'),x!==null){var H,W;if(L==="sinf"&&this.config.drmSystems[D.KeySystems.FAIRPLAY]){var U=(0,P.bin2str)(new Uint8Array(x));try{var G=(0,k.base64Decode)(JSON.parse(U).sinf),Y=(0,P.parseSinf)(new Uint8Array(G));if(!Y)return;H=Y.subarray(8,24),W=D.KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{var j=(0,P.parsePssh)(x);if(j===null)return;j.version===0&&j.systemId===D.KeySystemIds.WIDEVINE&&j.data&&(H=j.data.subarray(8,24)),W=(0,D.keySystemIdToKeySystemDomain)(j.systemId)}if(!(!W||!H)){for(var X=B.default.hexDump(H),q=this.keyIdToKeySessionPromise,J=this.mediaKeySessions,V=q[X],Q=function(ae){var le=J[ae],ne=le.decryptdata;if(ne.pssh||!ne.keyId)return"continue";var ie=B.default.hexDump(ne.keyId);if(X===ie||ne.uri.replace(/-/g,"").indexOf(X)!==-1)return V=q[ie],delete q[ie],ne.pssh=new Uint8Array(x),ne.keyId=H,V=q[X]=V.then(function(){return _.generateRequestWithPreferredKeySession(le,L,x,"encrypted-event-key-match")}),"break"},ee=0;ee<J.length;ee++){var Z=Q(ee);if(Z!=="continue"&&Z==="break")break}V||(V=q[X]=this.getKeySystemSelectionPromise([W]).then(function(re){var ae,le=re.keySystem,ne=re.mediaKeys;_.throwIfDestroyed();var ie=new F.LevelKey("ISO-23001-7",X,(ae=(0,D.keySystemDomainToKeySystemFormat)(le))!=null?ae:"");return ie.pssh=new Uint8Array(x),ie.keyId=H,_.attemptSetMediaKeys(le,ne).then(function(){_.throwIfDestroyed();var oe=_.createMediaKeySessionContext({decryptdata:ie,keySystem:le,mediaKeys:ne});return _.generateRequestWithPreferredKeySession(oe,L,x,"encrypted-event-no-match")})})),V.catch(function(re){return _.handleError(re)})}}},a._onWaitingForKey=function(o){this.log('"'+o.type+'" event')},a.attemptSetMediaKeys=function(o,_){var L=this,x=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+o+'"');var H=Promise.all(x).then(function(){if(!L.media)throw new Error("Attempted to set mediaKeys without media element attached");return L.media.setMediaKeys(_)});return this.setMediaKeysQueue.push(H),H.then(function(){L.log('Media-keys set for "'+o+'"'),x.push(H),L.setMediaKeysQueue=L.setMediaKeysQueue.filter(function(W){return x.indexOf(W)===-1})})},a.generateRequestWithPreferredKeySession=function(o,_,L,x){var H,W,U=this,G=(H=this.config.drmSystems)===null||H===void 0||(W=H[o.keySystem])===null||W===void 0?void 0:W.generateRequest;if(G)try{var Y=G.call(this.hls,_,L,o);if(!Y)throw new Error("Invalid response from configured generateRequest filter");_=Y.initDataType,L=o.decryptdata.pssh=Y.initData?new Uint8Array(Y.initData):null}catch(V){var j;if(this.warn(V.message),(j=this.hls)!==null&&j!==void 0&&j.config.debug)throw V}if(L===null)return this.log('Skipping key-session request for "'+x+'" (no initData)'),Promise.resolve(o);var X=this.getKeyIdString(o.decryptdata);this.log('Generating key-session request for "'+x+'": '+X+" (init data type: "+_+" length: "+(L?L.byteLength:null)+")");var q=new(g());o.mediaKeysSession.onmessage=function(V){var Q=o.mediaKeysSession;if(!Q){q.emit("error",new Error("invalid state"));return}var ee=V.messageType,Z=V.message;U.log('"'+ee+'" message event for session "'+Q.sessionId+'" message size: '+Z.byteLength),ee==="license-request"||ee==="license-renewal"?U.renewLicense(o,Z).catch(function(re){U.handleError(re),q.emit("error",re)}):ee==="license-release"?o.keySystem===D.KeySystems.FAIRPLAY&&(U.updateKeySession(o,(0,K.strToUtf8array)("acknowledged")),U.removeSession(o)):U.warn('unhandled media key message type "'+ee+'"')},o.mediaKeysSession.onkeystatuseschange=function(V){var Q=o.mediaKeysSession;if(!Q){q.emit("error",new Error("invalid state"));return}U.onKeyStatusChange(o);var ee=o.keyStatus;q.emit("keyStatus",ee),ee==="expired"&&(U.warn(o.keySystem+" expired for key "+X),U.renewKeySession(o))};var J=new Promise(function(V,Q){q.on("error",Q),q.on("keyStatus",function(ee){ee.startsWith("usable")?V():ee==="output-restricted"?Q(new y({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):ee==="internal-error"?Q(new y({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+ee+'"')):ee==="expired"?Q(new Error("key expired while generating request")):U.warn('unhandled key status change "'+ee+'"')})});return o.mediaKeysSession.generateRequest(_,L).then(function(){var V;U.log('Request generated for key-session "'+((V=o.mediaKeysSession)===null||V===void 0?void 0:V.sessionId)+'" keyId: '+X)}).catch(function(V){throw new y({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:V,fatal:!1},"Error generating key-session request: "+V)}).then(function(){return J}).catch(function(V){throw q.removeAllListeners(),U.removeSession(o),V}).then(function(){return q.removeAllListeners(),o})},a.onKeyStatusChange=function(o){var _=this;o.mediaKeysSession.keyStatuses.forEach(function(L,x){_.log('key status change "'+L+'" for keyStatuses keyId: '+B.default.hexDump("buffer"in x?new Uint8Array(x.buffer,x.byteOffset,x.byteLength):new Uint8Array(x))+" session keyId: "+B.default.hexDump(new Uint8Array(o.decryptdata.keyId||[]))+" uri: "+o.decryptdata.uri),o.keyStatus=L})},a.fetchServerCertificate=function(o){var _=this;return new Promise(function(L,x){var H=_.getServerCertificateUrl(o);if(!H)return L();_.log('Fetching serverCertificate for "'+o+'"');var W=new XMLHttpRequest;W.open("GET",H,!0),W.responseType="arraybuffer",W.onreadystatechange=function(){W.readyState===XMLHttpRequest.DONE&&(W.status===200?L(W.response):x(new y({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:W},'"'+o+'" certificate request XHR failed ('+H+"). Status: "+W.status+" ("+W.statusText+")")))},W.send()})},a.setMediaKeysServerCertificate=function(o,_,L){var x=this;return new Promise(function(H,W){o.setServerCertificate(L).then(function(U){x.log("setServerCertificate "+(U?"success":"not supported by CDM")+" ("+(L==null?void 0:L.byteLength)+') on "'+_+'"'),H(o)}).catch(function(U){W(new y({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:U,fatal:!0},U.message))})})},a.renewLicense=function(o,_){var L=this;return this.requestLicense(o,new Uint8Array(_)).then(function(x){return L.updateKeySession(o,new Uint8Array(x)).catch(function(H){throw new y({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:H,fatal:!0},H.message)})})},a.setupLicenseXHR=function(o,_,L,x){var H=this,W=this.config.licenseXhrSetup;return W?Promise.resolve().then(function(){if(!L.decryptdata)throw new Error("Key removed");return W.call(H.hls,o,_,L,x)}).catch(function(U){if(!L.decryptdata)throw U;return o.open("POST",_,!0),W.call(H.hls,o,_,L,x)}).then(function(U){o.readyState||o.open("POST",_,!0);var G=U||x;return{xhr:o,licenseChallenge:G}}):(o.open("POST",_,!0),Promise.resolve({xhr:o,licenseChallenge:x}))},a.requestLicense=function(o,_){var L=this;return new Promise(function(x,H){var W=L.getLicenseServerUrl(o.keySystem);L.log("Sending license request to URL: "+W);var U=new XMLHttpRequest;U.responseType="arraybuffer",U.onreadystatechange=function(){if(!L.hls||!o.mediaKeysSession)return H(new Error("invalid state"));if(U.readyState===4)if(U.status===200){L._requestLicenseFailureCount=0;var G=U.response;L.log("License received "+(G instanceof ArrayBuffer?G.byteLength:G));var Y=L.config.licenseResponseCallback;if(Y)try{G=Y.call(L.hls,U,W,o)}catch(X){L.error(X)}x(G)}else if(L._requestLicenseFailureCount++,L._requestLicenseFailureCount>h||U.status>=400&&U.status<500)H(new y({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:U},"License Request XHR failed ("+W+"). Status: "+U.status+" ("+U.statusText+")"));else{var j=h-L._requestLicenseFailureCount+1;L.warn("Retrying license request, "+j+" attempts left"),L.requestLicense(o,_).then(x,H)}},o.licenseXhr&&o.licenseXhr.readyState!==XMLHttpRequest.DONE&&o.licenseXhr.abort(),o.licenseXhr=U,L.setupLicenseXHR(U,W,o,_).then(function(G){var Y=G.xhr,j=G.licenseChallenge;Y.send(j)})})},a.onMediaAttached=function(o,_){if(this.config.emeEnabled){var L=_.media;this.media=L,L.addEventListener("encrypted",this.onMediaEncrypted),L.addEventListener("waitingforkey",this.onWaitingForKey)}},a.onMediaDetached=function(){var o=this,_=this.media,L=this.mediaKeySessions;_&&(_.removeEventListener("encrypted",this.onMediaEncrypted),_.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},F.LevelKey.clearKeyUriToKeyIdMap();var x=L.length;c.CDMCleanupPromise=Promise.all(L.map(function(H){return o.removeSession(H)}).concat(_==null?void 0:_.setMediaKeys(null).catch(function(H){o.log("Could not clear media keys: "+H+". media.src: "+(_==null?void 0:_.src))}))).then(function(){x&&(o.log("finished closing key sessions and clearing media keys"),L.length=0)}).catch(function(H){o.log("Could not close sessions and clear media keys: "+H+". media.src: "+(_==null?void 0:_.src))})},a.onManifestLoaded=function(o,_){var L=_.sessionKeys;if(!(!L||!this.config.emeEnabled)&&!this.keyFormatPromise){var x=L.reduce(function(H,W){return H.indexOf(W.keyFormat)===-1&&H.push(W.keyFormat),H},[]);this.log("Selecting key-system from session-keys "+x.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(x)}},a.removeSession=function(o){var _=this,L=o.mediaKeysSession,x=o.licenseXhr;if(L){this.log("Remove licenses and keys and close session "+L.sessionId),L.onmessage=null,L.onkeystatuseschange=null,x&&x.readyState!==XMLHttpRequest.DONE&&x.abort(),o.mediaKeysSession=o.decryptdata=o.licenseXhr=void 0;var H=this.mediaKeySessions.indexOf(o);return H>-1&&this.mediaKeySessions.splice(H,1),L.remove().catch(function(W){_.log("Could not remove session: "+W)}).then(function(){return L.close()}).catch(function(W){_.log("Could not close session: "+W)})}},c}();m.CDMCleanupPromise=void 0;var y=function(c){M(a,c);function a(T,o){var _;return _=c.call(this,o)||this,_.data=void 0,_.data=T,T.err=T.error,_}return a}(S(Error));const v=m},"./src/controller/fps-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>D});var R=s("./src/events.ts"),A=s("./src/utils/logger.ts"),w=function(){function K(F){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=F,this.registerListeners()}var k=K.prototype;return k.setStreamController=function(B){this.streamController=B},k.registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},k.unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching)},k.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},k.onMediaAttaching=function(B,P){var N=this.hls.config;if(N.capLevelOnFPSDrop){var g=P.media instanceof self.HTMLVideoElement?P.media:null;this.media=g,g&&typeof g.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),N.fpsDroppedMonitoringPeriod)}},k.checkFPS=function(B,P,N){var g=performance.now();if(P){if(this.lastTime){var M=g-this.lastTime,S=N-this.lastDroppedFrames,f=P-this.lastDecodedFrames,E=1e3*S/M,d=this.hls;if(d.trigger(R.Events.FPS_DROP,{currentDropped:S,currentDecoded:f,totalDroppedFrames:N}),E>0&&S>d.config.fpsDroppedMonitoringThreshold*f){var l=d.currentLevel;A.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=l)&&(l=l-1,d.trigger(R.Events.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:d.currentLevel}),d.autoLevelCapping=l,this.streamController.nextLevelSwitch())}}this.lastTime=g,this.lastDroppedFrames=N,this.lastDecodedFrames=P}},k.checkFPSInterval=function(){var B=this.media;if(B)if(this.isVideoPlaybackQualityAvailable){var P=B.getVideoPlaybackQuality();this.checkFPS(B,P.totalVideoFrames,P.droppedVideoFrames)}else this.checkFPS(B,B.webkitDecodedFrameCount,B.webkitDroppedFrameCount)},K}();const D=w},"./src/controller/fragment-finders.ts":(O,I,s)=>{s.r(I),s.d(I,{findFragWithCC:()=>F,findFragmentByPDT:()=>w,findFragmentByPTS:()=>D,fragmentWithinToleranceTest:()=>K,pdtWithinToleranceTest:()=>k});var R=s("./src/polyfills/number.ts"),A=s("./src/utils/binary-search.ts");function w(B,P,N){if(P===null||!Array.isArray(B)||!B.length||!(0,R.isFiniteNumber)(P))return null;var g=B[0].programDateTime;if(P<(g||0))return null;var M=B[B.length-1].endProgramDateTime;if(P>=(M||0))return null;N=N||0;for(var S=0;S<B.length;++S){var f=B[S];if(k(P,N,f))return f}return null}function D(B,P,N,g){N===void 0&&(N=0),g===void 0&&(g=0);var M=null;if(B?M=P[B.sn-P[0].sn+1]||null:N===0&&P[0].start===0&&(M=P[0]),M&&K(N,g,M)===0)return M;var S=A.default.search(P,K.bind(null,N,g));return S&&(S!==B||!M)?S:M}function K(B,P,N){if(B===void 0&&(B=0),P===void 0&&(P=0),N.start<=B&&N.start+N.duration>B)return 0;var g=Math.min(P,N.duration+(N.deltaPTS?N.deltaPTS:0));return N.start+N.duration-g<=B?1:N.start-g>B&&N.start?-1:0}function k(B,P,N){var g=Math.min(P,N.duration+(N.deltaPTS?N.deltaPTS:0))*1e3,M=N.endProgramDateTime||0;return M-g>B}function F(B,P){return A.default.search(B,function(N){return N.cc<P?1:N.cc>P?-1:0})}},"./src/controller/fragment-tracker.ts":(O,I,s)=>{s.r(I),s.d(I,{FragmentState:()=>w,FragmentTracker:()=>D});var R=s("./src/events.ts"),A=s("./src/types/loader.ts"),w;(function(F){F.NOT_LOADED="NOT_LOADED",F.APPENDING="APPENDING",F.PARTIAL="PARTIAL",F.OK="OK"})(w||(w={}));var D=function(){function F(P){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=P,this._registerListeners()}var B=F.prototype;return B._registerListeners=function(){var N=this.hls;N.on(R.Events.BUFFER_APPENDED,this.onBufferAppended,this),N.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this),N.on(R.Events.FRAG_LOADED,this.onFragLoaded,this)},B._unregisterListeners=function(){var N=this.hls;N.off(R.Events.BUFFER_APPENDED,this.onBufferAppended,this),N.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this),N.off(R.Events.FRAG_LOADED,this.onFragLoaded,this)},B.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},B.getAppendedFrag=function(N,g){if(g===A.PlaylistLevelType.MAIN){var M=this.activeFragment,S=this.activeParts;if(!M)return null;if(S)for(var f=S.length;f--;){var E=S[f],d=E?E.end:M.appendedPTS;if(E.start<=N&&d!==void 0&&N<=d)return f>9&&(this.activeParts=S.slice(f-9)),E}else if(M.start<=N&&M.appendedPTS!==void 0&&N<=M.appendedPTS)return M}return this.getBufferedFrag(N,g)},B.getBufferedFrag=function(N,g){for(var M=this.fragments,S=Object.keys(M),f=S.length;f--;){var E=M[S[f]];if((E==null?void 0:E.body.type)===g&&E.buffered){var d=E.body;if(d.start<=N&&N<=d.end)return d}}return null},B.detectEvictedFragments=function(N,g,M){var S=this;this.timeRanges&&(this.timeRanges[N]=g),Object.keys(this.fragments).forEach(function(f){var E=S.fragments[f];if(E){if(!E.buffered&&!E.loaded){E.body.type===M&&S.removeFragment(E.body);return}var d=E.range[N];d&&d.time.some(function(l){var b=!S.isTimeBuffered(l.startPTS,l.endPTS,g);return b&&S.removeFragment(E.body),b})}})},B.detectPartialFragments=function(N){var g=this,M=this.timeRanges,S=N.frag,f=N.part;if(!(!M||S.sn==="initSegment")){var E=k(S),d=this.fragments[E];d&&(Object.keys(M).forEach(function(l){var b=S.elementaryStreams[l];if(b){var h=M[l],u=f!==null||b.partial===!0;d.range[l]=g.getBufferedTimes(S,f,u,h)}}),d.loaded=null,Object.keys(d.range).length?(d.buffered=!0,d.body.endList&&(this.endListFragments[d.body.type]=d)):this.removeFragment(d.body))}},B.fragBuffered=function(N){var g=k(N),M=this.fragments[g];M&&(M.loaded=null,M.buffered=!0)},B.getBufferedTimes=function(N,g,M,S){for(var f={time:[],partial:M},E=g?g.start:N.start,d=g?g.end:N.end,l=N.minEndPTS||d,b=N.maxStartPTS||E,h=0;h<S.length;h++){var u=S.start(h)-this.bufferPadding,m=S.end(h)+this.bufferPadding;if(b>=u&&l<=m){f.time.push({startPTS:Math.max(E,S.start(h)),endPTS:Math.min(d,S.end(h))});break}else if(E<m&&d>u)f.partial=!0,f.time.push({startPTS:Math.max(E,S.start(h)),endPTS:Math.min(d,S.end(h))});else if(d<=u)break}return f},B.getPartialFragment=function(N){var g=null,M,S,f,E=0,d=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach(function(b){var h=l[b];h&&K(h)&&(S=h.body.start-d,f=h.body.end+d,N>=S&&N<=f&&(M=Math.min(N-S,f-N),E<=M&&(g=h.body,E=M)))}),g},B.isEndListAppended=function(N){var g=this.endListFragments[N];return g!==void 0&&(g.buffered||K(g))},B.getState=function(N){var g=k(N),M=this.fragments[g];return M?M.buffered?K(M)?w.PARTIAL:w.OK:w.APPENDING:w.NOT_LOADED},B.isTimeBuffered=function(N,g,M){for(var S,f,E=0;E<M.length;E++){if(S=M.start(E)-this.bufferPadding,f=M.end(E)+this.bufferPadding,N>=S&&g<=f)return!0;if(g<=S)return!1}return!1},B.onFragLoaded=function(N,g){var M=g.frag,S=g.part;if(!(M.sn==="initSegment"||M.bitrateTest||S)){var f=k(M);this.fragments[f]={body:M,loaded:g,buffered:!1,range:Object.create(null)}}},B.onBufferAppended=function(N,g){var M=this,S=g.frag,f=g.part,E=g.timeRanges;if(S.type===A.PlaylistLevelType.MAIN)if(this.activeFragment!==S&&(this.activeFragment=S,S.appendedPTS=void 0),f){var d=this.activeParts;d||(this.activeParts=d=[]),d.push(f)}else this.activeParts=null;this.timeRanges=E,Object.keys(E).forEach(function(l){var b=E[l];if(M.detectEvictedFragments(l,b),!f&&S.type===A.PlaylistLevelType.MAIN){var h=S.elementaryStreams[l];if(!h)return;for(var u=0;u<b.length;u++){var m=b.end(u);m<=h.endPTS&&m>h.startPTS?S.appendedPTS=Math.max(m,S.appendedPTS||0):S.appendedPTS=h.endPTS}}})},B.onFragBuffered=function(N,g){this.detectPartialFragments(g)},B.hasFragment=function(N){var g=k(N);return!!this.fragments[g]},B.removeFragmentsInRange=function(N,g,M){var S=this;Object.keys(this.fragments).forEach(function(f){var E=S.fragments[f];if(E&&E.buffered){var d=E.body;d.type===M&&d.start<g&&d.end>N&&S.removeFragment(d)}})},B.removeFragment=function(N){var g=k(N);N.stats.loaded=0,N.clearElementaryStreamInfo(),N.appendedPTS=void 0,delete this.fragments[g],N.endList&&delete this.endListFragments[N.type]},B.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},F}();function K(F){var B,P;return F.buffered&&(((B=F.range.video)===null||B===void 0?void 0:B.partial)||((P=F.range.audio)===null||P===void 0?void 0:P.partial))}function k(F){return F.type+"_"+F.level+"_"+F.urlId+"_"+F.sn}},"./src/controller/gap-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{MAX_START_GAP_JUMP:()=>k,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>F,SKIP_BUFFER_RANGE_START:()=>B,STALL_MINIMUM_DURATION_MS:()=>K,default:()=>P});var R=s("./src/utils/buffer-helper.ts"),A=s("./src/errors.ts"),w=s("./src/events.ts"),D=s("./src/utils/logger.ts"),K=250,k=2,F=.1,B=.05,P=function(){function N(M,S,f,E){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=M,this.media=S,this.fragmentTracker=f,this.hls=E}var g=N.prototype;return g.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},g.poll=function(S,f){var E=this.config,d=this.media,l=this.stalled;if(d!==null){var b=d.currentTime,h=d.seeking,u=this.seeking&&!h,m=!this.seeking&&h;if(this.seeking=h,b!==S){if(this.moved=!0,l!==null){if(this.stallReported){var y=self.performance.now()-l;D.logger.warn("playback not stuck anymore @"+b+", after "+Math.round(y)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((m||u)&&(this.stalled=null),!(d.paused&&!h||d.ended||d.playbackRate===0||!R.BufferHelper.getBuffered(d).length)){var v=R.BufferHelper.bufferInfo(d,b,0),c=v.len>0,a=v.nextStart||0;if(!(!c&&!a)){if(h){var T=v.len>k,o=!a||f&&f.start<=b||a-b>k&&!this.fragmentTracker.getPartialFragment(b);if(T||o)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var _,L=Math.max(a,v.start||0)-b,x=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,H=x==null||(_=x.details)===null||_===void 0?void 0:_.live,W=H?x.details.targetduration*2:k;if(L>0&&L<=W){this._trySkipBufferHole(null);return}}var U=self.performance.now();if(l===null){this.stalled=U;return}var G=U-l;if(!(!h&&G>=K&&(this._reportStall(v),!this.media))){var Y=R.BufferHelper.bufferInfo(d,b,E.maxBufferHole);this._tryFixBufferStall(Y,G)}}}}},g._tryFixBufferStall=function(S,f){var E=this.config,d=this.fragmentTracker,l=this.media;if(l!==null){var b=l.currentTime,h=d.getPartialFragment(b);if(h){var u=this._trySkipBufferHole(h);if(u||!this.media)return}S.len>E.maxBufferHole&&f>E.highBufferWatchdogPeriod*1e3&&(D.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},g._reportStall=function(S){var f=this.hls,E=this.media,d=this.stallReported;!d&&E&&(this.stallReported=!0,D.logger.warn("Playback stalling at @"+E.currentTime+" due to low buffer ("+JSON.stringify(S)+")"),f.trigger(w.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:S.len}))},g._trySkipBufferHole=function(S){var f=this.config,E=this.hls,d=this.media;if(d===null)return 0;for(var l=d.currentTime,b=0,h=R.BufferHelper.getBuffered(d),u=0;u<h.length;u++){var m=h.start(u);if(l+f.maxBufferHole>=b&&l<m){var y=Math.max(m+B,d.currentTime+F);return D.logger.warn("skipping hole, adjusting currentTime from "+l+" to "+y),this.moved=!0,this.stalled=null,d.currentTime=y,S&&E.trigger(w.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+l+" to "+y,frag:S}),y}b=h.end(u)}return 0},g._tryNudgeBuffer=function(){var S=this.config,f=this.hls,E=this.media,d=this.nudgeRetry;if(E!==null){var l=E.currentTime;if(this.nudgeRetry++,d<S.nudgeMaxRetry){var b=l+(d+1)*S.nudgeOffset;D.logger.warn("Nudging 'currentTime' from "+l+" to "+b),E.currentTime=b,f.trigger(w.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else D.logger.error("Playhead still not moving while enough data buffered @"+l+" after "+S.nudgeMaxRetry+" nudges"),f.trigger(w.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},N}()},"./src/controller/id3-track-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>S});var R=s("./src/polyfills/number.ts"),A=s("./src/events.ts"),w=s("./src/utils/texttrack-utils.ts"),D=s("./src/demux/id3.ts"),K=s("./src/loader/date-range.ts"),k=s("./src/types/demuxer.ts"),F=.25;function B(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var P=function(){var f=B();try{new f(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function N(f,E){return f.getTime()/1e3-E}function g(f){return Uint8Array.from(f.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var M=function(){function f(d){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=d,this._registerListeners()}var E=f.prototype;return E.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},E._registerListeners=function(){var l=this.hls;l.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(A.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),l.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),l.on(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},E._unregisterListeners=function(){var l=this.hls;l.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(A.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),l.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),l.off(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},E.onMediaAttached=function(l,b){this.media=b.media},E.onMediaDetaching=function(){this.id3Track&&((0,w.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},E.onManifestLoading=function(){this.dateRangeCuesAppended={}},E.createTrack=function(l){var b=this.getID3Track(l.textTracks);return b.mode="hidden",b},E.getID3Track=function(l){if(this.media){for(var b=0;b<l.length;b++){var h=l[b];if(h.kind==="metadata"&&h.label==="id3")return(0,w.sendAddTrackEvent)(h,this.media),h}return this.media.addTextTrack("metadata","id3")}},E.onFragParsingMetadata=function(l,b){if(this.media){var h=this.hls.config,u=h.enableEmsgMetadataCues,m=h.enableID3MetadataCues;if(!(!u&&!m)){var y=b.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var v=B(),c=0;c<y.length;c++){var a=y[c].type;if(!(a===k.MetadataSchema.emsg&&!u||!m)){var T=D.getID3Frames(y[c].data);if(T){var o=y[c].pts,_=o+y[c].duration;_>P&&(_=P);var L=_-o;L<=0&&(_=o+F);for(var x=0;x<T.length;x++){var H=T[x];if(!D.isTimeStampFrame(H)){this.updateId3CueEnds(o);var W=new v(o,_,"");W.value=H,a&&(W.type=a),this.id3Track.addCue(W)}}}}}}}},E.updateId3CueEnds=function(l){var b,h=(b=this.id3Track)===null||b===void 0?void 0:b.cues;if(h)for(var u=h.length;u--;){var m=h[u];m.startTime<l&&m.endTime===P&&(m.endTime=l)}},E.onBufferFlushing=function(l,b){var h=b.startOffset,u=b.endOffset,m=b.type,y=this.id3Track,v=this.hls;if(v){var c=v.config,a=c.enableEmsgMetadataCues,T=c.enableID3MetadataCues;if(y&&(a||T)){var o;m==="audio"?o=function(L){return L.type===k.MetadataSchema.audioId3&&T}:m==="video"?o=function(L){return L.type===k.MetadataSchema.emsg&&a}:o=function(L){return L.type===k.MetadataSchema.audioId3&&T||L.type===k.MetadataSchema.emsg&&a},(0,w.removeCuesInRange)(y,h,u,o)}}},E.onLevelUpdated=function(l,b){var h=this,u=b.details;if(!(!this.media||!u.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var m=this.dateRangeCuesAppended,y=this.id3Track,v=u.dateRanges,c=Object.keys(v);if(y)for(var a=Object.keys(m).filter(function(U){return!c.includes(U)}),T=function(G){var Y=a[G];Object.keys(m[Y].cues).forEach(function(j){y.removeCue(m[Y].cues[j])}),delete m[Y]},o=a.length;o--;)T(o);var _=u.fragments[u.fragments.length-1];if(!(c.length===0||!(0,R.isFiniteNumber)(_==null?void 0:_.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var L=_.programDateTime/1e3-_.start,x=B(),H=function(G){var Y=c[G],j=v[Y],X=m[Y],q=(X==null?void 0:X.cues)||{},J=(X==null?void 0:X.durationKnown)||!1,V=N(j.startDate,L),Q=P,ee=j.endDate;if(ee)Q=N(ee,L),J=!0;else if(j.endOnNext&&!J){var Z=c.reduce(function(oe,ge){var he=v[ge];return he.class===j.class&&he.id!==ge&&he.startDate>j.startDate&&oe.push(he),oe},[]).sort(function(oe,ge){return oe.startDate.getTime()-ge.startDate.getTime()})[0];Z&&(Q=N(Z.startDate,L),J=!0)}for(var re=Object.keys(j.attr),ae=0;ae<re.length;ae++){var le=re[ae];if(!(le===K.DateRangeAttribute.ID||le===K.DateRangeAttribute.CLASS||le===K.DateRangeAttribute.START_DATE||le===K.DateRangeAttribute.DURATION||le===K.DateRangeAttribute.END_DATE||le===K.DateRangeAttribute.END_ON_NEXT)){var ne=q[le];if(ne)J&&!X.durationKnown&&(ne.endTime=Q);else{var ie=j.attr[le];ne=new x(V,Q,""),(le===K.DateRangeAttribute.SCTE35_OUT||le===K.DateRangeAttribute.SCTE35_IN)&&(ie=g(ie)),ne.value={key:le,data:ie},ne.type=k.MetadataSchema.dateRange,h.id3Track.addCue(ne),q[le]=ne}}}m[Y]={cues:q,dateRange:j,durationKnown:J}},W=0;W<c.length;W++)H(W)}}},f}();const S=M},"./src/controller/latency-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>B});var R=s("./src/errors.ts"),A=s("./src/events.ts"),w=s("./src/utils/logger.ts");function D(P,N){for(var g=0;g<N.length;g++){var M=N[g];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(P,k(M.key),M)}}function K(P,N,g){return N&&D(P.prototype,N),g&&D(P,g),Object.defineProperty(P,"prototype",{writable:!1}),P}function k(P){var N=F(P,"string");return typeof N=="symbol"?N:String(N)}function F(P,N){if(typeof P!="object"||P===null)return P;var g=P[Symbol.toPrimitive];if(g!==void 0){var M=g.call(P,N||"default");if(typeof M!="object")return M;throw new TypeError("@@toPrimitive must return a primitive value.")}return(N==="string"?String:Number)(P)}var B=function(){function P(g){var M=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return M.timeupdate()},this.hls=g,this.config=g.config,this.registerListeners()}var N=P.prototype;return N.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},N.registerListeners=function(){this.hls.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(A.Events.ERROR,this.onError,this)},N.unregisterListeners=function(){this.hls.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(A.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(A.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(A.Events.ERROR,this.onError)},N.onMediaAttached=function(M,S){this.media=S.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},N.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},N.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},N.onLevelUpdated=function(M,S){var f=S.details;this.levelDetails=f,f.advanced&&this.timeupdate(),!f.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},N.onError=function(M,S){S.details===R.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,w.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},N.timeupdate=function(){var M=this.media,S=this.levelDetails;if(!(!M||!S)){this.currentTime=M.currentTime;var f=this.computeLatency();if(f!==null){this._latency=f;var E=this.config,d=E.lowLatencyMode,l=E.maxLiveSyncPlaybackRate;if(!(!d||l===1)){var b=this.targetLatency;if(b!==null){var h=f-b,u=Math.min(this.maxLatency,b+S.targetduration),m=h<u;if(S.live&&m&&h>.05&&this.forwardBufferLength>1){var y=Math.min(2,Math.max(1,l)),v=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;M.playbackRate=Math.min(y,Math.max(1,v))}else M.playbackRate!==1&&M.playbackRate!==0&&(M.playbackRate=1)}}}}},N.estimateLiveEdge=function(){var M=this.levelDetails;return M===null?null:M.edge+M.age},N.computeLatency=function(){var M=this.estimateLiveEdge();return M===null?null:M-this.currentTime},K(P,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var M=this.config,S=this.levelDetails;return M.liveMaxLatencyDuration!==void 0?M.liveMaxLatencyDuration:S?M.liveMaxLatencyDurationCount*S.targetduration:0}},{key:"targetLatency",get:function(){var M=this.levelDetails;if(M===null)return null;var S=M.holdBack,f=M.partHoldBack,E=M.targetduration,d=this.config,l=d.liveSyncDuration,b=d.liveSyncDurationCount,h=d.lowLatencyMode,u=this.hls.userConfig,m=h&&f||S;(u.liveSyncDuration||u.liveSyncDurationCount||m===0)&&(m=l!==void 0?l:b*E);var y=E,v=1;return m+Math.min(this.stallCount*v,y)}},{key:"liveSyncPosition",get:function(){var M=this.estimateLiveEdge(),S=this.targetLatency,f=this.levelDetails;if(M===null||S===null||f===null)return null;var E=f.edge,d=M-S-this.edgeStalled,l=E-f.totalduration,b=E-(this.config.lowLatencyMode&&f.partTarget||f.targetduration);return Math.min(Math.max(l,d),b)}},{key:"drift",get:function(){var M=this.levelDetails;return M===null?1:M.drift}},{key:"edgeStalled",get:function(){var M=this.levelDetails;if(M===null)return 0;var S=(this.config.lowLatencyMode&&M.partTarget||M.targetduration)*3;return Math.max(M.age-S,0)}},{key:"forwardBufferLength",get:function(){var M=this.media,S=this.levelDetails;if(!M||!S)return 0;var f=M.buffered.length;return(f?M.buffered.end(f-1):S.edge)-this.currentTime}}]),P}()},"./src/controller/level-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>d});var R=s("./src/types/level.ts"),A=s("./src/events.ts"),w=s("./src/errors.ts"),D=s("./src/utils/codecs.ts"),K=s("./src/controller/level-helper.ts"),k=s("./src/controller/base-playlist-controller.ts"),F=s("./src/types/loader.ts");function B(){return B=Object.assign?Object.assign.bind():function(l){for(var b=1;b<arguments.length;b++){var h=arguments[b];for(var u in h)Object.prototype.hasOwnProperty.call(h,u)&&(l[u]=h[u])}return l},B.apply(this,arguments)}function P(l,b){for(var h=0;h<b.length;h++){var u=b[h];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(l,g(u.key),u)}}function N(l,b,h){return b&&P(l.prototype,b),h&&P(l,h),Object.defineProperty(l,"prototype",{writable:!1}),l}function g(l){var b=M(l,"string");return typeof b=="symbol"?b:String(b)}function M(l,b){if(typeof l!="object"||l===null)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var u=h.call(l,b||"default");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(b==="string"?String:Number)(l)}function S(l,b){l.prototype=Object.create(b.prototype),l.prototype.constructor=l,f(l,b)}function f(l,b){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,m){return u.__proto__=m,u},f(l,b)}var E=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),d=function(l){S(b,l);function b(u){var m;return m=l.call(this,u,"[level-controller]")||this,m._levels=[],m._firstLevel=-1,m._startLevel=void 0,m.currentLevelIndex=-1,m.manualLevelIndex=-1,m.onParsedComplete=void 0,m._registerListeners(),m}var h=b.prototype;return h._registerListeners=function(){var m=this.hls;m.on(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),m.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),m.on(A.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),m.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),m.on(A.Events.ERROR,this.onError,this)},h._unregisterListeners=function(){var m=this.hls;m.off(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),m.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),m.off(A.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),m.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),m.off(A.Events.ERROR,this.onError,this)},h.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,l.prototype.destroy.call(this)},h.startLoad=function(){var m=this._levels;m.forEach(function(y){y.loadError=0}),l.prototype.startLoad.call(this)},h.onManifestLoaded=function(m,y){var v=[],c=[],a=[],T,o={},_,L=!1,x=!1,H=!1;if(y.levels.forEach(function(Y){var j=Y.attrs;L=L||!!(Y.width&&Y.height),x=x||!!Y.videoCodec,H=H||!!Y.audioCodec,E&&Y.audioCodec&&Y.audioCodec.indexOf("mp4a.40.34")!==-1&&(Y.audioCodec=void 0);var X=Y.bitrate+"-"+Y.attrs.RESOLUTION+"-"+Y.attrs.CODECS;_=o[X],_?_.url.push(Y.url):(_=new R.Level(Y),o[X]=_,v.push(_)),j&&(j.AUDIO&&(0,K.addGroupId)(_,"audio",j.AUDIO),j.SUBTITLES&&(0,K.addGroupId)(_,"text",j.SUBTITLES))}),(L||x)&&H&&(v=v.filter(function(Y){var j=Y.videoCodec,X=Y.width,q=Y.height;return!!j||!!(X&&q)})),v=v.filter(function(Y){var j=Y.audioCodec,X=Y.videoCodec;return(!j||(0,D.isCodecSupportedInMp4)(j,"audio"))&&(!X||(0,D.isCodecSupportedInMp4)(X,"video"))}),y.audioTracks&&(c=y.audioTracks.filter(function(Y){return!Y.audioCodec||(0,D.isCodecSupportedInMp4)(Y.audioCodec,"audio")}),(0,K.assignTrackIdsByGroup)(c)),y.subtitles&&(a=y.subtitles,(0,K.assignTrackIdsByGroup)(a)),v.length>0){T=v[0].bitrate,v.sort(function(Y,j){return Y.attrs["HDCP-LEVEL"]!==j.attrs["HDCP-LEVEL"]?(Y.attrs["HDCP-LEVEL"]||"")>(j.attrs["HDCP-LEVEL"]||"")?1:-1:Y.bitrate!==j.bitrate?Y.bitrate-j.bitrate:Y.attrs.SCORE!==j.attrs.SCORE?Y.attrs.decimalFloatingPoint("SCORE")-j.attrs.decimalFloatingPoint("SCORE"):L&&Y.height!==j.height?Y.height-j.height:0}),this._levels=v;for(var W=0;W<v.length;W++)if(v[W].bitrate===T){this._firstLevel=W,this.log("manifest loaded, "+v.length+" level(s) found, first bitrate: "+T);break}var U=H&&!x,G={levels:v,audioTracks:c,subtitleTracks:a,sessionData:y.sessionData,sessionKeys:y.sessionKeys,firstLevel:this._firstLevel,stats:y.stats,audio:H,video:x,altAudio:!U&&c.some(function(Y){return!!Y.url})};this.hls.trigger(A.Events.MANIFEST_PARSED,G),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(A.Events.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:y.url,reason:"no level with compatible codecs found in manifest"})},h.onError=function(m,y){var v,c;if(l.prototype.onError.call(this,m,y),!y.fatal){var a=y.context,T=this._levels[this.currentLevelIndex];if(a&&(a.type===F.PlaylistContextType.AUDIO_TRACK&&T.audioGroupIds&&a.groupId===T.audioGroupIds[T.urlId]||a.type===F.PlaylistContextType.SUBTITLE_TRACK&&T.textGroupIds&&a.groupId===T.textGroupIds[T.urlId])){this.redundantFailover(this.currentLevelIndex);return}var o=!1,_=!0,L;switch(y.details){case w.ErrorDetails.FRAG_LOAD_ERROR:case w.ErrorDetails.FRAG_LOAD_TIMEOUT:case w.ErrorDetails.KEY_LOAD_ERROR:case w.ErrorDetails.KEY_LOAD_TIMEOUT:if(y.frag){var x=y.frag.type===F.PlaylistLevelType.MAIN?y.frag.level:this.currentLevelIndex,H=this._levels[x];H?(H.fragmentError++,H.fragmentError>this.hls.config.fragLoadingMaxRetry&&(L=x)):L=x}break;case w.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var W=T.attrs["HDCP-LEVEL"];W&&(this.hls.maxHdcpLevel=R.HdcpLevels[R.HdcpLevels.indexOf(W)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'))}case w.ErrorDetails.FRAG_PARSING_ERROR:case w.ErrorDetails.KEY_SYSTEM_NO_SESSION:L=((v=y.frag)===null||v===void 0?void 0:v.type)===F.PlaylistLevelType.MAIN?y.frag.level:this.currentLevelIndex,y.levelRetry=!1;break;case w.ErrorDetails.LEVEL_LOAD_ERROR:case w.ErrorDetails.LEVEL_LOAD_TIMEOUT:a&&(a.deliveryDirectives&&(_=!1),L=a.level),o=!0;break;case w.ErrorDetails.REMUX_ALLOC_ERROR:L=(c=y.level)!=null?c:this.currentLevelIndex,o=!0;break}L!==void 0&&this.recoverLevel(y,L,o,_)}},h.recoverLevel=function(m,y,v,c){var a=m.details,T=this._levels[y];if(T.loadError++,v){var o=this.retryLoadingOrFail(m);if(o)m.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(c){var _=T.url.length;if(_>1&&T.loadError<_)m.levelRetry=!0,this.redundantFailover(y);else if(this.manualLevelIndex===-1){for(var L=-1,x=this._levels,H=x.length;H--;){var W=(H+this.currentLevelIndex)%x.length;if(W!==this.currentLevelIndex&&x[W].loadError===0){L=W;break}}L>-1&&this.currentLevelIndex!==L?(this.warn(a+": switch to "+L),m.levelRetry=!0,this.hls.nextAutoLevel=L):m.levelRetry===!1&&(m.fatal=!0)}}},h.redundantFailover=function(m){var y=this._levels[m],v=y.url.length;if(v>1){var c=(y.urlId+1)%v;this.warn("Switching to redundant URL-id "+c),this._levels.forEach(function(a){a.urlId=c}),this.level=m}},h.onFragLoaded=function(m,y){var v=y.frag;if(v!==void 0&&v.type===F.PlaylistLevelType.MAIN){var c=this._levels[v.level];c!==void 0&&(c.fragmentError=0,c.loadError=0)}},h.onLevelLoaded=function(m,y){var v,c=y.level,a=y.details,T=this._levels[c];if(!T){var o;this.warn("Invalid level index "+c),(o=y.deliveryDirectives)!==null&&o!==void 0&&o.skip&&(a.deltaUpdateFailed=!0);return}c===this.currentLevelIndex?(T.fragmentError===0&&(T.loadError=0,this.retryCount=0),this.playlistLoaded(c,y,T.details)):(v=y.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(a.deltaUpdateFailed=!0)},h.onAudioTrackSwitched=function(m,y){var v=this.hls.levels[this.currentLevelIndex];if(v&&v.audioGroupIds){for(var c=-1,a=this.hls.audioTracks[y.id].groupId,T=0;T<v.audioGroupIds.length;T++)if(v.audioGroupIds[T]===a){c=T;break}c!==v.urlId&&(v.urlId=c,this.startLoad())}},h.loadPlaylist=function(m){l.prototype.loadPlaylist.call(this);var y=this.currentLevelIndex,v=this._levels[y];if(this.canLoad&&v&&v.url.length>0){var c=v.urlId,a=v.url[c];if(m)try{a=m.addDirectives(a)}catch(T){this.warn("Could not construct new URL with HLS Delivery Directives: "+T)}this.log("Attempt loading level index "+y+(m?" at sn "+m.msn+" part "+m.part:"")+" with URL-id "+c+" "+a),this.clearTimer(),this.hls.trigger(A.Events.LEVEL_LOADING,{url:a,level:y,id:c,deliveryDirectives:m||null})}},h.removeLevel=function(m,y){var v=function(T,o){return o!==y},c=this._levels.filter(function(a,T){return T!==m?!0:a.url.length>1&&y!==void 0?(a.url=a.url.filter(v),a.audioGroupIds&&(a.audioGroupIds=a.audioGroupIds.filter(v)),a.textGroupIds&&(a.textGroupIds=a.textGroupIds.filter(v)),a.urlId=0,!0):!1}).map(function(a,T){var o=a.details;return o!=null&&o.fragments&&o.fragments.forEach(function(_){_.level=T}),a});this._levels=c,this.hls.trigger(A.Events.LEVELS_UPDATED,{levels:c})},N(b,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(m){var y,v=this._levels;if(v.length!==0&&!(this.currentLevelIndex===m&&(y=v[m])!==null&&y!==void 0&&y.details)){if(m<0||m>=v.length){var c=m<0;if(this.hls.trigger(A.Events.ERROR,{type:w.ErrorTypes.OTHER_ERROR,details:w.ErrorDetails.LEVEL_SWITCH_ERROR,level:m,fatal:c,reason:"invalid level idx"}),c)return;m=Math.min(m,v.length-1)}this.clearTimer();var a=this.currentLevelIndex,T=v[a],o=v[m];this.log("switching to level "+m+" from "+a),this.currentLevelIndex=m;var _=B({},o,{level:m,maxBitrate:o.maxBitrate,uri:o.uri,urlId:o.urlId});delete _._urlId,this.hls.trigger(A.Events.LEVEL_SWITCHING,_);var L=o.details;if(!L||L.live){var x=this.switchParams(o.uri,T==null?void 0:T.details);this.loadPlaylist(x)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(m){this.manualLevelIndex=m,this._startLevel===void 0&&(this._startLevel=m),m!==-1&&(this.level=m)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(m){this._firstLevel=m}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var m=this.hls.config.startLevel;return m!==void 0?m:this._firstLevel}else return this._startLevel},set:function(m){this._startLevel=m}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(m){this.level=m,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=m)}}]),b}(k.default)},"./src/controller/level-helper.ts":(O,I,s)=>{s.r(I),s.d(I,{addGroupId:()=>K,addSliding:()=>E,adjustSliding:()=>f,assignTrackIdsByGroup:()=>k,computeReloadInterval:()=>d,getFragmentWithSN:()=>l,getPartWith:()=>b,mapFragmentIntersection:()=>S,mapPartIntersection:()=>M,mergeDetails:()=>N,updateFragPTSDTS:()=>P,updatePTS:()=>F});var R=s("./src/polyfills/number.ts"),A=s("./src/utils/logger.ts"),w=s("./src/loader/date-range.ts");function D(){return D=Object.assign?Object.assign.bind():function(h){for(var u=1;u<arguments.length;u++){var m=arguments[u];for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])}return h},D.apply(this,arguments)}function K(h,u,m){switch(u){case"audio":h.audioGroupIds||(h.audioGroupIds=[]),h.audioGroupIds.push(m);break;case"text":h.textGroupIds||(h.textGroupIds=[]),h.textGroupIds.push(m);break}}function k(h){var u={};h.forEach(function(m){var y=m.groupId||"";m.id=u[y]=u[y]||0,u[y]++})}function F(h,u,m){var y=h[u],v=h[m];B(y,v)}function B(h,u){var m=u.startPTS;if((0,R.isFiniteNumber)(m)){var y=0,v;u.sn>h.sn?(y=m-h.start,v=h):(y=h.start-m,v=u),v.duration!==y&&(v.duration=y)}else if(u.sn>h.sn){var c=h.cc===u.cc;c&&h.minEndPTS?u.start=h.start+(h.minEndPTS-h.start):u.start=h.start+h.duration}else u.start=Math.max(h.start-u.duration,0)}function P(h,u,m,y,v,c){var a=y-m;a<=0&&(A.logger.warn("Fragment should have a positive duration",u),y=m+u.duration,c=v+u.duration);var T=m,o=y,_=u.startPTS,L=u.endPTS;if((0,R.isFiniteNumber)(_)){var x=Math.abs(_-m);(0,R.isFiniteNumber)(u.deltaPTS)?u.deltaPTS=Math.max(x,u.deltaPTS):u.deltaPTS=x,T=Math.max(m,_),m=Math.min(m,_),v=Math.min(v,u.startDTS),o=Math.min(y,L),y=Math.max(y,L),c=Math.max(c,u.endDTS)}u.duration=y-m;var H=m-u.start;u.start=u.startPTS=m,u.maxStartPTS=T,u.startDTS=v,u.endPTS=y,u.minEndPTS=o,u.endDTS=c;var W=u.sn;if(!h||W<h.startSN||W>h.endSN)return 0;var U,G=W-h.startSN,Y=h.fragments;for(Y[G]=u,U=G;U>0;U--)B(Y[U],Y[U-1]);for(U=G;U<Y.length-1;U++)B(Y[U],Y[U+1]);return h.fragmentHint&&B(Y[Y.length-1],h.fragmentHint),h.PTSKnown=h.alignedSliding=!0,H}function N(h,u){for(var m=null,y=h.fragments,v=y.length-1;v>=0;v--){var c=y[v].initSegment;if(c){m=c;break}}h.fragmentHint&&delete h.fragmentHint.endPTS;var a=0,T;if(S(h,u,function(U,G){U.relurl&&(a=U.cc-G.cc),(0,R.isFiniteNumber)(U.startPTS)&&(0,R.isFiniteNumber)(U.endPTS)&&(G.start=G.startPTS=U.startPTS,G.startDTS=U.startDTS,G.appendedPTS=U.appendedPTS,G.maxStartPTS=U.maxStartPTS,G.endPTS=U.endPTS,G.endDTS=U.endDTS,G.minEndPTS=U.minEndPTS,G.duration=U.endPTS-U.startPTS,G.duration&&(T=G),u.PTSKnown=u.alignedSliding=!0),G.elementaryStreams=U.elementaryStreams,G.loader=U.loader,G.stats=U.stats,G.urlId=U.urlId,U.initSegment&&(G.initSegment=U.initSegment,m=U.initSegment)}),m){var o=u.fragmentHint?u.fragments.concat(u.fragmentHint):u.fragments;o.forEach(function(U){var G;(!U.initSegment||U.initSegment.relurl===((G=m)===null||G===void 0?void 0:G.relurl))&&(U.initSegment=m)})}if(u.skippedSegments)if(u.deltaUpdateFailed=u.fragments.some(function(U){return!U}),u.deltaUpdateFailed){A.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var _=u.skippedSegments;_--;)u.fragments.shift();u.startSN=u.fragments[0].sn,u.startCC=u.fragments[0].cc}else u.canSkipDateRanges&&(u.dateRanges=g(h.dateRanges,u.dateRanges,u.recentlyRemovedDateranges));var L=u.fragments;if(a){A.logger.warn("discontinuity sliding from playlist, take drift into account");for(var x=0;x<L.length;x++)L[x].cc+=a}u.skippedSegments&&(u.startCC=u.fragments[0].cc),M(h.partList,u.partList,function(U,G){G.elementaryStreams=U.elementaryStreams,G.stats=U.stats}),T?P(u,T,T.startPTS,T.endPTS,T.startDTS,T.endDTS):f(h,u),L.length&&(u.totalduration=u.edge-L[0].start),u.driftStartTime=h.driftStartTime,u.driftStart=h.driftStart;var H=u.advancedDateTime;if(u.advanced&&H){var W=u.edge;u.driftStart||(u.driftStartTime=H,u.driftStart=W),u.driftEndTime=H,u.driftEnd=W}else u.driftEndTime=h.driftEndTime,u.driftEnd=h.driftEnd,u.advancedDateTime=h.advancedDateTime}function g(h,u,m){var y=D({},h);return m&&m.forEach(function(v){delete y[v]}),Object.keys(u).forEach(function(v){var c=new w.DateRange(u[v].attr,y[v]);c.isValid?y[v]=c:A.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(u[v].attr)+'"')}),y}function M(h,u,m){if(h&&u)for(var y=0,v=0,c=h.length;v<=c;v++){var a=h[v],T=u[v+y];a&&T&&a.index===T.index&&a.fragment.sn===T.fragment.sn?m(a,T):y--}}function S(h,u,m){for(var y=u.skippedSegments,v=Math.max(h.startSN,u.startSN)-u.startSN,c=(h.fragmentHint?1:0)+(y?u.endSN:Math.min(h.endSN,u.endSN))-u.startSN,a=u.startSN-h.startSN,T=u.fragmentHint?u.fragments.concat(u.fragmentHint):u.fragments,o=h.fragmentHint?h.fragments.concat(h.fragmentHint):h.fragments,_=v;_<=c;_++){var L=o[a+_],x=T[_];y&&!x&&_<y&&(x=u.fragments[_]=L),L&&x&&m(L,x)}}function f(h,u){var m=u.startSN+u.skippedSegments-h.startSN,y=h.fragments;m<0||m>=y.length||E(u,y[m].start)}function E(h,u){if(u){for(var m=h.fragments,y=h.skippedSegments;y<m.length;y++)m[y].start+=u;h.fragmentHint&&(h.fragmentHint.start+=u)}}function d(h,u){u===void 0&&(u=1/0);var m=1e3*h.targetduration;if(h.updated){var y=h.fragments,v=4;if(y.length&&m*v>u){var c=y[y.length-1].duration*1e3;c<m&&(m=c)}}else m/=2;return Math.round(m)}function l(h,u,m){if(!h||!h.details)return null;var y=h.details,v=y.fragments[u-y.startSN];return v||(v=y.fragmentHint,v&&v.sn===u)?v:u<y.startSN&&m&&m.sn===u?m:null}function b(h,u,m){if(!h||!h.details)return null;var y=h.details.partList;if(y)for(var v=y.length;v--;){var c=y[v];if(c.index===m&&c.fragment.sn===u)return c}return null}},"./src/controller/stream-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>u});var R=s("./src/polyfills/number.ts"),A=s("./src/controller/base-stream-controller.ts"),w=s("./src/is-supported.ts"),D=s("./src/events.ts"),K=s("./src/utils/buffer-helper.ts"),k=s("./src/controller/fragment-tracker.ts"),F=s("./src/types/loader.ts"),B=s("./src/loader/fragment.ts"),P=s("./src/demux/transmuxer-interface.ts"),N=s("./src/types/transmuxer.ts"),g=s("./src/controller/gap-controller.ts"),M=s("./src/errors.ts");function S(m,y){for(var v=0;v<y.length;v++){var c=y[v];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(m,E(c.key),c)}}function f(m,y,v){return y&&S(m.prototype,y),v&&S(m,v),Object.defineProperty(m,"prototype",{writable:!1}),m}function E(m){var y=d(m,"string");return typeof y=="symbol"?y:String(y)}function d(m,y){if(typeof m!="object"||m===null)return m;var v=m[Symbol.toPrimitive];if(v!==void 0){var c=v.call(m,y||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(m)}function l(m,y){m.prototype=Object.create(y.prototype),m.prototype.constructor=m,b(m,y)}function b(m,y){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,a){return c.__proto__=a,c},b(m,y)}var h=100,u=function(m){l(y,m);function y(c,a,T){var o;return o=m.call(this,c,a,T,"[stream-controller]")||this,o.audioCodecSwap=!1,o.gapController=null,o.level=-1,o._forceStartLoad=!1,o.altAudio=!1,o.audioOnly=!1,o.fragPlaying=null,o.onvplaying=null,o.onvseeked=null,o.fragLastKbps=0,o.couldBacktrack=!1,o.backtrackFragment=null,o.audioCodecSwitch=!1,o.videoBuffer=null,o._registerListeners(),o}var v=y.prototype;return v._registerListeners=function(){var a=this.hls;a.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),a.on(D.Events.ERROR,this.onError,this),a.on(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(D.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(D.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),a.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var a=this.hls;a.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),a.off(D.Events.ERROR,this.onError,this),a.off(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(D.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(D.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),a.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},v.startLoad=function(a){if(this.levels){var T=this.lastCurrentTime,o=this.hls;if(this.stopLoad(),this.setInterval(h),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var _=o.startLevel;_===-1&&(o.config.testBandwidth&&this.levels.length>1?(_=0,this.bitrateTest=!0):_=o.nextAutoLevel),this.level=o.nextLoadLevel=_,this.loadedmetadata=!1}T>0&&a===-1&&(this.log("Override startPosition with lastCurrentTime @"+T.toFixed(3)),a=T),this.state=A.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this._forceStartLoad=!0,this.state=A.State.STOPPED},v.stopLoad=function(){this._forceStartLoad=!1,m.prototype.stopLoad.call(this)},v.doTick=function(){switch(this.state){case A.State.IDLE:this.doTickIdle();break;case A.State.WAITING_LEVEL:{var a,T=this.levels,o=this.level,_=T==null||(a=T[o])===null||a===void 0?void 0:a.details;if(_&&(!_.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(_))break;this.state=A.State.IDLE;break}break}case A.State.FRAG_LOADING_WAITING_RETRY:{var L,x=self.performance.now(),H=this.retryDate;(!H||x>=H||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=A.State.IDLE)}break}this.onTickEnd()},v.onTickEnd=function(){m.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},v.doTickIdle=function(){var a=this.hls,T=this.levelLastLoaded,o=this.levels,_=this.media,L=a.config,x=a.nextLoadLevel;if(!(T===null||!_&&(this.startFragRequested||!L.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!o||!o[x])){var H=o[x],W=this.getMainFwdBufferInfo();if(W!==null){var U=this.getLevelDetails();if(U&&this._streamEnded(W,U)){var G={};this.altAudio&&(G.type="video"),this.hls.trigger(D.Events.BUFFER_EOS,G),this.state=A.State.ENDED;return}this.level=a.nextLoadLevel=x;var Y=H.details;if(!Y||this.state===A.State.WAITING_LEVEL||Y.live&&this.levelLastLoaded!==x){this.level=x,this.state=A.State.WAITING_LEVEL;return}var j=W.len,X=this.getMaxBufferLength(H.maxBitrate);if(!(j>=X)){this.backtrackFragment&&this.backtrackFragment.start>W.end&&(this.backtrackFragment=null);var q=this.backtrackFragment?this.backtrackFragment.start:W.end,J=this.getNextFragment(q,Y);if(this.couldBacktrack&&!this.fragPrevious&&J&&J.sn!=="initSegment"&&this.fragmentTracker.getState(J)!==k.FragmentState.OK){var V,Q=((V=this.backtrackFragment)!=null?V:J).sn,ee=Q-Y.startSN,Z=Y.fragments[ee-1];Z&&J.cc===Z.cc&&(J=Z,this.fragmentTracker.removeFragment(Z))}else this.backtrackFragment&&W.len&&(this.backtrackFragment=null);if(J&&this.fragmentTracker.getState(J)===k.FragmentState.OK&&this.nextLoadPosition>q){var re=this.audioOnly&&!this.altAudio?B.ElementaryStreamTypes.AUDIO:B.ElementaryStreamTypes.VIDEO,ae=(re===B.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;ae&&this.afterBufferFlushed(ae,re,F.PlaylistLevelType.MAIN),J=this.getNextFragment(this.nextLoadPosition,Y)}J&&(J.initSegment&&!J.initSegment.data&&!this.bitrateTest&&(J=J.initSegment),this.loadFragment(J,Y,q))}}}},v.loadFragment=function(a,T,o){var _,L=this.fragmentTracker.getState(a);this.fragCurrent=a,L===k.FragmentState.NOT_LOADED?a.sn==="initSegment"?this._loadInitSegment(a,T):this.bitrateTest?(this.log("Fragment "+a.sn+" of level "+a.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(a,T)):(this.startFragRequested=!0,m.prototype.loadFragment.call(this,a,T,o)):L===k.FragmentState.APPENDING?this.reduceMaxBufferLength(a.duration)&&this.fragmentTracker.removeFragment(a):((_=this.media)===null||_===void 0?void 0:_.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},v.getAppendedFrag=function(a){var T=this.fragmentTracker.getAppendedFrag(a,F.PlaylistLevelType.MAIN);return T&&"fragment"in T?T.fragment:T},v.getBufferedFrag=function(a){return this.fragmentTracker.getBufferedFrag(a,F.PlaylistLevelType.MAIN)},v.followingBufferedFrag=function(a){return a?this.getBufferedFrag(a.end+.5):null},v.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},v.nextLevelSwitch=function(){var a=this.levels,T=this.media;if(T!=null&&T.readyState){var o,_=this.getAppendedFrag(T.currentTime);if(_&&_.start>1&&this.flushMainBuffer(0,_.start-1),!T.paused&&a){var L=this.hls.nextLoadLevel,x=a[L],H=this.fragLastKbps;H&&this.fragCurrent?o=this.fragCurrent.duration*x.maxBitrate/(1e3*H)+1:o=0}else o=0;var W=this.getBufferedFrag(T.currentTime+o);if(W){var U=this.followingBufferedFrag(W);if(U){this.abortCurrentFrag();var G=U.maxStartPTS?U.maxStartPTS:U.start,Y=U.duration,j=Math.max(W.end,G+Math.min(Math.max(Y-this.config.maxFragLookUpTolerance,Y*.5),Y*.75));this.flushMainBuffer(j,Number.POSITIVE_INFINITY)}}}},v.abortCurrentFrag=function(){var a=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,a&&a.abortRequests(),this.state){case A.State.KEY_LOADING:case A.State.FRAG_LOADING:case A.State.FRAG_LOADING_WAITING_RETRY:case A.State.PARSING:case A.State.PARSED:this.state=A.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},v.flushMainBuffer=function(a,T){m.prototype.flushMainBuffer.call(this,a,T,this.altAudio?"video":null)},v.onMediaAttached=function(a,T){m.prototype.onMediaAttached.call(this,a,T);var o=T.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),o.addEventListener("playing",this.onvplaying),o.addEventListener("seeked",this.onvseeked),this.gapController=new g.default(this.config,o,this.fragmentTracker,this.hls)},v.onMediaDetaching=function(){var a=this.media;a&&this.onvplaying&&this.onvseeked&&(a.removeEventListener("playing",this.onvplaying),a.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),m.prototype.onMediaDetaching.call(this)},v.onMediaPlaying=function(){this.tick()},v.onMediaSeeked=function(){var a=this.media,T=a?a.currentTime:null;(0,R.isFiniteNumber)(T)&&this.log("Media seeked to "+T.toFixed(3)),this.tick()},v.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(D.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},v.onManifestParsed=function(a,T){var o=!1,_=!1,L;T.levels.forEach(function(x){L=x.audioCodec,L&&(L.indexOf("mp4a.40.2")!==-1&&(o=!0),L.indexOf("mp4a.40.5")!==-1&&(_=!0))}),this.audioCodecSwitch=o&&_&&!(0,w.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=T.levels,this.startFragRequested=!1},v.onLevelLoading=function(a,T){var o=this.levels;if(!(!o||this.state!==A.State.IDLE)){var _=o[T.level];(!_.details||_.details.live&&this.levelLastLoaded!==T.level||this.waitForCdnTuneIn(_.details))&&(this.state=A.State.WAITING_LEVEL)}},v.onLevelLoaded=function(a,T){var o,_=this.levels,L=T.level,x=T.details,H=x.totalduration;if(!_){this.warn("Levels were reset while loading level "+L);return}this.log("Level "+L+" loaded ["+x.startSN+","+x.endSN+"], cc ["+x.startCC+", "+x.endCC+"] duration:"+H);var W=this.fragCurrent;W&&(this.state===A.State.FRAG_LOADING||this.state===A.State.FRAG_LOADING_WAITING_RETRY)&&W.level!==T.level&&W.loader&&(this.state=A.State.IDLE,this.backtrackFragment=null,W.abortRequests());var U=_[L],G=0;if(x.live||(o=U.details)!==null&&o!==void 0&&o.live){if(x.fragments[0]||(x.deltaUpdateFailed=!0),x.deltaUpdateFailed)return;G=this.alignPlaylists(x,U.details)}if(U.details=x,this.levelLastLoaded=L,this.hls.trigger(D.Events.LEVEL_UPDATED,{details:x,level:L}),this.state===A.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(x))return;this.state=A.State.IDLE}this.startFragRequested?x.live&&this.synchronizeToLiveEdge(x):this.setStartPosition(x,G),this.tick()},v._handleFragmentLoadProgress=function(a){var T,o=a.frag,_=a.part,L=a.payload,x=this.levels;if(!x){this.warn("Levels were reset while fragment load was in progress. Fragment "+o.sn+" of level "+o.level+" will not be buffered");return}var H=x[o.level],W=H.details;if(!W){this.warn("Dropping fragment "+o.sn+" of level "+o.level+" after level details were reset");return}var U=H.videoCodec,G=W.PTSKnown||!W.live,Y=(T=o.initSegment)===null||T===void 0?void 0:T.data,j=this._getAudioCodec(H),X=this.transmuxer=this.transmuxer||new P.default(this.hls,F.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),q=_?_.index:-1,J=q!==-1,V=new N.ChunkMetadata(o.level,o.sn,o.stats.chunkCount,L.byteLength,q,J),Q=this.initPTS[o.cc];X.push(L,Y,j,U,o,_,W.totalduration,G,V,Q)},v.onAudioTrackSwitching=function(a,T){var o=this.altAudio,_=!!T.url,L=T.id;if(!_){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var x=this.fragCurrent;x&&(this.log("Switching to main audio track, cancel main fragment load"),x.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var H=this.hls;o&&H.trigger(D.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),H.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:L})}},v.onAudioTrackSwitched=function(a,T){var o=T.id,_=!!this.hls.audioTracks[o].url;if(_){var L=this.videoBuffer;L&&this.mediaBuffer!==L&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=L)}this.altAudio=_,this.tick()},v.onBufferCreated=function(a,T){var o=T.tracks,_,L,x=!1;for(var H in o){var W=o[H];if(W.id==="main"){if(L=H,_=W,H==="video"){var U=o[H];U&&(this.videoBuffer=U.buffer)}}else x=!0}x&&_?(this.log("Alternate track found, use "+L+".buffered to schedule main fragment loading"),this.mediaBuffer=_.buffer):this.mediaBuffer=this.media},v.onFragBuffered=function(a,T){var o=T.frag,_=T.part;if(!(o&&o.type!==F.PlaylistLevelType.MAIN)){if(this.fragContextChanged(o)){this.warn("Fragment "+o.sn+(_?" p: "+_.index:"")+" of level "+o.level+" finished buffering, but was aborted. state: "+this.state),this.state===A.State.PARSED&&(this.state=A.State.IDLE);return}var L=_?_.stats:o.stats;this.fragLastKbps=Math.round(8*L.total/(L.buffering.end-L.loading.first)),o.sn!=="initSegment"&&(this.fragPrevious=o),this.fragBufferedComplete(o,_)}},v.onError=function(a,T){if(T.type===M.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(F.PlaylistLevelType.MAIN,T);return}switch(T.details){case M.ErrorDetails.FRAG_LOAD_ERROR:case M.ErrorDetails.FRAG_LOAD_TIMEOUT:case M.ErrorDetails.FRAG_PARSING_ERROR:case M.ErrorDetails.KEY_LOAD_ERROR:case M.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(F.PlaylistLevelType.MAIN,T);break;case M.ErrorDetails.LEVEL_LOAD_ERROR:case M.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==A.State.ERROR&&(T.fatal?(this.warn(""+T.details),this.state=A.State.ERROR):!T.levelRetry&&this.state===A.State.WAITING_LEVEL&&(this.state=A.State.IDLE));break;case M.ErrorDetails.BUFFER_FULL_ERROR:if(T.parent==="main"&&(this.state===A.State.PARSING||this.state===A.State.PARSED)){var o=!0,_=this.getFwdBufferInfo(this.media,F.PlaylistLevelType.MAIN);_&&_.len>.5&&(o=!this.reduceMaxBufferLength(_.len)),o&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},v.checkBuffer=function(){var a=this.media,T=this.gapController;if(!(!a||!T||!a.readyState)){if(this.loadedmetadata||!K.BufferHelper.getBuffered(a).length){var o=this.state!==A.State.IDLE?this.fragCurrent:null;T.poll(this.lastCurrentTime,o)}this.lastCurrentTime=a.currentTime}},v.onFragLoadEmergencyAborted=function(){this.state=A.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},v.onBufferFlushed=function(a,T){var o=T.type;if(o!==B.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var _=(o===B.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(_,o,F.PlaylistLevelType.MAIN)}},v.onLevelsUpdated=function(a,T){this.levels=T.levels},v.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},v.seekToStartPos=function(){var a=this.media;if(a){var T=a.currentTime,o=this.startPosition;if(o>=0&&T<o){if(a.seeking){this.log("could not seek to "+o+", already seeking at "+T);return}var _=K.BufferHelper.getBuffered(a),L=_.length?_.start(0):0,x=L-o;x>0&&(x<this.config.maxBufferHole||x<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+x+" to match buffer start"),o+=x,this.startPosition=o),this.log("seek to target start position "+o+" from current time "+T),a.currentTime=o}}},v._getAudioCodec=function(a){var T=this.config.defaultAudioCodec||a.audioCodec;return this.audioCodecSwap&&T&&(this.log("Swapping audio codec"),T.indexOf("mp4a.40.5")!==-1?T="mp4a.40.2":T="mp4a.40.5"),T},v._loadBitrateTestFrag=function(a,T){var o=this;a.bitrateTest=!0,this._doFragLoad(a,T).then(function(_){var L=o.hls;if(!(!_||L.nextLoadLevel||o.fragContextChanged(a))){o.fragLoadError=0,o.state=A.State.IDLE,o.startFragRequested=!1,o.bitrateTest=!1;var x=a.stats;x.parsing.start=x.parsing.end=x.buffering.start=x.buffering.end=self.performance.now(),L.trigger(D.Events.FRAG_LOADED,_),a.bitrateTest=!1}})},v._handleTransmuxComplete=function(a){var T,o="main",_=this.hls,L=a.remuxResult,x=a.chunkMeta,H=this.getCurrentContext(x);if(!H){this.warn("The loading context changed while buffering fragment "+x.sn+" of level "+x.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(x.level);return}var W=H.frag,U=H.part,G=H.level,Y=L.video,j=L.text,X=L.id3,q=L.initSegment,J=G.details,V=this.altAudio?void 0:L.audio;if(!this.fragContextChanged(W)){if(this.state=A.State.PARSING,q){q.tracks&&(this._bufferInitSegment(G,q.tracks,W,x),_.trigger(D.Events.FRAG_PARSING_INIT_SEGMENT,{frag:W,id:o,tracks:q.tracks}));var Q=q.initPTS,ee=q.timescale;(0,R.isFiniteNumber)(Q)&&(this.initPTS[W.cc]=Q,_.trigger(D.Events.INIT_PTS_FOUND,{frag:W,id:o,initPTS:Q,timescale:ee}))}if(Y&&L.independent!==!1){if(J){var Z=Y.startPTS,re=Y.endPTS,ae=Y.startDTS,le=Y.endDTS;if(U)U.elementaryStreams[Y.type]={startPTS:Z,endPTS:re,startDTS:ae,endDTS:le};else if(Y.firstKeyFrame&&Y.independent&&x.id===1&&(this.couldBacktrack=!0),Y.dropped&&Y.independent){var ne=this.getMainFwdBufferInfo(),ie=(ne?ne.end:this.getLoadPosition())+this.config.maxBufferHole,oe=Y.firstKeyFramePTS?Y.firstKeyFramePTS:Z;if(ie<oe-this.config.maxBufferHole){this.backtrack(W);return}W.setElementaryStreamInfo(Y.type,W.start,re,W.start,le,!0)}W.setElementaryStreamInfo(Y.type,Z,re,ae,le),this.backtrackFragment&&(this.backtrackFragment=W),this.bufferFragmentData(Y,W,U,x)}}else if(L.independent===!1){this.backtrack(W);return}if(V){var ge=V.startPTS,he=V.endPTS,me=V.startDTS,Ee=V.endDTS;U&&(U.elementaryStreams[B.ElementaryStreamTypes.AUDIO]={startPTS:ge,endPTS:he,startDTS:me,endDTS:Ee}),W.setElementaryStreamInfo(B.ElementaryStreamTypes.AUDIO,ge,he,me,Ee),this.bufferFragmentData(V,W,U,x)}if(J&&X!==null&&X!==void 0&&(T=X.samples)!==null&&T!==void 0&&T.length){var pe={id:o,frag:W,details:J,samples:X.samples};_.trigger(D.Events.FRAG_PARSING_METADATA,pe)}if(J&&j){var Te={id:o,frag:W,details:J,samples:j.samples};_.trigger(D.Events.FRAG_PARSING_USERDATA,Te)}}},v._bufferInitSegment=function(a,T,o,_){var L=this;if(this.state===A.State.PARSING){this.audioOnly=!!T.audio&&!T.video,this.altAudio&&!this.audioOnly&&delete T.audio;var x=T.audio,H=T.video,W=T.audiovideo;if(x){var U=a.audioCodec,G=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(U&&(U.indexOf("mp4a.40.5")!==-1?U="mp4a.40.2":U="mp4a.40.5"),x.metadata.channelCount!==1&&G.indexOf("firefox")===-1&&(U="mp4a.40.5")),G.indexOf("android")!==-1&&x.container!=="audio/mpeg"&&(U="mp4a.40.2",this.log("Android: force audio codec to "+U)),a.audioCodec&&a.audioCodec!==U&&this.log('Swapping manifest audio codec "'+a.audioCodec+'" for "'+U+'"'),x.levelCodec=U,x.id="main",this.log("Init audio buffer, container:"+x.container+", codecs[selected/level/parsed]=["+(U||"")+"/"+(a.audioCodec||"")+"/"+x.codec+"]")}H&&(H.levelCodec=a.videoCodec,H.id="main",this.log("Init video buffer, container:"+H.container+", codecs[level/parsed]=["+(a.videoCodec||"")+"/"+H.codec+"]")),W&&this.log("Init audiovideo buffer, container:"+W.container+", codecs[level/parsed]=["+(a.attrs.CODECS||"")+"/"+W.codec+"]"),this.hls.trigger(D.Events.BUFFER_CODECS,T),Object.keys(T).forEach(function(Y){var j=T[Y],X=j.initSegment;X!=null&&X.byteLength&&L.hls.trigger(D.Events.BUFFER_APPENDING,{type:Y,data:X,frag:o,part:null,chunkMeta:_,parent:o.type})}),this.tick()}},v.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,F.PlaylistLevelType.MAIN)},v.backtrack=function(a){this.couldBacktrack=!0,this.backtrackFragment=a,this.resetTransmuxer(),this.flushBufferGap(a),this.fragmentTracker.removeFragment(a),this.fragPrevious=null,this.nextLoadPosition=a.start,this.state=A.State.IDLE},v.checkFragmentChanged=function(){var a=this.media,T=null;if(a&&a.readyState>1&&a.seeking===!1){var o=a.currentTime;if(K.BufferHelper.isBuffered(a,o)?T=this.getAppendedFrag(o):K.BufferHelper.isBuffered(a,o+.1)&&(T=this.getAppendedFrag(o+.1)),T){this.backtrackFragment=null;var _=this.fragPlaying,L=T.level;(!_||T.sn!==_.sn||_.level!==L||T.urlId!==_.urlId)&&(this.fragPlaying=T,this.hls.trigger(D.Events.FRAG_CHANGED,{frag:T}),(!_||_.level!==L)&&this.hls.trigger(D.Events.LEVEL_SWITCHED,{level:L}))}}},f(y,[{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"currentFrag",get:function(){var a=this.media;return a?this.fragPlaying||this.getAppendedFrag(a.currentTime):null}},{key:"currentProgramDateTime",get:function(){var a=this.media;if(a){var T=a.currentTime,o=this.currentFrag;if(o&&(0,R.isFiniteNumber)(T)&&(0,R.isFiniteNumber)(o.programDateTime)){var _=o.programDateTime+(T-o.start)*1e3;return new Date(_)}}return null}},{key:"currentLevel",get:function(){var a=this.currentFrag;return a?a.level:-1}},{key:"nextBufferedFrag",get:function(){var a=this.currentFrag;return a?this.followingBufferedFrag(a):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),y}(A.default)},"./src/controller/subtitle-stream-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{SubtitleStreamController:()=>l});var R=s("./src/events.ts"),A=s("./src/utils/buffer-helper.ts"),w=s("./src/controller/fragment-finders.ts"),D=s("./src/utils/discontinuities.ts"),K=s("./src/controller/level-helper.ts"),k=s("./src/controller/fragment-tracker.ts"),F=s("./src/controller/base-stream-controller.ts"),B=s("./src/types/loader.ts"),P=s("./src/types/level.ts");function N(h,u){for(var m=0;m<u.length;m++){var y=u[m];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(h,M(y.key),y)}}function g(h,u,m){return u&&N(h.prototype,u),m&&N(h,m),Object.defineProperty(h,"prototype",{writable:!1}),h}function M(h){var u=S(h,"string");return typeof u=="symbol"?u:String(u)}function S(h,u){if(typeof h!="object"||h===null)return h;var m=h[Symbol.toPrimitive];if(m!==void 0){var y=m.call(h,u||"default");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(h)}function f(h,u){h.prototype=Object.create(u.prototype),h.prototype.constructor=h,E(h,u)}function E(h,u){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,v){return y.__proto__=v,y},E(h,u)}var d=500,l=function(h){f(u,h);function u(y,v,c){var a;return a=h.call(this,y,v,c,"[subtitle-stream-controller]")||this,a.levels=[],a.currentTrackId=-1,a.tracksBuffered=[],a.mainDetails=null,a._registerListeners(),a}var m=u.prototype;return m.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},m._registerListeners=function(){var v=this.hls;v.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(R.Events.ERROR,this.onError,this),v.on(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.on(R.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.on(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.on(R.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),v.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m._unregisterListeners=function(){var v=this.hls;v.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(R.Events.ERROR,this.onError,this),v.off(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.off(R.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.off(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.off(R.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),v.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m.startLoad=function(v){this.stopLoad(),this.state=F.State.IDLE,this.setInterval(d),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=v,this.tick()},m.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},m.onLevelLoaded=function(v,c){this.mainDetails=c.details},m.onSubtitleFragProcessed=function(v,c){var a=c.frag,T=c.success;if(this.fragPrevious=a,this.state=F.State.IDLE,!!T){var o=this.tracksBuffered[this.currentTrackId];if(o){for(var _,L=a.start,x=0;x<o.length;x++)if(L>=o[x].start&&L<=o[x].end){_=o[x];break}var H=a.start+a.duration;_?_.end=H:(_={start:L,end:H},o.push(_)),this.fragmentTracker.fragBuffered(a)}}},m.onBufferFlushing=function(v,c){var a=c.startOffset,T=c.endOffset;if(a===0&&T!==Number.POSITIVE_INFINITY){var o=this.currentTrackId,_=this.levels;if(!_.length||!_[o]||!_[o].details)return;var L=_[o].details,x=L.targetduration,H=T-x;if(H<=0)return;c.endOffsetSubtitles=Math.max(0,H),this.tracksBuffered.forEach(function(W){for(var U=0;U<W.length;){if(W[U].end<=H){W.shift();continue}else if(W[U].start<H)W[U].start=H;else break;U++}}),this.fragmentTracker.removeFragmentsInRange(a,H,B.PlaylistLevelType.SUBTITLE)}},m.onFragBuffered=function(v,c){if(!this.loadedmetadata&&c.frag.type===B.PlaylistLevelType.MAIN){var a;(a=this.media)!==null&&a!==void 0&&a.buffered.length&&(this.loadedmetadata=!0)}},m.onError=function(v,c){var a=c.frag;!a||a.type!==B.PlaylistLevelType.SUBTITLE||(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=F.State.IDLE)},m.onSubtitleTracksUpdated=function(v,c){var a=this,T=c.subtitleTracks;this.tracksBuffered=[],this.levels=T.map(function(o){return new P.Level(o)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(o){a.tracksBuffered[o.id]=[]}),this.mediaBuffer=null},m.onSubtitleTrackSwitch=function(v,c){if(this.currentTrackId=c.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var a=this.levels[this.currentTrackId];a!=null&&a.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,a&&this.setInterval(d)},m.onSubtitleTrackLoaded=function(v,c){var a,T=c.details,o=c.id,_=this.currentTrackId,L=this.levels;if(L.length){var x=L[_];if(!(o>=L.length||o!==_||!x)){this.mediaBuffer=this.mediaBufferTimeRanges;var H=0;if(T.live||(a=x.details)!==null&&a!==void 0&&a.live){var W=this.mainDetails;if(T.deltaUpdateFailed||!W)return;var U=W.fragments[0];x.details?(H=this.alignPlaylists(T,x.details),H===0&&U&&(H=U.start,(0,K.addSliding)(T,H))):T.hasProgramDateTime&&W.hasProgramDateTime?((0,D.alignMediaPlaylistByPDT)(T,W),H=T.fragments[0].start):U&&(H=U.start,(0,K.addSliding)(T,H))}if(x.details=T,this.levelLastLoaded=o,!this.startFragRequested&&(this.mainDetails||!T.live)&&this.setStartPosition(x.details,H),this.tick(),T.live&&!this.fragCurrent&&this.media&&this.state===F.State.IDLE){var G=(0,w.findFragmentByPTS)(null,T.fragments,this.media.currentTime,0);G||(this.warn("Subtitle playlist not aligned with playback"),x.details=void 0)}}}},m._handleFragmentLoadComplete=function(v){var c=this,a=v.frag,T=v.payload,o=a.decryptdata,_=this.hls;if(!this.fragContextChanged(a)&&T&&T.byteLength>0&&o&&o.key&&o.iv&&o.method==="AES-128"){var L=performance.now();this.decrypter.decrypt(new Uint8Array(T),o.key.buffer,o.iv.buffer).then(function(x){var H=performance.now();_.trigger(R.Events.FRAG_DECRYPTED,{frag:a,payload:x,stats:{tstart:L,tdecrypt:H}})}).catch(function(x){c.warn(x.name+": "+x.message),c.state=F.State.IDLE})}},m.doTick=function(){if(!this.media){this.state=F.State.IDLE;return}if(this.state===F.State.IDLE){var v=this.currentTrackId,c=this.levels;if(!c.length||!c[v]||!c[v].details)return;var a=c[v].details,T=a.targetduration,o=this.config,_=this.getLoadPosition(),L=A.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],_-T,o.maxBufferHole),x=L.end,H=L.len,W=this.getFwdBufferInfo(this.media,B.PlaylistLevelType.MAIN),U=this.getMaxBufferLength(W==null?void 0:W.len)+T;if(H>U)return;console.assert(a,"Subtitle track details are defined on idle subtitle stream controller tick");var G=a.fragments,Y=G.length,j=a.edge,X=null,q=this.fragPrevious;if(x<j){var J=o.maxFragLookUpTolerance;X=(0,w.findFragmentByPTS)(q,G,Math.max(G[0].start,x),J),!X&&q&&q.start<G[0].start&&(X=G[0])}else X=G[Y-1];if(!X)return;X=this.mapToInitFragWhenRequired(X),this.fragmentTracker.getState(X)===k.FragmentState.NOT_LOADED&&this.loadFragment(X,a,x)}},m.getMaxBufferLength=function(v){var c=h.prototype.getMaxBufferLength.call(this);return v?Math.max(c,v):c},m.loadFragment=function(v,c,a){this.fragCurrent=v,v.sn==="initSegment"?this._loadInitSegment(v,c):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,v,c,a))},g(u,[{key:"mediaBufferTimeRanges",get:function(){return new b(this.tracksBuffered[this.currentTrackId]||[])}}]),u}(F.default),b=function(u){this.buffered=void 0;var m=function(v,c,a){if(c=c>>>0,c>a-1)throw new DOMException("Failed to execute '"+v+"' on 'TimeRanges': The index provided ("+c+") is greater than the maximum bound ("+a+")");return u[c][v]};this.buffered={get length(){return u.length},end:function(v){return m("end",v,u.length)},start:function(v){return m("start",v,u.length)}}}},"./src/controller/subtitle-track-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>S});var R=s("./src/events.ts"),A=s("./src/utils/texttrack-utils.ts"),w=s("./src/controller/base-playlist-controller.ts"),D=s("./src/types/loader.ts");function K(f,E){for(var d=0;d<E.length;d++){var l=E[d];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(f,F(l.key),l)}}function k(f,E,d){return E&&K(f.prototype,E),d&&K(f,d),Object.defineProperty(f,"prototype",{writable:!1}),f}function F(f){var E=B(f,"string");return typeof E=="symbol"?E:String(E)}function B(f,E){if(typeof f!="object"||f===null)return f;var d=f[Symbol.toPrimitive];if(d!==void 0){var l=d.call(f,E||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(E==="string"?String:Number)(f)}function P(f,E){f.prototype=Object.create(E.prototype),f.prototype.constructor=f,N(f,E)}function N(f,E){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,b){return l.__proto__=b,l},N(f,E)}var g=function(f){P(E,f);function E(l){var b;return b=f.call(this,l,"[subtitle-track-controller]")||this,b.media=null,b.tracks=[],b.groupId=null,b.tracksInGroup=[],b.trackId=-1,b.selectDefaultTrack=!0,b.queuedDefaultTrack=-1,b.trackChangeListener=function(){return b.onTextTracksChanged()},b.asyncPollTrackChange=function(){return b.pollTrackChange(0)},b.useTextTrackPolling=!1,b.subtitlePollingInterval=-1,b._subtitleDisplay=!0,b.registerListeners(),b}var d=E.prototype;return d.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,f.prototype.destroy.call(this)},d.registerListeners=function(){var b=this.hls;b.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),b.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),b.on(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),b.on(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),b.on(R.Events.ERROR,this.onError,this)},d.unregisterListeners=function(){var b=this.hls;b.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),b.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),b.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),b.off(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),b.off(R.Events.ERROR,this.onError,this)},d.onMediaAttached=function(b,h){this.media=h.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},d.pollTrackChange=function(b){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,b)},d.onMediaDetaching=function(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var b=M(this.media.textTracks);b.forEach(function(h){(0,A.clearCurrentCues)(h)}),this.subtitleTrack=-1,this.media=null}},d.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},d.onManifestParsed=function(b,h){this.tracks=h.subtitleTracks},d.onSubtitleTrackLoaded=function(b,h){var u=h.id,m=h.details,y=this.trackId,v=this.tracksInGroup[y];if(!v){this.warn("Invalid subtitle track id "+u);return}var c=v.details;v.details=h.details,this.log("subtitle track "+u+" loaded ["+m.startSN+"-"+m.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,h,c))},d.onLevelLoading=function(b,h){this.switchLevel(h.level)},d.onLevelSwitching=function(b,h){this.switchLevel(h.level)},d.switchLevel=function(b){var h=this.hls.levels[b];if(h!=null&&h.textGroupIds){var u=h.textGroupIds[h.urlId];if(this.groupId!==u){var m=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,y=this.tracks.filter(function(a){return!u||a.groupId===u});this.tracksInGroup=y;var v=this.findTrackId(m==null?void 0:m.name)||this.findTrackId();this.groupId=u;var c={subtitleTracks:y};this.log("Updating subtitle tracks, "+y.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(R.Events.SUBTITLE_TRACKS_UPDATED,c),v!==-1&&this.setSubtitleTrack(v,m)}}},d.findTrackId=function(b){for(var h=this.tracksInGroup,u=0;u<h.length;u++){var m=h[u];if((!this.selectDefaultTrack||m.default)&&(!b||b===m.name))return m.id}return-1},d.onError=function(b,h){f.prototype.onError.call(this,b,h),!(h.fatal||!h.context)&&h.context.type===D.PlaylistContextType.SUBTITLE_TRACK&&h.context.id===this.trackId&&h.context.groupId===this.groupId&&this.retryLoadingOrFail(h)},d.loadPlaylist=function(b){f.prototype.loadPlaylist.call(this);var h=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(h)){var u=h.id,m=h.groupId,y=h.url;if(b)try{y=b.addDirectives(y)}catch(v){this.warn("Could not construct new URL with HLS Delivery Directives: "+v)}this.log("Loading subtitle playlist for id "+u),this.hls.trigger(R.Events.SUBTITLE_TRACK_LOADING,{url:y,id:u,groupId:m,deliveryDirectives:b||null})}},d.toggleTrackModes=function(b){var h=this,u=this.media,m=this.trackId;if(u){var y=M(u.textTracks),v=y.filter(function(T){return T.groupId===h.groupId});if(b===-1)[].slice.call(y).forEach(function(T){T.mode="disabled"});else{var c=v[m];c&&(c.mode="disabled")}var a=v[b];a&&(a.mode=this.subtitleDisplay?"showing":"hidden")}},d.setSubtitleTrack=function(b,h){var u,m=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=b;return}if(this.trackId!==b&&this.toggleTrackModes(b),!(this.trackId===b&&(b===-1||(u=m[b])!==null&&u!==void 0&&u.details)||b<-1||b>=m.length)){this.clearTimer();var y=m[b];if(this.log("Switching to subtitle track "+b),this.trackId=b,y){var v=y.id,c=y.groupId,a=c===void 0?"":c,T=y.name,o=y.type,_=y.url;this.hls.trigger(R.Events.SUBTITLE_TRACK_SWITCH,{id:v,groupId:a,name:T,type:o,url:_});var L=this.switchParams(y.url,h==null?void 0:h.details);this.loadPlaylist(L)}else this.hls.trigger(R.Events.SUBTITLE_TRACK_SWITCH,{id:b})}},d.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var b=-1,h=M(this.media.textTracks),u=0;u<h.length;u++)if(h[u].mode==="hidden")b=u;else if(h[u].mode==="showing"){b=u;break}this.subtitleTrack!==b&&(this.subtitleTrack=b)}},k(E,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(b){this._subtitleDisplay=b,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(b){this.selectDefaultTrack=!1;var h=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(b,h)}}]),E}(w.default);function M(f){for(var E=[],d=0;d<f.length;d++){var l=f[d];l.kind==="subtitles"&&l.label&&E.push(f[d])}return E}const S=g},"./src/controller/timeline-controller.ts":(O,I,s)=>{s.r(I),s.d(I,{TimelineController:()=>g});var R=s("./src/polyfills/number.ts"),A=s("./src/events.ts"),w=s("./src/utils/cea-608-parser.ts"),D=s("./src/utils/output-filter.ts"),K=s("./src/utils/webvtt-parser.ts"),k=s("./src/utils/texttrack-utils.ts"),F=s("./src/utils/imsc1-ttml-parser.ts"),B=s("./src/utils/mp4-tools.ts"),P=s("./src/types/loader.ts"),N=s("./src/utils/logger.ts"),g=function(){function E(l){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=f(),this.captionsProperties=void 0,this.hls=l,this.config=l.config,this.Cues=l.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var b=new D.default(this,"textTrack1"),h=new D.default(this,"textTrack2"),u=new D.default(this,"textTrack3"),m=new D.default(this,"textTrack4");this.cea608Parser1=new w.default(1,b,h),this.cea608Parser2=new w.default(3,u,m)}l.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),l.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.on(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.on(A.Events.FRAG_LOADING,this.onFragLoading,this),l.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(A.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),l.on(A.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),l.on(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),l.on(A.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),l.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var d=E.prototype;return d.destroy=function(){var b=this.hls;b.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),b.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.off(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),b.off(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),b.off(A.Events.FRAG_LOADING,this.onFragLoading,this),b.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),b.off(A.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),b.off(A.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),b.off(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),b.off(A.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),b.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},d.addCues=function(b,h,u,m,y){for(var v=!1,c=y.length;c--;){var a=y[c],T=S(a[0],a[1],h,u);if(T>=0&&(a[0]=Math.min(a[0],h),a[1]=Math.max(a[1],u),v=!0,T/(u-h)>.5))return}if(v||y.push([h,u]),this.config.renderTextTracksNatively){var o=this.captionsTracks[b];this.Cues.newCue(o,h,u,m)}else{var _=this.Cues.newCue(null,h,u,m);this.hls.trigger(A.Events.CUES_PARSED,{type:"captions",cues:_,track:b})}},d.onInitPtsFound=function(b,h){var u=this,m=h.frag,y=h.id,v=h.initPTS,c=h.timescale,a=this.unparsedVttFrags;y==="main"&&(this.initPTS[m.cc]=v,this.timescale[m.cc]=c),a.length&&(this.unparsedVttFrags=[],a.forEach(function(T){u.onFragLoaded(A.Events.FRAG_LOADED,T)}))},d.getExistingTrack=function(b){var h=this.media;if(h)for(var u=0;u<h.textTracks.length;u++){var m=h.textTracks[u];if(m[b])return m}return null},d.createCaptionsTrack=function(b){this.config.renderTextTracksNatively?this.createNativeTrack(b):this.createNonNativeTrack(b)},d.createNativeTrack=function(b){if(!this.captionsTracks[b]){var h=this.captionsProperties,u=this.captionsTracks,m=this.media,y=h[b],v=y.label,c=y.languageCode,a=this.getExistingTrack(b);if(a)u[b]=a,(0,k.clearCurrentCues)(u[b]),(0,k.sendAddTrackEvent)(u[b],m);else{var T=this.createTextTrack("captions",v,c);T&&(T[b]=!0,u[b]=T)}}},d.createNonNativeTrack=function(b){if(!this.nonNativeCaptionsTracks[b]){var h=this.captionsProperties[b];if(h){var u=h.label,m={_id:b,label:u,kind:"captions",default:h.media?!!h.media.default:!1,closedCaptions:h.media};this.nonNativeCaptionsTracks[b]=m,this.hls.trigger(A.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[m]})}}},d.createTextTrack=function(b,h,u){var m=this.media;if(m)return m.addTextTrack(b,h,u)},d.onMediaAttaching=function(b,h){this.media=h.media,this._cleanTracks()},d.onMediaDetaching=function(){var b=this.captionsTracks;Object.keys(b).forEach(function(h){(0,k.clearCurrentCues)(b[h]),delete b[h]}),this.nonNativeCaptionsTracks={}},d.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=f(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},d._cleanTracks=function(){var b=this.media;if(b){var h=b.textTracks;if(h)for(var u=0;u<h.length;u++)(0,k.clearCurrentCues)(h[u])}},d.onSubtitleTracksUpdated=function(b,h){var u=this;this.textTracks=[];var m=h.subtitleTracks||[],y=m.some(function(T){return T.textCodec===F.IMSC1_CODEC});if(this.config.enableWebVTT||y&&this.config.enableIMSC1){var v=this.tracks&&m&&this.tracks.length===m.length;if(this.tracks=m||[],this.config.renderTextTracksNatively){var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(T,o){var _;if(o<c.length){for(var L=null,x=0;x<c.length;x++)if(M(c[x],T)){L=c[x];break}L&&(_=L)}if(_)(0,k.clearCurrentCues)(_);else{var H=u._captionsOrSubtitlesFromCharacteristics(T);_=u.createTextTrack(H,T.name,T.lang),_&&(_.mode="disabled")}_&&(_.groupId=T.groupId,u.textTracks.push(_))})}else if(!v&&this.tracks&&this.tracks.length){var a=this.tracks.map(function(T){return{label:T.name,kind:T.type.toLowerCase(),default:T.default,subtitleTrack:T}});this.hls.trigger(A.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}},d._captionsOrSubtitlesFromCharacteristics=function(b){var h;if((h=b.attrs)!==null&&h!==void 0&&h.CHARACTERISTICS){var u=/transcribes-spoken-dialog/gi.test(b.attrs.CHARACTERISTICS),m=/describes-music-and-sound/gi.test(b.attrs.CHARACTERISTICS);if(u&&m)return"captions"}return"subtitles"},d.onManifestLoaded=function(b,h){var u=this;this.config.enableCEA708Captions&&h.captions&&h.captions.forEach(function(m){var y=/(?:CC|SERVICE)([1-4])/.exec(m.instreamId);if(y){var v="textTrack"+y[1],c=u.captionsProperties[v];c&&(c.label=m.name,m.lang&&(c.languageCode=m.lang),c.media=m)}})},d.closedCaptionsForLevel=function(b){var h=this.hls.levels[b.level];return h==null?void 0:h.attrs["CLOSED-CAPTIONS"]},d.onFragLoading=function(b,h){var u=this.cea608Parser1,m=this.cea608Parser2,y=this.lastSn,v=this.lastPartIndex;if(!(!this.enabled||!(u&&m))&&h.frag.type===P.PlaylistLevelType.MAIN){var c,a,T=h.frag.sn,o=(c=h==null||(a=h.part)===null||a===void 0?void 0:a.index)!=null?c:-1;T===y+1||T===y&&o===v+1||(u.reset(),m.reset()),this.lastSn=T,this.lastPartIndex=o}},d.onFragLoaded=function(b,h){var u=h.frag,m=h.payload,y=this.initPTS,v=this.unparsedVttFrags;if(u.type===P.PlaylistLevelType.SUBTITLE)if(m.byteLength){if(!(0,R.isFiniteNumber)(y[u.cc])){v.push(h),y.length&&this.hls.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:u,error:new Error("Missing initial subtitle PTS")});return}var c=u.decryptdata,a="stats"in h;if(c==null||!c.encrypted||a){var T=this.tracks[u.level],o=this.vttCCs;o[u.cc]||(o[u.cc]={start:u.start,prevCC:this.prevCC,new:!0},this.prevCC=u.cc),T&&T.textCodec===F.IMSC1_CODEC?this._parseIMSC1(u,m):this._parseVTTs(u,m,o)}}else this.hls.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:u,error:new Error("Empty subtitle payload")})},d._parseIMSC1=function(b,h){var u=this,m=this.hls;(0,F.parseIMSC1)(h,this.initPTS[b.cc],this.timescale[b.cc],function(y){u._appendCues(y,b.level),m.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:b})},function(y){N.logger.log("Failed to parse IMSC1: "+y),m.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b,error:y})})},d._parseVTTs=function(b,h,u){var m,y=this,v=this.hls,c=(m=b.initSegment)!==null&&m!==void 0&&m.data?(0,B.appendUint8Array)(b.initSegment.data,new Uint8Array(h)):h;(0,K.parseWebVTT)(c,this.initPTS[b.cc],this.timescale[b.cc],u,b.cc,b.start,function(a){y._appendCues(a,b.level),v.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:b})},function(a){y._fallbackToIMSC1(b,h),N.logger.log("Failed to parse VTT cue: "+a),v.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b,error:a})})},d._fallbackToIMSC1=function(b,h){var u=this,m=this.tracks[b.level];m.textCodec||(0,F.parseIMSC1)(h,this.initPTS[b.cc],this.timescale[b.cc],function(){m.textCodec=F.IMSC1_CODEC,u._parseIMSC1(b,h)},function(){m.textCodec="wvtt"})},d._appendCues=function(b,h){var u=this.hls;if(this.config.renderTextTracksNatively){var m=this.textTracks[h];if(!m||m.mode==="disabled")return;b.forEach(function(c){return(0,k.addCueToTrack)(m,c)})}else{var y=this.tracks[h];if(!y)return;var v=y.default?"default":"subtitles"+h;u.trigger(A.Events.CUES_PARSED,{type:"subtitles",cues:b,track:v})}},d.onFragDecrypted=function(b,h){var u=h.frag;if(u.type===P.PlaylistLevelType.SUBTITLE){if(!(0,R.isFiniteNumber)(this.initPTS[u.cc])){this.unparsedVttFrags.push(h);return}this.onFragLoaded(A.Events.FRAG_LOADED,h)}},d.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},d.onFragParsingUserdata=function(b,h){var u=this.cea608Parser1,m=this.cea608Parser2;if(!(!this.enabled||!(u&&m))){var y=h.frag,v=h.samples;if(!(y.type===P.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(y)==="NONE"))for(var c=0;c<v.length;c++){var a=v[c].bytes;if(a){var T=this.extractCea608Data(a);u.addData(v[c].pts,T[0]),m.addData(v[c].pts,T[1])}}}},d.onBufferFlushing=function(b,h){var u=h.startOffset,m=h.endOffset,y=h.endOffsetSubtitles,v=h.type,c=this.media;if(!(!c||c.currentTime<m)){if(!v||v==="video"){var a=this.captionsTracks;Object.keys(a).forEach(function(o){return(0,k.removeCuesInRange)(a[o],u,m)})}if(this.config.renderTextTracksNatively&&u===0&&y!==void 0){var T=this.textTracks;Object.keys(T).forEach(function(o){return(0,k.removeCuesInRange)(T[o],u,y)})}}},d.extractCea608Data=function(b){for(var h=[[],[]],u=b[0]&31,m=2,y=0;y<u;y++){var v=b[m++],c=127&b[m++],a=127&b[m++];if(!(c===0&&a===0)){var T=(4&v)!==0;if(T){var o=3&v;(o===0||o===1)&&(h[o].push(c),h[o].push(a))}}}return h},E}();function M(E,d){return E&&E.label===d.name&&!(E.textTrack1||E.textTrack2)}function S(E,d,l,b){return Math.min(d,b)-Math.max(E,l)}function f(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>R});var R=function(){function A(D,K){this.subtle=void 0,this.aesIV=void 0,this.subtle=D,this.aesIV=K}var w=A.prototype;return w.decrypt=function(K,k){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},k,K)},A}()},"./src/crypt/aes-decryptor.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>w,removePadding:()=>A});var R=s("./src/utils/typed-array.ts");function A(D){var K=D.byteLength,k=K&&new DataView(D.buffer).getUint8(K-1);return k?(0,R.sliceUint8)(D,0,K-k):D}var w=function(){function D(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var K=D.prototype;return K.uint8ArrayToUint32Array_=function(F){for(var B=new DataView(F),P=new Uint32Array(4),N=0;N<4;N++)P[N]=B.getUint32(N*4);return P},K.initTable=function(){var F=this.sBox,B=this.invSBox,P=this.subMix,N=P[0],g=P[1],M=P[2],S=P[3],f=this.invSubMix,E=f[0],d=f[1],l=f[2],b=f[3],h=new Uint32Array(256),u=0,m=0,y=0;for(y=0;y<256;y++)y<128?h[y]=y<<1:h[y]=y<<1^283;for(y=0;y<256;y++){var v=m^m<<1^m<<2^m<<3^m<<4;v=v>>>8^v&255^99,F[u]=v,B[v]=u;var c=h[u],a=h[c],T=h[a],o=h[v]*257^v*16843008;N[u]=o<<24|o>>>8,g[u]=o<<16|o>>>16,M[u]=o<<8|o>>>24,S[u]=o,o=T*16843009^a*65537^c*257^u*16843008,E[v]=o<<24|o>>>8,d[v]=o<<16|o>>>16,l[v]=o<<8|o>>>24,b[v]=o,u?(u=c^h[h[h[T^c]]],m^=h[h[m]]):u=m=1}},K.expandKey=function(F){for(var B=this.uint8ArrayToUint32Array_(F),P=!0,N=0;N<B.length&&P;)P=B[N]===this.key[N],N++;if(!P){this.key=B;var g=this.keySize=B.length;if(g!==4&&g!==6&&g!==8)throw new Error("Invalid aes key size="+g);var M=this.ksRows=(g+6+1)*4,S,f,E=this.keySchedule=new Uint32Array(M),d=this.invKeySchedule=new Uint32Array(M),l=this.sBox,b=this.rcon,h=this.invSubMix,u=h[0],m=h[1],y=h[2],v=h[3],c,a;for(S=0;S<M;S++){if(S<g){c=E[S]=B[S];continue}a=c,S%g===0?(a=a<<8|a>>>24,a=l[a>>>24]<<24|l[a>>>16&255]<<16|l[a>>>8&255]<<8|l[a&255],a^=b[S/g|0]<<24):g>6&&S%g===4&&(a=l[a>>>24]<<24|l[a>>>16&255]<<16|l[a>>>8&255]<<8|l[a&255]),E[S]=c=(E[S-g]^a)>>>0}for(f=0;f<M;f++)S=M-f,f&3?a=E[S]:a=E[S-4],f<4||S<=4?d[f]=a:d[f]=u[l[a>>>24]]^m[l[a>>>16&255]]^y[l[a>>>8&255]]^v[l[a&255]],d[f]=d[f]>>>0}},K.networkToHostOrderSwap=function(F){return F<<24|(F&65280)<<8|(F&16711680)>>8|F>>>24},K.decrypt=function(F,B,P){for(var N=this.keySize+6,g=this.invKeySchedule,M=this.invSBox,S=this.invSubMix,f=S[0],E=S[1],d=S[2],l=S[3],b=this.uint8ArrayToUint32Array_(P),h=b[0],u=b[1],m=b[2],y=b[3],v=new Int32Array(F),c=new Int32Array(v.length),a,T,o,_,L,x,H,W,U,G,Y,j,X,q,J=this.networkToHostOrderSwap;B<v.length;){for(U=J(v[B]),G=J(v[B+1]),Y=J(v[B+2]),j=J(v[B+3]),L=U^g[0],x=j^g[1],H=Y^g[2],W=G^g[3],X=4,q=1;q<N;q++)a=f[L>>>24]^E[x>>16&255]^d[H>>8&255]^l[W&255]^g[X],T=f[x>>>24]^E[H>>16&255]^d[W>>8&255]^l[L&255]^g[X+1],o=f[H>>>24]^E[W>>16&255]^d[L>>8&255]^l[x&255]^g[X+2],_=f[W>>>24]^E[L>>16&255]^d[x>>8&255]^l[H&255]^g[X+3],L=a,x=T,H=o,W=_,X=X+4;a=M[L>>>24]<<24^M[x>>16&255]<<16^M[H>>8&255]<<8^M[W&255]^g[X],T=M[x>>>24]<<24^M[H>>16&255]<<16^M[W>>8&255]<<8^M[L&255]^g[X+1],o=M[H>>>24]<<24^M[W>>16&255]<<16^M[L>>8&255]<<8^M[x&255]^g[X+2],_=M[W>>>24]<<24^M[L>>16&255]<<16^M[x>>8&255]<<8^M[H&255]^g[X+3],c[B]=J(a^h),c[B+1]=J(_^u),c[B+2]=J(o^m),c[B+3]=J(T^y),h=U,u=G,m=Y,y=j,B=B+4}return c.buffer},D}()},"./src/crypt/decrypter.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>B});var R=s("./src/crypt/aes-crypto.ts"),A=s("./src/crypt/fast-aes-key.ts"),w=s("./src/crypt/aes-decryptor.ts"),D=s("./src/utils/logger.ts"),K=s("./src/utils/mp4-tools.ts"),k=s("./src/utils/typed-array.ts"),F=16,B=function(){function P(g,M){var S=M===void 0?{}:M,f=S.removePKCS7Padding,E=f===void 0?!0:f;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=g.enableSoftwareAES,this.removePKCS7Padding=E,E)try{var d=self.crypto;d&&(this.subtle=d.subtle||d.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}var N=P.prototype;return N.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},N.isSync=function(){return this.useSoftware},N.flush=function(){var M=this.currentResult,S=this.remainderData;if(!M||S)return D.logger.error("[softwareDecrypt] "+(S?"overflow bytes: "+S.byteLength:"no result")),this.reset(),null;var f=new Uint8Array(M);return this.reset(),this.removePKCS7Padding?(0,w.removePadding)(f):f},N.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},N.decrypt=function(M,S,f){var E=this;return this.useSoftware?new Promise(function(d,l){E.softwareDecrypt(new Uint8Array(M),S,f);var b=E.flush();b?d(b.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(M),S,f)},N.softwareDecrypt=function(M,S,f){var E=this.currentIV,d=this.currentResult,l=this.remainderData;this.logOnce("JS AES decrypt"),l&&(M=(0,K.appendUint8Array)(l,M),this.remainderData=null);var b=this.getValidChunk(M);if(!b.length)return null;E&&(f=E);var h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new w.default),h.expandKey(S);var u=d;return this.currentResult=h.decrypt(b.buffer,0,f),this.currentIV=(0,k.sliceUint8)(b,-16).buffer,u||null},N.webCryptoDecrypt=function(M,S,f){var E=this,d=this.subtle;return(this.key!==S||!this.fastAesKey)&&(this.key=S,this.fastAesKey=new A.default(d,S)),this.fastAesKey.expandKey().then(function(l){if(!d)return Promise.reject(new Error("web crypto not initialized"));E.logOnce("WebCrypto AES decrypt");var b=new R.default(d,new Uint8Array(f));return b.decrypt(M.buffer,l)}).catch(function(l){return D.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+l.name+": "+l.message),E.onWebCryptoError(M,S,f)})},N.onWebCryptoError=function(M,S,f){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(M,S,f);var E=this.flush();if(E)return E.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},N.getValidChunk=function(M){var S=M,f=M.length-M.length%F;return f!==M.length&&(S=(0,k.sliceUint8)(M,0,f),this.remainderData=(0,k.sliceUint8)(M,f)),S},N.logOnce=function(M){this.logEnabled&&(D.logger.log("[decrypter]: "+M),this.logEnabled=!1)},P}()},"./src/crypt/fast-aes-key.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>R});var R=function(){function A(D,K){this.subtle=void 0,this.key=void 0,this.subtle=D,this.key=K}var w=A.prototype;return w.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},A}()},"./src/demux/aacdemuxer.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>B});var R=s("./src/demux/base-audio-demuxer.ts"),A=s("./src/demux/adts.ts"),w=s("./src/utils/logger.ts"),D=s("./src/demux/id3.ts");function K(P,N){P.prototype=Object.create(N.prototype),P.prototype.constructor=P,k(P,N)}function k(P,N){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(M,S){return M.__proto__=S,M},k(P,N)}var F=function(P){K(N,P);function N(M,S){var f;return f=P.call(this)||this,f.observer=void 0,f.config=void 0,f.observer=M,f.config=S,f}var g=N.prototype;return g.resetInitSegment=function(S,f,E,d){P.prototype.resetInitSegment.call(this,S,f,E,d),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:f,duration:d,inputTimeScale:9e4,dropped:0}},N.probe=function(S){if(!S)return!1;for(var f=D.getID3Data(S,0)||[],E=f.length,d=S.length;E<d;E++)if(A.probe(S,E))return w.logger.log("ADTS sync word found !"),!0;return!1},g.canParse=function(S,f){return A.canParse(S,f)},g.appendFrame=function(S,f,E){A.initTrackConfig(S,this.observer,f,E,S.manifestCodec);var d=A.appendFrame(S,f,E,this.basePTS,this.frameIndex);if(d&&d.missing===0)return d},N}(R.default);const B=F},"./src/demux/adts.ts":(O,I,s)=>{s.r(I),s.d(I,{appendFrame:()=>E,canGetFrameLength:()=>B,canParse:()=>N,getAudioConfig:()=>D,getFrameDuration:()=>S,getFullFrameLength:()=>F,getHeaderLength:()=>k,initTrackConfig:()=>M,isHeader:()=>P,isHeaderPattern:()=>K,parseFrameHeader:()=>f,probe:()=>g});var R=s("./src/utils/logger.ts"),A=s("./src/errors.ts"),w=s("./src/events.ts");function D(d,l,b,h){var u,m,y,v,c=navigator.userAgent.toLowerCase(),a=h,T=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];u=((l[b+2]&192)>>>6)+1;var o=(l[b+2]&60)>>>2;if(o>T.length-1){d.trigger(w.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o});return}return y=(l[b+2]&1)<<2,y|=(l[b+3]&192)>>>6,R.logger.log("manifest codec:"+h+", ADTS type:"+u+", samplingIndex:"+o),/firefox/i.test(c)?o>=6?(u=5,v=new Array(4),m=o-3):(u=2,v=new Array(2),m=o):c.indexOf("android")!==-1?(u=2,v=new Array(2),m=o):(u=5,v=new Array(4),h&&(h.indexOf("mp4a.40.29")!==-1||h.indexOf("mp4a.40.5")!==-1)||!h&&o>=6?m=o-3:((h&&h.indexOf("mp4a.40.2")!==-1&&(o>=6&&y===1||/vivaldi/i.test(c))||!h&&y===1)&&(u=2,v=new Array(2)),m=o)),v[0]=u<<3,v[0]|=(o&14)>>1,v[1]|=(o&1)<<7,v[1]|=y<<3,u===5&&(v[1]|=(m&14)>>1,v[2]=(m&1)<<7,v[2]|=8,v[3]=0),{config:v,samplerate:T[o],channelCount:y,codec:"mp4a.40."+u,manifestCodec:a}}function K(d,l){return d[l]===255&&(d[l+1]&246)===240}function k(d,l){return d[l+1]&1?7:9}function F(d,l){return(d[l+3]&3)<<11|d[l+4]<<3|(d[l+5]&224)>>>5}function B(d,l){return l+5<d.length}function P(d,l){return l+1<d.length&&K(d,l)}function N(d,l){return B(d,l)&&K(d,l)&&F(d,l)<=d.length-l}function g(d,l){if(P(d,l)){var b=k(d,l);if(l+b>=d.length)return!1;var h=F(d,l);if(h<=b)return!1;var u=l+h;return u===d.length||P(d,u)}return!1}function M(d,l,b,h,u){if(!d.samplerate){var m=D(l,b,h,u);if(!m)return;d.config=m.config,d.samplerate=m.samplerate,d.channelCount=m.channelCount,d.codec=m.codec,d.manifestCodec=m.manifestCodec,R.logger.log("parsed codec:"+d.codec+", rate:"+m.samplerate+", channels:"+m.channelCount)}}function S(d){return 9216e4/d}function f(d,l){var b=k(d,l);if(l+b<=d.length){var h=F(d,l)-b;if(h>0)return{headerLength:b,frameLength:h}}}function E(d,l,b,h,u){var m=S(d.samplerate),y=h+u*m,v=f(l,b),c;if(v){var a=v.frameLength,T=v.headerLength,o=T+a,_=Math.max(0,b+o-l.length);_?(c=new Uint8Array(o-T),c.set(l.subarray(b+T,l.length),0)):c=l.subarray(b+T,b+o);var L={unit:c,pts:y};return _||d.samples.push(L),{sample:L,length:o,missing:_}}var x=l.length-b;c=new Uint8Array(x),c.set(l.subarray(b,l.length),0);var H={unit:c,pts:y};return{sample:H,length:x,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>P,initPTSFn:()=>B});var R=s("./src/polyfills/number.ts"),A=s("./src/demux/id3.ts"),w=s("./src/types/demuxer.ts"),D=s("./src/demux/dummy-demuxed-track.ts"),K=s("./src/utils/mp4-tools.ts"),k=s("./src/utils/typed-array.ts"),F=function(){function N(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var g=N.prototype;return g.resetInitSegment=function(S,f,E,d){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},g.resetTimeStamp=function(S){this.initPTS=S,this.resetContiguity()},g.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},g.canParse=function(S,f){return!1},g.appendFrame=function(S,f,E){},g.demux=function(S,f){this.cachedData&&(S=(0,K.appendUint8Array)(this.cachedData,S),this.cachedData=null);var E=A.getID3Data(S,0),d=E?E.length:0,l,b=this._audioTrack,h=this._id3Track,u=E?A.getTimeStamp(E):void 0,m=S.length;for((this.basePTS===null||this.frameIndex===0&&(0,R.isFiniteNumber)(u))&&(this.basePTS=B(u,f,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),E&&E.length>0&&h.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:E,type:w.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});d<m;){if(this.canParse(S,d)){var y=this.appendFrame(b,S,d);y?(this.frameIndex++,this.lastPTS=y.sample.pts,d+=y.length,l=d):d=m}else A.canParse(S,d)?(E=A.getID3Data(S,d),h.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:E,type:w.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),d+=E.length,l=d):d++;if(d===m&&l!==m){var v=(0,k.sliceUint8)(S,l);this.cachedData?this.cachedData=(0,K.appendUint8Array)(this.cachedData,v):this.cachedData=v}}return{audioTrack:b,videoTrack:(0,D.dummyTrack)(),id3Track:h,textTrack:(0,D.dummyTrack)()}},g.demuxSampleAes=function(S,f,E){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},g.flush=function(S){var f=this.cachedData;return f&&(this.cachedData=null,this.demux(f,0)),{audioTrack:this._audioTrack,videoTrack:(0,D.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,D.dummyTrack)()}},g.destroy=function(){},N}(),B=function(g,M,S){return(0,R.isFiniteNumber)(g)?g*90:M*9e4+(S||0)};const P=F},"./src/demux/chunk-cache.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>R});var R=function(){function w(){this.chunks=[],this.dataLength=0}var D=w.prototype;return D.push=function(k){this.chunks.push(k),this.dataLength+=k.length},D.flush=function(){var k=this.chunks,F=this.dataLength,B;if(k.length)k.length===1?B=k[0]:B=A(k,F);else return new Uint8Array(0);return this.reset(),B},D.reset=function(){this.chunks.length=0,this.dataLength=0},w}();function A(w,D){for(var K=new Uint8Array(D),k=0,F=0;F<w.length;F++){var B=w[F];K.set(B,k),k+=B.length}return K}},"./src/demux/dummy-demuxed-track.ts":(O,I,s)=>{s.r(I),s.d(I,{dummyTrack:()=>R});function R(A,w){return A===void 0&&(A=""),w===void 0&&(w=9e4),{type:A,id:-1,pid:-1,inputTimeScale:w,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>w});var R=s("./src/utils/logger.ts"),A=function(){function D(k){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=k,this.bytesAvailable=k.byteLength,this.word=0,this.bitsAvailable=0}var K=D.prototype;return K.loadWord=function(){var F=this.data,B=this.bytesAvailable,P=F.byteLength-B,N=new Uint8Array(4),g=Math.min(4,B);if(g===0)throw new Error("no bytes available");N.set(F.subarray(P,P+g)),this.word=new DataView(N.buffer).getUint32(0),this.bitsAvailable=g*8,this.bytesAvailable-=g},K.skipBits=function(F){var B;F=Math.min(F,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>F?(this.word<<=F,this.bitsAvailable-=F):(F-=this.bitsAvailable,B=F>>3,F-=B<<3,this.bytesAvailable-=B,this.loadWord(),this.word<<=F,this.bitsAvailable-=F)},K.readBits=function(F){var B=Math.min(this.bitsAvailable,F),P=this.word>>>32-B;if(F>32&&R.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=B,this.bitsAvailable>0)this.word<<=B;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return B=F-B,B>0&&this.bitsAvailable?P<<B|this.readBits(B):P},K.skipLZ=function(){var F;for(F=0;F<this.bitsAvailable;++F)if(this.word&2147483648>>>F)return this.word<<=F,this.bitsAvailable-=F,F;return this.loadWord(),F+this.skipLZ()},K.skipUEG=function(){this.skipBits(1+this.skipLZ())},K.skipEG=function(){this.skipBits(1+this.skipLZ())},K.readUEG=function(){var F=this.skipLZ();return this.readBits(F+1)-1},K.readEG=function(){var F=this.readUEG();return 1&F?1+F>>>1:-1*(F>>>1)},K.readBoolean=function(){return this.readBits(1)===1},K.readUByte=function(){return this.readBits(8)},K.readUShort=function(){return this.readBits(16)},K.readUInt=function(){return this.readBits(32)},K.skipScalingList=function(F){for(var B=8,P=8,N,g=0;g<F;g++)P!==0&&(N=this.readEG(),P=(B+N+256)%256),B=P===0?B:P},K.readSPS=function(){var F=0,B=0,P=0,N=0,g,M,S,f=this.readUByte.bind(this),E=this.readBits.bind(this),d=this.readUEG.bind(this),l=this.readBoolean.bind(this),b=this.skipBits.bind(this),h=this.skipEG.bind(this),u=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);f();var y=f();if(E(5),b(3),f(),u(),y===100||y===110||y===122||y===244||y===44||y===83||y===86||y===118||y===128){var v=d();if(v===3&&b(1),u(),u(),b(1),l())for(M=v!==3?8:12,S=0;S<M;S++)l()&&(S<6?m(16):m(64))}u();var c=d();if(c===0)d();else if(c===1)for(b(1),h(),h(),g=d(),S=0;S<g;S++)h();u(),b(1);var a=d(),T=d(),o=E(1);o===0&&b(1),b(1),l()&&(F=d(),B=d(),P=d(),N=d());var _=[1,1];if(l()&&l()){var L=f();switch(L){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:{_=[f()<<8|f(),f()<<8|f()];break}}}return{width:Math.ceil((a+1)*16-F*2-B*2),height:(2-o)*(T+1)*16-(o?2:4)*(P+N),pixelRatio:_}},K.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},D}();const w=A},"./src/demux/id3.ts":(O,I,s)=>{s.r(I),s.d(I,{canParse:()=>K,decodeFrame:()=>N,getID3Data:()=>w,getID3Frames:()=>P,getTimeStamp:()=>k,isFooter:()=>A,isHeader:()=>R,isTimeStampFrame:()=>F,testables:()=>d,utf8ArrayToStr:()=>E});var R=function(u,m){return m+10<=u.length&&u[m]===73&&u[m+1]===68&&u[m+2]===51&&u[m+3]<255&&u[m+4]<255&&u[m+6]<128&&u[m+7]<128&&u[m+8]<128&&u[m+9]<128},A=function(u,m){return m+10<=u.length&&u[m]===51&&u[m+1]===68&&u[m+2]===73&&u[m+3]<255&&u[m+4]<255&&u[m+6]<128&&u[m+7]<128&&u[m+8]<128&&u[m+9]<128},w=function(u,m){for(var y=m,v=0;R(u,m);){v+=10;var c=D(u,m+6);v+=c,A(u,m+10)&&(v+=10),m+=v}if(v>0)return u.subarray(y,y+v)},D=function(u,m){var y=0;return y=(u[m]&127)<<21,y|=(u[m+1]&127)<<14,y|=(u[m+2]&127)<<7,y|=u[m+3]&127,y},K=function(u,m){return R(u,m)&&D(u,m+6)+10<=u.length-m},k=function(u){for(var m=P(u),y=0;y<m.length;y++){var v=m[y];if(F(v))return f(v)}},F=function(u){return u&&u.key==="PRIV"&&u.info==="com.apple.streaming.transportStreamTimestamp"},B=function(u){var m=String.fromCharCode(u[0],u[1],u[2],u[3]),y=D(u,4),v=10;return{type:m,size:y,data:u.subarray(v,v+y)}},P=function(u){for(var m=0,y=[];R(u,m);){var v=D(u,m+6);m+=10;for(var c=m+v;m+8<c;){var a=B(u.subarray(m)),T=N(a);T&&y.push(T),m+=a.size+10}A(u,m)&&(m+=10)}return y},N=function(u){return u.type==="PRIV"?g(u):u.type[0]==="W"?S(u):M(u)},g=function(u){if(!(u.size<2)){var m=E(u.data,!0),y=new Uint8Array(u.data.subarray(m.length+1));return{key:u.type,info:m,data:y.buffer}}},M=function(u){if(!(u.size<2)){if(u.type==="TXXX"){var m=1,y=E(u.data.subarray(m),!0);m+=y.length+1;var v=E(u.data.subarray(m));return{key:u.type,info:y,data:v}}var c=E(u.data.subarray(1));return{key:u.type,data:c}}},S=function(u){if(u.type==="WXXX"){if(u.size<2)return;var m=1,y=E(u.data.subarray(m),!0);m+=y.length+1;var v=E(u.data.subarray(m));return{key:u.type,info:y,data:v}}var c=E(u.data);return{key:u.type,data:c}},f=function(u){if(u.data.byteLength===8){var m=new Uint8Array(u.data),y=m[3]&1,v=(m[4]<<23)+(m[5]<<15)+(m[6]<<7)+m[7];return v/=45,y&&(v+=4772185884e-2),Math.round(v)}},E=function(u,m){m===void 0&&(m=!1);var y=b();if(y){var v=y.decode(u);if(m){var c=v.indexOf("\0");return c!==-1?v.substring(0,c):v}return v.replace(/\0/g,"")}for(var a=u.length,T,o,_,L="",x=0;x<a;){if(T=u[x++],T===0&&m)return L;if(T===0||T===3)continue;switch(T>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:L+=String.fromCharCode(T);break;case 12:case 13:o=u[x++],L+=String.fromCharCode((T&31)<<6|o&63);break;case 14:o=u[x++],_=u[x++],L+=String.fromCharCode((T&15)<<12|(o&63)<<6|(_&63)<<0);break}}return L},d={decodeTextFrame:M},l;function b(){return!l&&typeof self.TextDecoder<"u"&&(l=new self.TextDecoder("utf-8")),l}},"./src/demux/mp3demuxer.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>B});var R=s("./src/demux/base-audio-demuxer.ts"),A=s("./src/demux/id3.ts"),w=s("./src/utils/logger.ts"),D=s("./src/demux/mpegaudio.ts");function K(P,N){P.prototype=Object.create(N.prototype),P.prototype.constructor=P,k(P,N)}function k(P,N){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(M,S){return M.__proto__=S,M},k(P,N)}var F=function(P){K(N,P);function N(){return P.apply(this,arguments)||this}var g=N.prototype;return g.resetInitSegment=function(S,f,E,d){P.prototype.resetInitSegment.call(this,S,f,E,d),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:f,duration:d,inputTimeScale:9e4,dropped:0}},N.probe=function(S){if(!S)return!1;for(var f=A.getID3Data(S,0)||[],E=f.length,d=S.length;E<d;E++)if(D.probe(S,E))return w.logger.log("MPEG Audio sync word found !"),!0;return!1},g.canParse=function(S,f){return D.canParse(S,f)},g.appendFrame=function(S,f,E){if(this.basePTS!==null)return D.appendFrame(S,f,E,this.basePTS,this.frameIndex)},N}(R.default);const B=F},"./src/demux/mp4demuxer.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>F});var R=s("./src/polyfills/number.ts"),A=s("./src/types/demuxer.ts"),w=s("./src/utils/mp4-tools.ts"),D=s("./src/demux/dummy-demuxed-track.ts"),K=/\/emsg[-/]ID3/i,k=function(){function B(N,g){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=g}var P=B.prototype;return P.resetTimeStamp=function(){},P.resetInitSegment=function(g,M,S,f){var E=this.videoTrack=(0,D.dummyTrack)("video",1),d=this.audioTrack=(0,D.dummyTrack)("audio",1),l=this.txtTrack=(0,D.dummyTrack)("text",1);if(this.id3Track=(0,D.dummyTrack)("id3",1),this.timeOffset=0,!(!g||!g.byteLength)){var b=(0,w.parseInitSegment)(g);if(b.video){var h=b.video,u=h.id,m=h.timescale,y=h.codec;E.id=u,E.timescale=l.timescale=m,E.codec=y}if(b.audio){var v=b.audio,c=v.id,a=v.timescale,T=v.codec;d.id=c,d.timescale=a,d.codec=T}l.id=w.RemuxerTrackIdConfig.text,E.sampleDuration=0,E.duration=d.duration=f}},P.resetContiguity=function(){},B.probe=function(g){return g=g.length>16384?g.subarray(0,16384):g,(0,w.findBox)(g,["moof"]).length>0},P.demux=function(g,M){this.timeOffset=M;var S=g,f=this.videoTrack,E=this.txtTrack;if(this.config.progressive){this.remainderData&&(S=(0,w.appendUint8Array)(this.remainderData,g));var d=(0,w.segmentValidRange)(S);this.remainderData=d.remainder,f.samples=d.valid||new Uint8Array}else f.samples=S;var l=this.extractID3Track(f,M);return E.samples=(0,w.parseSamples)(M,f),{videoTrack:f,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}},P.flush=function(){var g=this.timeOffset,M=this.videoTrack,S=this.txtTrack;M.samples=this.remainderData||new Uint8Array,this.remainderData=null;var f=this.extractID3Track(M,this.timeOffset);return S.samples=(0,w.parseSamples)(g,M),{videoTrack:M,audioTrack:(0,D.dummyTrack)(),id3Track:f,textTrack:(0,D.dummyTrack)()}},P.extractID3Track=function(g,M){var S=this.id3Track;if(g.samples.length){var f=(0,w.findBox)(g.samples,["emsg"]);f&&f.forEach(function(E){var d=(0,w.parseEmsg)(E);if(K.test(d.schemeIdUri)){var l=(0,R.isFiniteNumber)(d.presentationTime)?d.presentationTime/d.timeScale:M+d.presentationTimeDelta/d.timeScale,b=d.eventDuration===4294967295?Number.POSITIVE_INFINITY:d.eventDuration/d.timeScale;b<=.001&&(b=Number.POSITIVE_INFINITY);var h=d.payload;S.samples.push({data:h,len:h.byteLength,dts:l,pts:l,type:A.MetadataSchema.emsg,duration:b})}})}return S},P.demuxSampleAes=function(g,M,S){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},P.destroy=function(){},B}();const F=k},"./src/demux/mpegaudio.ts":(O,I,s)=>{s.r(I),s.d(I,{appendFrame:()=>k,canParse:()=>N,isHeader:()=>P,isHeaderPattern:()=>B,parseHeader:()=>F,probe:()=>g});var R=null,A=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],w=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],D=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],K=[0,1,1,4];function k(M,S,f,E,d){if(!(f+24>S.length)){var l=F(S,f);if(l&&f+l.frameLength<=S.length){var b=l.samplesPerFrame*9e4/l.sampleRate,h=E+d*b,u={unit:S.subarray(f,f+l.frameLength),pts:h,dts:h};return M.config=[],M.channelCount=l.channelCount,M.samplerate=l.sampleRate,M.samples.push(u),{sample:u,length:l.frameLength,missing:0}}}}function F(M,S){var f=M[S+1]>>3&3,E=M[S+1]>>1&3,d=M[S+2]>>4&15,l=M[S+2]>>2&3;if(f!==1&&d!==0&&d!==15&&l!==3){var b=M[S+2]>>1&1,h=M[S+3]>>6,u=f===3?3-E:E===3?3:4,m=A[u*14+d-1]*1e3,y=f===3?0:f===2?1:2,v=w[y*3+l],c=h===3?1:2,a=D[f][E],T=K[E],o=a*8*T,_=Math.floor(a*m/v+b)*T;if(R===null){var L=navigator.userAgent||"",x=L.match(/Chrome\/(\d+)/i);R=x?parseInt(x[1]):0}var H=!!R&&R<=87;return H&&E===2&&m>=224e3&&h===0&&(M[S+3]=M[S+3]|128),{sampleRate:v,channelCount:c,frameLength:_,samplesPerFrame:o}}}function B(M,S){return M[S]===255&&(M[S+1]&224)===224&&(M[S+1]&6)!==0}function P(M,S){return S+1<M.length&&B(M,S)}function N(M,S){var f=4;return B(M,S)&&f<=M.length-S}function g(M,S){if(S+1<M.length&&B(M,S)){var f=4,E=F(M,S),d=f;E!=null&&E.frameLength&&(d=E.frameLength);var l=S+d;return l===M.length||P(M,l)}return!1}},"./src/demux/sample-aes.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>D});var R=s("./src/crypt/decrypter.ts"),A=s("./src/utils/mp4-tools.ts"),w=function(){function K(F,B,P){this.keyData=void 0,this.decrypter=void 0,this.keyData=P,this.decrypter=new R.default(B,{removePKCS7Padding:!1})}var k=K.prototype;return k.decryptBuffer=function(B){return this.decrypter.decrypt(B,this.keyData.key.buffer,this.keyData.iv.buffer)},k.decryptAacSample=function(B,P,N){var g=this,M=B[P].unit;if(!(M.length<=16)){var S=M.subarray(16,M.length-M.length%16),f=S.buffer.slice(S.byteOffset,S.byteOffset+S.length);this.decryptBuffer(f).then(function(E){var d=new Uint8Array(E);M.set(d,16),g.decrypter.isSync()||g.decryptAacSamples(B,P+1,N)})}},k.decryptAacSamples=function(B,P,N){for(;;P++){if(P>=B.length){N();return}if(!(B[P].unit.length<32)&&(this.decryptAacSample(B,P,N),!this.decrypter.isSync()))return}},k.getAvcEncryptedData=function(B){for(var P=Math.floor((B.length-48)/160)*16+16,N=new Int8Array(P),g=0,M=32;M<B.length-16;M+=160,g+=16)N.set(B.subarray(M,M+16),g);return N},k.getAvcDecryptedUnit=function(B,P){for(var N=new Uint8Array(P),g=0,M=32;M<B.length-16;M+=160,g+=16)B.set(N.subarray(g,g+16),M);return B},k.decryptAvcSample=function(B,P,N,g,M){var S=this,f=(0,A.discardEPB)(M.data),E=this.getAvcEncryptedData(f);this.decryptBuffer(E.buffer).then(function(d){M.data=S.getAvcDecryptedUnit(f,d),S.decrypter.isSync()||S.decryptAvcSamples(B,P,N+1,g)})},k.decryptAvcSamples=function(B,P,N,g){if(B instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;P++,N=0){if(P>=B.length){g();return}for(var M=B[P].units;!(N>=M.length);N++){var S=M[N];if(!(S.data.length<=48||S.type!==1&&S.type!==5)&&(this.decryptAvcSample(B,P,N,g,S),!this.decrypter.isSync()))return}}},K}();const D=w},"./src/demux/transmuxer-interface.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>P});var R=s("./src/demux/webworkify-webpack.js"),A=s("./src/events.ts"),w=s("./src/demux/transmuxer.ts"),D=s("./src/utils/logger.ts"),K=s("./src/errors.ts"),k=s("./src/utils/mediasource-helper.ts"),F=s("./node_modules/eventemitter3/index.js"),B=(0,k.getMediaSource)()||{isTypeSupported:function(){return!1}},P=function(){function N(M,S,f,E){var d=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var l=M.config;this.hls=M,this.id=S,this.useWorker=!!l.enableWorker,this.onTransmuxComplete=f,this.onFlush=E;var b=function(v,c){c=c||{},c.frag=d.frag,c.id=d.id,d.hls.trigger(v,c)};this.observer=new F.EventEmitter,this.observer.on(A.Events.FRAG_DECRYPTED,b),this.observer.on(A.Events.ERROR,b);var h={mp4:B.isTypeSupported("video/mp4"),mpeg:B.isTypeSupported("audio/mpeg"),mp3:B.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){D.logger.log("demuxing in webworker");var m;try{m=this.worker=(0,R.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),m.addEventListener("message",this.onwmsg),m.onerror=function(y){d.useWorker=!1,D.logger.warn("Exception in webworker, fallback to inline"),d.hls.trigger(A.Events.ERROR,{type:K.ErrorTypes.OTHER_ERROR,details:K.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(y.message+"  ("+y.filename+":"+y.lineno+")")})},m.postMessage({cmd:"init",typeSupported:h,vendor:u,id:S,config:JSON.stringify(l)})}catch(y){D.logger.warn("Error in worker:",y),D.logger.error("Error while initializing DemuxerWorker, fallback to inline"),m&&self.URL.revokeObjectURL(m.objectURL),this.transmuxer=new w.default(this.observer,h,l,u,S),this.worker=null}}else this.transmuxer=new w.default(this.observer,h,l,u,S)}var g=N.prototype;return g.destroy=function(){var S=this.worker;if(S)S.removeEventListener("message",this.onwmsg),S.terminate(),this.worker=null,this.onwmsg=void 0;else{var f=this.transmuxer;f&&(f.destroy(),this.transmuxer=null)}var E=this.observer;E&&E.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},g.push=function(S,f,E,d,l,b,h,u,m,y){var v,c,a=this;m.transmuxing.start=self.performance.now();var T=this.transmuxer,o=this.worker,_=b?b.start:l.start,L=l.decryptdata,x=this.frag,H=!(x&&l.cc===x.cc),W=!(x&&m.level===x.level),U=x?m.sn-x.sn:-1,G=this.part?m.part-this.part.index:-1,Y=U===0&&m.id>1&&m.id===(x==null?void 0:x.stats.chunkCount),j=!W&&(U===1||U===0&&(G===1||Y&&G<=0)),X=self.performance.now();(W||U||l.stats.parsing.start===0)&&(l.stats.parsing.start=X),b&&(G||!j)&&(b.stats.parsing.start=X);var q=!(x&&((v=l.initSegment)===null||v===void 0?void 0:v.url)===((c=x.initSegment)===null||c===void 0?void 0:c.url)),J=new w.TransmuxState(H,j,u,W,_,q);if(!j||H||q){D.logger.log("[transmuxer-interface, "+l.type+"]: Starting new transmux session for sn: "+m.sn+" p: "+m.part+" level: "+m.level+" id: "+m.id+`
        discontinuity: `+H+`
        trackSwitch: `+W+`
        contiguous: `+j+`
        accurateTimeOffset: `+u+`
        timeOffset: `+_+`
        initSegmentChange: `+q);var V=new w.TransmuxConfig(E,d,f,h,y);this.configureTransmuxer(V)}if(this.frag=l,this.part=b,o)o.postMessage({cmd:"demux",data:S,decryptdata:L,chunkMeta:m,state:J},S instanceof ArrayBuffer?[S]:[]);else if(T){var Q=T.push(S,L,m,J);(0,w.isPromise)(Q)?(T.async=!0,Q.then(function(ee){a.handleTransmuxComplete(ee)}).catch(function(ee){a.transmuxerError(ee,m,"transmuxer-interface push error")})):(T.async=!1,this.handleTransmuxComplete(Q))}},g.flush=function(S){var f=this;S.transmuxing.start=self.performance.now();var E=this.transmuxer,d=this.worker;if(d)d.postMessage({cmd:"flush",chunkMeta:S});else if(E){var l=E.flush(S),b=(0,w.isPromise)(l);b||E.async?((0,w.isPromise)(l)||(l=Promise.resolve(l)),l.then(function(h){f.handleFlushResult(h,S)}).catch(function(h){f.transmuxerError(h,S,"transmuxer-interface flush error")})):this.handleFlushResult(l,S)}},g.transmuxerError=function(S,f,E){this.hls&&this.hls.trigger(A.Events.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:f,fatal:!1,error:S,err:S,reason:E})},g.handleFlushResult=function(S,f){var E=this;S.forEach(function(d){E.handleTransmuxComplete(d)}),this.onFlush(f)},g.onWorkerMessage=function(S){var f=S.data,E=this.hls;switch(f.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(f.data);break}case"flush":{this.onFlush(f.data);break}case"workerLog":D.logger[f.data.logType]&&D.logger[f.data.logType](f.data.message);break;default:{f.data=f.data||{},f.data.frag=this.frag,f.data.id=this.id,E.trigger(f.event,f.data);break}}},g.configureTransmuxer=function(S){var f=this.worker,E=this.transmuxer;f?f.postMessage({cmd:"configure",config:S}):E&&E.configure(S)},g.handleTransmuxComplete=function(S){S.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(S)},N}()},"./src/demux/transmuxer-worker.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>k});var R=s("./src/demux/transmuxer.ts"),A=s("./src/events.ts"),w=s("./src/utils/logger.ts"),D=s("./node_modules/eventemitter3/index.js"),K=s("./src/errors.ts");function k(g){var M=new D.EventEmitter,S=function(d,l){g.postMessage({event:d,data:l})};M.on(A.Events.FRAG_DECRYPTED,S),M.on(A.Events.ERROR,S);var f=function(){var d=function(h){var u=function(y){S("workerLog",{logType:h,message:y})};w.logger[h]=u};for(var l in w.logger)d(l)};g.addEventListener("message",function(E){var d=E.data;switch(d.cmd){case"init":{var l=JSON.parse(d.config);g.transmuxer=new R.default(M,d.typeSupported,l,d.vendor,d.id),(0,w.enableLogs)(l.debug,d.id),f(),S("init",null);break}case"configure":{g.transmuxer.configure(d.config);break}case"demux":{var b=g.transmuxer.push(d.data,d.decryptdata,d.chunkMeta,d.state);(0,R.isPromise)(b)?(g.transmuxer.async=!0,b.then(function(y){F(g,y)}).catch(function(y){S(A.Events.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:d.chunkMeta,fatal:!1,error:y,err:y,reason:"transmuxer-worker push error"})})):(g.transmuxer.async=!1,F(g,b));break}case"flush":{var h=d.chunkMeta,u=g.transmuxer.flush(h),m=(0,R.isPromise)(u);m||g.transmuxer.async?((0,R.isPromise)(u)||(u=Promise.resolve(u)),u.then(function(y){P(g,y,h)}).catch(function(y){S(A.Events.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:d.chunkMeta,fatal:!1,error:y,err:y,reason:"transmuxer-worker flush error"})})):P(g,u,h);break}}})}function F(g,M){if(N(M.remuxResult))return!1;var S=[],f=M.remuxResult,E=f.audio,d=f.video;return E&&B(S,E),d&&B(S,d),g.postMessage({event:"transmuxComplete",data:M},S),!0}function B(g,M){M.data1&&g.push(M.data1.buffer),M.data2&&g.push(M.data2.buffer)}function P(g,M,S){var f=M.reduce(function(E,d){return F(g,d)||E},!1);f||g.postMessage({event:"transmuxComplete",data:M[0]}),g.postMessage({event:"flush",data:S})}function N(g){return!g.audio&&!g.video&&!g.text&&!g.id3&&!g.initSegment}},"./src/demux/transmuxer.ts":(O,I,s)=>{s.r(I),s.d(I,{TransmuxConfig:()=>l,TransmuxState:()=>b,default:()=>S,isPromise:()=>d});var R=s("./src/events.ts"),A=s("./src/errors.ts"),w=s("./src/crypt/decrypter.ts"),D=s("./src/demux/aacdemuxer.ts"),K=s("./src/demux/mp4demuxer.ts"),k=s("./src/demux/tsdemuxer.ts"),F=s("./src/demux/mp3demuxer.ts"),B=s("./src/remux/mp4-remuxer.ts"),P=s("./src/remux/passthrough-remuxer.ts"),N=s("./src/utils/logger.ts"),g;try{g=self.performance.now.bind(self.performance)}catch{N.logger.debug("Unable to use Performance API on this environment"),g=self.Date.now}var M=[{demux:K.default,remux:P.default},{demux:k.default,remux:B.default},{demux:D.default,remux:B.default},{demux:F.default,remux:B.default}],S=function(){function h(m,y,v,c,a){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=m,this.typeSupported=y,this.config=v,this.vendor=c,this.id=a}var u=h.prototype;return u.configure=function(y){this.transmuxConfig=y,this.decrypter&&this.decrypter.reset()},u.push=function(y,v,c,a){var T=this,o=c.transmuxing;o.executeStart=g();var _=new Uint8Array(y),L=this.currentTransmuxState,x=this.transmuxConfig;a&&(this.currentTransmuxState=a);var H=a||L,W=H.contiguous,U=H.discontinuity,G=H.trackSwitch,Y=H.accurateTimeOffset,j=H.timeOffset,X=H.initSegmentChange,q=x.audioCodec,J=x.videoCodec,V=x.defaultInitPts,Q=x.duration,ee=x.initSegmentData,Z=f(_,v);if(Z&&Z.method==="AES-128"){var re=this.getDecrypter();if(re.isSync()){var ae=re.softwareDecrypt(_,Z.key.buffer,Z.iv.buffer);if(!ae)return o.executeEnd=g(),E(c);_=new Uint8Array(ae)}else return this.decryptionPromise=re.webCryptoDecrypt(_,Z.key.buffer,Z.iv.buffer).then(function(oe){var ge=T.push(oe,null,c);return T.decryptionPromise=null,ge}),this.decryptionPromise}var le=this.needsProbing(U,G);le&&this.configureTransmuxer(_),(U||G||X||le)&&this.resetInitSegment(ee,q,J,Q,v),(U||X||le)&&this.resetInitialTimestamp(V),W||this.resetContiguity();var ne=this.transmux(_,Z,j,Y,c),ie=this.currentTransmuxState;return ie.contiguous=!0,ie.discontinuity=!1,ie.trackSwitch=!1,o.executeEnd=g(),ne},u.flush=function(y){var v=this,c=y.transmuxing;c.executeStart=g();var a=this.decrypter,T=this.currentTransmuxState,o=this.decryptionPromise;if(o)return o.then(function(){return v.flush(y)});var _=[],L=T.timeOffset;if(a){var x=a.flush();x&&_.push(this.push(x,null,y))}var H=this.demuxer,W=this.remuxer;if(!H||!W)return this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),c.executeEnd=g(),[E(y)];var U=H.flush(L);return d(U)?U.then(function(G){return v.flushRemux(_,G,y),_}):(this.flushRemux(_,U,y),_)},u.flushRemux=function(y,v,c){var a=v.audioTrack,T=v.videoTrack,o=v.id3Track,_=v.textTrack,L=this.currentTransmuxState,x=L.accurateTimeOffset,H=L.timeOffset;N.logger.log("[transmuxer.ts]: Flushed fragment "+c.sn+(c.part>-1?" p: "+c.part:"")+" of level "+c.level);var W=this.remuxer.remux(a,T,o,_,H,x,!0,this.id);y.push({remuxResult:W,chunkMeta:c}),c.transmuxing.executeEnd=g()},u.resetInitialTimestamp=function(y){var v=this.demuxer,c=this.remuxer;!v||!c||(v.resetTimeStamp(y),c.resetTimeStamp(y))},u.resetContiguity=function(){var y=this.demuxer,v=this.remuxer;!y||!v||(y.resetContiguity(),v.resetNextTimestamp())},u.resetInitSegment=function(y,v,c,a,T){var o=this.demuxer,_=this.remuxer;!o||!_||(o.resetInitSegment(y,v,c,a),_.resetInitSegment(y,v,c,T))},u.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},u.transmux=function(y,v,c,a,T){var o;return v&&v.method==="SAMPLE-AES"?o=this.transmuxSampleAes(y,v,c,a,T):o=this.transmuxUnencrypted(y,c,a,T),o},u.transmuxUnencrypted=function(y,v,c,a){var T=this.demuxer.demux(y,v,!1,!this.config.progressive),o=T.audioTrack,_=T.videoTrack,L=T.id3Track,x=T.textTrack,H=this.remuxer.remux(o,_,L,x,v,c,!1,this.id);return{remuxResult:H,chunkMeta:a}},u.transmuxSampleAes=function(y,v,c,a,T){var o=this;return this.demuxer.demuxSampleAes(y,v,c).then(function(_){var L=o.remuxer.remux(_.audioTrack,_.videoTrack,_.id3Track,_.textTrack,c,a,!1,o.id);return{remuxResult:L,chunkMeta:T}})},u.configureTransmuxer=function(y){for(var v=this.config,c=this.observer,a=this.typeSupported,T=this.vendor,o,_=0,L=M.length;_<L;_++)if(M[_].demux.probe(y)){o=M[_];break}o||(N.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),o={demux:K.default,remux:P.default});var x=this.demuxer,H=this.remuxer,W=o.remux,U=o.demux;(!H||!(H instanceof W))&&(this.remuxer=new W(c,v,a,T)),(!x||!(x instanceof U))&&(this.demuxer=new U(c,v,a),this.probe=U.probe)},u.needsProbing=function(y,v){return!this.demuxer||!this.remuxer||y||v},u.getDecrypter=function(){var y=this.decrypter;return y||(y=this.decrypter=new w.default(this.config)),y},h}();function f(h,u){var m=null;return h.byteLength>0&&u!=null&&u.key!=null&&u.iv!==null&&u.method!=null&&(m=u),m}var E=function(u){return{remuxResult:{},chunkMeta:u}};function d(h){return"then"in h&&h.then instanceof Function}var l=function(u,m,y,v,c){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=u,this.videoCodec=m,this.initSegmentData=y,this.duration=v,this.defaultInitPts=c},b=function(u,m,y,v,c,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=u,this.contiguous=m,this.accurateTimeOffset=y,this.trackSwitch=v,this.timeOffset=c,this.initSegmentChange=a}},"./src/demux/tsdemuxer.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>b});var R=s("./src/demux/adts.ts"),A=s("./src/demux/mpegaudio.ts"),w=s("./src/demux/exp-golomb.ts"),D=s("./src/demux/sample-aes.ts"),K=s("./src/events.ts"),k=s("./src/utils/mp4-tools.ts"),F=s("./src/utils/logger.ts"),B=s("./src/errors.ts"),P=s("./src/types/demuxer.ts");function N(){return N=Object.assign?Object.assign.bind():function(h){for(var u=1;u<arguments.length;u++){var m=arguments[u];for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])}return h},N.apply(this,arguments)}var g=188,M=function(){function h(m,y,v){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=m,this.config=y,this.typeSupported=v}h.probe=function(y){var v=h.syncOffset(y);return v>0&&F.logger.warn("MPEG2-TS detected but first sync word found @ offset "+v),v!==-1},h.syncOffset=function(y){for(var v=Math.min(g*5,y.length-g*2)+1,c=0;c<v;){if(y[c]===71&&y[c+g]===71)return c;c++}return-1},h.createTrack=function(y,v){return{container:y==="video"||y==="audio"?"video/mp2t":void 0,type:y,id:k.RemuxerTrackIdConfig[y],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:y==="audio"?v:void 0}};var u=h.prototype;return u.resetInitSegment=function(y,v,c,a){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=h.createTrack("video"),this._audioTrack=h.createTrack("audio",a),this._id3Track=h.createTrack("id3"),this._txtTrack=h.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=v,this.videoCodec=c,this._duration=a},u.resetTimeStamp=function(){},u.resetContiguity=function(){var y=this._audioTrack,v=this._avcTrack,c=this._id3Track;y&&(y.pesData=null),v&&(v.pesData=null),c&&(c.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},u.demux=function(y,v,c,a){c===void 0&&(c=!1),a===void 0&&(a=!1),c||(this.sampleAes=null);var T,o=this._avcTrack,_=this._audioTrack,L=this._id3Track,x=this._txtTrack,H=o.pid,W=o.pesData,U=_.pid,G=L.pid,Y=_.pesData,j=L.pesData,X=null,q=this.pmtParsed,J=this._pmtId,V=y.length;if(this.remainderData&&(y=(0,k.appendUint8Array)(this.remainderData,y),V=y.length,this.remainderData=null),V<g&&!a)return this.remainderData=y,{audioTrack:_,videoTrack:o,id3Track:L,textTrack:x};var Q=Math.max(0,h.syncOffset(y));V-=(V-Q)%g,V<y.byteLength&&!a&&(this.remainderData=new Uint8Array(y.buffer,V,y.buffer.byteLength-V));for(var ee=0,Z=Q;Z<V;Z+=g)if(y[Z]===71){var re=!!(y[Z+1]&64),ae=((y[Z+1]&31)<<8)+y[Z+2],le=(y[Z+3]&48)>>4,ne=void 0;if(le>1){if(ne=Z+5+y[Z+4],ne===Z+g)continue}else ne=Z+4;switch(ae){case H:re&&(W&&(T=d(W))&&this.parseAVCPES(o,x,T,!1),W={data:[],size:0}),W&&(W.data.push(y.subarray(ne,Z+g)),W.size+=Z+g-ne);break;case U:if(re){if(Y&&(T=d(Y)))switch(_.segmentCodec){case"aac":this.parseAACPES(_,T);break;case"mp3":this.parseMPEGPES(_,T);break}Y={data:[],size:0}}Y&&(Y.data.push(y.subarray(ne,Z+g)),Y.size+=Z+g-ne);break;case G:re&&(j&&(T=d(j))&&this.parseID3PES(L,T),j={data:[],size:0}),j&&(j.data.push(y.subarray(ne,Z+g)),j.size+=Z+g-ne);break;case 0:re&&(ne+=y[ne]+1),J=this._pmtId=f(y,ne);break;case J:{re&&(ne+=y[ne]+1);var ie=E(y,ne,this.typeSupported,c);H=ie.avc,H>0&&(o.pid=H),U=ie.audio,U>0&&(_.pid=U,_.segmentCodec=ie.segmentCodec),G=ie.id3,G>0&&(L.pid=G),X!==null&&!q&&(F.logger.log("unknown PID '"+X+"' in TS found"),X=null,Z=Q-188),q=this.pmtParsed=!0;break}case 17:case 8191:break;default:X=ae;break}}else ee++;ee>0&&this.observer.emit(K.Events.ERROR,K.Events.ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+ee+" TS packet/s that do not start with 0x47"}),o.pesData=W,_.pesData=Y,L.pesData=j;var oe={audioTrack:_,videoTrack:o,id3Track:L,textTrack:x};return a&&this.extractRemainingSamples(oe),oe},u.flush=function(){var y=this.remainderData;this.remainderData=null;var v;return y?v=this.demux(y,-1,!1,!0):v={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(v),this.sampleAes?this.decrypt(v,this.sampleAes):v},u.extractRemainingSamples=function(y){var v=y.audioTrack,c=y.videoTrack,a=y.id3Track,T=y.textTrack,o=c.pesData,_=v.pesData,L=a.pesData,x;if(o&&(x=d(o))?(this.parseAVCPES(c,T,x,!0),c.pesData=null):c.pesData=o,_&&(x=d(_))){switch(v.segmentCodec){case"aac":this.parseAACPES(v,x);break;case"mp3":this.parseMPEGPES(v,x);break}v.pesData=null}else _!=null&&_.size&&F.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=_;L&&(x=d(L))?(this.parseID3PES(a,x),a.pesData=null):a.pesData=L},u.demuxSampleAes=function(y,v,c){var a=this.demux(y,c,!0,!this.config.progressive),T=this.sampleAes=new D.default(this.observer,this.config,v);return this.decrypt(a,T)},u.decrypt=function(y,v){return new Promise(function(c){var a=y.audioTrack,T=y.videoTrack;a.samples&&a.segmentCodec==="aac"?v.decryptAacSamples(a.samples,0,function(){T.samples?v.decryptAvcSamples(T.samples,0,0,function(){c(y)}):c(y)}):T.samples&&v.decryptAvcSamples(T.samples,0,0,function(){c(y)})})},u.destroy=function(){this._duration=0},u.parseAVCPES=function(y,v,c,a){var T=this,o=this.parseAVCNALu(y,c.data),_=this.avcSample,L,x=!1;c.data=null,_&&o.length&&!y.audFound&&(l(_,y),_=this.avcSample=S(!1,c.pts,c.dts,"")),o.forEach(function(H){switch(H.type){case 1:{L=!0,_||(_=T.avcSample=S(!0,c.pts,c.dts,"")),_.frame=!0;var W=H.data;if(x&&W.length>4){var U=new w.default(W).readSliceType();(U===2||U===4||U===7||U===9)&&(_.key=!0)}break}case 5:L=!0,_||(_=T.avcSample=S(!0,c.pts,c.dts,"")),_.key=!0,_.frame=!0;break;case 6:{L=!0,(0,k.parseSEIMessageFromNALu)(H.data,1,c.pts,v.samples);break}case 7:if(L=!0,x=!0,!y.sps){var G=new w.default(H.data),Y=G.readSPS();y.width=Y.width,y.height=Y.height,y.pixelRatio=Y.pixelRatio,y.sps=[H.data],y.duration=T._duration;for(var j=H.data.subarray(1,4),X="avc1.",q=0;q<3;q++){var J=j[q].toString(16);J.length<2&&(J="0"+J),X+=J}y.codec=X}break;case 8:L=!0,y.pps||(y.pps=[H.data]);break;case 9:L=!1,y.audFound=!0,_&&l(_,y),_=T.avcSample=S(!1,c.pts,c.dts,"");break;case 12:L=!0;break;default:L=!1,_&&(_.debug+="unknown NAL "+H.type+" ");break}if(_&&L){var V=_.units;V.push(H)}}),a&&_&&(l(_,y),this.avcSample=null)},u.getLastNalUnit=function(y){var v,c=this.avcSample,a;if((!c||c.units.length===0)&&(c=y[y.length-1]),(v=c)!==null&&v!==void 0&&v.units){var T=c.units;a=T[T.length-1]}return a},u.parseAVCNALu=function(y,v){var c=v.byteLength,a=y.naluState||0,T=a,o=[],_=0,L,x,H,W=-1,U=0;for(a===-1&&(W=0,U=v[0]&31,a=0,_=1);_<c;){if(L=v[_++],!a){a=L?0:1;continue}if(a===1){a=L?0:2;continue}if(!L)a=3;else if(L===1){if(W>=0){var G={data:v.subarray(W,_-a-1),type:U};o.push(G)}else{var Y=this.getLastNalUnit(y.samples);if(Y&&(T&&_<=4-T&&Y.state&&(Y.data=Y.data.subarray(0,Y.data.byteLength-T)),x=_-a-1,x>0)){var j=new Uint8Array(Y.data.byteLength+x);j.set(Y.data,0),j.set(v.subarray(0,x),Y.data.byteLength),Y.data=j,Y.state=0}}_<c?(H=v[_]&31,W=_,U=H,a=0):a=-1}else a=0}if(W>=0&&a>=0){var X={data:v.subarray(W,c),type:U,state:a};o.push(X)}if(o.length===0){var q=this.getLastNalUnit(y.samples);if(q){var J=new Uint8Array(q.data.byteLength+v.byteLength);J.set(q.data,0),J.set(v,q.data.byteLength),q.data=J}}return y.naluState=a,o},u.parseAACPES=function(y,v){var c=0,a=this.aacOverFlow,T=v.data;if(a){this.aacOverFlow=null;var o=a.missing,_=a.sample.unit.byteLength;if(o===-1){var L=new Uint8Array(_+T.byteLength);L.set(a.sample.unit,0),L.set(T,_),T=L}else{var x=_-o;a.sample.unit.set(T.subarray(0,o),x),y.samples.push(a.sample),c=a.missing}}var H,W;for(H=c,W=T.length;H<W-1&&!R.isHeader(T,H);H++);if(H!==c){var U,G;if(H<W-1?(U="AAC PES did not start with ADTS header,offset:"+H,G=!1):(U="no ADTS header found in AAC PES",G=!0),F.logger.warn("parsing error:"+U),this.observer.emit(K.Events.ERROR,K.Events.ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.FRAG_PARSING_ERROR,fatal:G,reason:U}),G)return}R.initTrackConfig(y,this.observer,T,H,this.audioCodec);var Y;if(v.pts!==void 0)Y=v.pts;else if(a){var j=R.getFrameDuration(y.samplerate);Y=a.sample.pts+j}else{F.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var X=0,q;H<W;)if(q=R.appendFrame(y,T,H,Y,X),H+=q.length,q.missing){this.aacOverFlow=q;break}else for(X++;H<W-1&&!R.isHeader(T,H);H++);},u.parseMPEGPES=function(y,v){var c=v.data,a=c.length,T=0,o=0,_=v.pts;if(_===void 0){F.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<a;)if(A.isHeader(c,o)){var L=A.appendFrame(y,c,o,_,T);if(L)o+=L.length,T++;else break}else o++},u.parseID3PES=function(y,v){if(v.pts===void 0){F.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var c=N({},v,{type:this._avcTrack?P.MetadataSchema.emsg:P.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});y.samples.push(c)},h}();function S(h,u,m,y){return{key:h,frame:!1,pts:u,dts:m,units:[],debug:y,length:0}}function f(h,u){return(h[u+10]&31)<<8|h[u+11]}function E(h,u,m,y){var v={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},c=(h[u+1]&15)<<8|h[u+2],a=u+3+c-4,T=(h[u+10]&15)<<8|h[u+11];for(u+=12+T;u<a;){var o=(h[u+1]&31)<<8|h[u+2];switch(h[u]){case 207:if(!y){F.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:v.audio===-1&&(v.audio=o);break;case 21:v.id3===-1&&(v.id3=o);break;case 219:if(!y){F.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:v.avc===-1&&(v.avc=o);break;case 3:case 4:m.mpeg!==!0&&m.mp3!==!0?F.logger.log("MPEG audio found, not supported in this browser"):v.audio===-1&&(v.audio=o,v.segmentCodec="mp3");break;case 36:F.logger.warn("Unsupported HEVC stream type found");break}u+=((h[u+3]&15)<<8|h[u+4])+5}return v}function d(h){var u=0,m,y,v,c,a,T=h.data;if(!h||h.size===0)return null;for(;T[0].length<19&&T.length>1;){var o=new Uint8Array(T[0].length+T[1].length);o.set(T[0]),o.set(T[1],T[0].length),T[0]=o,T.splice(1,1)}m=T[0];var _=(m[0]<<16)+(m[1]<<8)+m[2];if(_===1){if(y=(m[4]<<8)+m[5],y&&y>h.size-6)return null;var L=m[7];L&192&&(c=(m[9]&14)*536870912+(m[10]&255)*4194304+(m[11]&254)*16384+(m[12]&255)*128+(m[13]&254)/2,L&64?(a=(m[14]&14)*536870912+(m[15]&255)*4194304+(m[16]&254)*16384+(m[17]&255)*128+(m[18]&254)/2,c-a>54e5&&(F.logger.warn(Math.round((c-a)/9e4)+"s delta between PTS and DTS, align them"),c=a)):a=c),v=m[8];var x=v+9;if(h.size<=x)return null;h.size-=x;for(var H=new Uint8Array(h.size),W=0,U=T.length;W<U;W++){m=T[W];var G=m.byteLength;if(x)if(x>G){x-=G;continue}else m=m.subarray(x),G-=x,x=0;H.set(m,u),u+=G}return y&&(y-=v+3),{data:H,pts:c,dts:a,len:y}}return null}function l(h,u){if(h.units.length&&h.frame){if(h.pts===void 0){var m=u.samples,y=m.length;if(y){var v=m[y-1];h.pts=v.pts,h.dts=v.dts}else{u.dropped++;return}}u.samples.push(h)}h.debug.length&&F.logger.log(h.pts+"/"+h.dts+":"+h.debug)}const b=M},"./src/demux/webworkify-webpack.js":(O,I,s)=>{s.r(I),s.d(I,{default:()=>g});var R=function(){var S=ENTRY_MODULE,f={},E=function l(b){var h=f[b];if(h!==void 0)return h.exports;var u=f[b]={exports:{}};return S[b].call(u.exports,u,u.exports,l),u.exports};E.m=S,function(){E.n=function(l){var b=l&&l.__esModule?function(){return l.default}:function(){return l};return E.d(b,{a:b}),b}}(),function(){E.d=function(l,b){for(var h in b)E.o(b,h)&&!E.o(l,h)&&Object.defineProperty(l,h,{enumerable:!0,get:b[h]})}}(),function(){E.o=function(l,b){return Object.prototype.hasOwnProperty.call(l,b)}}(),function(){E.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})}}();var d=E(ENTRY_MODULE);return d.default||d},A=R.toString().split("ENTRY_MODULE"),w="[\\.|\\-|\\+|\\w|/|@]+",D="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+w+").*?\\)";function K(M){return(M+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function k(M){return!isNaN(1*M)}function F(M,S,f){var E={};E[f]=[];var d=S.toString().replace(/^"[^"]+"/,"function"),l=d.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||d.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!l)return E;for(var b=l[1],h=new RegExp("(\\\\n|\\W)"+K(b)+D,"g"),u;u=h.exec(d);)u[3]!=="dll-reference"&&E[f].push(u[3]);for(h=new RegExp("\\("+K(b)+'\\("(dll-reference\\s('+w+'))"\\)\\)'+D,"g");u=h.exec(d);)M[u[2]]||(E[f].push(u[1]),M[u[2]]=s(u[1]).m),E[u[2]]=E[u[2]]||[],E[u[2]].push(u[4]);for(var m=Object.keys(E),y=0;y<m.length;y++)for(var v=0;v<E[m[y]].length;v++)k(E[m[y]][v])&&(E[m[y]][v]=1*E[m[y]][v]);return E}function B(M){var S=Object.keys(M);return S.reduce(function(f,E){return f||M[E].length>0},!1)}function P(M,S){for(var f={main:[S]},E={main:[]},d={main:{}};B(f);)for(var l=Object.keys(f),b=0;b<l.length;b++){var h=l[b],u=f[h],m=u.pop();if(d[h]=d[h]||{},!(d[h][m]||!M[h][m])){d[h][m]=!0,E[h]=E[h]||[],E[h].push(m);for(var y=F(M,M[h][m],h),v=Object.keys(y),c=0;c<v.length;c++)f[v[c]]=f[v[c]]||[],f[v[c]]=f[v[c]].concat(y[v[c]])}}return E}function N(M,S,f,E){var d=M[E].map(function(l){return'"'+l+'": '+S[E][l].toString().replace(/^"[^"]+"/,"function")}).join(",");return A[0]+"{"+d+"}"+A[1]+'"'+f+'"'+A[2]}function g(M,S){S=S||{};var f={main:s.m},E=S.all?{main:Object.keys(f.main)}:P(f,M),d="";Object.keys(E).filter(function(m){return m!=="main"}).forEach(function(m){for(var y=0;E[m][y];)y++;E[m].push(y),f[m][y]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",d=d+("var "+m+" = ("+N(E,f,y,modules)+`)();
`)}),d=d+("new (("+N(E,f,M,"main")+")())(self);");var l=new window.Blob([d],{type:"text/javascript"}),b=window.URL||window.webkitURL||window.mozURL||window.msURL,h=b.createObjectURL(l),u=new window.Worker(h);return u.objectURL=h,u}},"./src/errors.ts":(O,I,s)=>{s.r(I),s.d(I,{ErrorDetails:()=>A,ErrorTypes:()=>R});var R;(function(w){w.NETWORK_ERROR="networkError",w.MEDIA_ERROR="mediaError",w.KEY_SYSTEM_ERROR="keySystemError",w.MUX_ERROR="muxError",w.OTHER_ERROR="otherError"})(R||(R={}));var A;(function(w){w.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",w.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",w.KEY_SYSTEM_NO_SESSION="keySystemNoSession",w.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",w.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",w.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",w.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",w.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",w.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",w.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",w.MANIFEST_LOAD_ERROR="manifestLoadError",w.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",w.MANIFEST_PARSING_ERROR="manifestParsingError",w.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",w.LEVEL_EMPTY_ERROR="levelEmptyError",w.LEVEL_LOAD_ERROR="levelLoadError",w.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",w.LEVEL_SWITCH_ERROR="levelSwitchError",w.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",w.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",w.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",w.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",w.FRAG_LOAD_ERROR="fragLoadError",w.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",w.FRAG_DECRYPT_ERROR="fragDecryptError",w.FRAG_PARSING_ERROR="fragParsingError",w.REMUX_ALLOC_ERROR="remuxAllocError",w.KEY_LOAD_ERROR="keyLoadError",w.KEY_LOAD_TIMEOUT="keyLoadTimeOut",w.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",w.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",w.BUFFER_APPEND_ERROR="bufferAppendError",w.BUFFER_APPENDING_ERROR="bufferAppendingError",w.BUFFER_STALLED_ERROR="bufferStalledError",w.BUFFER_FULL_ERROR="bufferFullError",w.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",w.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",w.INTERNAL_EXCEPTION="internalException",w.INTERNAL_ABORTED="aborted",w.UNKNOWN="unknown"})(A||(A={}))},"./src/events.ts":(O,I,s)=>{s.r(I),s.d(I,{Events:()=>R});var R;(function(A){A.MEDIA_ATTACHING="hlsMediaAttaching",A.MEDIA_ATTACHED="hlsMediaAttached",A.MEDIA_DETACHING="hlsMediaDetaching",A.MEDIA_DETACHED="hlsMediaDetached",A.BUFFER_RESET="hlsBufferReset",A.BUFFER_CODECS="hlsBufferCodecs",A.BUFFER_CREATED="hlsBufferCreated",A.BUFFER_APPENDING="hlsBufferAppending",A.BUFFER_APPENDED="hlsBufferAppended",A.BUFFER_EOS="hlsBufferEos",A.BUFFER_FLUSHING="hlsBufferFlushing",A.BUFFER_FLUSHED="hlsBufferFlushed",A.MANIFEST_LOADING="hlsManifestLoading",A.MANIFEST_LOADED="hlsManifestLoaded",A.MANIFEST_PARSED="hlsManifestParsed",A.LEVEL_SWITCHING="hlsLevelSwitching",A.LEVEL_SWITCHED="hlsLevelSwitched",A.LEVEL_LOADING="hlsLevelLoading",A.LEVEL_LOADED="hlsLevelLoaded",A.LEVEL_UPDATED="hlsLevelUpdated",A.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",A.LEVELS_UPDATED="hlsLevelsUpdated",A.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",A.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",A.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",A.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",A.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",A.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",A.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",A.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",A.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",A.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",A.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",A.CUES_PARSED="hlsCuesParsed",A.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",A.INIT_PTS_FOUND="hlsInitPtsFound",A.FRAG_LOADING="hlsFragLoading",A.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",A.FRAG_LOADED="hlsFragLoaded",A.FRAG_DECRYPTED="hlsFragDecrypted",A.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",A.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",A.FRAG_PARSING_METADATA="hlsFragParsingMetadata",A.FRAG_PARSED="hlsFragParsed",A.FRAG_BUFFERED="hlsFragBuffered",A.FRAG_CHANGED="hlsFragChanged",A.FPS_DROP="hlsFpsDrop",A.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",A.ERROR="hlsError",A.DESTROYING="hlsDestroying",A.KEY_LOADING="hlsKeyLoading",A.KEY_LOADED="hlsKeyLoaded",A.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",A.BACK_BUFFER_REACHED="hlsBackBufferReached"})(R||(R={}))},"./src/hls.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>u});var R=s("./node_modules/url-toolkit/src/url-toolkit.js"),A=s("./src/loader/playlist-loader.ts"),w=s("./src/controller/id3-track-controller.ts"),D=s("./src/controller/latency-controller.ts"),K=s("./src/controller/level-controller.ts"),k=s("./src/controller/fragment-tracker.ts"),F=s("./src/loader/key-loader.ts"),B=s("./src/controller/stream-controller.ts"),P=s("./src/is-supported.ts"),N=s("./src/utils/logger.ts"),g=s("./src/config.ts"),M=s("./node_modules/eventemitter3/index.js"),S=s("./src/events.ts"),f=s("./src/errors.ts"),E=s("./src/types/level.ts");function d(m,y){for(var v=0;v<y.length;v++){var c=y[v];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(m,b(c.key),c)}}function l(m,y,v){return y&&d(m.prototype,y),v&&d(m,v),Object.defineProperty(m,"prototype",{writable:!1}),m}function b(m){var y=h(m,"string");return typeof y=="symbol"?y:String(y)}function h(m,y){if(typeof m!="object"||m===null)return m;var v=m[Symbol.toPrimitive];if(v!==void 0){var c=v.call(m,y||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(m)}var u=function(){m.isSupported=function(){return(0,P.isSupported)()};function m(v){v===void 0&&(v={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new M.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var c=this.config=(0,g.mergeConfig)(m.DefaultConfig,v);this.userConfig=v,(0,N.enableLogs)(c.debug,"Hls instance"),this._autoLevelCapping=-1,c.progressive&&(0,g.enableStreamingMode)(c);var a=c.abrController,T=c.bufferController,o=c.capLevelController,_=c.fpsController,L=this.abrController=new a(this),x=this.bufferController=new T(this),H=this.capLevelController=new o(this),W=new _(this),U=new A.default(this),G=new w.default(this),Y=this.levelController=new K.default(this),j=new k.FragmentTracker(this),X=new F.default(this.config),q=this.streamController=new B.default(this,j,X);H.setStreamController(q),W.setStreamController(q);var J=[U,Y,q];this.networkControllers=J;var V=[L,x,H,W,G,j];this.audioTrackController=this.createController(c.audioTrackController,J);var Q=c.audioStreamController;Q&&J.push(new Q(this,j,X)),this.subtitleTrackController=this.createController(c.subtitleTrackController,J);var ee=c.subtitleStreamController;ee&&J.push(new ee(this,j,X)),this.createController(c.timelineController,V),X.emeController=this.emeController=this.createController(c.emeController,V),this.cmcdController=this.createController(c.cmcdController,V),this.latencyController=this.createController(D.default,V),this.coreComponents=V}var y=m.prototype;return y.createController=function(c,a){if(c){var T=new c(this);return a&&a.push(T),T}return null},y.on=function(c,a,T){T===void 0&&(T=this),this._emitter.on(c,a,T)},y.once=function(c,a,T){T===void 0&&(T=this),this._emitter.once(c,a,T)},y.removeAllListeners=function(c){this._emitter.removeAllListeners(c)},y.off=function(c,a,T,o){T===void 0&&(T=this),this._emitter.off(c,a,T,o)},y.listeners=function(c){return this._emitter.listeners(c)},y.emit=function(c,a,T){return this._emitter.emit(c,a,T)},y.trigger=function(c,a){if(this.config.debug)return this.emit(c,c,a);try{return this.emit(c,c,a)}catch(T){N.logger.error("An internal error happened while handling event "+c+'. Error message: "'+T.message+'". Here is a stacktrace:',T),this.trigger(S.Events.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:c,error:T})}return!1},y.listenerCount=function(c){return this._emitter.listenerCount(c)},y.destroy=function(){N.logger.log("destroy"),this.trigger(S.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(c){return c.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(c){return c.destroy()}),this.coreComponents.length=0},y.attachMedia=function(c){N.logger.log("attachMedia"),this._media=c,this.trigger(S.Events.MEDIA_ATTACHING,{media:c})},y.detachMedia=function(){N.logger.log("detachMedia"),this.trigger(S.Events.MEDIA_DETACHING,void 0),this._media=null},y.loadSource=function(c){this.stopLoad();var a=this.media,T=this.url,o=this.url=R.buildAbsoluteURL(self.location.href,c,{alwaysNormalize:!0});N.logger.log("loadSource:"+o),a&&T&&T!==o&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(a)),this.trigger(S.Events.MANIFEST_LOADING,{url:c})},y.startLoad=function(c){c===void 0&&(c=-1),N.logger.log("startLoad("+c+")"),this.networkControllers.forEach(function(a){a.startLoad(c)})},y.stopLoad=function(){N.logger.log("stopLoad"),this.networkControllers.forEach(function(c){c.stopLoad()})},y.swapAudioCodec=function(){N.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},y.recoverMediaError=function(){N.logger.log("recoverMediaError");var c=this._media;this.detachMedia(),c&&this.attachMedia(c)},y.removeLevel=function(c,a){a===void 0&&(a=0),this.levelController.removeLevel(c,a)},l(m,[{key:"levels",get:function(){var c=this.levelController.levels;return c||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(c){N.logger.log("set currentLevel:"+c),this.loadLevel=c,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(c){N.logger.log("set nextLevel:"+c),this.levelController.manualLevel=c,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(c){N.logger.log("set loadLevel:"+c),this.levelController.manualLevel=c}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(c){this.levelController.nextLoadLevel=c}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(c){N.logger.log("set firstLevel:"+c),this.levelController.firstLevel=c}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(c){N.logger.log("set startLevel:"+c),c!==-1&&(c=Math.max(c,this.minAutoLevel)),this.levelController.startLevel=c}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(c){var a=!!c;a!==this.config.capLevelToPlayerSize&&(a?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=a)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(c){this._autoLevelCapping!==c&&(N.logger.log("set autoLevelCapping:"+c),this._autoLevelCapping=c)}},{key:"bandwidthEstimate",get:function(){var c=this.abrController.bwEstimator;return c?c.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(c){E.HdcpLevels.indexOf(c)>-1&&(this._maxHdcpLevel=c)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var c=this.levels,a=this.config.minAutoBitrate;if(!c)return 0;for(var T=c.length,o=0;o<T;o++)if(c[o].maxBitrate>=a)return o;return 0}},{key:"maxAutoLevel",get:function(){var c=this.levels,a=this.autoLevelCapping,T=this.maxHdcpLevel,o;if(a===-1&&c&&c.length?o=c.length-1:o=a,T)for(var _=o;_--;){var L=c[_].attrs["HDCP-LEVEL"];if(L&&L<=T)return _}return o}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(c){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,c)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var c=this.audioTrackController;return c?c.audioTracks:[]}},{key:"audioTrack",get:function(){var c=this.audioTrackController;return c?c.audioTrack:-1},set:function(c){var a=this.audioTrackController;a&&(a.audioTrack=c)}},{key:"subtitleTracks",get:function(){var c=this.subtitleTrackController;return c?c.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var c=this.subtitleTrackController;return c?c.subtitleTrack:-1},set:function(c){var a=this.subtitleTrackController;a&&(a.subtitleTrack=c)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var c=this.subtitleTrackController;return c?c.subtitleDisplay:!1},set:function(c){var a=this.subtitleTrackController;a&&(a.subtitleDisplay=c)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(c){this.config.lowLatencyMode=c}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.3.1"}},{key:"Events",get:function(){return S.Events}},{key:"ErrorTypes",get:function(){return f.ErrorTypes}},{key:"ErrorDetails",get:function(){return f.ErrorDetails}},{key:"DefaultConfig",get:function(){return m.defaultConfig?m.defaultConfig:g.hlsDefaultConfig},set:function(c){m.defaultConfig=c}}]),m}();u.defaultConfig=void 0},"./src/is-supported.ts":(O,I,s)=>{s.r(I),s.d(I,{changeTypeSupported:()=>D,isSupported:()=>w});var R=s("./src/utils/mediasource-helper.ts");function A(){return self.SourceBuffer||self.WebKitSourceBuffer}function w(){var K=(0,R.getMediaSource)();if(!K)return!1;var k=A(),F=K&&typeof K.isTypeSupported=="function"&&K.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),B=!k||k.prototype&&typeof k.prototype.appendBuffer=="function"&&typeof k.prototype.remove=="function";return!!F&&!!B}function D(){var K,k=A();return typeof(k==null||(K=k.prototype)===null||K===void 0?void 0:K.changeType)=="function"}},"./src/loader/date-range.ts":(O,I,s)=>{s.r(I),s.d(I,{DateRange:()=>N,DateRangeAttribute:()=>P});var R=s("./src/polyfills/number.ts"),A=s("./src/utils/attr-list.ts"),w=s("./src/utils/logger.ts");function D(){return D=Object.assign?Object.assign.bind():function(g){for(var M=1;M<arguments.length;M++){var S=arguments[M];for(var f in S)Object.prototype.hasOwnProperty.call(S,f)&&(g[f]=S[f])}return g},D.apply(this,arguments)}function K(g,M){for(var S=0;S<M.length;S++){var f=M[S];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(g,F(f.key),f)}}function k(g,M,S){return M&&K(g.prototype,M),S&&K(g,S),Object.defineProperty(g,"prototype",{writable:!1}),g}function F(g){var M=B(g,"string");return typeof M=="symbol"?M:String(M)}function B(g,M){if(typeof g!="object"||g===null)return g;var S=g[Symbol.toPrimitive];if(S!==void 0){var f=S.call(g,M||"default");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return(M==="string"?String:Number)(g)}var P;(function(g){g.ID="ID",g.CLASS="CLASS",g.START_DATE="START-DATE",g.DURATION="DURATION",g.END_DATE="END-DATE",g.END_ON_NEXT="END-ON-NEXT",g.PLANNED_DURATION="PLANNED-DURATION",g.SCTE35_OUT="SCTE35-OUT",g.SCTE35_IN="SCTE35-IN"})(P||(P={}));var N=function(){function g(M,S){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,S){var f=S.attr;for(var E in f)if(Object.prototype.hasOwnProperty.call(M,E)&&M[E]!==f[E]){w.logger.warn('DATERANGE tag attribute: "'+E+'" does not match for tags with ID: "'+M.ID+'"'),this._badValueForSameId=E;break}M=D(new A.AttrList({}),f,M)}if(this.attr=M,this._startDate=new Date(M[P.START_DATE]),P.END_DATE in this.attr){var d=new Date(this.attr[P.END_DATE]);(0,R.isFiniteNumber)(d.getTime())&&(this._endDate=d)}}return k(g,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var S=this.duration;return S!==null?new Date(this._startDate.getTime()+S*1e3):null}},{key:"duration",get:function(){if(P.DURATION in this.attr){var S=this.attr.decimalFloatingPoint(P.DURATION);if((0,R.isFiniteNumber)(S))return S}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return P.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(P.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(P.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,R.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),g}()},"./src/loader/fragment-loader.ts":(O,I,s)=>{s.r(I),s.d(I,{LoadError:()=>S,default:()=>g});var R=s("./src/polyfills/number.ts"),A=s("./src/errors.ts");function w(f,E){f.prototype=Object.create(E.prototype),f.prototype.constructor=f,B(f,E)}function D(f){var E=typeof Map=="function"?new Map:void 0;return D=function(l){if(l===null||!F(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(typeof E<"u"){if(E.has(l))return E.get(l);E.set(l,b)}function b(){return K(l,arguments,P(this).constructor)}return b.prototype=Object.create(l.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),B(b,l)},D(f)}function K(f,E,d){return k()?K=Reflect.construct.bind():K=function(b,h,u){var m=[null];m.push.apply(m,h);var y=Function.bind.apply(b,m),v=new y;return u&&B(v,u.prototype),v},K.apply(null,arguments)}function k(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function F(f){return Function.toString.call(f).indexOf("[native code]")!==-1}function B(f,E){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,b){return l.__proto__=b,l},B(f,E)}function P(f){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},P(f)}var N=Math.pow(2,17),g=function(){function f(d){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=d}var E=f.prototype;return E.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},E.abort=function(){this.loader&&this.loader.abort()},E.load=function(l,b){var h=this,u=l.url;if(!u)return Promise.reject(new S({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,networkDetails:null},"Fragment does not have a "+(u?"part list":"url")));this.abort();var m=this.config,y=m.fLoader,v=m.loader;return new Promise(function(c,a){h.loader&&h.loader.destroy();var T=h.loader=l.loader=y?new y(m):new v(m),o=M(l),_={timeout:m.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:m.fragLoadingMaxRetryTimeout,highWaterMark:l.sn==="initSegment"?1/0:N};l.stats=T.stats,T.load(o,_,{onSuccess:function(x,H,W,U){h.resetLoader(l,T);var G=x.data;W.resetIV&&l.decryptdata&&(l.decryptdata.iv=new Uint8Array(G.slice(0,16)),G=G.slice(16)),c({frag:l,part:null,payload:G,networkDetails:U})},onError:function(x,H,W){h.resetLoader(l,T),a(new S({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,response:x,networkDetails:W}))},onAbort:function(x,H,W){h.resetLoader(l,T),a(new S({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:l,networkDetails:W}))},onTimeout:function(x,H,W){h.resetLoader(l,T),a(new S({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,networkDetails:W}))},onProgress:function(x,H,W,U){b&&b({frag:l,part:null,payload:W,networkDetails:U})}})})},E.loadPart=function(l,b,h){var u=this;this.abort();var m=this.config,y=m.fLoader,v=m.loader;return new Promise(function(c,a){u.loader&&u.loader.destroy();var T=u.loader=l.loader=y?new y(m):new v(m),o=M(l,b),_={timeout:m.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:m.fragLoadingMaxRetryTimeout,highWaterMark:N};b.stats=T.stats,T.load(o,_,{onSuccess:function(x,H,W,U){u.resetLoader(l,T),u.updateStatsFromPart(l,b);var G={frag:l,part:b,payload:x.data,networkDetails:U};h(G),c(G)},onError:function(x,H,W){u.resetLoader(l,T),a(new S({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,part:b,response:x,networkDetails:W}))},onAbort:function(x,H,W){l.stats.aborted=b.stats.aborted,u.resetLoader(l,T),a(new S({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:l,part:b,networkDetails:W}))},onTimeout:function(x,H,W){u.resetLoader(l,T),a(new S({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,part:b,networkDetails:W}))}})})},E.updateStatsFromPart=function(l,b){var h=l.stats,u=b.stats,m=u.total;if(h.loaded+=u.loaded,m){var y=Math.round(l.duration/b.duration),v=Math.min(Math.round(h.loaded/m),y),c=y-v,a=c*Math.round(h.loaded/v);h.total=h.loaded+a}else h.total=Math.max(h.loaded,h.total);var T=h.loading,o=u.loading;T.start?T.first+=o.first-o.start:(T.start=o.start,T.first=o.first),T.end=o.end},E.resetLoader=function(l,b){l.loader=null,this.loader===b&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),b.destroy()},f}();function M(f,E){E===void 0&&(E=null);var d=E||f,l={frag:f,part:E,responseType:"arraybuffer",url:d.url,headers:{},rangeStart:0,rangeEnd:0},b=d.byteRangeStartOffset,h=d.byteRangeEndOffset;if((0,R.isFiniteNumber)(b)&&(0,R.isFiniteNumber)(h)){var u,m=b,y=h;if(f.sn==="initSegment"&&((u=f.decryptdata)===null||u===void 0?void 0:u.method)==="AES-128"){var v=h-b;v%16&&(y=h+(16-v%16)),b!==0&&(l.resetIV=!0,m=b-16)}l.rangeStart=m,l.rangeEnd=y}return l}var S=function(f){w(E,f);function E(d){for(var l,b=arguments.length,h=new Array(b>1?b-1:0),u=1;u<b;u++)h[u-1]=arguments[u];return l=f.call.apply(f,[this].concat(h))||this,l.data=void 0,l.data=d,l}return E}(D(Error))},"./src/loader/fragment.ts":(O,I,s)=>{s.r(I),s.d(I,{BaseSegment:()=>g,ElementaryStreamTypes:()=>N,Fragment:()=>M,Part:()=>S});var R=s("./src/polyfills/number.ts"),A=s("./node_modules/url-toolkit/src/url-toolkit.js"),w=s("./src/loader/load-stats.ts");function D(f,E){f.prototype=Object.create(E.prototype),f.prototype.constructor=f,K(f,E)}function K(f,E){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,b){return l.__proto__=b,l},K(f,E)}function k(f,E){for(var d=0;d<E.length;d++){var l=E[d];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(f,B(l.key),l)}}function F(f,E,d){return E&&k(f.prototype,E),d&&k(f,d),Object.defineProperty(f,"prototype",{writable:!1}),f}function B(f){var E=P(f,"string");return typeof E=="symbol"?E:String(E)}function P(f,E){if(typeof f!="object"||f===null)return f;var d=f[Symbol.toPrimitive];if(d!==void 0){var l=d.call(f,E||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(E==="string"?String:Number)(f)}var N;(function(f){f.AUDIO="audio",f.VIDEO="video",f.AUDIOVIDEO="audiovideo"})(N||(N={}));var g=function(){function f(d){var l;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(l={},l[N.AUDIO]=null,l[N.VIDEO]=null,l[N.AUDIOVIDEO]=null,l),this.baseurl=d}var E=f.prototype;return E.setByteRange=function(l,b){var h=l.split("@",2),u=[];h.length===1?u[0]=b?b.byteRangeEndOffset:0:u[0]=parseInt(h[1]),u[1]=parseInt(h[0])+u[0],this._byteRange=u},F(f,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,A.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(l){this._url=l}}]),f}(),M=function(f){D(E,f);function E(l,b){var h;return h=f.call(this,b)||this,h._decryptdata=null,h.rawProgramDateTime=null,h.programDateTime=null,h.tagList=[],h.duration=0,h.sn=0,h.levelkeys=void 0,h.type=void 0,h.loader=null,h.keyLoader=null,h.level=-1,h.cc=0,h.startPTS=void 0,h.endPTS=void 0,h.appendedPTS=void 0,h.startDTS=void 0,h.endDTS=void 0,h.start=0,h.deltaPTS=void 0,h.maxStartPTS=void 0,h.minEndPTS=void 0,h.stats=new w.LoadStats,h.urlId=0,h.data=void 0,h.bitrateTest=!1,h.title=null,h.initSegment=null,h.endList=void 0,h.type=l,h}var d=E.prototype;return d.setKeyFormat=function(b){if(this.levelkeys){var h=this.levelkeys[b];h&&!this._decryptdata&&(this._decryptdata=h.getDecryptData(this.sn))}},d.abortRequests=function(){var b,h;(b=this.loader)===null||b===void 0||b.abort(),(h=this.keyLoader)===null||h===void 0||h.abort()},d.setElementaryStreamInfo=function(b,h,u,m,y,v){v===void 0&&(v=!1);var c=this.elementaryStreams,a=c[b];if(!a){c[b]={startPTS:h,endPTS:u,startDTS:m,endDTS:y,partial:v};return}a.startPTS=Math.min(a.startPTS,h),a.endPTS=Math.max(a.endPTS,u),a.startDTS=Math.min(a.startDTS,m),a.endDTS=Math.max(a.endDTS,y)},d.clearElementaryStreamInfo=function(){var b=this.elementaryStreams;b[N.AUDIO]=null,b[N.VIDEO]=null,b[N.AUDIOVIDEO]=null},F(E,[{key:"decryptdata",get:function(){var b=this.levelkeys;if(!b&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var h=this.levelkeys.identity;if(h)this._decryptdata=h.getDecryptData(this.sn);else{var u=Object.keys(this.levelkeys);if(u.length===1)return this._decryptdata=this.levelkeys[u[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,R.isFiniteNumber)(this.programDateTime))return null;var b=(0,R.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+b*1e3}},{key:"encrypted",get:function(){var b;if((b=this._decryptdata)!==null&&b!==void 0&&b.encrypted)return!0;if(this.levelkeys){var h=Object.keys(this.levelkeys),u=h.length;if(u>1||u===1&&this.levelkeys[h[0]].encrypted)return!0}return!1}}]),E}(g),S=function(f){D(E,f);function E(d,l,b,h,u){var m;m=f.call(this,b)||this,m.fragOffset=0,m.duration=0,m.gap=!1,m.independent=!1,m.relurl=void 0,m.fragment=void 0,m.index=void 0,m.stats=new w.LoadStats,m.duration=d.decimalFloatingPoint("DURATION"),m.gap=d.bool("GAP"),m.independent=d.bool("INDEPENDENT"),m.relurl=d.enumeratedString("URI"),m.fragment=l,m.index=h;var y=d.enumeratedString("BYTERANGE");return y&&m.setByteRange(y,u),u&&(m.fragOffset=u.fragOffset+u.duration),m}return F(E,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var l=this.elementaryStreams;return!!(l.audio||l.video||l.audiovideo)}}]),E}(g)},"./src/loader/key-loader.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>w});var R=s("./src/errors.ts"),A=s("./src/loader/fragment-loader.ts"),w=function(){function D(k){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=k}var K=D.prototype;return K.abort=function(){for(var F in this.keyUriToKeyInfo){var B=this.keyUriToKeyInfo[F].loader;B&&B.abort()}},K.detach=function(){for(var F in this.keyUriToKeyInfo){var B=this.keyUriToKeyInfo[F];(B.mediaKeySessionContext||B.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[F]}},K.destroy=function(){this.detach();for(var F in this.keyUriToKeyInfo){var B=this.keyUriToKeyInfo[F].loader;B&&B.destroy()}this.keyUriToKeyInfo={}},K.createKeyLoadError=function(F,B,P,N){return B===void 0&&(B=R.ErrorDetails.KEY_LOAD_ERROR),new A.LoadError({type:R.ErrorTypes.NETWORK_ERROR,details:B,fatal:!1,frag:F,networkDetails:P})},K.loadClear=function(F,B){var P=this;if(this.emeController&&this.config.emeEnabled)for(var N=F.sn,g=F.cc,M=function(d){var l=B[d];if(g<=l.cc&&(N==="initSegment"||N<l.sn))return P.emeController.selectKeySystemFormat(l).then(function(b){l.setKeyFormat(b)}),"break"},S=0;S<B.length;S++){var f=M(S);if(f==="break")break}},K.load=function(F){var B=this;return!F.decryptdata&&F.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(F).then(function(P){return B.loadInternal(F,P)}):this.loadInternal(F)},K.loadInternal=function(F,B){var P,N;B&&F.setKeyFormat(B);var g=F.decryptdata;if(!g){var M=B?"Expected frag.decryptdata to be defined after setting format "+B:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(F,R.ErrorDetails.KEY_LOAD_ERROR,null,M))}var S=g.uri;if(!S)return Promise.reject(this.createKeyLoadError(F,R.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+S+'"'));var f=this.keyUriToKeyInfo[S];if((P=f)!==null&&P!==void 0&&P.decryptdata.key)return g.key=f.decryptdata.key,Promise.resolve({frag:F,keyInfo:f});if((N=f)!==null&&N!==void 0&&N.keyLoadPromise){var E;switch((E=f.mediaKeySessionContext)===null||E===void 0?void 0:E.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return f.keyLoadPromise}}switch(f=this.keyUriToKeyInfo[S]={decryptdata:g,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},g.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return g.keyFormat==="identity"?this.loadKeyHTTP(f,F):this.loadKeyEME(f,F);case"AES-128":return this.loadKeyHTTP(f,F);default:return Promise.reject(this.createKeyLoadError(F,R.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+g.method+'"'))}},K.loadKeyEME=function(F,B){var P={frag:B,keyInfo:F};if(this.emeController&&this.config.emeEnabled){var N=this.emeController.loadKey(P);if(N)return(F.keyLoadPromise=N.then(function(g){return F.mediaKeySessionContext=g,P})).catch(function(g){throw F.keyLoadPromise=null,g})}return Promise.resolve(P)},K.loadKeyHTTP=function(F,B){var P=this,N=this.config,g=N.loader,M=new g(N);return B.keyLoader=F.loader=M,F.keyLoadPromise=new Promise(function(S,f){var E={keyInfo:F,frag:B,responseType:"arraybuffer",url:F.decryptdata.uri},d={timeout:N.fragLoadingTimeOut,maxRetry:0,retryDelay:N.fragLoadingRetryDelay,maxRetryDelay:N.fragLoadingMaxRetryTimeout,highWaterMark:0},l={onSuccess:function(h,u,m,y){var v=m.frag,c=m.keyInfo,a=m.url;if(!v.decryptdata||c!==P.keyUriToKeyInfo[a])return f(P.createKeyLoadError(v,R.ErrorDetails.KEY_LOAD_ERROR,y,"after key load, decryptdata unset or changed"));c.decryptdata.key=v.decryptdata.key=new Uint8Array(h.data),v.keyLoader=null,c.loader=null,S({frag:v,keyInfo:c})},onError:function(h,u,m){P.resetLoader(u),f(P.createKeyLoadError(B,R.ErrorDetails.KEY_LOAD_ERROR,m))},onTimeout:function(h,u,m){P.resetLoader(u),f(P.createKeyLoadError(B,R.ErrorDetails.KEY_LOAD_TIMEOUT,m))},onAbort:function(h,u,m){P.resetLoader(u),f(P.createKeyLoadError(B,R.ErrorDetails.INTERNAL_ABORTED,m))}};M.load(E,d,l)})},K.resetLoader=function(F){var B=F.frag,P=F.keyInfo,N=F.url,g=P.loader;B.keyLoader===g&&(B.keyLoader=null,P.loader=null),delete this.keyUriToKeyInfo[N],g&&g.destroy()},D}()},"./src/loader/level-details.ts":(O,I,s)=>{s.r(I),s.d(I,{LevelDetails:()=>F});var R=s("./src/polyfills/number.ts");function A(B,P){for(var N=0;N<P.length;N++){var g=P[N];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(B,D(g.key),g)}}function w(B,P,N){return P&&A(B.prototype,P),N&&A(B,N),Object.defineProperty(B,"prototype",{writable:!1}),B}function D(B){var P=K(B,"string");return typeof P=="symbol"?P:String(P)}function K(B,P){if(typeof B!="object"||B===null)return B;var N=B[Symbol.toPrimitive];if(N!==void 0){var g=N.call(B,P||"default");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return(P==="string"?String:Number)(B)}var k=10,F=function(){function B(N){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=N}var P=B.prototype;return P.reloaded=function(g){if(!g){this.advanced=!0,this.updated=!0;return}var M=this.lastPartSn-g.lastPartSn,S=this.lastPartIndex-g.lastPartIndex;this.updated=this.endSN!==g.endSN||!!S||!!M,this.advanced=this.endSN>g.endSN||M>0||M===0&&S>0,this.updated||this.advanced?this.misses=Math.floor(g.misses*.6):this.misses=g.misses+1,this.availabilityDelay=g.availabilityDelay},w(B,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,R.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||k}},{key:"drift",get:function(){var g=this.driftEndTime-this.driftStartTime;if(g>0){var M=this.driftEnd-this.driftStart;return M*1e3/g}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var g;return(g=this.partList)!==null&&g!==void 0&&g.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var g;return(g=this.fragments)!==null&&g!==void 0&&g.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var g;return(g=this.partList)!==null&&g!==void 0&&g.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var g;return(g=this.partList)!==null&&g!==void 0&&g.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),B}()},"./src/loader/level-key.ts":(O,I,s)=>{s.r(I),s.d(I,{LevelKey:()=>F});var R=s("./src/utils/keysystem-util.ts"),A=s("./src/utils/mediakeys-helper.ts"),w=s("./src/utils/mp4-tools.ts"),D=s("./src/utils/logger.ts"),K=s("./src/utils/numeric-encoding-utils.ts"),k={},F=function(){P.clearKeyUriToKeyIdMap=function(){k={}};function P(g,M,S,f,E){f===void 0&&(f=[1]),E===void 0&&(E=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=g,this.uri=M,this.keyFormat=S,this.keyFormatVersions=f,this.iv=E,this.encrypted=g?g!=="NONE":!1,this.isCommonEncryption=this.encrypted&&g!=="AES-128"}var N=P.prototype;return N.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;switch(this.keyFormat){case"identity":return this.method==="SAMPLE-AES";case A.KeySystemFormats.FAIRPLAY:case A.KeySystemFormats.WIDEVINE:case A.KeySystemFormats.PLAYREADY:case A.KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},N.getDecryptData=function(M){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof M!="number"&&(this.method==="AES-128"&&!this.iv&&D.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),M=0);var S=B(M),f=new P(this.method,this.uri,"identity",this.keyFormatVersions,S);return f}var E=(0,R.convertDataUriToArrayBytes)(this.uri);if(E)switch(this.keyFormat){case A.KeySystemFormats.WIDEVINE:this.pssh=E,E.length>=22&&(this.keyId=E.subarray(E.length-22,E.length-6));break;case A.KeySystemFormats.PLAYREADY:{var d=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,w.mp4pssh)(d,null,E);var l=new Uint16Array(E.buffer,E.byteOffset,E.byteLength/2),b=String.fromCharCode.apply(null,Array.from(l)),h=b.substring(b.indexOf("<"),b.length),u=new DOMParser,m=u.parseFromString(h,"text/xml"),y=m.getElementsByTagName("KID")[0];if(y){var v=y.childNodes[0]?y.childNodes[0].nodeValue:y.getAttribute("VALUE");if(v){var c=(0,K.base64Decode)(v).subarray(0,16);(0,R.changeEndianness)(c),this.keyId=c}}break}default:{var a=E.subarray(0,16);if(a.length!==16){var T=new Uint8Array(16);T.set(a,16-a.length),a=T}this.keyId=a;break}}if(!this.keyId||this.keyId.byteLength!==16){var o=k[this.uri];if(!o){var _=Object.keys(k).length%Number.MAX_SAFE_INTEGER;o=new Uint8Array(16);var L=new DataView(o.buffer,12,4);L.setUint32(0,_),k[this.uri]=o}this.keyId=o}return this},P}();function B(P){for(var N=new Uint8Array(16),g=12;g<16;g++)N[g]=P>>8*(15-g)&255;return N}},"./src/loader/load-stats.ts":(O,I,s)=>{s.r(I),s.d(I,{LoadStats:()=>R});var R=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>E});var R=s("./src/polyfills/number.ts"),A=s("./node_modules/url-toolkit/src/url-toolkit.js"),w=s("./src/loader/date-range.ts"),D=s("./src/loader/fragment.ts"),K=s("./src/loader/level-details.ts"),k=s("./src/loader/level-key.ts"),F=s("./src/utils/attr-list.ts"),B=s("./src/utils/logger.ts"),P=s("./src/utils/codecs.ts");function N(){return N=Object.assign?Object.assign.bind():function(y){for(var v=1;v<arguments.length;v++){var c=arguments[v];for(var a in c)Object.prototype.hasOwnProperty.call(c,a)&&(y[a]=c[a])}return y},N.apply(this,arguments)}var g=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,M=/#EXT-X-MEDIA:(.*)/g,S=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),f=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),E=function(){function y(){}return y.findGroup=function(c,a){for(var T=0;T<c.length;T++){var o=c[T];if(o.id===a)return o}},y.convertAVC1ToAVCOTI=function(c){var a=c.split(".");if(a.length>2){var T=a.shift()+".";return T+=parseInt(a.shift()).toString(16),T+=("000"+parseInt(a.shift()).toString(16)).slice(-4),T}return c},y.resolve=function(c,a){return(0,A.buildAbsoluteURL)(a,c,{alwaysNormalize:!0})},y.parseMasterPlaylist=function(c,a){var T=[],o=[],_={},L=[],x=!1;g.lastIndex=0;for(var H;(H=g.exec(c))!=null;)if(H[1]){var W,U=new F.AttrList(H[1]),G={attrs:U,bitrate:U.decimalInteger("AVERAGE-BANDWIDTH")||U.decimalInteger("BANDWIDTH"),name:U.NAME,url:y.resolve(H[2],a)},Y=U.decimalResolution("RESOLUTION");Y&&(G.width=Y.width,G.height=Y.height),l((U.CODECS||"").split(/[ ,]+/).filter(function(V){return V}),G),G.videoCodec&&G.videoCodec.indexOf("avc1")!==-1&&(G.videoCodec=y.convertAVC1ToAVCOTI(G.videoCodec)),(W=G.unknownCodecs)!==null&&W!==void 0&&W.length||o.push(G),T.push(G)}else if(H[3]){var j=new F.AttrList(H[3]);j["DATA-ID"]&&(x=!0,_[j["DATA-ID"]]=j)}else if(H[4]){var X=H[4],q=d(X,a);q.encrypted&&q.isSupported()?L.push(q):B.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+X+'"')}var J=o.length>0&&o.length<T.length;return{levels:J?o:T,sessionData:x?_:null,sessionKeys:L.length?L:null}},y.parseMasterPlaylistMedia=function(c,a,T,o){o===void 0&&(o=[]);var _,L=[],x=0;for(M.lastIndex=0;(_=M.exec(c))!==null;){var H=new F.AttrList(_[1]);if(H.TYPE===T){var W={attrs:H,bitrate:0,id:x++,groupId:H["GROUP-ID"],instreamId:H["INSTREAM-ID"],name:H.NAME||H.LANGUAGE||"",type:T,default:H.bool("DEFAULT"),autoselect:H.bool("AUTOSELECT"),forced:H.bool("FORCED"),lang:H.LANGUAGE,url:H.URI?y.resolve(H.URI,a):""};if(o.length){var U=y.findGroup(o,W.groupId)||o[0];b(W,U,"audioCodec"),b(W,U,"textCodec")}L.push(W)}}return L},y.parseLevelPlaylist=function(c,a,T,o,_){var L=new K.LevelDetails(a),x=L.fragments,H=null,W=0,U=0,G=0,Y=0,j=null,X=new D.Fragment(o,a),q,J,V,Q=-1,ee=!1;for(S.lastIndex=0,L.m3u8=c;(q=S.exec(c))!==null;){ee&&(ee=!1,X=new D.Fragment(o,a),X.start=G,X.sn=W,X.cc=Y,X.level=T,H&&(X.initSegment=H,X.rawProgramDateTime=H.rawProgramDateTime,H.rawProgramDateTime=null));var Z=q[1];if(Z){X.duration=parseFloat(Z);var re=(" "+q[2]).slice(1);X.title=re||null,X.tagList.push(re?["INF",Z,re]:["INF",Z])}else if(q[3]){if((0,R.isFiniteNumber)(X.duration)){if(X.start=G,V){X.levelkeys=V;var ae=L.encryptedFragments;X.levelkeys&&Object.keys(X.levelkeys).some(function(mt){return X.levelkeys[mt].isCommonEncryption})&&(!ae.length||ae[ae.length-1].levelkeys!==V)&&ae.push(X)}X.sn=W,X.level=T,X.cc=Y,X.urlId=_,x.push(X),X.relurl=(" "+q[3]).slice(1),u(X,j),j=X,G+=X.duration,W++,U=0,ee=!0}}else if(q[4]){var le=(" "+q[4]).slice(1);j?X.setByteRange(le,j):X.setByteRange(le)}else if(q[5])X.rawProgramDateTime=(" "+q[5]).slice(1),X.tagList.push(["PROGRAM-DATE-TIME",X.rawProgramDateTime]),Q===-1&&(Q=x.length);else{if(q=q[0].match(f),!q){B.logger.warn("No matches on slow regex match for level playlist!");continue}for(J=1;J<q.length&&!(typeof q[J]<"u");J++);var ne=(" "+q[J]).slice(1),ie=(" "+q[J+1]).slice(1),oe=q[J+2]?(" "+q[J+2]).slice(1):"";switch(ne){case"PLAYLIST-TYPE":L.type=ie.toUpperCase();break;case"MEDIA-SEQUENCE":W=L.startSN=parseInt(ie);break;case"SKIP":{var ge=new F.AttrList(ie),he=ge.decimalInteger("SKIPPED-SEGMENTS");if((0,R.isFiniteNumber)(he)){L.skippedSegments=he;for(var me=he;me--;)x.unshift(null);W+=he}var Ee=ge.enumeratedString("RECENTLY-REMOVED-DATERANGES");Ee&&(L.recentlyRemovedDateranges=Ee.split("	"));break}case"TARGETDURATION":L.targetduration=parseFloat(ie);break;case"VERSION":L.version=parseInt(ie);break;case"EXTM3U":break;case"ENDLIST":L.live=!1;break;case"#":(ie||oe)&&X.tagList.push(oe?[ie,oe]:[ie]);break;case"DISCONTINUITY":Y++,X.tagList.push(["DIS"]);break;case"GAP":X.tagList.push([ne]);break;case"BITRATE":X.tagList.push([ne,ie]);break;case"DATERANGE":{var pe=new F.AttrList(ie),Te=new w.DateRange(pe,L.dateRanges[pe.ID]);Te.isValid||L.skippedSegments?L.dateRanges[Te.id]=Te:B.logger.warn('Ignoring invalid DATERANGE tag: "'+ie+'"'),X.tagList.push(["EXT-X-DATERANGE",ie]);break}case"DISCONTINUITY-SEQUENCE":Y=parseInt(ie);break;case"KEY":{var _e=d(ie,a);if(_e.isSupported()){if(_e.method==="NONE"){V=void 0;break}V||(V={}),V[_e.keyFormat]&&(V=N({},V)),V[_e.keyFormat]=_e}else B.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+ie+'"');break}case"START":{var ye=new F.AttrList(ie),Le=ye.decimalFloatingPoint("TIME-OFFSET");(0,R.isFiniteNumber)(Le)&&(L.startTimeOffset=Le);break}case"MAP":{var ke=new F.AttrList(ie);if(X.duration){var He=new D.Fragment(o,a);m(He,ke,T,V),H=He,X.initSegment=H,H.rawProgramDateTime&&!X.rawProgramDateTime&&(X.rawProgramDateTime=H.rawProgramDateTime)}else m(X,ke,T,V),H=X,ee=!0;break}case"SERVER-CONTROL":{var Ke=new F.AttrList(ie);L.canBlockReload=Ke.bool("CAN-BLOCK-RELOAD"),L.canSkipUntil=Ke.optionalFloat("CAN-SKIP-UNTIL",0),L.canSkipDateRanges=L.canSkipUntil>0&&Ke.bool("CAN-SKIP-DATERANGES"),L.partHoldBack=Ke.optionalFloat("PART-HOLD-BACK",0),L.holdBack=Ke.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var ct=new F.AttrList(ie);L.partTarget=ct.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Ne=L.partList;Ne||(Ne=L.partList=[]);var Ge=U>0?Ne[Ne.length-1]:void 0,rt=U++,dt=new D.Part(new F.AttrList(ie),X,a,rt,Ge);Ne.push(dt),X.duration+=dt.duration;break}case"PRELOAD-HINT":{var ht=new F.AttrList(ie);L.preloadHint=ht;break}case"RENDITION-REPORT":{var qe=new F.AttrList(ie);L.renditionReports=L.renditionReports||[],L.renditionReports.push(qe);break}default:B.logger.warn("line parsed but not handled: "+q);break}}}j&&!j.relurl?(x.pop(),G-=j.duration,L.partList&&(L.fragmentHint=j)):L.partList&&(u(X,j),X.cc=Y,L.fragmentHint=X);var $e=x.length,gt=x[0],Tt=x[$e-1];if(G+=L.skippedSegments*L.targetduration,G>0&&$e&&Tt){L.averagetargetduration=G/$e;var Ye=Tt.sn;L.endSN=Ye!=="initSegment"?Ye:0,L.live||(Tt.endList=!0),gt&&(L.startCC=gt.cc)}else L.endSN=0,L.startCC=0;return L.fragmentHint&&(G+=L.fragmentHint.duration),L.totalduration=G,L.endCC=Y,Q>0&&h(x,Q),L},y}();function d(y,v){var c,a,T=new F.AttrList(y),o=(c=T.enumeratedString("METHOD"))!=null?c:"",_=T.URI,L=T.hexadecimalInteger("IV"),x=T.enumeratedString("KEYFORMATVERSIONS"),H=(a=T.enumeratedString("KEYFORMAT"))!=null?a:"identity";_&&T.IV&&!L&&B.logger.error("Invalid IV: "+T.IV);var W=_?E.resolve(_,v):"",U=(x||"1").split("/").map(Number).filter(Number.isFinite);return new k.LevelKey(o,W,H,U,L)}function l(y,v){["video","audio","text"].forEach(function(c){var a=y.filter(function(o){return(0,P.isCodecType)(o,c)});if(a.length){var T=a.filter(function(o){return o.lastIndexOf("avc1",0)===0||o.lastIndexOf("mp4a",0)===0});v[c+"Codec"]=T.length>0?T[0]:a[0],y=y.filter(function(o){return a.indexOf(o)===-1})}}),v.unknownCodecs=y}function b(y,v,c){var a=v[c];a&&(y[c]=a)}function h(y,v){for(var c=y[v],a=v;a--;){var T=y[a];if(!T)return;T.programDateTime=c.programDateTime-T.duration*1e3,c=T}}function u(y,v){y.rawProgramDateTime?y.programDateTime=Date.parse(y.rawProgramDateTime):v!=null&&v.programDateTime&&(y.programDateTime=v.endProgramDateTime),(0,R.isFiniteNumber)(y.programDateTime)||(y.programDateTime=null,y.rawProgramDateTime=null)}function m(y,v,c,a){y.relurl=v.URI,v.BYTERANGE&&y.setByteRange(v.BYTERANGE),y.level=c,y.sn="initSegment",a&&(y.levelkeys=a),y.initSegment=null}},"./src/loader/playlist-loader.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>g});var R=s("./src/polyfills/number.ts"),A=s("./src/events.ts"),w=s("./src/errors.ts"),D=s("./src/utils/logger.ts"),K=s("./src/loader/m3u8-parser.ts"),k=s("./src/types/loader.ts"),F=s("./src/utils/attr-list.ts");function B(M){var S=M.type;switch(S){case k.PlaylistContextType.AUDIO_TRACK:return k.PlaylistLevelType.AUDIO;case k.PlaylistContextType.SUBTITLE_TRACK:return k.PlaylistLevelType.SUBTITLE;default:return k.PlaylistLevelType.MAIN}}function P(M,S){var f=M.url;return(f===void 0||f.indexOf("data:")===0)&&(f=S.url),f}var N=function(){function M(f){this.hls=void 0,this.loaders=Object.create(null),this.hls=f,this.registerListeners()}var S=M.prototype;return S.startLoad=function(E){},S.stopLoad=function(){this.destroyInternalLoaders()},S.registerListeners=function(){var E=this.hls;E.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.on(A.Events.LEVEL_LOADING,this.onLevelLoading,this),E.on(A.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),E.on(A.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},S.unregisterListeners=function(){var E=this.hls;E.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.off(A.Events.LEVEL_LOADING,this.onLevelLoading,this),E.off(A.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),E.off(A.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},S.createInternalLoader=function(E){var d=this.hls.config,l=d.pLoader,b=d.loader,h=l||b,u=new h(d);return E.loader=u,this.loaders[E.type]=u,u},S.getInternalLoader=function(E){return this.loaders[E.type]},S.resetInternalLoader=function(E){this.loaders[E]&&delete this.loaders[E]},S.destroyInternalLoaders=function(){for(var E in this.loaders){var d=this.loaders[E];d&&d.destroy(),this.resetInternalLoader(E)}},S.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},S.onManifestLoading=function(E,d){var l=d.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:k.PlaylistContextType.MANIFEST,url:l,deliveryDirectives:null})},S.onLevelLoading=function(E,d){var l=d.id,b=d.level,h=d.url,u=d.deliveryDirectives;this.load({id:l,groupId:null,level:b,responseType:"text",type:k.PlaylistContextType.LEVEL,url:h,deliveryDirectives:u})},S.onAudioTrackLoading=function(E,d){var l=d.id,b=d.groupId,h=d.url,u=d.deliveryDirectives;this.load({id:l,groupId:b,level:null,responseType:"text",type:k.PlaylistContextType.AUDIO_TRACK,url:h,deliveryDirectives:u})},S.onSubtitleTrackLoading=function(E,d){var l=d.id,b=d.groupId,h=d.url,u=d.deliveryDirectives;this.load({id:l,groupId:b,level:null,responseType:"text",type:k.PlaylistContextType.SUBTITLE_TRACK,url:h,deliveryDirectives:u})},S.load=function(E){var d,l=this.hls.config,b=this.getInternalLoader(E);if(b){var h=b.context;if(h&&h.url===E.url){D.logger.trace("[playlist-loader]: playlist request ongoing");return}D.logger.log("[playlist-loader]: aborting previous loader for type: "+E.type),b.abort()}var u,m,y,v;switch(E.type){case k.PlaylistContextType.MANIFEST:u=l.manifestLoadingMaxRetry,m=l.manifestLoadingTimeOut,y=l.manifestLoadingRetryDelay,v=l.manifestLoadingMaxRetryTimeout;break;case k.PlaylistContextType.LEVEL:case k.PlaylistContextType.AUDIO_TRACK:case k.PlaylistContextType.SUBTITLE_TRACK:u=0,m=l.levelLoadingTimeOut;break;default:u=l.levelLoadingMaxRetry,m=l.levelLoadingTimeOut,y=l.levelLoadingRetryDelay,v=l.levelLoadingMaxRetryTimeout;break}if(b=this.createInternalLoader(E),(d=E.deliveryDirectives)!==null&&d!==void 0&&d.part){var c;if(E.type===k.PlaylistContextType.LEVEL&&E.level!==null?c=this.hls.levels[E.level].details:E.type===k.PlaylistContextType.AUDIO_TRACK&&E.id!==null?c=this.hls.audioTracks[E.id].details:E.type===k.PlaylistContextType.SUBTITLE_TRACK&&E.id!==null&&(c=this.hls.subtitleTracks[E.id].details),c){var a=c.partTarget,T=c.targetduration;a&&T&&(m=Math.min(Math.max(a*3,T*.8)*1e3,m))}}var o={timeout:m,maxRetry:u,retryDelay:y,maxRetryDelay:v,highWaterMark:0},_={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};b.load(E,o,_)},S.loadsuccess=function(E,d,l,b){b===void 0&&(b=null),this.resetInternalLoader(l.type);var h=E.data;if(h.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(E,l,"no EXTM3U delimiter",b);return}d.parsing.start=performance.now(),h.indexOf("#EXTINF:")>0||h.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(E,d,l,b):this.handleMasterPlaylist(E,d,l,b)},S.loaderror=function(E,d,l){l===void 0&&(l=null),this.handleNetworkError(d,l,!1,E)},S.loadtimeout=function(E,d,l){l===void 0&&(l=null),this.handleNetworkError(d,l,!0)},S.handleMasterPlaylist=function(E,d,l,b){var h=this.hls,u=E.data,m=P(E,l),y=K.default.parseMasterPlaylist(u,m),v=y.levels,c=y.sessionData,a=y.sessionKeys;if(!v.length){this.handleManifestParsingError(E,l,"no level found in manifest",b);return}var T=v.map(function(W){return{id:W.attrs.AUDIO,audioCodec:W.audioCodec}}),o=v.map(function(W){return{id:W.attrs.SUBTITLES,textCodec:W.textCodec}}),_=K.default.parseMasterPlaylistMedia(u,m,"AUDIO",T),L=K.default.parseMasterPlaylistMedia(u,m,"SUBTITLES",o),x=K.default.parseMasterPlaylistMedia(u,m,"CLOSED-CAPTIONS");if(_.length){var H=_.some(function(W){return!W.url});!H&&v[0].audioCodec&&!v[0].attrs.AUDIO&&(D.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),_.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new F.AttrList({}),bitrate:0,url:""}))}h.trigger(A.Events.MANIFEST_LOADED,{levels:v,audioTracks:_,subtitles:L,captions:x,url:m,stats:d,networkDetails:b,sessionData:c,sessionKeys:a})},S.handleTrackOrLevelPlaylist=function(E,d,l,b){var h=this.hls,u=l.id,m=l.level,y=l.type,v=P(E,l),c=(0,R.isFiniteNumber)(u)?u:0,a=(0,R.isFiniteNumber)(m)?m:c,T=B(l),o=K.default.parseLevelPlaylist(E.data,v,a,T,c);if(!o.fragments.length){h.trigger(A.Events.ERROR,{type:w.ErrorTypes.NETWORK_ERROR,details:w.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:typeof l.level=="number"?l.level:void 0});return}if(y===k.PlaylistContextType.MANIFEST){var _={attrs:new F.AttrList({}),bitrate:0,details:o,name:"",url:v};h.trigger(A.Events.MANIFEST_LOADED,{levels:[_],audioTracks:[],url:v,stats:d,networkDetails:b,sessionData:null,sessionKeys:null})}d.parsing.end=performance.now(),l.levelDetails=o,this.handlePlaylistLoaded(E,d,l,b)},S.handleManifestParsingError=function(E,d,l,b){this.hls.trigger(A.Events.ERROR,{type:w.ErrorTypes.NETWORK_ERROR,details:w.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:d.type===k.PlaylistContextType.MANIFEST,url:E.url,reason:l,response:E,context:d,networkDetails:b})},S.handleNetworkError=function(E,d,l,b){l===void 0&&(l=!1),D.logger.warn("[playlist-loader]: A network "+(l?"timeout":"error")+" occurred while loading "+E.type+" level: "+E.level+" id: "+E.id+' group-id: "'+E.groupId+'"');var h=w.ErrorDetails.UNKNOWN,u=!1,m=this.getInternalLoader(E);switch(E.type){case k.PlaylistContextType.MANIFEST:h=l?w.ErrorDetails.MANIFEST_LOAD_TIMEOUT:w.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case k.PlaylistContextType.LEVEL:h=l?w.ErrorDetails.LEVEL_LOAD_TIMEOUT:w.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case k.PlaylistContextType.AUDIO_TRACK:h=l?w.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:w.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case k.PlaylistContextType.SUBTITLE_TRACK:h=l?w.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:w.ErrorDetails.SUBTITLE_LOAD_ERROR,u=!1;break}m&&this.resetInternalLoader(E.type);var y={type:w.ErrorTypes.NETWORK_ERROR,details:h,fatal:u,url:E.url,loader:m,context:E,networkDetails:d};b&&(y.response=b),this.hls.trigger(A.Events.ERROR,y)},S.handlePlaylistLoaded=function(E,d,l,b){var h=l.type,u=l.level,m=l.id,y=l.groupId,v=l.loader,c=l.levelDetails,a=l.deliveryDirectives;if(!(c!=null&&c.targetduration)){this.handleManifestParsingError(E,l,"invalid target duration",b);return}if(v)switch(c.live&&(v.getCacheAge&&(c.ageHeader=v.getCacheAge()||0),(!v.getCacheAge||isNaN(c.ageHeader))&&(c.ageHeader=0)),h){case k.PlaylistContextType.MANIFEST:case k.PlaylistContextType.LEVEL:this.hls.trigger(A.Events.LEVEL_LOADED,{details:c,level:u||0,id:m||0,stats:d,networkDetails:b,deliveryDirectives:a});break;case k.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(A.Events.AUDIO_TRACK_LOADED,{details:c,id:m||0,groupId:y||"",stats:d,networkDetails:b,deliveryDirectives:a});break;case k.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(A.Events.SUBTITLE_TRACK_LOADED,{details:c,id:m||0,groupId:y||"",stats:d,networkDetails:b,deliveryDirectives:a});break}},M}();const g=N},"./src/polyfills/number.ts":(O,I,s)=>{s.r(I),s.d(I,{MAX_SAFE_INTEGER:()=>A,isFiniteNumber:()=>R});var R=Number.isFinite||function(w){return typeof w=="number"&&isFinite(w)},A=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>A});var R=function(){function w(){}return w.getSilentFrame=function(K,k){switch(K){case"mp4a.40.2":if(k===1)return new Uint8Array([0,200,0,128,35,128]);if(k===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(k===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(k===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(k===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(k===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(k===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},w}();const A=R},"./src/remux/mp4-generator.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>w});var R=Math.pow(2,32)-1,A=function(){function D(){}return D.init=function(){D.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var k;for(k in D.types)D.types.hasOwnProperty(k)&&(D.types[k]=[k.charCodeAt(0),k.charCodeAt(1),k.charCodeAt(2),k.charCodeAt(3)]);var F=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),B=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);D.HDLR_TYPES={video:F,audio:B};var P=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),N=new Uint8Array([0,0,0,0,0,0,0,0]);D.STTS=D.STSC=D.STCO=N,D.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),D.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),D.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),D.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),M=new Uint8Array([97,118,99,49]),S=new Uint8Array([0,0,0,1]);D.FTYP=D.box(D.types.ftyp,g,S,g,M),D.DINF=D.box(D.types.dinf,D.box(D.types.dref,P))},D.box=function(k){for(var F=8,B=arguments.length,P=new Array(B>1?B-1:0),N=1;N<B;N++)P[N-1]=arguments[N];for(var g=P.length,M=g;g--;)F+=P[g].byteLength;var S=new Uint8Array(F);for(S[0]=F>>24&255,S[1]=F>>16&255,S[2]=F>>8&255,S[3]=F&255,S.set(k,4),g=0,F=8;g<M;g++)S.set(P[g],F),F+=P[g].byteLength;return S},D.hdlr=function(k){return D.box(D.types.hdlr,D.HDLR_TYPES[k])},D.mdat=function(k){return D.box(D.types.mdat,k)},D.mdhd=function(k,F){F*=k;var B=Math.floor(F/(R+1)),P=Math.floor(F%(R+1));return D.box(D.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,k&255,B>>24,B>>16&255,B>>8&255,B&255,P>>24,P>>16&255,P>>8&255,P&255,85,196,0,0]))},D.mdia=function(k){return D.box(D.types.mdia,D.mdhd(k.timescale,k.duration),D.hdlr(k.type),D.minf(k))},D.mfhd=function(k){return D.box(D.types.mfhd,new Uint8Array([0,0,0,0,k>>24,k>>16&255,k>>8&255,k&255]))},D.minf=function(k){return k.type==="audio"?D.box(D.types.minf,D.box(D.types.smhd,D.SMHD),D.DINF,D.stbl(k)):D.box(D.types.minf,D.box(D.types.vmhd,D.VMHD),D.DINF,D.stbl(k))},D.moof=function(k,F,B){return D.box(D.types.moof,D.mfhd(k),D.traf(B,F))},D.moov=function(k){for(var F=k.length,B=[];F--;)B[F]=D.trak(k[F]);return D.box.apply(null,[D.types.moov,D.mvhd(k[0].timescale,k[0].duration)].concat(B).concat(D.mvex(k)))},D.mvex=function(k){for(var F=k.length,B=[];F--;)B[F]=D.trex(k[F]);return D.box.apply(null,[D.types.mvex].concat(B))},D.mvhd=function(k,F){F*=k;var B=Math.floor(F/(R+1)),P=Math.floor(F%(R+1)),N=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,k&255,B>>24,B>>16&255,B>>8&255,B&255,P>>24,P>>16&255,P>>8&255,P&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return D.box(D.types.mvhd,N)},D.sdtp=function(k){var F=k.samples||[],B=new Uint8Array(4+F.length),P,N;for(P=0;P<F.length;P++)N=F[P].flags,B[P+4]=N.dependsOn<<4|N.isDependedOn<<2|N.hasRedundancy;return D.box(D.types.sdtp,B)},D.stbl=function(k){return D.box(D.types.stbl,D.stsd(k),D.box(D.types.stts,D.STTS),D.box(D.types.stsc,D.STSC),D.box(D.types.stsz,D.STSZ),D.box(D.types.stco,D.STCO))},D.avc1=function(k){var F=[],B=[],P,N,g;for(P=0;P<k.sps.length;P++)N=k.sps[P],g=N.byteLength,F.push(g>>>8&255),F.push(g&255),F=F.concat(Array.prototype.slice.call(N));for(P=0;P<k.pps.length;P++)N=k.pps[P],g=N.byteLength,B.push(g>>>8&255),B.push(g&255),B=B.concat(Array.prototype.slice.call(N));var M=D.box(D.types.avcC,new Uint8Array([1,F[3],F[4],F[5],255,224|k.sps.length].concat(F).concat([k.pps.length]).concat(B))),S=k.width,f=k.height,E=k.pixelRatio[0],d=k.pixelRatio[1];return D.box(D.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,S>>8&255,S&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),M,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([E>>24,E>>16&255,E>>8&255,E&255,d>>24,d>>16&255,d>>8&255,d&255])))},D.esds=function(k){var F=k.config.length;return new Uint8Array([0,0,0,0,3,23+F,0,1,0,4,15+F,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([F]).concat(k.config).concat([6,1,2]))},D.mp4a=function(k){var F=k.samplerate;return D.box(D.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,F>>8&255,F&255,0,0]),D.box(D.types.esds,D.esds(k)))},D.mp3=function(k){var F=k.samplerate;return D.box(D.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,F>>8&255,F&255,0,0]))},D.stsd=function(k){return k.type==="audio"?k.segmentCodec==="mp3"&&k.codec==="mp3"?D.box(D.types.stsd,D.STSD,D.mp3(k)):D.box(D.types.stsd,D.STSD,D.mp4a(k)):D.box(D.types.stsd,D.STSD,D.avc1(k))},D.tkhd=function(k){var F=k.id,B=k.duration*k.timescale,P=k.width,N=k.height,g=Math.floor(B/(R+1)),M=Math.floor(B%(R+1));return D.box(D.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,F>>24&255,F>>16&255,F>>8&255,F&255,0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255,M>>24,M>>16&255,M>>8&255,M&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,P>>8&255,P&255,0,0,N>>8&255,N&255,0,0]))},D.traf=function(k,F){var B=D.sdtp(k),P=k.id,N=Math.floor(F/(R+1)),g=Math.floor(F%(R+1));return D.box(D.types.traf,D.box(D.types.tfhd,new Uint8Array([0,0,0,0,P>>24,P>>16&255,P>>8&255,P&255])),D.box(D.types.tfdt,new Uint8Array([1,0,0,0,N>>24,N>>16&255,N>>8&255,N&255,g>>24,g>>16&255,g>>8&255,g&255])),D.trun(k,B.length+16+20+8+16+8+8),B)},D.trak=function(k){return k.duration=k.duration||4294967295,D.box(D.types.trak,D.tkhd(k),D.mdia(k))},D.trex=function(k){var F=k.id;return D.box(D.types.trex,new Uint8Array([0,0,0,0,F>>24,F>>16&255,F>>8&255,F&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},D.trun=function(k,F){var B=k.samples||[],P=B.length,N=12+16*P,g=new Uint8Array(N),M,S,f,E,d,l;for(F+=8+N,g.set([k.type==="video"?1:0,0,15,1,P>>>24&255,P>>>16&255,P>>>8&255,P&255,F>>>24&255,F>>>16&255,F>>>8&255,F&255],0),M=0;M<P;M++)S=B[M],f=S.duration,E=S.size,d=S.flags,l=S.cts,g.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,E>>>24&255,E>>>16&255,E>>>8&255,E&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&240<<8,d.degradPrio&15,l>>>24&255,l>>>16&255,l>>>8&255,l&255],12+16*M);return D.box(D.types.trun,g)},D.initSegment=function(k){D.types||D.init();var F=D.moov(k),B=new Uint8Array(D.FTYP.byteLength+F.byteLength);return B.set(D.FTYP),B.set(F,D.FTYP.byteLength),B},D}();A.types=void 0,A.HDLR_TYPES=void 0,A.STTS=void 0,A.STSC=void 0,A.STCO=void 0,A.STSZ=void 0,A.VMHD=void 0,A.SMHD=void 0,A.STSD=void 0,A.FTYP=void 0,A.DINF=void 0;const w=A},"./src/remux/mp4-remuxer.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>E,flushTextTrackMetadataCueSamples:()=>b,flushTextTrackUserdataCueSamples:()=>h,normalizePts:()=>d});var R=s("./src/polyfills/number.ts"),A=s("./src/remux/aac-helper.ts"),w=s("./src/remux/mp4-generator.ts"),D=s("./src/events.ts"),K=s("./src/errors.ts"),k=s("./src/utils/logger.ts"),F=s("./src/types/loader.ts"),B=s("./src/utils/timescale-conversion.ts");function P(){return P=Object.assign?Object.assign.bind():function(y){for(var v=1;v<arguments.length;v++){var c=arguments[v];for(var a in c)Object.prototype.hasOwnProperty.call(c,a)&&(y[a]=c[a])}return y},P.apply(this,arguments)}var N=10*1e3,g=1024,M=1152,S=null,f=null,E=function(){function y(c,a,T,o){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=c,this.config=a,this.typeSupported=T,this.ISGenerated=!1,S===null){var _=navigator.userAgent||"",L=_.match(/Chrome\/(\d+)/i);S=L?parseInt(L[1]):0}if(f===null){var x=navigator.userAgent.match(/Safari\/(\d+)/i);f=x?parseInt(x[1]):0}}var v=y.prototype;return v.destroy=function(){},v.resetTimeStamp=function(a){k.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=a},v.resetNextTimestamp=function(){k.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},v.resetInitSegment=function(){k.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},v.getVideoStartPts=function(a){var T=!1,o=a.reduce(function(_,L){var x=L.pts-_;return x<-4294967296?(T=!0,d(_,L.pts)):x>0?_:L.pts},a[0].pts);return T&&k.logger.debug("PTS rollover detected"),o},v.remux=function(a,T,o,_,L,x,H,W){var U,G,Y,j,X,q,J=L,V=L,Q=a.pid>-1,ee=T.pid>-1,Z=T.samples.length,re=a.samples.length>0,ae=H&&Z>0||Z>1,le=(!Q||re)&&(!ee||ae)||this.ISGenerated||H;if(le){this.ISGenerated||(Y=this.generateIS(a,T,L));var ne=this.isVideoContiguous,ie=-1,oe;if(ae&&(ie=l(T.samples),!ne&&this.config.forceKeyFrameOnDiscontinuity))if(q=!0,ie>0){k.logger.warn("[mp4-remuxer]: Dropped "+ie+" out of "+Z+" video samples due to a missing keyframe");var ge=this.getVideoStartPts(T.samples);T.samples=T.samples.slice(ie),T.dropped+=ie,V+=(T.samples[0].pts-ge)/T.inputTimeScale,oe=V}else ie===-1&&(k.logger.warn("[mp4-remuxer]: No keyframe found out of "+Z+" video samples"),q=!1);if(this.ISGenerated){if(re&&ae){var he=this.getVideoStartPts(T.samples),me=d(a.samples[0].pts,he)-he,Ee=me/T.inputTimeScale;J+=Math.max(0,Ee),V+=Math.max(0,-Ee)}if(re){if(a.samplerate||(k.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),Y=this.generateIS(a,T,L)),G=this.remuxAudio(a,J,this.isAudioContiguous,x,ee||ae||W===F.PlaylistLevelType.AUDIO?V:void 0),ae){var pe=G?G.endPTS-G.startPTS:0;T.inputTimeScale||(k.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),Y=this.generateIS(a,T,L)),U=this.remuxVideo(T,V,ne,pe)}}else ae&&(U=this.remuxVideo(T,V,ne,0));U&&(U.firstKeyFrame=ie,U.independent=ie!==-1,U.firstKeyFramePTS=oe)}}return this.ISGenerated&&(o.samples.length&&(X=b(o,L,this._initPTS,this._initDTS)),_.samples.length&&(j=h(_,L,this._initPTS))),{audio:G,video:U,initSegment:Y,independent:q,text:j,id3:X}},v.generateIS=function(a,T,o){var _=a.samples,L=T.samples,x=this.typeSupported,H={},W=!(0,R.isFiniteNumber)(this._initPTS),U="audio/mp4",G,Y,j;if(W&&(G=Y=1/0),a.config&&_.length){switch(a.timescale=a.samplerate,a.segmentCodec){case"mp3":x.mpeg?(U="audio/mpeg",a.codec=""):x.mp3&&(a.codec="mp3");break}H.audio={id:"audio",container:U,codec:a.codec,initSegment:a.segmentCodec==="mp3"&&x.mpeg?new Uint8Array(0):w.default.initSegment([a]),metadata:{channelCount:a.channelCount}},W&&(j=a.inputTimeScale,G=Y=_[0].pts-Math.round(j*o))}if(T.sps&&T.pps&&L.length&&(T.timescale=T.inputTimeScale,H.video={id:"main",container:"video/mp4",codec:T.codec,initSegment:w.default.initSegment([T]),metadata:{width:T.width,height:T.height}},W)){j=T.inputTimeScale;var X=this.getVideoStartPts(L),q=Math.round(j*o);Y=Math.min(Y,d(L[0].dts,X)-q),G=Math.min(G,X-q)}if(Object.keys(H).length)return this.ISGenerated=!0,W&&(this._initPTS=G,this._initDTS=Y),{tracks:H,initPTS:G,timescale:j}},v.remuxVideo=function(a,T,o,_){var L=a.inputTimeScale,x=a.samples,H=[],W=x.length,U=this._initPTS,G=this.nextAvcDts,Y=8,j=this.videoSampleDuration,X,q,J=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,Q=!1;if(!o||G===null){var ee=T*L,Z=x[0].pts-d(x[0].dts,x[0].pts);G=ee-Z}for(var re=0;re<W;re++){var ae=x[re];ae.pts=d(ae.pts-U,G),ae.dts=d(ae.dts-U,G),ae.dts<x[re>0?re-1:re].dts&&(Q=!0)}Q&&x.sort(function(Ki,Oa){var Yc=Ki.dts-Oa.dts,Vc=Ki.pts-Oa.pts;return Yc||Vc}),X=x[0].dts,q=x[x.length-1].dts;var le=q-X,ne=le?Math.round(le/(W-1)):j||a.inputTimeScale/30;if(o){var ie=X-G,oe=ie>ne,ge=ie<-1;if((oe||ge)&&(oe?k.logger.warn("AVC: "+(0,B.toMsFromMpegTsClock)(ie,!0)+" ms ("+ie+"dts) hole between fragments detected, filling it"):k.logger.warn("AVC: "+(0,B.toMsFromMpegTsClock)(-ie,!0)+" ms ("+ie+"dts) overlapping between fragments detected"),!ge||G>x[0].pts)){X=G;var he=x[0].pts-ie;x[0].dts=X,x[0].pts=he,k.logger.log("Video: First PTS/DTS adjusted: "+(0,B.toMsFromMpegTsClock)(he,!0)+"/"+(0,B.toMsFromMpegTsClock)(X,!0)+", delta: "+(0,B.toMsFromMpegTsClock)(ie,!0)+" ms")}}X=Math.max(0,X);for(var me=0,Ee=0,pe=0;pe<W;pe++){for(var Te=x[pe],_e=Te.units,ye=_e.length,Le=0,ke=0;ke<ye;ke++)Le+=_e[ke].data.length;Ee+=Le,me+=ye,Te.length=Le,Te.dts=Math.max(Te.dts,X),J=Math.min(Te.pts,J),V=Math.max(Te.pts,V)}q=x[W-1].dts;var He=Ee+4*me+8,Ke;try{Ke=new Uint8Array(He)}catch{this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:K.ErrorTypes.MUX_ERROR,details:K.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:He,reason:"fail allocating video mdat "+He});return}var ct=new DataView(Ke.buffer);ct.setUint32(0,He),Ke.set(w.default.types.mdat,4);for(var Ne=!1,Ge=Number.POSITIVE_INFINITY,rt=Number.POSITIVE_INFINITY,dt=Number.NEGATIVE_INFINITY,ht=Number.NEGATIVE_INFINITY,qe=0;qe<W;qe++){for(var $e=x[qe],gt=$e.units,Tt=0,Ye=0,mt=gt.length;Ye<mt;Ye++){var _t=gt[Ye],Mn=_t.data,ar=_t.data.byteLength;ct.setUint32(Y,ar),Y+=4,Ke.set(Mn,Y),Y+=ar,Tt+=4+ar}var Cr=void 0;if(qe<W-1)j=x[qe+1].dts-$e.dts,Cr=x[qe+1].pts-$e.pts;else{var Ca=this.config,Fn=qe>0?$e.dts-x[qe-1].dts:ne;if(Cr=qe>0?$e.pts-x[qe-1].pts:ne,Ca.stretchShortVideoTrack&&this.nextAudioPts!==null){var Bc=Math.floor(Ca.maxBufferHole*L),Ui=(_?J+_*L:this.nextAudioPts)-$e.pts;Ui>Bc?(j=Ui-Fn,j<0?j=Fn:Ne=!0,k.logger.log("[mp4-remuxer]: It is approximately "+Ui/90+" ms to the next segment; using duration "+j/90+" ms for the last video frame.")):j=Fn}else j=Fn}var wc=Math.round($e.pts-$e.dts);Ge=Math.min(Ge,j),dt=Math.max(dt,j),rt=Math.min(rt,Cr),ht=Math.max(ht,Cr),H.push(new u($e.key,j,Tt,wc))}if(H.length){if(S){if(S<70){var La=H[0].flags;La.dependsOn=2,La.isNonSync=0}}else if(f&&ht-rt<dt-Ge&&ne/dt<.025&&H[0].cts===0){k.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Hi=X,At=0,Da=H.length;At<Da;At++){var Ra=Hi+H[At].duration,Uc=Hi+H[At].cts;if(At<Da-1){var Hc=Ra+H[At+1].cts;H[At].duration=Hc-Uc}else H[At].duration=At?H[At-1].duration:ne;H[At].cts=0,Hi=Ra}}}console.assert(j!==null,"mp4SampleDuration must be computed"),j=Ne||!j?ne:j,this.nextAvcDts=G=q+j,this.videoSampleDuration=j,this.isVideoContiguous=!0;var Kc=w.default.moof(a.sequenceNumber++,X,P({},a,{samples:H})),Wc="video",Gc={data1:Kc,data2:Ke,startPTS:J/L,endPTS:(V+j)/L,startDTS:X/L,endDTS:G/L,type:Wc,hasAudio:!1,hasVideo:!0,nb:H.length,dropped:a.dropped};return a.samples=[],a.dropped=0,console.assert(Ke.length,"MDAT length must not be zero"),Gc},v.remuxAudio=function(a,T,o,_,L){var x=a.inputTimeScale,H=a.samplerate?a.samplerate:x,W=x/H,U=a.segmentCodec==="aac"?g:M,G=U*W,Y=this._initPTS,j=a.segmentCodec==="mp3"&&this.typeSupported.mpeg,X=[],q=L!==void 0,J=a.samples,V=j?0:8,Q=this.nextAudioPts||-1,ee=T*x;if(this.isAudioContiguous=o=o||J.length&&Q>0&&(_&&Math.abs(ee-Q)<9e3||Math.abs(d(J[0].pts-Y,ee)-Q)<20*G),J.forEach(function(_t){_t.pts=d(_t.pts-Y,ee)}),!o||Q<0){if(J=J.filter(function(_t){return _t.pts>=0}),!J.length)return;L===0?Q=0:_&&!q?Q=Math.max(0,ee):Q=J[0].pts}if(a.segmentCodec==="aac")for(var Z=this.config.maxAudioFramesDrift,re=0,ae=Q;re<J.length;re++){var le=J[re],ne=le.pts,ie=ne-ae,oe=Math.abs(1e3*ie/x);if(ie<=-Z*G&&q)re===0&&(k.logger.warn("Audio frame @ "+(ne/x).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ie/x)+" ms."),this.nextAudioPts=Q=ae=ne);else if(ie>=Z*G&&oe<N&&q){var ge=Math.round(ie/G);ae=ne-ge*G,ae<0&&(ge--,ae+=G),re===0&&(this.nextAudioPts=Q=ae),k.logger.warn("[mp4-remuxer]: Injecting "+ge+" audio frame @ "+(ae/x).toFixed(3)+"s due to "+Math.round(1e3*ie/x)+" ms gap.");for(var he=0;he<ge;he++){var me=Math.max(ae,0),Ee=A.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);Ee||(k.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Ee=le.unit.subarray()),J.splice(re,0,{unit:Ee,pts:me}),ae+=G,re++}}le.pts=ae,ae+=G}for(var pe=null,Te=null,_e,ye=0,Le=J.length;Le--;)ye+=J[Le].unit.byteLength;for(var ke=0,He=J.length;ke<He;ke++){var Ke=J[ke],ct=Ke.unit,Ne=Ke.pts;if(Te!==null){var Ge=X[ke-1];Ge.duration=Math.round((Ne-Te)/W)}else if(o&&a.segmentCodec==="aac"&&(Ne=Q),pe=Ne,ye>0){ye+=V;try{_e=new Uint8Array(ye)}catch{this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:K.ErrorTypes.MUX_ERROR,details:K.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ye,reason:"fail allocating audio mdat "+ye});return}if(!j){var rt=new DataView(_e.buffer);rt.setUint32(0,ye),_e.set(w.default.types.mdat,4)}}else return;_e.set(ct,V);var dt=ct.byteLength;V+=dt,X.push(new u(!0,U,dt,0)),Te=Ne}var ht=X.length;if(ht){var qe=X[X.length-1];this.nextAudioPts=Q=Te+W*qe.duration;var $e=j?new Uint8Array(0):w.default.moof(a.sequenceNumber++,pe/W,P({},a,{samples:X}));a.samples=[];var gt=pe/x,Tt=Q/x,Ye="audio",mt={data1:$e,data2:_e,startPTS:gt,endPTS:Tt,startDTS:gt,endDTS:Tt,type:Ye,hasAudio:!0,hasVideo:!1,nb:ht};return this.isAudioContiguous=!0,console.assert(_e.length,"MDAT length must not be zero"),mt}},v.remuxEmptyAudio=function(a,T,o,_){var L=a.inputTimeScale,x=a.samplerate?a.samplerate:L,H=L/x,W=this.nextAudioPts,U=(W!==null?W:_.startDTS*L)+this._initDTS,G=_.endDTS*L+this._initDTS,Y=H*g,j=Math.ceil((G-U)/Y),X=A.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(k.logger.warn("[mp4-remuxer]: remux empty Audio"),!X){k.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var q=[],J=0;J<j;J++){var V=U+J*Y;q.push({unit:X,pts:V,dts:V})}return a.samples=q,this.remuxAudio(a,T,o,!1)},y}();function d(y,v){var c;if(v===null)return y;for(v<y?c=-8589934592:c=8589934592;Math.abs(y-v)>4294967296;)y+=c;return y}function l(y){for(var v=0;v<y.length;v++)if(y[v].key)return v;return-1}function b(y,v,c,a){var T=y.samples.length;if(T){for(var o=y.inputTimeScale,_=0;_<T;_++){var L=y.samples[_];L.pts=d(L.pts-c,v*o)/o,L.dts=d(L.dts-a,v*o)/o}var x=y.samples;return y.samples=[],{samples:x}}}function h(y,v,c){var a=y.samples.length;if(a){for(var T=y.inputTimeScale,o=0;o<a;o++){var _=y.samples[o];_.pts=d(_.pts-c,v*T)/T}y.samples.sort(function(x,H){return x.pts-H.pts});var L=y.samples;return y.samples=[],{samples:L}}}var u=function(v,c,a,T){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=c,this.size=a,this.cts=T,this.flags=new m(v)},m=function(v){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=v?2:1,this.isNonSync=v?0:1}},"./src/remux/passthrough-remuxer.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>B});var R=s("./src/polyfills/number.ts"),A=s("./src/remux/mp4-remuxer.ts"),w=s("./src/utils/mp4-tools.ts"),D=s("./src/loader/fragment.ts"),K=s("./src/utils/logger.ts"),k=function(){function P(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var N=P.prototype;return N.destroy=function(){},N.resetTimeStamp=function(M){this.initPTS=M,this.lastEndTime=null},N.resetNextTimestamp=function(){this.lastEndTime=null},N.resetInitSegment=function(M,S,f,E){this.audioCodec=S,this.videoCodec=f,this.generateInitSegment((0,w.patchEncyptionData)(M,E)),this.emitInitSegment=!0},N.generateInitSegment=function(M){var S=this.audioCodec,f=this.videoCodec;if(!M||!M.byteLength){this.initTracks=void 0,this.initData=void 0;return}var E=this.initData=(0,w.parseInitSegment)(M);S||(S=F(E.audio,D.ElementaryStreamTypes.AUDIO)),f||(f=F(E.video,D.ElementaryStreamTypes.VIDEO));var d={};E.audio&&E.video?d.audiovideo={container:"video/mp4",codec:S+","+f,initSegment:M,id:"main"}:E.audio?d.audio={container:"audio/mp4",codec:S,initSegment:M,id:"audio"}:E.video?d.video={container:"video/mp4",codec:f,initSegment:M,id:"main"}:K.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=d},N.remux=function(M,S,f,E,d){var l,b=this.initPTS,h=this.lastEndTime,u={audio:void 0,video:void 0,text:E,id3:f,initSegment:void 0};(0,R.isFiniteNumber)(h)||(h=this.lastEndTime=d||0);var m=S.samples;if(!m||!m.length)return u;var y={initPTS:void 0,timescale:1},v=this.initData;if((!v||!v.length)&&(this.generateInitSegment(m),v=this.initData),!v||!v.length)return K.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),u;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);var c=(0,w.getStartDTS)(v,m);(0,R.isFiniteNumber)(b)||(this.initPTS=y.initPTS=b=c-d);var a=(0,w.getDuration)(m,v),T=M?c-b:h,o=T+a;(0,w.offsetStartDTS)(v,m,b),a>0?this.lastEndTime=o:(K.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var _=!!v.audio,L=!!v.video,x="";_&&(x+="audio"),L&&(x+="video");var H={data1:m,startPTS:T,startDTS:T,endPTS:o,endDTS:o,type:x,hasAudio:_,hasVideo:L,nb:1,dropped:0};u.audio=H.type==="audio"?H:void 0,u.video=H.type!=="audio"?H:void 0,u.initSegment=y;var W=(l=this.initPTS)!=null?l:0;return u.id3=(0,A.flushTextTrackMetadataCueSamples)(f,d,W,W),E.samples.length&&(u.text=(0,A.flushTextTrackUserdataCueSamples)(E,d,W)),u},P}();function F(P,N){var g=P==null?void 0:P.codec;return g&&g.length>4?g:g==="hvc1"||g==="hev1"?"hvc1.1.c.L120.90":g==="av01"?"av01.0.04M.08":g==="avc1"||N===D.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const B=k},"./src/task-loop.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>R});var R=function(){function A(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var w=A.prototype;return w.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},w.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},w.onHandlerDestroyed=function(){},w.hasInterval=function(){return!!this._tickInterval},w.hasNextTick=function(){return!!this._tickTimer},w.setInterval=function(K){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,K),!0)},w.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},w.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},w.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},w.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},w.doTick=function(){},A}()},"./src/types/cmcd.ts":(O,I,s)=>{s.r(I),s.d(I,{CMCDObjectType:()=>A,CMCDStreamType:()=>D,CMCDStreamingFormat:()=>w,CMCDVersion:()=>R});var R=1,A;(function(K){K.MANIFEST="m",K.AUDIO="a",K.VIDEO="v",K.MUXED="av",K.INIT="i",K.CAPTION="c",K.TIMED_TEXT="tt",K.KEY="k",K.OTHER="o"})(A||(A={}));var w;(function(K){K.DASH="d",K.HLS="h",K.SMOOTH="s",K.OTHER="o"})(w||(w={}));var D;(function(K){K.VOD="v",K.LIVE="l"})(D||(D={}))},"./src/types/demuxer.ts":(O,I,s)=>{s.r(I),s.d(I,{MetadataSchema:()=>R});var R;(function(A){A.audioId3="org.id3",A.dateRange="com.apple.quicktime.HLS",A.emsg="https://aomedia.org/emsg/ID3"})(R||(R={}))},"./src/types/level.ts":(O,I,s)=>{s.r(I),s.d(I,{HdcpLevels:()=>K,HlsSkip:()=>k,HlsUrlParameters:()=>B,Level:()=>P,getSkipValue:()=>F});function R(N,g){for(var M=0;M<g.length;M++){var S=g[M];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(N,w(S.key),S)}}function A(N,g,M){return g&&R(N.prototype,g),M&&R(N,M),Object.defineProperty(N,"prototype",{writable:!1}),N}function w(N){var g=D(N,"string");return typeof g=="symbol"?g:String(g)}function D(N,g){if(typeof N!="object"||N===null)return N;var M=N[Symbol.toPrimitive];if(M!==void 0){var S=M.call(N,g||"default");if(typeof S!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(N)}var K=["NONE","TYPE-0","TYPE-1","TYPE-2",null],k;(function(N){N.No="",N.Yes="YES",N.v2="v2"})(k||(k={}));function F(N,g){var M=N.canSkipUntil,S=N.canSkipDateRanges,f=N.endSN,E=g!==void 0?g-f:0;return M&&E<M?S?k.v2:k.Yes:k.No}var B=function(){function N(M,S,f){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=M,this.part=S,this.skip=f}var g=N.prototype;return g.addDirectives=function(S){var f=new self.URL(S);return this.msn!==void 0&&f.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&f.searchParams.set("_HLS_part",this.part.toString()),this.skip&&f.searchParams.set("_HLS_skip",this.skip),f.href},N}(),P=function(){function N(g){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[g.url],this.attrs=g.attrs,this.bitrate=g.bitrate,g.details&&(this.details=g.details),this.id=g.id||0,this.name=g.name,this.width=g.width||0,this.height=g.height||0,this.audioCodec=g.audioCodec,this.videoCodec=g.videoCodec,this.unknownCodecs=g.unknownCodecs,this.codecSet=[g.videoCodec,g.audioCodec].filter(function(M){return M}).join(",").replace(/\.[^.,]+/g,"")}return A(N,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(M){var S=M%this.url.length;this._urlId!==S&&(this.details=void 0,this._urlId=S)}}]),N}()},"./src/types/loader.ts":(O,I,s)=>{s.r(I),s.d(I,{PlaylistContextType:()=>R,PlaylistLevelType:()=>A});var R;(function(w){w.MANIFEST="manifest",w.LEVEL="level",w.AUDIO_TRACK="audioTrack",w.SUBTITLE_TRACK="subtitleTrack"})(R||(R={}));var A;(function(w){w.MAIN="main",w.AUDIO="audio",w.SUBTITLE="subtitle"})(A||(A={}))},"./src/types/transmuxer.ts":(O,I,s)=>{s.r(I),s.d(I,{ChunkMetadata:()=>R});var R=function(D,K,k,F,B,P){F===void 0&&(F=0),B===void 0&&(B=-1),P===void 0&&(P=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=A(),this.buffering={audio:A(),video:A(),audiovideo:A()},this.level=D,this.sn=K,this.id=k,this.size=F,this.part=B,this.partial=P};function A(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(O,I,s)=>{s.r(I),s.d(I,{AttrList:()=>w});var R=/^(\d+)x(\d+)$/,A=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,w=function(){function D(k){typeof k=="string"&&(k=D.parseAttrList(k));for(var F in k)k.hasOwnProperty(F)&&(this[F]=k[F])}var K=D.prototype;return K.decimalInteger=function(F){var B=parseInt(this[F],10);return B>Number.MAX_SAFE_INTEGER?1/0:B},K.hexadecimalInteger=function(F){if(this[F]){var B=(this[F]||"0x").slice(2);B=(B.length&1?"0":"")+B;for(var P=new Uint8Array(B.length/2),N=0;N<B.length/2;N++)P[N]=parseInt(B.slice(N*2,N*2+2),16);return P}else return null},K.hexadecimalIntegerAsNumber=function(F){var B=parseInt(this[F],16);return B>Number.MAX_SAFE_INTEGER?1/0:B},K.decimalFloatingPoint=function(F){return parseFloat(this[F])},K.optionalFloat=function(F,B){var P=this[F];return P?parseFloat(P):B},K.enumeratedString=function(F){return this[F]},K.bool=function(F){return this[F]==="YES"},K.decimalResolution=function(F){var B=R.exec(this[F]);if(B!==null)return{width:parseInt(B[1],10),height:parseInt(B[2],10)}},D.parseAttrList=function(F){var B,P={},N='"';for(A.lastIndex=0;(B=A.exec(F))!==null;){var g=B[2];g.indexOf(N)===0&&g.lastIndexOf(N)===g.length-1&&(g=g.slice(1,-1)),P[B[1]]=g}return P},D}()},"./src/utils/binary-search.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>A});var R={search:function(D,K){for(var k=0,F=D.length-1,B=null,P=null;k<=F;){B=(k+F)/2|0,P=D[B];var N=K(P);if(N>0)k=B+1;else if(N<0)F=B-1;else return P}return null}};const A=R},"./src/utils/buffer-helper.ts":(O,I,s)=>{s.r(I),s.d(I,{BufferHelper:()=>w});var R=s("./src/utils/logger.ts"),A={length:0,start:function(){return 0},end:function(){return 0}},w=function(){function D(){}return D.isBuffered=function(k,F){try{if(k){for(var B=D.getBuffered(k),P=0;P<B.length;P++)if(F>=B.start(P)&&F<=B.end(P))return!0}}catch{}return!1},D.bufferInfo=function(k,F,B){try{if(k){var P=D.getBuffered(k),N=[],g;for(g=0;g<P.length;g++)N.push({start:P.start(g),end:P.end(g)});return this.bufferedInfo(N,F,B)}}catch{}return{len:0,start:F,end:F,nextStart:void 0}},D.bufferedInfo=function(k,F,B){F=Math.max(0,F),k.sort(function(u,m){var y=u.start-m.start;return y||m.end-u.end});var P=[];if(B)for(var N=0;N<k.length;N++){var g=P.length;if(g){var M=P[g-1].end;k[N].start-M<B?k[N].end>M&&(P[g-1].end=k[N].end):P.push(k[N])}else P.push(k[N])}else P=k;for(var S=0,f,E=F,d=F,l=0;l<P.length;l++){var b=P[l].start,h=P[l].end;if(F+B>=b&&F<h)E=b,d=h,S=d-F;else if(F+B<b){f=b;break}}return{len:S,start:E||0,end:d||0,nextStart:f}},D.getBuffered=function(k){try{return k.buffered}catch(F){return R.logger.log("failed to get media.buffered",F),A}},D}()},"./src/utils/cea-608-parser.ts":(O,I,s)=>{s.r(I),s.d(I,{CaptionScreen:()=>l,Row:()=>d,default:()=>v});var R=s("./src/utils/logger.ts"),A={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},w=function(a){var T=a;return A.hasOwnProperty(a)&&(T=A[a]),String.fromCharCode(T)},D=15,K=100,k={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},F={17:2,18:4,21:6,22:8,23:10,19:13,20:15},B={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},P={25:2,26:4,29:6,30:8,31:10,27:13,28:15},N=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],g;(function(c){c[c.ERROR=0]="ERROR",c[c.TEXT=1]="TEXT",c[c.WARNING=2]="WARNING",c[c.INFO=2]="INFO",c[c.DEBUG=3]="DEBUG",c[c.DATA=3]="DATA"})(g||(g={}));var M=function(){function c(){this.time=null,this.verboseLevel=g.ERROR}var a=c.prototype;return a.log=function(o,_){if(this.verboseLevel>=o){var L=typeof _=="function"?_():_;R.logger.log(this.time+" ["+o+"] "+L)}},c}(),S=function(a){for(var T=[],o=0;o<a.length;o++)T.push(a[o].toString(16));return T},f=function(){function c(T,o,_,L,x){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=T||"white",this.underline=o||!1,this.italics=_||!1,this.background=L||"black",this.flash=x||!1}var a=c.prototype;return a.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.setStyles=function(o){for(var _=["foreground","underline","italics","background","flash"],L=0;L<_.length;L++){var x=_[L];o.hasOwnProperty(x)&&(this[x]=o[x])}},a.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},a.equals=function(o){return this.foreground===o.foreground&&this.underline===o.underline&&this.italics===o.italics&&this.background===o.background&&this.flash===o.flash},a.copy=function(o){this.foreground=o.foreground,this.underline=o.underline,this.italics=o.italics,this.background=o.background,this.flash=o.flash},a.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},c}(),E=function(){function c(T,o,_,L,x,H){this.uchar=void 0,this.penState=void 0,this.uchar=T||" ",this.penState=new f(o,_,L,x,H)}var a=c.prototype;return a.reset=function(){this.uchar=" ",this.penState.reset()},a.setChar=function(o,_){this.uchar=o,this.penState.copy(_)},a.setPenState=function(o){this.penState.copy(o)},a.equals=function(o){return this.uchar===o.uchar&&this.penState.equals(o.penState)},a.copy=function(o){this.uchar=o.uchar,this.penState.copy(o.penState)},a.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},c}(),d=function(){function c(T){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var o=0;o<K;o++)this.chars.push(new E);this.logger=T,this.pos=0,this.currPenState=new f}var a=c.prototype;return a.equals=function(o){for(var _=!0,L=0;L<K;L++)if(!this.chars[L].equals(o.chars[L])){_=!1;break}return _},a.copy=function(o){for(var _=0;_<K;_++)this.chars[_].copy(o.chars[_])},a.isEmpty=function(){for(var o=!0,_=0;_<K;_++)if(!this.chars[_].isEmpty()){o=!1;break}return o},a.setCursor=function(o){this.pos!==o&&(this.pos=o),this.pos<0?(this.logger.log(g.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>K&&(this.logger.log(g.DEBUG,"Too large cursor position "+this.pos),this.pos=K)},a.moveCursor=function(o){var _=this.pos+o;if(o>1)for(var L=this.pos+1;L<_+1;L++)this.chars[L].setPenState(this.currPenState);this.setCursor(_)},a.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.insertChar=function(o){var _=this;o>=144&&this.backSpace();var L=w(o);if(this.pos>=K){this.logger.log(g.ERROR,function(){return"Cannot insert "+o.toString(16)+" ("+L+") at position "+_.pos+". Skipping it!"});return}this.chars[this.pos].setChar(L,this.currPenState),this.moveCursor(1)},a.clearFromPos=function(o){var _;for(_=o;_<K;_++)this.chars[_].reset()},a.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.getTextString=function(){for(var o=[],_=!0,L=0;L<K;L++){var x=this.chars[L].uchar;x!==" "&&(_=!1),o.push(x)}return _?"":o.join("")},a.setPenStyles=function(o){this.currPenState.setStyles(o);var _=this.chars[this.pos];_.setPenState(this.currPenState)},c}(),l=function(){function c(T){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var o=0;o<D;o++)this.rows.push(new d(T));this.logger=T,this.currRow=D-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var a=c.prototype;return a.reset=function(){for(var o=0;o<D;o++)this.rows[o].clear();this.currRow=D-1},a.equals=function(o){for(var _=!0,L=0;L<D;L++)if(!this.rows[L].equals(o.rows[L])){_=!1;break}return _},a.copy=function(o){for(var _=0;_<D;_++)this.rows[_].copy(o.rows[_])},a.isEmpty=function(){for(var o=!0,_=0;_<D;_++)if(!this.rows[_].isEmpty()){o=!1;break}return o},a.backSpace=function(){var o=this.rows[this.currRow];o.backSpace()},a.clearToEndOfRow=function(){var o=this.rows[this.currRow];o.clearToEndOfRow()},a.insertChar=function(o){var _=this.rows[this.currRow];_.insertChar(o)},a.setPen=function(o){var _=this.rows[this.currRow];_.setPenStyles(o)},a.moveCursor=function(o){var _=this.rows[this.currRow];_.moveCursor(o)},a.setCursor=function(o){this.logger.log(g.INFO,"setCursor: "+o);var _=this.rows[this.currRow];_.setCursor(o)},a.setPAC=function(o){this.logger.log(g.INFO,function(){return"pacData = "+JSON.stringify(o)});var _=o.row-1;if(this.nrRollUpRows&&_<this.nrRollUpRows-1&&(_=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==_){for(var L=0;L<D;L++)this.rows[L].clear();var x=this.currRow+1-this.nrRollUpRows,H=this.lastOutputScreen;if(H){var W=H.rows[x].cueStartTime,U=this.logger.time;if(W&&U!==null&&W<U)for(var G=0;G<this.nrRollUpRows;G++)this.rows[_-this.nrRollUpRows+G+1].copy(H.rows[x+G])}}this.currRow=_;var Y=this.rows[this.currRow];if(o.indent!==null){var j=o.indent,X=Math.max(j-1,0);Y.setCursor(o.indent),o.color=Y.chars[X].penState.foreground}var q={foreground:o.color,underline:o.underline,italics:o.italics,background:"black",flash:!1};this.setPen(q)},a.setBkgData=function(o){this.logger.log(g.INFO,function(){return"bkgData = "+JSON.stringify(o)}),this.backSpace(),this.setPen(o),this.insertChar(32)},a.setRollUpRows=function(o){this.nrRollUpRows=o},a.rollUp=function(){var o=this;if(this.nrRollUpRows===null){this.logger.log(g.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(g.TEXT,function(){return o.getDisplayText()});var _=this.currRow+1-this.nrRollUpRows,L=this.rows.splice(_,1)[0];L.clear(),this.rows.splice(this.currRow,0,L),this.logger.log(g.INFO,"Rolling up")},a.getDisplayText=function(o){o=o||!1;for(var _=[],L="",x=-1,H=0;H<D;H++){var W=this.rows[H].getTextString();W&&(x=H+1,o?_.push("Row "+x+": '"+W+"'"):_.push(W.trim()))}return _.length>0&&(o?L="["+_.join(" | ")+"]":L=_.join(`
`)),L},a.getTextAndFormat=function(){return this.rows},c}(),b=function(){function c(T,o,_){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=T,this.outputFilter=o,this.mode=null,this.verbose=0,this.displayedMemory=new l(_),this.nonDisplayedMemory=new l(_),this.lastOutputScreen=new l(_),this.currRollUpRow=this.displayedMemory.rows[D-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=_}var a=c.prototype;return a.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[D-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},a.getHandler=function(){return this.outputFilter},a.setHandler=function(o){this.outputFilter=o},a.setPAC=function(o){this.writeScreen.setPAC(o)},a.setBkgData=function(o){this.writeScreen.setBkgData(o)},a.setMode=function(o){o!==this.mode&&(this.mode=o,this.logger.log(g.INFO,function(){return"MODE="+o}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=o)},a.insertChars=function(o){for(var _=this,L=0;L<o.length;L++)this.writeScreen.insertChar(o[L]);var x=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(g.INFO,function(){return x+": "+_.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(g.TEXT,function(){return"DISPLAYED: "+_.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},a.ccRCL=function(){this.logger.log(g.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.ccBS=function(){this.logger.log(g.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.ccAOF=function(){},a.ccAON=function(){},a.ccDER=function(){this.logger.log(g.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.ccRU=function(o){this.logger.log(g.INFO,"RU("+o+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(o)},a.ccFON=function(){this.logger.log(g.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.ccRDC=function(){this.logger.log(g.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.ccTR=function(){this.logger.log(g.INFO,"TR"),this.setMode("MODE_TEXT")},a.ccRTD=function(){this.logger.log(g.INFO,"RTD"),this.setMode("MODE_TEXT")},a.ccEDM=function(){this.logger.log(g.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.ccCR=function(){this.logger.log(g.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.ccENM=function(){this.logger.log(g.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.ccEOC=function(){var o=this;if(this.logger.log(g.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var _=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=_,this.writeScreen=this.nonDisplayedMemory,this.logger.log(g.TEXT,function(){return"DISP: "+o.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},a.ccTO=function(o){this.logger.log(g.INFO,"TO("+o+") - Tab Offset"),this.writeScreen.moveCursor(o)},a.ccMIDROW=function(o){var _={flash:!1};if(_.underline=o%2===1,_.italics=o>=46,_.italics)_.foreground="white";else{var L=Math.floor(o/2)-16,x=["white","green","blue","cyan","red","yellow","magenta"];_.foreground=x[L]}this.logger.log(g.INFO,"MIDROW: "+JSON.stringify(_)),this.writeScreen.setPen(_)},a.outputDataUpdate=function(o){o===void 0&&(o=!1);var _=this.logger.time;_!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=_:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,_,this.lastOutputScreen),o&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:_),this.lastOutputScreen.copy(this.displayedMemory))},a.cueSplitAtTime=function(o){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,o,this.displayedMemory),this.cueStartTime=o))},c}(),h=function(){function c(T,o,_){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var L=new M;this.channels=[null,new b(T,o,L),new b(T+1,_,L)],this.cmdHistory=y(),this.logger=L}var a=c.prototype;return a.getHandler=function(o){return this.channels[o].getHandler()},a.setHandler=function(o,_){this.channels[o].setHandler(_)},a.addData=function(o,_){var L,x,H,W=!1;this.logger.time=o;for(var U=0;U<_.length;U+=2)if(x=_[U]&127,H=_[U+1]&127,!(x===0&&H===0)){if(this.logger.log(g.DATA,"["+S([_[U],_[U+1]])+"] -> ("+S([x,H])+")"),L=this.parseCmd(x,H),L||(L=this.parseMidrow(x,H)),L||(L=this.parsePAC(x,H)),L||(L=this.parseBackgroundAttributes(x,H)),!L&&(W=this.parseChars(x,H),W)){var G=this.currentChannel;if(G&&G>0){var Y=this.channels[G];Y.insertChars(W)}else this.logger.log(g.WARNING,"No channel found yet. TEXT-MODE?")}!L&&!W&&this.logger.log(g.WARNING,"Couldn't parse cleaned data "+S([x,H])+" orig: "+S([_[U],_[U+1]]))}},a.parseCmd=function(o,_){var L=this.cmdHistory,x=(o===20||o===28||o===21||o===29)&&_>=32&&_<=47,H=(o===23||o===31)&&_>=33&&_<=35;if(!(x||H))return!1;if(m(o,_,L))return u(null,null,L),this.logger.log(g.DEBUG,"Repeated command ("+S([o,_])+") is dropped"),!0;var W=o===20||o===21||o===23?1:2,U=this.channels[W];return o===20||o===21||o===28||o===29?_===32?U.ccRCL():_===33?U.ccBS():_===34?U.ccAOF():_===35?U.ccAON():_===36?U.ccDER():_===37?U.ccRU(2):_===38?U.ccRU(3):_===39?U.ccRU(4):_===40?U.ccFON():_===41?U.ccRDC():_===42?U.ccTR():_===43?U.ccRTD():_===44?U.ccEDM():_===45?U.ccCR():_===46?U.ccENM():_===47&&U.ccEOC():U.ccTO(_-32),u(o,_,L),this.currentChannel=W,!0},a.parseMidrow=function(o,_){var L=0;if((o===17||o===25)&&_>=32&&_<=47){if(o===17?L=1:L=2,L!==this.currentChannel)return this.logger.log(g.ERROR,"Mismatch channel in midrow parsing"),!1;var x=this.channels[L];return x?(x.ccMIDROW(_),this.logger.log(g.DEBUG,"MIDROW ("+S([o,_])+")"),!0):!1}return!1},a.parsePAC=function(o,_){var L,x=this.cmdHistory,H=(o>=17&&o<=23||o>=25&&o<=31)&&_>=64&&_<=127,W=(o===16||o===24)&&_>=64&&_<=95;if(!(H||W))return!1;if(m(o,_,x))return u(null,null,x),!0;var U=o<=23?1:2;_>=64&&_<=95?L=U===1?k[o]:B[o]:L=U===1?F[o]:P[o];var G=this.channels[U];return G?(G.setPAC(this.interpretPAC(L,_)),u(o,_,x),this.currentChannel=U,!0):!1},a.interpretPAC=function(o,_){var L,x={color:null,italics:!1,indent:null,underline:!1,row:o};return _>95?L=_-96:L=_-64,x.underline=(L&1)===1,L<=13?x.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(L/2)]:L<=15?(x.italics=!0,x.color="white"):x.indent=Math.floor((L-16)/2)*4,x},a.parseChars=function(o,_){var L,x=null,H=null;if(o>=25?(L=2,H=o-8):(L=1,H=o),H>=17&&H<=19){var W;H===17?W=_+80:H===18?W=_+112:W=_+144,this.logger.log(g.INFO,"Special char '"+w(W)+"' in channel "+L),x=[W]}else o>=32&&o<=127&&(x=_===0?[o]:[o,_]);if(x){var U=S(x);this.logger.log(g.DEBUG,"Char codes =  "+U.join(",")),u(o,_,this.cmdHistory)}return x},a.parseBackgroundAttributes=function(o,_){var L=(o===16||o===24)&&_>=32&&_<=47,x=(o===23||o===31)&&_>=45&&_<=47;if(!(L||x))return!1;var H,W={};o===16||o===24?(H=Math.floor((_-32)/2),W.background=N[H],_%2===1&&(W.background=W.background+"_semi")):_===45?W.background="transparent":(W.foreground="black",_===47&&(W.underline=!0));var U=o<=23?1:2,G=this.channels[U];return G.setBkgData(W),u(o,_,this.cmdHistory),!0},a.reset=function(){for(var o=0;o<Object.keys(this.channels).length;o++){var _=this.channels[o];_&&_.reset()}this.cmdHistory=y()},a.cueSplitAtTime=function(o){for(var _=0;_<this.channels.length;_++){var L=this.channels[_];L&&L.cueSplitAtTime(o)}},c}();function u(c,a,T){T.a=c,T.b=a}function m(c,a,T){return T.a===c&&T.b===a}function y(){return{a:null,b:null}}const v=h},"./src/utils/codecs.ts":(O,I,s)=>{s.r(I),s.d(I,{isCodecSupportedInMp4:()=>w,isCodecType:()=>A});var R={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function A(D,K){var k=R[K];return!!k&&k[D.slice(0,4)]===!0}function w(D,K){return MediaSource.isTypeSupported((K||"video")+'/mp4;codecs="'+D+'"')}},"./src/utils/cues.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>k});var R=s("./src/utils/vttparser.ts"),A=s("./src/utils/webvtt-parser.ts"),w=s("./src/utils/texttrack-utils.ts"),D=/\s/,K={newCue:function(B,P,N,g){for(var M=[],S,f,E,d,l,b=self.VTTCue||self.TextTrackCue,h=0;h<g.rows.length;h++)if(S=g.rows[h],E=!0,d=0,l="",!S.isEmpty()){for(var u=0;u<S.chars.length;u++)D.test(S.chars[u].uchar)&&E?d++:(l+=S.chars[u].uchar,E=!1);S.cueStartTime=P,P===N&&(N+=1e-4),d>=16?d--:d++;var m=(0,R.fixLineBreaks)(l.trim()),y=(0,A.generateCueId)(P,N,m);(!B||!B.cues||!B.cues.getCueById(y))&&(f=new b(P,N,m),f.id=y,f.line=h+1,f.align="left",f.position=10+Math.min(80,Math.floor(d*8/32)*10),M.push(f))}return B&&M.length&&(M.sort(function(v,c){return v.line==="auto"||c.line==="auto"?0:v.line>8&&c.line>8?c.line-v.line:v.line-c.line}),M.forEach(function(v){return(0,w.addCueToTrack)(B,v)})),M}};const k=K},"./src/utils/discontinuities.ts":(O,I,s)=>{s.r(I),s.d(I,{adjustSlidingStart:()=>B,alignMediaPlaylistByPDT:()=>M,alignPDT:()=>g,alignStream:()=>P,findDiscontinuousReferenceFrag:()=>k,findFirstFragWithCC:()=>D,shouldAlignOnDiscontinuities:()=>K});var R=s("./src/polyfills/number.ts"),A=s("./src/utils/logger.ts"),w=s("./src/controller/level-helper.ts");function D(S,f){for(var E=null,d=0,l=S.length;d<l;d++){var b=S[d];if(b&&b.cc===f){E=b;break}}return E}function K(S,f,E){return!!(f.details&&(E.endCC>E.startCC||S&&S.cc<E.startCC))}function k(S,f,E){var d=S.fragments,l=f.fragments;if(!l.length||!d.length){A.logger.log("No fragments to align");return}var b=D(d,l[0].cc);if(!b||b&&!b.startPTS){A.logger.log("No frag in previous level to align on");return}return b}function F(S,f){if(S){var E=S.start+f;S.start=S.startPTS=E,S.endPTS=E+S.duration}}function B(S,f){for(var E=f.fragments,d=0,l=E.length;d<l;d++)F(E[d],S);f.fragmentHint&&F(f.fragmentHint,S),f.alignedSliding=!0}function P(S,f,E){f&&(N(S,E,f),!E.alignedSliding&&f.details&&g(E,f.details),!E.alignedSliding&&f.details&&!E.skippedSegments&&(0,w.adjustSliding)(f.details,E))}function N(S,f,E){if(K(S,E,f)){var d=k(E.details,f);d&&(0,R.isFiniteNumber)(d.start)&&(A.logger.log("Adjusting PTS using last level due to CC increase within current level "+f.url),B(d.start,f))}}function g(S,f){if(!(!f.fragments.length||!S.hasProgramDateTime||!f.hasProgramDateTime)){var E=f.fragments[0].programDateTime,d=S.fragments[0].programDateTime,l=(d-E)/1e3+f.fragments[0].start;l&&(0,R.isFiniteNumber)(l)&&(A.logger.log("Adjusting PTS using programDateTime delta "+(d-E)+"ms, sliding:"+l.toFixed(3)+" "+S.url+" "),B(l,S))}}function M(S,f){if(!(!S.hasProgramDateTime||!f.hasProgramDateTime)){var E=S.fragments,d=f.fragments;if(!(!E.length||!d.length)){var l=Math.round(d.length/2)-1,b=d[l],h=D(E,b.cc)||E[Math.round(E.length/2)-1],u=b.programDateTime,m=h.programDateTime;if(!(u===null||m===null)){var y=(m-u)/1e3-(h.start-b.start);B(y,S)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>w});var R=s("./src/utils/ewma.ts"),A=function(){function D(k,F,B){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=B,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new R.default(k),this.fast_=new R.default(F)}var K=D.prototype;return K.update=function(F,B){var P=this.slow_,N=this.fast_;this.slow_.halfLife!==F&&(this.slow_=new R.default(F,P.getEstimate(),P.getTotalWeight())),this.fast_.halfLife!==B&&(this.fast_=new R.default(B,N.getEstimate(),N.getTotalWeight()))},K.sample=function(F,B){F=Math.max(F,this.minDelayMs_);var P=8*B,N=F/1e3,g=P/N;this.fast_.sample(N,g),this.slow_.sample(N,g)},K.canEstimate=function(){var F=this.fast_;return F&&F.getTotalWeight()>=this.minWeight_},K.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},K.destroy=function(){},D}();const w=A},"./src/utils/ewma.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>A});var R=function(){function w(K,k,F){k===void 0&&(k=0),F===void 0&&(F=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=K,this.alpha_=K?Math.exp(Math.log(.5)/K):0,this.estimate_=k,this.totalWeight_=F}var D=w.prototype;return D.sample=function(k,F){var B=Math.pow(this.alpha_,k);this.estimate_=F*(1-B)+B*this.estimate_,this.totalWeight_+=k},D.getTotalWeight=function(){return this.totalWeight_},D.getEstimate=function(){if(this.alpha_){var k=1-Math.pow(this.alpha_,this.totalWeight_);if(k)return this.estimate_/k}return this.estimate_},w}();const A=R},"./src/utils/fetch-loader.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>l,fetchSupported:()=>M});var R=s("./src/polyfills/number.ts"),A=s("./src/loader/load-stats.ts"),w=s("./src/demux/chunk-cache.ts");function D(b,h){b.prototype=Object.create(h.prototype),b.prototype.constructor=b,P(b,h)}function K(b){var h=typeof Map=="function"?new Map:void 0;return K=function(m){if(m===null||!B(m))return m;if(typeof m!="function")throw new TypeError("Super expression must either be null or a function");if(typeof h<"u"){if(h.has(m))return h.get(m);h.set(m,y)}function y(){return k(m,arguments,N(this).constructor)}return y.prototype=Object.create(m.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),P(y,m)},K(b)}function k(b,h,u){return F()?k=Reflect.construct.bind():k=function(y,v,c){var a=[null];a.push.apply(a,v);var T=Function.bind.apply(y,a),o=new T;return c&&P(o,c.prototype),o},k.apply(null,arguments)}function F(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function B(b){return Function.toString.call(b).indexOf("[native code]")!==-1}function P(b,h){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,y){return m.__proto__=y,m},P(b,h)}function N(b){return N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},N(b)}function g(){return g=Object.assign?Object.assign.bind():function(b){for(var h=1;h<arguments.length;h++){var u=arguments[h];for(var m in u)Object.prototype.hasOwnProperty.call(u,m)&&(b[m]=u[m])}return b},g.apply(this,arguments)}function M(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var S=function(){function b(u){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=u.fetchSetup||E,this.controller=new self.AbortController,this.stats=new A.LoadStats}var h=b.prototype;return h.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},h.abortInternal=function(){var m=this.response;(!m||!m.ok)&&(this.stats.aborted=!0,this.controller.abort())},h.abort=function(){var m;this.abortInternal(),(m=this.callbacks)!==null&&m!==void 0&&m.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},h.load=function(m,y,v){var c=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var T=f(m,this.controller.signal),o=v.onProgress,_=m.responseType==="arraybuffer",L=_?"byteLength":"length";this.context=m,this.config=y,this.callbacks=v,this.request=this.fetchSetup(m,T),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){c.abortInternal(),v.onTimeout(a,m,c.response)},y.timeout),self.fetch(this.request).then(function(x){if(c.response=c.loader=x,!x.ok){var H=x.status,W=x.statusText;throw new d(W||"fetch, bad network response",H,x)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(x.headers.get("Content-Length")||"0"),o&&(0,R.isFiniteNumber)(y.highWaterMark)?c.loadProgressively(x,a,m,y.highWaterMark,o):_?x.arrayBuffer():x.text()}).then(function(x){var H=c.response;self.clearTimeout(c.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);var W=x[L];W&&(a.loaded=a.total=W);var U={url:H.url,data:x};o&&!(0,R.isFiniteNumber)(y.highWaterMark)&&o(a,m,x,H),v.onSuccess(U,a,m,H)}).catch(function(x){if(self.clearTimeout(c.requestTimeout),!a.aborted){var H=x&&x.code||0,W=x?x.message:null;v.onError({code:H,text:W},m,x?x.details:null)}})},h.getCacheAge=function(){var m=null;if(this.response){var y=this.response.headers.get("age");m=y?parseFloat(y):null}return m},h.loadProgressively=function(m,y,v,c,a){c===void 0&&(c=0);var T=new w.default,o=m.body.getReader(),_=function L(){return o.read().then(function(x){if(x.done)return T.dataLength&&a(y,v,T.flush(),m),Promise.resolve(new ArrayBuffer(0));var H=x.value,W=H.length;return y.loaded+=W,W<c||T.dataLength?(T.push(H),T.dataLength>=c&&a(y,v,T.flush(),m)):a(y,v,H,m),L()}).catch(function(){return Promise.reject()})};return _()},b}();function f(b,h){var u={method:"GET",mode:"cors",credentials:"same-origin",signal:h,headers:new self.Headers(g({},b.headers))};return b.rangeEnd&&u.headers.set("Range","bytes="+b.rangeStart+"-"+String(b.rangeEnd-1)),u}function E(b,h){return new self.Request(b.url,h)}var d=function(b){D(h,b);function h(u,m,y){var v;return v=b.call(this,u)||this,v.code=void 0,v.details=void 0,v.code=m,v.details=y,v}return h}(K(Error));const l=S},"./src/utils/hex.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>A});var R={hexDump:function(D){for(var K="",k=0;k<D.length;k++){var F=D[k].toString(16);F.length<2&&(F="0"+F),K+=F}return K}};const A=R},"./src/utils/imsc1-ttml-parser.ts":(O,I,s)=>{s.r(I),s.d(I,{IMSC1_CODEC:()=>B,parseIMSC1:()=>M});var R=s("./src/utils/mp4-tools.ts"),A=s("./src/utils/vttparser.ts"),w=s("./src/utils/vttcue.ts"),D=s("./src/demux/id3.ts"),K=s("./src/utils/timescale-conversion.ts"),k=s("./src/utils/webvtt-parser.ts");function F(){return F=Object.assign?Object.assign.bind():function(v){for(var c=1;c<arguments.length;c++){var a=arguments[c];for(var T in a)Object.prototype.hasOwnProperty.call(a,T)&&(v[T]=a[T])}return v},F.apply(this,arguments)}var B="stpp.ttml.im1t",P=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,N=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,g={left:"start",center:"center",right:"end",start:"start",end:"end"};function M(v,c,a,T,o){var _=(0,R.findBox)(new Uint8Array(v),["mdat"]);if(_.length===0){o(new Error("Could not parse IMSC1 mdat"));return}var L=_.map(function(H){return(0,D.utf8ArrayToStr)(H)}),x=(0,K.toTimescaleFromScale)(c,1,a);try{L.forEach(function(H){return T(S(H,x))})}catch(H){o(H)}}function S(v,c){var a=new DOMParser,T=a.parseFromString(v,"text/xml"),o=T.getElementsByTagName("tt")[0];if(!o)throw new Error("Invalid ttml");var _={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},L=Object.keys(_).reduce(function(G,Y){return G[Y]=o.getAttribute("ttp:"+Y)||_[Y],G},{}),x=o.getAttribute("xml:space")!=="preserve",H=E(f(o,"styling","style")),W=E(f(o,"layout","region")),U=f(o,"body","[begin]");return[].map.call(U,function(G){var Y=d(G,x);if(!Y||!G.hasAttribute("begin"))return null;var j=u(G.getAttribute("begin"),L),X=u(G.getAttribute("dur"),L),q=u(G.getAttribute("end"),L);if(j===null)throw h(G);if(q===null){if(X===null)throw h(G);q=j+X}var J=new w.default(j-c,q-c,Y);J.id=(0,k.generateCueId)(J.startTime,J.endTime,J.text);var V=W[G.getAttribute("region")],Q=H[G.getAttribute("style")],ee=l(V,Q,H),Z=ee.textAlign;if(Z){var re=g[Z];re&&(J.lineAlign=re),J.align=Z}return F(J,ee),J}).filter(function(G){return G!==null})}function f(v,c,a){var T=v.getElementsByTagName(c)[0];return T?[].slice.call(T.querySelectorAll(a)):[]}function E(v){return v.reduce(function(c,a){var T=a.getAttribute("xml:id");return T&&(c[T]=a),c},{})}function d(v,c){return[].slice.call(v.childNodes).reduce(function(a,T,o){var _;return T.nodeName==="br"&&o?a+`
`:(_=T.childNodes)!==null&&_!==void 0&&_.length?d(T,c):c?a+T.textContent.trim().replace(/\s+/g," "):a+T.textContent},"")}function l(v,c,a){var T="http://www.w3.org/ns/ttml#styling",o=null,_=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],L=v!=null&&v.hasAttribute("style")?v.getAttribute("style"):null;return L&&a.hasOwnProperty(L)&&(o=a[L]),_.reduce(function(x,H){var W=b(c,T,H)||b(v,T,H)||b(o,T,H);return W&&(x[H]=W),x},{})}function b(v,c,a){return v&&v.hasAttributeNS(c,a)?v.getAttributeNS(c,a):null}function h(v){return new Error("Could not parse ttml timestamp "+v)}function u(v,c){if(!v)return null;var a=(0,A.parseTimeStamp)(v);return a===null&&(P.test(v)?a=m(v,c):N.test(v)&&(a=y(v,c))),a}function m(v,c){var a=P.exec(v),T=(a[4]|0)+(a[5]|0)/c.subFrameRate;return(a[1]|0)*3600+(a[2]|0)*60+(a[3]|0)+T/c.frameRate}function y(v,c){var a=N.exec(v),T=Number(a[1]),o=a[2];switch(o){case"h":return T*3600;case"m":return T*60;case"ms":return T*1e3;case"f":return T/c.frameRate;case"t":return T/c.tickRate}return T}},"./src/utils/keysystem-util.ts":(O,I,s)=>{s.r(I),s.d(I,{changeEndianness:()=>w,convertDataUriToArrayBytes:()=>D,strToUtf8array:()=>K});var R=s("./src/utils/numeric-encoding-utils.ts");function A(k){var F=K(k).subarray(0,16),B=new Uint8Array(16);return B.set(F,16-F.length),B}function w(k){var F=function(P,N,g){var M=P[N];P[N]=P[g],P[g]=M};F(k,0,3),F(k,1,2),F(k,4,5),F(k,6,7)}function D(k){var F=k.split(":"),B=null;if(F[0]==="data"&&F.length===2){var P=F[1].split(";"),N=P[P.length-1].split(",");if(N.length===2){var g=N[0]==="base64",M=N[1];g?(P.splice(-1,1),B=(0,R.base64Decode)(M)):B=A(M)}}return B}function K(k){return Uint8Array.from(unescape(encodeURIComponent(k)),function(F){return F.charCodeAt(0)})}},"./src/utils/logger.ts":(O,I,s)=>{s.r(I),s.d(I,{enableLogs:()=>k,logger:()=>F});var R=function(){},A={trace:R,debug:R,log:R,warn:R,info:R,error:R},w=A;function D(B){var P=self.console[B];return P?P.bind(self.console,"["+B+"] >"):R}function K(B){for(var P=arguments.length,N=new Array(P>1?P-1:0),g=1;g<P;g++)N[g-1]=arguments[g];N.forEach(function(M){w[M]=B[M]?B[M].bind(B):D(M)})}function k(B,P){if(self.console&&B===!0||typeof B=="object"){K(B,"debug","log","info","warn","error");try{w.log('Debug logs enabled for "'+P+'"')}catch{w=A}}else w=A}var F=w},"./src/utils/mediakeys-helper.ts":(O,I,s)=>{s.r(I),s.d(I,{KeySystemFormats:()=>A,KeySystemIds:()=>D,KeySystems:()=>R,getKeySystemsForConfig:()=>F,getSupportedMediaKeySystemConfigurations:()=>P,keySystemDomainToKeySystemFormat:()=>k,keySystemFormatToKeySystemDomain:()=>w,keySystemIdToKeySystemDomain:()=>K,requestMediaKeySystemAccess:()=>B});var R;(function(g){g.CLEARKEY="org.w3.clearkey",g.FAIRPLAY="com.apple.fps",g.PLAYREADY="com.microsoft.playready",g.WIDEVINE="com.widevine.alpha"})(R||(R={}));var A;(function(g){g.CLEARKEY="org.w3.clearkey",g.FAIRPLAY="com.apple.streamingkeydelivery",g.PLAYREADY="com.microsoft.playready",g.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"})(A||(A={}));function w(g){switch(g){case A.FAIRPLAY:return R.FAIRPLAY;case A.PLAYREADY:return R.PLAYREADY;case A.WIDEVINE:return R.WIDEVINE;case A.CLEARKEY:return R.CLEARKEY}}var D;(function(g){g.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"})(D||(D={}));function K(g){if(g===D.WIDEVINE)return R.WIDEVINE}function k(g){switch(g){case R.FAIRPLAY:return A.FAIRPLAY;case R.PLAYREADY:return A.PLAYREADY;case R.WIDEVINE:return A.WIDEVINE;case R.CLEARKEY:return A.CLEARKEY}}function F(g){var M=g.drmSystems,S=g.widevineLicenseUrl,f=M?[R.FAIRPLAY,R.WIDEVINE,R.PLAYREADY,R.CLEARKEY].filter(function(E){return!!M[E]}):[];return!f[R.WIDEVINE]&&S&&f.push(R.WIDEVINE),f}var B=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function P(g,M,S,f){var E;switch(g){case R.FAIRPLAY:E=["cenc","sinf"];break;case R.WIDEVINE:case R.PLAYREADY:E=["cenc"];break;case R.CLEARKEY:E=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+g)}return N(E,M,S,f)}function N(g,M,S,f){var E={initDataTypes:g,persistentState:f.persistentState||"not-allowed",distinctiveIdentifier:f.distinctiveIdentifier||"not-allowed",sessionTypes:f.sessionTypes||[f.sessionType||"temporary"],audioCapabilities:M.map(function(d){return{contentType:'audio/mp4; codecs="'+d+'"',robustness:f.audioRobustness||"",encryptionScheme:f.audioEncryptionScheme||null}}),videoCapabilities:S.map(function(d){return{contentType:'video/mp4; codecs="'+d+'"',robustness:f.videoRobustness||"",encryptionScheme:f.videoEncryptionScheme||null}})};return[E]}},"./src/utils/mediasource-helper.ts":(O,I,s)=>{s.r(I),s.d(I,{getMediaSource:()=>R});function R(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(O,I,s)=>{s.r(I),s.d(I,{RemuxerTrackIdConfig:()=>B,appendUint8Array:()=>c,bin2str:()=>P,computeRawDurationFromSamples:()=>m,discardEPB:()=>L,findBox:()=>f,getDuration:()=>u,getStartDTS:()=>h,mp4Box:()=>H,mp4pssh:()=>W,offsetStartDTS:()=>y,parseEmsg:()=>x,parseInitSegment:()=>d,parsePssh:()=>U,parseSEIMessageFromNALu:()=>_,parseSamples:()=>a,parseSegmentIndex:()=>E,parseSinf:()=>b,patchEncyptionData:()=>l,readSint32:()=>M,readUint16:()=>N,readUint32:()=>g,segmentValidRange:()=>v,writeUint32:()=>S});var R=s("./src/loader/fragment.ts"),A=s("./src/utils/typed-array.ts"),w=s("./src/demux/id3.ts"),D=s("./src/utils/logger.ts"),K=s("./src/utils/hex.ts"),k=Math.pow(2,32)-1,F=[].push,B={video:1,audio:2,id3:3,text:4};function P(G){return String.fromCharCode.apply(null,G)}function N(G,Y){var j=G[Y]<<8|G[Y+1];return j<0?65536+j:j}function g(G,Y){var j=M(G,Y);return j<0?4294967296+j:j}function M(G,Y){return G[Y]<<24|G[Y+1]<<16|G[Y+2]<<8|G[Y+3]}function S(G,Y,j){G[Y]=j>>24,G[Y+1]=j>>16&255,G[Y+2]=j>>8&255,G[Y+3]=j&255}function f(G,Y){var j=[];if(!Y.length)return j;for(var X=G.byteLength,q=0;q<X;){var J=g(G,q),V=P(G.subarray(q+4,q+8)),Q=J>1?q+J:X;if(V===Y[0])if(Y.length===1)j.push(G.subarray(q+8,Q));else{var ee=f(G.subarray(q+8,Q),Y.slice(1));ee.length&&F.apply(j,ee)}q=Q}return j}function E(G){var Y=[],j=G[0],X=8,q=g(G,X);X+=4;var J=0,V=0;j===0?X+=8:X+=16,X+=2;var Q=G.length+V,ee=N(G,X);X+=2;for(var Z=0;Z<ee;Z++){var re=X,ae=g(G,re);re+=4;var le=ae&2147483647,ne=(ae&2147483648)>>>31;if(ne===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var ie=g(G,re);re+=4,Y.push({referenceSize:le,subsegmentDuration:ie,info:{duration:ie/q,start:Q,end:Q+le-1}}),Q+=le,re+=4,X=re}return{earliestPresentationTime:J,timescale:q,version:j,referencesCount:ee,references:Y}}function d(G){for(var Y=[],j=f(G,["moov","trak"]),X=0;X<j.length;X++){var q=j[X],J=f(q,["tkhd"])[0];if(J){var V=J[0],Q=V===0?12:20,ee=g(J,Q),Z=f(q,["mdia","mdhd"])[0];if(Z){V=Z[0],Q=V===0?12:20;var re=g(Z,Q),ae=f(q,["mdia","hdlr"])[0];if(ae){var le=P(ae.subarray(8,12)),ne={soun:R.ElementaryStreamTypes.AUDIO,vide:R.ElementaryStreamTypes.VIDEO}[le];if(ne){var ie=f(q,["mdia","minf","stbl","stsd"])[0],oe=void 0;ie&&(oe=P(ie.subarray(12,16))),Y[ee]={timescale:re,type:ne},Y[ne]={timescale:re,id:ee,codec:oe}}}}}}var ge=f(G,["moov","mvex","trex"]);return ge.forEach(function(he){var me=g(he,4),Ee=Y[me];Ee&&(Ee.default={duration:g(he,12),flags:g(he,20)})}),Y}function l(G,Y){if(!G||!Y)return G;var j=Y.keyId;if(j&&Y.isCommonEncryption){var X=f(G,["moov","trak"]);X.forEach(function(q){var J=f(q,["mdia","minf","stbl","stsd"])[0],V=J.subarray(8),Q=f(V,["enca"]),ee=Q.length>0;ee||(Q=f(V,["encv"])),Q.forEach(function(Z){var re=ee?Z.subarray(28):Z.subarray(78),ae=f(re,["sinf"]);ae.forEach(function(le){var ne=b(le);if(ne){var ie=ne.subarray(8,24);ie.some(function(oe){return oe!==0})||(D.logger.log("[eme] Patching keyId in 'enc"+(ee?"a":"v")+">sinf>>tenc' box: "+K.default.hexDump(ie)+" -> "+K.default.hexDump(j)),ne.set(j,8))}})})})}return G}function b(G){var Y=f(G,["schm"])[0];if(Y){var j=P(Y.subarray(4,8));if(j==="cbcs"||j==="cenc")return f(G,["schi","tenc"])[0]}return D.logger.error("[eme] missing 'schm' box"),null}function h(G,Y){return f(Y,["moof","traf"]).reduce(function(j,X){var q=f(X,["tfdt"])[0],J=q[0],V=f(X,["tfhd"]).reduce(function(Q,ee){var Z=g(ee,4),re=G[Z];if(re){var ae=g(q,4);J===1&&(ae*=Math.pow(2,32),ae+=g(q,8));var le=re.timescale||9e4,ne=ae/le;if(isFinite(ne)&&(Q===null||ne<Q))return ne}return Q},null);return V!==null&&isFinite(V)&&(j===null||V<j)?V:j},null)||0}function u(G,Y){for(var j=0,X=0,q=0,J=f(G,["moof","traf"]),V=0;V<J.length;V++){var Q=J[V],ee=f(Q,["tfhd"])[0],Z=g(ee,4),re=Y[Z];if(re){var ae=re.default,le=g(ee,0)|(ae==null?void 0:ae.flags),ne=ae==null?void 0:ae.duration;le&8&&(le&2?ne=g(ee,12):ne=g(ee,8));for(var ie=re.timescale||9e4,oe=f(Q,["trun"]),ge=0;ge<oe.length;ge++){if(j=m(oe[ge]),!j&&ne){var he=g(oe[ge],4);j=ne*he}re.type===R.ElementaryStreamTypes.VIDEO?X+=j/ie:re.type===R.ElementaryStreamTypes.AUDIO&&(q+=j/ie)}}}if(X===0&&q===0){for(var me=0,Ee=f(G,["sidx"]),pe=0;pe<Ee.length;pe++){var Te=E(Ee[pe]);Te!=null&&Te.references&&(me+=Te.references.reduce(function(_e,ye){return _e+ye.info.duration||0},0))}return me}return X||q}function m(G){var Y=g(G,0),j=8;Y&1&&(j+=4),Y&4&&(j+=4);for(var X=0,q=g(G,4),J=0;J<q;J++){if(Y&256){var V=g(G,j);X+=V,j+=4}Y&512&&(j+=4),Y&1024&&(j+=4),Y&2048&&(j+=4)}return X}function y(G,Y,j){f(Y,["moof","traf"]).forEach(function(X){f(X,["tfhd"]).forEach(function(q){var J=g(q,4),V=G[J];if(V){var Q=V.timescale||9e4;f(X,["tfdt"]).forEach(function(ee){var Z=ee[0],re=g(ee,4);if(Z===0)re-=j*Q,re=Math.max(re,0),S(ee,4,re);else{re*=Math.pow(2,32),re+=g(ee,8),re-=j*Q,re=Math.max(re,0);var ae=Math.floor(re/(k+1)),le=Math.floor(re%(k+1));S(ee,4,ae),S(ee,8,le)}})}})})}function v(G){var Y={valid:null,remainder:null},j=f(G,["moof"]);if(j){if(j.length<2)return Y.remainder=G,Y}else return Y;var X=j[j.length-1];return Y.valid=(0,A.sliceUint8)(G,0,X.byteOffset-8),Y.remainder=(0,A.sliceUint8)(G,X.byteOffset-8),Y}function c(G,Y){var j=new Uint8Array(G.length+Y.length);return j.set(G),j.set(Y,G.length),j}function a(G,Y){var j=[],X=Y.samples,q=Y.timescale,J=Y.id,V=!1,Q=f(X,["moof"]);return Q.map(function(ee){var Z=ee.byteOffset-8,re=f(ee,["traf"]);re.map(function(ae){var le=f(ae,["tfdt"]).map(function(ne){var ie=ne[0],oe=g(ne,4);return ie===1&&(oe*=Math.pow(2,32),oe+=g(ne,8)),oe/q})[0];return le!==void 0&&(G=le),f(ae,["tfhd"]).map(function(ne){var ie=g(ne,4),oe=g(ne,0)&16777215,ge=(oe&1)!==0,he=(oe&2)!==0,me=(oe&8)!==0,Ee=0,pe=(oe&16)!==0,Te=0,_e=(oe&32)!==0,ye=8;ie===J&&(ge&&(ye+=8),he&&(ye+=4),me&&(Ee=g(ne,ye),ye+=4),pe&&(Te=g(ne,ye),ye+=4),_e&&(ye+=4),Y.type==="video"&&(V=T(Y.codec)),f(ae,["trun"]).map(function(Le){var ke=Le[0],He=g(Le,0)&16777215,Ke=(He&1)!==0,ct=0,Ne=(He&4)!==0,Ge=(He&256)!==0,rt=0,dt=(He&512)!==0,ht=0,qe=(He&1024)!==0,$e=(He&2048)!==0,gt=0,Tt=g(Le,4),Ye=8;Ke&&(ct=g(Le,Ye),Ye+=4),Ne&&(Ye+=4);for(var mt=ct+Z,_t=0;_t<Tt;_t++){if(Ge?(rt=g(Le,Ye),Ye+=4):rt=Ee,dt?(ht=g(Le,Ye),Ye+=4):ht=Te,qe&&(Ye+=4),$e&&(ke===0?gt=g(Le,Ye):gt=M(Le,Ye),Ye+=4),Y.type===R.ElementaryStreamTypes.VIDEO)for(var Mn=0;Mn<ht;){var ar=g(X,mt);if(mt+=4,o(V,X[mt])){var Cr=X.subarray(mt,mt+ar);_(Cr,V?2:1,G+gt/q,j)}mt+=ar,Mn+=ar+4}G+=rt/q}}))})})}),j}function T(G){if(!G)return!1;var Y=G.indexOf("."),j=Y<0?G:G.substring(0,Y);return j==="hvc1"||j==="hev1"||j==="dvh1"||j==="dvhe"}function o(G,Y){if(G){var j=Y>>1&63;return j===39||j===40}else{var X=Y&31;return X===6}}function _(G,Y,j,X){var q=L(G),J=0;J+=Y;for(var V=0,Q=0,ee=!1,Z=0;J<q.length;){V=0;do{if(J>=q.length)break;Z=q[J++],V+=Z}while(Z===255);Q=0;do{if(J>=q.length)break;Z=q[J++],Q+=Z}while(Z===255);var re=q.length-J;if(!ee&&V===4&&J<q.length){ee=!0;var ae=q[J++];if(ae===181){var le=N(q,J);if(J+=2,le===49){var ne=g(q,J);if(J+=4,ne===1195456820){var ie=q[J++];if(ie===3){var oe=q[J++],ge=31&oe,he=64&oe,me=he?2+ge*3:0,Ee=new Uint8Array(me);if(he){Ee[0]=oe;for(var pe=1;pe<me;pe++)Ee[pe]=q[J++]}X.push({type:ie,payloadType:V,pts:j,bytes:Ee})}}}}}else if(V===5&&Q<re){if(ee=!0,Q>16){for(var Te=[],_e=0;_e<16;_e++){var ye=q[J++].toString(16);Te.push(ye.length==1?"0"+ye:ye),(_e===3||_e===5||_e===7||_e===9)&&Te.push("-")}for(var Le=Q-16,ke=new Uint8Array(Le),He=0;He<Le;He++)ke[He]=q[J++];X.push({payloadType:V,pts:j,uuid:Te.join(""),userData:(0,w.utf8ArrayToStr)(ke),userDataBytes:ke})}}else if(Q<re)J+=Q;else if(Q>re)break}}function L(G){for(var Y=G.byteLength,j=[],X=1;X<Y-2;)G[X]===0&&G[X+1]===0&&G[X+2]===3?(j.push(X+2),X+=2):X++;if(j.length===0)return G;var q=Y-j.length,J=new Uint8Array(q),V=0;for(X=0;X<q;V++,X++)V===j[0]&&(V++,j.shift()),J[X]=G[V];return J}function x(G){var Y=G[0],j="",X="",q=0,J=0,V=0,Q=0,ee=0,Z=0;if(Y===0){for(;P(G.subarray(Z,Z+1))!=="\0";)j+=P(G.subarray(Z,Z+1)),Z+=1;for(j+=P(G.subarray(Z,Z+1)),Z+=1;P(G.subarray(Z,Z+1))!=="\0";)X+=P(G.subarray(Z,Z+1)),Z+=1;X+=P(G.subarray(Z,Z+1)),Z+=1,q=g(G,12),J=g(G,16),Q=g(G,20),ee=g(G,24),Z=28}else if(Y===1){Z+=4,q=g(G,Z),Z+=4;var re=g(G,Z);Z+=4;var ae=g(G,Z);for(Z+=4,V=Math.pow(2,32)*re+ae,Number.isSafeInteger(V)||(V=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),Q=g(G,Z),Z+=4,ee=g(G,Z),Z+=4;P(G.subarray(Z,Z+1))!=="\0";)j+=P(G.subarray(Z,Z+1)),Z+=1;for(j+=P(G.subarray(Z,Z+1)),Z+=1;P(G.subarray(Z,Z+1))!=="\0";)X+=P(G.subarray(Z,Z+1)),Z+=1;X+=P(G.subarray(Z,Z+1)),Z+=1}var le=G.subarray(Z,G.byteLength);return{schemeIdUri:j,value:X,timeScale:q,presentationTime:V,presentationTimeDelta:J,eventDuration:Q,id:ee,payload:le}}function H(G){for(var Y=arguments.length,j=new Array(Y>1?Y-1:0),X=1;X<Y;X++)j[X-1]=arguments[X];for(var q=j.length,J=8,V=q;V--;)J+=j[V].byteLength;var Q=new Uint8Array(J);for(Q[0]=J>>24&255,Q[1]=J>>16&255,Q[2]=J>>8&255,Q[3]=J&255,Q.set(G,4),V=0,J=8;V<q;V++)Q.set(j[V],J),J+=j[V].byteLength;return Q}function W(G,Y,j){if(G.byteLength!==16)throw new RangeError("Invalid system id");var X,q;if(Y){X=1,q=new Uint8Array(Y.length*16);for(var J=0;J<Y.length;J++){var V=Y[J];if(V.byteLength!==16)throw new RangeError("Invalid key");q.set(V,J*16)}}else X=0,q=new Uint8Array;var Q;X>0?(Q=new Uint8Array(4),Y.length>0&&new DataView(Q.buffer).setUint32(0,Y.length,!1)):Q=new Uint8Array;var ee=new Uint8Array(4);return j&&j.byteLength>0&&new DataView(ee.buffer).setUint32(0,j.byteLength,!1),H([112,115,115,104],new Uint8Array([X,0,0,0]),G,Q,q,ee,j||new Uint8Array)}function U(G){if(!(G instanceof ArrayBuffer)||G.byteLength<32)return null;var Y={version:0,systemId:"",kids:null,data:null},j=new DataView(G),X=j.getUint32(0);if(G.byteLength!==X&&X>44)return null;var q=j.getUint32(4);if(q!==1886614376||(Y.version=j.getUint32(8)>>>24,Y.version>1))return null;Y.systemId=K.default.hexDump(new Uint8Array(G,12,16));var J=j.getUint32(28);if(Y.version===0){if(X-32<J)return null;Y.data=new Uint8Array(G,32,J)}else if(Y.version===1){Y.kids=[];for(var V=0;V<J;V++)Y.kids.push(new Uint8Array(G,32+V*16,16))}return Y}},"./src/utils/numeric-encoding-utils.ts":(O,I,s)=>{s.r(I),s.d(I,{base64Decode:()=>k,base64DecodeToStr:()=>w,base64Encode:()=>D,base64ToBase64Url:()=>R,base64UrlEncode:()=>K,strToBase64Encode:()=>A});function R(F){return F.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function A(F){return btoa(F)}function w(F){return atob(F)}function D(F){return btoa(String.fromCharCode.apply(String,F))}function K(F){return R(D(F))}function k(F){return Uint8Array.from(atob(F),function(B){return B.charCodeAt(0)})}},"./src/utils/output-filter.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>R});var R=function(){function A(D,K){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=D,this.trackName=K}var w=A.prototype;return w.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},w.newCue=function(K,k,F){(this.startTime===null||this.startTime>K)&&(this.startTime=K),this.endTime=k,this.screen=F,this.timelineController.createCaptionsTrack(this.trackName)},w.reset=function(){this.cueRanges=[],this.startTime=null},A}()},"./src/utils/texttrack-utils.ts":(O,I,s)=>{s.r(I),s.d(I,{addCueToTrack:()=>w,clearCurrentCues:()=>D,getCuesInRange:()=>F,removeCuesInRange:()=>K,sendAddTrackEvent:()=>A});var R=s("./src/utils/logger.ts");function A(B,P){var N;try{N=new Event("addtrack")}catch{N=document.createEvent("Event"),N.initEvent("addtrack",!1,!1)}N.track=B,P.dispatchEvent(N)}function w(B,P){var N=B.mode;if(N==="disabled"&&(B.mode="hidden"),B.cues&&!B.cues.getCueById(P.id))try{if(B.addCue(P),!B.cues.getCueById(P.id))throw new Error("addCue is failed for: "+P)}catch(M){R.logger.debug("[texttrack-utils]: "+M);var g=new self.TextTrackCue(P.startTime,P.endTime,P.text);g.id=P.id,B.addCue(g)}N==="disabled"&&(B.mode=N)}function D(B){var P=B.mode;if(P==="disabled"&&(B.mode="hidden"),B.cues)for(var N=B.cues.length;N--;)B.removeCue(B.cues[N]);P==="disabled"&&(B.mode=P)}function K(B,P,N,g){var M=B.mode;if(M==="disabled"&&(B.mode="hidden"),B.cues&&B.cues.length>0)for(var S=F(B.cues,P,N),f=0;f<S.length;f++)(!g||g(S[f]))&&B.removeCue(S[f]);M==="disabled"&&(B.mode=M)}function k(B,P){if(P<B[0].startTime)return 0;var N=B.length-1;if(P>B[N].endTime)return-1;for(var g=0,M=N;g<=M;){var S=Math.floor((M+g)/2);if(P<B[S].startTime)M=S-1;else if(P>B[S].startTime&&g<N)g=S+1;else return S}return B[g].startTime-P<P-B[M].startTime?g:M}function F(B,P,N){var g=[],M=k(B,P);if(M>-1)for(var S=M,f=B.length;S<f;S++){var E=B[S];if(E.startTime>=P&&E.endTime<=N)g.push(E);else if(E.startTime>N)return g}return g}},"./src/utils/time-ranges.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>A});var R={toString:function(D){for(var K="",k=D.length,F=0;F<k;F++)K+="["+D.start(F).toFixed(3)+","+D.end(F).toFixed(3)+"]";return K}};const A=R},"./src/utils/timescale-conversion.ts":(O,I,s)=>{s.r(I),s.d(I,{toMpegTsClockFromTimescale:()=>K,toMsFromMpegTsClock:()=>D,toTimescaleFromBase:()=>A,toTimescaleFromScale:()=>w});var R=9e4;function A(k,F,B,P){B===void 0&&(B=1),P===void 0&&(P=!1);var N=k*F*B;return P?Math.round(N):N}function w(k,F,B,P){return B===void 0&&(B=1),P===void 0&&(P=!1),A(k,F,1/B,P)}function D(k,F){return F===void 0&&(F=!1),A(k,1e3,1/R,F)}function K(k,F){return F===void 0&&(F=1),A(k,R,1/F)}},"./src/utils/typed-array.ts":(O,I,s)=>{s.r(I),s.d(I,{sliceUint8:()=>R});function R(A,w,D){return Uint8Array.prototype.slice?A.slice(w,D):new Uint8Array(Array.prototype.slice.call(A,w,D))}},"./src/utils/vttcue.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>R});const R=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var A=["","lr","rl"],w=["start","middle","end","left","right"];function D(P,N){if(typeof N!="string"||!Array.isArray(P))return!1;var g=N.toLowerCase();return~P.indexOf(g)?g:!1}function K(P){return D(A,P)}function k(P){return D(w,P)}function F(P){for(var N=arguments.length,g=new Array(N>1?N-1:0),M=1;M<N;M++)g[M-1]=arguments[M];for(var S=1;S<arguments.length;S++){var f=arguments[S];for(var E in f)P[E]=f[E]}return P}function B(P,N,g){var M=this,S={enumerable:!0};M.hasBeenReset=!1;var f="",E=!1,d=P,l=N,b=g,h=null,u="",m=!0,y="auto",v="start",c=50,a="middle",T=50,o="middle";Object.defineProperty(M,"id",F({},S,{get:function(){return f},set:function(L){f=""+L}})),Object.defineProperty(M,"pauseOnExit",F({},S,{get:function(){return E},set:function(L){E=!!L}})),Object.defineProperty(M,"startTime",F({},S,{get:function(){return d},set:function(L){if(typeof L!="number")throw new TypeError("Start time must be set to a number.");d=L,this.hasBeenReset=!0}})),Object.defineProperty(M,"endTime",F({},S,{get:function(){return l},set:function(L){if(typeof L!="number")throw new TypeError("End time must be set to a number.");l=L,this.hasBeenReset=!0}})),Object.defineProperty(M,"text",F({},S,{get:function(){return b},set:function(L){b=""+L,this.hasBeenReset=!0}})),Object.defineProperty(M,"region",F({},S,{get:function(){return h},set:function(L){h=L,this.hasBeenReset=!0}})),Object.defineProperty(M,"vertical",F({},S,{get:function(){return u},set:function(L){var x=K(L);if(x===!1)throw new SyntaxError("An invalid or illegal string was specified.");u=x,this.hasBeenReset=!0}})),Object.defineProperty(M,"snapToLines",F({},S,{get:function(){return m},set:function(L){m=!!L,this.hasBeenReset=!0}})),Object.defineProperty(M,"line",F({},S,{get:function(){return y},set:function(L){if(typeof L!="number"&&L!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");y=L,this.hasBeenReset=!0}})),Object.defineProperty(M,"lineAlign",F({},S,{get:function(){return v},set:function(L){var x=k(L);if(!x)throw new SyntaxError("An invalid or illegal string was specified.");v=x,this.hasBeenReset=!0}})),Object.defineProperty(M,"position",F({},S,{get:function(){return c},set:function(L){if(L<0||L>100)throw new Error("Position must be between 0 and 100.");c=L,this.hasBeenReset=!0}})),Object.defineProperty(M,"positionAlign",F({},S,{get:function(){return a},set:function(L){var x=k(L);if(!x)throw new SyntaxError("An invalid or illegal string was specified.");a=x,this.hasBeenReset=!0}})),Object.defineProperty(M,"size",F({},S,{get:function(){return T},set:function(L){if(L<0||L>100)throw new Error("Size must be between 0 and 100.");T=L,this.hasBeenReset=!0}})),Object.defineProperty(M,"align",F({},S,{get:function(){return o},set:function(L){var x=k(L);if(!x)throw new SyntaxError("An invalid or illegal string was specified.");o=x,this.hasBeenReset=!0}})),M.displayState=void 0}return B.prototype.getCueAsHTML=function(){var P=self.WebVTT;return P.convertCueToDOMTree(self,this.text)},B}()},"./src/utils/vttparser.ts":(O,I,s)=>{s.r(I),s.d(I,{VTTParser:()=>N,fixLineBreaks:()=>P,parseTimeStamp:()=>w});var R=s("./src/utils/vttcue.ts"),A=function(){function g(){}var M=g.prototype;return M.decode=function(f,E){if(!f)return"";if(typeof f!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(f))},g}();function w(g){function M(f,E,d,l){return(f|0)*3600+(E|0)*60+(d|0)+parseFloat(l||0)}var S=g.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return S?parseFloat(S[2])>59?M(S[2],S[3],0,S[4]):M(S[1],S[2],S[3],S[4]):null}var D=function(){function g(){this.values=Object.create(null)}var M=g.prototype;return M.set=function(f,E){!this.get(f)&&E!==""&&(this.values[f]=E)},M.get=function(f,E,d){return d?this.has(f)?this.values[f]:E[d]:this.has(f)?this.values[f]:E},M.has=function(f){return f in this.values},M.alt=function(f,E,d){for(var l=0;l<d.length;++l)if(E===d[l]){this.set(f,E);break}},M.integer=function(f,E){/^-?\d+$/.test(E)&&this.set(f,parseInt(E,10))},M.percent=function(f,E){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(E)){var d=parseFloat(E);if(d>=0&&d<=100)return this.set(f,d),!0}return!1},g}();function K(g,M,S,f){var E=f?g.split(f):[g];for(var d in E)if(typeof E[d]=="string"){var l=E[d].split(S);if(l.length===2){var b=l[0],h=l[1];M(b,h)}}}var k=new R.default(0,0,""),F=k.align==="middle"?"middle":"center";function B(g,M,S){var f=g;function E(){var b=w(g);if(b===null)throw new Error("Malformed timestamp: "+f);return g=g.replace(/^[^\sa-zA-Z-]+/,""),b}function d(b,h){var u=new D;K(b,function(v,c){var a;switch(v){case"region":for(var T=S.length-1;T>=0;T--)if(S[T].id===c){u.set(v,S[T].region);break}break;case"vertical":u.alt(v,c,["rl","lr"]);break;case"line":a=c.split(","),u.integer(v,a[0]),u.percent(v,a[0])&&u.set("snapToLines",!1),u.alt(v,a[0],["auto"]),a.length===2&&u.alt("lineAlign",a[1],["start",F,"end"]);break;case"position":a=c.split(","),u.percent(v,a[0]),a.length===2&&u.alt("positionAlign",a[1],["start",F,"end","line-left","line-right","auto"]);break;case"size":u.percent(v,c);break;case"align":u.alt(v,c,["start",F,"end","left","right"]);break}},/:/,/\s/),h.region=u.get("region",null),h.vertical=u.get("vertical","");var m=u.get("line","auto");m==="auto"&&k.line===-1&&(m=-1),h.line=m,h.lineAlign=u.get("lineAlign","start"),h.snapToLines=u.get("snapToLines",!0),h.size=u.get("size",100),h.align=u.get("align",F);var y=u.get("position","auto");y==="auto"&&k.position===50&&(y=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=y}function l(){g=g.replace(/^\s+/,"")}if(l(),M.startTime=E(),l(),g.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+f);g=g.slice(3),l(),M.endTime=E(),l(),d(g,M)}function P(g){return g.replace(/<br(?: \/)?>/gi,`
`)}var N=function(){function g(){this.state="INITIAL",this.buffer="",this.decoder=new A,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var M=g.prototype;return M.parse=function(f){var E=this;f&&(E.buffer+=E.decoder.decode(f,{stream:!0}));function d(){var y=E.buffer,v=0;for(y=P(y);v<y.length&&y[v]!=="\r"&&y[v]!==`
`;)++v;var c=y.slice(0,v);return y[v]==="\r"&&++v,y[v]===`
`&&++v,E.buffer=y.slice(v),c}function l(y){K(y,function(v,c){},/:/)}try{var b="";if(E.state==="INITIAL"){if(!/\r\n|\n/.test(E.buffer))return this;b=d();var h=b.match(/^()?WEBVTT([ \t].*)?$/);if(!h||!h[0])throw new Error("Malformed WebVTT signature.");E.state="HEADER"}for(var u=!1;E.buffer;){if(!/\r\n|\n/.test(E.buffer))return this;switch(u?u=!1:b=d(),E.state){case"HEADER":/:/.test(b)?l(b):b||(E.state="ID");continue;case"NOTE":b||(E.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(b)){E.state="NOTE";break}if(!b)continue;if(E.cue=new R.default(0,0,""),E.state="CUE",b.indexOf("-->")===-1){E.cue.id=b;continue}case"CUE":if(!E.cue){E.state="BADCUE";continue}try{B(b,E.cue,E.regionList)}catch{E.cue=null,E.state="BADCUE";continue}E.state="CUETEXT";continue;case"CUETEXT":{var m=b.indexOf("-->")!==-1;if(!b||m&&(u=!0)){E.oncue&&E.cue&&E.oncue(E.cue),E.cue=null,E.state="ID";continue}if(E.cue===null)continue;E.cue.text&&(E.cue.text+=`
`),E.cue.text+=b}continue;case"BADCUE":b||(E.state="ID")}}}catch{E.state==="CUETEXT"&&E.cue&&E.oncue&&E.oncue(E.cue),E.cue=null,E.state=E.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},M.flush=function(){var f=this;try{if((f.cue||f.state==="HEADER")&&(f.buffer+=`

`,f.parse()),f.state==="INITIAL"||f.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(E){f.onparsingerror&&f.onparsingerror(E)}return f.onflush&&f.onflush(),this},g}()},"./src/utils/webvtt-parser.ts":(O,I,s)=>{s.r(I),s.d(I,{generateCueId:()=>N,parseWebVTT:()=>M});var R=s("./src/polyfills/number.ts"),A=s("./src/utils/vttparser.ts"),w=s("./src/demux/id3.ts"),D=s("./src/utils/timescale-conversion.ts"),K=s("./src/remux/mp4-remuxer.ts"),k=/\r\n|\n\r|\n|\r/g,F=function(f,E,d){return d===void 0&&(d=0),f.slice(d,d+E.length)===E},B=function(f){var E=parseInt(f.slice(-3)),d=parseInt(f.slice(-6,-4)),l=parseInt(f.slice(-9,-7)),b=f.length>9?parseInt(f.substring(0,f.indexOf(":"))):0;if(!(0,R.isFiniteNumber)(E)||!(0,R.isFiniteNumber)(d)||!(0,R.isFiniteNumber)(l)||!(0,R.isFiniteNumber)(b))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+f);return E+=1e3*d,E+=60*1e3*l,E+=60*60*1e3*b,E},P=function(f){for(var E=5381,d=f.length;d;)E=E*33^f.charCodeAt(--d);return(E>>>0).toString()};function N(S,f,E){return P(S.toString())+P(f.toString())+P(E)}var g=function(f,E,d){var l=f[E],b=f[l.prevCC];if(!b||!b.new&&l.new){f.ccOffset=f.presentationOffset=l.start,l.new=!1;return}for(;(h=b)!==null&&h!==void 0&&h.new;){var h;f.ccOffset+=l.start-b.start,l.new=!1,l=b,b=f[l.prevCC]}f.presentationOffset=d};function M(S,f,E,d,l,b,h,u){var m=new A.VTTParser,y=(0,w.utf8ArrayToStr)(new Uint8Array(S)).trim().replace(k,`
`).split(`
`),v=[],c=(0,D.toMpegTsClockFromTimescale)(f,E),a="00:00.000",T=0,o=0,_,L=!0;m.oncue=function(x){var H=d[l],W=d.ccOffset,U=(T-c)/9e4;H!=null&&H.new&&(o!==void 0?W=d.ccOffset=H.start:g(d,l,U)),U&&(W=U-d.presentationOffset);var G=x.endTime-x.startTime,Y=(0,K.normalizePts)((x.startTime+W-o)*9e4,b*9e4)/9e4;x.startTime=Math.max(Y,0),x.endTime=Math.max(Y+G,0);var j=x.text.trim();x.text=decodeURIComponent(encodeURIComponent(j)),x.id||(x.id=N(x.startTime,x.endTime,j)),x.endTime>0&&v.push(x)},m.onparsingerror=function(x){_=x},m.onflush=function(){if(_){u(_);return}h(v)},y.forEach(function(x){if(L)if(F(x,"X-TIMESTAMP-MAP=")){L=!1,x.slice(16).split(",").forEach(function(H){F(H,"LOCAL:")?a=H.slice(6):F(H,"MPEGTS:")&&(T=parseInt(H.slice(7)))});try{o=B(a)/1e3}catch(H){_=H}return}else x===""&&(L=!1);m.parse(x+`
`)}),m.flush()}},"./src/utils/xhr-loader.ts":(O,I,s)=>{s.r(I),s.d(I,{default:()=>K});var R=s("./src/utils/logger.ts"),A=s("./src/loader/load-stats.ts"),w=/^age:\s*[\d.]+\s*$/m,D=function(){function k(B){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=B?B.xhrSetup:null,this.stats=new A.LoadStats,this.retryDelay=0}var F=k.prototype;return F.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},F.abortInternal=function(){var P=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),P&&(P.onreadystatechange=null,P.onprogress=null,P.readyState!==4&&(this.stats.aborted=!0,P.abort()))},F.abort=function(){var P;this.abortInternal(),(P=this.callbacks)!==null&&P!==void 0&&P.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},F.load=function(P,N,g){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=P,this.config=N,this.callbacks=g,this.retryDelay=N.retryDelay,this.loadInternal()},F.loadInternal=function(){var P=this.config,N=this.context;if(P){var g=this.loader=new self.XMLHttpRequest,M=this.stats;M.loading.first=0,M.loaded=0;var S=this.xhrSetup;try{if(S)try{S(g,N.url)}catch{g.open("GET",N.url,!0),S(g,N.url)}g.readyState||g.open("GET",N.url,!0);var f=this.context.headers;if(f)for(var E in f)g.setRequestHeader(E,f[E])}catch(d){this.callbacks.onError({code:g.status,text:d.message},N,g);return}N.rangeEnd&&g.setRequestHeader("Range","bytes="+N.rangeStart+"-"+(N.rangeEnd-1)),g.onreadystatechange=this.readystatechange.bind(this),g.onprogress=this.loadprogress.bind(this),g.responseType=N.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),P.timeout),g.send()}},F.readystatechange=function(){var P=this.context,N=this.loader,g=this.stats;if(!(!P||!N)){var M=N.readyState,S=this.config;if(!g.aborted&&M>=2)if(self.clearTimeout(this.requestTimeout),g.loading.first===0&&(g.loading.first=Math.max(self.performance.now(),g.loading.start)),M===4){N.onreadystatechange=null,N.onprogress=null;var f=N.status,E=N.responseType==="arraybuffer";if(f>=200&&f<300&&(E&&N.response||N.responseText!==null)){g.loading.end=Math.max(self.performance.now(),g.loading.first);var d,l;if(E?(d=N.response,l=d.byteLength):(d=N.responseText,l=d.length),g.loaded=g.total=l,!this.callbacks)return;var b=this.callbacks.onProgress;if(b&&b(g,P,d,N),!this.callbacks)return;var h={url:N.responseURL,data:d};this.callbacks.onSuccess(h,g,P,N)}else g.retry>=S.maxRetry||f>=400&&f<499?(R.logger.error(f+" while loading "+P.url),this.callbacks.onError({code:f,text:N.statusText},P,N)):(R.logger.warn(f+" while loading "+P.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,S.maxRetryDelay),g.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),S.timeout)}},F.loadtimeout=function(){R.logger.warn("timeout while loading "+this.context.url);var P=this.callbacks;P&&(this.abortInternal(),P.onTimeout(this.stats,this.context,this.loader))},F.loadprogress=function(P){var N=this.stats;N.loaded=P.loaded,P.lengthComputable&&(N.total=P.total)},F.getCacheAge=function(){var P=null;if(this.loader&&w.test(this.loader.getAllResponseHeaders())){var N=this.loader.getResponseHeader("age");P=N?parseFloat(N):null}return P},k}();const K=D},"./node_modules/eventemitter3/index.js":O=>{var I=Object.prototype.hasOwnProperty,s="~";function R(){}Object.create&&(R.prototype=Object.create(null),new R().__proto__||(s=!1));function A(k,F,B){this.fn=k,this.context=F,this.once=B||!1}function w(k,F,B,P,N){if(typeof B!="function")throw new TypeError("The listener must be a function");var g=new A(B,P||k,N),M=s?s+F:F;return k._events[M]?k._events[M].fn?k._events[M]=[k._events[M],g]:k._events[M].push(g):(k._events[M]=g,k._eventsCount++),k}function D(k,F){--k._eventsCount===0?k._events=new R:delete k._events[F]}function K(){this._events=new R,this._eventsCount=0}K.prototype.eventNames=function(){var F=[],B,P;if(this._eventsCount===0)return F;for(P in B=this._events)I.call(B,P)&&F.push(s?P.slice(1):P);return Object.getOwnPropertySymbols?F.concat(Object.getOwnPropertySymbols(B)):F},K.prototype.listeners=function(F){var B=s?s+F:F,P=this._events[B];if(!P)return[];if(P.fn)return[P.fn];for(var N=0,g=P.length,M=new Array(g);N<g;N++)M[N]=P[N].fn;return M},K.prototype.listenerCount=function(F){var B=s?s+F:F,P=this._events[B];return P?P.fn?1:P.length:0},K.prototype.emit=function(F,B,P,N,g,M){var S=s?s+F:F;if(!this._events[S])return!1;var f=this._events[S],E=arguments.length,d,l;if(f.fn){switch(f.once&&this.removeListener(F,f.fn,void 0,!0),E){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,B),!0;case 3:return f.fn.call(f.context,B,P),!0;case 4:return f.fn.call(f.context,B,P,N),!0;case 5:return f.fn.call(f.context,B,P,N,g),!0;case 6:return f.fn.call(f.context,B,P,N,g,M),!0}for(l=1,d=new Array(E-1);l<E;l++)d[l-1]=arguments[l];f.fn.apply(f.context,d)}else{var b=f.length,h;for(l=0;l<b;l++)switch(f[l].once&&this.removeListener(F,f[l].fn,void 0,!0),E){case 1:f[l].fn.call(f[l].context);break;case 2:f[l].fn.call(f[l].context,B);break;case 3:f[l].fn.call(f[l].context,B,P);break;case 4:f[l].fn.call(f[l].context,B,P,N);break;default:if(!d)for(h=1,d=new Array(E-1);h<E;h++)d[h-1]=arguments[h];f[l].fn.apply(f[l].context,d)}}return!0},K.prototype.on=function(F,B,P){return w(this,F,B,P,!1)},K.prototype.once=function(F,B,P){return w(this,F,B,P,!0)},K.prototype.removeListener=function(F,B,P,N){var g=s?s+F:F;if(!this._events[g])return this;if(!B)return D(this,g),this;var M=this._events[g];if(M.fn)M.fn===B&&(!N||M.once)&&(!P||M.context===P)&&D(this,g);else{for(var S=0,f=[],E=M.length;S<E;S++)(M[S].fn!==B||N&&!M[S].once||P&&M[S].context!==P)&&f.push(M[S]);f.length?this._events[g]=f.length===1?f[0]:f:D(this,g)}return this},K.prototype.removeAllListeners=function(F){var B;return F?(B=s?s+F:F,this._events[B]&&D(this,B)):(this._events=new R,this._eventsCount=0),this},K.prototype.off=K.prototype.removeListener,K.prototype.addListener=K.prototype.on,K.prefixed=s,K.EventEmitter=K,O.exports=K},"./node_modules/url-toolkit/src/url-toolkit.js":function(O){(function(I){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,R=/^(?=([^\/?#]*))\1([^]*)$/,A=/(?:\/|^)\.(?=\/)/g,w=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,D={buildAbsoluteURL:function(K,k,F){if(F=F||{},K=K.trim(),k=k.trim(),!k){if(!F.alwaysNormalize)return K;var B=D.parseURL(K);if(!B)throw new Error("Error trying to parse base URL.");return B.path=D.normalizePath(B.path),D.buildURLFromParts(B)}var P=D.parseURL(k);if(!P)throw new Error("Error trying to parse relative URL.");if(P.scheme)return F.alwaysNormalize?(P.path=D.normalizePath(P.path),D.buildURLFromParts(P)):k;var N=D.parseURL(K);if(!N)throw new Error("Error trying to parse base URL.");if(!N.netLoc&&N.path&&N.path[0]!=="/"){var g=R.exec(N.path);N.netLoc=g[1],N.path=g[2]}N.netLoc&&!N.path&&(N.path="/");var M={scheme:N.scheme,netLoc:P.netLoc,path:null,params:P.params,query:P.query,fragment:P.fragment};if(!P.netLoc&&(M.netLoc=N.netLoc,P.path[0]!=="/"))if(!P.path)M.path=N.path,P.params||(M.params=N.params,P.query||(M.query=N.query));else{var S=N.path,f=S.substring(0,S.lastIndexOf("/")+1)+P.path;M.path=D.normalizePath(f)}return M.path===null&&(M.path=F.alwaysNormalize?D.normalizePath(P.path):P.path),D.buildURLFromParts(M)},parseURL:function(K){var k=s.exec(K);return k?{scheme:k[1]||"",netLoc:k[2]||"",path:k[3]||"",params:k[4]||"",query:k[5]||"",fragment:k[6]||""}:null},normalizePath:function(K){for(K=K.split("").reverse().join("").replace(A,"");K.length!==(K=K.replace(w,"")).length;);return K.split("").reverse().join("")},buildURLFromParts:function(K){return K.scheme+K.netLoc+K.path+K.params+K.query+K.fragment}};O.exports=D})()}},n={};function i(O){var I=n[O];if(I!==void 0)return I.exports;var s=n[O]={exports:{}};return r[O].call(s.exports,s,s.exports,i),s.exports}i.m=r,i.n=O=>{var I=O&&O.__esModule?()=>O.default:()=>O;return i.d(I,{a:I}),I},i.d=(O,I)=>{for(var s in I)i.o(I,s)&&!i.o(O,s)&&Object.defineProperty(O,s,{enumerable:!0,get:I[s]})},i.o=(O,I)=>Object.prototype.hasOwnProperty.call(O,I),i.r=O=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})};var p=i("./src/hls.ts");return p=p.default,p})())})(zT);const qT=zg(ks),JT={key:0},ZT=Oe("video",{id:"player",controls:"",class:"w-full h-full"},null,-1),e_=[ZT],t_=br({__name:"EpisodeView",setup(e){let t=Nr.currentRoute.value.params.episode,r=Nr.currentRoute.value.params.id;const n=pr();if(typeof t=="string"&&typeof r=="string"){let i=parseInt(r),p=parseInt(t),O=Sn.vostfr.find(I=>I.id==i);O?Fc(O.url).then(I=>{let s=I.episodes.find(R=>R.episode==p);s?RT("https://neko-sama.fr"+s.url).then(R=>{R?n.value={mp4:!1,uri:R.uri,available:!0,baseurl:R.baseurl}:(console.log("Video not found"),Nr.push("/"))}):(console.log("Episode not found"),Nr.push("/"))}):console.log("Anime not found")}return Ku(()=>{if(n.value&&n.value.available){console.log(n.value.uri);let i=document.getElementById("player"),p=new qT;p.loadSource(n.value.uri),p.attachMedia(i)}}),(i,p)=>n.value?(pt(),Bt("div",JT,e_)):ta("",!0)}}),Nr=p0({history:Mh("/"),routes:[{path:"/",name:"home",component:L0},{path:"/anime/:id",name:"anime",component:$T},{path:"/anime/:id/episode/:episode",name:"episode",component:t_}]});const kc=ch(Eh);kc.use(Nr);kc.mount("#app");
