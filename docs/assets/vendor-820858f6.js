function Ls(e,t){const r=Object.create(null),n=e.split(",");for(let i=0;i<n.length;i++)r[n[i]]=!0;return t?i=>!!r[i.toLowerCase()]:i=>!!r[i]}function Ds(e){if(Se(e)){const t={};for(let r=0;r<e.length;r++){const n=e[r],i=Ve(n)?Mc(n):Ds(n);if(i)for(const y in i)t[y]=i[y]}return t}else{if(Ve(e))return e;if(Ue(e))return e}}const Oc=/;(?![^(]*\))/g,Pc=/:([^]+)/,Nc=/\/\*.*?\*\//gs;function Mc(e){const t={};return e.replace(Nc,"").split(Oc).forEach(r=>{if(r){const n=r.split(Pc);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t}function Rs(e){let t="";if(Ve(e))t=e;else if(Se(e))for(let r=0;r<e.length;r++){const n=Rs(e[r]);n&&(t+=n+" ")}else if(Ue(e))for(const r in e)e[r]&&(t+=r+" ");return t.trim()}const Fc="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",kc=Ls(Fc);function Xu(e){return!!e||e===""}const iT=e=>Ve(e)?e:e==null?"":Se(e)||Ue(e)&&(e.toString===qu||!xe(e.toString))?JSON.stringify(e,Qu,2):String(e),Qu=(e,t)=>t&&t.__v_isRef?Qu(e,t.value):xr(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((r,[n,i])=>(r[`${n} =>`]=i,r),{})}:$u(t)?{[`Set(${t.size})`]:[...t.values()]}:Ue(t)&&!Se(t)&&!Ju(t)?String(t):t,Be={},Ir=[],St=()=>{},Bc=()=>!1,Uc=/^on[^a-z]/,ui=e=>Uc.test(e),Os=e=>e.startsWith("onUpdate:"),et=Object.assign,Ps=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},wc=Object.prototype.hasOwnProperty,De=(e,t)=>wc.call(e,t),Se=Array.isArray,xr=e=>oi(e)==="[object Map]",$u=e=>oi(e)==="[object Set]",xe=e=>typeof e=="function",Ve=e=>typeof e=="string",Ns=e=>typeof e=="symbol",Ue=e=>e!==null&&typeof e=="object",zu=e=>Ue(e)&&xe(e.then)&&xe(e.catch),qu=Object.prototype.toString,oi=e=>qu.call(e),Hc=e=>oi(e).slice(8,-1),Ju=e=>oi(e)==="[object Object]",Ms=e=>Ve(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,wn=Ls(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),li=e=>{const t=Object.create(null);return r=>t[r]||(t[r]=e(r))},Kc=/-(\w)/g,Ft=li(e=>e.replace(Kc,(t,r)=>r?r.toUpperCase():"")),Wc=/\B([A-Z])/g,wr=li(e=>e.replace(Wc,"-$1").toLowerCase()),ci=li(e=>e.charAt(0).toUpperCase()+e.slice(1)),Mi=li(e=>e?`on${ci(e)}`:""),cn=(e,t)=>!Object.is(e,t),Fi=(e,t)=>{for(let r=0;r<e.length;r++)e[r](t)},jn=(e,t,r)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:r})},Zu=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let ya;const Gc=()=>ya||(ya=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Dt;class Yc{constructor(t=!1){this.detached=t,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Dt,!t&&Dt&&(this.index=(Dt.scopes||(Dt.scopes=[])).push(this)-1)}run(t){if(this.active){const r=Dt;try{return Dt=this,t()}finally{Dt=r}}}on(){Dt=this}off(){Dt=this.parent}stop(t){if(this.active){let r,n;for(r=0,n=this.effects.length;r<n;r++)this.effects[r].stop();for(r=0,n=this.cleanups.length;r<n;r++)this.cleanups[r]();if(this.scopes)for(r=0,n=this.scopes.length;r<n;r++)this.scopes[r].stop(!0);if(!this.detached&&this.parent&&!t){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.parent=void 0,this.active=!1}}}function Vc(e,t=Dt){t&&t.active&&t.effects.push(e)}const Fs=e=>{const t=new Set(e);return t.w=0,t.n=0,t},eo=e=>(e.w&Zt)>0,to=e=>(e.n&Zt)>0,jc=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=Zt},Xc=e=>{const{deps:t}=e;if(t.length){let r=0;for(let n=0;n<t.length;n++){const i=t[n];eo(i)&&!to(i)?i.delete(e):t[r++]=i,i.w&=~Zt,i.n&=~Zt}t.length=r}},ts=new WeakMap;let zr=0,Zt=1;const rs=30;let At;const fr=Symbol(""),ns=Symbol("");class ks{constructor(t,r=null,n){this.fn=t,this.scheduler=r,this.active=!0,this.deps=[],this.parent=void 0,Vc(this,n)}run(){if(!this.active)return this.fn();let t=At,r=zt;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=At,At=this,zt=!0,Zt=1<<++zr,zr<=rs?jc(this):ba(this),this.fn()}finally{zr<=rs&&Xc(this),Zt=1<<--zr,At=this.parent,zt=r,this.parent=void 0,this.deferStop&&this.stop()}}stop(){At===this?this.deferStop=!0:this.active&&(ba(this),this.onStop&&this.onStop(),this.active=!1)}}function ba(e){const{deps:t}=e;if(t.length){for(let r=0;r<t.length;r++)t[r].delete(e);t.length=0}}let zt=!0;const ro=[];function Hr(){ro.push(zt),zt=!1}function Kr(){const e=ro.pop();zt=e===void 0?!0:e}function ct(e,t,r){if(zt&&At){let n=ts.get(e);n||ts.set(e,n=new Map);let i=n.get(r);i||n.set(r,i=Fs()),no(i)}}function no(e,t){let r=!1;zr<=rs?to(e)||(e.n|=Zt,r=!eo(e)):r=!e.has(At),r&&(e.add(At),At.deps.push(e))}function Wt(e,t,r,n,i,y){const M=ts.get(e);if(!M)return;let C=[];if(t==="clear")C=[...M.values()];else if(r==="length"&&Se(e)){const u=Zu(n);M.forEach((R,_)=>{(_==="length"||_>=u)&&C.push(R)})}else switch(r!==void 0&&C.push(M.get(r)),t){case"add":Se(e)?Ms(r)&&C.push(M.get("length")):(C.push(M.get(fr)),xr(e)&&C.push(M.get(ns)));break;case"delete":Se(e)||(C.push(M.get(fr)),xr(e)&&C.push(M.get(ns)));break;case"set":xr(e)&&C.push(M.get(fr));break}if(C.length===1)C[0]&&is(C[0]);else{const u=[];for(const R of C)R&&u.push(...R);is(Fs(u))}}function is(e,t){const r=Se(e)?e:[...e];for(const n of r)n.computed&&Sa(n);for(const n of r)n.computed||Sa(n)}function Sa(e,t){(e!==At||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const Qc=Ls("__proto__,__v_isRef,__isVue"),io=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(Ns)),$c=Bs(),zc=Bs(!1,!0),qc=Bs(!0),Ia=Jc();function Jc(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...r){const n=Oe(this);for(let y=0,M=this.length;y<M;y++)ct(n,"get",y+"");const i=n[t](...r);return i===-1||i===!1?n[t](...r.map(Oe)):i}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...r){Hr();const n=Oe(this)[t].apply(this,r);return Kr(),n}}),e}function Bs(e=!1,t=!1){return function(n,i,y){if(i==="__v_isReactive")return!e;if(i==="__v_isReadonly")return e;if(i==="__v_isShallow")return t;if(i==="__v_raw"&&y===(e?t?Ef:lo:t?oo:uo).get(n))return n;const M=Se(n);if(!e&&M&&De(Ia,i))return Reflect.get(Ia,i,y);const C=Reflect.get(n,i,y);return(Ns(i)?io.has(i):Qc(i))||(e||ct(n,"get",i),t)?C:qe(C)?M&&Ms(i)?C:C.value:Ue(C)?e?co(C):An(C):C}}const Zc=so(),ef=so(!0);function so(e=!1){return function(r,n,i,y){let M=r[n];if(Pr(M)&&qe(M)&&!qe(i))return!1;if(!e&&(!Xn(i)&&!Pr(i)&&(M=Oe(M),i=Oe(i)),!Se(r)&&qe(M)&&!qe(i)))return M.value=i,!0;const C=Se(r)&&Ms(n)?Number(n)<r.length:De(r,n),u=Reflect.set(r,n,i,y);return r===Oe(y)&&(C?cn(i,M)&&Wt(r,"set",n,i):Wt(r,"add",n,i)),u}}function tf(e,t){const r=De(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&r&&Wt(e,"delete",t,void 0),n}function rf(e,t){const r=Reflect.has(e,t);return(!Ns(t)||!io.has(t))&&ct(e,"has",t),r}function nf(e){return ct(e,"iterate",Se(e)?"length":fr),Reflect.ownKeys(e)}const ao={get:$c,set:Zc,deleteProperty:tf,has:rf,ownKeys:nf},sf={get:qc,set(e,t){return!0},deleteProperty(e,t){return!0}},af=et({},ao,{get:zc,set:ef}),Us=e=>e,fi=e=>Reflect.getPrototypeOf(e);function Ln(e,t,r=!1,n=!1){e=e.__v_raw;const i=Oe(e),y=Oe(t);r||(t!==y&&ct(i,"get",t),ct(i,"get",y));const{has:M}=fi(i),C=n?Us:r?Ks:fn;if(M.call(i,t))return C(e.get(t));if(M.call(i,y))return C(e.get(y));e!==i&&e.get(t)}function Dn(e,t=!1){const r=this.__v_raw,n=Oe(r),i=Oe(e);return t||(e!==i&&ct(n,"has",e),ct(n,"has",i)),e===i?r.has(e):r.has(e)||r.has(i)}function Rn(e,t=!1){return e=e.__v_raw,!t&&ct(Oe(e),"iterate",fr),Reflect.get(e,"size",e)}function xa(e){e=Oe(e);const t=Oe(this);return fi(t).has.call(t,e)||(t.add(e),Wt(t,"add",e,e)),this}function Ca(e,t){t=Oe(t);const r=Oe(this),{has:n,get:i}=fi(r);let y=n.call(r,e);y||(e=Oe(e),y=n.call(r,e));const M=i.call(r,e);return r.set(e,t),y?cn(t,M)&&Wt(r,"set",e,t):Wt(r,"add",e,t),this}function La(e){const t=Oe(this),{has:r,get:n}=fi(t);let i=r.call(t,e);i||(e=Oe(e),i=r.call(t,e)),n&&n.call(t,e);const y=t.delete(e);return i&&Wt(t,"delete",e,void 0),y}function Da(){const e=Oe(this),t=e.size!==0,r=e.clear();return t&&Wt(e,"clear",void 0,void 0),r}function On(e,t){return function(n,i){const y=this,M=y.__v_raw,C=Oe(M),u=t?Us:e?Ks:fn;return!e&&ct(C,"iterate",fr),M.forEach((R,_)=>n.call(i,u(R),u(_),y))}}function Pn(e,t,r){return function(...n){const i=this.__v_raw,y=Oe(i),M=xr(y),C=e==="entries"||e===Symbol.iterator&&M,u=e==="keys"&&M,R=i[e](...n),_=r?Us:t?Ks:fn;return!t&&ct(y,"iterate",u?ns:fr),{next(){const{value:U,done:D}=R.next();return D?{value:U,done:D}:{value:C?[_(U[0]),_(U[1])]:_(U),done:D}},[Symbol.iterator](){return this}}}}function Yt(e){return function(...t){return e==="delete"?!1:this}}function uf(){const e={get(y){return Ln(this,y)},get size(){return Rn(this)},has:Dn,add:xa,set:Ca,delete:La,clear:Da,forEach:On(!1,!1)},t={get(y){return Ln(this,y,!1,!0)},get size(){return Rn(this)},has:Dn,add:xa,set:Ca,delete:La,clear:Da,forEach:On(!1,!0)},r={get(y){return Ln(this,y,!0)},get size(){return Rn(this,!0)},has(y){return Dn.call(this,y,!0)},add:Yt("add"),set:Yt("set"),delete:Yt("delete"),clear:Yt("clear"),forEach:On(!0,!1)},n={get(y){return Ln(this,y,!0,!0)},get size(){return Rn(this,!0)},has(y){return Dn.call(this,y,!0)},add:Yt("add"),set:Yt("set"),delete:Yt("delete"),clear:Yt("clear"),forEach:On(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(y=>{e[y]=Pn(y,!1,!1),r[y]=Pn(y,!0,!1),t[y]=Pn(y,!1,!0),n[y]=Pn(y,!0,!0)}),[e,r,t,n]}const[of,lf,cf,ff]=uf();function ws(e,t){const r=t?e?ff:cf:e?lf:of;return(n,i,y)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?n:Reflect.get(De(r,i)&&i in n?r:n,i,y)}const df={get:ws(!1,!1)},hf={get:ws(!1,!0)},gf={get:ws(!0,!1)},uo=new WeakMap,oo=new WeakMap,lo=new WeakMap,Ef=new WeakMap;function mf(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function vf(e){return e.__v_skip||!Object.isExtensible(e)?0:mf(Hc(e))}function An(e){return Pr(e)?e:Hs(e,!1,ao,df,uo)}function pf(e){return Hs(e,!1,af,hf,oo)}function co(e){return Hs(e,!0,sf,gf,lo)}function Hs(e,t,r,n,i){if(!Ue(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const y=i.get(e);if(y)return y;const M=vf(e);if(M===0)return e;const C=new Proxy(e,M===2?n:r);return i.set(e,C),C}function Cr(e){return Pr(e)?Cr(e.__v_raw):!!(e&&e.__v_isReactive)}function Pr(e){return!!(e&&e.__v_isReadonly)}function Xn(e){return!!(e&&e.__v_isShallow)}function fo(e){return Cr(e)||Pr(e)}function Oe(e){const t=e&&e.__v_raw;return t?Oe(t):e}function ho(e){return jn(e,"__v_skip",!0),e}const fn=e=>Ue(e)?An(e):e,Ks=e=>Ue(e)?co(e):e;function go(e){zt&&At&&(e=Oe(e),no(e.dep||(e.dep=Fs())))}function Eo(e,t){e=Oe(e),e.dep&&is(e.dep)}function qe(e){return!!(e&&e.__v_isRef===!0)}function Tf(e){return mo(e,!1)}function _f(e){return mo(e,!0)}function mo(e,t){return qe(e)?e:new Af(e,t)}class Af{constructor(t,r){this.__v_isShallow=r,this.dep=void 0,this.__v_isRef=!0,this._rawValue=r?t:Oe(t),this._value=r?t:fn(t)}get value(){return go(this),this._value}set value(t){const r=this.__v_isShallow||Xn(t)||Pr(t);t=r?t:Oe(t),cn(t,this._rawValue)&&(this._rawValue=t,this._value=r?t:fn(t),Eo(this))}}function Lr(e){return qe(e)?e.value:e}const yf={get:(e,t,r)=>Lr(Reflect.get(e,t,r)),set:(e,t,r,n)=>{const i=e[t];return qe(i)&&!qe(r)?(i.value=r,!0):Reflect.set(e,t,r,n)}};function vo(e){return Cr(e)?e:new Proxy(e,yf)}var po;class bf{constructor(t,r,n,i){this._setter=r,this.dep=void 0,this.__v_isRef=!0,this[po]=!1,this._dirty=!0,this.effect=new ks(t,()=>{this._dirty||(this._dirty=!0,Eo(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=n}get value(){const t=Oe(this);return go(t),(t._dirty||!t._cacheable)&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}po="__v_isReadonly";function Sf(e,t,r=!1){let n,i;const y=xe(e);return y?(n=e,i=St):(n=e.get,i=e.set),new bf(n,i,y||!i,r)}function qt(e,t,r,n){let i;try{i=n?e(...n):e()}catch(y){di(y,t,r)}return i}function It(e,t,r,n){if(xe(e)){const y=qt(e,t,r,n);return y&&zu(y)&&y.catch(M=>{di(M,t,r)}),y}const i=[];for(let y=0;y<e.length;y++)i.push(It(e[y],t,r,n));return i}function di(e,t,r,n=!0){const i=t?t.vnode:null;if(t){let y=t.parent;const M=t.proxy,C=r;for(;y;){const R=y.ec;if(R){for(let _=0;_<R.length;_++)if(R[_](e,M,C)===!1)return}y=y.parent}const u=t.appContext.config.errorHandler;if(u){qt(u,null,10,[e,M,C]);return}}If(e,r,i,n)}function If(e,t,r,n=!0){console.error(e)}let dn=!1,ss=!1;const ze=[];let Ot=0;const Dr=[];let Ut=null,ar=0;const To=Promise.resolve();let Ws=null;function _o(e){const t=Ws||To;return e?t.then(this?e.bind(this):e):t}function xf(e){let t=Ot+1,r=ze.length;for(;t<r;){const n=t+r>>>1;hn(ze[n])<e?t=n+1:r=n}return t}function Gs(e){(!ze.length||!ze.includes(e,dn&&e.allowRecurse?Ot+1:Ot))&&(e.id==null?ze.push(e):ze.splice(xf(e.id),0,e),Ao())}function Ao(){!dn&&!ss&&(ss=!0,Ws=To.then(bo))}function Cf(e){const t=ze.indexOf(e);t>Ot&&ze.splice(t,1)}function Lf(e){Se(e)?Dr.push(...e):(!Ut||!Ut.includes(e,e.allowRecurse?ar+1:ar))&&Dr.push(e),Ao()}function Ra(e,t=dn?Ot+1:0){for(;t<ze.length;t++){const r=ze[t];r&&r.pre&&(ze.splice(t,1),t--,r())}}function yo(e){if(Dr.length){const t=[...new Set(Dr)];if(Dr.length=0,Ut){Ut.push(...t);return}for(Ut=t,Ut.sort((r,n)=>hn(r)-hn(n)),ar=0;ar<Ut.length;ar++)Ut[ar]();Ut=null,ar=0}}const hn=e=>e.id==null?1/0:e.id,Df=(e,t)=>{const r=hn(e)-hn(t);if(r===0){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return r};function bo(e){ss=!1,dn=!0,ze.sort(Df);const t=St;try{for(Ot=0;Ot<ze.length;Ot++){const r=ze[Ot];r&&r.active!==!1&&qt(r,null,14)}}finally{Ot=0,ze.length=0,yo(),dn=!1,Ws=null,(ze.length||Dr.length)&&bo()}}function Rf(e,t,...r){if(e.isUnmounted)return;const n=e.vnode.props||Be;let i=r;const y=t.startsWith("update:"),M=y&&t.slice(7);if(M&&M in n){const _=`${M==="modelValue"?"model":M}Modifiers`,{number:U,trim:D}=n[_]||Be;D&&(i=r.map(K=>Ve(K)?K.trim():K)),U&&(i=r.map(Zu))}let C,u=n[C=Mi(t)]||n[C=Mi(Ft(t))];!u&&y&&(u=n[C=Mi(wr(t))]),u&&It(u,e,6,i);const R=n[C+"Once"];if(R){if(!e.emitted)e.emitted={};else if(e.emitted[C])return;e.emitted[C]=!0,It(R,e,6,i)}}function So(e,t,r=!1){const n=t.emitsCache,i=n.get(e);if(i!==void 0)return i;const y=e.emits;let M={},C=!1;if(!xe(e)){const u=R=>{const _=So(R,t,!0);_&&(C=!0,et(M,_))};!r&&t.mixins.length&&t.mixins.forEach(u),e.extends&&u(e.extends),e.mixins&&e.mixins.forEach(u)}return!y&&!C?(Ue(e)&&n.set(e,null),null):(Se(y)?y.forEach(u=>M[u]=null):et(M,y),Ue(e)&&n.set(e,M),M)}function hi(e,t){return!e||!ui(t)?!1:(t=t.slice(2).replace(/Once$/,""),De(e,t[0].toLowerCase()+t.slice(1))||De(e,wr(t))||De(e,t))}let yt=null,Io=null;function Qn(e){const t=yt;return yt=e,Io=e&&e.type.__scopeId||null,t}function Of(e,t=yt,r){if(!t||e._n)return e;const n=(...i)=>{n._d&&wa(-1);const y=Qn(t);let M;try{M=e(...i)}finally{Qn(y),n._d&&wa(1)}return M};return n._n=!0,n._c=!0,n._d=!0,n}function ki(e){const{type:t,vnode:r,proxy:n,withProxy:i,props:y,propsOptions:[M],slots:C,attrs:u,emit:R,render:_,renderCache:U,data:D,setupState:K,ctx:k,inheritAttrs:F}=e;let B,O;const P=Qn(e);try{if(r.shapeFlag&4){const N=i||n;B=Rt(_.call(N,N,U,y,K,D,k)),O=u}else{const N=t;B=Rt(N.length>1?N(y,{attrs:u,slots:C,emit:R}):N(y,null)),O=t.props?u:Pf(u)}}catch(N){Zr.length=0,di(N,e,1),B=lt(hr)}let g=B;if(O&&F!==!1){const N=Object.keys(O),{shapeFlag:S}=g;N.length&&S&7&&(M&&N.some(Os)&&(O=Nf(O,M)),g=Nr(g,O))}return r.dirs&&(g=Nr(g),g.dirs=g.dirs?g.dirs.concat(r.dirs):r.dirs),r.transition&&(g.transition=r.transition),B=g,Qn(P),B}const Pf=e=>{let t;for(const r in e)(r==="class"||r==="style"||ui(r))&&((t||(t={}))[r]=e[r]);return t},Nf=(e,t)=>{const r={};for(const n in e)(!Os(n)||!(n.slice(9)in t))&&(r[n]=e[n]);return r};function Mf(e,t,r){const{props:n,children:i,component:y}=e,{props:M,children:C,patchFlag:u}=t,R=y.emitsOptions;if(t.dirs||t.transition)return!0;if(r&&u>=0){if(u&1024)return!0;if(u&16)return n?Oa(n,M,R):!!M;if(u&8){const _=t.dynamicProps;for(let U=0;U<_.length;U++){const D=_[U];if(M[D]!==n[D]&&!hi(R,D))return!0}}}else return(i||C)&&(!C||!C.$stable)?!0:n===M?!1:n?M?Oa(n,M,R):!0:!!M;return!1}function Oa(e,t,r){const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!0;for(let i=0;i<n.length;i++){const y=n[i];if(t[y]!==e[y]&&!hi(r,y))return!0}return!1}function Ff({vnode:e,parent:t},r){for(;t&&t.subTree===e;)(e=t.vnode).el=r,t=t.parent}const kf=e=>e.__isSuspense;function Bf(e,t){t&&t.pendingBranch?Se(e)?t.effects.push(...e):t.effects.push(e):Lf(e)}function Hn(e,t){if(Qe){let r=Qe.provides;const n=Qe.parent&&Qe.parent.provides;n===r&&(r=Qe.provides=Object.create(n)),r[e]=t}}function Ht(e,t,r=!1){const n=Qe||yt;if(n){const i=n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides;if(i&&e in i)return i[e];if(arguments.length>1)return r&&xe(t)?t.call(n.proxy):t}}const Nn={};function Kn(e,t,r){return xo(e,t,r)}function xo(e,t,{immediate:r,deep:n,flush:i,onTrack:y,onTrigger:M}=Be){const C=Qe;let u,R=!1,_=!1;if(qe(e)?(u=()=>e.value,R=Xn(e)):Cr(e)?(u=()=>e,n=!0):Se(e)?(_=!0,R=e.some(g=>Cr(g)||Xn(g)),u=()=>e.map(g=>{if(qe(g))return g.value;if(Cr(g))return br(g);if(xe(g))return qt(g,C,2)})):xe(e)?t?u=()=>qt(e,C,2):u=()=>{if(!(C&&C.isUnmounted))return U&&U(),It(e,C,3,[D])}:u=St,t&&n){const g=u;u=()=>br(g())}let U,D=g=>{U=O.onStop=()=>{qt(g,C,4)}},K;if(En)if(D=St,t?r&&It(t,C,3,[u(),_?[]:void 0,D]):u(),i==="sync"){const g=Nd();K=g.__watcherHandles||(g.__watcherHandles=[])}else return St;let k=_?new Array(e.length).fill(Nn):Nn;const F=()=>{if(O.active)if(t){const g=O.run();(n||R||(_?g.some((N,S)=>cn(N,k[S])):cn(g,k)))&&(U&&U(),It(t,C,3,[g,k===Nn?void 0:_&&k[0]===Nn?[]:k,D]),k=g)}else O.run()};F.allowRecurse=!!t;let B;i==="sync"?B=F:i==="post"?B=()=>it(F,C&&C.suspense):(F.pre=!0,C&&(F.id=C.uid),B=()=>Gs(F));const O=new ks(u,B);t?r?F():k=O.run():i==="post"?it(O.run.bind(O),C&&C.suspense):O.run();const P=()=>{O.stop(),C&&C.scope&&Ps(C.scope.effects,O)};return K&&K.push(P),P}function Uf(e,t,r){const n=this.proxy,i=Ve(e)?e.includes(".")?Co(n,e):()=>n[e]:e.bind(n,n);let y;xe(t)?y=t:(y=t.handler,r=t);const M=Qe;Mr(this);const C=xo(i,y.bind(n),r);return M?Mr(M):dr(),C}function Co(e,t){const r=t.split(".");return()=>{let n=e;for(let i=0;i<r.length&&n;i++)n=n[r[i]];return n}}function br(e,t){if(!Ue(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),qe(e))br(e.value,t);else if(Se(e))for(let r=0;r<e.length;r++)br(e[r],t);else if($u(e)||xr(e))e.forEach(r=>{br(r,t)});else if(Ju(e))for(const r in e)br(e[r],t);return e}function Lo(e){return xe(e)?{setup:e,name:e.name}:e}const Wn=e=>!!e.type.__asyncLoader,Do=e=>e.type.__isKeepAlive;function wf(e,t){Ro(e,"a",t)}function Hf(e,t){Ro(e,"da",t)}function Ro(e,t,r=Qe){const n=e.__wdc||(e.__wdc=()=>{let i=r;for(;i;){if(i.isDeactivated)return;i=i.parent}return e()});if(gi(t,n,r),r){let i=r.parent;for(;i&&i.parent;)Do(i.parent.vnode)&&Kf(n,t,r,i),i=i.parent}}function Kf(e,t,r,n){const i=gi(t,e,n,!0);Oo(()=>{Ps(n[t],i)},r)}function gi(e,t,r=Qe,n=!1){if(r){const i=r[e]||(r[e]=[]),y=t.__weh||(t.__weh=(...M)=>{if(r.isUnmounted)return;Hr(),Mr(r);const C=It(t,r,e,M);return dr(),Kr(),C});return n?i.unshift(y):i.push(y),y}}const Gt=e=>(t,r=Qe)=>(!En||e==="sp")&&gi(e,(...n)=>t(...n),r),Wf=Gt("bm"),Gf=Gt("m"),Yf=Gt("bu"),Vf=Gt("u"),jf=Gt("bum"),Oo=Gt("um"),Xf=Gt("sp"),Qf=Gt("rtg"),$f=Gt("rtc");function zf(e,t=Qe){gi("ec",e,t)}function rr(e,t,r,n){const i=e.dirs,y=t&&t.dirs;for(let M=0;M<i.length;M++){const C=i[M];y&&(C.oldValue=y[M].value);let u=C.dir[n];u&&(Hr(),It(u,r,8,[e.el,C,e,t]),Kr())}}const Po="components";function sT(e,t){return Jf(Po,e,!0,t)||e}const qf=Symbol();function Jf(e,t,r=!0,n=!1){const i=yt||Qe;if(i){const y=i.type;if(e===Po){const C=Rd(y,!1);if(C&&(C===t||C===Ft(t)||C===ci(Ft(t))))return y}const M=Pa(i[e]||y[e],t)||Pa(i.appContext[e],t);return!M&&n?y:M}}function Pa(e,t){return e&&(e[t]||e[Ft(t)]||e[ci(Ft(t))])}function aT(e,t,r,n){let i;const y=r&&r[n];if(Se(e)||Ve(e)){i=new Array(e.length);for(let M=0,C=e.length;M<C;M++)i[M]=t(e[M],M,void 0,y&&y[M])}else if(typeof e=="number"){i=new Array(e);for(let M=0;M<e;M++)i[M]=t(M+1,M,void 0,y&&y[M])}else if(Ue(e))if(e[Symbol.iterator])i=Array.from(e,(M,C)=>t(M,C,void 0,y&&y[C]));else{const M=Object.keys(e);i=new Array(M.length);for(let C=0,u=M.length;C<u;C++){const R=M[C];i[C]=t(e[R],R,C,y&&y[C])}}else i=[];return r&&(r[n]=i),i}const as=e=>e?Yo(e)?Xs(e)||e.proxy:as(e.parent):null,Jr=et(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>as(e.parent),$root:e=>as(e.root),$emit:e=>e.emit,$options:e=>Ys(e),$forceUpdate:e=>e.f||(e.f=()=>Gs(e.update)),$nextTick:e=>e.n||(e.n=_o.bind(e.proxy)),$watch:e=>Uf.bind(e)}),Bi=(e,t)=>e!==Be&&!e.__isScriptSetup&&De(e,t),Zf={get({_:e},t){const{ctx:r,setupState:n,data:i,props:y,accessCache:M,type:C,appContext:u}=e;let R;if(t[0]!=="$"){const K=M[t];if(K!==void 0)switch(K){case 1:return n[t];case 2:return i[t];case 4:return r[t];case 3:return y[t]}else{if(Bi(n,t))return M[t]=1,n[t];if(i!==Be&&De(i,t))return M[t]=2,i[t];if((R=e.propsOptions[0])&&De(R,t))return M[t]=3,y[t];if(r!==Be&&De(r,t))return M[t]=4,r[t];us&&(M[t]=0)}}const _=Jr[t];let U,D;if(_)return t==="$attrs"&&ct(e,"get",t),_(e);if((U=C.__cssModules)&&(U=U[t]))return U;if(r!==Be&&De(r,t))return M[t]=4,r[t];if(D=u.config.globalProperties,De(D,t))return D[t]},set({_:e},t,r){const{data:n,setupState:i,ctx:y}=e;return Bi(i,t)?(i[t]=r,!0):n!==Be&&De(n,t)?(n[t]=r,!0):De(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(y[t]=r,!0)},has({_:{data:e,setupState:t,accessCache:r,ctx:n,appContext:i,propsOptions:y}},M){let C;return!!r[M]||e!==Be&&De(e,M)||Bi(t,M)||(C=y[0])&&De(C,M)||De(n,M)||De(Jr,M)||De(i.config.globalProperties,M)},defineProperty(e,t,r){return r.get!=null?e._.accessCache[t]=0:De(r,"value")&&this.set(e,t,r.value,null),Reflect.defineProperty(e,t,r)}};let us=!0;function ed(e){const t=Ys(e),r=e.proxy,n=e.ctx;us=!1,t.beforeCreate&&Na(t.beforeCreate,e,"bc");const{data:i,computed:y,methods:M,watch:C,provide:u,inject:R,created:_,beforeMount:U,mounted:D,beforeUpdate:K,updated:k,activated:F,deactivated:B,beforeDestroy:O,beforeUnmount:P,destroyed:g,unmounted:N,render:S,renderTracked:f,renderTriggered:m,errorCaptured:d,serverPrefetch:l,expose:b,inheritAttrs:h,components:o,directives:E,filters:A}=t;if(R&&td(R,n,null,e.appContext.config.unwrapInjectedRef),M)for(const s in M){const p=M[s];xe(p)&&(n[s]=p.bind(r))}if(i){const s=i.call(r,r);Ue(s)&&(e.data=An(s))}if(us=!0,y)for(const s in y){const p=y[s],a=xe(p)?p.bind(r,r):xe(p.get)?p.get.bind(r,r):St,T=!xe(p)&&xe(p.set)?p.set.bind(r):St,L=mt({get:a,set:T});Object.defineProperty(n,s,{enumerable:!0,configurable:!0,get:()=>L.value,set:I=>L.value=I})}if(C)for(const s in C)No(C[s],n,r,s);if(u){const s=xe(u)?u.call(r):u;Reflect.ownKeys(s).forEach(p=>{Hn(p,s[p])})}_&&Na(_,e,"c");function c(s,p){Se(p)?p.forEach(a=>s(a.bind(r))):p&&s(p.bind(r))}if(c(Wf,U),c(Gf,D),c(Yf,K),c(Vf,k),c(wf,F),c(Hf,B),c(zf,d),c($f,f),c(Qf,m),c(jf,P),c(Oo,N),c(Xf,l),Se(b))if(b.length){const s=e.exposed||(e.exposed={});b.forEach(p=>{Object.defineProperty(s,p,{get:()=>r[p],set:a=>r[p]=a})})}else e.exposed||(e.exposed={});S&&e.render===St&&(e.render=S),h!=null&&(e.inheritAttrs=h),o&&(e.components=o),E&&(e.directives=E)}function td(e,t,r=St,n=!1){Se(e)&&(e=os(e));for(const i in e){const y=e[i];let M;Ue(y)?"default"in y?M=Ht(y.from||i,y.default,!0):M=Ht(y.from||i):M=Ht(y),qe(M)&&n?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>M.value,set:C=>M.value=C}):t[i]=M}}function Na(e,t,r){It(Se(e)?e.map(n=>n.bind(t.proxy)):e.bind(t.proxy),t,r)}function No(e,t,r,n){const i=n.includes(".")?Co(r,n):()=>r[n];if(Ve(e)){const y=t[e];xe(y)&&Kn(i,y)}else if(xe(e))Kn(i,e.bind(r));else if(Ue(e))if(Se(e))e.forEach(y=>No(y,t,r,n));else{const y=xe(e.handler)?e.handler.bind(r):t[e.handler];xe(y)&&Kn(i,y,e)}}function Ys(e){const t=e.type,{mixins:r,extends:n}=t,{mixins:i,optionsCache:y,config:{optionMergeStrategies:M}}=e.appContext,C=y.get(t);let u;return C?u=C:!i.length&&!r&&!n?u=t:(u={},i.length&&i.forEach(R=>$n(u,R,M,!0)),$n(u,t,M)),Ue(t)&&y.set(t,u),u}function $n(e,t,r,n=!1){const{mixins:i,extends:y}=t;y&&$n(e,y,r,!0),i&&i.forEach(M=>$n(e,M,r,!0));for(const M in t)if(!(n&&M==="expose")){const C=rd[M]||r&&r[M];e[M]=C?C(e[M],t[M]):t[M]}return e}const rd={data:Ma,props:sr,emits:sr,methods:sr,computed:sr,beforeCreate:Ze,created:Ze,beforeMount:Ze,mounted:Ze,beforeUpdate:Ze,updated:Ze,beforeDestroy:Ze,beforeUnmount:Ze,destroyed:Ze,unmounted:Ze,activated:Ze,deactivated:Ze,errorCaptured:Ze,serverPrefetch:Ze,components:sr,directives:sr,watch:id,provide:Ma,inject:nd};function Ma(e,t){return t?e?function(){return et(xe(e)?e.call(this,this):e,xe(t)?t.call(this,this):t)}:t:e}function nd(e,t){return sr(os(e),os(t))}function os(e){if(Se(e)){const t={};for(let r=0;r<e.length;r++)t[e[r]]=e[r];return t}return e}function Ze(e,t){return e?[...new Set([].concat(e,t))]:t}function sr(e,t){return e?et(et(Object.create(null),e),t):t}function id(e,t){if(!e)return t;if(!t)return e;const r=et(Object.create(null),e);for(const n in t)r[n]=Ze(e[n],t[n]);return r}function sd(e,t,r,n=!1){const i={},y={};jn(y,mi,1),e.propsDefaults=Object.create(null),Mo(e,t,i,y);for(const M in e.propsOptions[0])M in i||(i[M]=void 0);r?e.props=n?i:pf(i):e.type.props?e.props=i:e.props=y,e.attrs=y}function ad(e,t,r,n){const{props:i,attrs:y,vnode:{patchFlag:M}}=e,C=Oe(i),[u]=e.propsOptions;let R=!1;if((n||M>0)&&!(M&16)){if(M&8){const _=e.vnode.dynamicProps;for(let U=0;U<_.length;U++){let D=_[U];if(hi(e.emitsOptions,D))continue;const K=t[D];if(u)if(De(y,D))K!==y[D]&&(y[D]=K,R=!0);else{const k=Ft(D);i[k]=ls(u,C,k,K,e,!1)}else K!==y[D]&&(y[D]=K,R=!0)}}}else{Mo(e,t,i,y)&&(R=!0);let _;for(const U in C)(!t||!De(t,U)&&((_=wr(U))===U||!De(t,_)))&&(u?r&&(r[U]!==void 0||r[_]!==void 0)&&(i[U]=ls(u,C,U,void 0,e,!0)):delete i[U]);if(y!==C)for(const U in y)(!t||!De(t,U))&&(delete y[U],R=!0)}R&&Wt(e,"set","$attrs")}function Mo(e,t,r,n){const[i,y]=e.propsOptions;let M=!1,C;if(t)for(let u in t){if(wn(u))continue;const R=t[u];let _;i&&De(i,_=Ft(u))?!y||!y.includes(_)?r[_]=R:(C||(C={}))[_]=R:hi(e.emitsOptions,u)||(!(u in n)||R!==n[u])&&(n[u]=R,M=!0)}if(y){const u=Oe(r),R=C||Be;for(let _=0;_<y.length;_++){const U=y[_];r[U]=ls(i,u,U,R[U],e,!De(R,U))}}return M}function ls(e,t,r,n,i,y){const M=e[r];if(M!=null){const C=De(M,"default");if(C&&n===void 0){const u=M.default;if(M.type!==Function&&xe(u)){const{propsDefaults:R}=i;r in R?n=R[r]:(Mr(i),n=R[r]=u.call(null,t),dr())}else n=u}M[0]&&(y&&!C?n=!1:M[1]&&(n===""||n===wr(r))&&(n=!0))}return n}function Fo(e,t,r=!1){const n=t.propsCache,i=n.get(e);if(i)return i;const y=e.props,M={},C=[];let u=!1;if(!xe(e)){const _=U=>{u=!0;const[D,K]=Fo(U,t,!0);et(M,D),K&&C.push(...K)};!r&&t.mixins.length&&t.mixins.forEach(_),e.extends&&_(e.extends),e.mixins&&e.mixins.forEach(_)}if(!y&&!u)return Ue(e)&&n.set(e,Ir),Ir;if(Se(y))for(let _=0;_<y.length;_++){const U=Ft(y[_]);Fa(U)&&(M[U]=Be)}else if(y)for(const _ in y){const U=Ft(_);if(Fa(U)){const D=y[_],K=M[U]=Se(D)||xe(D)?{type:D}:Object.assign({},D);if(K){const k=Ua(Boolean,K.type),F=Ua(String,K.type);K[0]=k>-1,K[1]=F<0||k<F,(k>-1||De(K,"default"))&&C.push(U)}}}const R=[M,C];return Ue(e)&&n.set(e,R),R}function Fa(e){return e[0]!=="$"}function ka(e){const t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:e===null?"null":""}function Ba(e,t){return ka(e)===ka(t)}function Ua(e,t){return Se(t)?t.findIndex(r=>Ba(r,e)):xe(t)&&Ba(t,e)?0:-1}const ko=e=>e[0]==="_"||e==="$stable",Vs=e=>Se(e)?e.map(Rt):[Rt(e)],ud=(e,t,r)=>{if(t._n)return t;const n=Of((...i)=>Vs(t(...i)),r);return n._c=!1,n},Bo=(e,t,r)=>{const n=e._ctx;for(const i in e){if(ko(i))continue;const y=e[i];if(xe(y))t[i]=ud(i,y,n);else if(y!=null){const M=Vs(y);t[i]=()=>M}}},Uo=(e,t)=>{const r=Vs(t);e.slots.default=()=>r},od=(e,t)=>{if(e.vnode.shapeFlag&32){const r=t._;r?(e.slots=Oe(t),jn(t,"_",r)):Bo(t,e.slots={})}else e.slots={},t&&Uo(e,t);jn(e.slots,mi,1)},ld=(e,t,r)=>{const{vnode:n,slots:i}=e;let y=!0,M=Be;if(n.shapeFlag&32){const C=t._;C?r&&C===1?y=!1:(et(i,t),!r&&C===1&&delete i._):(y=!t.$stable,Bo(t,i)),M=t}else t&&(Uo(e,t),M={default:1});if(y)for(const C in i)!ko(C)&&!(C in M)&&delete i[C]};function wo(){return{app:null,config:{isNativeTag:Bc,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let cd=0;function fd(e,t){return function(n,i=null){xe(n)||(n=Object.assign({},n)),i!=null&&!Ue(i)&&(i=null);const y=wo(),M=new Set;let C=!1;const u=y.app={_uid:cd++,_component:n,_props:i,_container:null,_context:y,_instance:null,version:Md,get config(){return y.config},set config(R){},use(R,..._){return M.has(R)||(R&&xe(R.install)?(M.add(R),R.install(u,..._)):xe(R)&&(M.add(R),R(u,..._))),u},mixin(R){return y.mixins.includes(R)||y.mixins.push(R),u},component(R,_){return _?(y.components[R]=_,u):y.components[R]},directive(R,_){return _?(y.directives[R]=_,u):y.directives[R]},mount(R,_,U){if(!C){const D=lt(n,i);return D.appContext=y,_&&t?t(D,R):e(D,R,U),C=!0,u._container=R,R.__vue_app__=u,Xs(D.component)||D.component.proxy}},unmount(){C&&(e(null,u._container),delete u._container.__vue_app__)},provide(R,_){return y.provides[R]=_,u}};return u}}function cs(e,t,r,n,i=!1){if(Se(e)){e.forEach((D,K)=>cs(D,t&&(Se(t)?t[K]:t),r,n,i));return}if(Wn(n)&&!i)return;const y=n.shapeFlag&4?Xs(n.component)||n.component.proxy:n.el,M=i?null:y,{i:C,r:u}=e,R=t&&t.r,_=C.refs===Be?C.refs={}:C.refs,U=C.setupState;if(R!=null&&R!==u&&(Ve(R)?(_[R]=null,De(U,R)&&(U[R]=null)):qe(R)&&(R.value=null)),xe(u))qt(u,C,12,[M,_]);else{const D=Ve(u),K=qe(u);if(D||K){const k=()=>{if(e.f){const F=D?De(U,u)?U[u]:_[u]:u.value;i?Se(F)&&Ps(F,y):Se(F)?F.includes(y)||F.push(y):D?(_[u]=[y],De(U,u)&&(U[u]=_[u])):(u.value=[y],e.k&&(_[e.k]=u.value))}else D?(_[u]=M,De(U,u)&&(U[u]=M)):K&&(u.value=M,e.k&&(_[e.k]=M))};M?(k.id=-1,it(k,r)):k()}}}const it=Bf;function dd(e){return hd(e)}function hd(e,t){const r=Gc();r.__VUE__=!0;const{insert:n,remove:i,patchProp:y,createElement:M,createText:C,createComment:u,setText:R,setElementText:_,parentNode:U,nextSibling:D,setScopeId:K=St,insertStaticContent:k}=e,F=(V,Q,ee,Z=null,re=null,ae=null,le=!1,ne=null,ie=!!Q.dynamicChildren)=>{if(V===Q)return;V&&!Vr(V,Q)&&(Z=Y(V),I(V,re,ae,!0),V=null),Q.patchFlag===-2&&(ie=!1,Q.dynamicChildren=null);const{type:ue,ref:ge,shapeFlag:he}=Q;switch(ue){case Ei:B(V,Q,ee,Z);break;case hr:O(V,Q,ee,Z);break;case Ui:V==null&&P(Q,ee,Z,le);break;case wt:o(V,Q,ee,Z,re,ae,le,ne,ie);break;default:he&1?S(V,Q,ee,Z,re,ae,le,ne,ie):he&6?E(V,Q,ee,Z,re,ae,le,ne,ie):(he&64||he&128)&&ue.process(V,Q,ee,Z,re,ae,le,ne,ie,X)}ge!=null&&re&&cs(ge,V&&V.ref,ae,Q||V,!Q)},B=(V,Q,ee,Z)=>{if(V==null)n(Q.el=C(Q.children),ee,Z);else{const re=Q.el=V.el;Q.children!==V.children&&R(re,Q.children)}},O=(V,Q,ee,Z)=>{V==null?n(Q.el=u(Q.children||""),ee,Z):Q.el=V.el},P=(V,Q,ee,Z)=>{[V.el,V.anchor]=k(V.children,Q,ee,Z,V.el,V.anchor)},g=({el:V,anchor:Q},ee,Z)=>{let re;for(;V&&V!==Q;)re=D(V),n(V,ee,Z),V=re;n(Q,ee,Z)},N=({el:V,anchor:Q})=>{let ee;for(;V&&V!==Q;)ee=D(V),i(V),V=ee;i(Q)},S=(V,Q,ee,Z,re,ae,le,ne,ie)=>{le=le||Q.type==="svg",V==null?f(Q,ee,Z,re,ae,le,ne,ie):l(V,Q,re,ae,le,ne,ie)},f=(V,Q,ee,Z,re,ae,le,ne)=>{let ie,ue;const{type:ge,props:he,shapeFlag:Ee,transition:me,dirs:pe}=V;if(ie=V.el=M(V.type,ae,he&&he.is,he),Ee&8?_(ie,V.children):Ee&16&&d(V.children,ie,null,Z,re,ae&&ge!=="foreignObject",le,ne),pe&&rr(V,null,Z,"created"),he){for(const _e in he)_e!=="value"&&!wn(_e)&&y(ie,_e,null,he[_e],ae,V.children,Z,re,G);"value"in he&&y(ie,"value",null,he.value),(ue=he.onVnodeBeforeMount)&&Lt(ue,Z,V)}m(ie,V,V.scopeId,le,Z),pe&&rr(V,null,Z,"beforeMount");const Te=(!re||re&&!re.pendingBranch)&&me&&!me.persisted;Te&&me.beforeEnter(ie),n(ie,Q,ee),((ue=he&&he.onVnodeMounted)||Te||pe)&&it(()=>{ue&&Lt(ue,Z,V),Te&&me.enter(ie),pe&&rr(V,null,Z,"mounted")},re)},m=(V,Q,ee,Z,re)=>{if(ee&&K(V,ee),Z)for(let ae=0;ae<Z.length;ae++)K(V,Z[ae]);if(re){let ae=re.subTree;if(Q===ae){const le=re.vnode;m(V,le,le.scopeId,le.slotScopeIds,re.parent)}}},d=(V,Q,ee,Z,re,ae,le,ne,ie=0)=>{for(let ue=ie;ue<V.length;ue++){const ge=V[ue]=ne?Qt(V[ue]):Rt(V[ue]);F(null,ge,Q,ee,Z,re,ae,le,ne)}},l=(V,Q,ee,Z,re,ae,le)=>{const ne=Q.el=V.el;let{patchFlag:ie,dynamicChildren:ue,dirs:ge}=Q;ie|=V.patchFlag&16;const he=V.props||Be,Ee=Q.props||Be;let me;ee&&nr(ee,!1),(me=Ee.onVnodeBeforeUpdate)&&Lt(me,ee,Q,V),ge&&rr(Q,V,ee,"beforeUpdate"),ee&&nr(ee,!0);const pe=re&&Q.type!=="foreignObject";if(ue?b(V.dynamicChildren,ue,ne,ee,Z,pe,ae):le||p(V,Q,ne,null,ee,Z,pe,ae,!1),ie>0){if(ie&16)h(ne,Q,he,Ee,ee,Z,re);else if(ie&2&&he.class!==Ee.class&&y(ne,"class",null,Ee.class,re),ie&4&&y(ne,"style",he.style,Ee.style,re),ie&8){const Te=Q.dynamicProps;for(let _e=0;_e<Te.length;_e++){const ye=Te[_e],Le=he[ye],Fe=Ee[ye];(Fe!==Le||ye==="value")&&y(ne,ye,Le,Fe,re,V.children,ee,Z,G)}}ie&1&&V.children!==Q.children&&_(ne,Q.children)}else!le&&ue==null&&h(ne,Q,he,Ee,ee,Z,re);((me=Ee.onVnodeUpdated)||ge)&&it(()=>{me&&Lt(me,ee,Q,V),ge&&rr(Q,V,ee,"updated")},Z)},b=(V,Q,ee,Z,re,ae,le)=>{for(let ne=0;ne<Q.length;ne++){const ie=V[ne],ue=Q[ne],ge=ie.el&&(ie.type===wt||!Vr(ie,ue)||ie.shapeFlag&70)?U(ie.el):ee;F(ie,ue,ge,null,Z,re,ae,le,!0)}},h=(V,Q,ee,Z,re,ae,le)=>{if(ee!==Z){if(ee!==Be)for(const ne in ee)!wn(ne)&&!(ne in Z)&&y(V,ne,ee[ne],null,le,Q.children,re,ae,G);for(const ne in Z){if(wn(ne))continue;const ie=Z[ne],ue=ee[ne];ie!==ue&&ne!=="value"&&y(V,ne,ue,ie,le,Q.children,re,ae,G)}"value"in Z&&y(V,"value",ee.value,Z.value)}},o=(V,Q,ee,Z,re,ae,le,ne,ie)=>{const ue=Q.el=V?V.el:C(""),ge=Q.anchor=V?V.anchor:C("");let{patchFlag:he,dynamicChildren:Ee,slotScopeIds:me}=Q;me&&(ne=ne?ne.concat(me):me),V==null?(n(ue,ee,Z),n(ge,ee,Z),d(Q.children,ee,ge,re,ae,le,ne,ie)):he>0&&he&64&&Ee&&V.dynamicChildren?(b(V.dynamicChildren,Ee,ee,re,ae,le,ne),(Q.key!=null||re&&Q===re.subTree)&&Ho(V,Q,!0)):p(V,Q,ee,ge,re,ae,le,ne,ie)},E=(V,Q,ee,Z,re,ae,le,ne,ie)=>{Q.slotScopeIds=ne,V==null?Q.shapeFlag&512?re.ctx.activate(Q,ee,Z,le,ie):A(Q,ee,Z,re,ae,le,ie):v(V,Q,ie)},A=(V,Q,ee,Z,re,ae,le)=>{const ne=V.component=Id(V,Z,re);if(Do(V)&&(ne.ctx.renderer=X),xd(ne),ne.asyncDep){if(re&&re.registerDep(ne,c),!V.el){const ie=ne.subTree=lt(hr);O(null,ie,Q,ee)}return}c(ne,V,Q,ee,re,ae,le)},v=(V,Q,ee)=>{const Z=Q.component=V.component;if(Mf(V,Q,ee))if(Z.asyncDep&&!Z.asyncResolved){s(Z,Q,ee);return}else Z.next=Q,Cf(Z.update),Z.update();else Q.el=V.el,Z.vnode=Q},c=(V,Q,ee,Z,re,ae,le)=>{const ne=()=>{if(V.isMounted){let{next:ge,bu:he,u:Ee,parent:me,vnode:pe}=V,Te=ge,_e;nr(V,!1),ge?(ge.el=pe.el,s(V,ge,le)):ge=pe,he&&Fi(he),(_e=ge.props&&ge.props.onVnodeBeforeUpdate)&&Lt(_e,me,ge,pe),nr(V,!0);const ye=ki(V),Le=V.subTree;V.subTree=ye,F(Le,ye,U(Le.el),Y(Le),V,re,ae),ge.el=ye.el,Te===null&&Ff(V,ye.el),Ee&&it(Ee,re),(_e=ge.props&&ge.props.onVnodeUpdated)&&it(()=>Lt(_e,me,ge,pe),re)}else{let ge;const{el:he,props:Ee}=Q,{bm:me,m:pe,parent:Te}=V,_e=Wn(Q);if(nr(V,!1),me&&Fi(me),!_e&&(ge=Ee&&Ee.onVnodeBeforeMount)&&Lt(ge,Te,Q),nr(V,!0),he&&J){const ye=()=>{V.subTree=ki(V),J(he,V.subTree,V,re,null)};_e?Q.type.__asyncLoader().then(()=>!V.isUnmounted&&ye()):ye()}else{const ye=V.subTree=ki(V);F(null,ye,ee,Z,V,re,ae),Q.el=ye.el}if(pe&&it(pe,re),!_e&&(ge=Ee&&Ee.onVnodeMounted)){const ye=Q;it(()=>Lt(ge,Te,ye),re)}(Q.shapeFlag&256||Te&&Wn(Te.vnode)&&Te.vnode.shapeFlag&256)&&V.a&&it(V.a,re),V.isMounted=!0,Q=ee=Z=null}},ie=V.effect=new ks(ne,()=>Gs(ue),V.scope),ue=V.update=()=>ie.run();ue.id=V.uid,nr(V,!0),ue()},s=(V,Q,ee)=>{Q.component=V;const Z=V.vnode.props;V.vnode=Q,V.next=null,ad(V,Q.props,Z,ee),ld(V,Q.children,ee),Hr(),Ra(),Kr()},p=(V,Q,ee,Z,re,ae,le,ne,ie=!1)=>{const ue=V&&V.children,ge=V?V.shapeFlag:0,he=Q.children,{patchFlag:Ee,shapeFlag:me}=Q;if(Ee>0){if(Ee&128){T(ue,he,ee,Z,re,ae,le,ne,ie);return}else if(Ee&256){a(ue,he,ee,Z,re,ae,le,ne,ie);return}}me&8?(ge&16&&G(ue,re,ae),he!==ue&&_(ee,he)):ge&16?me&16?T(ue,he,ee,Z,re,ae,le,ne,ie):G(ue,re,ae,!0):(ge&8&&_(ee,""),me&16&&d(he,ee,Z,re,ae,le,ne,ie))},a=(V,Q,ee,Z,re,ae,le,ne,ie)=>{V=V||Ir,Q=Q||Ir;const ue=V.length,ge=Q.length,he=Math.min(ue,ge);let Ee;for(Ee=0;Ee<he;Ee++){const me=Q[Ee]=ie?Qt(Q[Ee]):Rt(Q[Ee]);F(V[Ee],me,ee,null,re,ae,le,ne,ie)}ue>ge?G(V,re,ae,!0,!1,he):d(Q,ee,Z,re,ae,le,ne,ie,he)},T=(V,Q,ee,Z,re,ae,le,ne,ie)=>{let ue=0;const ge=Q.length;let he=V.length-1,Ee=ge-1;for(;ue<=he&&ue<=Ee;){const me=V[ue],pe=Q[ue]=ie?Qt(Q[ue]):Rt(Q[ue]);if(Vr(me,pe))F(me,pe,ee,null,re,ae,le,ne,ie);else break;ue++}for(;ue<=he&&ue<=Ee;){const me=V[he],pe=Q[Ee]=ie?Qt(Q[Ee]):Rt(Q[Ee]);if(Vr(me,pe))F(me,pe,ee,null,re,ae,le,ne,ie);else break;he--,Ee--}if(ue>he){if(ue<=Ee){const me=Ee+1,pe=me<ge?Q[me].el:Z;for(;ue<=Ee;)F(null,Q[ue]=ie?Qt(Q[ue]):Rt(Q[ue]),ee,pe,re,ae,le,ne,ie),ue++}}else if(ue>Ee)for(;ue<=he;)I(V[ue],re,ae,!0),ue++;else{const me=ue,pe=ue,Te=new Map;for(ue=pe;ue<=Ee;ue++){const Pe=Q[ue]=ie?Qt(Q[ue]):Rt(Q[ue]);Pe.key!=null&&Te.set(Pe.key,ue)}let _e,ye=0;const Le=Ee-pe+1;let Fe=!1,we=0;const He=new Array(Le);for(ue=0;ue<Le;ue++)He[ue]=0;for(ue=me;ue<=he;ue++){const Pe=V[ue];if(ye>=Le){I(Pe,re,ae,!0);continue}let We;if(Pe.key!=null)We=Te.get(Pe.key);else for(_e=pe;_e<=Ee;_e++)if(He[_e-pe]===0&&Vr(Pe,Q[_e])){We=_e;break}We===void 0?I(Pe,re,ae,!0):(He[We-pe]=ue+1,We>=we?we=We:Fe=!0,F(Pe,Q[We],ee,null,re,ae,le,ne,ie),ye++)}const ot=Fe?gd(He):Ir;for(_e=ot.length-1,ue=Le-1;ue>=0;ue--){const Pe=pe+ue,We=Q[Pe],tt=Pe+1<ge?Q[Pe+1].el:Z;He[ue]===0?F(null,We,ee,tt,re,ae,le,ne,ie):Fe&&(_e<0||ue!==ot[_e]?L(We,ee,tt,2):_e--)}}},L=(V,Q,ee,Z,re=null)=>{const{el:ae,type:le,transition:ne,children:ie,shapeFlag:ue}=V;if(ue&6){L(V.component.subTree,Q,ee,Z);return}if(ue&128){V.suspense.move(Q,ee,Z);return}if(ue&64){le.move(V,Q,ee,X);return}if(le===wt){n(ae,Q,ee);for(let he=0;he<ie.length;he++)L(ie[he],Q,ee,Z);n(V.anchor,Q,ee);return}if(le===Ui){g(V,Q,ee);return}if(Z!==2&&ue&1&&ne)if(Z===0)ne.beforeEnter(ae),n(ae,Q,ee),it(()=>ne.enter(ae),re);else{const{leave:he,delayLeave:Ee,afterLeave:me}=ne,pe=()=>n(ae,Q,ee),Te=()=>{he(ae,()=>{pe(),me&&me()})};Ee?Ee(ae,pe,Te):Te()}else n(ae,Q,ee)},I=(V,Q,ee,Z=!1,re=!1)=>{const{type:ae,props:le,ref:ne,children:ie,dynamicChildren:ue,shapeFlag:ge,patchFlag:he,dirs:Ee}=V;if(ne!=null&&cs(ne,null,ee,V,!0),ge&256){Q.ctx.deactivate(V);return}const me=ge&1&&Ee,pe=!Wn(V);let Te;if(pe&&(Te=le&&le.onVnodeBeforeUnmount)&&Lt(Te,Q,V),ge&6)w(V.component,ee,Z);else{if(ge&128){V.suspense.unmount(ee,Z);return}me&&rr(V,null,Q,"beforeUnmount"),ge&64?V.type.remove(V,Q,ee,re,X,Z):ue&&(ae!==wt||he>0&&he&64)?G(ue,Q,ee,!1,!0):(ae===wt&&he&384||!re&&ge&16)&&G(ie,Q,ee),Z&&H(V)}(pe&&(Te=le&&le.onVnodeUnmounted)||me)&&it(()=>{Te&&Lt(Te,Q,V),me&&rr(V,null,Q,"unmounted")},ee)},H=V=>{const{type:Q,el:ee,anchor:Z,transition:re}=V;if(Q===wt){W(ee,Z);return}if(Q===Ui){N(V);return}const ae=()=>{i(ee),re&&!re.persisted&&re.afterLeave&&re.afterLeave()};if(V.shapeFlag&1&&re&&!re.persisted){const{leave:le,delayLeave:ne}=re,ie=()=>le(ee,ae);ne?ne(V.el,ae,ie):ie()}else ae()},W=(V,Q)=>{let ee;for(;V!==Q;)ee=D(V),i(V),V=ee;i(Q)},w=(V,Q,ee)=>{const{bum:Z,scope:re,update:ae,subTree:le,um:ne}=V;Z&&Fi(Z),re.stop(),ae&&(ae.active=!1,I(le,V,Q,ee)),ne&&it(ne,Q),it(()=>{V.isUnmounted=!0},Q),Q&&Q.pendingBranch&&!Q.isUnmounted&&V.asyncDep&&!V.asyncResolved&&V.suspenseId===Q.pendingId&&(Q.deps--,Q.deps===0&&Q.resolve())},G=(V,Q,ee,Z=!1,re=!1,ae=0)=>{for(let le=ae;le<V.length;le++)I(V[le],Q,ee,Z,re)},Y=V=>V.shapeFlag&6?Y(V.component.subTree):V.shapeFlag&128?V.suspense.next():D(V.anchor||V.el),j=(V,Q,ee)=>{V==null?Q._vnode&&I(Q._vnode,null,null,!0):F(Q._vnode||null,V,Q,null,null,null,ee),Ra(),yo(),Q._vnode=V},X={p:F,um:I,m:L,r:H,mt:A,mc:d,pc:p,pbc:b,n:Y,o:e};let q,J;return t&&([q,J]=t(X)),{render:j,hydrate:q,createApp:fd(j,q)}}function nr({effect:e,update:t},r){e.allowRecurse=t.allowRecurse=r}function Ho(e,t,r=!1){const n=e.children,i=t.children;if(Se(n)&&Se(i))for(let y=0;y<n.length;y++){const M=n[y];let C=i[y];C.shapeFlag&1&&!C.dynamicChildren&&((C.patchFlag<=0||C.patchFlag===32)&&(C=i[y]=Qt(i[y]),C.el=M.el),r||Ho(M,C)),C.type===Ei&&(C.el=M.el)}}function gd(e){const t=e.slice(),r=[0];let n,i,y,M,C;const u=e.length;for(n=0;n<u;n++){const R=e[n];if(R!==0){if(i=r[r.length-1],e[i]<R){t[n]=i,r.push(n);continue}for(y=0,M=r.length-1;y<M;)C=y+M>>1,e[r[C]]<R?y=C+1:M=C;R<e[r[y]]&&(y>0&&(t[n]=r[y-1]),r[y]=n)}}for(y=r.length,M=r[y-1];y-- >0;)r[y]=M,M=t[M];return r}const Ed=e=>e.__isTeleport,wt=Symbol(void 0),Ei=Symbol(void 0),hr=Symbol(void 0),Ui=Symbol(void 0),Zr=[];let bt=null;function md(e=!1){Zr.push(bt=e?null:[])}function vd(){Zr.pop(),bt=Zr[Zr.length-1]||null}let gn=1;function wa(e){gn+=e}function Ko(e){return e.dynamicChildren=gn>0?bt||Ir:null,vd(),gn>0&&bt&&bt.push(e),e}function uT(e,t,r,n,i,y){return Ko(Go(e,t,r,n,i,y,!0))}function pd(e,t,r,n,i){return Ko(lt(e,t,r,n,i,!0))}function fs(e){return e?e.__v_isVNode===!0:!1}function Vr(e,t){return e.type===t.type&&e.key===t.key}const mi="__vInternal",Wo=({key:e})=>e??null,Gn=({ref:e,ref_key:t,ref_for:r})=>e!=null?Ve(e)||qe(e)||xe(e)?{i:yt,r:e,k:t,f:!!r}:e:null;function Go(e,t=null,r=null,n=0,i=null,y=e===wt?0:1,M=!1,C=!1){const u={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Wo(t),ref:t&&Gn(t),scopeId:Io,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:y,patchFlag:n,dynamicProps:i,dynamicChildren:null,appContext:null,ctx:yt};return C?(js(u,r),y&128&&e.normalize(u)):r&&(u.shapeFlag|=Ve(r)?8:16),gn>0&&!M&&bt&&(u.patchFlag>0||y&6)&&u.patchFlag!==32&&bt.push(u),u}const lt=Td;function Td(e,t=null,r=null,n=0,i=null,y=!1){if((!e||e===qf)&&(e=hr),fs(e)){const C=Nr(e,t,!0);return r&&js(C,r),gn>0&&!y&&bt&&(C.shapeFlag&6?bt[bt.indexOf(e)]=C:bt.push(C)),C.patchFlag|=-2,C}if(Od(e)&&(e=e.__vccOpts),t){t=_d(t);let{class:C,style:u}=t;C&&!Ve(C)&&(t.class=Rs(C)),Ue(u)&&(fo(u)&&!Se(u)&&(u=et({},u)),t.style=Ds(u))}const M=Ve(e)?1:kf(e)?128:Ed(e)?64:Ue(e)?4:xe(e)?2:0;return Go(e,t,r,n,i,M,y,!0)}function _d(e){return e?fo(e)||mi in e?et({},e):e:null}function Nr(e,t,r=!1){const{props:n,ref:i,patchFlag:y,children:M}=e,C=t?yd(n||{},t):n;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:C,key:C&&Wo(C),ref:t&&t.ref?r&&i?Se(i)?i.concat(Gn(t)):[i,Gn(t)]:Gn(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:M,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==wt?y===-1?16:y|16:y,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Nr(e.ssContent),ssFallback:e.ssFallback&&Nr(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx}}function Ad(e=" ",t=0){return lt(Ei,null,e,t)}function oT(e="",t=!1){return t?(md(),pd(hr,null,e)):lt(hr,null,e)}function Rt(e){return e==null||typeof e=="boolean"?lt(hr):Se(e)?lt(wt,null,e.slice()):typeof e=="object"?Qt(e):lt(Ei,null,String(e))}function Qt(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Nr(e)}function js(e,t){let r=0;const{shapeFlag:n}=e;if(t==null)t=null;else if(Se(t))r=16;else if(typeof t=="object")if(n&65){const i=t.default;i&&(i._c&&(i._d=!1),js(e,i()),i._c&&(i._d=!0));return}else{r=32;const i=t._;!i&&!(mi in t)?t._ctx=yt:i===3&&yt&&(yt.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else xe(t)?(t={default:t,_ctx:yt},r=32):(t=String(t),n&64?(r=16,t=[Ad(t)]):r=8);e.children=t,e.shapeFlag|=r}function yd(...e){const t={};for(let r=0;r<e.length;r++){const n=e[r];for(const i in n)if(i==="class")t.class!==n.class&&(t.class=Rs([t.class,n.class]));else if(i==="style")t.style=Ds([t.style,n.style]);else if(ui(i)){const y=t[i],M=n[i];M&&y!==M&&!(Se(y)&&y.includes(M))&&(t[i]=y?[].concat(y,M):M)}else i!==""&&(t[i]=n[i])}return t}function Lt(e,t,r,n=null){It(e,t,7,[r,n])}const bd=wo();let Sd=0;function Id(e,t,r){const n=e.type,i=(t?t.appContext:e.appContext)||bd,y={uid:Sd++,vnode:e,type:n,parent:t,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new Yc(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Fo(n,i),emitsOptions:So(n,i),emit:null,emitted:null,propsDefaults:Be,inheritAttrs:n.inheritAttrs,ctx:Be,data:Be,props:Be,attrs:Be,slots:Be,refs:Be,setupState:Be,setupContext:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return y.ctx={_:y},y.root=t?t.root:y,y.emit=Rf.bind(null,y),e.ce&&e.ce(y),y}let Qe=null;const Mr=e=>{Qe=e,e.scope.on()},dr=()=>{Qe&&Qe.scope.off(),Qe=null};function Yo(e){return e.vnode.shapeFlag&4}let En=!1;function xd(e,t=!1){En=t;const{props:r,children:n}=e.vnode,i=Yo(e);sd(e,r,i,t),od(e,n);const y=i?Cd(e,t):void 0;return En=!1,y}function Cd(e,t){const r=e.type;e.accessCache=Object.create(null),e.proxy=ho(new Proxy(e.ctx,Zf));const{setup:n}=r;if(n){const i=e.setupContext=n.length>1?Dd(e):null;Mr(e),Hr();const y=qt(n,e,0,[e.props,i]);if(Kr(),dr(),zu(y)){if(y.then(dr,dr),t)return y.then(M=>{Ha(e,M,t)}).catch(M=>{di(M,e,0)});e.asyncDep=y}else Ha(e,y,t)}else Vo(e,t)}function Ha(e,t,r){xe(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:Ue(t)&&(e.setupState=vo(t)),Vo(e,r)}let Ka;function Vo(e,t,r){const n=e.type;if(!e.render){if(!t&&Ka&&!n.render){const i=n.template||Ys(e).template;if(i){const{isCustomElement:y,compilerOptions:M}=e.appContext.config,{delimiters:C,compilerOptions:u}=n,R=et(et({isCustomElement:y,delimiters:C},M),u);n.render=Ka(i,R)}}e.render=n.render||St}Mr(e),Hr(),ed(e),Kr(),dr()}function Ld(e){return new Proxy(e.attrs,{get(t,r){return ct(e,"get","$attrs"),t[r]}})}function Dd(e){const t=n=>{e.exposed=n||{}};let r;return{get attrs(){return r||(r=Ld(e))},slots:e.slots,emit:e.emit,expose:t}}function Xs(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(vo(ho(e.exposed)),{get(t,r){if(r in t)return t[r];if(r in Jr)return Jr[r](e)},has(t,r){return r in t||r in Jr}}))}function Rd(e,t=!0){return xe(e)?e.displayName||e.name:e.name||t&&e.__name}function Od(e){return xe(e)&&"__vccOpts"in e}const mt=(e,t)=>Sf(e,t,En);function jo(e,t,r){const n=arguments.length;return n===2?Ue(t)&&!Se(t)?fs(t)?lt(e,null,[t]):lt(e,t):lt(e,null,t):(n>3?r=Array.prototype.slice.call(arguments,2):n===3&&fs(r)&&(r=[r]),lt(e,t,r))}const Pd=Symbol(""),Nd=()=>Ht(Pd),Md="3.2.45",Fd="http://www.w3.org/2000/svg",ur=typeof document<"u"?document:null,Wa=ur&&ur.createElement("template"),kd={insert:(e,t,r)=>{t.insertBefore(e,r||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,r,n)=>{const i=t?ur.createElementNS(Fd,e):ur.createElement(e,r?{is:r}:void 0);return e==="select"&&n&&n.multiple!=null&&i.setAttribute("multiple",n.multiple),i},createText:e=>ur.createTextNode(e),createComment:e=>ur.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>ur.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,r,n,i,y){const M=r?r.previousSibling:t.lastChild;if(i&&(i===y||i.nextSibling))for(;t.insertBefore(i.cloneNode(!0),r),!(i===y||!(i=i.nextSibling)););else{Wa.innerHTML=n?`<svg>${e}</svg>`:e;const C=Wa.content;if(n){const u=C.firstChild;for(;u.firstChild;)C.appendChild(u.firstChild);C.removeChild(u)}t.insertBefore(C,r)}return[M?M.nextSibling:t.firstChild,r?r.previousSibling:t.lastChild]}};function Bd(e,t,r){const n=e._vtc;n&&(t=(t?[t,...n]:[...n]).join(" ")),t==null?e.removeAttribute("class"):r?e.setAttribute("class",t):e.className=t}function Ud(e,t,r){const n=e.style,i=Ve(r);if(r&&!i){for(const y in r)ds(n,y,r[y]);if(t&&!Ve(t))for(const y in t)r[y]==null&&ds(n,y,"")}else{const y=n.display;i?t!==r&&(n.cssText=r):t&&e.removeAttribute("style"),"_vod"in e&&(n.display=y)}}const Ga=/\s*!important$/;function ds(e,t,r){if(Se(r))r.forEach(n=>ds(e,t,n));else if(r==null&&(r=""),t.startsWith("--"))e.setProperty(t,r);else{const n=wd(e,t);Ga.test(r)?e.setProperty(wr(n),r.replace(Ga,""),"important"):e[n]=r}}const Ya=["Webkit","Moz","ms"],wi={};function wd(e,t){const r=wi[t];if(r)return r;let n=Ft(t);if(n!=="filter"&&n in e)return wi[t]=n;n=ci(n);for(let i=0;i<Ya.length;i++){const y=Ya[i]+n;if(y in e)return wi[t]=y}return t}const Va="http://www.w3.org/1999/xlink";function Hd(e,t,r,n,i){if(n&&t.startsWith("xlink:"))r==null?e.removeAttributeNS(Va,t.slice(6,t.length)):e.setAttributeNS(Va,t,r);else{const y=kc(t);r==null||y&&!Xu(r)?e.removeAttribute(t):e.setAttribute(t,y?"":r)}}function Kd(e,t,r,n,i,y,M){if(t==="innerHTML"||t==="textContent"){n&&M(n,i,y),e[t]=r??"";return}if(t==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=r;const u=r??"";(e.value!==u||e.tagName==="OPTION")&&(e.value=u),r==null&&e.removeAttribute(t);return}let C=!1;if(r===""||r==null){const u=typeof e[t];u==="boolean"?r=Xu(r):r==null&&u==="string"?(r="",C=!0):u==="number"&&(r=0,C=!0)}try{e[t]=r}catch{}C&&e.removeAttribute(t)}function Wd(e,t,r,n){e.addEventListener(t,r,n)}function Gd(e,t,r,n){e.removeEventListener(t,r,n)}function Yd(e,t,r,n,i=null){const y=e._vei||(e._vei={}),M=y[t];if(n&&M)M.value=n;else{const[C,u]=Vd(t);if(n){const R=y[t]=Qd(n,i);Wd(e,C,R,u)}else M&&(Gd(e,C,M,u),y[t]=void 0)}}const ja=/(?:Once|Passive|Capture)$/;function Vd(e){let t;if(ja.test(e)){t={};let n;for(;n=e.match(ja);)e=e.slice(0,e.length-n[0].length),t[n[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):wr(e.slice(2)),t]}let Hi=0;const jd=Promise.resolve(),Xd=()=>Hi||(jd.then(()=>Hi=0),Hi=Date.now());function Qd(e,t){const r=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=r.attached)return;It($d(n,r.value),t,5,[n])};return r.value=e,r.attached=Xd(),r}function $d(e,t){if(Se(t)){const r=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{r.call(e),e._stopped=!0},t.map(n=>i=>!i._stopped&&n&&n(i))}else return t}const Xa=/^on[a-z]/,zd=(e,t,r,n,i=!1,y,M,C,u)=>{t==="class"?Bd(e,n,i):t==="style"?Ud(e,r,n):ui(t)?Os(t)||Yd(e,t,r,n,M):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):qd(e,t,n,i))?Kd(e,t,n,y,M,C,u):(t==="true-value"?e._trueValue=n:t==="false-value"&&(e._falseValue=n),Hd(e,t,n,i))};function qd(e,t,r,n){return n?!!(t==="innerHTML"||t==="textContent"||t in e&&Xa.test(t)&&xe(r)):t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||Xa.test(t)&&Ve(r)?!1:t in e}const Jd=et({patchProp:zd},kd);let Qa;function Zd(){return Qa||(Qa=dd(Jd))}const lT=(...e)=>{const t=Zd().createApp(...e),{mount:r}=t;return t.mount=n=>{const i=eh(n);if(!i)return;const y=t._component;!xe(y)&&!y.render&&!y.template&&(y.template=i.innerHTML),i.innerHTML="";const M=r(i,!1,i instanceof SVGElement);return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),M},t};function eh(e){return Ve(e)?document.querySelector(e):e}/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const yr=typeof window<"u";function th(e){return e.__esModule||e[Symbol.toStringTag]==="Module"}const Ne=Object.assign;function Ki(e,t){const r={};for(const n in t){const i=t[n];r[n]=xt(i)?i.map(e):e(i)}return r}const en=()=>{},xt=Array.isArray,rh=/\/$/,nh=e=>e.replace(rh,"");function Wi(e,t,r="/"){let n,i={},y="",M="";const C=t.indexOf("#");let u=t.indexOf("?");return C<u&&C>=0&&(u=-1),u>-1&&(n=t.slice(0,u),y=t.slice(u+1,C>-1?C:t.length),i=e(y)),C>-1&&(n=n||t.slice(0,C),M=t.slice(C,t.length)),n=uh(n??t,r),{fullPath:n+(y&&"?")+y+M,path:n,query:i,hash:M}}function ih(e,t){const r=t.query?e(t.query):"";return t.path+(r&&"?")+r+(t.hash||"")}function $a(e,t){return!t||!e.toLowerCase().startsWith(t.toLowerCase())?e:e.slice(t.length)||"/"}function sh(e,t,r){const n=t.matched.length-1,i=r.matched.length-1;return n>-1&&n===i&&Fr(t.matched[n],r.matched[i])&&Xo(t.params,r.params)&&e(t.query)===e(r.query)&&t.hash===r.hash}function Fr(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function Xo(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!ah(e[r],t[r]))return!1;return!0}function ah(e,t){return xt(e)?za(e,t):xt(t)?za(t,e):e===t}function za(e,t){return xt(t)?e.length===t.length&&e.every((r,n)=>r===t[n]):e.length===1&&e[0]===t}function uh(e,t){if(e.startsWith("/"))return e;if(!e)return t;const r=t.split("/"),n=e.split("/");let i=r.length-1,y,M;for(y=0;y<n.length;y++)if(M=n[y],M!==".")if(M==="..")i>1&&i--;else break;return r.slice(0,i).join("/")+"/"+n.slice(y-(y===n.length?1:0)).join("/")}var mn;(function(e){e.pop="pop",e.push="push"})(mn||(mn={}));var tn;(function(e){e.back="back",e.forward="forward",e.unknown=""})(tn||(tn={}));function oh(e){if(!e)if(yr){const t=document.querySelector("base");e=t&&t.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),nh(e)}const lh=/^[^#]+#/;function ch(e,t){return e.replace(lh,"#")+t}function fh(e,t){const r=document.documentElement.getBoundingClientRect(),n=e.getBoundingClientRect();return{behavior:t.behavior,left:n.left-r.left-(t.left||0),top:n.top-r.top-(t.top||0)}}const vi=()=>({left:window.pageXOffset,top:window.pageYOffset});function dh(e){let t;if("el"in e){const r=e.el,n=typeof r=="string"&&r.startsWith("#"),i=typeof r=="string"?n?document.getElementById(r.slice(1)):document.querySelector(r):r;if(!i)return;t=fh(i,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(t.left!=null?t.left:window.pageXOffset,t.top!=null?t.top:window.pageYOffset)}function qa(e,t){return(history.state?history.state.position-t:-1)+e}const hs=new Map;function hh(e,t){hs.set(e,t)}function gh(e){const t=hs.get(e);return hs.delete(e),t}let Eh=()=>location.protocol+"//"+location.host;function Qo(e,t){const{pathname:r,search:n,hash:i}=t,y=e.indexOf("#");if(y>-1){let C=i.includes(e.slice(y))?e.slice(y).length:1,u=i.slice(C);return u[0]!=="/"&&(u="/"+u),$a(u,"")}return $a(r,e)+n+i}function mh(e,t,r,n){let i=[],y=[],M=null;const C=({state:D})=>{const K=Qo(e,location),k=r.value,F=t.value;let B=0;if(D){if(r.value=K,t.value=D,M&&M===k){M=null;return}B=F?D.position-F.position:0}else n(K);i.forEach(O=>{O(r.value,k,{delta:B,type:mn.pop,direction:B?B>0?tn.forward:tn.back:tn.unknown})})};function u(){M=r.value}function R(D){i.push(D);const K=()=>{const k=i.indexOf(D);k>-1&&i.splice(k,1)};return y.push(K),K}function _(){const{history:D}=window;D.state&&D.replaceState(Ne({},D.state,{scroll:vi()}),"")}function U(){for(const D of y)D();y=[],window.removeEventListener("popstate",C),window.removeEventListener("beforeunload",_)}return window.addEventListener("popstate",C),window.addEventListener("beforeunload",_),{pauseListeners:u,listen:R,destroy:U}}function Ja(e,t,r,n=!1,i=!1){return{back:e,current:t,forward:r,replaced:n,position:window.history.length,scroll:i?vi():null}}function vh(e){const{history:t,location:r}=window,n={value:Qo(e,r)},i={value:t.state};i.value||y(n.value,{back:null,current:n.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0);function y(u,R,_){const U=e.indexOf("#"),D=U>-1?(r.host&&document.querySelector("base")?e:e.slice(U))+u:Eh()+e+u;try{t[_?"replaceState":"pushState"](R,"",D),i.value=R}catch(K){console.error(K),r[_?"replace":"assign"](D)}}function M(u,R){const _=Ne({},t.state,Ja(i.value.back,u,i.value.forward,!0),R,{position:i.value.position});y(u,_,!0),n.value=u}function C(u,R){const _=Ne({},i.value,t.state,{forward:u,scroll:vi()});y(_.current,_,!0);const U=Ne({},Ja(n.value,u,null),{position:_.position+1},R);y(u,U,!1),n.value=u}return{location:n,state:i,push:C,replace:M}}function cT(e){e=oh(e);const t=vh(e),r=mh(e,t.state,t.location,t.replace);function n(y,M=!0){M||r.pauseListeners(),history.go(y)}const i=Ne({location:"",base:e,go:n,createHref:ch.bind(null,e)},t,r);return Object.defineProperty(i,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(i,"state",{enumerable:!0,get:()=>t.state.value}),i}function ph(e){return typeof e=="string"||e&&typeof e=="object"}function $o(e){return typeof e=="string"||typeof e=="symbol"}const Vt={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},zo=Symbol("");var Za;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(Za||(Za={}));function kr(e,t){return Ne(new Error,{type:e,[zo]:!0},t)}function kt(e,t){return e instanceof Error&&zo in e&&(t==null||!!(e.type&t))}const eu="[^/]+?",Th={sensitive:!1,strict:!1,start:!0,end:!0},_h=/[.+*?^${}()[\]/\\]/g;function Ah(e,t){const r=Ne({},Th,t),n=[];let i=r.start?"^":"";const y=[];for(const R of e){const _=R.length?[]:[90];r.strict&&!R.length&&(i+="/");for(let U=0;U<R.length;U++){const D=R[U];let K=40+(r.sensitive?.25:0);if(D.type===0)U||(i+="/"),i+=D.value.replace(_h,"\\$&"),K+=40;else if(D.type===1){const{value:k,repeatable:F,optional:B,regexp:O}=D;y.push({name:k,repeatable:F,optional:B});const P=O||eu;if(P!==eu){K+=10;try{new RegExp(`(${P})`)}catch(N){throw new Error(`Invalid custom RegExp for param "${k}" (${P}): `+N.message)}}let g=F?`((?:${P})(?:/(?:${P}))*)`:`(${P})`;U||(g=B&&R.length<2?`(?:/${g})`:"/"+g),B&&(g+="?"),i+=g,K+=20,B&&(K+=-8),F&&(K+=-20),P===".*"&&(K+=-50)}_.push(K)}n.push(_)}if(r.strict&&r.end){const R=n.length-1;n[R][n[R].length-1]+=.7000000000000001}r.strict||(i+="/?"),r.end?i+="$":r.strict&&(i+="(?:/|$)");const M=new RegExp(i,r.sensitive?"":"i");function C(R){const _=R.match(M),U={};if(!_)return null;for(let D=1;D<_.length;D++){const K=_[D]||"",k=y[D-1];U[k.name]=K&&k.repeatable?K.split("/"):K}return U}function u(R){let _="",U=!1;for(const D of e){(!U||!_.endsWith("/"))&&(_+="/"),U=!1;for(const K of D)if(K.type===0)_+=K.value;else if(K.type===1){const{value:k,repeatable:F,optional:B}=K,O=k in R?R[k]:"";if(xt(O)&&!F)throw new Error(`Provided param "${k}" is an array but it is not repeatable (* or + modifiers)`);const P=xt(O)?O.join("/"):O;if(!P)if(B)D.length<2&&(_.endsWith("/")?_=_.slice(0,-1):U=!0);else throw new Error(`Missing required param "${k}"`);_+=P}}return _||"/"}return{re:M,score:n,keys:y,parse:C,stringify:u}}function yh(e,t){let r=0;for(;r<e.length&&r<t.length;){const n=t[r]-e[r];if(n)return n;r++}return e.length<t.length?e.length===1&&e[0]===40+40?-1:1:e.length>t.length?t.length===1&&t[0]===40+40?1:-1:0}function bh(e,t){let r=0;const n=e.score,i=t.score;for(;r<n.length&&r<i.length;){const y=yh(n[r],i[r]);if(y)return y;r++}if(Math.abs(i.length-n.length)===1){if(tu(n))return 1;if(tu(i))return-1}return i.length-n.length}function tu(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const Sh={type:0,value:""},Ih=/[a-zA-Z0-9_]/;function xh(e){if(!e)return[[]];if(e==="/")return[[Sh]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(K){throw new Error(`ERR (${r})/"${R}": ${K}`)}let r=0,n=r;const i=[];let y;function M(){y&&i.push(y),y=[]}let C=0,u,R="",_="";function U(){R&&(r===0?y.push({type:0,value:R}):r===1||r===2||r===3?(y.length>1&&(u==="*"||u==="+")&&t(`A repeatable param (${R}) must be alone in its segment. eg: '/:ids+.`),y.push({type:1,value:R,regexp:_,repeatable:u==="*"||u==="+",optional:u==="*"||u==="?"})):t("Invalid state to consume buffer"),R="")}function D(){R+=u}for(;C<e.length;){if(u=e[C++],u==="\\"&&r!==2){n=r,r=4;continue}switch(r){case 0:u==="/"?(R&&U(),M()):u===":"?(U(),r=1):D();break;case 4:D(),r=n;break;case 1:u==="("?r=2:Ih.test(u)?D():(U(),r=0,u!=="*"&&u!=="?"&&u!=="+"&&C--);break;case 2:u===")"?_[_.length-1]=="\\"?_=_.slice(0,-1)+u:r=3:_+=u;break;case 3:U(),r=0,u!=="*"&&u!=="?"&&u!=="+"&&C--,_="";break;default:t("Unknown state");break}}return r===2&&t(`Unfinished custom RegExp for param "${R}"`),U(),M(),i}function Ch(e,t,r){const n=Ah(xh(e.path),r),i=Ne(n,{record:e,parent:t,children:[],alias:[]});return t&&!i.record.aliasOf==!t.record.aliasOf&&t.children.push(i),i}function Lh(e,t){const r=[],n=new Map;t=iu({strict:!1,end:!0,sensitive:!1},t);function i(_){return n.get(_)}function y(_,U,D){const K=!D,k=Dh(_);k.aliasOf=D&&D.record;const F=iu(t,_),B=[k];if("alias"in _){const g=typeof _.alias=="string"?[_.alias]:_.alias;for(const N of g)B.push(Ne({},k,{components:D?D.record.components:k.components,path:N,aliasOf:D?D.record:k}))}let O,P;for(const g of B){const{path:N}=g;if(U&&N[0]!=="/"){const S=U.record.path,f=S[S.length-1]==="/"?"":"/";g.path=U.record.path+(N&&f+N)}if(O=Ch(g,U,F),D?D.alias.push(O):(P=P||O,P!==O&&P.alias.push(O),K&&_.name&&!nu(O)&&M(_.name)),k.children){const S=k.children;for(let f=0;f<S.length;f++)y(S[f],O,D&&D.children[f])}D=D||O,(O.record.components&&Object.keys(O.record.components).length||O.record.name||O.record.redirect)&&u(O)}return P?()=>{M(P)}:en}function M(_){if($o(_)){const U=n.get(_);U&&(n.delete(_),r.splice(r.indexOf(U),1),U.children.forEach(M),U.alias.forEach(M))}else{const U=r.indexOf(_);U>-1&&(r.splice(U,1),_.record.name&&n.delete(_.record.name),_.children.forEach(M),_.alias.forEach(M))}}function C(){return r}function u(_){let U=0;for(;U<r.length&&bh(_,r[U])>=0&&(_.record.path!==r[U].record.path||!qo(_,r[U]));)U++;r.splice(U,0,_),_.record.name&&!nu(_)&&n.set(_.record.name,_)}function R(_,U){let D,K={},k,F;if("name"in _&&_.name){if(D=n.get(_.name),!D)throw kr(1,{location:_});F=D.record.name,K=Ne(ru(U.params,D.keys.filter(P=>!P.optional).map(P=>P.name)),_.params&&ru(_.params,D.keys.map(P=>P.name))),k=D.stringify(K)}else if("path"in _)k=_.path,D=r.find(P=>P.re.test(k)),D&&(K=D.parse(k),F=D.record.name);else{if(D=U.name?n.get(U.name):r.find(P=>P.re.test(U.path)),!D)throw kr(1,{location:_,currentLocation:U});F=D.record.name,K=Ne({},U.params,_.params),k=D.stringify(K)}const B=[];let O=D;for(;O;)B.unshift(O.record),O=O.parent;return{name:F,path:k,params:K,matched:B,meta:Oh(B)}}return e.forEach(_=>y(_)),{addRoute:y,resolve:R,removeRoute:M,getRoutes:C,getRecordMatcher:i}}function ru(e,t){const r={};for(const n of t)n in e&&(r[n]=e[n]);return r}function Dh(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:Rh(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}}}function Rh(e){const t={},r=e.props||!1;if("component"in e)t.default=r;else for(const n in e.components)t[n]=typeof r=="boolean"?r:r[n];return t}function nu(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function Oh(e){return e.reduce((t,r)=>Ne(t,r.meta),{})}function iu(e,t){const r={};for(const n in e)r[n]=n in t?t[n]:e[n];return r}function qo(e,t){return t.children.some(r=>r===e||qo(e,r))}const Jo=/#/g,Ph=/&/g,Nh=/\//g,Mh=/=/g,Fh=/\?/g,Zo=/\+/g,kh=/%5B/g,Bh=/%5D/g,el=/%5E/g,Uh=/%60/g,tl=/%7B/g,wh=/%7C/g,rl=/%7D/g,Hh=/%20/g;function Qs(e){return encodeURI(""+e).replace(wh,"|").replace(kh,"[").replace(Bh,"]")}function Kh(e){return Qs(e).replace(tl,"{").replace(rl,"}").replace(el,"^")}function gs(e){return Qs(e).replace(Zo,"%2B").replace(Hh,"+").replace(Jo,"%23").replace(Ph,"%26").replace(Uh,"`").replace(tl,"{").replace(rl,"}").replace(el,"^")}function Wh(e){return gs(e).replace(Mh,"%3D")}function Gh(e){return Qs(e).replace(Jo,"%23").replace(Fh,"%3F")}function Yh(e){return e==null?"":Gh(e).replace(Nh,"%2F")}function zn(e){try{return decodeURIComponent(""+e)}catch{}return""+e}function Vh(e){const t={};if(e===""||e==="?")return t;const n=(e[0]==="?"?e.slice(1):e).split("&");for(let i=0;i<n.length;++i){const y=n[i].replace(Zo," "),M=y.indexOf("="),C=zn(M<0?y:y.slice(0,M)),u=M<0?null:zn(y.slice(M+1));if(C in t){let R=t[C];xt(R)||(R=t[C]=[R]),R.push(u)}else t[C]=u}return t}function su(e){let t="";for(let r in e){const n=e[r];if(r=Wh(r),n==null){n!==void 0&&(t+=(t.length?"&":"")+r);continue}(xt(n)?n.map(y=>y&&gs(y)):[n&&gs(n)]).forEach(y=>{y!==void 0&&(t+=(t.length?"&":"")+r,y!=null&&(t+="="+y))})}return t}function jh(e){const t={};for(const r in e){const n=e[r];n!==void 0&&(t[r]=xt(n)?n.map(i=>i==null?null:""+i):n==null?n:""+n)}return t}const Xh=Symbol(""),au=Symbol(""),$s=Symbol(""),nl=Symbol(""),Es=Symbol("");function jr(){let e=[];function t(n){return e.push(n),()=>{const i=e.indexOf(n);i>-1&&e.splice(i,1)}}function r(){e=[]}return{add:t,list:()=>e,reset:r}}function $t(e,t,r,n,i){const y=n&&(n.enterCallbacks[i]=n.enterCallbacks[i]||[]);return()=>new Promise((M,C)=>{const u=U=>{U===!1?C(kr(4,{from:r,to:t})):U instanceof Error?C(U):ph(U)?C(kr(2,{from:t,to:U})):(y&&n.enterCallbacks[i]===y&&typeof U=="function"&&y.push(U),M())},R=e.call(n&&n.instances[i],t,r,u);let _=Promise.resolve(R);e.length<3&&(_=_.then(u)),_.catch(U=>C(U))})}function Gi(e,t,r,n){const i=[];for(const y of e)for(const M in y.components){let C=y.components[M];if(!(t!=="beforeRouteEnter"&&!y.instances[M]))if(Qh(C)){const R=(C.__vccOpts||C)[t];R&&i.push($t(R,r,n,y,M))}else{let u=C();i.push(()=>u.then(R=>{if(!R)return Promise.reject(new Error(`Couldn't resolve component "${M}" at "${y.path}"`));const _=th(R)?R.default:R;y.components[M]=_;const D=(_.__vccOpts||_)[t];return D&&$t(D,r,n,y,M)()}))}}return i}function Qh(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function uu(e){const t=Ht($s),r=Ht(nl),n=mt(()=>t.resolve(Lr(e.to))),i=mt(()=>{const{matched:u}=n.value,{length:R}=u,_=u[R-1],U=r.matched;if(!_||!U.length)return-1;const D=U.findIndex(Fr.bind(null,_));if(D>-1)return D;const K=ou(u[R-2]);return R>1&&ou(_)===K&&U[U.length-1].path!==K?U.findIndex(Fr.bind(null,u[R-2])):D}),y=mt(()=>i.value>-1&&Jh(r.params,n.value.params)),M=mt(()=>i.value>-1&&i.value===r.matched.length-1&&Xo(r.params,n.value.params));function C(u={}){return qh(u)?t[Lr(e.replace)?"replace":"push"](Lr(e.to)).catch(en):Promise.resolve()}return{route:n,href:mt(()=>n.value.href),isActive:y,isExactActive:M,navigate:C}}const $h=Lo({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:uu,setup(e,{slots:t}){const r=An(uu(e)),{options:n}=Ht($s),i=mt(()=>({[lu(e.activeClass,n.linkActiveClass,"router-link-active")]:r.isActive,[lu(e.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:r.isExactActive}));return()=>{const y=t.default&&t.default(r);return e.custom?y:jo("a",{"aria-current":r.isExactActive?e.ariaCurrentValue:null,href:r.href,onClick:r.navigate,class:i.value},y)}}}),zh=$h;function qh(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function Jh(e,t){for(const r in t){const n=t[r],i=e[r];if(typeof n=="string"){if(n!==i)return!1}else if(!xt(i)||i.length!==n.length||n.some((y,M)=>y!==i[M]))return!1}return!0}function ou(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const lu=(e,t,r)=>e??t??r,Zh=Lo({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:r}){const n=Ht(Es),i=mt(()=>e.route||n.value),y=Ht(au,0),M=mt(()=>{let R=Lr(y);const{matched:_}=i.value;let U;for(;(U=_[R])&&!U.components;)R++;return R}),C=mt(()=>i.value.matched[M.value]);Hn(au,mt(()=>M.value+1)),Hn(Xh,C),Hn(Es,i);const u=Tf();return Kn(()=>[u.value,C.value,e.name],([R,_,U],[D,K,k])=>{_&&(_.instances[U]=R,K&&K!==_&&R&&R===D&&(_.leaveGuards.size||(_.leaveGuards=K.leaveGuards),_.updateGuards.size||(_.updateGuards=K.updateGuards))),R&&_&&(!K||!Fr(_,K)||!D)&&(_.enterCallbacks[U]||[]).forEach(F=>F(R))},{flush:"post"}),()=>{const R=i.value,_=e.name,U=C.value,D=U&&U.components[_];if(!D)return cu(r.default,{Component:D,route:R});const K=U.props[_],k=K?K===!0?R.params:typeof K=="function"?K(R):K:null,B=jo(D,Ne({},k,t,{onVnodeUnmounted:O=>{O.component.isUnmounted&&(U.instances[_]=null)},ref:u}));return cu(r.default,{Component:B,route:R})||B}}});function cu(e,t){if(!e)return null;const r=e(t);return r.length===1?r[0]:r}const e0=Zh;function fT(e){const t=Lh(e.routes,e),r=e.parseQuery||Vh,n=e.stringifyQuery||su,i=e.history,y=jr(),M=jr(),C=jr(),u=_f(Vt);let R=Vt;yr&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const _=Ki.bind(null,w=>""+w),U=Ki.bind(null,Yh),D=Ki.bind(null,zn);function K(w,G){let Y,j;return $o(w)?(Y=t.getRecordMatcher(w),j=G):j=w,t.addRoute(j,Y)}function k(w){const G=t.getRecordMatcher(w);G&&t.removeRoute(G)}function F(){return t.getRoutes().map(w=>w.record)}function B(w){return!!t.getRecordMatcher(w)}function O(w,G){if(G=Ne({},G||u.value),typeof w=="string"){const V=Wi(r,w,G.path),Q=t.resolve({path:V.path},G),ee=i.createHref(V.fullPath);return Ne(V,Q,{params:D(Q.params),hash:zn(V.hash),redirectedFrom:void 0,href:ee})}let Y;if("path"in w)Y=Ne({},w,{path:Wi(r,w.path,G.path).path});else{const V=Ne({},w.params);for(const Q in V)V[Q]==null&&delete V[Q];Y=Ne({},w,{params:U(w.params)}),G.params=U(G.params)}const j=t.resolve(Y,G),X=w.hash||"";j.params=_(D(j.params));const q=ih(n,Ne({},w,{hash:Kh(X),path:j.path})),J=i.createHref(q);return Ne({fullPath:q,hash:X,query:n===su?jh(w.query):w.query||{}},j,{redirectedFrom:void 0,href:J})}function P(w){return typeof w=="string"?Wi(r,w,u.value.path):Ne({},w)}function g(w,G){if(R!==w)return kr(8,{from:G,to:w})}function N(w){return m(w)}function S(w){return N(Ne(P(w),{replace:!0}))}function f(w){const G=w.matched[w.matched.length-1];if(G&&G.redirect){const{redirect:Y}=G;let j=typeof Y=="function"?Y(w):Y;return typeof j=="string"&&(j=j.includes("?")||j.includes("#")?j=P(j):{path:j},j.params={}),Ne({query:w.query,hash:w.hash,params:"path"in j?{}:w.params},j)}}function m(w,G){const Y=R=O(w),j=u.value,X=w.state,q=w.force,J=w.replace===!0,V=f(Y);if(V)return m(Ne(P(V),{state:typeof V=="object"?Ne({},X,V.state):X,force:q,replace:J}),G||Y);const Q=Y;Q.redirectedFrom=G;let ee;return!q&&sh(n,j,Y)&&(ee=kr(16,{to:Q,from:j}),T(j,j,!0,!1)),(ee?Promise.resolve(ee):l(Q,j)).catch(Z=>kt(Z)?kt(Z,2)?Z:a(Z):s(Z,Q,j)).then(Z=>{if(Z){if(kt(Z,2))return m(Ne({replace:J},P(Z.to),{state:typeof Z.to=="object"?Ne({},X,Z.to.state):X,force:q}),G||Q)}else Z=h(Q,j,!0,J,X);return b(Q,j,Z),Z})}function d(w,G){const Y=g(w,G);return Y?Promise.reject(Y):Promise.resolve()}function l(w,G){let Y;const[j,X,q]=t0(w,G);Y=Gi(j.reverse(),"beforeRouteLeave",w,G);for(const V of j)V.leaveGuards.forEach(Q=>{Y.push($t(Q,w,G))});const J=d.bind(null,w,G);return Y.push(J),_r(Y).then(()=>{Y=[];for(const V of y.list())Y.push($t(V,w,G));return Y.push(J),_r(Y)}).then(()=>{Y=Gi(X,"beforeRouteUpdate",w,G);for(const V of X)V.updateGuards.forEach(Q=>{Y.push($t(Q,w,G))});return Y.push(J),_r(Y)}).then(()=>{Y=[];for(const V of w.matched)if(V.beforeEnter&&!G.matched.includes(V))if(xt(V.beforeEnter))for(const Q of V.beforeEnter)Y.push($t(Q,w,G));else Y.push($t(V.beforeEnter,w,G));return Y.push(J),_r(Y)}).then(()=>(w.matched.forEach(V=>V.enterCallbacks={}),Y=Gi(q,"beforeRouteEnter",w,G),Y.push(J),_r(Y))).then(()=>{Y=[];for(const V of M.list())Y.push($t(V,w,G));return Y.push(J),_r(Y)}).catch(V=>kt(V,8)?V:Promise.reject(V))}function b(w,G,Y){for(const j of C.list())j(w,G,Y)}function h(w,G,Y,j,X){const q=g(w,G);if(q)return q;const J=G===Vt,V=yr?history.state:{};Y&&(j||J?i.replace(w.fullPath,Ne({scroll:J&&V&&V.scroll},X)):i.push(w.fullPath,X)),u.value=w,T(w,G,Y,J),a()}let o;function E(){o||(o=i.listen((w,G,Y)=>{if(!W.listening)return;const j=O(w),X=f(j);if(X){m(Ne(X,{replace:!0}),j).catch(en);return}R=j;const q=u.value;yr&&hh(qa(q.fullPath,Y.delta),vi()),l(j,q).catch(J=>kt(J,12)?J:kt(J,2)?(m(J.to,j).then(V=>{kt(V,20)&&!Y.delta&&Y.type===mn.pop&&i.go(-1,!1)}).catch(en),Promise.reject()):(Y.delta&&i.go(-Y.delta,!1),s(J,j,q))).then(J=>{J=J||h(j,q,!1),J&&(Y.delta&&!kt(J,8)?i.go(-Y.delta,!1):Y.type===mn.pop&&kt(J,20)&&i.go(-1,!1)),b(j,q,J)}).catch(en)}))}let A=jr(),v=jr(),c;function s(w,G,Y){a(w);const j=v.list();return j.length?j.forEach(X=>X(w,G,Y)):console.error(w),Promise.reject(w)}function p(){return c&&u.value!==Vt?Promise.resolve():new Promise((w,G)=>{A.add([w,G])})}function a(w){return c||(c=!w,E(),A.list().forEach(([G,Y])=>w?Y(w):G()),A.reset()),w}function T(w,G,Y,j){const{scrollBehavior:X}=e;if(!yr||!X)return Promise.resolve();const q=!Y&&gh(qa(w.fullPath,0))||(j||!Y)&&history.state&&history.state.scroll||null;return _o().then(()=>X(w,G,q)).then(J=>J&&dh(J)).catch(J=>s(J,w,G))}const L=w=>i.go(w);let I;const H=new Set,W={currentRoute:u,listening:!0,addRoute:K,removeRoute:k,hasRoute:B,getRoutes:F,resolve:O,options:e,push:N,replace:S,go:L,back:()=>L(-1),forward:()=>L(1),beforeEach:y.add,beforeResolve:M.add,afterEach:C.add,onError:v.add,isReady:p,install(w){const G=this;w.component("RouterLink",zh),w.component("RouterView",e0),w.config.globalProperties.$router=G,Object.defineProperty(w.config.globalProperties,"$route",{enumerable:!0,get:()=>Lr(u)}),yr&&!I&&u.value===Vt&&(I=!0,N(i.location).catch(X=>{}));const Y={};for(const X in Vt)Y[X]=mt(()=>u.value[X]);w.provide($s,G),w.provide(nl,An(Y)),w.provide(Es,u);const j=w.unmount;H.add(w),w.unmount=function(){H.delete(w),H.size<1&&(R=Vt,o&&o(),o=null,u.value=Vt,I=!1,c=!1),j()}}};return W}function _r(e){return e.reduce((t,r)=>t.then(()=>r()),Promise.resolve())}function t0(e,t){const r=[],n=[],i=[],y=Math.max(t.matched.length,e.matched.length);for(let M=0;M<y;M++){const C=t.matched[M];C&&(e.matched.find(R=>Fr(R,C))?n.push(C):r.push(C));const u=e.matched[M];u&&(t.matched.find(R=>Fr(R,u))||i.push(u))}return[r,n,i]}const zs={xml:!1,decodeEntities:!0},fu={_useHtmlParser2:!0,xmlMode:!0};function ms(e){return e!=null&&e.xml?typeof e.xml=="boolean"?fu:{...fu,...e.xml}:e??void 0}var Re;(function(e){e.Root="root",e.Text="text",e.Directive="directive",e.Comment="comment",e.Script="script",e.Style="style",e.Tag="tag",e.CDATA="cdata",e.Doctype="doctype"})(Re||(Re={}));function r0(e){return e.type===Re.Tag||e.type===Re.Script||e.type===Re.Style}const n0=Re.Root,i0=Re.Text,s0=Re.Directive,a0=Re.Comment,u0=Re.Script,o0=Re.Style,l0=Re.Tag,c0=Re.CDATA,f0=Re.Doctype;class il{constructor(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}get parentNode(){return this.parent}set parentNode(t){this.parent=t}get previousSibling(){return this.prev}set previousSibling(t){this.prev=t}get nextSibling(){return this.next}set nextSibling(t){this.next=t}cloneNode(t=!1){return qn(this,t)}}class qs extends il{constructor(t){super(),this.data=t}get nodeValue(){return this.data}set nodeValue(t){this.data=t}}class vn extends qs{constructor(){super(...arguments),this.type=Re.Text}get nodeType(){return 3}}class Js extends qs{constructor(){super(...arguments),this.type=Re.Comment}get nodeType(){return 8}}class Zs extends qs{constructor(t,r){super(r),this.name=t,this.type=Re.Directive}get nodeType(){return 1}}class ea extends il{constructor(t){super(),this.children=t}get firstChild(){var t;return(t=this.children[0])!==null&&t!==void 0?t:null}get lastChild(){return this.children.length>0?this.children[this.children.length-1]:null}get childNodes(){return this.children}set childNodes(t){this.children=t}}class sl extends ea{constructor(){super(...arguments),this.type=Re.CDATA}get nodeType(){return 4}}class gr extends ea{constructor(){super(...arguments),this.type=Re.Root}get nodeType(){return 9}}let ta=class extends ea{constructor(t,r,n=[],i=t==="script"?Re.Script:t==="style"?Re.Style:Re.Tag){super(n),this.name=t,this.attribs=r,this.type=i}get nodeType(){return 1}get tagName(){return this.name}set tagName(t){this.name=t}get attributes(){return Object.keys(this.attribs).map(t=>{var r,n;return{name:t,value:this.attribs[t],namespace:(r=this["x-attribsNamespace"])===null||r===void 0?void 0:r[t],prefix:(n=this["x-attribsPrefix"])===null||n===void 0?void 0:n[t]}})}};function be(e){return r0(e)}function pi(e){return e.type===Re.CDATA}function Nt(e){return e.type===Re.Text}function Ti(e){return e.type===Re.Comment}function vs(e){return e.type===Re.Directive}function mr(e){return e.type===Re.Root}function je(e){return Object.prototype.hasOwnProperty.call(e,"children")}function qn(e,t=!1){let r;if(Nt(e))r=new vn(e.data);else if(Ti(e))r=new Js(e.data);else if(be(e)){const n=t?Yi(e.children):[],i=new ta(e.name,{...e.attribs},n);n.forEach(y=>y.parent=i),e.namespace!=null&&(i.namespace=e.namespace),e["x-attribsNamespace"]&&(i["x-attribsNamespace"]={...e["x-attribsNamespace"]}),e["x-attribsPrefix"]&&(i["x-attribsPrefix"]={...e["x-attribsPrefix"]}),r=i}else if(pi(e)){const n=t?Yi(e.children):[],i=new sl(n);n.forEach(y=>y.parent=i),r=i}else if(mr(e)){const n=t?Yi(e.children):[],i=new gr(n);n.forEach(y=>y.parent=i),e["x-mode"]&&(i["x-mode"]=e["x-mode"]),r=i}else if(vs(e)){const n=new Zs(e.name,e.data);e["x-name"]!=null&&(n["x-name"]=e["x-name"],n["x-publicId"]=e["x-publicId"],n["x-systemId"]=e["x-systemId"]),r=n}else throw new Error(`Not implemented yet: ${e.type}`);return r.startIndex=e.startIndex,r.endIndex=e.endIndex,e.sourceCodeLocation!=null&&(r.sourceCodeLocation=e.sourceCodeLocation),r}function Yi(e){const t=e.map(r=>qn(r,!0));for(let r=1;r<t.length;r++)t[r].prev=t[r-1],t[r-1].next=t[r];return t}const du={withStartIndices:!1,withEndIndices:!1,xmlMode:!1};class d0{constructor(t,r,n){this.dom=[],this.root=new gr(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof r=="function"&&(n=r,r=du),typeof t=="object"&&(r=t,t=void 0),this.callback=t??null,this.options=r??du,this.elementCB=n??null}onparserinit(t){this.parser=t}onreset(){this.dom=[],this.root=new gr(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null}onend(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))}onerror(t){this.handleCallback(t)}onclosetag(){this.lastNode=null;const t=this.tagStack.pop();this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(t)}onopentag(t,r){const n=this.options.xmlMode?Re.Tag:void 0,i=new ta(t,r,void 0,n);this.addNode(i),this.tagStack.push(i)}ontext(t){const{lastNode:r}=this;if(r&&r.type===Re.Text)r.data+=t,this.options.withEndIndices&&(r.endIndex=this.parser.endIndex);else{const n=new vn(t);this.addNode(n),this.lastNode=n}}oncomment(t){if(this.lastNode&&this.lastNode.type===Re.Comment){this.lastNode.data+=t;return}const r=new Js(t);this.addNode(r),this.lastNode=r}oncommentend(){this.lastNode=null}oncdatastart(){const t=new vn(""),r=new sl([t]);this.addNode(r),t.parent=r,this.lastNode=t}oncdataend(){this.lastNode=null}onprocessinginstruction(t,r){const n=new Zs(t,r);this.addNode(n)}handleCallback(t){if(typeof this.callback=="function")this.callback(t,this.dom);else if(t)throw t}addNode(t){const r=this.tagStack[this.tagStack.length-1],n=r.children[r.children.length-1];this.options.withStartIndices&&(t.startIndex=this.parser.startIndex),this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),r.children.push(t),n&&(t.prev=n,n.next=t),t.parent=r,this.lastNode=null}}const jt=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(e=>e.charCodeAt(0))),h0=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(e=>e.charCodeAt(0)));var Vi;const g0=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),hu=(Vi=String.fromCodePoint)!==null&&Vi!==void 0?Vi:function(e){let t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|e&1023),t+=String.fromCharCode(e),t};function E0(e){var t;return e>=55296&&e<=57343||e>1114111?65533:(t=g0.get(e))!==null&&t!==void 0?t:e}var gu;(function(e){e[e.NUM=35]="NUM",e[e.SEMI=59]="SEMI",e[e.ZERO=48]="ZERO",e[e.NINE=57]="NINE",e[e.LOWER_A=97]="LOWER_A",e[e.LOWER_F=102]="LOWER_F",e[e.LOWER_X=120]="LOWER_X",e[e.To_LOWER_BIT=32]="To_LOWER_BIT"})(gu||(gu={}));var Kt;(function(e){e[e.VALUE_LENGTH=49152]="VALUE_LENGTH",e[e.BRANCH_LENGTH=16256]="BRANCH_LENGTH",e[e.JUMP_TABLE=127]="JUMP_TABLE"})(Kt||(Kt={}));function al(e,t,r,n){const i=(t&Kt.BRANCH_LENGTH)>>7,y=t&Kt.JUMP_TABLE;if(i===0)return y!==0&&n===y?r:-1;if(y){const u=n-y;return u<0||u>=i?-1:e[r+u]-1}let M=r,C=M+i-1;for(;M<=C;){const u=M+C>>>1,R=e[u];if(R<n)M=u+1;else if(R>n)C=u-1;else return e[u+i]}return-1}const Eu=/["&'<>$\x80-\uFFFF]/g,m0=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]),v0=String.prototype.codePointAt!=null?(e,t)=>e.codePointAt(t):(e,t)=>(e.charCodeAt(t)&64512)===55296?(e.charCodeAt(t)-55296)*1024+e.charCodeAt(t+1)-56320+65536:e.charCodeAt(t);function ul(e){let t="",r=0,n;for(;(n=Eu.exec(e))!==null;){const i=n.index,y=e.charCodeAt(i),M=m0.get(y);M!==void 0?(t+=e.substring(r,i)+M,r=i+1):(t+=`${e.substring(r,i)}&#x${v0(e,i).toString(16)};`,r=Eu.lastIndex+=Number((y&64512)===55296))}return t+e.substr(r)}function ol(e,t){return function(n){let i,y=0,M="";for(;i=e.exec(n);)y!==i.index&&(M+=n.substring(y,i.index)),M+=t.get(i[0].charCodeAt(0)),y=i.index+1;return M+n.substring(y)}}const ll=ol(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),cl=ol(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]])),p0=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(e=>[e.toLowerCase(),e])),T0=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),_0=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function A0(e){return e.replace(/"/g,"&quot;")}function y0(e,t){var r;if(!e)return;const n=((r=t.encodeEntities)!==null&&r!==void 0?r:t.decodeEntities)===!1?A0:t.xmlMode||t.encodeEntities!=="utf8"?ul:ll;return Object.keys(e).map(i=>{var y,M;const C=(y=e[i])!==null&&y!==void 0?y:"";return t.xmlMode==="foreign"&&(i=(M=T0.get(i))!==null&&M!==void 0?M:i),!t.emptyAttrs&&!t.xmlMode&&C===""?i:`${i}="${n(C)}"`}).join(" ")}const mu=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function _i(e,t={}){const r="length"in e?e:[e];let n="";for(let i=0;i<r.length;i++)n+=b0(r[i],t);return n}function b0(e,t){switch(e.type){case n0:return _i(e.children,t);case f0:case s0:return C0(e);case a0:return R0(e);case c0:return D0(e);case u0:case o0:case l0:return x0(e,t);case i0:return L0(e,t)}}const S0=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),I0=new Set(["svg","math"]);function x0(e,t){var r;t.xmlMode==="foreign"&&(e.name=(r=p0.get(e.name))!==null&&r!==void 0?r:e.name,e.parent&&S0.has(e.parent.name)&&(t={...t,xmlMode:!1})),!t.xmlMode&&I0.has(e.name)&&(t={...t,xmlMode:"foreign"});let n=`<${e.name}`;const i=y0(e.attribs,t);return i&&(n+=` ${i}`),e.children.length===0&&(t.xmlMode?t.selfClosingTags!==!1:t.selfClosingTags&&mu.has(e.name))?(t.xmlMode||(n+=" "),n+="/>"):(n+=">",e.children.length>0&&(n+=_i(e.children,t)),(t.xmlMode||!mu.has(e.name))&&(n+=`</${e.name}>`)),n}function C0(e){return`<${e.data}>`}function L0(e,t){var r;let n=e.data||"";return((r=t.encodeEntities)!==null&&r!==void 0?r:t.decodeEntities)!==!1&&!(!t.xmlMode&&e.parent&&_0.has(e.parent.name))&&(n=t.xmlMode||t.encodeEntities!=="utf8"?ul(n):cl(n)),n}function D0(e){return`<![CDATA[${e.children[0].data}]]>`}function R0(e){return`<!--${e.data}-->`}function fl(e,t){return _i(e,t)}function O0(e,t){return je(e)?e.children.map(r=>fl(r,t)).join(""):""}function Yn(e){return Array.isArray(e)?e.map(Yn).join(""):be(e)?e.name==="br"?`
`:Yn(e.children):pi(e)?Yn(e.children):Nt(e)?e.data:""}function Br(e){return Array.isArray(e)?e.map(Br).join(""):je(e)&&!Ti(e)?Br(e.children):Nt(e)?e.data:""}function Jn(e){return Array.isArray(e)?e.map(Jn).join(""):je(e)&&(e.type===Re.Tag||pi(e))?Jn(e.children):Nt(e)?e.data:""}function Ai(e){return je(e)?e.children:[]}function dl(e){return e.parent||null}function hl(e){const t=dl(e);if(t!=null)return Ai(t);const r=[e];let{prev:n,next:i}=e;for(;n!=null;)r.unshift(n),{prev:n}=n;for(;i!=null;)r.push(i),{next:i}=i;return r}function P0(e,t){var r;return(r=e.attribs)===null||r===void 0?void 0:r[t]}function N0(e,t){return e.attribs!=null&&Object.prototype.hasOwnProperty.call(e.attribs,t)&&e.attribs[t]!=null}function M0(e){return e.name}function ra(e){let{next:t}=e;for(;t!==null&&!be(t);)({next:t}=t);return t}function na(e){let{prev:t}=e;for(;t!==null&&!be(t);)({prev:t}=t);return t}function vr(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){const t=e.parent.children;t.splice(t.lastIndexOf(e),1)}}function F0(e,t){const r=t.prev=e.prev;r&&(r.next=t);const n=t.next=e.next;n&&(n.prev=t);const i=t.parent=e.parent;if(i){const y=i.children;y[y.lastIndexOf(e)]=t,e.parent=null}}function k0(e,t){if(vr(t),t.next=null,t.parent=e,e.children.push(t)>1){const r=e.children[e.children.length-2];r.next=t,t.prev=r}else t.prev=null}function B0(e,t){vr(t);const{parent:r}=e,n=e.next;if(t.next=n,t.prev=e,e.next=t,t.parent=r,n){if(n.prev=t,r){const i=r.children;i.splice(i.lastIndexOf(n),0,t)}}else r&&r.children.push(t)}function U0(e,t){if(vr(t),t.parent=e,t.prev=null,e.children.unshift(t)!==1){const r=e.children[1];r.prev=t,t.next=r}else t.next=null}function w0(e,t){vr(t);const{parent:r}=e;if(r){const n=r.children;n.splice(n.indexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=r,t.prev=e.prev,t.next=e,e.prev=t}function yi(e,t,r=!0,n=1/0){return Array.isArray(t)||(t=[t]),bi(e,t,r,n)}function bi(e,t,r,n){const i=[];for(const y of t){if(e(y)&&(i.push(y),--n<=0))break;if(r&&je(y)&&y.children.length>0){const M=bi(e,y.children,r,n);if(i.push(...M),n-=M.length,n<=0)break}}return i}function H0(e,t){return t.find(e)}function ia(e,t,r=!0){let n=null;for(let i=0;i<t.length&&!n;i++){const y=t[i];if(be(y))e(y)?n=y:r&&y.children.length>0&&(n=ia(e,y.children,!0));else continue}return n}function gl(e,t){return t.some(r=>be(r)&&(e(r)||r.children.length>0&&gl(e,r.children)))}function K0(e,t){var r;const n=[],i=t.filter(be);let y;for(;y=i.shift();){const M=(r=y.children)===null||r===void 0?void 0:r.filter(be);M&&M.length>0&&i.unshift(...M),e(y)&&n.push(y)}return n}const Zn={tag_name(e){return typeof e=="function"?t=>be(t)&&e(t.name):e==="*"?be:t=>be(t)&&t.name===e},tag_type(e){return typeof e=="function"?t=>e(t.type):t=>t.type===e},tag_contains(e){return typeof e=="function"?t=>Nt(t)&&e(t.data):t=>Nt(t)&&t.data===e}};function El(e,t){return typeof t=="function"?r=>be(r)&&t(r.attribs[e]):r=>be(r)&&r.attribs[e]===t}function W0(e,t){return r=>e(r)||t(r)}function ml(e){const t=Object.keys(e).map(r=>{const n=e[r];return Object.prototype.hasOwnProperty.call(Zn,r)?Zn[r](n):El(r,n)});return t.length===0?null:t.reduce(W0)}function G0(e,t){const r=ml(e);return r?r(t):!0}function Y0(e,t,r,n=1/0){const i=ml(e);return i?yi(i,t,r,n):[]}function V0(e,t,r=!0){return Array.isArray(t)||(t=[t]),ia(El("id",e),t,r)}function Wr(e,t,r=!0,n=1/0){return yi(Zn.tag_name(e),t,r,n)}function j0(e,t,r=!0,n=1/0){return yi(Zn.tag_type(e),t,r,n)}function X0(e){let t=e.length;for(;--t>=0;){const r=e[t];if(t>0&&e.lastIndexOf(r,t-1)>=0){e.splice(t,1);continue}for(let n=r.parent;n;n=n.parent)if(e.includes(n)){e.splice(t,1);break}}return e}var Et;(function(e){e[e.DISCONNECTED=1]="DISCONNECTED",e[e.PRECEDING=2]="PRECEDING",e[e.FOLLOWING=4]="FOLLOWING",e[e.CONTAINS=8]="CONTAINS",e[e.CONTAINED_BY=16]="CONTAINED_BY"})(Et||(Et={}));function vl(e,t){const r=[],n=[];if(e===t)return 0;let i=je(e)?e:e.parent;for(;i;)r.unshift(i),i=i.parent;for(i=je(t)?t:t.parent;i;)n.unshift(i),i=i.parent;const y=Math.min(r.length,n.length);let M=0;for(;M<y&&r[M]===n[M];)M++;if(M===0)return Et.DISCONNECTED;const C=r[M-1],u=C.children,R=r[M],_=n[M];return u.indexOf(R)>u.indexOf(_)?C===t?Et.FOLLOWING|Et.CONTAINED_BY:Et.FOLLOWING:C===e?Et.PRECEDING|Et.CONTAINS:Et.PRECEDING}function Gr(e){return e=e.filter((t,r,n)=>!n.includes(t,r+1)),e.sort((t,r)=>{const n=vl(t,r);return n&Et.PRECEDING?-1:n&Et.FOLLOWING?1:0}),e}function Q0(e){const t=ei(Z0,e);return t?t.name==="feed"?$0(t):z0(t):null}function $0(e){var t;const r=e.children,n={type:"atom",items:Wr("entry",r).map(M=>{var C;const{children:u}=M,R={media:pl(u)};st(R,"id","id",u),st(R,"title","title",u);const _=(C=ei("link",u))===null||C===void 0?void 0:C.attribs.href;_&&(R.link=_);const U=cr("summary",u)||cr("content",u);U&&(R.description=U);const D=cr("updated",u);return D&&(R.pubDate=new Date(D)),R})};st(n,"id","id",r),st(n,"title","title",r);const i=(t=ei("link",r))===null||t===void 0?void 0:t.attribs.href;i&&(n.link=i),st(n,"description","subtitle",r);const y=cr("updated",r);return y&&(n.updated=new Date(y)),st(n,"author","email",r,!0),n}function z0(e){var t,r;const n=(r=(t=ei("channel",e.children))===null||t===void 0?void 0:t.children)!==null&&r!==void 0?r:[],i={type:e.name.substr(0,3),id:"",items:Wr("item",e.children).map(M=>{const{children:C}=M,u={media:pl(C)};st(u,"id","guid",C),st(u,"title","title",C),st(u,"link","link",C),st(u,"description","description",C);const R=cr("pubDate",C);return R&&(u.pubDate=new Date(R)),u})};st(i,"title","title",n),st(i,"link","link",n),st(i,"description","description",n);const y=cr("lastBuildDate",n);return y&&(i.updated=new Date(y)),st(i,"author","managingEditor",n,!0),i}const q0=["url","type","lang"],J0=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function pl(e){return Wr("media:content",e).map(t=>{const{attribs:r}=t,n={medium:r.medium,isDefault:!!r.isDefault};for(const i of q0)r[i]&&(n[i]=r[i]);for(const i of J0)r[i]&&(n[i]=parseInt(r[i],10));return r.expression&&(n.expression=r.expression),n})}function ei(e,t){return Wr(e,t,!0,1)[0]}function cr(e,t,r=!1){return Br(Wr(e,t,r,1)).trim()}function st(e,t,r,n,i=!1){const y=cr(r,n,i);y&&(e[t]=y)}function Z0(e){return e==="rss"||e==="feed"||e==="rdf:RDF"}const Si=Object.freeze(Object.defineProperty({__proto__:null,get DocumentPosition(){return Et},append:B0,appendChild:k0,compareDocumentPosition:vl,existsOne:gl,filter:yi,find:bi,findAll:K0,findOne:ia,findOneChild:H0,getAttributeValue:P0,getChildren:Ai,getElementById:V0,getElements:Y0,getElementsByTagName:Wr,getElementsByTagType:j0,getFeed:Q0,getInnerHTML:O0,getName:M0,getOuterHTML:fl,getParent:dl,getSiblings:hl,getText:Yn,hasAttrib:N0,hasChildren:je,innerText:Jn,isCDATA:pi,isComment:Ti,isDocument:mr,isTag:be,isText:Nt,nextElementSibling:ra,prepend:w0,prependChild:U0,prevElementSibling:na,removeElement:vr,removeSubsets:X0,replaceElement:F0,testElement:G0,textContent:Br,uniqueSort:Gr},Symbol.toStringTag,{value:"Module"}));function Tl(e,t,r){return e?e(t??e._root.children,null,void 0,r).toString():""}function eg(e,t){return!t&&typeof e=="object"&&e!=null&&!("length"in e)&&!("type"in e)}function tg(e,t){const r=eg(e)?(t=e,void 0):e,n={...zs,...this===null||this===void 0?void 0:this._options,...ms(t??{})};return Tl(this,r,n)}function rg(e){const t={...this._options,xmlMode:!0};return Tl(this,e,t)}function pn(e){const t=e||(this?this.root():[]);let r="";for(let n=0;n<t.length;n++)r+=Br(t[n]);return r}function ng(e,t,r=typeof t=="boolean"?t:!1){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(r=t);const n=this.load(e,zs,!1);return r||n("script").remove(),n.root()[0].children.slice()}function ig(){return this(this._root)}function _l(e,t){if(t===e)return!1;let r=t;for(;r&&r!==r.parent;)if(r=r.parent,r===e)return!0;return!1}function sg(e,t){if(!vu(e)||!vu(t))return;let r=e.length;const n=+t.length;for(let i=0;i<n;i++)e[r++]=t[i];return e.length=r,e}function vu(e){if(Array.isArray(e))return!0;if(typeof e!="object"||!Object.prototype.hasOwnProperty.call(e,"length")||typeof e.length!="number"||e.length<0)return!1;for(let t=0;t<e.length;t++)if(!(t in e))return!1;return!0}const ag=Object.freeze(Object.defineProperty({__proto__:null,contains:_l,html:tg,merge:sg,parseHTML:ng,root:ig,text:pn,xml:rg},Symbol.toStringTag,{value:"Module"}));function Mt(e){return e.cheerio!=null}function ug(e){return e.replace(/[_.-](\w|$)/g,(t,r)=>r.toUpperCase())}function og(e){return e.replace(/[A-Z]/g,"-$&").toLowerCase()}function Ke(e,t){const r=e.length;for(let n=0;n<r;n++)t(e[n],n);return e}function ps(e){const t="length"in e?Array.prototype.map.call(e,n=>qn(n,!0)):[qn(e,!0)],r=new gr(t);return t.forEach(n=>{n.parent=r}),t}var or;(function(e){e[e.LowerA=97]="LowerA",e[e.LowerZ=122]="LowerZ",e[e.UpperA=65]="UpperA",e[e.UpperZ=90]="UpperZ",e[e.Exclamation=33]="Exclamation"})(or||(or={}));function Ts(e){const t=e.indexOf("<");if(t<0||t>e.length-3)return!1;const r=e.charCodeAt(t+1);return(r>=or.LowerA&&r<=or.LowerZ||r>=or.UpperA&&r<=or.UpperZ||r===or.Exclamation)&&e.includes(">",t+2)}const Rr=Object.prototype.hasOwnProperty,Tn=/\s+/,ji="data-",pu={null:null,true:!0,false:!1},sa=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,lg=/^{[^]*}$|^\[[^]*]$/;function ti(e,t,r){var n;if(!(!e||!be(e))){if((n=e.attribs)!==null&&n!==void 0||(e.attribs={}),!t)return e.attribs;if(Rr.call(e.attribs,t))return!r&&sa.test(t)?t:e.attribs[t];if(e.name==="option"&&t==="value")return pn(e.children);if(e.name==="input"&&(e.attribs.type==="radio"||e.attribs.type==="checkbox")&&t==="value")return"on"}}function Or(e,t,r){r===null?Al(e,t):e.attribs[t]=`${r}`}function cg(e,t){if(typeof e=="object"||t!==void 0){if(typeof t=="function"){if(typeof e!="string")throw new Error("Bad combination of arguments.");return Ke(this,(r,n)=>{be(r)&&Or(r,e,t.call(r,n,r.attribs[e]))})}return Ke(this,r=>{be(r)&&(typeof e=="object"?Object.keys(e).forEach(n=>{const i=e[n];Or(r,n,i)}):Or(r,e,t))})}return arguments.length>1?this:ti(this[0],e,this.options.xmlMode)}function Tu(e,t,r){return t in e?e[t]:!r&&sa.test(t)?ti(e,t,!1)!==void 0:ti(e,t,r)}function Xi(e,t,r,n){t in e?e[t]=r:Or(e,t,!n&&sa.test(t)?r?"":null:`${r}`)}function fg(e,t){var r;if(typeof e=="string"&&t===void 0){const n=this[0];if(!n||!be(n))return;switch(e){case"style":{const i=this.css(),y=Object.keys(i);return y.forEach((M,C)=>{i[C]=M}),i.length=y.length,i}case"tagName":case"nodeName":return n.name.toUpperCase();case"href":case"src":{const i=(r=n.attribs)===null||r===void 0?void 0:r[e];return typeof URL<"u"&&(e==="href"&&(n.tagName==="a"||n.name==="link")||e==="src"&&(n.tagName==="img"||n.tagName==="iframe"||n.tagName==="audio"||n.tagName==="video"||n.tagName==="source"))&&i!==void 0&&this.options.baseURI?new URL(i,this.options.baseURI).href:i}case"innerText":return Jn(n);case"textContent":return Br(n);case"outerHTML":return this.clone().wrap("<container />").parent().html();case"innerHTML":return this.html();default:return Tu(n,e,this.options.xmlMode)}}if(typeof e=="object"||t!==void 0){if(typeof t=="function"){if(typeof e=="object")throw new Error("Bad combination of arguments.");return Ke(this,(n,i)=>{be(n)&&Xi(n,e,t.call(n,i,Tu(n,e,this.options.xmlMode)),this.options.xmlMode)})}return Ke(this,n=>{be(n)&&(typeof e=="object"?Object.keys(e).forEach(i=>{const y=e[i];Xi(n,i,y,this.options.xmlMode)}):Xi(n,e,t,this.options.xmlMode))})}}function _u(e,t,r){var n;const i=e;(n=i.data)!==null&&n!==void 0||(i.data={}),typeof t=="object"?Object.assign(i.data,t):typeof t=="string"&&r!==void 0&&(i.data[t]=r)}function Au(e,t){let r,n,i;t==null?(r=Object.keys(e.attribs).filter(y=>y.startsWith(ji)),n=r.map(y=>ug(y.slice(ji.length)))):(r=[ji+og(t)],n=[t]);for(let y=0;y<r.length;++y){const M=r[y],C=n[y];if(Rr.call(e.attribs,M)&&!Rr.call(e.data,C)){if(i=e.attribs[M],Rr.call(pu,i))i=pu[i];else if(i===String(Number(i)))i=Number(i);else if(lg.test(i))try{i=JSON.parse(i)}catch{}e.data[C]=i}}return t==null?e.data:i}function dg(e,t){var r;const n=this[0];if(!n||!be(n))return;const i=n;return(r=i.data)!==null&&r!==void 0||(i.data={}),e?typeof e=="object"||t!==void 0?(Ke(this,y=>{be(y)&&(typeof e=="object"?_u(y,e):_u(y,e,t))}),this):Rr.call(i.data,e)?i.data[e]:Au(i,e):Au(i)}function hg(e){const t=arguments.length===0,r=this[0];if(!r||!be(r))return t?void 0:this;switch(r.name){case"textarea":return this.text(e);case"select":{const n=this.find("option:selected");if(!t){if(this.attr("multiple")==null&&typeof e=="object")return this;this.find("option").removeAttr("selected");const i=typeof e!="object"?[e]:e;for(let y=0;y<i.length;y++)this.find(`option[value="${i[y]}"]`).attr("selected","");return this}return this.attr("multiple")?n.toArray().map(i=>pn(i.children)):n.attr("value")}case"input":case"option":return t?this.attr("value"):this.attr("value",e)}}function Al(e,t){!e.attribs||!Rr.call(e.attribs,t)||delete e.attribs[t]}function ri(e){return e?e.trim().split(Tn):[]}function gg(e){const t=ri(e);for(let r=0;r<t.length;r++)Ke(this,n=>{be(n)&&Al(n,t[r])});return this}function Eg(e){return this.toArray().some(t=>{const r=be(t)&&t.attribs.class;let n=-1;if(r&&e.length)for(;(n=r.indexOf(e,n+1))>-1;){const i=n+e.length;if((n===0||Tn.test(r[n-1]))&&(i===r.length||Tn.test(r[i])))return!0}return!1})}function yl(e){if(typeof e=="function")return Ke(this,(n,i)=>{if(be(n)){const y=n.attribs.class||"";yl.call([n],e.call(n,i,y))}});if(!e||typeof e!="string")return this;const t=e.split(Tn),r=this.length;for(let n=0;n<r;n++){const i=this[n];if(!be(i))continue;const y=ti(i,"class",!1);if(!y)Or(i,"class",t.join(" ").trim());else{let M=` ${y} `;for(let C=0;C<t.length;C++){const u=`${t[C]} `;M.includes(` ${u}`)||(M+=u)}Or(i,"class",M.trim())}}return this}function bl(e){if(typeof e=="function")return Ke(this,(i,y)=>{be(i)&&bl.call([i],e.call(i,y,i.attribs.class||""))});const t=ri(e),r=t.length,n=arguments.length===0;return Ke(this,i=>{if(be(i))if(n)i.attribs.class="";else{const y=ri(i.attribs.class);let M=!1;for(let C=0;C<r;C++){const u=y.indexOf(t[C]);u>=0&&(y.splice(u,1),M=!0,C--)}M&&(i.attribs.class=y.join(" "))}})}function Sl(e,t){if(typeof e=="function")return Ke(this,(M,C)=>{be(M)&&Sl.call([M],e.call(M,C,M.attribs.class||"",t),t)});if(!e||typeof e!="string")return this;const r=e.split(Tn),n=r.length,i=typeof t=="boolean"?t?1:-1:0,y=this.length;for(let M=0;M<y;M++){const C=this[M];if(!be(C))continue;const u=ri(C.attribs.class);for(let R=0;R<n;R++){const _=u.indexOf(r[R]);i>=0&&_<0?u.push(r[R]):i<=0&&_>=0&&u.splice(_,1)}C.attribs.class=u.join(" ")}return this}const mg=Object.freeze(Object.defineProperty({__proto__:null,addClass:yl,attr:cg,data:dg,hasClass:Eg,prop:fg,removeAttr:gg,removeClass:bl,toggleClass:Sl,val:hg},Symbol.toStringTag,{value:"Module"}));var Ae;(function(e){e.Attribute="attribute",e.Pseudo="pseudo",e.PseudoElement="pseudo-element",e.Tag="tag",e.Universal="universal",e.Adjacent="adjacent",e.Child="child",e.Descendant="descendant",e.Parent="parent",e.Sibling="sibling",e.ColumnCombinator="column-combinator"})(Ae||(Ae={}));var Ye;(function(e){e.Any="any",e.Element="element",e.End="end",e.Equals="equals",e.Exists="exists",e.Hyphen="hyphen",e.Not="not",e.Start="start"})(Ye||(Ye={}));const yu=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,vg=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,pg=new Map([[126,Ye.Element],[94,Ye.Start],[36,Ye.End],[42,Ye.Any],[33,Ye.Not],[124,Ye.Hyphen]]),Tg=new Set(["has","not","matches","is","where","host","host-context"]);function rn(e){switch(e.type){case Ae.Adjacent:case Ae.Child:case Ae.Descendant:case Ae.Parent:case Ae.Sibling:case Ae.ColumnCombinator:return!0;default:return!1}}const _g=new Set(["contains","icontains"]);function Ag(e,t,r){const n=parseInt(t,16)-65536;return n!==n||r?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)}function Xr(e){return e.replace(vg,Ag)}function Qi(e){return e===39||e===34}function bu(e){return e===32||e===9||e===10||e===12||e===13}function Ii(e){const t=[],r=Il(t,`${e}`,0);if(r<e.length)throw new Error(`Unmatched selector: ${e.slice(r)}`);return t}function Il(e,t,r){let n=[];function i(D){const K=t.slice(r+D).match(yu);if(!K)throw new Error(`Expected name, found ${t.slice(r)}`);const[k]=K;return r+=D+k.length,Xr(k)}function y(D){for(r+=D;r<t.length&&bu(t.charCodeAt(r));)r++}function M(){r+=1;const D=r;let K=1;for(;K>0&&r<t.length;r++)t.charCodeAt(r)===40&&!C(r)?K++:t.charCodeAt(r)===41&&!C(r)&&K--;if(K)throw new Error("Parenthesis not matched");return Xr(t.slice(D,r-1))}function C(D){let K=0;for(;t.charCodeAt(--D)===92;)K++;return(K&1)===1}function u(){if(n.length>0&&rn(n[n.length-1]))throw new Error("Did not expect successive traversals.")}function R(D){if(n.length>0&&n[n.length-1].type===Ae.Descendant){n[n.length-1].type=D;return}u(),n.push({type:D})}function _(D,K){n.push({type:Ae.Attribute,name:D,action:K,value:i(1),namespace:null,ignoreCase:"quirks"})}function U(){if(n.length&&n[n.length-1].type===Ae.Descendant&&n.pop(),n.length===0)throw new Error("Empty sub-selector");e.push(n)}if(y(0),t.length===r)return r;e:for(;r<t.length;){const D=t.charCodeAt(r);switch(D){case 32:case 9:case 10:case 12:case 13:{(n.length===0||n[0].type!==Ae.Descendant)&&(u(),n.push({type:Ae.Descendant})),y(1);break}case 62:{R(Ae.Child),y(1);break}case 60:{R(Ae.Parent),y(1);break}case 126:{R(Ae.Sibling),y(1);break}case 43:{R(Ae.Adjacent),y(1);break}case 46:{_("class",Ye.Element);break}case 35:{_("id",Ye.Equals);break}case 91:{y(1);let K,k=null;t.charCodeAt(r)===124?K=i(1):t.startsWith("*|",r)?(k="*",K=i(2)):(K=i(0),t.charCodeAt(r)===124&&t.charCodeAt(r+1)!==61&&(k=K,K=i(1))),y(0);let F=Ye.Exists;const B=pg.get(t.charCodeAt(r));if(B){if(F=B,t.charCodeAt(r+1)!==61)throw new Error("Expected `=`");y(2)}else t.charCodeAt(r)===61&&(F=Ye.Equals,y(1));let O="",P=null;if(F!=="exists"){if(Qi(t.charCodeAt(r))){const S=t.charCodeAt(r);let f=r+1;for(;f<t.length&&(t.charCodeAt(f)!==S||C(f));)f+=1;if(t.charCodeAt(f)!==S)throw new Error("Attribute value didn't end");O=Xr(t.slice(r+1,f)),r=f+1}else{const S=r;for(;r<t.length&&(!bu(t.charCodeAt(r))&&t.charCodeAt(r)!==93||C(r));)r+=1;O=Xr(t.slice(S,r))}y(0);const N=t.charCodeAt(r)|32;N===115?(P=!1,y(1)):N===105&&(P=!0,y(1))}if(t.charCodeAt(r)!==93)throw new Error("Attribute selector didn't terminate");r+=1;const g={type:Ae.Attribute,name:K,action:F,value:O,namespace:k,ignoreCase:P};n.push(g);break}case 58:{if(t.charCodeAt(r+1)===58){n.push({type:Ae.PseudoElement,name:i(2).toLowerCase(),data:t.charCodeAt(r)===40?M():null});continue}const K=i(1).toLowerCase();let k=null;if(t.charCodeAt(r)===40)if(Tg.has(K)){if(Qi(t.charCodeAt(r+1)))throw new Error(`Pseudo-selector ${K} cannot be quoted`);if(k=[],r=Il(k,t,r+1),t.charCodeAt(r)!==41)throw new Error(`Missing closing parenthesis in :${K} (${t})`);r+=1}else{if(k=M(),_g.has(K)){const F=k.charCodeAt(0);F===k.charCodeAt(k.length-1)&&Qi(F)&&(k=k.slice(1,-1))}k=Xr(k)}n.push({type:Ae.Pseudo,name:K,data:k});break}case 44:{U(),n=[],y(1);break}default:{if(t.startsWith("/*",r)){const F=t.indexOf("*/",r+2);if(F<0)throw new Error("Comment was not terminated");r=F+2,n.length===0&&y(0);break}let K=null,k;if(D===42)r+=1,k="*";else if(D===124){if(k="",t.charCodeAt(r+1)===124){R(Ae.ColumnCombinator),y(2);break}}else if(yu.test(t.slice(r)))k=i(0);else break e;t.charCodeAt(r)===124&&t.charCodeAt(r+1)!==124&&(K=k,t.charCodeAt(r+1)===42?(k="*",r+=2):k=i(1)),n.push(k==="*"?{type:Ae.Universal,namespace:K}:{type:Ae.Tag,name:k,namespace:K})}}}return U(),r}var yg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bg(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ie={trueFunc:function(){return!0},falseFunc:function(){return!1}};const xl=new Map([[Ae.Universal,50],[Ae.Tag,30],[Ae.Attribute,1],[Ae.Pseudo,0]]);function aa(e){return!xl.has(e.type)}const Sg=new Map([[Ye.Exists,10],[Ye.Equals,8],[Ye.Not,7],[Ye.Start,6],[Ye.End,6],[Ye.Any,5]]);function Ig(e){const t=e.map(Cl);for(let r=1;r<e.length;r++){const n=t[r];if(!(n<0))for(let i=r-1;i>=0&&n<t[i];i--){const y=e[i+1];e[i+1]=e[i],e[i]=y,t[i+1]=t[i],t[i]=n}}}function Cl(e){var t,r;let n=(t=xl.get(e.type))!==null&&t!==void 0?t:-1;return e.type===Ae.Attribute?(n=(r=Sg.get(e.action))!==null&&r!==void 0?r:4,e.action===Ye.Equals&&e.name==="id"&&(n=9),e.ignoreCase&&(n>>=1)):e.type===Ae.Pseudo&&(e.data?e.name==="has"||e.name==="contains"?n=0:Array.isArray(e.data)?(n=Math.min(...e.data.map(i=>Math.min(...i.map(Cl)))),n<0&&(n=0)):n=2:n=3),n}const xg=/[-[\]{}()*+?.,\\^$|#\s]/g;function Su(e){return e.replace(xg,"\\$&")}const Cg=new Set(["accept","accept-charset","align","alink","axis","bgcolor","charset","checked","clear","codetype","color","compact","declare","defer","dir","direction","disabled","enctype","face","frame","hreflang","http-equiv","lang","language","link","media","method","multiple","nohref","noresize","noshade","nowrap","readonly","rel","rev","rules","scope","scrolling","selected","shape","target","text","type","valign","valuetype","vlink"]);function ir(e,t){return typeof e.ignoreCase=="boolean"?e.ignoreCase:e.ignoreCase==="quirks"?!!t.quirksMode:!t.xmlMode&&Cg.has(e.name)}const Lg={equals(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:y}=t;return ir(t,r)?(y=y.toLowerCase(),M=>{const C=n.getAttributeValue(M,i);return C!=null&&C.length===y.length&&C.toLowerCase()===y&&e(M)}):M=>n.getAttributeValue(M,i)===y&&e(M)},hyphen(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:y}=t;const M=y.length;return ir(t,r)?(y=y.toLowerCase(),function(u){const R=n.getAttributeValue(u,i);return R!=null&&(R.length===M||R.charAt(M)==="-")&&R.substr(0,M).toLowerCase()===y&&e(u)}):function(u){const R=n.getAttributeValue(u,i);return R!=null&&(R.length===M||R.charAt(M)==="-")&&R.substr(0,M)===y&&e(u)}},element(e,t,r){const{adapter:n}=r,{name:i,value:y}=t;if(/\s/.test(y))return Ie.falseFunc;const M=new RegExp(`(?:^|\\s)${Su(y)}(?:$|\\s)`,ir(t,r)?"i":"");return function(u){const R=n.getAttributeValue(u,i);return R!=null&&R.length>=y.length&&M.test(R)&&e(u)}},exists(e,{name:t},{adapter:r}){return n=>r.hasAttrib(n,t)&&e(n)},start(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:y}=t;const M=y.length;return M===0?Ie.falseFunc:ir(t,r)?(y=y.toLowerCase(),C=>{const u=n.getAttributeValue(C,i);return u!=null&&u.length>=M&&u.substr(0,M).toLowerCase()===y&&e(C)}):C=>{var u;return!!(!((u=n.getAttributeValue(C,i))===null||u===void 0)&&u.startsWith(y))&&e(C)}},end(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:y}=t;const M=-y.length;return M===0?Ie.falseFunc:ir(t,r)?(y=y.toLowerCase(),C=>{var u;return((u=n.getAttributeValue(C,i))===null||u===void 0?void 0:u.substr(M).toLowerCase())===y&&e(C)}):C=>{var u;return!!(!((u=n.getAttributeValue(C,i))===null||u===void 0)&&u.endsWith(y))&&e(C)}},any(e,t,r){const{adapter:n}=r,{name:i,value:y}=t;if(y==="")return Ie.falseFunc;if(ir(t,r)){const M=new RegExp(Su(y),"i");return function(u){const R=n.getAttributeValue(u,i);return R!=null&&R.length>=y.length&&M.test(R)&&e(u)}}return M=>{var C;return!!(!((C=n.getAttributeValue(M,i))===null||C===void 0)&&C.includes(y))&&e(M)}},not(e,t,r){const{adapter:n}=r,{name:i}=t;let{value:y}=t;return y===""?M=>!!n.getAttributeValue(M,i)&&e(M):ir(t,r)?(y=y.toLowerCase(),M=>{const C=n.getAttributeValue(M,i);return(C==null||C.length!==y.length||C.toLowerCase()!==y)&&e(M)}):M=>n.getAttributeValue(M,i)!==y&&e(M)}},Dg=new Set([9,10,12,13,32]),Iu="0".charCodeAt(0),Rg="9".charCodeAt(0);function Og(e){if(e=e.trim().toLowerCase(),e==="even")return[2,0];if(e==="odd")return[2,1];let t=0,r=0,n=y(),i=M();if(t<e.length&&e.charAt(t)==="n"&&(t++,r=n*(i??1),C(),t<e.length?(n=y(),C(),i=M()):n=i=0),i===null||t<e.length)throw new Error(`n-th rule couldn't be parsed ('${e}')`);return[r,n*i];function y(){return e.charAt(t)==="-"?(t++,-1):(e.charAt(t)==="+"&&t++,1)}function M(){const u=t;let R=0;for(;t<e.length&&e.charCodeAt(t)>=Iu&&e.charCodeAt(t)<=Rg;)R=R*10+(e.charCodeAt(t)-Iu),t++;return t===u?null:R}function C(){for(;t<e.length&&Dg.has(e.charCodeAt(t));)t++}}function Pg(e){const t=e[0],r=e[1]-1;if(r<0&&t<=0)return Ie.falseFunc;if(t===-1)return y=>y<=r;if(t===0)return y=>y===r;if(t===1)return r<0?Ie.trueFunc:y=>y>=r;const n=Math.abs(t),i=(r%n+n)%n;return t>1?y=>y>=r&&y%n===i:y=>y<=r&&y%n===i}function Mn(e){return Pg(Og(e))}function Fn(e,t){return r=>{const n=t.getParent(r);return n!=null&&t.isTag(n)&&e(r)}}const _s={contains(e,t,{adapter:r}){return function(i){return e(i)&&r.getText(i).includes(t)}},icontains(e,t,{adapter:r}){const n=t.toLowerCase();return function(y){return e(y)&&r.getText(y).toLowerCase().includes(n)}},"nth-child"(e,t,{adapter:r,equals:n}){const i=Mn(t);return i===Ie.falseFunc?Ie.falseFunc:i===Ie.trueFunc?Fn(e,r):function(M){const C=r.getSiblings(M);let u=0;for(let R=0;R<C.length&&!n(M,C[R]);R++)r.isTag(C[R])&&u++;return i(u)&&e(M)}},"nth-last-child"(e,t,{adapter:r,equals:n}){const i=Mn(t);return i===Ie.falseFunc?Ie.falseFunc:i===Ie.trueFunc?Fn(e,r):function(M){const C=r.getSiblings(M);let u=0;for(let R=C.length-1;R>=0&&!n(M,C[R]);R--)r.isTag(C[R])&&u++;return i(u)&&e(M)}},"nth-of-type"(e,t,{adapter:r,equals:n}){const i=Mn(t);return i===Ie.falseFunc?Ie.falseFunc:i===Ie.trueFunc?Fn(e,r):function(M){const C=r.getSiblings(M);let u=0;for(let R=0;R<C.length;R++){const _=C[R];if(n(M,_))break;r.isTag(_)&&r.getName(_)===r.getName(M)&&u++}return i(u)&&e(M)}},"nth-last-of-type"(e,t,{adapter:r,equals:n}){const i=Mn(t);return i===Ie.falseFunc?Ie.falseFunc:i===Ie.trueFunc?Fn(e,r):function(M){const C=r.getSiblings(M);let u=0;for(let R=C.length-1;R>=0;R--){const _=C[R];if(n(M,_))break;r.isTag(_)&&r.getName(_)===r.getName(M)&&u++}return i(u)&&e(M)}},root(e,t,{adapter:r}){return n=>{const i=r.getParent(n);return(i==null||!r.isTag(i))&&e(n)}},scope(e,t,r,n){const{equals:i}=r;return!n||n.length===0?_s.root(e,t,r):n.length===1?y=>i(n[0],y)&&e(y):y=>n.includes(y)&&e(y)},hover:$i("isHovered"),visited:$i("isVisited"),active:$i("isActive")};function $i(e){return function(r,n,{adapter:i}){const y=i[e];return typeof y!="function"?Ie.falseFunc:function(C){return y(C)&&r(C)}}}const xu={empty(e,{adapter:t}){return!t.getChildren(e).some(r=>t.isTag(r)||t.getText(r)!=="")},"first-child"(e,{adapter:t,equals:r}){if(t.prevElementSibling)return t.prevElementSibling(e)==null;const n=t.getSiblings(e).find(i=>t.isTag(i));return n!=null&&r(e,n)},"last-child"(e,{adapter:t,equals:r}){const n=t.getSiblings(e);for(let i=n.length-1;i>=0;i--){if(r(e,n[i]))return!0;if(t.isTag(n[i]))break}return!1},"first-of-type"(e,{adapter:t,equals:r}){const n=t.getSiblings(e),i=t.getName(e);for(let y=0;y<n.length;y++){const M=n[y];if(r(e,M))return!0;if(t.isTag(M)&&t.getName(M)===i)break}return!1},"last-of-type"(e,{adapter:t,equals:r}){const n=t.getSiblings(e),i=t.getName(e);for(let y=n.length-1;y>=0;y--){const M=n[y];if(r(e,M))return!0;if(t.isTag(M)&&t.getName(M)===i)break}return!1},"only-of-type"(e,{adapter:t,equals:r}){const n=t.getName(e);return t.getSiblings(e).every(i=>r(e,i)||!t.isTag(i)||t.getName(i)!==n)},"only-child"(e,{adapter:t,equals:r}){return t.getSiblings(e).every(n=>r(e,n)||!t.isTag(n))}};function Cu(e,t,r,n){if(r===null){if(e.length>n)throw new Error(`Pseudo-class :${t} requires an argument`)}else if(e.length===n)throw new Error(`Pseudo-class :${t} doesn't have any arguments`)}const Ng={"any-link":":is(a, area, link)[href]",link:":any-link:not(:visited)",disabled:`:is(
        :is(button, input, select, textarea, optgroup, option)[disabled],
        optgroup[disabled] > option,
        fieldset[disabled]:not(fieldset[disabled] legend:first-of-type *)
    )`,enabled:":not(:disabled)",checked:":is(:is(input[type=radio], input[type=checkbox])[checked], option:selected)",required:":is(input, select, textarea)[required]",optional:":is(input, select, textarea):not([required])",selected:"option:is([selected], select:not([multiple]):not(:has(> option[selected])) > :first-of-type)",checkbox:"[type=checkbox]",file:"[type=file]",password:"[type=password]",radio:"[type=radio]",reset:"[type=reset]",image:"[type=image]",submit:"[type=submit]",parent:":not(:empty)",header:":is(h1, h2, h3, h4, h5, h6)",button:":is(button, input[type=button])",input:":is(input, textarea, select, button)",text:"input:is(:not([type!='']), [type=text])"},Ll={};function Mg(e,t){return e===Ie.falseFunc?Ie.falseFunc:r=>t.isTag(r)&&e(r)}function Dl(e,t){const r=t.getSiblings(e);if(r.length<=1)return[];const n=r.indexOf(e);return n<0||n===r.length-1?[]:r.slice(n+1).filter(t.isTag)}function As(e){return{xmlMode:!!e.xmlMode,lowerCaseAttributeNames:!!e.lowerCaseAttributeNames,lowerCaseTags:!!e.lowerCaseTags,quirksMode:!!e.quirksMode,cacheResults:!!e.cacheResults,pseudos:e.pseudos,adapter:e.adapter,equals:e.equals}}const zi=(e,t,r,n,i)=>{const y=i(t,As(r),n);return y===Ie.trueFunc?e:y===Ie.falseFunc?Ie.falseFunc:M=>y(M)&&e(M)},qi={is:zi,matches:zi,where:zi,not(e,t,r,n,i){const y=i(t,As(r),n);return y===Ie.falseFunc?e:y===Ie.trueFunc?Ie.falseFunc:M=>!y(M)&&e(M)},has(e,t,r,n,i){const{adapter:y}=r,M=As(r);M.relativeSelector=!0;const C=t.some(_=>_.some(aa))?[Ll]:void 0,u=i(t,M,C);if(u===Ie.falseFunc)return Ie.falseFunc;const R=Mg(u,y);if(C&&u!==Ie.trueFunc){const{shouldTestNextSiblings:_=!1}=u;return U=>{if(!e(U))return!1;C[0]=U;const D=y.getChildren(U),K=_?[...D,...Dl(U,y)]:D;return y.existsOne(R,K)}}return _=>e(_)&&y.existsOne(R,y.getChildren(_))}};function Fg(e,t,r,n,i){var y;const{name:M,data:C}=t;if(Array.isArray(C)){if(!(M in qi))throw new Error(`Unknown pseudo-class :${M}(${C})`);return qi[M](e,C,r,n,i)}const u=(y=r.pseudos)===null||y===void 0?void 0:y[M],R=typeof u=="string"?u:Ng[M];if(typeof R=="string"){if(C!=null)throw new Error(`Pseudo ${M} doesn't have any arguments`);const _=Ii(R);return qi.is(e,_,r,n,i)}if(typeof u=="function")return Cu(u,M,C,1),_=>u(_,C)&&e(_);if(M in _s)return _s[M](e,C,r,n);if(M in xu){const _=xu[M];return Cu(_,M,C,2),U=>_(U,r,C)&&e(U)}throw new Error(`Unknown pseudo-class :${M}`)}function Ji(e,t){const r=t.getParent(e);return r&&t.isTag(r)?r:null}function kg(e,t,r,n,i){const{adapter:y,equals:M}=r;switch(t.type){case Ae.PseudoElement:throw new Error("Pseudo-elements are not supported by css-select");case Ae.ColumnCombinator:throw new Error("Column combinators are not yet supported by css-select");case Ae.Attribute:{if(t.namespace!=null)throw new Error("Namespaced attributes are not yet supported by css-select");return(!r.xmlMode||r.lowerCaseAttributeNames)&&(t.name=t.name.toLowerCase()),Lg[t.action](e,t,r)}case Ae.Pseudo:return Fg(e,t,r,n,i);case Ae.Tag:{if(t.namespace!=null)throw new Error("Namespaced tag names are not yet supported by css-select");let{name:C}=t;return(!r.xmlMode||r.lowerCaseTags)&&(C=C.toLowerCase()),function(R){return y.getName(R)===C&&e(R)}}case Ae.Descendant:{if(r.cacheResults===!1||typeof WeakSet>"u")return function(R){let _=R;for(;_=Ji(_,y);)if(e(_))return!0;return!1};const C=new WeakSet;return function(R){let _=R;for(;_=Ji(_,y);)if(!C.has(_)){if(y.isTag(_)&&e(_))return!0;C.add(_)}return!1}}case"_flexibleDescendant":return function(u){let R=u;do if(e(R))return!0;while(R=Ji(R,y));return!1};case Ae.Parent:return function(u){return y.getChildren(u).some(R=>y.isTag(R)&&e(R))};case Ae.Child:return function(u){const R=y.getParent(u);return R!=null&&y.isTag(R)&&e(R)};case Ae.Sibling:return function(u){const R=y.getSiblings(u);for(let _=0;_<R.length;_++){const U=R[_];if(M(u,U))break;if(y.isTag(U)&&e(U))return!0}return!1};case Ae.Adjacent:return y.prevElementSibling?function(u){const R=y.prevElementSibling(u);return R!=null&&e(R)}:function(u){const R=y.getSiblings(u);let _;for(let U=0;U<R.length;U++){const D=R[U];if(M(u,D))break;y.isTag(D)&&(_=D)}return!!_&&e(_)};case Ae.Universal:{if(t.namespace!=null&&t.namespace!=="*")throw new Error("Namespaced universal selectors are not yet supported by css-select");return e}}}function Rl(e){return e.type===Ae.Pseudo&&(e.name==="scope"||Array.isArray(e.data)&&e.data.some(t=>t.some(Rl)))}const Bg={type:Ae.Descendant},Ug={type:"_flexibleDescendant"},wg={type:Ae.Pseudo,name:"scope",data:null};function Hg(e,{adapter:t},r){const n=!!(r!=null&&r.every(i=>{const y=t.isTag(i)&&t.getParent(i);return i===Ll||y&&t.isTag(y)}));for(const i of e){if(!(i.length>0&&aa(i[0])&&i[0].type!==Ae.Descendant))if(n&&!i.some(Rl))i.unshift(Bg);else continue;i.unshift(wg)}}function Ol(e,t,r){var n;e.forEach(Ig),r=(n=t.context)!==null&&n!==void 0?n:r;const i=Array.isArray(r),y=r&&(Array.isArray(r)?r:[r]);if(t.relativeSelector!==!1)Hg(e,t,y);else if(e.some(u=>u.length>0&&aa(u[0])))throw new Error("Relative selectors are not allowed when the `relativeSelector` option is disabled");let M=!1;const C=e.map(u=>{if(u.length>=2){const[R,_]=u;R.type!==Ae.Pseudo||R.name!=="scope"||(i&&_.type===Ae.Descendant?u[1]=Ug:(_.type===Ae.Adjacent||_.type===Ae.Sibling)&&(M=!0))}return Kg(u,t,y)}).reduce(Wg,Ie.falseFunc);return C.shouldTestNextSiblings=M,C}function Kg(e,t,r){var n;return e.reduce((i,y)=>i===Ie.falseFunc?Ie.falseFunc:kg(i,y,t,r,Ol),(n=t.rootFunc)!==null&&n!==void 0?n:Ie.trueFunc)}function Wg(e,t){return t===Ie.falseFunc||e===Ie.trueFunc?e:e===Ie.falseFunc||t===Ie.trueFunc?t:function(n){return e(n)||t(n)}}const Pl=(e,t)=>e===t,Gg={adapter:Si,equals:Pl};function Yg(e){var t,r,n,i;const y=e??Gg;return(t=y.adapter)!==null&&t!==void 0||(y.adapter=Si),(r=y.equals)!==null&&r!==void 0||(y.equals=(i=(n=y.adapter)===null||n===void 0?void 0:n.equals)!==null&&i!==void 0?i:Pl),y}function Vg(e){return function(r,n,i){const y=Yg(n);return e(r,y,i)}}const ua=Vg(Ol);function Nl(e,t,r=!1){return r&&(e=jg(e,t)),Array.isArray(e)?t.removeSubsets(e):t.getChildren(e)}function jg(e,t){const r=Array.isArray(e)?e.slice(0):[e],n=r.length;for(let i=0;i<n;i++){const y=Dl(r[i],t);r.push(...y)}return r}const Xg=new Set(["first","last","eq","gt","nth","lt","even","odd"]);function ni(e){return e.type!=="pseudo"?!1:Xg.has(e.name)?!0:e.name==="not"&&Array.isArray(e.data)?e.data.some(t=>t.some(ni)):!1}function Qg(e,t,r){const n=t!=null?parseInt(t,10):NaN;switch(e){case"first":return 1;case"nth":case"eq":return isFinite(n)?n>=0?n+1:1/0:0;case"lt":return isFinite(n)?n>=0?Math.min(n,r):1/0:0;case"gt":return isFinite(n)?1/0:0;case"odd":return 2*r;case"even":return 2*r-1;case"last":case"not":return 1/0}}function $g(e){for(;e.parent;)e=e.parent;return e}function oa(e){const t=[],r=[];for(const n of e)n.some(ni)?t.push(n):r.push(n);return[r,t]}const zg={type:Ae.Universal,namespace:null},qg={type:Ae.Pseudo,name:"scope",data:null};function Ml(e,t,r={}){return Fl([e],t,r)}function Fl(e,t,r={}){if(typeof t=="function")return e.some(t);const[n,i]=oa(Ii(t));return n.length>0&&e.some(ua(n,r))||i.some(y=>Ul(y,e,r).length>0)}function Jg(e,t,r,n){const i=typeof r=="string"?parseInt(r,10):NaN;switch(e){case"first":case"lt":return t;case"last":return t.length>0?[t[t.length-1]]:t;case"nth":case"eq":return isFinite(i)&&Math.abs(i)<t.length?[i<0?t[t.length+i]:t[i]]:[];case"gt":return isFinite(i)?t.slice(i+1):[];case"even":return t.filter((y,M)=>M%2===0);case"odd":return t.filter((y,M)=>M%2===1);case"not":{const y=new Set(Bl(r,t,n));return t.filter(M=>!y.has(M))}}}function kl(e,t,r={}){return Bl(Ii(e),t,r)}function Bl(e,t,r){if(t.length===0)return[];const[n,i]=oa(e);let y;if(n.length){const M=bs(t,n,r);if(i.length===0)return M;M.length&&(y=new Set(M))}for(let M=0;M<i.length&&(y==null?void 0:y.size)!==t.length;M++){const C=i[M];if((y?t.filter(_=>be(_)&&!y.has(_)):t).length===0)break;const R=Ul(C,t,r);if(R.length)if(y)R.forEach(_=>y.add(_));else{if(M===i.length-1)return R;y=new Set(R)}}return typeof y<"u"?y.size===t.length?t:t.filter(M=>y.has(M)):[]}function Ul(e,t,r){var n;if(e.some(rn)){const i=(n=r.root)!==null&&n!==void 0?n:$g(t[0]),y={...r,context:t,relativeSelector:!1};return e.push(qg),ii(i,e,y,!0,t.length)}return ii(t,e,r,!1,t.length)}function Zg(e,t,r={},n=1/0){if(typeof e=="function")return wl(t,e);const[i,y]=oa(Ii(e)),M=y.map(C=>ii(t,C,r,!0,n));return i.length&&M.push(ys(t,i,r,n)),M.length===0?[]:M.length===1?M[0]:Gr(M.reduce((C,u)=>[...C,...u]))}function ii(e,t,r,n,i){const y=t.findIndex(ni),M=t.slice(0,y),C=t[y],u=t.length-1===y?i:1/0,R=Qg(C.name,C.data,u);if(R===0)return[];const U=(M.length===0&&!Array.isArray(e)?Ai(e).filter(be):M.length===0?(Array.isArray(e)?e:[e]).filter(be):n||M.some(rn)?ys(e,[M],r,R):bs(e,[M],r)).slice(0,R);let D=Jg(C.name,U,C.data,r);if(D.length===0||t.length===y+1)return D;const K=t.slice(y+1),k=K.some(rn);if(k){if(rn(K[0])){const{type:F}=K[0];(F===Ae.Sibling||F===Ae.Adjacent)&&(D=Nl(D,Si,!0)),K.unshift(zg)}r={...r,relativeSelector:!1,rootFunc:F=>D.includes(F)}}else r.rootFunc&&r.rootFunc!==Ie.trueFunc&&(r={...r,rootFunc:Ie.trueFunc});return K.some(ni)?ii(D,K,r,!1,i):k?ys(D,[K],r,i):bs(D,[K],r)}function ys(e,t,r,n){const i=ua(t,r,e);return wl(e,i,n)}function wl(e,t,r=1/0){const n=Nl(e,Si,t.shouldTestNextSiblings);return bi(i=>be(i)&&t(i),n,!0,r)}function bs(e,t,r){const n=(Array.isArray(e)?e:[e]).filter(be);if(n.length===0)return n;const i=ua(t,r);return i===Ie.trueFunc?n:n.filter(i)}const eE=/^\s*[~+]/;function tE(e){var t;if(!e)return this._make([]);const r=this.toArray();if(typeof e!="string"){const y=Mt(e)?e.toArray():[e];return this._make(y.filter(M=>r.some(C=>_l(C,M))))}const n=eE.test(e)?r:this.children().toArray(),i={context:r,root:(t=this._root)===null||t===void 0?void 0:t[0],xmlMode:this.options.xmlMode,lowerCaseTags:this.options.lowerCaseTags,lowerCaseAttributeNames:this.options.lowerCaseAttributeNames,pseudos:this.options.pseudos,quirksMode:this.options.quirksMode};return this._make(Zg(e,n,i))}function la(e){return function(t,...r){return function(n){var i;let y=e(t,this);return n&&(y=da(y,n,this.options.xmlMode,(i=this._root)===null||i===void 0?void 0:i[0])),this._make(this.length>1&&y.length>1?r.reduce((M,C)=>C(M),y):y)}}}const yn=la((e,t)=>{const r=[];for(let n=0;n<t.length;n++){const i=e(t[n]);r.push(i)}return new Array().concat(...r)}),ca=la((e,t)=>{const r=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i!==null&&r.push(i)}return r});function fa(e,...t){let r=null;const n=la((i,y)=>{const M=[];return Ke(y,C=>{for(let u;(u=i(C))&&!(r!=null&&r(u,M.length));C=u)M.push(u)}),M})(e,...t);return function(i,y){r=typeof i=="string"?C=>Ml(C,i,this.options):i?bn(i):null;const M=n.call(this,y);return r=null,M}}function Yr(e){return Array.from(new Set(e))}const rE=ca(({parent:e})=>e&&!mr(e)?e:null,Yr),nE=yn(e=>{const t=[];for(;e.parent&&!mr(e.parent);)t.push(e.parent),e=e.parent;return t},Gr,e=>e.reverse()),iE=fa(({parent:e})=>e&&!mr(e)?e:null,Gr,e=>e.reverse());function sE(e){var t;const r=[];if(!e)return this._make(r);const n={xmlMode:this.options.xmlMode,root:(t=this._root)===null||t===void 0?void 0:t[0]},i=typeof e=="string"?y=>Ml(y,e,n):bn(e);return Ke(this,y=>{for(;y&&be(y);){if(i(y,0)){r.includes(y)||r.push(y);break}y=y.parent}}),this._make(r)}const aE=ca(e=>ra(e)),uE=yn(e=>{const t=[];for(;e.next;)e=e.next,be(e)&&t.push(e);return t},Yr),oE=fa(e=>ra(e),Yr),lE=ca(e=>na(e)),cE=yn(e=>{const t=[];for(;e.prev;)e=e.prev,be(e)&&t.push(e);return t},Yr),fE=fa(e=>na(e),Yr),dE=yn(e=>hl(e).filter(t=>be(t)&&t!==e),Gr),hE=yn(e=>Ai(e).filter(be),Yr);function gE(){const e=this.toArray().reduce((t,r)=>je(r)?t.concat(r.children):t,[]);return this._make(e)}function EE(e){let t=0;const r=this.length;for(;t<r&&e.call(this[t],t,this[t])!==!1;)++t;return this}function mE(e){let t=[];for(let r=0;r<this.length;r++){const n=this[r],i=e.call(n,r,n);i!=null&&(t=t.concat(i))}return this._make(t)}function bn(e){return typeof e=="function"?(t,r)=>e.call(t,r,t):Mt(e)?t=>Array.prototype.includes.call(e,t):function(t){return e===t}}function vE(e){var t;return this._make(da(this.toArray(),e,this.options.xmlMode,(t=this._root)===null||t===void 0?void 0:t[0]))}function da(e,t,r,n){return typeof t=="string"?kl(t,e,{xmlMode:r,root:n}):e.filter(bn(t))}function pE(e){const t=this.toArray();return typeof e=="string"?Fl(t.filter(be),e,this.options):e?t.some(bn(e)):!1}function TE(e){let t=this.toArray();if(typeof e=="string"){const r=new Set(kl(e,t,this.options));t=t.filter(n=>!r.has(n))}else{const r=bn(e);t=t.filter((n,i)=>!r(n,i))}return this._make(t)}function _E(e){return this.filter(typeof e=="string"?`:has(${e})`:(t,r)=>this._make(r).find(e).length>0)}function AE(){return this.length>1?this._make(this[0]):this}function yE(){return this.length>0?this._make(this[this.length-1]):this}function bE(e){var t;return e=+e,e===0&&this.length<=1?this:(e<0&&(e=this.length+e),this._make((t=this[e])!==null&&t!==void 0?t:[]))}function SE(e){return e==null?this.toArray():this[e<0?this.length+e:e]}function IE(){return Array.prototype.slice.call(this)}function xE(e){let t,r;return e==null?(t=this.parent().children(),r=this[0]):typeof e=="string"?(t=this._make(e),r=this[0]):(t=this,r=Mt(e)?e[0]:e),Array.prototype.indexOf.call(t,r)}function CE(e,t){return this._make(Array.prototype.slice.call(this,e,t))}function LE(){var e;return(e=this.prevObject)!==null&&e!==void 0?e:this._make([])}function DE(e,t){const r=this._make(e,t),n=Gr([...this.get(),...r.get()]);return this._make(n)}function RE(e){return this.prevObject?this.add(e?this.prevObject.filter(e):this.prevObject):this}const OE=Object.freeze(Object.defineProperty({__proto__:null,add:DE,addBack:RE,children:hE,closest:sE,contents:gE,each:EE,end:LE,eq:bE,filter:vE,filterArray:da,find:tE,first:AE,get:SE,has:_E,index:xE,is:pE,last:yE,map:mE,next:aE,nextAll:uE,nextUntil:oE,not:TE,parent:rE,parents:nE,parentsUntil:iE,prev:lE,prevAll:cE,prevUntil:fE,siblings:dE,slice:CE,toArray:IE},Symbol.toStringTag,{value:"Module"}));function PE(e){return function(r,n,i,y){if(typeof Buffer<"u"&&Buffer.isBuffer(r)&&(r=r.toString()),typeof r=="string")return e(r,n,i,y);const M=r;if(!Array.isArray(M)&&mr(M))return M;const C=new gr([]);return Er(M,C),C}}function Er(e,t){const r=Array.isArray(e)?e:[e];t?t.children=r:t=null;for(let n=0;n<r.length;n++){const i=r[n];i.parent&&i.parent.children!==r&&vr(i),t?(i.prev=r[n-1]||null,i.next=r[n+1]||null):i.prev=i.next=null,i.parent=t}return t}function NE(e,t){return e==null?[]:Mt(e)?t?ps(e.get()):e.get():Array.isArray(e)?e.reduce((r,n)=>r.concat(this._makeDomArray(n,t)),[]):typeof e=="string"?this._parse(e,this.options,!1,null).children:t?ps([e]):[e]}function Hl(e){return function(...t){const r=this.length-1;return Ke(this,(n,i)=>{if(!je(n))return;const y=typeof t[0]=="function"?t[0].call(n,i,this._render(n.children)):t,M=this._makeDomArray(y,i<r);e(M,n.children,n)})}}function er(e,t,r,n,i){var y,M;const C=[t,r,...n],u=t===0?null:e[t-1],R=t+r>=e.length?null:e[t+r];for(let _=0;_<n.length;++_){const U=n[_],D=U.parent;if(D){const k=D.children.indexOf(U);k>-1&&(D.children.splice(k,1),i===D&&t>k&&C[0]--)}U.parent=i,U.prev&&(U.prev.next=(y=U.next)!==null&&y!==void 0?y:null),U.next&&(U.next.prev=(M=U.prev)!==null&&M!==void 0?M:null),U.prev=_===0?u:n[_-1],U.next=_===n.length-1?R:n[_+1]}return u&&(u.next=n[0]),R&&(R.prev=n[n.length-1]),e.splice(...C)}function ME(e){return(Mt(e)?e:this._make(e)).append(this),this}function FE(e){return(Mt(e)?e:this._make(e)).prepend(this),this}const kE=Hl((e,t,r)=>{er(t,t.length,0,e,r)}),BE=Hl((e,t,r)=>{er(t,0,0,e,r)});function Kl(e){return function(t){const r=this.length-1,n=this.parents().last();for(let i=0;i<this.length;i++){const y=this[i],M=typeof t=="function"?t.call(y,i,y):typeof t=="string"&&!Ts(t)?n.find(t).clone():t,[C]=this._makeDomArray(M,i<r);if(!C||!je(C))continue;let u=C,R=0;for(;R<u.children.length;){const _=u.children[R];be(_)?(u=_,R=0):R++}e(y,u,[C])}return this}}const UE=Kl((e,t,r)=>{const{parent:n}=e;if(!n)return;const i=n.children,y=i.indexOf(e);Er([e],t),er(i,y,0,r,n)}),wE=Kl((e,t,r)=>{je(e)&&(Er(e.children,t),Er(r,e))});function HE(e){return this.parent(e).not("body").each((t,r)=>{this._make(r).replaceWith(r.children)}),this}function KE(e){const t=this[0];if(t){const r=this._make(typeof e=="function"?e.call(t,0,t):e).insertBefore(t);let n;for(let y=0;y<r.length;y++)r[y].type==="tag"&&(n=r[y]);let i=0;for(;n&&i<n.children.length;){const y=n.children[i];y.type==="tag"?(n=y,i=0):i++}n&&this._make(n).append(this)}return this}function WE(...e){const t=this.length-1;return Ke(this,(r,n)=>{const{parent:i}=r;if(!je(r)||!i)return;const y=i.children,M=y.indexOf(r);if(M<0)return;const C=typeof e[0]=="function"?e[0].call(r,n,this._render(r.children)):e,u=this._makeDomArray(C,n<t);er(y,M+1,0,u,i)})}function GE(e){typeof e=="string"&&(e=this._make(e)),this.remove();const t=[];return this._makeDomArray(e).forEach(r=>{const n=this.clone().toArray(),{parent:i}=r;if(!i)return;const y=i.children,M=y.indexOf(r);M<0||(er(y,M+1,0,n,i),t.push(...n))}),this._make(t)}function YE(...e){const t=this.length-1;return Ke(this,(r,n)=>{const{parent:i}=r;if(!je(r)||!i)return;const y=i.children,M=y.indexOf(r);if(M<0)return;const C=typeof e[0]=="function"?e[0].call(r,n,this._render(r.children)):e,u=this._makeDomArray(C,n<t);er(y,M,0,u,i)})}function VE(e){const t=this._make(e);this.remove();const r=[];return Ke(t,n=>{const i=this.clone().toArray(),{parent:y}=n;if(!y)return;const M=y.children,C=M.indexOf(n);C<0||(er(M,C,0,i,y),r.push(...i))}),this._make(r)}function jE(e){const t=e?this.filter(e):this;return Ke(t,r=>{vr(r),r.prev=r.next=r.parent=null}),this}function XE(e){return Ke(this,(t,r)=>{const{parent:n}=t;if(!n)return;const i=n.children,y=typeof e=="function"?e.call(t,r,t):e,M=this._makeDomArray(y);Er(M,null);const C=i.indexOf(t);er(i,C,1,M,n),M.includes(t)||(t.parent=t.prev=t.next=null)})}function QE(){return Ke(this,e=>{je(e)&&(e.children.forEach(t=>{t.next=t.prev=t.parent=null}),e.children.length=0)})}function $E(e){if(e===void 0){const t=this[0];return!t||!je(t)?null:this._render(t.children)}return Ke(this,t=>{if(!je(t))return;t.children.forEach(n=>{n.next=n.prev=n.parent=null});const r=Mt(e)?e.toArray():this._parse(`${e}`,this.options,!1,t).children;Er(r,t)})}function zE(){return this._render(this)}function qE(e){return e===void 0?pn(this):typeof e=="function"?Ke(this,(t,r)=>this._make(t).text(e.call(t,r,pn([t])))):Ke(this,t=>{if(!je(t))return;t.children.forEach(n=>{n.next=n.prev=n.parent=null});const r=new vn(`${e}`);Er(r,t)})}function JE(){return this._make(ps(this.get()))}const ZE=Object.freeze(Object.defineProperty({__proto__:null,_makeDomArray:NE,after:WE,append:kE,appendTo:ME,before:YE,clone:JE,empty:QE,html:$E,insertAfter:GE,insertBefore:VE,prepend:BE,prependTo:FE,remove:jE,replaceWith:XE,text:qE,toString:zE,unwrap:HE,wrap:UE,wrapAll:KE,wrapInner:wE},Symbol.toStringTag,{value:"Module"}));function em(e,t){if(e!=null&&t!=null||typeof e=="object"&&!Array.isArray(e))return Ke(this,(r,n)=>{be(r)&&Wl(r,e,t,n)});if(this.length!==0)return Gl(this[0],e)}function Wl(e,t,r,n){if(typeof t=="string"){const i=Gl(e),y=typeof r=="function"?r.call(e,n,i[t]):r;y===""?delete i[t]:y!=null&&(i[t]=y),e.attribs.style=tm(i)}else typeof t=="object"&&Object.keys(t).forEach((i,y)=>{Wl(e,i,t[i],y)})}function Gl(e,t){if(!e||!be(e))return;const r=rm(e.attribs.style);if(typeof t=="string")return r[t];if(Array.isArray(t)){const n={};return t.forEach(i=>{r[i]!=null&&(n[i]=r[i])}),n}return r}function tm(e){return Object.keys(e).reduce((t,r)=>`${t}${t?" ":""}${r}: ${e[r]};`,"")}function rm(e){if(e=(e||"").trim(),!e)return{};const t={};let r;for(const n of e.split(";")){const i=n.indexOf(":");if(i<1||i===n.length-1){const y=n.trimEnd();y.length>0&&r!==void 0&&(t[r]+=`;${y}`)}else r=n.slice(0,i).trim(),t[r]=n.slice(i+1).trim()}return t}const nm=Object.freeze(Object.defineProperty({__proto__:null,css:em},Symbol.toStringTag,{value:"Module"})),Lu="input,select,textarea,keygen",im=/%20/g,Du=/\r?\n/g;function sm(){return this.serializeArray().map(r=>`${encodeURIComponent(r.name)}=${encodeURIComponent(r.value)}`).join("&").replace(im,"+")}function am(){return this.map((e,t)=>{const r=this._make(t);return be(t)&&t.name==="form"?r.find(Lu).toArray():r.filter(Lu).toArray()}).filter('[name!=""]:enabled:not(:submit, :button, :image, :reset, :file):matches([checked], :not(:checkbox, :radio))').map((e,t)=>{var r;const n=this._make(t),i=n.attr("name"),y=(r=n.val())!==null&&r!==void 0?r:"";return Array.isArray(y)?y.map(M=>({name:i,value:M.replace(Du,`\r
`)})):{name:i,value:y.replace(Du,`\r
`)}}).toArray()}const um=Object.freeze(Object.defineProperty({__proto__:null,serialize:sm,serializeArray:am},Symbol.toStringTag,{value:"Module"}));class Sn{constructor(t,r,n){if(this.length=0,this.options=n,this._root=r,t){for(let i=0;i<t.length;i++)this[i]=t[i];this.length=t.length}}}Sn.prototype.cheerio="[cheerio object]";Sn.prototype.splice=Array.prototype.splice;Sn.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator];Object.assign(Sn.prototype,mg,OE,ZE,nm,um);function om(e,t){return function r(n,i,y=!0){if(n==null)throw new Error("cheerio.load() expects a string");const M={...zs,...ms(i)},C=e(n,M,y,null);class u extends Sn{_make(U,D){const K=R(U,D);return K.prevObject=this,K}_parse(U,D,K,k){return e(U,D,K,k)}_render(U){return t(U,this.options)}}function R(_,U,D=C,K){if(_&&Mt(_))return _;const k={...M,...ms(K)},F=typeof D=="string"?[e(D,k,!1,null)]:"length"in D?D:[D],B=Mt(F)?F:new u(F,null,k);if(B._root=B,!_)return new u(void 0,B,k);const O=typeof _=="string"&&Ts(_)?e(_,k,!1,null).children:lm(_)?[_]:Array.isArray(_)?_:void 0,P=new u(O,B,k);if(O)return P;if(typeof _!="string")throw new Error("Unexpected type of selector");let g=_;const N=U?typeof U=="string"?Ts(U)?new u([e(U,k,!1,null)],B,k):(g=`${U} ${g}`,B):Mt(U)?U:new u(Array.isArray(U)?U:[U],B,k):B;return N?N.find(g):P}return Object.assign(R,ag,{load:r,_root:C,_options:M,fn:u.prototype,prototype:u.prototype}),R}}function lm(e){return!!e.name||e.type==="root"||e.type==="text"||e.type==="comment"}const cm=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),ke="";var $;(function(e){e[e.EOF=-1]="EOF",e[e.NULL=0]="NULL",e[e.TABULATION=9]="TABULATION",e[e.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",e[e.LINE_FEED=10]="LINE_FEED",e[e.FORM_FEED=12]="FORM_FEED",e[e.SPACE=32]="SPACE",e[e.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",e[e.QUOTATION_MARK=34]="QUOTATION_MARK",e[e.NUMBER_SIGN=35]="NUMBER_SIGN",e[e.AMPERSAND=38]="AMPERSAND",e[e.APOSTROPHE=39]="APOSTROPHE",e[e.HYPHEN_MINUS=45]="HYPHEN_MINUS",e[e.SOLIDUS=47]="SOLIDUS",e[e.DIGIT_0=48]="DIGIT_0",e[e.DIGIT_9=57]="DIGIT_9",e[e.SEMICOLON=59]="SEMICOLON",e[e.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",e[e.EQUALS_SIGN=61]="EQUALS_SIGN",e[e.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",e[e.LATIN_CAPITAL_F=70]="LATIN_CAPITAL_F",e[e.LATIN_CAPITAL_X=88]="LATIN_CAPITAL_X",e[e.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",e[e.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",e[e.GRAVE_ACCENT=96]="GRAVE_ACCENT",e[e.LATIN_SMALL_A=97]="LATIN_SMALL_A",e[e.LATIN_SMALL_F=102]="LATIN_SMALL_F",e[e.LATIN_SMALL_X=120]="LATIN_SMALL_X",e[e.LATIN_SMALL_Z=122]="LATIN_SMALL_Z",e[e.REPLACEMENT_CHARACTER=65533]="REPLACEMENT_CHARACTER"})($=$||($={}));const rt={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function Yl(e){return e>=55296&&e<=57343}function fm(e){return e>=56320&&e<=57343}function dm(e,t){return(e-55296)*1024+9216+t}function Vl(e){return e!==32&&e!==10&&e!==13&&e!==9&&e!==12&&e>=1&&e<=31||e>=127&&e<=159}function jl(e){return e>=64976&&e<=65007||cm.has(e)}var oe;(function(e){e.controlCharacterInInputStream="control-character-in-input-stream",e.noncharacterInInputStream="noncharacter-in-input-stream",e.surrogateInInputStream="surrogate-in-input-stream",e.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",e.endTagWithAttributes="end-tag-with-attributes",e.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",e.unexpectedSolidusInTag="unexpected-solidus-in-tag",e.unexpectedNullCharacter="unexpected-null-character",e.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",e.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",e.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",e.missingEndTagName="missing-end-tag-name",e.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",e.unknownNamedCharacterReference="unknown-named-character-reference",e.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",e.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",e.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",e.eofBeforeTagName="eof-before-tag-name",e.eofInTag="eof-in-tag",e.missingAttributeValue="missing-attribute-value",e.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",e.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",e.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",e.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",e.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",e.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",e.missingDoctypePublicIdentifier="missing-doctype-public-identifier",e.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",e.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",e.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",e.cdataInHtmlContent="cdata-in-html-content",e.incorrectlyOpenedComment="incorrectly-opened-comment",e.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",e.eofInDoctype="eof-in-doctype",e.nestedComment="nested-comment",e.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",e.eofInComment="eof-in-comment",e.incorrectlyClosedComment="incorrectly-closed-comment",e.eofInCdata="eof-in-cdata",e.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",e.nullCharacterReference="null-character-reference",e.surrogateCharacterReference="surrogate-character-reference",e.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",e.controlCharacterReference="control-character-reference",e.noncharacterCharacterReference="noncharacter-character-reference",e.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",e.missingDoctypeName="missing-doctype-name",e.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",e.duplicateAttribute="duplicate-attribute",e.nonConformingDoctype="non-conforming-doctype",e.missingDoctype="missing-doctype",e.misplacedDoctype="misplaced-doctype",e.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",e.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",e.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",e.openElementsLeftAfterEof="open-elements-left-after-eof",e.abandonedHeadElementChild="abandoned-head-element-child",e.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",e.nestedNoscriptInHead="nested-noscript-in-head",e.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(oe=oe||(oe={}));const hm=1<<16;class gm{constructor(t){this.handler=t,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=hm,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+Number(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(t){const{line:r,col:n,offset:i}=this;return{code:t,startLine:r,endLine:r,startCol:n,endCol:n,startOffset:i,endOffset:i}}_err(t){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(t)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(t){if(this.pos!==this.html.length-1){const r=this.html.charCodeAt(this.pos+1);if(fm(r))return this.pos++,this._addGap(),dm(t,r)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,$.EOF;return this._err(oe.surrogateInInputStream),t}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(t,r){this.html.length>0?this.html+=t:this.html=t,this.endOfChunkHit=!1,this.lastChunkWritten=r}insertHtmlAtCurrentPos(t){this.html=this.html.substring(0,this.pos+1)+t+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(t,r){if(this.pos+t.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(r)return this.html.startsWith(t,this.pos);for(let n=0;n<t.length;n++)if((this.html.charCodeAt(this.pos+n)|32)!==t.charCodeAt(n))return!1;return!0}peek(t){const r=this.pos+t;if(r>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,$.EOF;const n=this.html.charCodeAt(r);return n===$.CARRIAGE_RETURN?$.LINE_FEED:n}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,$.EOF;let t=this.html.charCodeAt(this.pos);return t===$.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,$.LINE_FEED):t===$.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,Yl(t)&&(t=this._processSurrogate(t)),this.handler.onParseError===null||t>31&&t<127||t===$.LINE_FEED||t===$.CARRIAGE_RETURN||t>159&&t<64976||this._checkForProblematicCharacters(t),t)}_checkForProblematicCharacters(t){Vl(t)?this._err(oe.controlCharacterInInputStream):jl(t)&&this._err(oe.noncharacterInInputStream)}retreat(t){for(this.pos-=t;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var Ce;(function(e){e[e.CHARACTER=0]="CHARACTER",e[e.NULL_CHARACTER=1]="NULL_CHARACTER",e[e.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",e[e.START_TAG=3]="START_TAG",e[e.END_TAG=4]="END_TAG",e[e.COMMENT=5]="COMMENT",e[e.DOCTYPE=6]="DOCTYPE",e[e.EOF=7]="EOF",e[e.HIBERNATION=8]="HIBERNATION"})(Ce=Ce||(Ce={}));function Xl(e,t){for(let r=e.attrs.length-1;r>=0;r--)if(e.attrs[r].name===t)return e.attrs[r].value;return null}var ce;(function(e){e.HTML="http://www.w3.org/1999/xhtml",e.MATHML="http://www.w3.org/1998/Math/MathML",e.SVG="http://www.w3.org/2000/svg",e.XLINK="http://www.w3.org/1999/xlink",e.XML="http://www.w3.org/XML/1998/namespace",e.XMLNS="http://www.w3.org/2000/xmlns/"})(ce=ce||(ce={}));var Jt;(function(e){e.TYPE="type",e.ACTION="action",e.ENCODING="encoding",e.PROMPT="prompt",e.NAME="name",e.COLOR="color",e.FACE="face",e.SIZE="size"})(Jt=Jt||(Jt={}));var at;(function(e){e.NO_QUIRKS="no-quirks",e.QUIRKS="quirks",e.LIMITED_QUIRKS="limited-quirks"})(at=at||(at={}));var se;(function(e){e.A="a",e.ADDRESS="address",e.ANNOTATION_XML="annotation-xml",e.APPLET="applet",e.AREA="area",e.ARTICLE="article",e.ASIDE="aside",e.B="b",e.BASE="base",e.BASEFONT="basefont",e.BGSOUND="bgsound",e.BIG="big",e.BLOCKQUOTE="blockquote",e.BODY="body",e.BR="br",e.BUTTON="button",e.CAPTION="caption",e.CENTER="center",e.CODE="code",e.COL="col",e.COLGROUP="colgroup",e.DD="dd",e.DESC="desc",e.DETAILS="details",e.DIALOG="dialog",e.DIR="dir",e.DIV="div",e.DL="dl",e.DT="dt",e.EM="em",e.EMBED="embed",e.FIELDSET="fieldset",e.FIGCAPTION="figcaption",e.FIGURE="figure",e.FONT="font",e.FOOTER="footer",e.FOREIGN_OBJECT="foreignObject",e.FORM="form",e.FRAME="frame",e.FRAMESET="frameset",e.H1="h1",e.H2="h2",e.H3="h3",e.H4="h4",e.H5="h5",e.H6="h6",e.HEAD="head",e.HEADER="header",e.HGROUP="hgroup",e.HR="hr",e.HTML="html",e.I="i",e.IMG="img",e.IMAGE="image",e.INPUT="input",e.IFRAME="iframe",e.KEYGEN="keygen",e.LABEL="label",e.LI="li",e.LINK="link",e.LISTING="listing",e.MAIN="main",e.MALIGNMARK="malignmark",e.MARQUEE="marquee",e.MATH="math",e.MENU="menu",e.META="meta",e.MGLYPH="mglyph",e.MI="mi",e.MO="mo",e.MN="mn",e.MS="ms",e.MTEXT="mtext",e.NAV="nav",e.NOBR="nobr",e.NOFRAMES="noframes",e.NOEMBED="noembed",e.NOSCRIPT="noscript",e.OBJECT="object",e.OL="ol",e.OPTGROUP="optgroup",e.OPTION="option",e.P="p",e.PARAM="param",e.PLAINTEXT="plaintext",e.PRE="pre",e.RB="rb",e.RP="rp",e.RT="rt",e.RTC="rtc",e.RUBY="ruby",e.S="s",e.SCRIPT="script",e.SECTION="section",e.SELECT="select",e.SOURCE="source",e.SMALL="small",e.SPAN="span",e.STRIKE="strike",e.STRONG="strong",e.STYLE="style",e.SUB="sub",e.SUMMARY="summary",e.SUP="sup",e.TABLE="table",e.TBODY="tbody",e.TEMPLATE="template",e.TEXTAREA="textarea",e.TFOOT="tfoot",e.TD="td",e.TH="th",e.THEAD="thead",e.TITLE="title",e.TR="tr",e.TRACK="track",e.TT="tt",e.U="u",e.UL="ul",e.SVG="svg",e.VAR="var",e.WBR="wbr",e.XMP="xmp"})(se=se||(se={}));var x;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.A=1]="A",e[e.ADDRESS=2]="ADDRESS",e[e.ANNOTATION_XML=3]="ANNOTATION_XML",e[e.APPLET=4]="APPLET",e[e.AREA=5]="AREA",e[e.ARTICLE=6]="ARTICLE",e[e.ASIDE=7]="ASIDE",e[e.B=8]="B",e[e.BASE=9]="BASE",e[e.BASEFONT=10]="BASEFONT",e[e.BGSOUND=11]="BGSOUND",e[e.BIG=12]="BIG",e[e.BLOCKQUOTE=13]="BLOCKQUOTE",e[e.BODY=14]="BODY",e[e.BR=15]="BR",e[e.BUTTON=16]="BUTTON",e[e.CAPTION=17]="CAPTION",e[e.CENTER=18]="CENTER",e[e.CODE=19]="CODE",e[e.COL=20]="COL",e[e.COLGROUP=21]="COLGROUP",e[e.DD=22]="DD",e[e.DESC=23]="DESC",e[e.DETAILS=24]="DETAILS",e[e.DIALOG=25]="DIALOG",e[e.DIR=26]="DIR",e[e.DIV=27]="DIV",e[e.DL=28]="DL",e[e.DT=29]="DT",e[e.EM=30]="EM",e[e.EMBED=31]="EMBED",e[e.FIELDSET=32]="FIELDSET",e[e.FIGCAPTION=33]="FIGCAPTION",e[e.FIGURE=34]="FIGURE",e[e.FONT=35]="FONT",e[e.FOOTER=36]="FOOTER",e[e.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",e[e.FORM=38]="FORM",e[e.FRAME=39]="FRAME",e[e.FRAMESET=40]="FRAMESET",e[e.H1=41]="H1",e[e.H2=42]="H2",e[e.H3=43]="H3",e[e.H4=44]="H4",e[e.H5=45]="H5",e[e.H6=46]="H6",e[e.HEAD=47]="HEAD",e[e.HEADER=48]="HEADER",e[e.HGROUP=49]="HGROUP",e[e.HR=50]="HR",e[e.HTML=51]="HTML",e[e.I=52]="I",e[e.IMG=53]="IMG",e[e.IMAGE=54]="IMAGE",e[e.INPUT=55]="INPUT",e[e.IFRAME=56]="IFRAME",e[e.KEYGEN=57]="KEYGEN",e[e.LABEL=58]="LABEL",e[e.LI=59]="LI",e[e.LINK=60]="LINK",e[e.LISTING=61]="LISTING",e[e.MAIN=62]="MAIN",e[e.MALIGNMARK=63]="MALIGNMARK",e[e.MARQUEE=64]="MARQUEE",e[e.MATH=65]="MATH",e[e.MENU=66]="MENU",e[e.META=67]="META",e[e.MGLYPH=68]="MGLYPH",e[e.MI=69]="MI",e[e.MO=70]="MO",e[e.MN=71]="MN",e[e.MS=72]="MS",e[e.MTEXT=73]="MTEXT",e[e.NAV=74]="NAV",e[e.NOBR=75]="NOBR",e[e.NOFRAMES=76]="NOFRAMES",e[e.NOEMBED=77]="NOEMBED",e[e.NOSCRIPT=78]="NOSCRIPT",e[e.OBJECT=79]="OBJECT",e[e.OL=80]="OL",e[e.OPTGROUP=81]="OPTGROUP",e[e.OPTION=82]="OPTION",e[e.P=83]="P",e[e.PARAM=84]="PARAM",e[e.PLAINTEXT=85]="PLAINTEXT",e[e.PRE=86]="PRE",e[e.RB=87]="RB",e[e.RP=88]="RP",e[e.RT=89]="RT",e[e.RTC=90]="RTC",e[e.RUBY=91]="RUBY",e[e.S=92]="S",e[e.SCRIPT=93]="SCRIPT",e[e.SECTION=94]="SECTION",e[e.SELECT=95]="SELECT",e[e.SOURCE=96]="SOURCE",e[e.SMALL=97]="SMALL",e[e.SPAN=98]="SPAN",e[e.STRIKE=99]="STRIKE",e[e.STRONG=100]="STRONG",e[e.STYLE=101]="STYLE",e[e.SUB=102]="SUB",e[e.SUMMARY=103]="SUMMARY",e[e.SUP=104]="SUP",e[e.TABLE=105]="TABLE",e[e.TBODY=106]="TBODY",e[e.TEMPLATE=107]="TEMPLATE",e[e.TEXTAREA=108]="TEXTAREA",e[e.TFOOT=109]="TFOOT",e[e.TD=110]="TD",e[e.TH=111]="TH",e[e.THEAD=112]="THEAD",e[e.TITLE=113]="TITLE",e[e.TR=114]="TR",e[e.TRACK=115]="TRACK",e[e.TT=116]="TT",e[e.U=117]="U",e[e.UL=118]="UL",e[e.SVG=119]="SVG",e[e.VAR=120]="VAR",e[e.WBR=121]="WBR",e[e.XMP=122]="XMP"})(x=x||(x={}));const Em=new Map([[se.A,x.A],[se.ADDRESS,x.ADDRESS],[se.ANNOTATION_XML,x.ANNOTATION_XML],[se.APPLET,x.APPLET],[se.AREA,x.AREA],[se.ARTICLE,x.ARTICLE],[se.ASIDE,x.ASIDE],[se.B,x.B],[se.BASE,x.BASE],[se.BASEFONT,x.BASEFONT],[se.BGSOUND,x.BGSOUND],[se.BIG,x.BIG],[se.BLOCKQUOTE,x.BLOCKQUOTE],[se.BODY,x.BODY],[se.BR,x.BR],[se.BUTTON,x.BUTTON],[se.CAPTION,x.CAPTION],[se.CENTER,x.CENTER],[se.CODE,x.CODE],[se.COL,x.COL],[se.COLGROUP,x.COLGROUP],[se.DD,x.DD],[se.DESC,x.DESC],[se.DETAILS,x.DETAILS],[se.DIALOG,x.DIALOG],[se.DIR,x.DIR],[se.DIV,x.DIV],[se.DL,x.DL],[se.DT,x.DT],[se.EM,x.EM],[se.EMBED,x.EMBED],[se.FIELDSET,x.FIELDSET],[se.FIGCAPTION,x.FIGCAPTION],[se.FIGURE,x.FIGURE],[se.FONT,x.FONT],[se.FOOTER,x.FOOTER],[se.FOREIGN_OBJECT,x.FOREIGN_OBJECT],[se.FORM,x.FORM],[se.FRAME,x.FRAME],[se.FRAMESET,x.FRAMESET],[se.H1,x.H1],[se.H2,x.H2],[se.H3,x.H3],[se.H4,x.H4],[se.H5,x.H5],[se.H6,x.H6],[se.HEAD,x.HEAD],[se.HEADER,x.HEADER],[se.HGROUP,x.HGROUP],[se.HR,x.HR],[se.HTML,x.HTML],[se.I,x.I],[se.IMG,x.IMG],[se.IMAGE,x.IMAGE],[se.INPUT,x.INPUT],[se.IFRAME,x.IFRAME],[se.KEYGEN,x.KEYGEN],[se.LABEL,x.LABEL],[se.LI,x.LI],[se.LINK,x.LINK],[se.LISTING,x.LISTING],[se.MAIN,x.MAIN],[se.MALIGNMARK,x.MALIGNMARK],[se.MARQUEE,x.MARQUEE],[se.MATH,x.MATH],[se.MENU,x.MENU],[se.META,x.META],[se.MGLYPH,x.MGLYPH],[se.MI,x.MI],[se.MO,x.MO],[se.MN,x.MN],[se.MS,x.MS],[se.MTEXT,x.MTEXT],[se.NAV,x.NAV],[se.NOBR,x.NOBR],[se.NOFRAMES,x.NOFRAMES],[se.NOEMBED,x.NOEMBED],[se.NOSCRIPT,x.NOSCRIPT],[se.OBJECT,x.OBJECT],[se.OL,x.OL],[se.OPTGROUP,x.OPTGROUP],[se.OPTION,x.OPTION],[se.P,x.P],[se.PARAM,x.PARAM],[se.PLAINTEXT,x.PLAINTEXT],[se.PRE,x.PRE],[se.RB,x.RB],[se.RP,x.RP],[se.RT,x.RT],[se.RTC,x.RTC],[se.RUBY,x.RUBY],[se.S,x.S],[se.SCRIPT,x.SCRIPT],[se.SECTION,x.SECTION],[se.SELECT,x.SELECT],[se.SOURCE,x.SOURCE],[se.SMALL,x.SMALL],[se.SPAN,x.SPAN],[se.STRIKE,x.STRIKE],[se.STRONG,x.STRONG],[se.STYLE,x.STYLE],[se.SUB,x.SUB],[se.SUMMARY,x.SUMMARY],[se.SUP,x.SUP],[se.TABLE,x.TABLE],[se.TBODY,x.TBODY],[se.TEMPLATE,x.TEMPLATE],[se.TEXTAREA,x.TEXTAREA],[se.TFOOT,x.TFOOT],[se.TD,x.TD],[se.TH,x.TH],[se.THEAD,x.THEAD],[se.TITLE,x.TITLE],[se.TR,x.TR],[se.TRACK,x.TRACK],[se.TT,x.TT],[se.U,x.U],[se.UL,x.UL],[se.SVG,x.SVG],[se.VAR,x.VAR],[se.WBR,x.WBR],[se.XMP,x.XMP]]);function xi(e){var t;return(t=Em.get(e))!==null&&t!==void 0?t:x.UNKNOWN}const de=x,mm={[ce.HTML]:new Set([de.ADDRESS,de.APPLET,de.AREA,de.ARTICLE,de.ASIDE,de.BASE,de.BASEFONT,de.BGSOUND,de.BLOCKQUOTE,de.BODY,de.BR,de.BUTTON,de.CAPTION,de.CENTER,de.COL,de.COLGROUP,de.DD,de.DETAILS,de.DIR,de.DIV,de.DL,de.DT,de.EMBED,de.FIELDSET,de.FIGCAPTION,de.FIGURE,de.FOOTER,de.FORM,de.FRAME,de.FRAMESET,de.H1,de.H2,de.H3,de.H4,de.H5,de.H6,de.HEAD,de.HEADER,de.HGROUP,de.HR,de.HTML,de.IFRAME,de.IMG,de.INPUT,de.LI,de.LINK,de.LISTING,de.MAIN,de.MARQUEE,de.MENU,de.META,de.NAV,de.NOEMBED,de.NOFRAMES,de.NOSCRIPT,de.OBJECT,de.OL,de.P,de.PARAM,de.PLAINTEXT,de.PRE,de.SCRIPT,de.SECTION,de.SELECT,de.SOURCE,de.STYLE,de.SUMMARY,de.TABLE,de.TBODY,de.TD,de.TEMPLATE,de.TEXTAREA,de.TFOOT,de.TH,de.THEAD,de.TITLE,de.TR,de.TRACK,de.UL,de.WBR,de.XMP]),[ce.MATHML]:new Set([de.MI,de.MO,de.MN,de.MS,de.MTEXT,de.ANNOTATION_XML]),[ce.SVG]:new Set([de.TITLE,de.FOREIGN_OBJECT,de.DESC]),[ce.XLINK]:new Set,[ce.XML]:new Set,[ce.XMLNS]:new Set};function Ql(e){return e===de.H1||e===de.H2||e===de.H3||e===de.H4||e===de.H5||e===de.H6}const vm=new Set([se.STYLE,se.SCRIPT,se.XMP,se.IFRAME,se.NOEMBED,se.NOFRAMES,se.PLAINTEXT]);function pm(e,t){return vm.has(e)||t&&e===se.NOSCRIPT}const Tm=new Map([[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);var z;(function(e){e[e.DATA=0]="DATA",e[e.RCDATA=1]="RCDATA",e[e.RAWTEXT=2]="RAWTEXT",e[e.SCRIPT_DATA=3]="SCRIPT_DATA",e[e.PLAINTEXT=4]="PLAINTEXT",e[e.TAG_OPEN=5]="TAG_OPEN",e[e.END_TAG_OPEN=6]="END_TAG_OPEN",e[e.TAG_NAME=7]="TAG_NAME",e[e.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",e[e.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",e[e.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",e[e.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",e[e.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",e[e.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",e[e.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",e[e.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",e[e.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",e[e.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",e[e.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",e[e.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",e[e.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",e[e.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",e[e.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",e[e.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",e[e.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",e[e.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",e[e.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",e[e.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",e[e.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",e[e.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",e[e.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",e[e.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",e[e.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",e[e.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",e[e.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",e[e.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",e[e.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",e[e.BOGUS_COMMENT=40]="BOGUS_COMMENT",e[e.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",e[e.COMMENT_START=42]="COMMENT_START",e[e.COMMENT_START_DASH=43]="COMMENT_START_DASH",e[e.COMMENT=44]="COMMENT",e[e.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",e[e.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",e[e.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",e[e.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",e[e.COMMENT_END_DASH=49]="COMMENT_END_DASH",e[e.COMMENT_END=50]="COMMENT_END",e[e.COMMENT_END_BANG=51]="COMMENT_END_BANG",e[e.DOCTYPE=52]="DOCTYPE",e[e.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",e[e.DOCTYPE_NAME=54]="DOCTYPE_NAME",e[e.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",e[e.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",e[e.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",e[e.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",e[e.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",e[e.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",e[e.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",e[e.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",e[e.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",e[e.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",e[e.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",e[e.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",e[e.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",e[e.CDATA_SECTION=68]="CDATA_SECTION",e[e.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",e[e.CDATA_SECTION_END=70]="CDATA_SECTION_END",e[e.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",e[e.NAMED_CHARACTER_REFERENCE=72]="NAMED_CHARACTER_REFERENCE",e[e.AMBIGUOUS_AMPERSAND=73]="AMBIGUOUS_AMPERSAND",e[e.NUMERIC_CHARACTER_REFERENCE=74]="NUMERIC_CHARACTER_REFERENCE",e[e.HEXADEMICAL_CHARACTER_REFERENCE_START=75]="HEXADEMICAL_CHARACTER_REFERENCE_START",e[e.HEXADEMICAL_CHARACTER_REFERENCE=76]="HEXADEMICAL_CHARACTER_REFERENCE",e[e.DECIMAL_CHARACTER_REFERENCE=77]="DECIMAL_CHARACTER_REFERENCE",e[e.NUMERIC_CHARACTER_REFERENCE_END=78]="NUMERIC_CHARACTER_REFERENCE_END"})(z||(z={}));const ut={DATA:z.DATA,RCDATA:z.RCDATA,RAWTEXT:z.RAWTEXT,SCRIPT_DATA:z.SCRIPT_DATA,PLAINTEXT:z.PLAINTEXT,CDATA_SECTION:z.CDATA_SECTION};function nn(e){return e>=$.DIGIT_0&&e<=$.DIGIT_9}function qr(e){return e>=$.LATIN_CAPITAL_A&&e<=$.LATIN_CAPITAL_Z}function _m(e){return e>=$.LATIN_SMALL_A&&e<=$.LATIN_SMALL_Z}function Xt(e){return _m(e)||qr(e)}function Ss(e){return Xt(e)||nn(e)}function $l(e){return e>=$.LATIN_CAPITAL_A&&e<=$.LATIN_CAPITAL_F}function zl(e){return e>=$.LATIN_SMALL_A&&e<=$.LATIN_SMALL_F}function Am(e){return nn(e)||$l(e)||zl(e)}function kn(e){return e+32}function ql(e){return e===$.SPACE||e===$.LINE_FEED||e===$.TABULATION||e===$.FORM_FEED}function ym(e){return e===$.EQUALS_SIGN||Ss(e)}function Ru(e){return ql(e)||e===$.SOLIDUS||e===$.GREATER_THAN_SIGN}let bm=class{constructor(t,r){this.options=t,this.handler=r,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=z.DATA,this.returnState=z.DATA,this.charRefCode=-1,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new gm(r),this.currentLocation=this.getCurrentLocation(-1)}_err(t){var r,n;(n=(r=this.handler).onParseError)===null||n===void 0||n.call(r,this.preprocessor.getError(t))}getCurrentLocation(t){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-t,startOffset:this.preprocessor.offset-t,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const t=this._consume();this._ensureHibernation()||this._callState(t)}this.inLoop=!1}}pause(){this.paused=!0}resume(t){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||t==null||t())}write(t,r,n){this.active=!0,this.preprocessor.write(t,r),this._runParsingLoop(),this.paused||n==null||n()}insertHtmlAtCurrentPos(t){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(t),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this._unconsume(this.consumedAfterSnapshot),this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_unconsume(t){this.consumedAfterSnapshot-=t,this.preprocessor.retreat(t)}_reconsumeInState(t,r){this.state=t,this._callState(r)}_advanceBy(t){this.consumedAfterSnapshot+=t;for(let r=0;r<t;r++)this.preprocessor.advance()}_consumeSequenceIfMatch(t,r){return this.preprocessor.startsWith(t,r)?(this._advanceBy(t.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:Ce.START_TAG,tagName:"",tagID:x.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:Ce.END_TAG,tagName:"",tagID:x.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(t){this.currentToken={type:Ce.COMMENT,data:"",location:this.getCurrentLocation(t)}}_createDoctypeToken(t){this.currentToken={type:Ce.DOCTYPE,name:t,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(t,r){this.currentCharacterToken={type:t,chars:r,location:this.currentLocation}}_createAttr(t){this.currentAttr={name:t,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var t,r;const n=this.currentToken;if(Xl(n,this.currentAttr.name)===null){if(n.attrs.push(this.currentAttr),n.location&&this.currentLocation){const i=(t=(r=n.location).attrs)!==null&&t!==void 0?t:r.attrs=Object.create(null);i[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(oe.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(t){this._emitCurrentCharacterToken(t.location),this.currentToken=null,t.location&&(t.location.endLine=this.preprocessor.line,t.location.endCol=this.preprocessor.col+1,t.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const t=this.currentToken;this.prepareToken(t),t.tagID=xi(t.tagName),t.type===Ce.START_TAG?(this.lastStartTagName=t.tagName,this.handler.onStartTag(t)):(t.attrs.length>0&&this._err(oe.endTagWithAttributes),t.selfClosing&&this._err(oe.endTagWithTrailingSolidus),this.handler.onEndTag(t)),this.preprocessor.dropParsedChunk()}emitCurrentComment(t){this.prepareToken(t),this.handler.onComment(t),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(t){this.prepareToken(t),this.handler.onDoctype(t),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(t){if(this.currentCharacterToken){switch(t&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=t.startLine,this.currentCharacterToken.location.endCol=t.startCol,this.currentCharacterToken.location.endOffset=t.startOffset),this.currentCharacterToken.type){case Ce.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case Ce.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case Ce.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const t=this.getCurrentLocation(0);t&&(t.endLine=t.startLine,t.endCol=t.startCol,t.endOffset=t.startOffset),this._emitCurrentCharacterToken(t),this.handler.onEof({type:Ce.EOF,location:t}),this.active=!1}_appendCharToCurrentCharacterToken(t,r){if(this.currentCharacterToken)if(this.currentCharacterToken.type!==t)this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();else{this.currentCharacterToken.chars+=r;return}this._createCharacterToken(t,r)}_emitCodePoint(t){const r=ql(t)?Ce.WHITESPACE_CHARACTER:t===$.NULL?Ce.NULL_CHARACTER:Ce.CHARACTER;this._appendCharToCurrentCharacterToken(r,String.fromCodePoint(t))}_emitChars(t){this._appendCharToCurrentCharacterToken(Ce.CHARACTER,t)}_matchNamedCharacterReference(t){let r=null,n=0,i=!1;for(let y=0,M=jt[0];y>=0&&(y=al(jt,M,y+1,t),!(y<0));t=this._consume()){n+=1,M=jt[y];const C=M&Kt.VALUE_LENGTH;if(C){const u=(C>>14)-1;if(t!==$.SEMICOLON&&this._isCharacterReferenceInAttribute()&&ym(this.preprocessor.peek(1))?(r=[$.AMPERSAND],y+=u):(r=u===0?[jt[y]&~Kt.VALUE_LENGTH]:u===1?[jt[++y]]:[jt[++y],jt[++y]],n=0,i=t!==$.SEMICOLON),u===0){this._consume();break}}}return this._unconsume(n),i&&!this.preprocessor.endOfChunkHit&&this._err(oe.missingSemicolonAfterCharacterReference),this._unconsume(1),r}_isCharacterReferenceInAttribute(){return this.returnState===z.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===z.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===z.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(t){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(t):this._emitCodePoint(t)}_callState(t){switch(this.state){case z.DATA:{this._stateData(t);break}case z.RCDATA:{this._stateRcdata(t);break}case z.RAWTEXT:{this._stateRawtext(t);break}case z.SCRIPT_DATA:{this._stateScriptData(t);break}case z.PLAINTEXT:{this._statePlaintext(t);break}case z.TAG_OPEN:{this._stateTagOpen(t);break}case z.END_TAG_OPEN:{this._stateEndTagOpen(t);break}case z.TAG_NAME:{this._stateTagName(t);break}case z.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(t);break}case z.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(t);break}case z.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(t);break}case z.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(t);break}case z.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(t);break}case z.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(t);break}case z.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(t);break}case z.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(t);break}case z.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(t);break}case z.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(t);break}case z.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(t);break}case z.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(t);break}case z.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(t);break}case z.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(t);break}case z.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(t);break}case z.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(t);break}case z.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(t);break}case z.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(t);break}case z.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(t);break}case z.ATTRIBUTE_NAME:{this._stateAttributeName(t);break}case z.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(t);break}case z.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(t);break}case z.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(t);break}case z.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(t);break}case z.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(t);break}case z.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(t);break}case z.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(t);break}case z.BOGUS_COMMENT:{this._stateBogusComment(t);break}case z.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(t);break}case z.COMMENT_START:{this._stateCommentStart(t);break}case z.COMMENT_START_DASH:{this._stateCommentStartDash(t);break}case z.COMMENT:{this._stateComment(t);break}case z.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(t);break}case z.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(t);break}case z.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(t);break}case z.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(t);break}case z.COMMENT_END_DASH:{this._stateCommentEndDash(t);break}case z.COMMENT_END:{this._stateCommentEnd(t);break}case z.COMMENT_END_BANG:{this._stateCommentEndBang(t);break}case z.DOCTYPE:{this._stateDoctype(t);break}case z.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(t);break}case z.DOCTYPE_NAME:{this._stateDoctypeName(t);break}case z.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(t);break}case z.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(t);break}case z.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(t);break}case z.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(t);break}case z.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(t);break}case z.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(t);break}case z.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(t);break}case z.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(t);break}case z.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(t);break}case z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(t);break}case z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(t);break}case z.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(t);break}case z.BOGUS_DOCTYPE:{this._stateBogusDoctype(t);break}case z.CDATA_SECTION:{this._stateCdataSection(t);break}case z.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(t);break}case z.CDATA_SECTION_END:{this._stateCdataSectionEnd(t);break}case z.CHARACTER_REFERENCE:{this._stateCharacterReference(t);break}case z.NAMED_CHARACTER_REFERENCE:{this._stateNamedCharacterReference(t);break}case z.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(t);break}case z.NUMERIC_CHARACTER_REFERENCE:{this._stateNumericCharacterReference(t);break}case z.HEXADEMICAL_CHARACTER_REFERENCE_START:{this._stateHexademicalCharacterReferenceStart(t);break}case z.HEXADEMICAL_CHARACTER_REFERENCE:{this._stateHexademicalCharacterReference(t);break}case z.DECIMAL_CHARACTER_REFERENCE:{this._stateDecimalCharacterReference(t);break}case z.NUMERIC_CHARACTER_REFERENCE_END:{this._stateNumericCharacterReferenceEnd(t);break}default:throw new Error("Unknown state")}}_stateData(t){switch(t){case $.LESS_THAN_SIGN:{this.state=z.TAG_OPEN;break}case $.AMPERSAND:{this.returnState=z.DATA,this.state=z.CHARACTER_REFERENCE;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this._emitCodePoint(t);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateRcdata(t){switch(t){case $.AMPERSAND:{this.returnState=z.RCDATA,this.state=z.CHARACTER_REFERENCE;break}case $.LESS_THAN_SIGN:{this.state=z.RCDATA_LESS_THAN_SIGN;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this._emitChars(ke);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateRawtext(t){switch(t){case $.LESS_THAN_SIGN:{this.state=z.RAWTEXT_LESS_THAN_SIGN;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this._emitChars(ke);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptData(t){switch(t){case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_LESS_THAN_SIGN;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this._emitChars(ke);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_statePlaintext(t){switch(t){case $.NULL:{this._err(oe.unexpectedNullCharacter),this._emitChars(ke);break}case $.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateTagOpen(t){if(Xt(t))this._createStartTagToken(),this.state=z.TAG_NAME,this._stateTagName(t);else switch(t){case $.EXCLAMATION_MARK:{this.state=z.MARKUP_DECLARATION_OPEN;break}case $.SOLIDUS:{this.state=z.END_TAG_OPEN;break}case $.QUESTION_MARK:{this._err(oe.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=z.BOGUS_COMMENT,this._stateBogusComment(t);break}case $.EOF:{this._err(oe.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(oe.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=z.DATA,this._stateData(t)}}_stateEndTagOpen(t){if(Xt(t))this._createEndTagToken(),this.state=z.TAG_NAME,this._stateTagName(t);else switch(t){case $.GREATER_THAN_SIGN:{this._err(oe.missingEndTagName),this.state=z.DATA;break}case $.EOF:{this._err(oe.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(oe.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=z.BOGUS_COMMENT,this._stateBogusComment(t)}}_stateTagName(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=z.BEFORE_ATTRIBUTE_NAME;break}case $.SOLIDUS:{this.state=z.SELF_CLOSING_START_TAG;break}case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentTagToken();break}case $.NULL:{this._err(oe.unexpectedNullCharacter),r.tagName+=ke;break}case $.EOF:{this._err(oe.eofInTag),this._emitEOFToken();break}default:r.tagName+=String.fromCodePoint(qr(t)?kn(t):t)}}_stateRcdataLessThanSign(t){t===$.SOLIDUS?this.state=z.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=z.RCDATA,this._stateRcdata(t))}_stateRcdataEndTagOpen(t){Xt(t)?(this.state=z.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(t)):(this._emitChars("</"),this.state=z.RCDATA,this._stateRcdata(t))}handleSpecialEndTag(t){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const r=this.currentToken;switch(r.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=z.BEFORE_ATTRIBUTE_NAME,!1;case $.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=z.SELF_CLOSING_START_TAG,!1;case $.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=z.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=z.RCDATA,this._stateRcdata(t))}_stateRawtextLessThanSign(t){t===$.SOLIDUS?this.state=z.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=z.RAWTEXT,this._stateRawtext(t))}_stateRawtextEndTagOpen(t){Xt(t)?(this.state=z.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(t)):(this._emitChars("</"),this.state=z.RAWTEXT,this._stateRawtext(t))}_stateRawtextEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=z.RAWTEXT,this._stateRawtext(t))}_stateScriptDataLessThanSign(t){switch(t){case $.SOLIDUS:{this.state=z.SCRIPT_DATA_END_TAG_OPEN;break}case $.EXCLAMATION_MARK:{this.state=z.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=z.SCRIPT_DATA,this._stateScriptData(t)}}_stateScriptDataEndTagOpen(t){Xt(t)?(this.state=z.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(t)):(this._emitChars("</"),this.state=z.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=z.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscapeStart(t){t===$.HYPHEN_MINUS?(this.state=z.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=z.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscapeStartDash(t){t===$.HYPHEN_MINUS?(this.state=z.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=z.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscaped(t){switch(t){case $.HYPHEN_MINUS:{this.state=z.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this._emitChars(ke);break}case $.EOF:{this._err(oe.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptDataEscapedDash(t){switch(t){case $.HYPHEN_MINUS:{this.state=z.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this.state=z.SCRIPT_DATA_ESCAPED,this._emitChars(ke);break}case $.EOF:{this._err(oe.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=z.SCRIPT_DATA_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataEscapedDashDash(t){switch(t){case $.HYPHEN_MINUS:{this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case $.GREATER_THAN_SIGN:{this.state=z.SCRIPT_DATA,this._emitChars(">");break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this.state=z.SCRIPT_DATA_ESCAPED,this._emitChars(ke);break}case $.EOF:{this._err(oe.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=z.SCRIPT_DATA_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataEscapedLessThanSign(t){t===$.SOLIDUS?this.state=z.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:Xt(t)?(this._emitChars("<"),this.state=z.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(t)):(this._emitChars("<"),this.state=z.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataEscapedEndTagOpen(t){Xt(t)?(this.state=z.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(t)):(this._emitChars("</"),this.state=z.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataEscapedEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=z.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataDoubleEscapeStart(t){if(this.preprocessor.startsWith(rt.SCRIPT,!1)&&Ru(this.preprocessor.peek(rt.SCRIPT.length))){this._emitCodePoint(t);for(let r=0;r<rt.SCRIPT.length;r++)this._emitCodePoint(this._consume());this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=z.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataDoubleEscaped(t){switch(t){case $.HYPHEN_MINUS:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this._emitChars(ke);break}case $.EOF:{this._err(oe.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedDash(t){switch(t){case $.HYPHEN_MINUS:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(ke);break}case $.EOF:{this._err(oe.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedDashDash(t){switch(t){case $.HYPHEN_MINUS:{this._emitChars("-");break}case $.LESS_THAN_SIGN:{this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case $.GREATER_THAN_SIGN:{this.state=z.SCRIPT_DATA,this._emitChars(">");break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(ke);break}case $.EOF:{this._err(oe.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedLessThanSign(t){t===$.SOLIDUS?(this.state=z.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(t))}_stateScriptDataDoubleEscapeEnd(t){if(this.preprocessor.startsWith(rt.SCRIPT,!1)&&Ru(this.preprocessor.peek(rt.SCRIPT.length))){this._emitCodePoint(t);for(let r=0;r<rt.SCRIPT.length;r++)this._emitCodePoint(this._consume());this.state=z.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=z.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(t))}_stateBeforeAttributeName(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.SOLIDUS:case $.GREATER_THAN_SIGN:case $.EOF:{this.state=z.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(t);break}case $.EQUALS_SIGN:{this._err(oe.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=z.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=z.ATTRIBUTE_NAME,this._stateAttributeName(t)}}_stateAttributeName(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:case $.SOLIDUS:case $.GREATER_THAN_SIGN:case $.EOF:{this._leaveAttrName(),this.state=z.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(t);break}case $.EQUALS_SIGN:{this._leaveAttrName(),this.state=z.BEFORE_ATTRIBUTE_VALUE;break}case $.QUOTATION_MARK:case $.APOSTROPHE:case $.LESS_THAN_SIGN:{this._err(oe.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(t);break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this.currentAttr.name+=ke;break}default:this.currentAttr.name+=String.fromCodePoint(qr(t)?kn(t):t)}}_stateAfterAttributeName(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.SOLIDUS:{this.state=z.SELF_CLOSING_START_TAG;break}case $.EQUALS_SIGN:{this.state=z.BEFORE_ATTRIBUTE_VALUE;break}case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentTagToken();break}case $.EOF:{this._err(oe.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=z.ATTRIBUTE_NAME,this._stateAttributeName(t)}}_stateBeforeAttributeValue(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.QUOTATION_MARK:{this.state=z.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case $.APOSTROPHE:{this.state=z.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(oe.missingAttributeValue),this.state=z.DATA,this.emitCurrentTagToken();break}default:this.state=z.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(t)}}_stateAttributeValueDoubleQuoted(t){switch(t){case $.QUOTATION_MARK:{this.state=z.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case $.AMPERSAND:{this.returnState=z.ATTRIBUTE_VALUE_DOUBLE_QUOTED,this.state=z.CHARACTER_REFERENCE;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this.currentAttr.value+=ke;break}case $.EOF:{this._err(oe.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAttributeValueSingleQuoted(t){switch(t){case $.APOSTROPHE:{this.state=z.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case $.AMPERSAND:{this.returnState=z.ATTRIBUTE_VALUE_SINGLE_QUOTED,this.state=z.CHARACTER_REFERENCE;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this.currentAttr.value+=ke;break}case $.EOF:{this._err(oe.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAttributeValueUnquoted(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this._leaveAttrValue(),this.state=z.BEFORE_ATTRIBUTE_NAME;break}case $.AMPERSAND:{this.returnState=z.ATTRIBUTE_VALUE_UNQUOTED,this.state=z.CHARACTER_REFERENCE;break}case $.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=z.DATA,this.emitCurrentTagToken();break}case $.NULL:{this._err(oe.unexpectedNullCharacter),this.currentAttr.value+=ke;break}case $.QUOTATION_MARK:case $.APOSTROPHE:case $.LESS_THAN_SIGN:case $.EQUALS_SIGN:case $.GRAVE_ACCENT:{this._err(oe.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(t);break}case $.EOF:{this._err(oe.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAfterAttributeValueQuoted(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this._leaveAttrValue(),this.state=z.BEFORE_ATTRIBUTE_NAME;break}case $.SOLIDUS:{this._leaveAttrValue(),this.state=z.SELF_CLOSING_START_TAG;break}case $.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=z.DATA,this.emitCurrentTagToken();break}case $.EOF:{this._err(oe.eofInTag),this._emitEOFToken();break}default:this._err(oe.missingWhitespaceBetweenAttributes),this.state=z.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(t)}}_stateSelfClosingStartTag(t){switch(t){case $.GREATER_THAN_SIGN:{const r=this.currentToken;r.selfClosing=!0,this.state=z.DATA,this.emitCurrentTagToken();break}case $.EOF:{this._err(oe.eofInTag),this._emitEOFToken();break}default:this._err(oe.unexpectedSolidusInTag),this.state=z.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(t)}}_stateBogusComment(t){const r=this.currentToken;switch(t){case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentComment(r);break}case $.EOF:{this.emitCurrentComment(r),this._emitEOFToken();break}case $.NULL:{this._err(oe.unexpectedNullCharacter),r.data+=ke;break}default:r.data+=String.fromCodePoint(t)}}_stateMarkupDeclarationOpen(t){this._consumeSequenceIfMatch(rt.DASH_DASH,!0)?(this._createCommentToken(rt.DASH_DASH.length+1),this.state=z.COMMENT_START):this._consumeSequenceIfMatch(rt.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(rt.DOCTYPE.length+1),this.state=z.DOCTYPE):this._consumeSequenceIfMatch(rt.CDATA_START,!0)?this.inForeignNode?this.state=z.CDATA_SECTION:(this._err(oe.cdataInHtmlContent),this._createCommentToken(rt.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=z.BOGUS_COMMENT):this._ensureHibernation()||(this._err(oe.incorrectlyOpenedComment),this._createCommentToken(2),this.state=z.BOGUS_COMMENT,this._stateBogusComment(t))}_stateCommentStart(t){switch(t){case $.HYPHEN_MINUS:{this.state=z.COMMENT_START_DASH;break}case $.GREATER_THAN_SIGN:{this._err(oe.abruptClosingOfEmptyComment),this.state=z.DATA;const r=this.currentToken;this.emitCurrentComment(r);break}default:this.state=z.COMMENT,this._stateComment(t)}}_stateCommentStartDash(t){const r=this.currentToken;switch(t){case $.HYPHEN_MINUS:{this.state=z.COMMENT_END;break}case $.GREATER_THAN_SIGN:{this._err(oe.abruptClosingOfEmptyComment),this.state=z.DATA,this.emitCurrentComment(r);break}case $.EOF:{this._err(oe.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+="-",this.state=z.COMMENT,this._stateComment(t)}}_stateComment(t){const r=this.currentToken;switch(t){case $.HYPHEN_MINUS:{this.state=z.COMMENT_END_DASH;break}case $.LESS_THAN_SIGN:{r.data+="<",this.state=z.COMMENT_LESS_THAN_SIGN;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),r.data+=ke;break}case $.EOF:{this._err(oe.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+=String.fromCodePoint(t)}}_stateCommentLessThanSign(t){const r=this.currentToken;switch(t){case $.EXCLAMATION_MARK:{r.data+="!",this.state=z.COMMENT_LESS_THAN_SIGN_BANG;break}case $.LESS_THAN_SIGN:{r.data+="<";break}default:this.state=z.COMMENT,this._stateComment(t)}}_stateCommentLessThanSignBang(t){t===$.HYPHEN_MINUS?this.state=z.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=z.COMMENT,this._stateComment(t))}_stateCommentLessThanSignBangDash(t){t===$.HYPHEN_MINUS?this.state=z.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=z.COMMENT_END_DASH,this._stateCommentEndDash(t))}_stateCommentLessThanSignBangDashDash(t){t!==$.GREATER_THAN_SIGN&&t!==$.EOF&&this._err(oe.nestedComment),this.state=z.COMMENT_END,this._stateCommentEnd(t)}_stateCommentEndDash(t){const r=this.currentToken;switch(t){case $.HYPHEN_MINUS:{this.state=z.COMMENT_END;break}case $.EOF:{this._err(oe.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+="-",this.state=z.COMMENT,this._stateComment(t)}}_stateCommentEnd(t){const r=this.currentToken;switch(t){case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentComment(r);break}case $.EXCLAMATION_MARK:{this.state=z.COMMENT_END_BANG;break}case $.HYPHEN_MINUS:{r.data+="-";break}case $.EOF:{this._err(oe.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+="--",this.state=z.COMMENT,this._stateComment(t)}}_stateCommentEndBang(t){const r=this.currentToken;switch(t){case $.HYPHEN_MINUS:{r.data+="--!",this.state=z.COMMENT_END_DASH;break}case $.GREATER_THAN_SIGN:{this._err(oe.incorrectlyClosedComment),this.state=z.DATA,this.emitCurrentComment(r);break}case $.EOF:{this._err(oe.eofInComment),this.emitCurrentComment(r),this._emitEOFToken();break}default:r.data+="--!",this.state=z.COMMENT,this._stateComment(t)}}_stateDoctype(t){switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=z.BEFORE_DOCTYPE_NAME;break}case $.GREATER_THAN_SIGN:{this.state=z.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(t);break}case $.EOF:{this._err(oe.eofInDoctype),this._createDoctypeToken(null);const r=this.currentToken;r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(oe.missingWhitespaceBeforeDoctypeName),this.state=z.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(t)}}_stateBeforeDoctypeName(t){if(qr(t))this._createDoctypeToken(String.fromCharCode(kn(t))),this.state=z.DOCTYPE_NAME;else switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.NULL:{this._err(oe.unexpectedNullCharacter),this._createDoctypeToken(ke),this.state=z.DOCTYPE_NAME;break}case $.GREATER_THAN_SIGN:{this._err(oe.missingDoctypeName),this._createDoctypeToken(null);const r=this.currentToken;r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.EOF:{this._err(oe.eofInDoctype),this._createDoctypeToken(null);const r=this.currentToken;r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(t)),this.state=z.DOCTYPE_NAME}}_stateDoctypeName(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=z.AFTER_DOCTYPE_NAME;break}case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.NULL:{this._err(oe.unexpectedNullCharacter),r.name+=ke;break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.name+=String.fromCodePoint(qr(t)?kn(t):t)}}_stateAfterDoctypeName(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(rt.PUBLIC,!1)?this.state=z.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(rt.SYSTEM,!1)?this.state=z.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(oe.invalidCharacterSequenceAfterDoctypeName),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t))}}_stateAfterDoctypePublicKeyword(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=z.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case $.QUOTATION_MARK:{this._err(oe.missingWhitespaceAfterDoctypePublicKeyword),r.publicId="",this.state=z.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{this._err(oe.missingWhitespaceAfterDoctypePublicKeyword),r.publicId="",this.state=z.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(oe.missingDoctypePublicIdentifier),r.forceQuirks=!0,this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(oe.missingQuoteBeforeDoctypePublicIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBeforeDoctypePublicIdentifier(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.QUOTATION_MARK:{r.publicId="",this.state=z.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{r.publicId="",this.state=z.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(oe.missingDoctypePublicIdentifier),r.forceQuirks=!0,this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(oe.missingQuoteBeforeDoctypePublicIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateDoctypePublicIdentifierDoubleQuoted(t){const r=this.currentToken;switch(t){case $.QUOTATION_MARK:{this.state=z.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),r.publicId+=ke;break}case $.GREATER_THAN_SIGN:{this._err(oe.abruptDoctypePublicIdentifier),r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.publicId+=String.fromCodePoint(t)}}_stateDoctypePublicIdentifierSingleQuoted(t){const r=this.currentToken;switch(t){case $.APOSTROPHE:{this.state=z.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),r.publicId+=ke;break}case $.GREATER_THAN_SIGN:{this._err(oe.abruptDoctypePublicIdentifier),r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.publicId+=String.fromCodePoint(t)}}_stateAfterDoctypePublicIdentifier(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=z.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case $.GREATER_THAN_SIGN:{this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.QUOTATION_MARK:{this._err(oe.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{this._err(oe.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(oe.missingQuoteBeforeDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBetweenDoctypePublicAndSystemIdentifiers(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.GREATER_THAN_SIGN:{this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.QUOTATION_MARK:{r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(oe.missingQuoteBeforeDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateAfterDoctypeSystemKeyword(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:{this.state=z.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case $.QUOTATION_MARK:{this._err(oe.missingWhitespaceAfterDoctypeSystemKeyword),r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{this._err(oe.missingWhitespaceAfterDoctypeSystemKeyword),r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(oe.missingDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(oe.missingQuoteBeforeDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBeforeDoctypeSystemIdentifier(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.QUOTATION_MARK:{r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case $.APOSTROPHE:{r.systemId="",this.state=z.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case $.GREATER_THAN_SIGN:{this._err(oe.missingDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.DATA,this.emitCurrentDoctype(r);break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(oe.missingQuoteBeforeDoctypeSystemIdentifier),r.forceQuirks=!0,this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateDoctypeSystemIdentifierDoubleQuoted(t){const r=this.currentToken;switch(t){case $.QUOTATION_MARK:{this.state=z.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),r.systemId+=ke;break}case $.GREATER_THAN_SIGN:{this._err(oe.abruptDoctypeSystemIdentifier),r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.systemId+=String.fromCodePoint(t)}}_stateDoctypeSystemIdentifierSingleQuoted(t){const r=this.currentToken;switch(t){case $.APOSTROPHE:{this.state=z.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case $.NULL:{this._err(oe.unexpectedNullCharacter),r.systemId+=ke;break}case $.GREATER_THAN_SIGN:{this._err(oe.abruptDoctypeSystemIdentifier),r.forceQuirks=!0,this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:r.systemId+=String.fromCodePoint(t)}}_stateAfterDoctypeSystemIdentifier(t){const r=this.currentToken;switch(t){case $.SPACE:case $.LINE_FEED:case $.TABULATION:case $.FORM_FEED:break;case $.GREATER_THAN_SIGN:{this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.EOF:{this._err(oe.eofInDoctype),r.forceQuirks=!0,this.emitCurrentDoctype(r),this._emitEOFToken();break}default:this._err(oe.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=z.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBogusDoctype(t){const r=this.currentToken;switch(t){case $.GREATER_THAN_SIGN:{this.emitCurrentDoctype(r),this.state=z.DATA;break}case $.NULL:{this._err(oe.unexpectedNullCharacter);break}case $.EOF:{this.emitCurrentDoctype(r),this._emitEOFToken();break}}}_stateCdataSection(t){switch(t){case $.RIGHT_SQUARE_BRACKET:{this.state=z.CDATA_SECTION_BRACKET;break}case $.EOF:{this._err(oe.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateCdataSectionBracket(t){t===$.RIGHT_SQUARE_BRACKET?this.state=z.CDATA_SECTION_END:(this._emitChars("]"),this.state=z.CDATA_SECTION,this._stateCdataSection(t))}_stateCdataSectionEnd(t){switch(t){case $.GREATER_THAN_SIGN:{this.state=z.DATA;break}case $.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=z.CDATA_SECTION,this._stateCdataSection(t)}}_stateCharacterReference(t){t===$.NUMBER_SIGN?this.state=z.NUMERIC_CHARACTER_REFERENCE:Ss(t)?(this.state=z.NAMED_CHARACTER_REFERENCE,this._stateNamedCharacterReference(t)):(this._flushCodePointConsumedAsCharacterReference($.AMPERSAND),this._reconsumeInState(this.returnState,t))}_stateNamedCharacterReference(t){const r=this._matchNamedCharacterReference(t);if(!this._ensureHibernation())if(r){for(let n=0;n<r.length;n++)this._flushCodePointConsumedAsCharacterReference(r[n]);this.state=this.returnState}else this._flushCodePointConsumedAsCharacterReference($.AMPERSAND),this.state=z.AMBIGUOUS_AMPERSAND}_stateAmbiguousAmpersand(t){Ss(t)?this._flushCodePointConsumedAsCharacterReference(t):(t===$.SEMICOLON&&this._err(oe.unknownNamedCharacterReference),this._reconsumeInState(this.returnState,t))}_stateNumericCharacterReference(t){this.charRefCode=0,t===$.LATIN_SMALL_X||t===$.LATIN_CAPITAL_X?this.state=z.HEXADEMICAL_CHARACTER_REFERENCE_START:nn(t)?(this.state=z.DECIMAL_CHARACTER_REFERENCE,this._stateDecimalCharacterReference(t)):(this._err(oe.absenceOfDigitsInNumericCharacterReference),this._flushCodePointConsumedAsCharacterReference($.AMPERSAND),this._flushCodePointConsumedAsCharacterReference($.NUMBER_SIGN),this._reconsumeInState(this.returnState,t))}_stateHexademicalCharacterReferenceStart(t){Am(t)?(this.state=z.HEXADEMICAL_CHARACTER_REFERENCE,this._stateHexademicalCharacterReference(t)):(this._err(oe.absenceOfDigitsInNumericCharacterReference),this._flushCodePointConsumedAsCharacterReference($.AMPERSAND),this._flushCodePointConsumedAsCharacterReference($.NUMBER_SIGN),this._unconsume(2),this.state=this.returnState)}_stateHexademicalCharacterReference(t){$l(t)?this.charRefCode=this.charRefCode*16+t-55:zl(t)?this.charRefCode=this.charRefCode*16+t-87:nn(t)?this.charRefCode=this.charRefCode*16+t-48:t===$.SEMICOLON?this.state=z.NUMERIC_CHARACTER_REFERENCE_END:(this._err(oe.missingSemicolonAfterCharacterReference),this.state=z.NUMERIC_CHARACTER_REFERENCE_END,this._stateNumericCharacterReferenceEnd(t))}_stateDecimalCharacterReference(t){nn(t)?this.charRefCode=this.charRefCode*10+t-48:t===$.SEMICOLON?this.state=z.NUMERIC_CHARACTER_REFERENCE_END:(this._err(oe.missingSemicolonAfterCharacterReference),this.state=z.NUMERIC_CHARACTER_REFERENCE_END,this._stateNumericCharacterReferenceEnd(t))}_stateNumericCharacterReferenceEnd(t){if(this.charRefCode===$.NULL)this._err(oe.nullCharacterReference),this.charRefCode=$.REPLACEMENT_CHARACTER;else if(this.charRefCode>1114111)this._err(oe.characterReferenceOutsideUnicodeRange),this.charRefCode=$.REPLACEMENT_CHARACTER;else if(Yl(this.charRefCode))this._err(oe.surrogateCharacterReference),this.charRefCode=$.REPLACEMENT_CHARACTER;else if(jl(this.charRefCode))this._err(oe.noncharacterCharacterReference);else if(Vl(this.charRefCode)||this.charRefCode===$.CARRIAGE_RETURN){this._err(oe.controlCharacterReference);const r=Tm.get(this.charRefCode);r!==void 0&&(this.charRefCode=r)}this._flushCodePointConsumedAsCharacterReference(this.charRefCode),this._reconsumeInState(this.returnState,t)}};const Jl=new Set([x.DD,x.DT,x.LI,x.OPTGROUP,x.OPTION,x.P,x.RB,x.RP,x.RT,x.RTC]),Ou=new Set([...Jl,x.CAPTION,x.COLGROUP,x.TBODY,x.TD,x.TFOOT,x.TH,x.THEAD,x.TR]),Bn=new Map([[x.APPLET,ce.HTML],[x.CAPTION,ce.HTML],[x.HTML,ce.HTML],[x.MARQUEE,ce.HTML],[x.OBJECT,ce.HTML],[x.TABLE,ce.HTML],[x.TD,ce.HTML],[x.TEMPLATE,ce.HTML],[x.TH,ce.HTML],[x.ANNOTATION_XML,ce.MATHML],[x.MI,ce.MATHML],[x.MN,ce.MATHML],[x.MO,ce.MATHML],[x.MS,ce.MATHML],[x.MTEXT,ce.MATHML],[x.DESC,ce.SVG],[x.FOREIGN_OBJECT,ce.SVG],[x.TITLE,ce.SVG]]),Sm=[x.H1,x.H2,x.H3,x.H4,x.H5,x.H6],Im=[x.TR,x.TEMPLATE,x.HTML],xm=[x.TBODY,x.TFOOT,x.THEAD,x.TEMPLATE,x.HTML],Cm=[x.TABLE,x.TEMPLATE,x.HTML],Lm=[x.TD,x.TH];class Dm{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(t,r,n){this.treeAdapter=r,this.handler=n,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=x.UNKNOWN,this.current=t}_indexOf(t){return this.items.lastIndexOf(t,this.stackTop)}_isInTemplate(){return this.currentTagId===x.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===ce.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(t,r){this.stackTop++,this.items[this.stackTop]=t,this.current=t,this.tagIDs[this.stackTop]=r,this.currentTagId=r,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(t,r,!0)}pop(){const t=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,!0)}replace(t,r){const n=this._indexOf(t);this.items[n]=r,n===this.stackTop&&(this.current=r)}insertAfter(t,r,n){const i=this._indexOf(t)+1;this.items.splice(i,0,r),this.tagIDs.splice(i,0,n),this.stackTop++,i===this.stackTop&&this._updateCurrentElement(),this.handler.onItemPush(this.current,this.currentTagId,i===this.stackTop)}popUntilTagNamePopped(t){let r=this.stackTop+1;do r=this.tagIDs.lastIndexOf(t,r-1);while(r>0&&this.treeAdapter.getNamespaceURI(this.items[r])!==ce.HTML);this.shortenToLength(r<0?0:r)}shortenToLength(t){for(;this.stackTop>=t;){const r=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(r,this.stackTop<t)}}popUntilElementPopped(t){const r=this._indexOf(t);this.shortenToLength(r<0?0:r)}popUntilPopped(t,r){const n=this._indexOfTagNames(t,r);this.shortenToLength(n<0?0:n)}popUntilNumberedHeaderPopped(){this.popUntilPopped(Sm,ce.HTML)}popUntilTableCellPopped(){this.popUntilPopped(Lm,ce.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(t,r){for(let n=this.stackTop;n>=0;n--)if(t.includes(this.tagIDs[n])&&this.treeAdapter.getNamespaceURI(this.items[n])===r)return n;return-1}clearBackTo(t,r){const n=this._indexOfTagNames(t,r);this.shortenToLength(n+1)}clearBackToTableContext(){this.clearBackTo(Cm,ce.HTML)}clearBackToTableBodyContext(){this.clearBackTo(xm,ce.HTML)}clearBackToTableRowContext(){this.clearBackTo(Im,ce.HTML)}remove(t){const r=this._indexOf(t);r>=0&&(r===this.stackTop?this.pop():(this.items.splice(r,1),this.tagIDs.splice(r,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===x.BODY?this.items[1]:null}contains(t){return this._indexOf(t)>-1}getCommonAncestor(t){const r=this._indexOf(t)-1;return r>=0?this.items[r]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===x.HTML}hasInScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r],i=this.treeAdapter.getNamespaceURI(this.items[r]);if(n===t&&i===ce.HTML)return!0;if(Bn.get(n)===i)return!1}return!0}hasNumberedHeaderInScope(){for(let t=this.stackTop;t>=0;t--){const r=this.tagIDs[t],n=this.treeAdapter.getNamespaceURI(this.items[t]);if(Ql(r)&&n===ce.HTML)return!0;if(Bn.get(r)===n)return!1}return!0}hasInListItemScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r],i=this.treeAdapter.getNamespaceURI(this.items[r]);if(n===t&&i===ce.HTML)return!0;if((n===x.UL||n===x.OL)&&i===ce.HTML||Bn.get(n)===i)return!1}return!0}hasInButtonScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r],i=this.treeAdapter.getNamespaceURI(this.items[r]);if(n===t&&i===ce.HTML)return!0;if(n===x.BUTTON&&i===ce.HTML||Bn.get(n)===i)return!1}return!0}hasInTableScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r];if(this.treeAdapter.getNamespaceURI(this.items[r])===ce.HTML){if(n===t)return!0;if(n===x.TABLE||n===x.TEMPLATE||n===x.HTML)return!1}}return!0}hasTableBodyContextInTableScope(){for(let t=this.stackTop;t>=0;t--){const r=this.tagIDs[t];if(this.treeAdapter.getNamespaceURI(this.items[t])===ce.HTML){if(r===x.TBODY||r===x.THEAD||r===x.TFOOT)return!0;if(r===x.TABLE||r===x.HTML)return!1}}return!0}hasInSelectScope(t){for(let r=this.stackTop;r>=0;r--){const n=this.tagIDs[r];if(this.treeAdapter.getNamespaceURI(this.items[r])===ce.HTML){if(n===t)return!0;if(n!==x.OPTION&&n!==x.OPTGROUP)return!1}}return!0}generateImpliedEndTags(){for(;Jl.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;Ou.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(t){for(;this.currentTagId!==t&&Ou.has(this.currentTagId);)this.pop()}}const Zi=3;var _t;(function(e){e[e.Marker=0]="Marker",e[e.Element=1]="Element"})(_t=_t||(_t={}));const Pu={type:_t.Marker};class Rm{constructor(t){this.treeAdapter=t,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(t,r){const n=[],i=r.length,y=this.treeAdapter.getTagName(t),M=this.treeAdapter.getNamespaceURI(t);for(let C=0;C<this.entries.length;C++){const u=this.entries[C];if(u.type===_t.Marker)break;const{element:R}=u;if(this.treeAdapter.getTagName(R)===y&&this.treeAdapter.getNamespaceURI(R)===M){const _=this.treeAdapter.getAttrList(R);_.length===i&&n.push({idx:C,attrs:_})}}return n}_ensureNoahArkCondition(t){if(this.entries.length<Zi)return;const r=this.treeAdapter.getAttrList(t),n=this._getNoahArkConditionCandidates(t,r);if(n.length<Zi)return;const i=new Map(r.map(M=>[M.name,M.value]));let y=0;for(let M=0;M<n.length;M++){const C=n[M];C.attrs.every(u=>i.get(u.name)===u.value)&&(y+=1,y>=Zi&&this.entries.splice(C.idx,1))}}insertMarker(){this.entries.unshift(Pu)}pushElement(t,r){this._ensureNoahArkCondition(t),this.entries.unshift({type:_t.Element,element:t,token:r})}insertElementAfterBookmark(t,r){const n=this.entries.indexOf(this.bookmark);this.entries.splice(n,0,{type:_t.Element,element:t,token:r})}removeEntry(t){const r=this.entries.indexOf(t);r>=0&&this.entries.splice(r,1)}clearToLastMarker(){const t=this.entries.indexOf(Pu);t>=0?this.entries.splice(0,t+1):this.entries.length=0}getElementEntryInScopeWithTagName(t){const r=this.entries.find(n=>n.type===_t.Marker||this.treeAdapter.getTagName(n.element)===t);return r&&r.type===_t.Element?r:null}getElementEntry(t){return this.entries.find(r=>r.type===_t.Element&&r.element===t)}}function Nu(e){return{nodeName:"#text",value:e,parentNode:null}}const lr={createDocument(){return{nodeName:"#document",mode:at.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(e,t,r){return{nodeName:e,tagName:e,attrs:r,namespaceURI:t,childNodes:[],parentNode:null}},createCommentNode(e){return{nodeName:"#comment",data:e,parentNode:null}},appendChild(e,t){e.childNodes.push(t),t.parentNode=e},insertBefore(e,t,r){const n=e.childNodes.indexOf(r);e.childNodes.splice(n,0,t),t.parentNode=e},setTemplateContent(e,t){e.content=t},getTemplateContent(e){return e.content},setDocumentType(e,t,r,n){const i=e.childNodes.find(y=>y.nodeName==="#documentType");if(i)i.name=t,i.publicId=r,i.systemId=n;else{const y={nodeName:"#documentType",name:t,publicId:r,systemId:n,parentNode:null};lr.appendChild(e,y)}},setDocumentMode(e,t){e.mode=t},getDocumentMode(e){return e.mode},detachNode(e){if(e.parentNode){const t=e.parentNode.childNodes.indexOf(e);e.parentNode.childNodes.splice(t,1),e.parentNode=null}},insertText(e,t){if(e.childNodes.length>0){const r=e.childNodes[e.childNodes.length-1];if(lr.isTextNode(r)){r.value+=t;return}}lr.appendChild(e,Nu(t))},insertTextBefore(e,t,r){const n=e.childNodes[e.childNodes.indexOf(r)-1];n&&lr.isTextNode(n)?n.value+=t:lr.insertBefore(e,Nu(t),r)},adoptAttributes(e,t){const r=new Set(e.attrs.map(n=>n.name));for(let n=0;n<t.length;n++)r.has(t[n].name)||e.attrs.push(t[n])},getFirstChild(e){return e.childNodes[0]},getChildNodes(e){return e.childNodes},getParentNode(e){return e.parentNode},getAttrList(e){return e.attrs},getTagName(e){return e.tagName},getNamespaceURI(e){return e.namespaceURI},getTextNodeContent(e){return e.value},getCommentNodeContent(e){return e.data},getDocumentTypeNodeName(e){return e.name},getDocumentTypeNodePublicId(e){return e.publicId},getDocumentTypeNodeSystemId(e){return e.systemId},isTextNode(e){return e.nodeName==="#text"},isCommentNode(e){return e.nodeName==="#comment"},isDocumentTypeNode(e){return e.nodeName==="#documentType"},isElementNode(e){return Object.prototype.hasOwnProperty.call(e,"tagName")},setNodeSourceCodeLocation(e,t){e.sourceCodeLocation=t},getNodeSourceCodeLocation(e){return e.sourceCodeLocation},updateNodeSourceCodeLocation(e,t){e.sourceCodeLocation={...e.sourceCodeLocation,...t}}},Zl="html",Om="about:legacy-compat",Pm="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",ec=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],Nm=[...ec,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],Mm=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),tc=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],Fm=[...tc,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function Mu(e,t){return t.some(r=>e.startsWith(r))}function km(e){return e.name===Zl&&e.publicId===null&&(e.systemId===null||e.systemId===Om)}function Bm(e){if(e.name!==Zl)return at.QUIRKS;const{systemId:t}=e;if(t&&t.toLowerCase()===Pm)return at.QUIRKS;let{publicId:r}=e;if(r!==null){if(r=r.toLowerCase(),Mm.has(r))return at.QUIRKS;let n=t===null?Nm:ec;if(Mu(r,n))return at.QUIRKS;if(n=t===null?tc:Fm,Mu(r,n))return at.LIMITED_QUIRKS}return at.NO_QUIRKS}const Fu={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},Um="definitionurl",wm="definitionURL",Hm=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),Km=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:ce.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:ce.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:ce.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:ce.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:ce.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:ce.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:ce.XLINK}],["xml:base",{prefix:"xml",name:"base",namespace:ce.XML}],["xml:lang",{prefix:"xml",name:"lang",namespace:ce.XML}],["xml:space",{prefix:"xml",name:"space",namespace:ce.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:ce.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:ce.XMLNS}]]),Wm=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(e=>[e.toLowerCase(),e])),Gm=new Set([x.B,x.BIG,x.BLOCKQUOTE,x.BODY,x.BR,x.CENTER,x.CODE,x.DD,x.DIV,x.DL,x.DT,x.EM,x.EMBED,x.H1,x.H2,x.H3,x.H4,x.H5,x.H6,x.HEAD,x.HR,x.I,x.IMG,x.LI,x.LISTING,x.MENU,x.META,x.NOBR,x.OL,x.P,x.PRE,x.RUBY,x.S,x.SMALL,x.SPAN,x.STRONG,x.STRIKE,x.SUB,x.SUP,x.TABLE,x.TT,x.U,x.UL,x.VAR]);function Ym(e){const t=e.tagID;return t===x.FONT&&e.attrs.some(({name:n})=>n===Jt.COLOR||n===Jt.SIZE||n===Jt.FACE)||Gm.has(t)}function rc(e){for(let t=0;t<e.attrs.length;t++)if(e.attrs[t].name===Um){e.attrs[t].name=wm;break}}function nc(e){for(let t=0;t<e.attrs.length;t++){const r=Hm.get(e.attrs[t].name);r!=null&&(e.attrs[t].name=r)}}function ha(e){for(let t=0;t<e.attrs.length;t++){const r=Km.get(e.attrs[t].name);r&&(e.attrs[t].prefix=r.prefix,e.attrs[t].name=r.name,e.attrs[t].namespace=r.namespace)}}function Vm(e){const t=Wm.get(e.tagName);t!=null&&(e.tagName=t,e.tagID=xi(e.tagName))}function jm(e,t){return t===ce.MATHML&&(e===x.MI||e===x.MO||e===x.MN||e===x.MS||e===x.MTEXT)}function Xm(e,t,r){if(t===ce.MATHML&&e===x.ANNOTATION_XML){for(let n=0;n<r.length;n++)if(r[n].name===Jt.ENCODING){const i=r[n].value.toLowerCase();return i===Fu.TEXT_HTML||i===Fu.APPLICATION_XML}}return t===ce.SVG&&(e===x.FOREIGN_OBJECT||e===x.DESC||e===x.TITLE)}function Qm(e,t,r,n){return(!n||n===ce.HTML)&&Xm(e,t,r)||(!n||n===ce.MATHML)&&jm(e,t)}const $m="hidden",zm=8,qm=3;var te;(function(e){e[e.INITIAL=0]="INITIAL",e[e.BEFORE_HTML=1]="BEFORE_HTML",e[e.BEFORE_HEAD=2]="BEFORE_HEAD",e[e.IN_HEAD=3]="IN_HEAD",e[e.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",e[e.AFTER_HEAD=5]="AFTER_HEAD",e[e.IN_BODY=6]="IN_BODY",e[e.TEXT=7]="TEXT",e[e.IN_TABLE=8]="IN_TABLE",e[e.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",e[e.IN_CAPTION=10]="IN_CAPTION",e[e.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",e[e.IN_TABLE_BODY=12]="IN_TABLE_BODY",e[e.IN_ROW=13]="IN_ROW",e[e.IN_CELL=14]="IN_CELL",e[e.IN_SELECT=15]="IN_SELECT",e[e.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",e[e.IN_TEMPLATE=17]="IN_TEMPLATE",e[e.AFTER_BODY=18]="AFTER_BODY",e[e.IN_FRAMESET=19]="IN_FRAMESET",e[e.AFTER_FRAMESET=20]="AFTER_FRAMESET",e[e.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",e[e.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(te||(te={}));const Jm={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},ic=new Set([x.TABLE,x.TBODY,x.TFOOT,x.THEAD,x.TR]),ku={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:lr,onParseError:null};let sc=class{constructor(t,r,n=null,i=null){this.fragmentContext=n,this.scriptHandler=i,this.currentToken=null,this.stopped=!1,this.insertionMode=te.INITIAL,this.originalInsertionMode=te.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...ku,...t},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=r??this.treeAdapter.createDocument(),this.tokenizer=new bm(this.options,this),this.activeFormattingElements=new Rm(this.treeAdapter),this.fragmentContextID=n?xi(this.treeAdapter.getTagName(n)):x.UNKNOWN,this._setContextModes(n??this.document,this.fragmentContextID),this.openElements=new Dm(this.document,this.treeAdapter,this)}static parse(t,r){const n=new this(r);return n.tokenizer.write(t,!0),n.document}static getFragmentParser(t,r){const n={...ku,...r};t??(t=n.treeAdapter.createElement(se.TEMPLATE,ce.HTML,[]));const i=n.treeAdapter.createElement("documentmock",ce.HTML,[]),y=new this(n,i,t);return y.fragmentContextID===x.TEMPLATE&&y.tmplInsertionModeStack.unshift(te.IN_TEMPLATE),y._initTokenizerForFragmentParsing(),y._insertFakeRootElement(),y._resetInsertionMode(),y._findFormInFragmentContext(),y}getFragment(){const t=this.treeAdapter.getFirstChild(this.document),r=this.treeAdapter.createDocumentFragment();return this._adoptNodes(t,r),r}_err(t,r,n){var i;if(!this.onParseError)return;const y=(i=t.location)!==null&&i!==void 0?i:Jm,M={code:r,startLine:y.startLine,startCol:y.startCol,startOffset:y.startOffset,endLine:n?y.startLine:y.endLine,endCol:n?y.startCol:y.endCol,endOffset:n?y.startOffset:y.endOffset};this.onParseError(M)}onItemPush(t,r,n){var i,y;(y=(i=this.treeAdapter).onItemPush)===null||y===void 0||y.call(i,t),n&&this.openElements.stackTop>0&&this._setContextModes(t,r)}onItemPop(t,r){var n,i;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(t,this.currentToken),(i=(n=this.treeAdapter).onItemPop)===null||i===void 0||i.call(n,t,this.openElements.current),r){let y,M;this.openElements.stackTop===0&&this.fragmentContext?(y=this.fragmentContext,M=this.fragmentContextID):{current:y,currentTagId:M}=this.openElements,this._setContextModes(y,M)}}_setContextModes(t,r){const n=t===this.document||this.treeAdapter.getNamespaceURI(t)===ce.HTML;this.currentNotInHTML=!n,this.tokenizer.inForeignNode=!n&&!this._isIntegrationPoint(r,t)}_switchToTextParsing(t,r){this._insertElement(t,ce.HTML),this.tokenizer.state=r,this.originalInsertionMode=this.insertionMode,this.insertionMode=te.TEXT}switchToPlaintextParsing(){this.insertionMode=te.TEXT,this.originalInsertionMode=te.IN_BODY,this.tokenizer.state=ut.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let t=this.fragmentContext;for(;t;){if(this.treeAdapter.getTagName(t)===se.FORM){this.formElement=t;break}t=this.treeAdapter.getParentNode(t)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==ce.HTML))switch(this.fragmentContextID){case x.TITLE:case x.TEXTAREA:{this.tokenizer.state=ut.RCDATA;break}case x.STYLE:case x.XMP:case x.IFRAME:case x.NOEMBED:case x.NOFRAMES:case x.NOSCRIPT:{this.tokenizer.state=ut.RAWTEXT;break}case x.SCRIPT:{this.tokenizer.state=ut.SCRIPT_DATA;break}case x.PLAINTEXT:{this.tokenizer.state=ut.PLAINTEXT;break}}}_setDocumentType(t){const r=t.name||"",n=t.publicId||"",i=t.systemId||"";if(this.treeAdapter.setDocumentType(this.document,r,n,i),t.location){const M=this.treeAdapter.getChildNodes(this.document).find(C=>this.treeAdapter.isDocumentTypeNode(C));M&&this.treeAdapter.setNodeSourceCodeLocation(M,t.location)}}_attachElementToTree(t,r){if(this.options.sourceCodeLocationInfo){const n=r&&{...r,startTag:r};this.treeAdapter.setNodeSourceCodeLocation(t,n)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(t);else{const n=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(n,t)}}_appendElement(t,r){const n=this.treeAdapter.createElement(t.tagName,r,t.attrs);this._attachElementToTree(n,t.location)}_insertElement(t,r){const n=this.treeAdapter.createElement(t.tagName,r,t.attrs);this._attachElementToTree(n,t.location),this.openElements.push(n,t.tagID)}_insertFakeElement(t,r){const n=this.treeAdapter.createElement(t,ce.HTML,[]);this._attachElementToTree(n,null),this.openElements.push(n,r)}_insertTemplate(t){const r=this.treeAdapter.createElement(t.tagName,ce.HTML,t.attrs),n=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(r,n),this._attachElementToTree(r,t.location),this.openElements.push(r,t.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(n,null)}_insertFakeRootElement(){const t=this.treeAdapter.createElement(se.HTML,ce.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(t,null),this.treeAdapter.appendChild(this.openElements.current,t),this.openElements.push(t,x.HTML)}_appendCommentNode(t,r){const n=this.treeAdapter.createCommentNode(t.data);this.treeAdapter.appendChild(r,n),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(n,t.location)}_insertCharacters(t){let r,n;if(this._shouldFosterParentOnInsertion()?({parent:r,beforeElement:n}=this._findFosterParentingLocation(),n?this.treeAdapter.insertTextBefore(r,t.chars,n):this.treeAdapter.insertText(r,t.chars)):(r=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(r,t.chars)),!t.location)return;const i=this.treeAdapter.getChildNodes(r),y=n?i.lastIndexOf(n):i.length,M=i[y-1];if(this.treeAdapter.getNodeSourceCodeLocation(M)){const{endLine:u,endCol:R,endOffset:_}=t.location;this.treeAdapter.updateNodeSourceCodeLocation(M,{endLine:u,endCol:R,endOffset:_})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(M,t.location)}_adoptNodes(t,r){for(let n=this.treeAdapter.getFirstChild(t);n;n=this.treeAdapter.getFirstChild(t))this.treeAdapter.detachNode(n),this.treeAdapter.appendChild(r,n)}_setEndLocation(t,r){if(this.treeAdapter.getNodeSourceCodeLocation(t)&&r.location){const n=r.location,i=this.treeAdapter.getTagName(t),y=r.type===Ce.END_TAG&&i===r.tagName?{endTag:{...n},endLine:n.endLine,endCol:n.endCol,endOffset:n.endOffset}:{endLine:n.startLine,endCol:n.startCol,endOffset:n.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(t,y)}}shouldProcessStartTagTokenInForeignContent(t){if(!this.currentNotInHTML)return!1;let r,n;return this.openElements.stackTop===0&&this.fragmentContext?(r=this.fragmentContext,n=this.fragmentContextID):{current:r,currentTagId:n}=this.openElements,t.tagID===x.SVG&&this.treeAdapter.getTagName(r)===se.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(r)===ce.MATHML?!1:this.tokenizer.inForeignNode||(t.tagID===x.MGLYPH||t.tagID===x.MALIGNMARK)&&!this._isIntegrationPoint(n,r,ce.HTML)}_processToken(t){switch(t.type){case Ce.CHARACTER:{this.onCharacter(t);break}case Ce.NULL_CHARACTER:{this.onNullCharacter(t);break}case Ce.COMMENT:{this.onComment(t);break}case Ce.DOCTYPE:{this.onDoctype(t);break}case Ce.START_TAG:{this._processStartTag(t);break}case Ce.END_TAG:{this.onEndTag(t);break}case Ce.EOF:{this.onEof(t);break}case Ce.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(t);break}}}_isIntegrationPoint(t,r,n){const i=this.treeAdapter.getNamespaceURI(r),y=this.treeAdapter.getAttrList(r);return Qm(t,i,y,n)}_reconstructActiveFormattingElements(){const t=this.activeFormattingElements.entries.length;if(t){const r=this.activeFormattingElements.entries.findIndex(i=>i.type===_t.Marker||this.openElements.contains(i.element)),n=r<0?t-1:r-1;for(let i=n;i>=0;i--){const y=this.activeFormattingElements.entries[i];this._insertElement(y.token,this.treeAdapter.getNamespaceURI(y.element)),y.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=te.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(x.P),this.openElements.popUntilTagNamePopped(x.P)}_resetInsertionMode(){for(let t=this.openElements.stackTop;t>=0;t--)switch(t===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[t]){case x.TR:{this.insertionMode=te.IN_ROW;return}case x.TBODY:case x.THEAD:case x.TFOOT:{this.insertionMode=te.IN_TABLE_BODY;return}case x.CAPTION:{this.insertionMode=te.IN_CAPTION;return}case x.COLGROUP:{this.insertionMode=te.IN_COLUMN_GROUP;return}case x.TABLE:{this.insertionMode=te.IN_TABLE;return}case x.BODY:{this.insertionMode=te.IN_BODY;return}case x.FRAMESET:{this.insertionMode=te.IN_FRAMESET;return}case x.SELECT:{this._resetInsertionModeForSelect(t);return}case x.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case x.HTML:{this.insertionMode=this.headElement?te.AFTER_HEAD:te.BEFORE_HEAD;return}case x.TD:case x.TH:{if(t>0){this.insertionMode=te.IN_CELL;return}break}case x.HEAD:{if(t>0){this.insertionMode=te.IN_HEAD;return}break}}this.insertionMode=te.IN_BODY}_resetInsertionModeForSelect(t){if(t>0)for(let r=t-1;r>0;r--){const n=this.openElements.tagIDs[r];if(n===x.TEMPLATE)break;if(n===x.TABLE){this.insertionMode=te.IN_SELECT_IN_TABLE;return}}this.insertionMode=te.IN_SELECT}_isElementCausesFosterParenting(t){return ic.has(t)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let t=this.openElements.stackTop;t>=0;t--){const r=this.openElements.items[t];switch(this.openElements.tagIDs[t]){case x.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(r)===ce.HTML)return{parent:this.treeAdapter.getTemplateContent(r),beforeElement:null};break}case x.TABLE:{const n=this.treeAdapter.getParentNode(r);return n?{parent:n,beforeElement:r}:{parent:this.openElements.items[t-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(t){const r=this._findFosterParentingLocation();r.beforeElement?this.treeAdapter.insertBefore(r.parent,t,r.beforeElement):this.treeAdapter.appendChild(r.parent,t)}_isSpecialElement(t,r){const n=this.treeAdapter.getNamespaceURI(t);return mm[n].has(r)}onCharacter(t){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){Lp(this,t);return}switch(this.insertionMode){case te.INITIAL:{Qr(this,t);break}case te.BEFORE_HTML:{sn(this,t);break}case te.BEFORE_HEAD:{an(this,t);break}case te.IN_HEAD:{un(this,t);break}case te.IN_HEAD_NO_SCRIPT:{on(this,t);break}case te.AFTER_HEAD:{ln(this,t);break}case te.IN_BODY:case te.IN_CAPTION:case te.IN_CELL:case te.IN_TEMPLATE:{uc(this,t);break}case te.TEXT:case te.IN_SELECT:case te.IN_SELECT_IN_TABLE:{this._insertCharacters(t);break}case te.IN_TABLE:case te.IN_TABLE_BODY:case te.IN_ROW:{es(this,t);break}case te.IN_TABLE_TEXT:{hc(this,t);break}case te.IN_COLUMN_GROUP:{si(this,t);break}case te.AFTER_BODY:{ai(this,t);break}case te.AFTER_AFTER_BODY:{Vn(this,t);break}}}onNullCharacter(t){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){Cp(this,t);return}switch(this.insertionMode){case te.INITIAL:{Qr(this,t);break}case te.BEFORE_HTML:{sn(this,t);break}case te.BEFORE_HEAD:{an(this,t);break}case te.IN_HEAD:{un(this,t);break}case te.IN_HEAD_NO_SCRIPT:{on(this,t);break}case te.AFTER_HEAD:{ln(this,t);break}case te.TEXT:{this._insertCharacters(t);break}case te.IN_TABLE:case te.IN_TABLE_BODY:case te.IN_ROW:{es(this,t);break}case te.IN_COLUMN_GROUP:{si(this,t);break}case te.AFTER_BODY:{ai(this,t);break}case te.AFTER_AFTER_BODY:{Vn(this,t);break}}}onComment(t){if(this.skipNextNewLine=!1,this.currentNotInHTML){Is(this,t);return}switch(this.insertionMode){case te.INITIAL:case te.BEFORE_HTML:case te.BEFORE_HEAD:case te.IN_HEAD:case te.IN_HEAD_NO_SCRIPT:case te.AFTER_HEAD:case te.IN_BODY:case te.IN_TABLE:case te.IN_CAPTION:case te.IN_COLUMN_GROUP:case te.IN_TABLE_BODY:case te.IN_ROW:case te.IN_CELL:case te.IN_SELECT:case te.IN_SELECT_IN_TABLE:case te.IN_TEMPLATE:case te.IN_FRAMESET:case te.AFTER_FRAMESET:{Is(this,t);break}case te.IN_TABLE_TEXT:{$r(this,t);break}case te.AFTER_BODY:{sv(this,t);break}case te.AFTER_AFTER_BODY:case te.AFTER_AFTER_FRAMESET:{av(this,t);break}}}onDoctype(t){switch(this.skipNextNewLine=!1,this.insertionMode){case te.INITIAL:{uv(this,t);break}case te.BEFORE_HEAD:case te.IN_HEAD:case te.IN_HEAD_NO_SCRIPT:case te.AFTER_HEAD:{this._err(t,oe.misplacedDoctype);break}case te.IN_TABLE_TEXT:{$r(this,t);break}}}onStartTag(t){this.skipNextNewLine=!1,this.currentToken=t,this._processStartTag(t),t.selfClosing&&!t.ackSelfClosing&&this._err(t,oe.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(t){this.shouldProcessStartTagTokenInForeignContent(t)?Dp(this,t):this._startTagOutsideForeignContent(t)}_startTagOutsideForeignContent(t){switch(this.insertionMode){case te.INITIAL:{Qr(this,t);break}case te.BEFORE_HTML:{ov(this,t);break}case te.BEFORE_HEAD:{cv(this,t);break}case te.IN_HEAD:{Ct(this,t);break}case te.IN_HEAD_NO_SCRIPT:{hv(this,t);break}case te.AFTER_HEAD:{Ev(this,t);break}case te.IN_BODY:{Je(this,t);break}case te.IN_TABLE:{Ur(this,t);break}case te.IN_TABLE_TEXT:{$r(this,t);break}case te.IN_CAPTION:{fp(this,t);break}case te.IN_COLUMN_GROUP:{ma(this,t);break}case te.IN_TABLE_BODY:{Di(this,t);break}case te.IN_ROW:{Ri(this,t);break}case te.IN_CELL:{gp(this,t);break}case te.IN_SELECT:{mc(this,t);break}case te.IN_SELECT_IN_TABLE:{mp(this,t);break}case te.IN_TEMPLATE:{pp(this,t);break}case te.AFTER_BODY:{_p(this,t);break}case te.IN_FRAMESET:{Ap(this,t);break}case te.AFTER_FRAMESET:{bp(this,t);break}case te.AFTER_AFTER_BODY:{Ip(this,t);break}case te.AFTER_AFTER_FRAMESET:{xp(this,t);break}}}onEndTag(t){this.skipNextNewLine=!1,this.currentToken=t,this.currentNotInHTML?Rp(this,t):this._endTagOutsideForeignContent(t)}_endTagOutsideForeignContent(t){switch(this.insertionMode){case te.INITIAL:{Qr(this,t);break}case te.BEFORE_HTML:{lv(this,t);break}case te.BEFORE_HEAD:{fv(this,t);break}case te.IN_HEAD:{dv(this,t);break}case te.IN_HEAD_NO_SCRIPT:{gv(this,t);break}case te.AFTER_HEAD:{mv(this,t);break}case te.IN_BODY:{Li(this,t);break}case te.TEXT:{tp(this,t);break}case te.IN_TABLE:{_n(this,t);break}case te.IN_TABLE_TEXT:{$r(this,t);break}case te.IN_CAPTION:{dp(this,t);break}case te.IN_COLUMN_GROUP:{hp(this,t);break}case te.IN_TABLE_BODY:{xs(this,t);break}case te.IN_ROW:{Ec(this,t);break}case te.IN_CELL:{Ep(this,t);break}case te.IN_SELECT:{vc(this,t);break}case te.IN_SELECT_IN_TABLE:{vp(this,t);break}case te.IN_TEMPLATE:{Tp(this,t);break}case te.AFTER_BODY:{Tc(this,t);break}case te.IN_FRAMESET:{yp(this,t);break}case te.AFTER_FRAMESET:{Sp(this,t);break}case te.AFTER_AFTER_BODY:{Vn(this,t);break}}}onEof(t){switch(this.insertionMode){case te.INITIAL:{Qr(this,t);break}case te.BEFORE_HTML:{sn(this,t);break}case te.BEFORE_HEAD:{an(this,t);break}case te.IN_HEAD:{un(this,t);break}case te.IN_HEAD_NO_SCRIPT:{on(this,t);break}case te.AFTER_HEAD:{ln(this,t);break}case te.IN_BODY:case te.IN_TABLE:case te.IN_CAPTION:case te.IN_COLUMN_GROUP:case te.IN_TABLE_BODY:case te.IN_ROW:case te.IN_CELL:case te.IN_SELECT:case te.IN_SELECT_IN_TABLE:{fc(this,t);break}case te.TEXT:{rp(this,t);break}case te.IN_TABLE_TEXT:{$r(this,t);break}case te.IN_TEMPLATE:{pc(this,t);break}case te.AFTER_BODY:case te.IN_FRAMESET:case te.AFTER_FRAMESET:case te.AFTER_AFTER_BODY:case te.AFTER_AFTER_FRAMESET:{Ea(this,t);break}}}onWhitespaceCharacter(t){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,t.chars.charCodeAt(0)===$.LINE_FEED)){if(t.chars.length===1)return;t.chars=t.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(t);return}switch(this.insertionMode){case te.IN_HEAD:case te.IN_HEAD_NO_SCRIPT:case te.AFTER_HEAD:case te.TEXT:case te.IN_COLUMN_GROUP:case te.IN_SELECT:case te.IN_SELECT_IN_TABLE:case te.IN_FRAMESET:case te.AFTER_FRAMESET:{this._insertCharacters(t);break}case te.IN_BODY:case te.IN_CAPTION:case te.IN_CELL:case te.IN_TEMPLATE:case te.AFTER_BODY:case te.AFTER_AFTER_BODY:case te.AFTER_AFTER_FRAMESET:{ac(this,t);break}case te.IN_TABLE:case te.IN_TABLE_BODY:case te.IN_ROW:{es(this,t);break}case te.IN_TABLE_TEXT:{dc(this,t);break}}}};function Zm(e,t){let r=e.activeFormattingElements.getElementEntryInScopeWithTagName(t.tagName);return r?e.openElements.contains(r.element)?e.openElements.hasInScope(t.tagID)||(r=null):(e.activeFormattingElements.removeEntry(r),r=null):cc(e,t),r}function ev(e,t){let r=null,n=e.openElements.stackTop;for(;n>=0;n--){const i=e.openElements.items[n];if(i===t.element)break;e._isSpecialElement(i,e.openElements.tagIDs[n])&&(r=i)}return r||(e.openElements.shortenToLength(n<0?0:n),e.activeFormattingElements.removeEntry(t)),r}function tv(e,t,r){let n=t,i=e.openElements.getCommonAncestor(t);for(let y=0,M=i;M!==r;y++,M=i){i=e.openElements.getCommonAncestor(M);const C=e.activeFormattingElements.getElementEntry(M),u=C&&y>=qm;!C||u?(u&&e.activeFormattingElements.removeEntry(C),e.openElements.remove(M)):(M=rv(e,C),n===t&&(e.activeFormattingElements.bookmark=C),e.treeAdapter.detachNode(n),e.treeAdapter.appendChild(M,n),n=M)}return n}function rv(e,t){const r=e.treeAdapter.getNamespaceURI(t.element),n=e.treeAdapter.createElement(t.token.tagName,r,t.token.attrs);return e.openElements.replace(t.element,n),t.element=n,n}function nv(e,t,r){const n=e.treeAdapter.getTagName(t),i=xi(n);if(e._isElementCausesFosterParenting(i))e._fosterParentElement(r);else{const y=e.treeAdapter.getNamespaceURI(t);i===x.TEMPLATE&&y===ce.HTML&&(t=e.treeAdapter.getTemplateContent(t)),e.treeAdapter.appendChild(t,r)}}function iv(e,t,r){const n=e.treeAdapter.getNamespaceURI(r.element),{token:i}=r,y=e.treeAdapter.createElement(i.tagName,n,i.attrs);e._adoptNodes(t,y),e.treeAdapter.appendChild(t,y),e.activeFormattingElements.insertElementAfterBookmark(y,i),e.activeFormattingElements.removeEntry(r),e.openElements.remove(r.element),e.openElements.insertAfter(t,y,i.tagID)}function ga(e,t){for(let r=0;r<zm;r++){const n=Zm(e,t);if(!n)break;const i=ev(e,n);if(!i)break;e.activeFormattingElements.bookmark=n;const y=tv(e,i,n.element),M=e.openElements.getCommonAncestor(n.element);e.treeAdapter.detachNode(y),M&&nv(e,M,y),iv(e,i,n)}}function Is(e,t){e._appendCommentNode(t,e.openElements.currentTmplContentOrNode)}function sv(e,t){e._appendCommentNode(t,e.openElements.items[0])}function av(e,t){e._appendCommentNode(t,e.document)}function Ea(e,t){if(e.stopped=!0,t.location){const r=e.fragmentContext?0:2;for(let n=e.openElements.stackTop;n>=r;n--)e._setEndLocation(e.openElements.items[n],t);if(!e.fragmentContext&&e.openElements.stackTop>=0){const n=e.openElements.items[0],i=e.treeAdapter.getNodeSourceCodeLocation(n);if(i&&!i.endTag&&(e._setEndLocation(n,t),e.openElements.stackTop>=1)){const y=e.openElements.items[1],M=e.treeAdapter.getNodeSourceCodeLocation(y);M&&!M.endTag&&e._setEndLocation(y,t)}}}}function uv(e,t){e._setDocumentType(t);const r=t.forceQuirks?at.QUIRKS:Bm(t);km(t)||e._err(t,oe.nonConformingDoctype),e.treeAdapter.setDocumentMode(e.document,r),e.insertionMode=te.BEFORE_HTML}function Qr(e,t){e._err(t,oe.missingDoctype,!0),e.treeAdapter.setDocumentMode(e.document,at.QUIRKS),e.insertionMode=te.BEFORE_HTML,e._processToken(t)}function ov(e,t){t.tagID===x.HTML?(e._insertElement(t,ce.HTML),e.insertionMode=te.BEFORE_HEAD):sn(e,t)}function lv(e,t){const r=t.tagID;(r===x.HTML||r===x.HEAD||r===x.BODY||r===x.BR)&&sn(e,t)}function sn(e,t){e._insertFakeRootElement(),e.insertionMode=te.BEFORE_HEAD,e._processToken(t)}function cv(e,t){switch(t.tagID){case x.HTML:{Je(e,t);break}case x.HEAD:{e._insertElement(t,ce.HTML),e.headElement=e.openElements.current,e.insertionMode=te.IN_HEAD;break}default:an(e,t)}}function fv(e,t){const r=t.tagID;r===x.HEAD||r===x.BODY||r===x.HTML||r===x.BR?an(e,t):e._err(t,oe.endTagWithoutMatchingOpenElement)}function an(e,t){e._insertFakeElement(se.HEAD,x.HEAD),e.headElement=e.openElements.current,e.insertionMode=te.IN_HEAD,e._processToken(t)}function Ct(e,t){switch(t.tagID){case x.HTML:{Je(e,t);break}case x.BASE:case x.BASEFONT:case x.BGSOUND:case x.LINK:case x.META:{e._appendElement(t,ce.HTML),t.ackSelfClosing=!0;break}case x.TITLE:{e._switchToTextParsing(t,ut.RCDATA);break}case x.NOSCRIPT:{e.options.scriptingEnabled?e._switchToTextParsing(t,ut.RAWTEXT):(e._insertElement(t,ce.HTML),e.insertionMode=te.IN_HEAD_NO_SCRIPT);break}case x.NOFRAMES:case x.STYLE:{e._switchToTextParsing(t,ut.RAWTEXT);break}case x.SCRIPT:{e._switchToTextParsing(t,ut.SCRIPT_DATA);break}case x.TEMPLATE:{e._insertTemplate(t),e.activeFormattingElements.insertMarker(),e.framesetOk=!1,e.insertionMode=te.IN_TEMPLATE,e.tmplInsertionModeStack.unshift(te.IN_TEMPLATE);break}case x.HEAD:{e._err(t,oe.misplacedStartTagForHeadElement);break}default:un(e,t)}}function dv(e,t){switch(t.tagID){case x.HEAD:{e.openElements.pop(),e.insertionMode=te.AFTER_HEAD;break}case x.BODY:case x.BR:case x.HTML:{un(e,t);break}case x.TEMPLATE:{pr(e,t);break}default:e._err(t,oe.endTagWithoutMatchingOpenElement)}}function pr(e,t){e.openElements.tmplCount>0?(e.openElements.generateImpliedEndTagsThoroughly(),e.openElements.currentTagId!==x.TEMPLATE&&e._err(t,oe.closingOfElementWithOpenChildElements),e.openElements.popUntilTagNamePopped(x.TEMPLATE),e.activeFormattingElements.clearToLastMarker(),e.tmplInsertionModeStack.shift(),e._resetInsertionMode()):e._err(t,oe.endTagWithoutMatchingOpenElement)}function un(e,t){e.openElements.pop(),e.insertionMode=te.AFTER_HEAD,e._processToken(t)}function hv(e,t){switch(t.tagID){case x.HTML:{Je(e,t);break}case x.BASEFONT:case x.BGSOUND:case x.HEAD:case x.LINK:case x.META:case x.NOFRAMES:case x.STYLE:{Ct(e,t);break}case x.NOSCRIPT:{e._err(t,oe.nestedNoscriptInHead);break}default:on(e,t)}}function gv(e,t){switch(t.tagID){case x.NOSCRIPT:{e.openElements.pop(),e.insertionMode=te.IN_HEAD;break}case x.BR:{on(e,t);break}default:e._err(t,oe.endTagWithoutMatchingOpenElement)}}function on(e,t){const r=t.type===Ce.EOF?oe.openElementsLeftAfterEof:oe.disallowedContentInNoscriptInHead;e._err(t,r),e.openElements.pop(),e.insertionMode=te.IN_HEAD,e._processToken(t)}function Ev(e,t){switch(t.tagID){case x.HTML:{Je(e,t);break}case x.BODY:{e._insertElement(t,ce.HTML),e.framesetOk=!1,e.insertionMode=te.IN_BODY;break}case x.FRAMESET:{e._insertElement(t,ce.HTML),e.insertionMode=te.IN_FRAMESET;break}case x.BASE:case x.BASEFONT:case x.BGSOUND:case x.LINK:case x.META:case x.NOFRAMES:case x.SCRIPT:case x.STYLE:case x.TEMPLATE:case x.TITLE:{e._err(t,oe.abandonedHeadElementChild),e.openElements.push(e.headElement,x.HEAD),Ct(e,t),e.openElements.remove(e.headElement);break}case x.HEAD:{e._err(t,oe.misplacedStartTagForHeadElement);break}default:ln(e,t)}}function mv(e,t){switch(t.tagID){case x.BODY:case x.HTML:case x.BR:{ln(e,t);break}case x.TEMPLATE:{pr(e,t);break}default:e._err(t,oe.endTagWithoutMatchingOpenElement)}}function ln(e,t){e._insertFakeElement(se.BODY,x.BODY),e.insertionMode=te.IN_BODY,Ci(e,t)}function Ci(e,t){switch(t.type){case Ce.CHARACTER:{uc(e,t);break}case Ce.WHITESPACE_CHARACTER:{ac(e,t);break}case Ce.COMMENT:{Is(e,t);break}case Ce.START_TAG:{Je(e,t);break}case Ce.END_TAG:{Li(e,t);break}case Ce.EOF:{fc(e,t);break}}}function ac(e,t){e._reconstructActiveFormattingElements(),e._insertCharacters(t)}function uc(e,t){e._reconstructActiveFormattingElements(),e._insertCharacters(t),e.framesetOk=!1}function vv(e,t){e.openElements.tmplCount===0&&e.treeAdapter.adoptAttributes(e.openElements.items[0],t.attrs)}function pv(e,t){const r=e.openElements.tryPeekProperlyNestedBodyElement();r&&e.openElements.tmplCount===0&&(e.framesetOk=!1,e.treeAdapter.adoptAttributes(r,t.attrs))}function Tv(e,t){const r=e.openElements.tryPeekProperlyNestedBodyElement();e.framesetOk&&r&&(e.treeAdapter.detachNode(r),e.openElements.popAllUpToHtmlElement(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_FRAMESET)}function _v(e,t){e.openElements.hasInButtonScope(x.P)&&e._closePElement(),e._insertElement(t,ce.HTML)}function Av(e,t){e.openElements.hasInButtonScope(x.P)&&e._closePElement(),Ql(e.openElements.currentTagId)&&e.openElements.pop(),e._insertElement(t,ce.HTML)}function yv(e,t){e.openElements.hasInButtonScope(x.P)&&e._closePElement(),e._insertElement(t,ce.HTML),e.skipNextNewLine=!0,e.framesetOk=!1}function bv(e,t){const r=e.openElements.tmplCount>0;(!e.formElement||r)&&(e.openElements.hasInButtonScope(x.P)&&e._closePElement(),e._insertElement(t,ce.HTML),r||(e.formElement=e.openElements.current))}function Sv(e,t){e.framesetOk=!1;const r=t.tagID;for(let n=e.openElements.stackTop;n>=0;n--){const i=e.openElements.tagIDs[n];if(r===x.LI&&i===x.LI||(r===x.DD||r===x.DT)&&(i===x.DD||i===x.DT)){e.openElements.generateImpliedEndTagsWithExclusion(i),e.openElements.popUntilTagNamePopped(i);break}if(i!==x.ADDRESS&&i!==x.DIV&&i!==x.P&&e._isSpecialElement(e.openElements.items[n],i))break}e.openElements.hasInButtonScope(x.P)&&e._closePElement(),e._insertElement(t,ce.HTML)}function Iv(e,t){e.openElements.hasInButtonScope(x.P)&&e._closePElement(),e._insertElement(t,ce.HTML),e.tokenizer.state=ut.PLAINTEXT}function xv(e,t){e.openElements.hasInScope(x.BUTTON)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(x.BUTTON)),e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.framesetOk=!1}function Cv(e,t){const r=e.activeFormattingElements.getElementEntryInScopeWithTagName(se.A);r&&(ga(e,t),e.openElements.remove(r.element),e.activeFormattingElements.removeEntry(r)),e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function Lv(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function Dv(e,t){e._reconstructActiveFormattingElements(),e.openElements.hasInScope(x.NOBR)&&(ga(e,t),e._reconstructActiveFormattingElements()),e._insertElement(t,ce.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function Rv(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.activeFormattingElements.insertMarker(),e.framesetOk=!1}function Ov(e,t){e.treeAdapter.getDocumentMode(e.document)!==at.QUIRKS&&e.openElements.hasInButtonScope(x.P)&&e._closePElement(),e._insertElement(t,ce.HTML),e.framesetOk=!1,e.insertionMode=te.IN_TABLE}function oc(e,t){e._reconstructActiveFormattingElements(),e._appendElement(t,ce.HTML),e.framesetOk=!1,t.ackSelfClosing=!0}function lc(e){const t=Xl(e,Jt.TYPE);return t!=null&&t.toLowerCase()===$m}function Pv(e,t){e._reconstructActiveFormattingElements(),e._appendElement(t,ce.HTML),lc(t)||(e.framesetOk=!1),t.ackSelfClosing=!0}function Nv(e,t){e._appendElement(t,ce.HTML),t.ackSelfClosing=!0}function Mv(e,t){e.openElements.hasInButtonScope(x.P)&&e._closePElement(),e._appendElement(t,ce.HTML),e.framesetOk=!1,t.ackSelfClosing=!0}function Fv(e,t){t.tagName=se.IMG,t.tagID=x.IMG,oc(e,t)}function kv(e,t){e._insertElement(t,ce.HTML),e.skipNextNewLine=!0,e.tokenizer.state=ut.RCDATA,e.originalInsertionMode=e.insertionMode,e.framesetOk=!1,e.insertionMode=te.TEXT}function Bv(e,t){e.openElements.hasInButtonScope(x.P)&&e._closePElement(),e._reconstructActiveFormattingElements(),e.framesetOk=!1,e._switchToTextParsing(t,ut.RAWTEXT)}function Uv(e,t){e.framesetOk=!1,e._switchToTextParsing(t,ut.RAWTEXT)}function Bu(e,t){e._switchToTextParsing(t,ut.RAWTEXT)}function wv(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML),e.framesetOk=!1,e.insertionMode=e.insertionMode===te.IN_TABLE||e.insertionMode===te.IN_CAPTION||e.insertionMode===te.IN_TABLE_BODY||e.insertionMode===te.IN_ROW||e.insertionMode===te.IN_CELL?te.IN_SELECT_IN_TABLE:te.IN_SELECT}function Hv(e,t){e.openElements.currentTagId===x.OPTION&&e.openElements.pop(),e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML)}function Kv(e,t){e.openElements.hasInScope(x.RUBY)&&e.openElements.generateImpliedEndTags(),e._insertElement(t,ce.HTML)}function Wv(e,t){e.openElements.hasInScope(x.RUBY)&&e.openElements.generateImpliedEndTagsWithExclusion(x.RTC),e._insertElement(t,ce.HTML)}function Gv(e,t){e._reconstructActiveFormattingElements(),rc(t),ha(t),t.selfClosing?e._appendElement(t,ce.MATHML):e._insertElement(t,ce.MATHML),t.ackSelfClosing=!0}function Yv(e,t){e._reconstructActiveFormattingElements(),nc(t),ha(t),t.selfClosing?e._appendElement(t,ce.SVG):e._insertElement(t,ce.SVG),t.ackSelfClosing=!0}function Uu(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,ce.HTML)}function Je(e,t){switch(t.tagID){case x.I:case x.S:case x.B:case x.U:case x.EM:case x.TT:case x.BIG:case x.CODE:case x.FONT:case x.SMALL:case x.STRIKE:case x.STRONG:{Lv(e,t);break}case x.A:{Cv(e,t);break}case x.H1:case x.H2:case x.H3:case x.H4:case x.H5:case x.H6:{Av(e,t);break}case x.P:case x.DL:case x.OL:case x.UL:case x.DIV:case x.DIR:case x.NAV:case x.MAIN:case x.MENU:case x.ASIDE:case x.CENTER:case x.FIGURE:case x.FOOTER:case x.HEADER:case x.HGROUP:case x.DIALOG:case x.DETAILS:case x.ADDRESS:case x.ARTICLE:case x.SECTION:case x.SUMMARY:case x.FIELDSET:case x.BLOCKQUOTE:case x.FIGCAPTION:{_v(e,t);break}case x.LI:case x.DD:case x.DT:{Sv(e,t);break}case x.BR:case x.IMG:case x.WBR:case x.AREA:case x.EMBED:case x.KEYGEN:{oc(e,t);break}case x.HR:{Mv(e,t);break}case x.RB:case x.RTC:{Kv(e,t);break}case x.RT:case x.RP:{Wv(e,t);break}case x.PRE:case x.LISTING:{yv(e,t);break}case x.XMP:{Bv(e,t);break}case x.SVG:{Yv(e,t);break}case x.HTML:{vv(e,t);break}case x.BASE:case x.LINK:case x.META:case x.STYLE:case x.TITLE:case x.SCRIPT:case x.BGSOUND:case x.BASEFONT:case x.TEMPLATE:{Ct(e,t);break}case x.BODY:{pv(e,t);break}case x.FORM:{bv(e,t);break}case x.NOBR:{Dv(e,t);break}case x.MATH:{Gv(e,t);break}case x.TABLE:{Ov(e,t);break}case x.INPUT:{Pv(e,t);break}case x.PARAM:case x.TRACK:case x.SOURCE:{Nv(e,t);break}case x.IMAGE:{Fv(e,t);break}case x.BUTTON:{xv(e,t);break}case x.APPLET:case x.OBJECT:case x.MARQUEE:{Rv(e,t);break}case x.IFRAME:{Uv(e,t);break}case x.SELECT:{wv(e,t);break}case x.OPTION:case x.OPTGROUP:{Hv(e,t);break}case x.NOEMBED:{Bu(e,t);break}case x.FRAMESET:{Tv(e,t);break}case x.TEXTAREA:{kv(e,t);break}case x.NOSCRIPT:{e.options.scriptingEnabled?Bu(e,t):Uu(e,t);break}case x.PLAINTEXT:{Iv(e,t);break}case x.COL:case x.TH:case x.TD:case x.TR:case x.HEAD:case x.FRAME:case x.TBODY:case x.TFOOT:case x.THEAD:case x.CAPTION:case x.COLGROUP:break;default:Uu(e,t)}}function Vv(e,t){if(e.openElements.hasInScope(x.BODY)&&(e.insertionMode=te.AFTER_BODY,e.options.sourceCodeLocationInfo)){const r=e.openElements.tryPeekProperlyNestedBodyElement();r&&e._setEndLocation(r,t)}}function jv(e,t){e.openElements.hasInScope(x.BODY)&&(e.insertionMode=te.AFTER_BODY,Tc(e,t))}function Xv(e,t){const r=t.tagID;e.openElements.hasInScope(r)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(r))}function Qv(e){const t=e.openElements.tmplCount>0,{formElement:r}=e;t||(e.formElement=null),(r||t)&&e.openElements.hasInScope(x.FORM)&&(e.openElements.generateImpliedEndTags(),t?e.openElements.popUntilTagNamePopped(x.FORM):r&&e.openElements.remove(r))}function $v(e){e.openElements.hasInButtonScope(x.P)||e._insertFakeElement(se.P,x.P),e._closePElement()}function zv(e){e.openElements.hasInListItemScope(x.LI)&&(e.openElements.generateImpliedEndTagsWithExclusion(x.LI),e.openElements.popUntilTagNamePopped(x.LI))}function qv(e,t){const r=t.tagID;e.openElements.hasInScope(r)&&(e.openElements.generateImpliedEndTagsWithExclusion(r),e.openElements.popUntilTagNamePopped(r))}function Jv(e){e.openElements.hasNumberedHeaderInScope()&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilNumberedHeaderPopped())}function Zv(e,t){const r=t.tagID;e.openElements.hasInScope(r)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(r),e.activeFormattingElements.clearToLastMarker())}function ep(e){e._reconstructActiveFormattingElements(),e._insertFakeElement(se.BR,x.BR),e.openElements.pop(),e.framesetOk=!1}function cc(e,t){const r=t.tagName,n=t.tagID;for(let i=e.openElements.stackTop;i>0;i--){const y=e.openElements.items[i],M=e.openElements.tagIDs[i];if(n===M&&(n!==x.UNKNOWN||e.treeAdapter.getTagName(y)===r)){e.openElements.generateImpliedEndTagsWithExclusion(n),e.openElements.stackTop>=i&&e.openElements.shortenToLength(i);break}if(e._isSpecialElement(y,M))break}}function Li(e,t){switch(t.tagID){case x.A:case x.B:case x.I:case x.S:case x.U:case x.EM:case x.TT:case x.BIG:case x.CODE:case x.FONT:case x.NOBR:case x.SMALL:case x.STRIKE:case x.STRONG:{ga(e,t);break}case x.P:{$v(e);break}case x.DL:case x.UL:case x.OL:case x.DIR:case x.DIV:case x.NAV:case x.PRE:case x.MAIN:case x.MENU:case x.ASIDE:case x.BUTTON:case x.CENTER:case x.FIGURE:case x.FOOTER:case x.HEADER:case x.HGROUP:case x.DIALOG:case x.ADDRESS:case x.ARTICLE:case x.DETAILS:case x.SECTION:case x.SUMMARY:case x.LISTING:case x.FIELDSET:case x.BLOCKQUOTE:case x.FIGCAPTION:{Xv(e,t);break}case x.LI:{zv(e);break}case x.DD:case x.DT:{qv(e,t);break}case x.H1:case x.H2:case x.H3:case x.H4:case x.H5:case x.H6:{Jv(e);break}case x.BR:{ep(e);break}case x.BODY:{Vv(e,t);break}case x.HTML:{jv(e,t);break}case x.FORM:{Qv(e);break}case x.APPLET:case x.OBJECT:case x.MARQUEE:{Zv(e,t);break}case x.TEMPLATE:{pr(e,t);break}default:cc(e,t)}}function fc(e,t){e.tmplInsertionModeStack.length>0?pc(e,t):Ea(e,t)}function tp(e,t){var r;t.tagID===x.SCRIPT&&((r=e.scriptHandler)===null||r===void 0||r.call(e,e.openElements.current)),e.openElements.pop(),e.insertionMode=e.originalInsertionMode}function rp(e,t){e._err(t,oe.eofInElementThatCanContainOnlyText),e.openElements.pop(),e.insertionMode=e.originalInsertionMode,e.onEof(t)}function es(e,t){if(ic.has(e.openElements.currentTagId))switch(e.pendingCharacterTokens.length=0,e.hasNonWhitespacePendingCharacterToken=!1,e.originalInsertionMode=e.insertionMode,e.insertionMode=te.IN_TABLE_TEXT,t.type){case Ce.CHARACTER:{hc(e,t);break}case Ce.WHITESPACE_CHARACTER:{dc(e,t);break}}else In(e,t)}function np(e,t){e.openElements.clearBackToTableContext(),e.activeFormattingElements.insertMarker(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_CAPTION}function ip(e,t){e.openElements.clearBackToTableContext(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_COLUMN_GROUP}function sp(e,t){e.openElements.clearBackToTableContext(),e._insertFakeElement(se.COLGROUP,x.COLGROUP),e.insertionMode=te.IN_COLUMN_GROUP,ma(e,t)}function ap(e,t){e.openElements.clearBackToTableContext(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_TABLE_BODY}function up(e,t){e.openElements.clearBackToTableContext(),e._insertFakeElement(se.TBODY,x.TBODY),e.insertionMode=te.IN_TABLE_BODY,Di(e,t)}function op(e,t){e.openElements.hasInTableScope(x.TABLE)&&(e.openElements.popUntilTagNamePopped(x.TABLE),e._resetInsertionMode(),e._processStartTag(t))}function lp(e,t){lc(t)?e._appendElement(t,ce.HTML):In(e,t),t.ackSelfClosing=!0}function cp(e,t){!e.formElement&&e.openElements.tmplCount===0&&(e._insertElement(t,ce.HTML),e.formElement=e.openElements.current,e.openElements.pop())}function Ur(e,t){switch(t.tagID){case x.TD:case x.TH:case x.TR:{up(e,t);break}case x.STYLE:case x.SCRIPT:case x.TEMPLATE:{Ct(e,t);break}case x.COL:{sp(e,t);break}case x.FORM:{cp(e,t);break}case x.TABLE:{op(e,t);break}case x.TBODY:case x.TFOOT:case x.THEAD:{ap(e,t);break}case x.INPUT:{lp(e,t);break}case x.CAPTION:{np(e,t);break}case x.COLGROUP:{ip(e,t);break}default:In(e,t)}}function _n(e,t){switch(t.tagID){case x.TABLE:{e.openElements.hasInTableScope(x.TABLE)&&(e.openElements.popUntilTagNamePopped(x.TABLE),e._resetInsertionMode());break}case x.TEMPLATE:{pr(e,t);break}case x.BODY:case x.CAPTION:case x.COL:case x.COLGROUP:case x.HTML:case x.TBODY:case x.TD:case x.TFOOT:case x.TH:case x.THEAD:case x.TR:break;default:In(e,t)}}function In(e,t){const r=e.fosterParentingEnabled;e.fosterParentingEnabled=!0,Ci(e,t),e.fosterParentingEnabled=r}function dc(e,t){e.pendingCharacterTokens.push(t)}function hc(e,t){e.pendingCharacterTokens.push(t),e.hasNonWhitespacePendingCharacterToken=!0}function $r(e,t){let r=0;if(e.hasNonWhitespacePendingCharacterToken)for(;r<e.pendingCharacterTokens.length;r++)In(e,e.pendingCharacterTokens[r]);else for(;r<e.pendingCharacterTokens.length;r++)e._insertCharacters(e.pendingCharacterTokens[r]);e.insertionMode=e.originalInsertionMode,e._processToken(t)}const gc=new Set([x.CAPTION,x.COL,x.COLGROUP,x.TBODY,x.TD,x.TFOOT,x.TH,x.THEAD,x.TR]);function fp(e,t){const r=t.tagID;gc.has(r)?e.openElements.hasInTableScope(x.CAPTION)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(x.CAPTION),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=te.IN_TABLE,Ur(e,t)):Je(e,t)}function dp(e,t){const r=t.tagID;switch(r){case x.CAPTION:case x.TABLE:{e.openElements.hasInTableScope(x.CAPTION)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(x.CAPTION),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=te.IN_TABLE,r===x.TABLE&&_n(e,t));break}case x.BODY:case x.COL:case x.COLGROUP:case x.HTML:case x.TBODY:case x.TD:case x.TFOOT:case x.TH:case x.THEAD:case x.TR:break;default:Li(e,t)}}function ma(e,t){switch(t.tagID){case x.HTML:{Je(e,t);break}case x.COL:{e._appendElement(t,ce.HTML),t.ackSelfClosing=!0;break}case x.TEMPLATE:{Ct(e,t);break}default:si(e,t)}}function hp(e,t){switch(t.tagID){case x.COLGROUP:{e.openElements.currentTagId===x.COLGROUP&&(e.openElements.pop(),e.insertionMode=te.IN_TABLE);break}case x.TEMPLATE:{pr(e,t);break}case x.COL:break;default:si(e,t)}}function si(e,t){e.openElements.currentTagId===x.COLGROUP&&(e.openElements.pop(),e.insertionMode=te.IN_TABLE,e._processToken(t))}function Di(e,t){switch(t.tagID){case x.TR:{e.openElements.clearBackToTableBodyContext(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_ROW;break}case x.TH:case x.TD:{e.openElements.clearBackToTableBodyContext(),e._insertFakeElement(se.TR,x.TR),e.insertionMode=te.IN_ROW,Ri(e,t);break}case x.CAPTION:case x.COL:case x.COLGROUP:case x.TBODY:case x.TFOOT:case x.THEAD:{e.openElements.hasTableBodyContextInTableScope()&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE,Ur(e,t));break}default:Ur(e,t)}}function xs(e,t){const r=t.tagID;switch(t.tagID){case x.TBODY:case x.TFOOT:case x.THEAD:{e.openElements.hasInTableScope(r)&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE);break}case x.TABLE:{e.openElements.hasTableBodyContextInTableScope()&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE,_n(e,t));break}case x.BODY:case x.CAPTION:case x.COL:case x.COLGROUP:case x.HTML:case x.TD:case x.TH:case x.TR:break;default:_n(e,t)}}function Ri(e,t){switch(t.tagID){case x.TH:case x.TD:{e.openElements.clearBackToTableRowContext(),e._insertElement(t,ce.HTML),e.insertionMode=te.IN_CELL,e.activeFormattingElements.insertMarker();break}case x.CAPTION:case x.COL:case x.COLGROUP:case x.TBODY:case x.TFOOT:case x.THEAD:case x.TR:{e.openElements.hasInTableScope(x.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE_BODY,Di(e,t));break}default:Ur(e,t)}}function Ec(e,t){switch(t.tagID){case x.TR:{e.openElements.hasInTableScope(x.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE_BODY);break}case x.TABLE:{e.openElements.hasInTableScope(x.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE_BODY,xs(e,t));break}case x.TBODY:case x.TFOOT:case x.THEAD:{(e.openElements.hasInTableScope(t.tagID)||e.openElements.hasInTableScope(x.TR))&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=te.IN_TABLE_BODY,xs(e,t));break}case x.BODY:case x.CAPTION:case x.COL:case x.COLGROUP:case x.HTML:case x.TD:case x.TH:break;default:_n(e,t)}}function gp(e,t){const r=t.tagID;gc.has(r)?(e.openElements.hasInTableScope(x.TD)||e.openElements.hasInTableScope(x.TH))&&(e._closeTableCell(),Ri(e,t)):Je(e,t)}function Ep(e,t){const r=t.tagID;switch(r){case x.TD:case x.TH:{e.openElements.hasInTableScope(r)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(r),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=te.IN_ROW);break}case x.TABLE:case x.TBODY:case x.TFOOT:case x.THEAD:case x.TR:{e.openElements.hasInTableScope(r)&&(e._closeTableCell(),Ec(e,t));break}case x.BODY:case x.CAPTION:case x.COL:case x.COLGROUP:case x.HTML:break;default:Li(e,t)}}function mc(e,t){switch(t.tagID){case x.HTML:{Je(e,t);break}case x.OPTION:{e.openElements.currentTagId===x.OPTION&&e.openElements.pop(),e._insertElement(t,ce.HTML);break}case x.OPTGROUP:{e.openElements.currentTagId===x.OPTION&&e.openElements.pop(),e.openElements.currentTagId===x.OPTGROUP&&e.openElements.pop(),e._insertElement(t,ce.HTML);break}case x.INPUT:case x.KEYGEN:case x.TEXTAREA:case x.SELECT:{e.openElements.hasInSelectScope(x.SELECT)&&(e.openElements.popUntilTagNamePopped(x.SELECT),e._resetInsertionMode(),t.tagID!==x.SELECT&&e._processStartTag(t));break}case x.SCRIPT:case x.TEMPLATE:{Ct(e,t);break}}}function vc(e,t){switch(t.tagID){case x.OPTGROUP:{e.openElements.stackTop>0&&e.openElements.currentTagId===x.OPTION&&e.openElements.tagIDs[e.openElements.stackTop-1]===x.OPTGROUP&&e.openElements.pop(),e.openElements.currentTagId===x.OPTGROUP&&e.openElements.pop();break}case x.OPTION:{e.openElements.currentTagId===x.OPTION&&e.openElements.pop();break}case x.SELECT:{e.openElements.hasInSelectScope(x.SELECT)&&(e.openElements.popUntilTagNamePopped(x.SELECT),e._resetInsertionMode());break}case x.TEMPLATE:{pr(e,t);break}}}function mp(e,t){const r=t.tagID;r===x.CAPTION||r===x.TABLE||r===x.TBODY||r===x.TFOOT||r===x.THEAD||r===x.TR||r===x.TD||r===x.TH?(e.openElements.popUntilTagNamePopped(x.SELECT),e._resetInsertionMode(),e._processStartTag(t)):mc(e,t)}function vp(e,t){const r=t.tagID;r===x.CAPTION||r===x.TABLE||r===x.TBODY||r===x.TFOOT||r===x.THEAD||r===x.TR||r===x.TD||r===x.TH?e.openElements.hasInTableScope(r)&&(e.openElements.popUntilTagNamePopped(x.SELECT),e._resetInsertionMode(),e.onEndTag(t)):vc(e,t)}function pp(e,t){switch(t.tagID){case x.BASE:case x.BASEFONT:case x.BGSOUND:case x.LINK:case x.META:case x.NOFRAMES:case x.SCRIPT:case x.STYLE:case x.TEMPLATE:case x.TITLE:{Ct(e,t);break}case x.CAPTION:case x.COLGROUP:case x.TBODY:case x.TFOOT:case x.THEAD:{e.tmplInsertionModeStack[0]=te.IN_TABLE,e.insertionMode=te.IN_TABLE,Ur(e,t);break}case x.COL:{e.tmplInsertionModeStack[0]=te.IN_COLUMN_GROUP,e.insertionMode=te.IN_COLUMN_GROUP,ma(e,t);break}case x.TR:{e.tmplInsertionModeStack[0]=te.IN_TABLE_BODY,e.insertionMode=te.IN_TABLE_BODY,Di(e,t);break}case x.TD:case x.TH:{e.tmplInsertionModeStack[0]=te.IN_ROW,e.insertionMode=te.IN_ROW,Ri(e,t);break}default:e.tmplInsertionModeStack[0]=te.IN_BODY,e.insertionMode=te.IN_BODY,Je(e,t)}}function Tp(e,t){t.tagID===x.TEMPLATE&&pr(e,t)}function pc(e,t){e.openElements.tmplCount>0?(e.openElements.popUntilTagNamePopped(x.TEMPLATE),e.activeFormattingElements.clearToLastMarker(),e.tmplInsertionModeStack.shift(),e._resetInsertionMode(),e.onEof(t)):Ea(e,t)}function _p(e,t){t.tagID===x.HTML?Je(e,t):ai(e,t)}function Tc(e,t){var r;if(t.tagID===x.HTML){if(e.fragmentContext||(e.insertionMode=te.AFTER_AFTER_BODY),e.options.sourceCodeLocationInfo&&e.openElements.tagIDs[0]===x.HTML){e._setEndLocation(e.openElements.items[0],t);const n=e.openElements.items[1];n&&!(!((r=e.treeAdapter.getNodeSourceCodeLocation(n))===null||r===void 0)&&r.endTag)&&e._setEndLocation(n,t)}}else ai(e,t)}function ai(e,t){e.insertionMode=te.IN_BODY,Ci(e,t)}function Ap(e,t){switch(t.tagID){case x.HTML:{Je(e,t);break}case x.FRAMESET:{e._insertElement(t,ce.HTML);break}case x.FRAME:{e._appendElement(t,ce.HTML),t.ackSelfClosing=!0;break}case x.NOFRAMES:{Ct(e,t);break}}}function yp(e,t){t.tagID===x.FRAMESET&&!e.openElements.isRootHtmlElementCurrent()&&(e.openElements.pop(),!e.fragmentContext&&e.openElements.currentTagId!==x.FRAMESET&&(e.insertionMode=te.AFTER_FRAMESET))}function bp(e,t){switch(t.tagID){case x.HTML:{Je(e,t);break}case x.NOFRAMES:{Ct(e,t);break}}}function Sp(e,t){t.tagID===x.HTML&&(e.insertionMode=te.AFTER_AFTER_FRAMESET)}function Ip(e,t){t.tagID===x.HTML?Je(e,t):Vn(e,t)}function Vn(e,t){e.insertionMode=te.IN_BODY,Ci(e,t)}function xp(e,t){switch(t.tagID){case x.HTML:{Je(e,t);break}case x.NOFRAMES:{Ct(e,t);break}}}function Cp(e,t){t.chars=ke,e._insertCharacters(t)}function Lp(e,t){e._insertCharacters(t),e.framesetOk=!1}function _c(e){for(;e.treeAdapter.getNamespaceURI(e.openElements.current)!==ce.HTML&&!e._isIntegrationPoint(e.openElements.currentTagId,e.openElements.current);)e.openElements.pop()}function Dp(e,t){if(Ym(t))_c(e),e._startTagOutsideForeignContent(t);else{const r=e._getAdjustedCurrentElement(),n=e.treeAdapter.getNamespaceURI(r);n===ce.MATHML?rc(t):n===ce.SVG&&(Vm(t),nc(t)),ha(t),t.selfClosing?e._appendElement(t,n):e._insertElement(t,n),t.ackSelfClosing=!0}}function Rp(e,t){if(t.tagID===x.P||t.tagID===x.BR){_c(e),e._endTagOutsideForeignContent(t);return}for(let r=e.openElements.stackTop;r>0;r--){const n=e.openElements.items[r];if(e.treeAdapter.getNamespaceURI(n)===ce.HTML){e._endTagOutsideForeignContent(t);break}const i=e.treeAdapter.getTagName(n);if(i.toLowerCase()===t.tagName){t.tagName=i,e.openElements.shortenToLength(r);break}}}const Op=new Set([se.AREA,se.BASE,se.BASEFONT,se.BGSOUND,se.BR,se.COL,se.EMBED,se.FRAME,se.HR,se.IMG,se.INPUT,se.KEYGEN,se.LINK,se.META,se.PARAM,se.SOURCE,se.TRACK,se.WBR]);function Pp(e,t){return t.treeAdapter.isElementNode(e)&&t.treeAdapter.getNamespaceURI(e)===ce.HTML&&Op.has(t.treeAdapter.getTagName(e))}const Np={treeAdapter:lr,scriptingEnabled:!0};function Mp(e,t){const r={...Np,...t};return Ac(e,r)}function Fp(e,t){let r="";const n=t.treeAdapter.isElementNode(e)&&t.treeAdapter.getTagName(e)===se.TEMPLATE&&t.treeAdapter.getNamespaceURI(e)===ce.HTML?t.treeAdapter.getTemplateContent(e):e,i=t.treeAdapter.getChildNodes(n);if(i)for(const y of i)r+=Ac(y,t);return r}function Ac(e,t){return t.treeAdapter.isElementNode(e)?kp(e,t):t.treeAdapter.isTextNode(e)?Up(e,t):t.treeAdapter.isCommentNode(e)?wp(e,t):t.treeAdapter.isDocumentTypeNode(e)?Hp(e,t):""}function kp(e,t){const r=t.treeAdapter.getTagName(e);return`<${r}${Bp(e,t)}>${Pp(e,t)?"":`${Fp(e,t)}</${r}>`}`}function Bp(e,{treeAdapter:t}){let r="";for(const n of t.getAttrList(e)){if(r+=" ",!n.namespace)r+=n.name;else switch(n.namespace){case ce.XML:{r+=`xml:${n.name}`;break}case ce.XMLNS:{n.name!=="xmlns"&&(r+="xmlns:"),r+=n.name;break}case ce.XLINK:{r+=`xlink:${n.name}`;break}default:r+=`${n.prefix}:${n.name}`}r+=`="${ll(n.value)}"`}return r}function Up(e,t){const{treeAdapter:r}=t,n=r.getTextNodeContent(e),i=r.getParentNode(e),y=i&&r.isElementNode(i)&&r.getTagName(i);return y&&r.getNamespaceURI(i)===ce.HTML&&pm(y,t.scriptingEnabled)?n:cl(n)}function wp(e,{treeAdapter:t}){return`<!--${t.getCommentNodeContent(e)}-->`}function Hp(e,{treeAdapter:t}){return`<!DOCTYPE ${t.getDocumentTypeNodeName(e)}>`}function Kp(e,t){return sc.parse(e,t)}function Wp(e,t,r){typeof e=="string"&&(r=t,t=e,e=null);const n=sc.getFragmentParser(e,r);return n.tokenizer.write(t,!0),n.getFragment()}function wu(e){return new vn(e)}function Hu(e){const t=e.includes('"')?"'":'"';return t+e+t}function Gp(e,t,r){let n="!DOCTYPE ";return e&&(n+=e),t?n+=` PUBLIC ${Hu(t)}`:r&&(n+=" SYSTEM"),r&&(n+=` ${Hu(r)}`),n}const Sr={isCommentNode:Ti,isElementNode:be,isTextNode:Nt,createDocument(){const e=new gr([]);return e["x-mode"]=at.NO_QUIRKS,e},createDocumentFragment(){return new gr([])},createElement(e,t,r){const n=Object.create(null),i=Object.create(null),y=Object.create(null);for(let C=0;C<r.length;C++){const u=r[C].name;n[u]=r[C].value,i[u]=r[C].namespace,y[u]=r[C].prefix}const M=new ta(e,n,[]);return M.namespace=t,M["x-attribsNamespace"]=i,M["x-attribsPrefix"]=y,M},createCommentNode(e){return new Js(e)},appendChild(e,t){const r=e.children[e.children.length-1];r&&(r.next=t,t.prev=r),e.children.push(t),t.parent=e},insertBefore(e,t,r){const n=e.children.indexOf(r),{prev:i}=r;i&&(i.next=t,t.prev=i),r.prev=t,t.next=r,e.children.splice(n,0,t),t.parent=e},setTemplateContent(e,t){Sr.appendChild(e,t)},getTemplateContent(e){return e.children[0]},setDocumentType(e,t,r,n){const i=Gp(t,r,n);let y=e.children.find(M=>vs(M)&&M.name==="!doctype");y?y.data=i??null:(y=new Zs("!doctype",i),Sr.appendChild(e,y)),y["x-name"]=t??void 0,y["x-publicId"]=r??void 0,y["x-systemId"]=n??void 0},setDocumentMode(e,t){e["x-mode"]=t},getDocumentMode(e){return e["x-mode"]},detachNode(e){if(e.parent){const t=e.parent.children.indexOf(e),{prev:r,next:n}=e;e.prev=null,e.next=null,r&&(r.next=n),n&&(n.prev=r),e.parent.children.splice(t,1),e.parent=null}},insertText(e,t){const r=e.children[e.children.length-1];r&&Nt(r)?r.data+=t:Sr.appendChild(e,wu(t))},insertTextBefore(e,t,r){const n=e.children[e.children.indexOf(r)-1];n&&Nt(n)?n.data+=t:Sr.insertBefore(e,wu(t),r)},adoptAttributes(e,t){for(let r=0;r<t.length;r++){const n=t[r].name;typeof e.attribs[n]>"u"&&(e.attribs[n]=t[r].value,e["x-attribsNamespace"][n]=t[r].namespace,e["x-attribsPrefix"][n]=t[r].prefix)}},getFirstChild(e){return e.children[0]},getChildNodes(e){return e.children},getParentNode(e){return e.parent},getAttrList(e){return e.attributes},getTagName(e){return e.name},getNamespaceURI(e){return e.namespace},getTextNodeContent(e){return e.data},getCommentNodeContent(e){return e.data},getDocumentTypeNodeName(e){var t;return(t=e["x-name"])!==null&&t!==void 0?t:""},getDocumentTypeNodePublicId(e){var t;return(t=e["x-publicId"])!==null&&t!==void 0?t:""},getDocumentTypeNodeSystemId(e){var t;return(t=e["x-systemId"])!==null&&t!==void 0?t:""},isDocumentTypeNode(e){return vs(e)&&e.name==="!doctype"},setNodeSourceCodeLocation(e,t){t&&(e.startIndex=t.startOffset,e.endIndex=t.endOffset),e.sourceCodeLocation=t},getNodeSourceCodeLocation(e){return e.sourceCodeLocation},updateNodeSourceCodeLocation(e,t){t.endOffset!=null&&(e.endIndex=t.endOffset),e.sourceCodeLocation={...e.sourceCodeLocation,...t}}};function Yp(e,t,r,n){const i={scriptingEnabled:typeof t.scriptingEnabled=="boolean"?t.scriptingEnabled:!0,treeAdapter:Sr,sourceCodeLocationInfo:t.sourceCodeLocationInfo};return r?Kp(e,i):Wp(n,e,i)}const Vp={treeAdapter:Sr};function jp(e){const t="length"in e?e:[e];for(let n=0;n<t.length;n+=1){const i=t[n];mr(i)&&Array.prototype.splice.call(t,n,1,...i.children)}let r="";for(let n=0;n<t.length;n+=1){const i=t[n];r+=Mp(i,Vp)}return r}var ve;(function(e){e[e.Tab=9]="Tab",e[e.NewLine=10]="NewLine",e[e.FormFeed=12]="FormFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.Num=35]="Num",e[e.Amp=38]="Amp",e[e.SingleQuote=39]="SingleQuote",e[e.DoubleQuote=34]="DoubleQuote",e[e.Dash=45]="Dash",e[e.Slash=47]="Slash",e[e.Zero=48]="Zero",e[e.Nine=57]="Nine",e[e.Semi=59]="Semi",e[e.Lt=60]="Lt",e[e.Eq=61]="Eq",e[e.Gt=62]="Gt",e[e.Questionmark=63]="Questionmark",e[e.UpperA=65]="UpperA",e[e.LowerA=97]="LowerA",e[e.UpperF=70]="UpperF",e[e.LowerF=102]="LowerF",e[e.UpperZ=90]="UpperZ",e[e.LowerZ=122]="LowerZ",e[e.LowerX=120]="LowerX",e[e.OpeningSquareBracket=91]="OpeningSquareBracket"})(ve||(ve={}));var fe;(function(e){e[e.Text=1]="Text",e[e.BeforeTagName=2]="BeforeTagName",e[e.InTagName=3]="InTagName",e[e.InSelfClosingTag=4]="InSelfClosingTag",e[e.BeforeClosingTagName=5]="BeforeClosingTagName",e[e.InClosingTagName=6]="InClosingTagName",e[e.AfterClosingTagName=7]="AfterClosingTagName",e[e.BeforeAttributeName=8]="BeforeAttributeName",e[e.InAttributeName=9]="InAttributeName",e[e.AfterAttributeName=10]="AfterAttributeName",e[e.BeforeAttributeValue=11]="BeforeAttributeValue",e[e.InAttributeValueDq=12]="InAttributeValueDq",e[e.InAttributeValueSq=13]="InAttributeValueSq",e[e.InAttributeValueNq=14]="InAttributeValueNq",e[e.BeforeDeclaration=15]="BeforeDeclaration",e[e.InDeclaration=16]="InDeclaration",e[e.InProcessingInstruction=17]="InProcessingInstruction",e[e.BeforeComment=18]="BeforeComment",e[e.CDATASequence=19]="CDATASequence",e[e.InSpecialComment=20]="InSpecialComment",e[e.InCommentLike=21]="InCommentLike",e[e.BeforeSpecialS=22]="BeforeSpecialS",e[e.SpecialStartSequence=23]="SpecialStartSequence",e[e.InSpecialTag=24]="InSpecialTag",e[e.BeforeEntity=25]="BeforeEntity",e[e.BeforeNumericEntity=26]="BeforeNumericEntity",e[e.InNamedEntity=27]="InNamedEntity",e[e.InNumericEntity=28]="InNumericEntity",e[e.InHexEntity=29]="InHexEntity"})(fe||(fe={}));function Bt(e){return e===ve.Space||e===ve.NewLine||e===ve.Tab||e===ve.FormFeed||e===ve.CarriageReturn}function Un(e){return e===ve.Slash||e===ve.Gt||Bt(e)}function Ku(e){return e>=ve.Zero&&e<=ve.Nine}function Xp(e){return e>=ve.LowerA&&e<=ve.LowerZ||e>=ve.UpperA&&e<=ve.UpperZ}function Qp(e){return e>=ve.UpperA&&e<=ve.UpperF||e>=ve.LowerA&&e<=ve.LowerF}var Pt;(function(e){e[e.NoValue=0]="NoValue",e[e.Unquoted=1]="Unquoted",e[e.Single=2]="Single",e[e.Double=3]="Double"})(Pt||(Pt={}));const nt={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])};class $p{constructor({xmlMode:t=!1,decodeEntities:r=!0},n){this.cbs=n,this.state=fe.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=fe.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=t,this.decodeEntities=r,this.entityTrie=t?h0:jt}reset(){this.state=fe.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=fe.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(t){this.offset+=this.buffer.length,this.buffer=t,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}getIndex(){return this.index}getSectionStart(){return this.sectionStart}stateText(t){t===ve.Lt||!this.decodeEntities&&this.fastForwardTo(ve.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=fe.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&t===ve.Amp&&(this.state=fe.BeforeEntity)}stateSpecialStartSequence(t){const r=this.sequenceIndex===this.currentSequence.length;if(!(r?Un(t):(t|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!r){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=fe.InTagName,this.stateInTagName(t)}stateInSpecialTag(t){if(this.sequenceIndex===this.currentSequence.length){if(t===ve.Gt||Bt(t)){const r=this.index-this.currentSequence.length;if(this.sectionStart<r){const n=this.index;this.index=r,this.cbs.ontext(this.sectionStart,r),this.index=n}this.isSpecial=!1,this.sectionStart=r+2,this.stateInClosingTagName(t);return}this.sequenceIndex=0}(t|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===nt.TitleEnd?this.decodeEntities&&t===ve.Amp&&(this.state=fe.BeforeEntity):this.fastForwardTo(ve.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=Number(t===ve.Lt)}stateCDATASequence(t){t===nt.Cdata[this.sequenceIndex]?++this.sequenceIndex===nt.Cdata.length&&(this.state=fe.InCommentLike,this.currentSequence=nt.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=fe.InDeclaration,this.stateInDeclaration(t))}fastForwardTo(t){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===t)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(t){t===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===nt.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=fe.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):t!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(t){return this.xmlMode?!Un(t):Xp(t)}startSpecial(t,r){this.isSpecial=!0,this.currentSequence=t,this.sequenceIndex=r,this.state=fe.SpecialStartSequence}stateBeforeTagName(t){if(t===ve.ExclamationMark)this.state=fe.BeforeDeclaration,this.sectionStart=this.index+1;else if(t===ve.Questionmark)this.state=fe.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(t)){const r=t|32;this.sectionStart=this.index,!this.xmlMode&&r===nt.TitleEnd[2]?this.startSpecial(nt.TitleEnd,3):this.state=!this.xmlMode&&r===nt.ScriptEnd[2]?fe.BeforeSpecialS:fe.InTagName}else t===ve.Slash?this.state=fe.BeforeClosingTagName:(this.state=fe.Text,this.stateText(t))}stateInTagName(t){Un(t)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=fe.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateBeforeClosingTagName(t){Bt(t)||(t===ve.Gt?this.state=fe.Text:(this.state=this.isTagStartChar(t)?fe.InClosingTagName:fe.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(t){(t===ve.Gt||Bt(t))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=fe.AfterClosingTagName,this.stateAfterClosingTagName(t))}stateAfterClosingTagName(t){(t===ve.Gt||this.fastForwardTo(ve.Gt))&&(this.state=fe.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(t){t===ve.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=fe.InSpecialTag,this.sequenceIndex=0):this.state=fe.Text,this.baseState=this.state,this.sectionStart=this.index+1):t===ve.Slash?this.state=fe.InSelfClosingTag:Bt(t)||(this.state=fe.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(t){t===ve.Gt?(this.cbs.onselfclosingtag(this.index),this.state=fe.Text,this.baseState=fe.Text,this.sectionStart=this.index+1,this.isSpecial=!1):Bt(t)||(this.state=fe.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateInAttributeName(t){(t===ve.Eq||Un(t))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=fe.AfterAttributeName,this.stateAfterAttributeName(t))}stateAfterAttributeName(t){t===ve.Eq?this.state=fe.BeforeAttributeValue:t===ve.Slash||t===ve.Gt?(this.cbs.onattribend(Pt.NoValue,this.index),this.state=fe.BeforeAttributeName,this.stateBeforeAttributeName(t)):Bt(t)||(this.cbs.onattribend(Pt.NoValue,this.index),this.state=fe.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(t){t===ve.DoubleQuote?(this.state=fe.InAttributeValueDq,this.sectionStart=this.index+1):t===ve.SingleQuote?(this.state=fe.InAttributeValueSq,this.sectionStart=this.index+1):Bt(t)||(this.sectionStart=this.index,this.state=fe.InAttributeValueNq,this.stateInAttributeValueNoQuotes(t))}handleInAttributeValue(t,r){t===r||!this.decodeEntities&&this.fastForwardTo(r)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(r===ve.DoubleQuote?Pt.Double:Pt.Single,this.index),this.state=fe.BeforeAttributeName):this.decodeEntities&&t===ve.Amp&&(this.baseState=this.state,this.state=fe.BeforeEntity)}stateInAttributeValueDoubleQuotes(t){this.handleInAttributeValue(t,ve.DoubleQuote)}stateInAttributeValueSingleQuotes(t){this.handleInAttributeValue(t,ve.SingleQuote)}stateInAttributeValueNoQuotes(t){Bt(t)||t===ve.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(Pt.Unquoted,this.index),this.state=fe.BeforeAttributeName,this.stateBeforeAttributeName(t)):this.decodeEntities&&t===ve.Amp&&(this.baseState=this.state,this.state=fe.BeforeEntity)}stateBeforeDeclaration(t){t===ve.OpeningSquareBracket?(this.state=fe.CDATASequence,this.sequenceIndex=0):this.state=t===ve.Dash?fe.BeforeComment:fe.InDeclaration}stateInDeclaration(t){(t===ve.Gt||this.fastForwardTo(ve.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=fe.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(t){(t===ve.Gt||this.fastForwardTo(ve.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=fe.Text,this.sectionStart=this.index+1)}stateBeforeComment(t){t===ve.Dash?(this.state=fe.InCommentLike,this.currentSequence=nt.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=fe.InDeclaration}stateInSpecialComment(t){(t===ve.Gt||this.fastForwardTo(ve.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=fe.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(t){const r=t|32;r===nt.ScriptEnd[3]?this.startSpecial(nt.ScriptEnd,4):r===nt.StyleEnd[3]?this.startSpecial(nt.StyleEnd,4):(this.state=fe.InTagName,this.stateInTagName(t))}stateBeforeEntity(t){this.entityExcess=1,this.entityResult=0,t===ve.Num?this.state=fe.BeforeNumericEntity:t===ve.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=fe.InNamedEntity,this.stateInNamedEntity(t))}stateInNamedEntity(t){if(this.entityExcess+=1,this.trieIndex=al(this.entityTrie,this.trieCurrent,this.trieIndex+1,t),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];const r=this.trieCurrent&Kt.VALUE_LENGTH;if(r){const n=(r>>14)-1;if(!this.allowLegacyEntity()&&t!==ve.Semi)this.trieIndex+=n;else{const i=this.index-this.entityExcess+1;i>this.sectionStart&&this.emitPartial(this.sectionStart,i),this.entityResult=this.trieIndex,this.trieIndex+=n,this.entityExcess=0,this.sectionStart=this.index+1,n===0&&this.emitNamedEntity()}}}emitNamedEntity(){if(this.state=this.baseState,this.entityResult===0)return;switch((this.entityTrie[this.entityResult]&Kt.VALUE_LENGTH)>>14){case 1:this.emitCodePoint(this.entityTrie[this.entityResult]&~Kt.VALUE_LENGTH);break;case 2:this.emitCodePoint(this.entityTrie[this.entityResult+1]);break;case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}stateBeforeNumericEntity(t){(t|32)===ve.LowerX?(this.entityExcess++,this.state=fe.InHexEntity):(this.state=fe.InNumericEntity,this.stateInNumericEntity(t))}emitNumericEntity(t){const r=this.index-this.entityExcess-1;r+2+Number(this.state===fe.InHexEntity)!==this.index&&(r>this.sectionStart&&this.emitPartial(this.sectionStart,r),this.sectionStart=this.index+Number(t),this.emitCodePoint(E0(this.entityResult))),this.state=this.baseState}stateInNumericEntity(t){t===ve.Semi?this.emitNumericEntity(!0):Ku(t)?(this.entityResult=this.entityResult*10+(t-ve.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}stateInHexEntity(t){t===ve.Semi?this.emitNumericEntity(!0):Ku(t)?(this.entityResult=this.entityResult*16+(t-ve.Zero),this.entityExcess++):Qp(t)?(this.entityResult=this.entityResult*16+((t|32)-ve.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}allowLegacyEntity(){return!this.xmlMode&&(this.baseState===fe.Text||this.baseState===fe.InSpecialTag)}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===fe.Text||this.state===fe.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===fe.InAttributeValueDq||this.state===fe.InAttributeValueSq||this.state===fe.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const t=this.buffer.charCodeAt(this.index-this.offset);this.state===fe.Text?this.stateText(t):this.state===fe.SpecialStartSequence?this.stateSpecialStartSequence(t):this.state===fe.InSpecialTag?this.stateInSpecialTag(t):this.state===fe.CDATASequence?this.stateCDATASequence(t):this.state===fe.InAttributeValueDq?this.stateInAttributeValueDoubleQuotes(t):this.state===fe.InAttributeName?this.stateInAttributeName(t):this.state===fe.InCommentLike?this.stateInCommentLike(t):this.state===fe.InSpecialComment?this.stateInSpecialComment(t):this.state===fe.BeforeAttributeName?this.stateBeforeAttributeName(t):this.state===fe.InTagName?this.stateInTagName(t):this.state===fe.InClosingTagName?this.stateInClosingTagName(t):this.state===fe.BeforeTagName?this.stateBeforeTagName(t):this.state===fe.AfterAttributeName?this.stateAfterAttributeName(t):this.state===fe.InAttributeValueSq?this.stateInAttributeValueSingleQuotes(t):this.state===fe.BeforeAttributeValue?this.stateBeforeAttributeValue(t):this.state===fe.BeforeClosingTagName?this.stateBeforeClosingTagName(t):this.state===fe.AfterClosingTagName?this.stateAfterClosingTagName(t):this.state===fe.BeforeSpecialS?this.stateBeforeSpecialS(t):this.state===fe.InAttributeValueNq?this.stateInAttributeValueNoQuotes(t):this.state===fe.InSelfClosingTag?this.stateInSelfClosingTag(t):this.state===fe.InDeclaration?this.stateInDeclaration(t):this.state===fe.BeforeDeclaration?this.stateBeforeDeclaration(t):this.state===fe.BeforeComment?this.stateBeforeComment(t):this.state===fe.InProcessingInstruction?this.stateInProcessingInstruction(t):this.state===fe.InNamedEntity?this.stateInNamedEntity(t):this.state===fe.BeforeEntity?this.stateBeforeEntity(t):this.state===fe.InHexEntity?this.stateInHexEntity(t):this.state===fe.InNumericEntity?this.stateInNumericEntity(t):this.stateBeforeNumericEntity(t),this.index++}this.cleanup()}finish(){this.state===fe.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const t=this.buffer.length+this.offset;this.state===fe.InCommentLike?this.currentSequence===nt.CdataEnd?this.cbs.oncdata(this.sectionStart,t,0):this.cbs.oncomment(this.sectionStart,t,0):this.state===fe.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===fe.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===fe.InTagName||this.state===fe.BeforeAttributeName||this.state===fe.BeforeAttributeValue||this.state===fe.AfterAttributeName||this.state===fe.InAttributeName||this.state===fe.InAttributeValueSq||this.state===fe.InAttributeValueDq||this.state===fe.InAttributeValueNq||this.state===fe.InClosingTagName||this.cbs.ontext(this.sectionStart,t)}emitPartial(t,r){this.baseState!==fe.Text&&this.baseState!==fe.InSpecialTag?this.cbs.onattribdata(t,r):this.cbs.ontext(t,r)}emitCodePoint(t){this.baseState!==fe.Text&&this.baseState!==fe.InSpecialTag?this.cbs.onattribentity(t):this.cbs.ontextentity(t)}}const Ar=new Set(["input","option","optgroup","select","button","datalist","textarea"]),Me=new Set(["p"]),Wu=new Set(["thead","tbody"]),Gu=new Set(["dd","dt"]),Yu=new Set(["rt","rp"]),zp=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",Me],["h1",Me],["h2",Me],["h3",Me],["h4",Me],["h5",Me],["h6",Me],["select",Ar],["input",Ar],["output",Ar],["button",Ar],["datalist",Ar],["textarea",Ar],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",Gu],["dt",Gu],["address",Me],["article",Me],["aside",Me],["blockquote",Me],["details",Me],["div",Me],["dl",Me],["fieldset",Me],["figcaption",Me],["figure",Me],["footer",Me],["form",Me],["header",Me],["hr",Me],["main",Me],["nav",Me],["ol",Me],["pre",Me],["section",Me],["table",Me],["ul",Me],["rt",Yu],["rp",Yu],["tbody",Wu],["tfoot",Wu]]),qp=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),Vu=new Set(["math","svg"]),ju=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),Jp=/\s|\//;class Zp{constructor(t,r={}){var n,i,y,M,C;this.options=r,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=t??{},this.lowerCaseTagNames=(n=r.lowerCaseTags)!==null&&n!==void 0?n:!r.xmlMode,this.lowerCaseAttributeNames=(i=r.lowerCaseAttributeNames)!==null&&i!==void 0?i:!r.xmlMode,this.tokenizer=new((y=r.Tokenizer)!==null&&y!==void 0?y:$p)(this.options,this),(C=(M=this.cbs).onparserinit)===null||C===void 0||C.call(M,this)}ontext(t,r){var n,i;const y=this.getSlice(t,r);this.endIndex=r-1,(i=(n=this.cbs).ontext)===null||i===void 0||i.call(n,y),this.startIndex=r}ontextentity(t){var r,n;const i=this.tokenizer.getSectionStart();this.endIndex=i-1,(n=(r=this.cbs).ontext)===null||n===void 0||n.call(r,hu(t)),this.startIndex=i}isVoidElement(t){return!this.options.xmlMode&&qp.has(t)}onopentagname(t,r){this.endIndex=r;let n=this.getSlice(t,r);this.lowerCaseTagNames&&(n=n.toLowerCase()),this.emitOpenTag(n)}emitOpenTag(t){var r,n,i,y;this.openTagStart=this.startIndex,this.tagname=t;const M=!this.options.xmlMode&&zp.get(t);if(M)for(;this.stack.length>0&&M.has(this.stack[this.stack.length-1]);){const C=this.stack.pop();(n=(r=this.cbs).onclosetag)===null||n===void 0||n.call(r,C,!0)}this.isVoidElement(t)||(this.stack.push(t),Vu.has(t)?this.foreignContext.push(!0):ju.has(t)&&this.foreignContext.push(!1)),(y=(i=this.cbs).onopentagname)===null||y===void 0||y.call(i,t),this.cbs.onopentag&&(this.attribs={})}endOpenTag(t){var r,n;this.startIndex=this.openTagStart,this.attribs&&((n=(r=this.cbs).onopentag)===null||n===void 0||n.call(r,this.tagname,this.attribs,t),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(t){this.endIndex=t,this.endOpenTag(!1),this.startIndex=t+1}onclosetag(t,r){var n,i,y,M,C,u;this.endIndex=r;let R=this.getSlice(t,r);if(this.lowerCaseTagNames&&(R=R.toLowerCase()),(Vu.has(R)||ju.has(R))&&this.foreignContext.pop(),this.isVoidElement(R))!this.options.xmlMode&&R==="br"&&((i=(n=this.cbs).onopentagname)===null||i===void 0||i.call(n,"br"),(M=(y=this.cbs).onopentag)===null||M===void 0||M.call(y,"br",{},!0),(u=(C=this.cbs).onclosetag)===null||u===void 0||u.call(C,"br",!1));else{const _=this.stack.lastIndexOf(R);if(_!==-1)if(this.cbs.onclosetag){let U=this.stack.length-_;for(;U--;)this.cbs.onclosetag(this.stack.pop(),U!==0)}else this.stack.length=_;else!this.options.xmlMode&&R==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=r+1}onselfclosingtag(t){this.endIndex=t,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=t+1):this.onopentagend(t)}closeCurrentTag(t){var r,n;const i=this.tagname;this.endOpenTag(t),this.stack[this.stack.length-1]===i&&((n=(r=this.cbs).onclosetag)===null||n===void 0||n.call(r,i,!t),this.stack.pop())}onattribname(t,r){this.startIndex=t;const n=this.getSlice(t,r);this.attribname=this.lowerCaseAttributeNames?n.toLowerCase():n}onattribdata(t,r){this.attribvalue+=this.getSlice(t,r)}onattribentity(t){this.attribvalue+=hu(t)}onattribend(t,r){var n,i;this.endIndex=r,(i=(n=this.cbs).onattribute)===null||i===void 0||i.call(n,this.attribname,this.attribvalue,t===Pt.Double?'"':t===Pt.Single?"'":t===Pt.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(t){const r=t.search(Jp);let n=r<0?t:t.substr(0,r);return this.lowerCaseTagNames&&(n=n.toLowerCase()),n}ondeclaration(t,r){this.endIndex=r;const n=this.getSlice(t,r);if(this.cbs.onprocessinginstruction){const i=this.getInstructionName(n);this.cbs.onprocessinginstruction(`!${i}`,`!${n}`)}this.startIndex=r+1}onprocessinginstruction(t,r){this.endIndex=r;const n=this.getSlice(t,r);if(this.cbs.onprocessinginstruction){const i=this.getInstructionName(n);this.cbs.onprocessinginstruction(`?${i}`,`?${n}`)}this.startIndex=r+1}oncomment(t,r,n){var i,y,M,C;this.endIndex=r,(y=(i=this.cbs).oncomment)===null||y===void 0||y.call(i,this.getSlice(t,r-n)),(C=(M=this.cbs).oncommentend)===null||C===void 0||C.call(M),this.startIndex=r+1}oncdata(t,r,n){var i,y,M,C,u,R,_,U,D,K;this.endIndex=r;const k=this.getSlice(t,r-n);this.options.xmlMode||this.options.recognizeCDATA?((y=(i=this.cbs).oncdatastart)===null||y===void 0||y.call(i),(C=(M=this.cbs).ontext)===null||C===void 0||C.call(M,k),(R=(u=this.cbs).oncdataend)===null||R===void 0||R.call(u)):((U=(_=this.cbs).oncomment)===null||U===void 0||U.call(_,`[CDATA[${k}]]`),(K=(D=this.cbs).oncommentend)===null||K===void 0||K.call(D)),this.startIndex=r+1}onend(){var t,r;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let n=this.stack.length;n>0;this.cbs.onclosetag(this.stack[--n],!0));}(r=(t=this.cbs).onend)===null||r===void 0||r.call(t)}reset(){var t,r,n,i;(r=(t=this.cbs).onreset)===null||r===void 0||r.call(t),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(i=(n=this.cbs).onparserinit)===null||i===void 0||i.call(n,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(t){this.reset(),this.end(t)}getSlice(t,r){for(;t-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let n=this.buffers[0].slice(t-this.bufferOffset,r-this.bufferOffset);for(;r-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),n+=this.buffers[0].slice(0,r-this.bufferOffset);return n}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(t){var r,n;if(this.ended){(n=(r=this.cbs).onerror)===null||n===void 0||n.call(r,new Error(".write() after done!"));return}this.buffers.push(t),this.tokenizer.running&&(this.tokenizer.write(t),this.writeIndex++)}end(t){var r,n;if(this.ended){(n=(r=this.cbs).onerror)===null||n===void 0||n.call(r,Error(".end() after done!"));return}t&&this.write(t),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(t){this.write(t)}done(t){this.end(t)}}function eT(e,t){const r=new d0(void 0,t);return new Zp(r,t).end(e),r.root}const tT=PE((e,t,r,n)=>t.xmlMode||t._useHtmlParser2?eT(e,t):Yp(e,t,r,n)),rT=om(tT,(e,t)=>t.xmlMode||t._useHtmlParser2?_i(e,t):jp(e));rT([]);var Cs={},nT={get exports(){return Cs},set exports(e){Cs=e}};(function(e,t){typeof window<"u"&&function(n,i){e.exports=i()}(yg,()=>(()=>{var r={"./src/config.ts":(M,C,u)=>{u.r(C),u.d(C,{enableStreamingMode:()=>p,hlsDefaultConfig:()=>v,mergeConfig:()=>s});var R=u("./src/controller/abr-controller.ts"),_=u("./src/controller/audio-stream-controller.ts"),U=u("./src/controller/audio-track-controller.ts"),D=u("./src/controller/subtitle-stream-controller.ts"),K=u("./src/controller/subtitle-track-controller.ts"),k=u("./src/controller/buffer-controller.ts"),F=u("./src/controller/timeline-controller.ts"),B=u("./src/controller/cap-level-controller.ts"),O=u("./src/controller/fps-controller.ts"),P=u("./src/controller/eme-controller.ts"),g=u("./src/controller/cmcd-controller.ts"),N=u("./src/utils/xhr-loader.ts"),S=u("./src/utils/fetch-loader.ts"),f=u("./src/utils/cues.ts"),m=u("./src/utils/mediakeys-helper.ts"),d=u("./src/utils/logger.ts");function l(){return l=Object.assign?Object.assign.bind():function(a){for(var T=1;T<arguments.length;T++){var L=arguments[T];for(var I in L)Object.prototype.hasOwnProperty.call(L,I)&&(a[I]=L[I])}return a},l.apply(this,arguments)}function b(a,T){var L=Object.keys(a);if(Object.getOwnPropertySymbols){var I=Object.getOwnPropertySymbols(a);T&&(I=I.filter(function(H){return Object.getOwnPropertyDescriptor(a,H).enumerable})),L.push.apply(L,I)}return L}function h(a){for(var T=1;T<arguments.length;T++){var L=arguments[T]!=null?arguments[T]:{};T%2?b(Object(L),!0).forEach(function(I){o(a,I,L[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(L)):b(Object(L)).forEach(function(I){Object.defineProperty(a,I,Object.getOwnPropertyDescriptor(L,I))})}return a}function o(a,T,L){return T=E(T),T in a?Object.defineProperty(a,T,{value:L,enumerable:!0,configurable:!0,writable:!0}):a[T]=L,a}function E(a){var T=A(a,"string");return typeof T=="symbol"?T:String(T)}function A(a,T){if(typeof a!="object"||a===null)return a;var L=a[Symbol.toPrimitive];if(L!==void 0){var I=L.call(a,T||"default");if(typeof I!="object")return I;throw new TypeError("@@toPrimitive must return a primitive value.")}return(T==="string"?String:Number)(a)}var v=h(h({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:N.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:R.default,bufferController:k.default,capLevelController:B.default,fpsController:O.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:m.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},c()),{},{subtitleStreamController:D.SubtitleStreamController,subtitleTrackController:K.default,timelineController:F.TimelineController,audioStreamController:_.default,audioTrackController:U.default,emeController:P.default,cmcdController:g.default});function c(){return{cueHandler:f.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function s(a,T){if((T.liveSyncDurationCount||T.liveMaxLatencyDurationCount)&&(T.liveSyncDuration||T.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(T.liveMaxLatencyDurationCount!==void 0&&(T.liveSyncDurationCount===void 0||T.liveMaxLatencyDurationCount<=T.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(T.liveMaxLatencyDuration!==void 0&&(T.liveSyncDuration===void 0||T.liveMaxLatencyDuration<=T.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return l({},a,T)}function p(a){var T=a.loader;if(T!==S.default&&T!==N.default)d.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1;else{var L=(0,S.fetchSupported)();L&&(a.loader=S.default,a.progressive=!0,a.enableSoftwareAES=!0,d.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>N});var R=u("./src/polyfills/number.ts"),_=u("./src/utils/ewma-bandwidth-estimator.ts"),U=u("./src/events.ts"),D=u("./src/errors.ts"),K=u("./src/types/loader.ts"),k=u("./src/utils/logger.ts");function F(S,f){for(var m=0;m<f.length;m++){var d=f[m];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(S,O(d.key),d)}}function B(S,f,m){return f&&F(S.prototype,f),m&&F(S,m),Object.defineProperty(S,"prototype",{writable:!1}),S}function O(S){var f=P(S,"string");return typeof f=="symbol"?f:String(f)}function P(S,f){if(typeof S!="object"||S===null)return S;var m=S[Symbol.toPrimitive];if(m!==void 0){var d=m.call(S,f||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(S)}var g=function(){function S(m){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=m;var d=m.config;this.bwEstimator=new _.default(d.abrEwmaSlowVoD,d.abrEwmaFastVoD,d.abrEwmaDefaultEstimate),this.registerListeners()}var f=S.prototype;return f.registerListeners=function(){var d=this.hls;d.on(U.Events.FRAG_LOADING,this.onFragLoading,this),d.on(U.Events.FRAG_LOADED,this.onFragLoaded,this),d.on(U.Events.FRAG_BUFFERED,this.onFragBuffered,this),d.on(U.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.on(U.Events.ERROR,this.onError,this)},f.unregisterListeners=function(){var d=this.hls;d.off(U.Events.FRAG_LOADING,this.onFragLoading,this),d.off(U.Events.FRAG_LOADED,this.onFragLoaded,this),d.off(U.Events.FRAG_BUFFERED,this.onFragBuffered,this),d.off(U.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.off(U.Events.ERROR,this.onError,this)},f.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},f.onFragLoading=function(d,l){var b=l.frag;if(b.type===K.PlaylistLevelType.MAIN&&!this.timer){var h;this.fragCurrent=b,this.partCurrent=(h=l.part)!=null?h:null,this.timer=self.setInterval(this.onCheck,100)}},f.onLevelLoaded=function(d,l){var b=this.hls.config;l.details.live?this.bwEstimator.update(b.abrEwmaSlowLive,b.abrEwmaFastLive):this.bwEstimator.update(b.abrEwmaSlowVoD,b.abrEwmaFastVoD)},f._abandonRulesCheck=function(){var d=this.fragCurrent,l=this.partCurrent,b=this.hls,h=b.autoLevelEnabled,o=b.media;if(!(!d||!o)){var E=l?l.stats:d.stats,A=l?l.duration:d.duration;if(E.aborted||E.loaded&&E.loaded===E.total||d.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!h||o.paused||!o.playbackRate||!o.readyState)){var v=b.mainForwardBufferInfo;if(v!==null){var c=performance.now()-E.loading.start,s=Math.abs(o.playbackRate);if(!(c<=500*A/s)){var p=E.loaded&&E.loading.first,a=this.bwEstimator.getEstimate(),T=b.levels,L=b.minAutoLevel,I=T[d.level],H=E.total||Math.max(E.loaded,Math.round(A*I.maxBitrate/8)),W=p?E.loaded*1e3/c:0,w=W?(H-E.loaded)/W:H*8/a,G=v.len/s;if(!(w<=G)){var Y=Number.POSITIVE_INFINITY,j;for(j=d.level-1;j>L;j--){var X=T[j].maxBitrate;if(Y=W?A*X/(8*.8*W):A*X/a,Y<G)break}Y>=w||(k.logger.warn("Fragment "+d.sn+(l?" part "+l.index:"")+" of level "+d.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+j+`
      Current BW estimate: `+((0,R.isFiniteNumber)(a)?(a/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+w.toFixed(3)+` s
      Estimated load time for the next fragment: `+Y.toFixed(3)+` s
      Time to underbuffer: `+G.toFixed(3)+" s"),b.nextLoadLevel=j,p&&this.bwEstimator.sample(c,E.loaded),this.clearTimer(),(d.loader||d.keyLoader)&&(this.fragCurrent=this.partCurrent=null,d.abortRequests()),b.trigger(U.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:d,part:l,stats:E}))}}}}}},f.onFragLoaded=function(d,l){var b=l.frag,h=l.part;if(b.type===K.PlaylistLevelType.MAIN&&(0,R.isFiniteNumber)(b.sn)){var o=h?h.stats:b.stats,E=h?h.duration:b.duration;if(this.clearTimer(),this.lastLoadedFragLevel=b.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var A=this.hls.levels[b.level],v=(A.loaded?A.loaded.bytes:0)+o.loaded,c=(A.loaded?A.loaded.duration:0)+E;A.loaded={bytes:v,duration:c},A.realBitrate=Math.round(8*v/c)}if(b.bitrateTest){var s={stats:o,frag:b,part:h,id:b.type};this.onFragBuffered(U.Events.FRAG_BUFFERED,s)}}},f.onFragBuffered=function(d,l){var b=l.frag,h=l.part,o=h?h.stats:b.stats;if(!o.aborted&&!(b.type!==K.PlaylistLevelType.MAIN||b.sn==="initSegment")){var E=o.parsing.end-o.loading.start;this.bwEstimator.sample(E,o.loaded),o.bwEstimate=this.bwEstimator.getEstimate(),b.bitrateTest?this.bitrateTestDelay=E/1e3:this.bitrateTestDelay=0}},f.onError=function(d,l){var b;if(((b=l.frag)===null||b===void 0?void 0:b.type)===K.PlaylistLevelType.MAIN){if(l.type===D.ErrorTypes.KEY_SYSTEM_ERROR){this.clearTimer();return}switch(l.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer();break}}},f.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},f.getNextABRAutoLevel=function(){var d=this.fragCurrent,l=this.partCurrent,b=this.hls,h=b.maxAutoLevel,o=b.config,E=b.minAutoLevel,A=b.media,v=l?l.duration:d?d.duration:0,c=A&&A.playbackRate!==0?Math.abs(A.playbackRate):1,s=this.bwEstimator?this.bwEstimator.getEstimate():o.abrEwmaDefaultEstimate,p=b.mainForwardBufferInfo,a=(p?p.len:0)/c,T=this.findBestLevel(s,E,h,a,o.abrBandWidthFactor,o.abrBandWidthUpFactor);if(T>=0)return T;k.logger.trace((a?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var L=v?Math.min(v,o.maxStarvationDelay):o.maxStarvationDelay,I=o.abrBandWidthFactor,H=o.abrBandWidthUpFactor;if(!a){var W=this.bitrateTestDelay;if(W){var w=v?Math.min(v,o.maxLoadingDelay):o.maxLoadingDelay;L=w-W,k.logger.trace("bitrate test took "+Math.round(1e3*W)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*L)+" ms"),I=H=1}}return T=this.findBestLevel(s,E,h,a+L,I,H),Math.max(T,0)},f.findBestLevel=function(d,l,b,h,o,E){for(var A,v=this.fragCurrent,c=this.partCurrent,s=this.lastLoadedFragLevel,p=this.hls.levels,a=p[s],T=!!(a!=null&&(A=a.details)!==null&&A!==void 0&&A.live),L=a==null?void 0:a.codecSet,I=c?c.duration:v?v.duration:0,H=b;H>=l;H--){var W=p[H];if(!(!W||L&&W.codecSet!==L)){var w=W.details,G=(c?w==null?void 0:w.partTarget:w==null?void 0:w.averagetargetduration)||I,Y=void 0;H<=s?Y=o*d:Y=E*d;var j=p[H].maxBitrate,X=j*G/Y;if(k.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+H+"/"+Math.round(Y)+"/"+j+"/"+G+"/"+h+"/"+X),Y>j&&(X===0||!(0,R.isFiniteNumber)(X)||T&&!this.bitrateTestDelay||X<h))return H}}return-1},B(S,[{key:"nextAutoLevel",get:function(){var d=this._nextAutoLevel,l=this.bwEstimator;if(d!==-1&&!l.canEstimate())return d;var b=this.getNextABRAutoLevel();return d!==-1&&this.hls.levels[b].loadError?d:(d!==-1&&(b=Math.min(d,b)),b)},set:function(d){this._nextAutoLevel=d}}]),S}();const N=g},"./src/controller/audio-stream-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>o});var R=u("./src/polyfills/number.ts"),_=u("./src/controller/base-stream-controller.ts"),U=u("./src/events.ts"),D=u("./src/utils/buffer-helper.ts"),K=u("./src/controller/fragment-tracker.ts"),k=u("./src/types/level.ts"),F=u("./src/types/loader.ts"),B=u("./src/loader/fragment.ts"),O=u("./src/demux/chunk-cache.ts"),P=u("./src/demux/transmuxer-interface.ts"),g=u("./src/types/transmuxer.ts"),N=u("./src/controller/fragment-finders.ts"),S=u("./src/utils/discontinuities.ts"),f=u("./src/errors.ts");function m(){return m=Object.assign?Object.assign.bind():function(E){for(var A=1;A<arguments.length;A++){var v=arguments[A];for(var c in v)Object.prototype.hasOwnProperty.call(v,c)&&(E[c]=v[c])}return E},m.apply(this,arguments)}function d(E,A){E.prototype=Object.create(A.prototype),E.prototype.constructor=E,l(E,A)}function l(E,A){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,s){return c.__proto__=s,c},l(E,A)}var b=100,h=function(E){d(A,E);function A(c,s,p){var a;return a=E.call(this,c,s,p,"[audio-stream-controller]")||this,a.videoBuffer=null,a.videoTrackCC=-1,a.waitingVideoCC=-1,a.audioSwitch=!1,a.trackId=-1,a.waitingData=null,a.mainDetails=null,a.bufferFlushed=!1,a.cachedTrackLoadedData=null,a._registerListeners(),a}var v=A.prototype;return v.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},v._registerListeners=function(){var s=this.hls;s.on(U.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(U.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(U.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(U.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(U.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.on(U.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(U.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(U.Events.ERROR,this.onError,this),s.on(U.Events.BUFFER_RESET,this.onBufferReset,this),s.on(U.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(U.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(U.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(U.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var s=this.hls;s.off(U.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(U.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(U.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(U.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(U.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.off(U.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(U.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(U.Events.ERROR,this.onError,this),s.off(U.Events.BUFFER_RESET,this.onBufferReset,this),s.off(U.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(U.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(U.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(U.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onInitPtsFound=function(s,p){var a=p.frag,T=p.id,L=p.initPTS;if(T==="main"){var I=a.cc;this.initPTS[a.cc]=L,this.log("InitPTS for cc: "+I+" found from main: "+L),this.videoTrackCC=I,this.state===_.State.WAITING_INIT_PTS&&this.tick()}},v.startLoad=function(s){if(!this.levels){this.startPosition=s,this.state=_.State.STOPPED;return}var p=this.lastCurrentTime;this.stopLoad(),this.setInterval(b),this.fragLoadError=0,p>0&&s===-1?(this.log("Override startPosition with lastCurrentTime @"+p.toFixed(3)),s=p,this.state=_.State.IDLE):(this.loadedmetadata=!1,this.state=_.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()},v.doTick=function(){switch(this.state){case _.State.IDLE:this.doTickIdle();break;case _.State.WAITING_TRACK:{var s,p=this.levels,a=this.trackId,T=p==null||(s=p[a])===null||s===void 0?void 0:s.details;if(T){if(this.waitForCdnTuneIn(T))break;this.state=_.State.WAITING_INIT_PTS}break}case _.State.FRAG_LOADING_WAITING_RETRY:{var L,I=performance.now(),H=this.retryDate;(!H||I>=H||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=_.State.IDLE);break}case _.State.WAITING_INIT_PTS:{var W=this.waitingData;if(W){var w=W.frag,G=W.part,Y=W.cache,j=W.complete;if(this.initPTS[w.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=_.State.FRAG_LOADING;var X=Y.flush(),q={frag:w,part:G,payload:X,networkDetails:null};this._handleFragmentLoadProgress(q),j&&E.prototype._handleFragmentLoadComplete.call(this,q)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+w.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var J=this.getLoadPosition(),V=D.BufferHelper.bufferInfo(this.mediaBuffer,J,this.config.maxBufferHole),Q=(0,N.fragmentWithinToleranceTest)(V.end,this.config.maxFragLookUpTolerance,w);Q<0&&(this.log("Waiting fragment cc ("+w.cc+") @ "+w.start+" cancelled because another fragment at "+V.end+" is needed"),this.clearWaitingFragment())}}else this.state=_.State.IDLE}}this.onTickEnd()},v.clearWaitingFragment=function(){var s=this.waitingData;s&&(this.fragmentTracker.removeFragment(s.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=_.State.IDLE)},v.resetLoadingState=function(){this.clearWaitingFragment(),E.prototype.resetLoadingState.call(this)},v.onTickEnd=function(){var s=this.media;!s||!s.readyState||(this.lastCurrentTime=s.currentTime)},v.doTickIdle=function(){var s=this.hls,p=this.levels,a=this.media,T=this.trackId,L=s.config;if(!(!p||!p[T])&&!(!a&&(this.startFragRequested||!L.startFragPrefetch))){var I=p[T],H=I.details;if(!H||H.live&&this.levelLastLoaded!==T||this.waitForCdnTuneIn(H)){this.state=_.State.WAITING_TRACK;return}var W=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&W&&(this.bufferFlushed=!1,this.afterBufferFlushed(W,B.ElementaryStreamTypes.AUDIO,F.PlaylistLevelType.AUDIO));var w=this.getFwdBufferInfo(W,F.PlaylistLevelType.AUDIO);if(w!==null){var G=this.audioSwitch;if(!G&&this._streamEnded(w,H)){s.trigger(U.Events.BUFFER_EOS,{type:"audio"}),this.state=_.State.ENDED;return}var Y=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,F.PlaylistLevelType.MAIN),j=w.len,X=this.getMaxBufferLength(Y==null?void 0:Y.len);if(!(j>=X&&!G)){var q=H.fragments,J=q[0].start,V=w.end;if(G&&a){var Q=this.getLoadPosition();V=Q,H.PTSKnown&&Q<J&&(w.end>J||w.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),a.currentTime=J+.05)}if(!(Y&&V>Y.end+H.targetduration)&&!((!Y||!Y.len)&&w.len)){var ee=this.getNextFragment(V,H);if(!ee){this.bufferFlushed=!0;return}this.loadFragment(ee,H,V)}}}}},v.getMaxBufferLength=function(s){var p=E.prototype.getMaxBufferLength.call(this);return s?Math.max(p,s):p},v.onMediaDetaching=function(){this.videoBuffer=null,E.prototype.onMediaDetaching.call(this)},v.onAudioTracksUpdated=function(s,p){var a=p.audioTracks;this.resetTransmuxer(),this.levels=a.map(function(T){return new k.Level(T)})},v.onAudioTrackSwitching=function(s,p){var a=!!p.url;this.trackId=p.id;var T=this.fragCurrent;T&&T.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),a?this.setInterval(b):this.resetTransmuxer(),a?(this.audioSwitch=!0,this.state=_.State.IDLE):this.state=_.State.STOPPED,this.tick()},v.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},v.onLevelLoaded=function(s,p){this.mainDetails=p.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(U.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},v.onAudioTrackLoaded=function(s,p){var a;if(this.mainDetails==null){this.cachedTrackLoadedData=p;return}var T=this.levels,L=p.details,I=p.id;if(!T){this.warn("Audio tracks were reset while loading level "+I);return}this.log("Track "+I+" loaded ["+L.startSN+","+L.endSN+"],duration:"+L.totalduration);var H=T[I],W=0;if(L.live||(a=H.details)!==null&&a!==void 0&&a.live){var w=this.mainDetails;if(L.fragments[0]||(L.deltaUpdateFailed=!0),L.deltaUpdateFailed||!w)return;!H.details&&L.hasProgramDateTime&&w.hasProgramDateTime?((0,S.alignMediaPlaylistByPDT)(L,w),W=L.fragments[0].start):W=this.alignPlaylists(L,H.details)}H.details=L,this.levelLastLoaded=I,!this.startFragRequested&&(this.mainDetails||!L.live)&&this.setStartPosition(H.details,W),this.state===_.State.WAITING_TRACK&&!this.waitForCdnTuneIn(L)&&(this.state=_.State.IDLE),this.tick()},v._handleFragmentLoadProgress=function(s){var p,a=s.frag,T=s.part,L=s.payload,I=this.config,H=this.trackId,W=this.levels;if(!W){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+a.sn+" of level "+a.level+" will not be buffered");return}var w=W[H];console.assert(w,"Audio track is defined on fragment load progress");var G=w.details;console.assert(G,"Audio track details are defined on fragment load progress");var Y=I.defaultAudioCodec||w.audioCodec||"mp4a.40.2",j=this.transmuxer;j||(j=this.transmuxer=new P.default(this.hls,F.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var X=this.initPTS[a.cc],q=(p=a.initSegment)===null||p===void 0?void 0:p.data;if(X!==void 0){var J=!1,V=T?T.index:-1,Q=V!==-1,ee=new g.ChunkMetadata(a.level,a.sn,a.stats.chunkCount,L.byteLength,V,Q);j.push(L,q,Y,"",a,T,G.totalduration,J,ee,X)}else{this.log("Unknown video PTS for cc "+a.cc+", waiting for video PTS before demuxing audio frag "+a.sn+" of ["+G.startSN+" ,"+G.endSN+"],track "+H);var Z=this.waitingData=this.waitingData||{frag:a,part:T,cache:new O.default,complete:!1},re=Z.cache;re.push(new Uint8Array(L)),this.waitingVideoCC=this.videoTrackCC,this.state=_.State.WAITING_INIT_PTS}},v._handleFragmentLoadComplete=function(s){if(this.waitingData){this.waitingData.complete=!0;return}E.prototype._handleFragmentLoadComplete.call(this,s)},v.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},v.onBufferCreated=function(s,p){var a=p.tracks.audio;a&&(this.mediaBuffer=a.buffer||null),p.tracks.video&&(this.videoBuffer=p.tracks.video.buffer||null)},v.onFragBuffered=function(s,p){var a=p.frag,T=p.part;if(a.type!==F.PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&a.type===F.PlaylistLevelType.MAIN){var L;(L=this.videoBuffer||this.media)!==null&&L!==void 0&&L.buffered.length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(a)){this.warn("Fragment "+a.sn+(T?" p: "+T.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}a.sn!=="initSegment"&&(this.fragPrevious=a,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(U.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(a,T)},v.onError=function(s,p){if(p.type===f.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(F.PlaylistLevelType.AUDIO,p);return}switch(p.details){case f.ErrorDetails.FRAG_LOAD_ERROR:case f.ErrorDetails.FRAG_LOAD_TIMEOUT:case f.ErrorDetails.FRAG_PARSING_ERROR:case f.ErrorDetails.KEY_LOAD_ERROR:case f.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(F.PlaylistLevelType.AUDIO,p);break;case f.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case f.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==_.State.ERROR&&this.state!==_.State.STOPPED&&(this.state=p.fatal?_.State.ERROR:_.State.IDLE,this.warn(p.details+" while loading frag, switching to "+this.state+" state"));break;case f.ErrorDetails.BUFFER_FULL_ERROR:if(p.parent==="audio"&&(this.state===_.State.PARSING||this.state===_.State.PARSED)){var a=!0,T=this.getFwdBufferInfo(this.mediaBuffer,F.PlaylistLevelType.AUDIO);T&&T.len>.5&&(a=!this.reduceMaxBufferLength(T.len)),a&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,E.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},v.onBufferFlushed=function(s,p){var a=p.type;a===B.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===_.State.ENDED&&(this.state=_.State.IDLE))},v._handleTransmuxComplete=function(s){var p,a="audio",T=this.hls,L=s.remuxResult,I=s.chunkMeta,H=this.getCurrentContext(I);if(!H){this.warn("The loading context changed while buffering fragment "+I.sn+" of level "+I.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(I.level);return}var W=H.frag,w=H.part,G=H.level.details,Y=L.audio,j=L.text,X=L.id3,q=L.initSegment;if(!(this.fragContextChanged(W)||!G)){if(this.state=_.State.PARSING,this.audioSwitch&&Y&&this.completeAudioSwitch(),q!=null&&q.tracks&&(this._bufferInitSegment(q.tracks,W,I),T.trigger(U.Events.FRAG_PARSING_INIT_SEGMENT,{frag:W,id:a,tracks:q.tracks})),Y){var J=Y.startPTS,V=Y.endPTS,Q=Y.startDTS,ee=Y.endDTS;w&&(w.elementaryStreams[B.ElementaryStreamTypes.AUDIO]={startPTS:J,endPTS:V,startDTS:Q,endDTS:ee}),W.setElementaryStreamInfo(B.ElementaryStreamTypes.AUDIO,J,V,Q,ee),this.bufferFragmentData(Y,W,w,I)}if(X!=null&&(p=X.samples)!==null&&p!==void 0&&p.length){var Z=m({id:a,frag:W,details:G},X);T.trigger(U.Events.FRAG_PARSING_METADATA,Z)}if(j){var re=m({id:a,frag:W,details:G},j);T.trigger(U.Events.FRAG_PARSING_USERDATA,re)}}},v._bufferInitSegment=function(s,p,a){if(this.state===_.State.PARSING){s.video&&delete s.video;var T=s.audio;if(T){T.levelCodec=T.codec,T.id="audio",this.log("Init audio buffer, container:"+T.container+", codecs[parsed]=["+T.codec+"]"),this.hls.trigger(U.Events.BUFFER_CODECS,s);var L=T.initSegment;if(L!=null&&L.byteLength){var I={type:"audio",frag:p,part:null,chunkMeta:a,parent:p.type,data:L};this.hls.trigger(U.Events.BUFFER_APPENDING,I)}this.tick()}}},v.loadFragment=function(s,p,a){var T=this.fragmentTracker.getState(s);this.fragCurrent=s,(this.audioSwitch||T===K.FragmentState.NOT_LOADED||T===K.FragmentState.PARTIAL)&&(s.sn==="initSegment"?this._loadInitSegment(s,p):p.live&&!(0,R.isFiniteNumber)(this.initPTS[s.cc])?(this.log("Waiting for video PTS in continuity counter "+s.cc+" of live stream before loading audio fragment "+s.sn+" of level "+this.trackId),this.state=_.State.WAITING_INIT_PTS):(this.startFragRequested=!0,E.prototype.loadFragment.call(this,s,p,a)))},v.completeAudioSwitch=function(){var s=this.hls,p=this.media,a=this.trackId;p&&(this.log("Switching audio track : flushing all audio"),E.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,s.trigger(U.Events.AUDIO_TRACK_SWITCHED,{id:a})},A}(_.default);const o=h},"./src/controller/audio-track-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>N});var R=u("./src/events.ts"),_=u("./src/errors.ts"),U=u("./src/controller/base-playlist-controller.ts"),D=u("./src/types/loader.ts");function K(S,f){for(var m=0;m<f.length;m++){var d=f[m];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(S,F(d.key),d)}}function k(S,f,m){return f&&K(S.prototype,f),m&&K(S,m),Object.defineProperty(S,"prototype",{writable:!1}),S}function F(S){var f=B(S,"string");return typeof f=="symbol"?f:String(f)}function B(S,f){if(typeof S!="object"||S===null)return S;var m=S[Symbol.toPrimitive];if(m!==void 0){var d=m.call(S,f||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(S)}function O(S,f){S.prototype=Object.create(f.prototype),S.prototype.constructor=S,P(S,f)}function P(S,f){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,l){return d.__proto__=l,d},P(S,f)}var g=function(S){O(f,S);function f(d){var l;return l=S.call(this,d,"[audio-track-controller]")||this,l.tracks=[],l.groupId=null,l.tracksInGroup=[],l.trackId=-1,l.trackName="",l.selectDefaultTrack=!0,l.registerListeners(),l}var m=f.prototype;return m.registerListeners=function(){var l=this.hls;l.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.on(R.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),l.on(R.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){var l=this.hls;l.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),l.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.off(R.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),l.off(R.Events.ERROR,this.onError,this)},m.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,S.prototype.destroy.call(this)},m.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},m.onManifestParsed=function(l,b){this.tracks=b.audioTracks||[]},m.onAudioTrackLoaded=function(l,b){var h=b.id,o=b.details,E=this.tracksInGroup[h];if(!E){this.warn("Invalid audio track id "+h);return}var A=E.details;E.details=b.details,this.log("audioTrack "+h+" loaded ["+o.startSN+"-"+o.endSN+"]"),h===this.trackId&&(this.retryCount=0,this.playlistLoaded(h,b,A))},m.onLevelLoading=function(l,b){this.switchLevel(b.level)},m.onLevelSwitching=function(l,b){this.switchLevel(b.level)},m.switchLevel=function(l){var b=this.hls.levels[l];if(b!=null&&b.audioGroupIds){var h=b.audioGroupIds[b.urlId];if(this.groupId!==h){this.groupId=h;var o=this.tracks.filter(function(A){return!h||A.groupId===h});this.selectDefaultTrack&&!o.some(function(A){return A.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=o;var E={audioTracks:o};this.log("Updating audio tracks, "+o.length+' track(s) found in "'+h+'" group-id'),this.hls.trigger(R.Events.AUDIO_TRACKS_UPDATED,E),this.selectInitialTrack()}}},m.onError=function(l,b){S.prototype.onError.call(this,l,b),!(b.fatal||!b.context)&&b.context.type===D.PlaylistContextType.AUDIO_TRACK&&b.context.id===this.trackId&&b.context.groupId===this.groupId&&this.retryLoadingOrFail(b)},m.setAudioTrack=function(l){var b=this.tracksInGroup;if(l<0||l>=b.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var h=b[this.trackId];this.log("Now switching to audio-track index "+l);var o=b[l],E=o.id,A=o.groupId,v=A===void 0?"":A,c=o.name,s=o.type,p=o.url;if(this.trackId=l,this.trackName=c,this.selectDefaultTrack=!1,this.hls.trigger(R.Events.AUDIO_TRACK_SWITCHING,{id:E,groupId:v,name:c,type:s,url:p}),!(o.details&&!o.details.live)){var a=this.switchParams(o.url,h==null?void 0:h.details);this.loadPlaylist(a)}},m.selectInitialTrack=function(){var l=this.tracksInGroup;console.assert(l.length,"Initial audio track should be selected when tracks are known");var b=this.trackName,h=this.findTrackId(b)||this.findTrackId();h!==-1?this.setAudioTrack(h):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},m.findTrackId=function(l){for(var b=this.tracksInGroup,h=0;h<b.length;h++){var o=b[h];if((!this.selectDefaultTrack||o.default)&&(!l||l===o.name))return o.id}return-1},m.loadPlaylist=function(l){S.prototype.loadPlaylist.call(this);var b=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(b)){var h=b.id,o=b.groupId,E=b.url;if(l)try{E=l.addDirectives(E)}catch(A){this.warn("Could not construct new URL with HLS Delivery Directives: "+A)}this.log("loading audio-track playlist for id: "+h),this.clearTimer(),this.hls.trigger(R.Events.AUDIO_TRACK_LOADING,{url:E,id:h,groupId:o,deliveryDirectives:l||null})}},k(f,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(l){this.selectDefaultTrack=!1,this.setAudioTrack(l)}}]),f}(U.default);const N=g},"./src/controller/base-playlist-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>K});var R=u("./src/types/level.ts"),_=u("./src/controller/level-helper.ts"),U=u("./src/utils/logger.ts"),D=u("./src/errors.ts"),K=function(){function k(B,O){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=U.logger.log.bind(U.logger,O+":"),this.warn=U.logger.warn.bind(U.logger,O+":"),this.hls=B}var F=k.prototype;return F.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},F.onError=function(O,P){P.fatal&&(P.type===D.ErrorTypes.NETWORK_ERROR||P.type===D.ErrorTypes.KEY_SYSTEM_ERROR)&&this.stopLoad()},F.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},F.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},F.stopLoad=function(){this.canLoad=!1,this.clearTimer()},F.switchParams=function(O,P){var g=P==null?void 0:P.renditionReports;if(g)for(var N=0;N<g.length;N++){var S=g[N],f=void 0;try{f=new self.URL(S.URI,P.url).href}catch(b){U.logger.warn("Could not construct new URL for Rendition Report: "+b),f=S.URI||""}if(f===O.slice(-f.length)){var m=parseInt(S["LAST-MSN"])||(P==null?void 0:P.lastPartSn),d=parseInt(S["LAST-PART"])||(P==null?void 0:P.lastPartIndex);if(this.hls.config.lowLatencyMode){var l=Math.min(P.age-P.partTarget,P.targetduration);d>=0&&l>P.partTarget&&(d+=1)}return new R.HlsUrlParameters(m,d>=0?d:void 0,R.HlsSkip.No)}}},F.loadPlaylist=function(O){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},F.shouldLoadTrack=function(O){return this.canLoad&&O&&!!O.url&&(!O.details||O.details.live)},F.playlistLoaded=function(O,P,g){var N=this,S=P.details,f=P.stats,m=self.performance.now(),d=f.loading.first?Math.max(0,m-f.loading.first):0;if(S.advancedDateTime=Date.now()-d,S.live||g!=null&&g.live){if(S.reloaded(g),g&&this.log("live playlist "+O+" "+(S.advanced?"REFRESHED "+S.lastPartSn+"-"+S.lastPartIndex:"MISSED")),g&&S.fragments.length>0&&(0,_.mergeDetails)(g,S),!this.canLoad||!S.live)return;var l,b=void 0,h=void 0;if(S.canBlockReload&&S.endSN&&S.advanced){var o=this.hls.config.lowLatencyMode,E=S.lastPartSn,A=S.endSN,v=S.lastPartIndex,c=v!==-1,s=E===A,p=o?0:v;c?(b=s?A+1:E,h=s?p:v+1):b=A+1;var a=S.age,T=a+S.ageHeader,L=Math.min(T-S.partTarget,S.targetduration*1.5);if(L>0){if(g&&L>g.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+g.tuneInGoal+" to: "+L+" with playlist age: "+S.age),L=0;else{var I=Math.floor(L/S.targetduration);if(b+=I,h!==void 0){var H=Math.round(L%S.targetduration/S.partTarget);h+=H}this.log("CDN Tune-in age: "+S.ageHeader+"s last advanced "+a.toFixed(2)+"s goal: "+L+" skip sn "+I+" to part "+h)}S.tuneInGoal=L}if(l=this.getDeliveryDirectives(S,P.deliveryDirectives,b,h),o||!s){this.loadPlaylist(l);return}}else l=this.getDeliveryDirectives(S,P.deliveryDirectives,b,h);var W=this.hls.mainForwardBufferInfo,w=W?W.end-W.len:0,G=(S.edge-w)*1e3,Y=(0,_.computeReloadInterval)(S,G);S.updated?m>this.requestScheduled+Y&&(this.requestScheduled=f.loading.start):this.requestScheduled=-1,b!==void 0&&S.canBlockReload?this.requestScheduled=f.loading.first+Y-(S.partTarget*1e3||1e3):this.requestScheduled=(this.requestScheduled===-1?m:this.requestScheduled)+Y;var j=this.requestScheduled-m;j=Math.max(0,j),this.log("reload live playlist "+O+" in "+Math.round(j)+" ms"),this.timer=self.setTimeout(function(){return N.loadPlaylist(l)},j)}else this.clearTimer()},F.getDeliveryDirectives=function(O,P,g,N){var S=(0,R.getSkipValue)(O,g);return P!=null&&P.skip&&O.deltaUpdateFailed&&(g=P.msn,N=P.part,S=R.HlsSkip.No),new R.HlsUrlParameters(g,N,S)},F.retryLoadingOrFail=function(O){var P=this,g=this.hls.config,N=this.retryCount<g.levelLoadingMaxRetry;if(N){var S;if(this.requestScheduled=-1,this.retryCount++,O.details.indexOf("LoadTimeOut")>-1&&(S=O.context)!==null&&S!==void 0&&S.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+O.details+'"'),this.loadPlaylist();else{var f=Math.min(Math.pow(2,this.retryCount)*g.levelLoadingRetryDelay,g.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return P.loadPlaylist()},f),this.warn("retry playlist loading #"+this.retryCount+" in "+f+' ms after "'+O.details+'"')}}else this.warn('cannot recover from error "'+O.details+'"'),this.clearTimer(),O.fatal=!0;return N},k}()},"./src/controller/base-stream-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{State:()=>c,default:()=>s});var R=u("./src/polyfills/number.ts"),_=u("./src/task-loop.ts"),U=u("./src/controller/fragment-tracker.ts"),D=u("./src/utils/buffer-helper.ts"),K=u("./src/utils/logger.ts"),k=u("./src/events.ts"),F=u("./src/errors.ts"),B=u("./src/types/transmuxer.ts"),O=u("./src/utils/mp4-tools.ts"),P=u("./src/utils/discontinuities.ts"),g=u("./src/controller/fragment-finders.ts"),N=u("./src/controller/level-helper.ts"),S=u("./src/loader/fragment-loader.ts"),f=u("./src/crypt/decrypter.ts"),m=u("./src/utils/time-ranges.ts"),d=u("./src/types/loader.ts");function l(p,a){for(var T=0;T<a.length;T++){var L=a[T];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(p,h(L.key),L)}}function b(p,a,T){return a&&l(p.prototype,a),T&&l(p,T),Object.defineProperty(p,"prototype",{writable:!1}),p}function h(p){var a=o(p,"string");return typeof a=="symbol"?a:String(a)}function o(p,a){if(typeof p!="object"||p===null)return p;var T=p[Symbol.toPrimitive];if(T!==void 0){var L=T.call(p,a||"default");if(typeof L!="object")return L;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(p)}function E(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function A(p,a){p.prototype=Object.create(a.prototype),p.prototype.constructor=p,v(p,a)}function v(p,a){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(L,I){return L.__proto__=I,L},v(p,a)}var c={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},s=function(p){A(a,p);function a(L,I,H,W){var w;return w=p.call(this)||this,w.hls=void 0,w.fragPrevious=null,w.fragCurrent=null,w.fragmentTracker=void 0,w.transmuxer=null,w._state=c.STOPPED,w.media=null,w.mediaBuffer=null,w.config=void 0,w.bitrateTest=!1,w.lastCurrentTime=0,w.nextLoadPosition=0,w.startPosition=0,w.loadedmetadata=!1,w.fragLoadError=0,w.retryDate=0,w.levels=null,w.fragmentLoader=void 0,w.keyLoader=void 0,w.levelLastLoaded=null,w.startFragRequested=!1,w.decrypter=void 0,w.initPTS=[],w.onvseeking=null,w.onvended=null,w.logPrefix="",w.log=void 0,w.warn=void 0,w.logPrefix=W,w.log=K.logger.log.bind(K.logger,W+":"),w.warn=K.logger.warn.bind(K.logger,W+":"),w.hls=L,w.fragmentLoader=new S.default(L.config),w.keyLoader=H,w.fragmentTracker=I,w.config=L.config,w.decrypter=new f.default(L.config),L.on(k.Events.LEVEL_SWITCHING,w.onLevelSwitching,E(w)),w}var T=a.prototype;return T.doTick=function(){this.onTickEnd()},T.onTickEnd=function(){},T.startLoad=function(I){},T.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var I=this.fragCurrent;I&&(I.abortRequests(),this.fragmentTracker.removeFragment(I)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=c.STOPPED},T._streamEnded=function(I,H){if(H.live||I.nextStart||!I.end||!this.media)return!1;var W=H.partList;if(W!=null&&W.length){var w=W[W.length-1],G=D.BufferHelper.isBuffered(this.media,w.start+w.duration/2);return G}var Y=H.fragments[H.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(Y)},T.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var I;return(I=this.levels[this.levelLastLoaded])===null||I===void 0?void 0:I.details}},T.onMediaAttached=function(I,H){var W=this.media=this.mediaBuffer=H.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),W.addEventListener("seeking",this.onvseeking),W.addEventListener("ended",this.onvended);var w=this.config;this.levels&&w.autoStartLoad&&this.state===c.STOPPED&&this.startLoad(w.startPosition)},T.onMediaDetaching=function(){var I=this.media;I!=null&&I.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),I&&this.onvseeking&&this.onvended&&(I.removeEventListener("seeking",this.onvseeking),I.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},T.onMediaSeeking=function(){var I=this.config,H=this.fragCurrent,W=this.media,w=this.mediaBuffer,G=this.state,Y=W?W.currentTime:0,j=D.BufferHelper.bufferInfo(w||W,Y,I.maxBufferHole);if(this.log("media seeking to "+((0,R.isFiniteNumber)(Y)?Y.toFixed(3):Y)+", state: "+G),this.state===c.ENDED)this.resetLoadingState();else if(H){var X=I.maxFragLookUpTolerance,q=H.start-X,J=H.start+H.duration+X;if(!j.len||J<j.start||q>j.end){var V=Y>J;(Y<q||V)&&(V&&H.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),H.abortRequests()),this.resetLoadingState())}}W&&(this.lastCurrentTime=Y),!this.loadedmetadata&&!j.len&&(this.nextLoadPosition=this.startPosition=Y),this.tickImmediate()},T.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},T.onLevelSwitching=function(I,H){this.fragLoadError=0},T.onHandlerDestroying=function(){this.stopLoad(),p.prototype.onHandlerDestroying.call(this)},T.onHandlerDestroyed=function(){this.state=c.STOPPED,this.hls.off(k.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,p.prototype.onHandlerDestroyed.call(this)},T.loadFragment=function(I,H,W){this._loadFragForPlayback(I,H,W)},T._loadFragForPlayback=function(I,H,W){var w=this,G=function(j){if(w.fragContextChanged(I)){w.warn("Fragment "+I.sn+(j.part?" p: "+j.part.index:"")+" of level "+I.level+" was dropped during download."),w.fragmentTracker.removeFragment(I);return}I.stats.chunkCount++,w._handleFragmentLoadProgress(j)};this._doFragLoad(I,H,W,G).then(function(Y){if(Y){w.fragLoadError=0;var j=w.state;if(w.fragContextChanged(I)){(j===c.FRAG_LOADING||!w.fragCurrent&&j===c.PARSING)&&(w.fragmentTracker.removeFragment(I),w.state=c.IDLE);return}"payload"in Y&&(w.log("Loaded fragment "+I.sn+" of level "+I.level),w.hls.trigger(k.Events.FRAG_LOADED,Y)),w._handleFragmentLoadComplete(Y)}}).catch(function(Y){w.state===c.STOPPED||w.state===c.ERROR||(w.warn(Y),w.resetFragmentLoading(I))})},T.flushMainBuffer=function(I,H,W){if(W===void 0&&(W=null),!!(I-H)){var w={startOffset:I,endOffset:H,type:W};this.fragLoadError=0,this.hls.trigger(k.Events.BUFFER_FLUSHING,w)}},T._loadInitSegment=function(I,H){var W=this;this._doFragLoad(I,H).then(function(w){if(!w||W.fragContextChanged(I)||!W.levels)throw new Error("init load aborted");return w}).then(function(w){var G=W.hls,Y=w.payload,j=I.decryptdata;if(Y&&Y.byteLength>0&&j&&j.key&&j.iv&&j.method==="AES-128"){var X=self.performance.now();return W.decrypter.decrypt(new Uint8Array(Y),j.key.buffer,j.iv.buffer).then(function(q){var J=self.performance.now();return G.trigger(k.Events.FRAG_DECRYPTED,{frag:I,payload:q,stats:{tstart:X,tdecrypt:J}}),w.payload=q,w})}return w}).then(function(w){var G=W.fragCurrent,Y=W.hls,j=W.levels;if(!j)throw new Error("init load aborted, missing levels");var X=j[I.level].details;console.assert(X,"Level details are defined when init segment is loaded");var q=I.stats;W.state=c.IDLE,W.fragLoadError=0,I.data=new Uint8Array(w.payload),q.parsing.start=q.buffering.start=self.performance.now(),q.parsing.end=q.buffering.end=self.performance.now(),w.frag===G&&Y.trigger(k.Events.FRAG_BUFFERED,{stats:q,frag:G,part:null,id:I.type}),W.tick()}).catch(function(w){W.state===c.STOPPED||W.state===c.ERROR||(W.warn(w),W.resetFragmentLoading(I))})},T.fragContextChanged=function(I){var H=this.fragCurrent;return!I||!H||I.level!==H.level||I.sn!==H.sn||I.urlId!==H.urlId},T.fragBufferedComplete=function(I,H){var W,w,G=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+I.type+" sn: "+I.sn+(H?" part: "+H.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+I.level+" "+(G?m.default.toString(D.BufferHelper.getBuffered(G)):"(detached)")),this.state=c.IDLE,G&&(!this.loadedmetadata&&I.type==d.PlaylistLevelType.MAIN&&G.buffered.length&&((W=this.fragCurrent)===null||W===void 0?void 0:W.sn)===((w=this.fragPrevious)===null||w===void 0?void 0:w.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},T.seekToStartPos=function(){},T._handleFragmentLoadComplete=function(I){var H=this.transmuxer;if(H){var W=I.frag,w=I.part,G=I.partsLoaded,Y=!G||G.length===0||G.some(function(X){return!X}),j=new B.ChunkMetadata(W.level,W.sn,W.stats.chunkCount+1,0,w?w.index:-1,!Y);H.flush(j)}},T._handleFragmentLoadProgress=function(I){},T._doFragLoad=function(I,H,W,w){var G,Y=this;if(W===void 0&&(W=null),!this.levels)throw new Error("frag load aborted, missing levels");var j=null;if(I.encrypted&&!((G=I.decryptdata)!==null&&G!==void 0&&G.key)?(this.log("Loading key for "+I.sn+" of ["+H.startSN+"-"+H.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+I.level),this.state=c.KEY_LOADING,this.fragCurrent=I,j=this.keyLoader.load(I).then(function(Q){if(!Y.fragContextChanged(Q.frag))return Y.hls.trigger(k.Events.KEY_LOADED,Q),Q}),this.hls.trigger(k.Events.KEY_LOADING,{frag:I}),this.throwIfFragContextChanged("KEY_LOADING")):!I.encrypted&&H.encryptedFragments.length&&this.keyLoader.loadClear(I,H.encryptedFragments),W=Math.max(I.start,W||0),this.config.lowLatencyMode&&H){var X=H.partList;if(X&&w){W>I.end&&H.fragmentHint&&(I=H.fragmentHint);var q=this.getNextPart(X,I,W);if(q>-1){var J=X[q];return this.log("Loading part sn: "+I.sn+" p: "+J.index+" cc: "+I.cc+" of playlist ["+H.startSN+"-"+H.endSN+"] parts [0-"+q+"-"+(X.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+I.level+", target: "+parseFloat(W.toFixed(3))),this.nextLoadPosition=J.start+J.duration,this.state=c.FRAG_LOADING,this.hls.trigger(k.Events.FRAG_LOADING,{frag:I,part:X[q],targetBufferTime:W}),this.throwIfFragContextChanged("FRAG_LOADING parts"),j?j.then(function(Q){return!Q||Y.fragContextChanged(Q.frag)?null:Y.doFragPartsLoad(I,X,q,w)}).catch(function(Q){return Y.handleFragLoadError(Q)}):this.doFragPartsLoad(I,X,q,w).catch(function(Q){return Y.handleFragLoadError(Q)})}else if(!I.url||this.loadedEndOfParts(X,W))return Promise.resolve(null)}}this.log("Loading fragment "+I.sn+" cc: "+I.cc+" "+(H?"of ["+H.startSN+"-"+H.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+I.level+", target: "+parseFloat(W.toFixed(3))),(0,R.isFiniteNumber)(I.sn)&&!this.bitrateTest&&(this.nextLoadPosition=I.start+I.duration),this.state=c.FRAG_LOADING,this.hls.trigger(k.Events.FRAG_LOADING,{frag:I,targetBufferTime:W}),this.throwIfFragContextChanged("FRAG_LOADING");var V=this.config.progressive;return V&&j?j.then(function(Q){return!Q||Y.fragContextChanged(Q==null?void 0:Q.frag)?null:Y.fragmentLoader.load(I,w)}).catch(function(Q){return Y.handleFragLoadError(Q)}):Promise.all([this.fragmentLoader.load(I,V?w:void 0),j]).then(function(Q){var ee=Q[0];return!V&&ee&&w&&w(ee),ee}).catch(function(Q){return Y.handleFragLoadError(Q)})},T.throwIfFragContextChanged=function(I){if(this.fragCurrent===null)throw new Error("frag load aborted, context changed in "+I)},T.doFragPartsLoad=function(I,H,W,w){var G=this;return new Promise(function(Y,j){var X=[],q=function J(V){var Q=H[V];G.fragmentLoader.loadPart(I,Q,w).then(function(ee){X[Q.index]=ee;var Z=ee.part;G.hls.trigger(k.Events.FRAG_LOADED,ee);var re=H[V+1];if(re&&re.fragment===I)J(V+1);else return Y({frag:I,part:Z,partsLoaded:X})}).catch(j)};q(W)})},T.handleFragLoadError=function(I){if("data"in I){var H=I.data;I.data&&H.details===F.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(H.frag,H.part):this.hls.trigger(k.Events.ERROR,H)}else this.hls.trigger(k.Events.ERROR,{type:F.ErrorTypes.OTHER_ERROR,details:F.ErrorDetails.INTERNAL_EXCEPTION,err:I,fatal:!0});return null},T._handleTransmuxerFlush=function(I){var H=this.getCurrentContext(I);if(!H||this.state!==c.PARSING){!this.fragCurrent&&this.state!==c.STOPPED&&this.state!==c.ERROR&&(this.state=c.IDLE);return}var W=H.frag,w=H.part,G=H.level,Y=self.performance.now();W.stats.parsing.end=Y,w&&(w.stats.parsing.end=Y),this.updateLevelTiming(W,w,G,I.partial)},T.getCurrentContext=function(I){var H=this.levels,W=I.level,w=I.sn,G=I.part;if(!H||!H[W])return this.warn("Levels object was unset while buffering fragment "+w+" of level "+W+". The current chunk will not be buffered."),null;var Y=H[W],j=G>-1?(0,N.getPartWith)(Y,w,G):null,X=j?j.fragment:(0,N.getFragmentWithSN)(Y,w,this.fragCurrent);return X?{frag:X,part:j,level:Y}:null},T.bufferFragmentData=function(I,H,W,w){if(!(!I||this.state!==c.PARSING)){var G=I.data1,Y=I.data2,j=G;if(G&&Y&&(j=(0,O.appendUint8Array)(G,Y)),!(!j||!j.length)){var X={type:I.type,frag:H,part:W,chunkMeta:w,parent:H.type,data:j};this.hls.trigger(k.Events.BUFFER_APPENDING,X),I.dropped&&I.independent&&!W&&this.flushBufferGap(H)}}},T.flushBufferGap=function(I){var H=this.media;if(H){if(!D.BufferHelper.isBuffered(H,H.currentTime)){this.flushMainBuffer(0,I.start);return}var W=H.currentTime,w=D.BufferHelper.bufferInfo(H,W,0),G=I.duration,Y=Math.min(this.config.maxFragLookUpTolerance*2,G*.25),j=Math.max(Math.min(I.start-Y,w.end-Y),W+Y);I.start-j>Y&&this.flushMainBuffer(j,I.start)}},T.getFwdBufferInfo=function(I,H){var W=this.config,w=this.getLoadPosition();if(!(0,R.isFiniteNumber)(w))return null;var G=D.BufferHelper.bufferInfo(I,w,W.maxBufferHole);if(G.len===0&&G.nextStart!==void 0){var Y=this.fragmentTracker.getBufferedFrag(w,H);if(Y&&G.nextStart<Y.end)return D.BufferHelper.bufferInfo(I,w,Math.max(G.nextStart,W.maxBufferHole))}return G},T.getMaxBufferLength=function(I){var H=this.config,W;return I?W=Math.max(8*H.maxBufferSize/I,H.maxBufferLength):W=H.maxBufferLength,Math.min(W,H.maxMaxBufferLength)},T.reduceMaxBufferLength=function(I){var H=this.config,W=I||H.maxBufferLength;return H.maxMaxBufferLength>=W?(H.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+H.maxMaxBufferLength+"s"),!0):!1},T.getNextFragment=function(I,H){var W=H.fragments,w=W.length;if(!w)return null;var G=this.config,Y=W[0].start,j;if(H.live){var X=G.initialLiveManifestSize;if(w<X)return this.warn("Not enough fragments to start playback (have: "+w+", need: "+X+")"),null;!H.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(j=this.getInitialLiveFragment(H,W),this.startPosition=j?this.hls.liveSyncPosition||j.start:I)}else I<=Y&&(j=W[0]);if(!j){var q=G.lowLatencyMode?H.partEnd:H.fragmentEnd;j=this.getFragmentAtPosition(I,q,H)}return this.mapToInitFragWhenRequired(j)},T.mapToInitFragWhenRequired=function(I){return I!=null&&I.initSegment&&!(I!=null&&I.initSegment.data)&&!this.bitrateTest?I.initSegment:I},T.getNextPart=function(I,H,W){for(var w=-1,G=!1,Y=!0,j=0,X=I.length;j<X;j++){var q=I[j];if(Y=Y&&!q.independent,w>-1&&W<q.start)break;var J=q.loaded;J?w=-1:(G||q.independent||Y)&&q.fragment===H&&(w=j),G=J}return w},T.loadedEndOfParts=function(I,H){var W=I[I.length-1];return W&&H>W.start&&W.loaded},T.getInitialLiveFragment=function(I,H){var W=this.fragPrevious,w=null;if(W){if(I.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+W.programDateTime),w=(0,g.findFragmentByPDT)(H,W.endProgramDateTime,this.config.maxFragLookUpTolerance)),!w){var G=W.sn+1;if(G>=I.startSN&&G<=I.endSN){var Y=H[G-I.startSN];W.cc===Y.cc&&(w=Y,this.log("Live playlist, switching playlist, load frag with next SN: "+w.sn))}w||(w=(0,g.findFragWithCC)(H,W.cc),w&&this.log("Live playlist, switching playlist, load frag with same CC: "+w.sn))}}else{var j=this.hls.liveSyncPosition;j!==null&&(w=this.getFragmentAtPosition(j,this.bitrateTest?I.fragmentEnd:I.edge,I))}return w},T.getFragmentAtPosition=function(I,H,W){var w=this.config,G=this.fragPrevious,Y=W.fragments,j=W.endSN,X=W.fragmentHint,q=w.maxFragLookUpTolerance,J=!!(w.lowLatencyMode&&W.partList&&X);J&&X&&!this.bitrateTest&&(Y=Y.concat(X),j=X.sn);var V;if(I<H){var Q=I>H-q?0:q;V=(0,g.findFragmentByPTS)(G,Y,I,Q)}else V=Y[Y.length-1];if(V){var ee=V.sn-W.startSN;if(this.fragmentTracker.getState(V)===U.FragmentState.OK&&(G=V),G&&V.sn===G.sn&&!J){var Z=G&&V.level===G.level;if(Z){var re=Y[ee+1];V.sn<j&&this.fragmentTracker.getState(re)!==U.FragmentState.OK?(this.log("SN "+V.sn+" just loaded, load next one: "+re.sn),V=re):V=null}}}return V},T.synchronizeToLiveEdge=function(I){var H=this.config,W=this.media;if(W){var w=this.hls.liveSyncPosition,G=W.currentTime,Y=I.fragments[0].start,j=I.edge,X=G>=Y-H.maxFragLookUpTolerance&&G<=j;if(w!==null&&W.duration>w&&(G<w||!X)){var q=H.liveMaxLatencyDuration!==void 0?H.liveMaxLatencyDuration:H.liveMaxLatencyDurationCount*I.targetduration;(!X&&W.readyState<4||G<j-q)&&(this.loadedmetadata||(this.nextLoadPosition=w),W.readyState&&(this.warn("Playback: "+G.toFixed(3)+" is located too far from the end of live sliding playlist: "+j+", reset currentTime to : "+w.toFixed(3)),W.currentTime=w))}}},T.alignPlaylists=function(I,H){var W=this.levels,w=this.levelLastLoaded,G=this.fragPrevious,Y=w!==null?W[w]:null,j=I.fragments.length;if(!j)return this.warn("No fragments in live playlist"),0;var X=I.fragments[0].start,q=!H,J=I.alignedSliding&&(0,R.isFiniteNumber)(X);if(q||!J&&!X){(0,P.alignStream)(G,Y,I);var V=I.fragments[0].start;return this.log("Live playlist sliding: "+V.toFixed(2)+" start-sn: "+(H?H.startSN:"na")+"->"+I.startSN+" prev-sn: "+(G?G.sn:"na")+" fragments: "+j),V}return X},T.waitForCdnTuneIn=function(I){var H=3;return I.live&&I.canBlockReload&&I.partTarget&&I.tuneInGoal>Math.max(I.partHoldBack,I.partTarget*H)},T.setStartPosition=function(I,H){var W=this.startPosition;if(W<H&&(W=-1),W===-1||this.lastCurrentTime===-1){var w=I.startTimeOffset;(0,R.isFiniteNumber)(w)?(W=H+w,w<0&&(W+=I.totalduration),W=Math.min(Math.max(H,W),H+I.totalduration),this.log("Start time offset "+w+" found in playlist, adjust startPosition to "+W),this.startPosition=W):I.live?W=this.hls.liveSyncPosition||H:this.startPosition=W=0,this.lastCurrentTime=W}this.nextLoadPosition=W},T.getLoadPosition=function(){var I=this.media,H=0;return this.loadedmetadata&&I?H=I.currentTime:this.nextLoadPosition&&(H=this.nextLoadPosition),H},T.handleFragLoadAborted=function(I,H){this.transmuxer&&I.sn!=="initSegment"&&I.stats.aborted&&(this.warn("Fragment "+I.sn+(H?" part"+H.index:"")+" of level "+I.level+" was aborted"),this.resetFragmentLoading(I))},T.resetFragmentLoading=function(I){(!this.fragCurrent||!this.fragContextChanged(I)&&this.state!==c.FRAG_LOADING_WAITING_RETRY)&&(this.state=c.IDLE)},T.onFragmentOrKeyLoadError=function(I,H){if(H.fatal){this.stopLoad(),this.state=c.ERROR;return}var W=this.config;if(H.chunkMeta){var w=this.getCurrentContext(H.chunkMeta);w&&(H.frag=w.frag,H.levelRetry=!0,this.fragLoadError=W.fragLoadingMaxRetry)}var G=H.frag;if(!(!G||G.type!==I)){var Y=this.fragCurrent;if(console.assert(Y&&G.sn===Y.sn&&G.level===Y.level&&G.urlId===Y.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=W.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var j=Math.min(Math.pow(2,this.fragLoadError)*W.fragLoadingRetryDelay,W.fragLoadingMaxRetryTimeout);this.warn("Fragment "+G.sn+" of "+I+" "+G.level+" failed to load, retrying in "+j+"ms"),this.retryDate=self.performance.now()+j,this.fragLoadError++,this.state=c.FRAG_LOADING_WAITING_RETRY}else H.levelRetry?(I===d.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=c.IDLE):(K.logger.error(H.details+" reaches max retry, redispatch as fatal ..."),H.fatal=!0,this.hls.stopLoad(),this.state=c.ERROR)}},T.afterBufferFlushed=function(I,H,W){if(I){var w=D.BufferHelper.getBuffered(I);this.fragmentTracker.detectEvictedFragments(H,w,W),this.state===c.ENDED&&this.resetLoadingState()}},T.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=c.IDLE},T.resetStartWhenNotLoaded=function(I){if(!this.loadedmetadata){this.startFragRequested=!1;var H=this.levels?this.levels[I].details:null;H!=null&&H.live?(this.startPosition=-1,this.setStartPosition(H,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},T.updateLevelTiming=function(I,H,W,w){var G=this,Y=W.details;console.assert(!!Y,"level.details must be defined");var j=Object.keys(I.elementaryStreams).reduce(function(X,q){var J=I.elementaryStreams[q];if(J){var V=J.endPTS-J.startPTS;if(V<=0)return G.warn("Could not parse fragment "+I.sn+" "+q+" duration reliably ("+V+")"),X||!1;var Q=w?0:(0,N.updateFragPTSDTS)(Y,I,J.startPTS,J.endPTS,J.startDTS,J.endDTS);return G.hls.trigger(k.Events.LEVEL_PTS_UPDATED,{details:Y,level:W,drift:Q,type:q,frag:I,start:J.startPTS,end:J.endPTS}),!0}return X},!1);j||(this.warn("Found no media in fragment "+I.sn+" of level "+W.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=c.PARSED,this.hls.trigger(k.Events.FRAG_PARSED,{frag:I,part:H})},T.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},b(a,[{key:"state",get:function(){return this._state},set:function(I){var H=this._state;H!==I&&(this._state=I,this.log(H+"->"+I))}}]),a}(_.default)},"./src/controller/buffer-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>g});var R=u("./src/polyfills/number.ts"),_=u("./src/events.ts"),U=u("./src/utils/logger.ts"),D=u("./src/errors.ts"),K=u("./src/utils/buffer-helper.ts"),k=u("./src/utils/mediasource-helper.ts"),F=u("./src/loader/fragment.ts"),B=u("./src/controller/buffer-operation-queue.ts"),O=(0,k.getMediaSource)(),P=/([ha]vc.)(?:\.[^.,]+)+/,g=function(){function N(f){var m=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var d=m.hls,l=m.media,b=m.mediaSource;U.logger.log("[buffer-controller]: Media source opened"),l&&(m.updateMediaElementDuration(),d.trigger(_.Events.MEDIA_ATTACHED,{media:l})),b&&b.removeEventListener("sourceopen",m._onMediaSourceOpen),m.checkPendingTracks()},this._onMediaSourceClose=function(){U.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){U.logger.log("[buffer-controller]: Media source ended")},this.hls=f,this._initSourceBuffer(),this.registerListeners()}var S=N.prototype;return S.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},S.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},S.registerListeners=function(){var m=this.hls;m.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(_.Events.BUFFER_RESET,this.onBufferReset,this),m.on(_.Events.BUFFER_APPENDING,this.onBufferAppending,this),m.on(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.on(_.Events.BUFFER_EOS,this.onBufferEos,this),m.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),m.on(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this),m.on(_.Events.FRAG_PARSED,this.onFragParsed,this),m.on(_.Events.FRAG_CHANGED,this.onFragChanged,this)},S.unregisterListeners=function(){var m=this.hls;m.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(_.Events.BUFFER_RESET,this.onBufferReset,this),m.off(_.Events.BUFFER_APPENDING,this.onBufferAppending,this),m.off(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.off(_.Events.BUFFER_EOS,this.onBufferEos,this),m.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),m.off(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this),m.off(_.Events.FRAG_PARSED,this.onFragParsed,this),m.off(_.Events.FRAG_CHANGED,this.onFragChanged,this)},S._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new B.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},S.onManifestParsed=function(m,d){var l=2;(d.audio&&!d.video||!d.altAudio)&&(l=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=l,this.details=null,U.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},S.onMediaAttaching=function(m,d){var l=this.media=d.media;if(l&&O){var b=this.mediaSource=new O;b.addEventListener("sourceopen",this._onMediaSourceOpen),b.addEventListener("sourceended",this._onMediaSourceEnded),b.addEventListener("sourceclose",this._onMediaSourceClose),l.src=self.URL.createObjectURL(b),this._objectUrl=l.src}},S.onMediaDetaching=function(){var m=this.media,d=this.mediaSource,l=this._objectUrl;if(d){if(U.logger.log("[buffer-controller]: media source detaching"),d.readyState==="open")try{d.endOfStream()}catch(b){U.logger.warn("[buffer-controller]: onMediaDetaching: "+b.message+" while calling endOfStream")}this.onBufferReset(),d.removeEventListener("sourceopen",this._onMediaSourceOpen),d.removeEventListener("sourceended",this._onMediaSourceEnded),d.removeEventListener("sourceclose",this._onMediaSourceClose),m&&(l&&self.URL.revokeObjectURL(l),m.src===l?(m.removeAttribute("src"),m.load()):U.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(_.Events.MEDIA_DETACHED,void 0)},S.onBufferReset=function(){var m=this;this.getSourceBufferTypes().forEach(function(d){var l=m.sourceBuffer[d];try{l&&(m.removeBufferListeners(d),m.mediaSource&&m.mediaSource.removeSourceBuffer(l),m.sourceBuffer[d]=void 0)}catch(b){U.logger.warn("[buffer-controller]: Failed to reset the "+d+" buffer",b)}}),this._initSourceBuffer()},S.onBufferCodecs=function(m,d){var l=this,b=this.getSourceBufferTypes().length;Object.keys(d).forEach(function(h){if(b){var o=l.tracks[h];if(o&&typeof o.buffer.changeType=="function"){var E=d[h],A=E.id,v=E.codec,c=E.levelCodec,s=E.container,p=E.metadata,a=(o.levelCodec||o.codec).replace(P,"$1"),T=(c||v).replace(P,"$1");if(a!==T){var L=s+";codecs="+(c||v);l.appendChangeType(h,L),U.logger.log("[buffer-controller]: switching codec "+a+" to "+T),l.tracks[h]={buffer:o.buffer,codec:v,container:s,levelCodec:c,metadata:p,id:A}}}}else l.pendingTracks[h]=d[h]}),!b&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},S.appendChangeType=function(m,d){var l=this,b=this.operationQueue,h={execute:function(){var E=l.sourceBuffer[m];E&&(U.logger.log("[buffer-controller]: changing "+m+" sourceBuffer type to "+d),E.changeType(d)),b.shiftAndExecuteNext(m)},onStart:function(){},onComplete:function(){},onError:function(E){U.logger.warn("[buffer-controller]: Failed to change "+m+" SourceBuffer type",E)}};b.append(h,m)},S.onBufferAppending=function(m,d){var l=this,b=this.hls,h=this.operationQueue,o=this.tracks,E=d.data,A=d.type,v=d.frag,c=d.part,s=d.chunkMeta,p=s.buffering[A],a=self.performance.now();p.start=a;var T=v.stats.buffering,L=c?c.stats.buffering:null;T.start===0&&(T.start=a),L&&L.start===0&&(L.start=a);var I=o.audio,H=!1;A==="audio"&&(I==null?void 0:I.container)==="audio/mpeg"&&(H=!this.lastMpegAudioChunk||s.id===1||this.lastMpegAudioChunk.sn!==s.sn,this.lastMpegAudioChunk=s);var W=v.start,w={execute:function(){if(p.executeStart=self.performance.now(),H){var Y=l.sourceBuffer[A];if(Y){var j=W-Y.timestampOffset;Math.abs(j)>=.1&&(U.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+W+" (delta: "+j+") sn: "+v.sn+")"),Y.timestampOffset=W)}}l.appendExecutor(E,A)},onStart:function(){},onComplete:function(){var Y=self.performance.now();p.executeEnd=p.end=Y,T.first===0&&(T.first=Y),L&&L.first===0&&(L.first=Y);var j=l.sourceBuffer,X={};for(var q in j)X[q]=K.BufferHelper.getBuffered(j[q]);l.appendError=0,l.hls.trigger(_.Events.BUFFER_APPENDED,{type:A,frag:v,part:c,chunkMeta:s,parent:v.type,timeRanges:X})},onError:function(Y){U.logger.error("[buffer-controller]: Error encountered while trying to append to the "+A+" SourceBuffer",Y);var j={type:D.ErrorTypes.MEDIA_ERROR,parent:v.type,details:D.ErrorDetails.BUFFER_APPEND_ERROR,err:Y,fatal:!1};Y.code===DOMException.QUOTA_EXCEEDED_ERR?j.details=D.ErrorDetails.BUFFER_FULL_ERROR:(l.appendError++,j.details=D.ErrorDetails.BUFFER_APPEND_ERROR,l.appendError>b.config.appendErrorMaxRetry&&(U.logger.error("[buffer-controller]: Failed "+b.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),j.fatal=!0,b.stopLoad())),b.trigger(_.Events.ERROR,j)}};h.append(w,A)},S.onBufferFlushing=function(m,d){var l=this,b=this.operationQueue,h=function(E){return{execute:l.removeExecutor.bind(l,E,d.startOffset,d.endOffset),onStart:function(){},onComplete:function(){l.hls.trigger(_.Events.BUFFER_FLUSHED,{type:E})},onError:function(v){U.logger.warn("[buffer-controller]: Failed to remove from "+E+" SourceBuffer",v)}}};d.type?b.append(h(d.type),d.type):this.getSourceBufferTypes().forEach(function(o){b.append(h(o),o)})},S.onFragParsed=function(m,d){var l=this,b=d.frag,h=d.part,o=[],E=h?h.elementaryStreams:b.elementaryStreams;E[F.ElementaryStreamTypes.AUDIOVIDEO]?o.push("audiovideo"):(E[F.ElementaryStreamTypes.AUDIO]&&o.push("audio"),E[F.ElementaryStreamTypes.VIDEO]&&o.push("video"));var A=function(){var c=self.performance.now();b.stats.buffering.end=c,h&&(h.stats.buffering.end=c);var s=h?h.stats:b.stats;l.hls.trigger(_.Events.FRAG_BUFFERED,{frag:b,part:h,stats:s,id:b.type})};o.length===0&&U.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+b.type+" level: "+b.level+" sn: "+b.sn),this.blockBuffers(A,o)},S.onFragChanged=function(m,d){this.flushBackBuffer()},S.onBufferEos=function(m,d){var l=this,b=this.getSourceBufferTypes().reduce(function(h,o){var E=l.sourceBuffer[o];return E&&(!d.type||d.type===o)&&(E.ending=!0,E.ended||(E.ended=!0,U.logger.log("[buffer-controller]: "+o+" sourceBuffer now EOS"))),h&&!!(!E||E.ended)},!0);b&&(U.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){l.getSourceBufferTypes().forEach(function(o){var E=l.sourceBuffer[o];E&&(E.ending=!1)});var h=l.mediaSource;if(!h||h.readyState!=="open"){h&&U.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+h.readyState);return}U.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),h.endOfStream()}))},S.onLevelUpdated=function(m,d){var l=d.details;l.fragments.length&&(this.details=l,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},S.flushBackBuffer=function(){var m=this.hls,d=this.details,l=this.media,b=this.sourceBuffer;if(!(!l||d===null)){var h=this.getSourceBufferTypes();if(h.length){var o=d.live&&m.config.liveBackBufferLength!==null?m.config.liveBackBufferLength:m.config.backBufferLength;if(!(!(0,R.isFiniteNumber)(o)||o<0)){var E=l.currentTime,A=d.levelTargetDuration,v=Math.max(o,A),c=Math.floor(E/A)*A-v;h.forEach(function(s){var p=b[s];if(p){var a=K.BufferHelper.getBuffered(p);if(a.length>0&&c>a.start(0)){if(m.trigger(_.Events.BACK_BUFFER_REACHED,{bufferEnd:c}),d.live)m.trigger(_.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:c});else if(p.ended&&a.end(a.length-1)-E<A*2){U.logger.info("[buffer-controller]: Cannot flush "+s+" back buffer while SourceBuffer is in ended state");return}m.trigger(_.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:c,type:s})}}})}}}},S.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var m=this.details,d=this.hls,l=this.media,b=this.mediaSource,h=m.fragments[0].start+m.totalduration,o=l.duration,E=(0,R.isFiniteNumber)(b.duration)?b.duration:0;m.live&&d.config.liveDurationInfinity?(U.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),b.duration=1/0,this.updateSeekableRange(m)):(h>E&&h>o||!(0,R.isFiniteNumber)(o))&&(U.logger.log("[buffer-controller]: Updating Media Source duration to "+h.toFixed(3)),b.duration=h)}},S.updateSeekableRange=function(m){var d=this.mediaSource,l=m.fragments,b=l.length;if(b&&m.live&&d!==null&&d!==void 0&&d.setLiveSeekableRange){var h=Math.max(0,l[0].start),o=Math.max(h,h+m.totalduration);d.setLiveSeekableRange(h,o)}},S.checkPendingTracks=function(){var m=this.bufferCodecEventsExpected,d=this.operationQueue,l=this.pendingTracks,b=Object.keys(l).length;if(b&&!m||b===2){this.createSourceBuffers(l),this.pendingTracks={};var h=this.getSourceBufferTypes();if(h.length===0){this.hls.trigger(_.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}h.forEach(function(o){d.executeNext(o)})}},S.createSourceBuffers=function(m){var d=this.sourceBuffer,l=this.mediaSource;if(!l)throw Error("createSourceBuffers called when mediaSource was null");var b=0;for(var h in m)if(!d[h]){var o=m[h];if(!o)throw Error("source buffer exists for track "+h+", however track does not");var E=o.levelCodec||o.codec,A=o.container+";codecs="+E;U.logger.log("[buffer-controller]: creating sourceBuffer("+A+")");try{var v=d[h]=l.addSourceBuffer(A),c=h;this.addBufferListener(c,"updatestart",this._onSBUpdateStart),this.addBufferListener(c,"updateend",this._onSBUpdateEnd),this.addBufferListener(c,"error",this._onSBUpdateError),this.tracks[h]={buffer:v,codec:E,container:o.container,levelCodec:o.levelCodec,metadata:o.metadata,id:o.id},b++}catch(s){U.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+s.message),this.hls.trigger(_.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:s,mimeType:A})}}b&&this.hls.trigger(_.Events.BUFFER_CREATED,{tracks:this.tracks})},S._onSBUpdateStart=function(m){var d=this.operationQueue,l=d.current(m);l.onStart()},S._onSBUpdateEnd=function(m){var d=this.operationQueue,l=d.current(m);l.onComplete(),d.shiftAndExecuteNext(m)},S._onSBUpdateError=function(m,d){U.logger.error("[buffer-controller]: "+m+" SourceBuffer error",d),this.hls.trigger(_.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var l=this.operationQueue.current(m);l&&l.onError(d)},S.removeExecutor=function(m,d,l){var b=this.media,h=this.mediaSource,o=this.operationQueue,E=this.sourceBuffer,A=E[m];if(!b||!h||!A){U.logger.warn("[buffer-controller]: Attempting to remove from the "+m+" SourceBuffer, but it does not exist"),o.shiftAndExecuteNext(m);return}var v=(0,R.isFiniteNumber)(b.duration)?b.duration:1/0,c=(0,R.isFiniteNumber)(h.duration)?h.duration:1/0,s=Math.max(0,d),p=Math.min(l,v,c);p>s&&!A.ending?(A.ended=!1,U.logger.log("[buffer-controller]: Removing ["+s+","+p+"] from the "+m+" SourceBuffer"),console.assert(!A.updating,m+" sourceBuffer must not be updating"),A.remove(s,p)):o.shiftAndExecuteNext(m)},S.appendExecutor=function(m,d){var l=this.operationQueue,b=this.sourceBuffer,h=b[d];if(!h){U.logger.warn("[buffer-controller]: Attempting to append to the "+d+" SourceBuffer, but it does not exist"),l.shiftAndExecuteNext(d);return}h.ended=!1,console.assert(!h.updating,d+" sourceBuffer must not be updating"),h.appendBuffer(m)},S.blockBuffers=function(m,d){var l=this;if(d===void 0&&(d=this.getSourceBufferTypes()),!d.length){U.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(m);return}var b=this.operationQueue,h=d.map(function(o){return b.appendBlocker(o)});Promise.all(h).then(function(){m(),d.forEach(function(o){var E=l.sourceBuffer[o];(!E||!E.updating)&&b.shiftAndExecuteNext(o)})})},S.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},S.addBufferListener=function(m,d,l){var b=this.sourceBuffer[m];if(b){var h=l.bind(this,m);this.listeners[m].push({event:d,listener:h}),b.addEventListener(d,h)}},S.removeBufferListeners=function(m){var d=this.sourceBuffer[m];d&&this.listeners[m].forEach(function(l){d.removeEventListener(l.event,l.listener)})},N}()},"./src/controller/buffer-operation-queue.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>_});var R=u("./src/utils/logger.ts"),_=function(){function U(K){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=K}var D=U.prototype;return D.append=function(k,F){var B=this.queues[F];B.push(k),B.length===1&&this.buffers[F]&&this.executeNext(F)},D.insertAbort=function(k,F){var B=this.queues[F];B.unshift(k),this.executeNext(F)},D.appendBlocker=function(k){var F,B=new Promise(function(P){F=P}),O={execute:F,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(O,k),B},D.executeNext=function(k){var F=this.buffers,B=this.queues,O=F[k],P=B[k];if(P.length){var g=P[0];try{g.execute()}catch(N){R.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),g.onError(N),(!O||!O.updating)&&(P.shift(),this.executeNext(k))}}},D.shiftAndExecuteNext=function(k){this.queues[k].shift(),this.executeNext(k)},D.current=function(k){return this.queues[k][0]},U}()},"./src/controller/cap-level-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>F});var R=u("./src/events.ts");function _(B,O){for(var P=0;P<O.length;P++){var g=O[P];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(B,D(g.key),g)}}function U(B,O,P){return O&&_(B.prototype,O),P&&_(B,P),Object.defineProperty(B,"prototype",{writable:!1}),B}function D(B){var O=K(B,"string");return typeof O=="symbol"?O:String(O)}function K(B,O){if(typeof B!="object"||B===null)return B;var P=B[Symbol.toPrimitive];if(P!==void 0){var g=P.call(B,O||"default");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return(O==="string"?String:Number)(B)}var k=function(){function B(P){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=P,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var O=B.prototype;return O.setStreamController=function(g){this.streamController=g},O.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},O.registerListeners=function(){var g=this.hls;g.on(R.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},O.unregisterListener=function(){var g=this.hls;g.off(R.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},O.onFpsDropLevelCapping=function(g,N){B.isLevelAllowed(N.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(N.droppedLevel)},O.onMediaAttaching=function(g,N){this.media=N.media instanceof HTMLVideoElement?N.media:null,this.clientRect=null},O.onManifestParsed=function(g,N){var S=this.hls;this.restrictedLevels=[],this.firstLevel=N.firstLevel,S.config.capLevelToPlayerSize&&N.video&&this.startCapping()},O.onBufferCodecs=function(g,N){var S=this.hls;S.config.capLevelToPlayerSize&&N.video&&this.startCapping()},O.onMediaDetaching=function(){this.stopCapping()},O.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var g=this.hls.levels;if(g.length){var N=this.hls;N.autoLevelCapping=this.getMaxLevel(g.length-1),N.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=N.autoLevelCapping}}},O.getMaxLevel=function(g){var N=this,S=this.hls.levels;if(!S.length)return-1;var f=S.filter(function(m,d){return B.isLevelAllowed(d,N.restrictedLevels)&&d<=g});return this.clientRect=null,B.getMaxLevelByMediaSize(f,this.mediaWidth,this.mediaHeight)},O.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},O.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},O.getDimensions=function(){if(this.clientRect)return this.clientRect;var g=this.media,N={width:0,height:0};if(g){var S=g.getBoundingClientRect();N.width=S.width,N.height=S.height,!N.width&&!N.height&&(N.width=S.right-S.left||g.width||0,N.height=S.bottom-S.top||g.height||0)}return this.clientRect=N,N},B.isLevelAllowed=function(g,N){return N===void 0&&(N=[]),N.indexOf(g)===-1},B.getMaxLevelByMediaSize=function(g,N,S){if(!g||!g.length)return-1;for(var f=function(h,o){return o?h.width!==o.width||h.height!==o.height:!0},m=g.length-1,d=0;d<g.length;d+=1){var l=g[d];if((l.width>=N||l.height>=S)&&f(l,g[d+1])){m=d;break}}return m},U(B,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var g=1;if(!this.hls.config.ignoreDevicePixelRatio)try{g=self.devicePixelRatio}catch{}return g}}]),B}();const F=k},"./src/controller/cmcd-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>S});var R=u("./src/events.ts"),_=u("./src/types/cmcd.ts"),U=u("./src/utils/buffer-helper.ts"),D=u("./src/utils/logger.ts");function K(f,m){for(var d=0;d<m.length;d++){var l=m[d];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(f,F(l.key),l)}}function k(f,m,d){return m&&K(f.prototype,m),d&&K(f,d),Object.defineProperty(f,"prototype",{writable:!1}),f}function F(f){var m=B(f,"string");return typeof m=="symbol"?m:String(m)}function B(f,m){if(typeof f!="object"||f===null)return f;var d=f[Symbol.toPrimitive];if(d!==void 0){var l=d.call(f,m||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(f)}function O(f,m){var d=typeof Symbol<"u"&&f[Symbol.iterator]||f["@@iterator"];if(d)return(d=d.call(f)).next.bind(d);if(Array.isArray(f)||(d=P(f))||m&&f&&typeof f.length=="number"){d&&(f=d);var l=0;return function(){return l>=f.length?{done:!0}:{done:!1,value:f[l++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P(f,m){if(f){if(typeof f=="string")return g(f,m);var d=Object.prototype.toString.call(f).slice(8,-1);if(d==="Object"&&f.constructor&&(d=f.constructor.name),d==="Map"||d==="Set")return Array.from(f);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return g(f,m)}}function g(f,m){(m==null||m>f.length)&&(m=f.length);for(var d=0,l=new Array(m);d<m;d++)l[d]=f[d];return l}function N(){return N=Object.assign?Object.assign.bind():function(f){for(var m=1;m<arguments.length;m++){var d=arguments[m];for(var l in d)Object.prototype.hasOwnProperty.call(d,l)&&(f[l]=d[l])}return f},N.apply(this,arguments)}var S=function(){function f(d){var l=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){l.initialized&&(l.starved=!0),l.buffering=!0},this.onPlaying=function(){l.initialized||(l.initialized=!0),l.buffering=!1},this.applyPlaylistData=function(o){try{l.apply(o,{ot:_.CMCDObjectType.MANIFEST,su:!l.initialized})}catch(E){D.logger.warn("Could not generate manifest CMCD data.",E)}},this.applyFragmentData=function(o){try{var E=o.frag,A=l.hls.levels[E.level],v=l.getObjectType(E),c={d:E.duration*1e3,ot:v};(v===_.CMCDObjectType.VIDEO||v===_.CMCDObjectType.AUDIO||v==_.CMCDObjectType.MUXED)&&(c.br=A.bitrate/1e3,c.tb=l.getTopBandwidth(v)/1e3,c.bl=l.getBufferLength(v)),l.apply(o,c)}catch(s){D.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=d;var b=this.config=d.config,h=b.cmcd;h!=null&&(b.pLoader=this.createPlaylistLoader(),b.fLoader=this.createFragmentLoader(),this.sid=h.sessionId||f.uuid(),this.cid=h.contentId,this.useHeaders=h.useHeaders===!0,this.registerListeners())}var m=f.prototype;return m.registerListeners=function(){var l=this.hls;l.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),l.on(R.Events.BUFFER_CREATED,this.onBufferCreated,this)},m.unregisterListeners=function(){var l=this.hls;l.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),l.off(R.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},m.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},m.onMediaAttached=function(l,b){this.media=b.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},m.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},m.onBufferCreated=function(l,b){var h,o;this.audioBuffer=(h=b.tracks.audio)===null||h===void 0?void 0:h.buffer,this.videoBuffer=(o=b.tracks.video)===null||o===void 0?void 0:o.buffer},m.createData=function(){var l;return{v:_.CMCDVersion,sf:_.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(l=this.media)===null||l===void 0?void 0:l.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},m.apply=function(l,b){b===void 0&&(b={}),N(b,this.createData());var h=b.ot===_.CMCDObjectType.INIT||b.ot===_.CMCDObjectType.VIDEO||b.ot===_.CMCDObjectType.MUXED;if(this.starved&&h&&(b.bs=!0,b.su=!0,this.starved=!1),b.su==null&&(b.su=this.buffering),this.useHeaders){var o=f.toHeaders(b);if(!Object.keys(o).length)return;l.headers||(l.headers={}),N(l.headers,o)}else{var E=f.toQuery(b);if(!E)return;l.url=f.appendQueryToUri(l.url,E)}},m.getObjectType=function(l){var b=l.type;if(b==="subtitle")return _.CMCDObjectType.TIMED_TEXT;if(l.sn==="initSegment")return _.CMCDObjectType.INIT;if(b==="audio")return _.CMCDObjectType.AUDIO;if(b==="main")return this.hls.audioTracks.length?_.CMCDObjectType.VIDEO:_.CMCDObjectType.MUXED},m.getTopBandwidth=function(l){var b=0,h,o=this.hls;if(l===_.CMCDObjectType.AUDIO)h=o.audioTracks;else{var E=o.maxAutoLevel,A=E>-1?E+1:o.levels.length;h=o.levels.slice(0,A)}for(var v=O(h),c;!(c=v()).done;){var s=c.value;s.bitrate>b&&(b=s.bitrate)}return b>0?b:NaN},m.getBufferLength=function(l){var b=this.hls.media,h=l===_.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!h||!b)return NaN;var o=U.BufferHelper.bufferInfo(h,b.currentTime,this.config.maxBufferHole);return o.len*1e3},m.createPlaylistLoader=function(){var l=this.config.pLoader,b=this.applyPlaylistData,h=l||this.config.loader;return function(){function o(A){this.loader=void 0,this.loader=new h(A)}var E=o.prototype;return E.destroy=function(){this.loader.destroy()},E.abort=function(){this.loader.abort()},E.load=function(v,c,s){b(v),this.loader.load(v,c,s)},k(o,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),o}()},m.createFragmentLoader=function(){var l=this.config.fLoader,b=this.applyFragmentData,h=l||this.config.loader;return function(){function o(A){this.loader=void 0,this.loader=new h(A)}var E=o.prototype;return E.destroy=function(){this.loader.destroy()},E.abort=function(){this.loader.abort()},E.load=function(v,c,s){b(v),this.loader.load(v,c,s)},k(o,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),o}()},f.uuid=function(){var l=URL.createObjectURL(new Blob),b=l.toString();return URL.revokeObjectURL(l),b.slice(b.lastIndexOf("/")+1)},f.serialize=function(l){for(var b=[],h=function(w){return!Number.isNaN(w)&&w!=null&&w!==""&&w!==!1},o=function(w){return Math.round(w)},E=function(w){return o(w/100)*100},A=function(w){return encodeURIComponent(w)},v={br:o,d:o,bl:E,dl:E,mtp:E,nor:A,rtp:E,tb:o},c=Object.keys(l||{}).sort(),s=O(c),p;!(p=s()).done;){var a=p.value,T=l[a];if(h(T)&&!(a==="v"&&T===1)&&!(a=="pr"&&T===1)){var L=v[a];L&&(T=L(T));var I=typeof T,H=void 0;a==="ot"||a==="sf"||a==="st"?H=a+"="+T:I==="boolean"?H=a:I==="number"?H=a+"="+T:H=a+"="+JSON.stringify(T),b.push(H)}}return b.join(",")},f.toHeaders=function(l){for(var b=Object.keys(l),h={},o=["Object","Request","Session","Status"],E=[{},{},{},{}],A={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},v=0,c=b;v<c.length;v++){var s=c[v],p=A[s]!=null?A[s]:1;E[p][s]=l[s]}for(var a=0;a<E.length;a++){var T=f.serialize(E[a]);T&&(h["CMCD-"+o[a]]=T)}return h},f.toQuery=function(l){return"CMCD="+encodeURIComponent(f.serialize(l))},f.appendQueryToUri=function(l,b){if(!b)return l;var h=l.includes("?")?"&":"?";return""+l+h+b},f}()},"./src/controller/eme-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>v});var R=u("./src/events.ts"),_=u("./src/errors.ts"),U=u("./src/utils/logger.ts"),D=u("./src/utils/mediakeys-helper.ts"),K=u("./src/utils/keysystem-util.ts"),k=u("./src/utils/numeric-encoding-utils.ts"),F=u("./src/loader/level-key.ts"),B=u("./src/utils/hex.ts"),O=u("./src/utils/mp4-tools.ts"),P=u("./node_modules/eventemitter3/index.js"),g=u.n(P);function N(c,s){c.prototype=Object.create(s.prototype),c.prototype.constructor=c,l(c,s)}function S(c){var s=typeof Map=="function"?new Map:void 0;return S=function(a){if(a===null||!d(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof s<"u"){if(s.has(a))return s.get(a);s.set(a,T)}function T(){return f(a,arguments,b(this).constructor)}return T.prototype=Object.create(a.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),l(T,a)},S(c)}function f(c,s,p){return m()?f=Reflect.construct.bind():f=function(T,L,I){var H=[null];H.push.apply(H,L);var W=Function.bind.apply(T,H),w=new W;return I&&l(w,I.prototype),w},f.apply(null,arguments)}function m(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function d(c){return Function.toString.call(c).indexOf("[native code]")!==-1}function l(c,s){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,T){return a.__proto__=T,a},l(c,s)}function b(c){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(p){return p.__proto__||Object.getPrototypeOf(p)},b(c)}var h=3,o="[eme]",E=function(){function c(p){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=c.CDMCleanupPromise?[c.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=U.logger.debug.bind(U.logger,o),this.log=U.logger.log.bind(U.logger,o),this.warn=U.logger.warn.bind(U.logger,o),this.error=U.logger.error.bind(U.logger,o),this.hls=p,this.config=p.config,this.registerListeners()}var s=c.prototype;return s.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},s.registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},s.unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},s.getLicenseServerUrl=function(a){var T=this.config,L=T.drmSystems,I=T.widevineLicenseUrl,H=L[a];if(H)return H.licenseUrl;if(a===D.KeySystems.WIDEVINE&&I)return I;throw new Error('no license server URL configured for key-system "'+a+'"')},s.getServerCertificateUrl=function(a){var T=this.config.drmSystems,L=T[a];if(L)return L.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+a+'"]')},s.attemptKeySystemAccess=function(a){var T=this,L=this.hls.levels,I=function(G,Y,j){return!!G&&j.indexOf(G)===Y},H=L.map(function(w){return w.audioCodec}).filter(I),W=L.map(function(w){return w.videoCodec}).filter(I);return H.length+W.length===0&&W.push("avc1.42e01e"),new Promise(function(w,G){var Y=function j(X){var q=X.shift();T.getMediaKeysPromise(q,H,W).then(function(J){return w({keySystem:q,mediaKeys:J})}).catch(function(J){X.length?j(X):J instanceof A?G(J):G(new A({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:J,fatal:!0},J.message))})};Y(a)})},s.requestMediaKeySystemAccess=function(a,T){var L=this.config.requestMediaKeySystemAccessFunc;if(typeof L!="function"){var I="Configured requestMediaKeySystemAccess is not a function "+L;return D.requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(I="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(I))}return L(a,T)},s.getMediaKeysPromise=function(a,T,L){var I=this,H=(0,D.getSupportedMediaKeySystemConfigurations)(a,T,L,this.config.drmSystemOptions),W=this.keySystemAccessPromises[a],w=W==null?void 0:W.keySystemAccess;if(!w){this.log('Requesting encrypted media "'+a+'" key-system access with config: '+JSON.stringify(H)),w=this.requestMediaKeySystemAccess(a,H);var G=this.keySystemAccessPromises[a]={keySystemAccess:w};return w.catch(function(Y){I.log('Failed to obtain access to key-system "'+a+'": '+Y)}),w.then(function(Y){I.log('Access for key-system "'+Y.keySystem+'" obtained');var j=I.fetchServerCertificate(a);return I.log('Create media-keys for "'+a+'"'),G.mediaKeys=Y.createMediaKeys().then(function(X){return I.log('Media-keys created for "'+a+'"'),j.then(function(q){return q?I.setMediaKeysServerCertificate(X,a,q):X})}),G.mediaKeys.catch(function(X){I.error('Failed to create media-keys for "'+a+'"}: '+X)}),G.mediaKeys})}return w.then(function(){return W.mediaKeys})},s.createMediaKeySessionContext=function(a){var T=a.decryptdata,L=a.keySystem,I=a.mediaKeys;console.assert(!!I,"mediaKeys is defined"),this.log('Creating key-system session "'+L+'" keyId: '+B.default.hexDump(T.keyId||[]));var H=I.createSession(),W={decryptdata:T,keySystem:L,mediaKeys:I,mediaKeysSession:H,keyStatus:"status-pending"};return this.mediaKeySessions.push(W),W},s.renewKeySession=function(a){var T=a.decryptdata;if(T.pssh){var L=this.createMediaKeySessionContext(a),I=this.getKeyIdString(T),H="cenc";this.keyIdToKeySessionPromise[I]=this.generateRequestWithPreferredKeySession(L,H,T.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(a)},s.getKeyIdString=function(a){if(!a)throw new Error("Could not read keyId of undefined decryptdata");if(a.keyId===null)throw new Error("keyId is null");return B.default.hexDump(a.keyId)},s.updateKeySession=function(a,T){var L,I=a.mediaKeysSession;return this.log('Updating key-session "'+I.sessionId+'" for keyID '+B.default.hexDump(((L=a.decryptdata)===null||L===void 0?void 0:L.keyId)||[])+`
      } (data length: `+(T&&T.byteLength)+")"),I.update(T)},s.selectKeySystemFormat=function(a){var T=Object.keys(a.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+a.sn+" "+a.type+": "+a.level+") key formats "+T.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(T)),this.keyFormatPromise},s.getKeyFormatPromise=function(a){var T=this;return new Promise(function(L,I){var H=(0,D.getKeySystemsForConfig)(T.config),W=a.map(D.keySystemFormatToKeySystemDomain).filter(function(w){return!!w&&H.indexOf(w)!==-1});return T.getKeySystemSelectionPromise(W).then(function(w){var G=w.keySystem,Y=(0,D.keySystemDomainToKeySystemFormat)(G);Y?L(Y):I(new Error('Unable to find format for key-system "'+G+'"'))}).catch(I)})},s.loadKey=function(a){var T=this,L=a.keyInfo.decryptdata,I=this.getKeyIdString(L),H="(keyId: "+I+' format: "'+L.keyFormat+'" method: '+L.method+" uri: "+L.uri+")";this.log("Starting session for key "+H);var W=this.keyIdToKeySessionPromise[I];return W||(W=this.keyIdToKeySessionPromise[I]=this.getKeySystemForKeyPromise(L).then(function(w){var G=w.keySystem,Y=w.mediaKeys;return T.throwIfDestroyed(),T.log("Handle encrypted media sn: "+a.frag.sn+" "+a.frag.type+": "+a.frag.level+" using key "+H),T.attemptSetMediaKeys(G,Y).then(function(){T.throwIfDestroyed();var j=T.createMediaKeySessionContext({keySystem:G,mediaKeys:Y,decryptdata:L}),X="cenc";return T.generateRequestWithPreferredKeySession(j,X,L.pssh,"playlist-key")})}),W.catch(function(w){return T.handleError(w)})),W},s.throwIfDestroyed=function(a){if(!this.hls)throw new Error("invalid state")},s.handleError=function(a){this.hls&&(this.error(a.message),a instanceof A?this.hls.trigger(R.Events.ERROR,a.data):this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:a,fatal:!0}))},s.getKeySystemForKeyPromise=function(a){var T=this.getKeyIdString(a),L=this.keyIdToKeySessionPromise[T];if(!L){var I=(0,D.keySystemFormatToKeySystemDomain)(a.keyFormat),H=I?[I]:(0,D.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(H)}return L},s.getKeySystemSelectionPromise=function(a){if(a.length||(a=(0,D.getKeySystemsForConfig)(this.config)),a.length===0)throw new A({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(a)},s._onMediaEncrypted=function(a){var T=this,L=a.initDataType,I=a.initData;if(this.debug('"'+a.type+'" event: init data type: "'+L+'"'),I!==null){var H,W;if(L==="sinf"&&this.config.drmSystems[D.KeySystems.FAIRPLAY]){var w=(0,O.bin2str)(new Uint8Array(I));try{var G=(0,k.base64Decode)(JSON.parse(w).sinf),Y=(0,O.parseSinf)(new Uint8Array(G));if(!Y)return;H=Y.subarray(8,24),W=D.KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{var j=(0,O.parsePssh)(I);if(j===null)return;j.version===0&&j.systemId===D.KeySystemIds.WIDEVINE&&j.data&&(H=j.data.subarray(8,24)),W=(0,D.keySystemIdToKeySystemDomain)(j.systemId)}if(!(!W||!H)){for(var X=B.default.hexDump(H),q=this.keyIdToKeySessionPromise,J=this.mediaKeySessions,V=q[X],Q=function(ae){var le=J[ae],ne=le.decryptdata;if(ne.pssh||!ne.keyId)return"continue";var ie=B.default.hexDump(ne.keyId);if(X===ie||ne.uri.replace(/-/g,"").indexOf(X)!==-1)return V=q[ie],delete q[ie],ne.pssh=new Uint8Array(I),ne.keyId=H,V=q[X]=V.then(function(){return T.generateRequestWithPreferredKeySession(le,L,I,"encrypted-event-key-match")}),"break"},ee=0;ee<J.length;ee++){var Z=Q(ee);if(Z!=="continue"&&Z==="break")break}V||(V=q[X]=this.getKeySystemSelectionPromise([W]).then(function(re){var ae,le=re.keySystem,ne=re.mediaKeys;T.throwIfDestroyed();var ie=new F.LevelKey("ISO-23001-7",X,(ae=(0,D.keySystemDomainToKeySystemFormat)(le))!=null?ae:"");return ie.pssh=new Uint8Array(I),ie.keyId=H,T.attemptSetMediaKeys(le,ne).then(function(){T.throwIfDestroyed();var ue=T.createMediaKeySessionContext({decryptdata:ie,keySystem:le,mediaKeys:ne});return T.generateRequestWithPreferredKeySession(ue,L,I,"encrypted-event-no-match")})})),V.catch(function(re){return T.handleError(re)})}}},s._onWaitingForKey=function(a){this.log('"'+a.type+'" event')},s.attemptSetMediaKeys=function(a,T){var L=this,I=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+a+'"');var H=Promise.all(I).then(function(){if(!L.media)throw new Error("Attempted to set mediaKeys without media element attached");return L.media.setMediaKeys(T)});return this.setMediaKeysQueue.push(H),H.then(function(){L.log('Media-keys set for "'+a+'"'),I.push(H),L.setMediaKeysQueue=L.setMediaKeysQueue.filter(function(W){return I.indexOf(W)===-1})})},s.generateRequestWithPreferredKeySession=function(a,T,L,I){var H,W,w=this,G=(H=this.config.drmSystems)===null||H===void 0||(W=H[a.keySystem])===null||W===void 0?void 0:W.generateRequest;if(G)try{var Y=G.call(this.hls,T,L,a);if(!Y)throw new Error("Invalid response from configured generateRequest filter");T=Y.initDataType,L=a.decryptdata.pssh=Y.initData?new Uint8Array(Y.initData):null}catch(V){var j;if(this.warn(V.message),(j=this.hls)!==null&&j!==void 0&&j.config.debug)throw V}if(L===null)return this.log('Skipping key-session request for "'+I+'" (no initData)'),Promise.resolve(a);var X=this.getKeyIdString(a.decryptdata);this.log('Generating key-session request for "'+I+'": '+X+" (init data type: "+T+" length: "+(L?L.byteLength:null)+")");var q=new(g());a.mediaKeysSession.onmessage=function(V){var Q=a.mediaKeysSession;if(!Q){q.emit("error",new Error("invalid state"));return}var ee=V.messageType,Z=V.message;w.log('"'+ee+'" message event for session "'+Q.sessionId+'" message size: '+Z.byteLength),ee==="license-request"||ee==="license-renewal"?w.renewLicense(a,Z).catch(function(re){w.handleError(re),q.emit("error",re)}):ee==="license-release"?a.keySystem===D.KeySystems.FAIRPLAY&&(w.updateKeySession(a,(0,K.strToUtf8array)("acknowledged")),w.removeSession(a)):w.warn('unhandled media key message type "'+ee+'"')},a.mediaKeysSession.onkeystatuseschange=function(V){var Q=a.mediaKeysSession;if(!Q){q.emit("error",new Error("invalid state"));return}w.onKeyStatusChange(a);var ee=a.keyStatus;q.emit("keyStatus",ee),ee==="expired"&&(w.warn(a.keySystem+" expired for key "+X),w.renewKeySession(a))};var J=new Promise(function(V,Q){q.on("error",Q),q.on("keyStatus",function(ee){ee.startsWith("usable")?V():ee==="output-restricted"?Q(new A({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):ee==="internal-error"?Q(new A({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+ee+'"')):ee==="expired"?Q(new Error("key expired while generating request")):w.warn('unhandled key status change "'+ee+'"')})});return a.mediaKeysSession.generateRequest(T,L).then(function(){var V;w.log('Request generated for key-session "'+((V=a.mediaKeysSession)===null||V===void 0?void 0:V.sessionId)+'" keyId: '+X)}).catch(function(V){throw new A({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:V,fatal:!1},"Error generating key-session request: "+V)}).then(function(){return J}).catch(function(V){throw q.removeAllListeners(),w.removeSession(a),V}).then(function(){return q.removeAllListeners(),a})},s.onKeyStatusChange=function(a){var T=this;a.mediaKeysSession.keyStatuses.forEach(function(L,I){T.log('key status change "'+L+'" for keyStatuses keyId: '+B.default.hexDump("buffer"in I?new Uint8Array(I.buffer,I.byteOffset,I.byteLength):new Uint8Array(I))+" session keyId: "+B.default.hexDump(new Uint8Array(a.decryptdata.keyId||[]))+" uri: "+a.decryptdata.uri),a.keyStatus=L})},s.fetchServerCertificate=function(a){var T=this;return new Promise(function(L,I){var H=T.getServerCertificateUrl(a);if(!H)return L();T.log('Fetching serverCertificate for "'+a+'"');var W=new XMLHttpRequest;W.open("GET",H,!0),W.responseType="arraybuffer",W.onreadystatechange=function(){W.readyState===XMLHttpRequest.DONE&&(W.status===200?L(W.response):I(new A({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:W},'"'+a+'" certificate request XHR failed ('+H+"). Status: "+W.status+" ("+W.statusText+")")))},W.send()})},s.setMediaKeysServerCertificate=function(a,T,L){var I=this;return new Promise(function(H,W){a.setServerCertificate(L).then(function(w){I.log("setServerCertificate "+(w?"success":"not supported by CDM")+" ("+(L==null?void 0:L.byteLength)+') on "'+T+'"'),H(a)}).catch(function(w){W(new A({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:w,fatal:!0},w.message))})})},s.renewLicense=function(a,T){var L=this;return this.requestLicense(a,new Uint8Array(T)).then(function(I){return L.updateKeySession(a,new Uint8Array(I)).catch(function(H){throw new A({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:H,fatal:!0},H.message)})})},s.setupLicenseXHR=function(a,T,L,I){var H=this,W=this.config.licenseXhrSetup;return W?Promise.resolve().then(function(){if(!L.decryptdata)throw new Error("Key removed");return W.call(H.hls,a,T,L,I)}).catch(function(w){if(!L.decryptdata)throw w;return a.open("POST",T,!0),W.call(H.hls,a,T,L,I)}).then(function(w){a.readyState||a.open("POST",T,!0);var G=w||I;return{xhr:a,licenseChallenge:G}}):(a.open("POST",T,!0),Promise.resolve({xhr:a,licenseChallenge:I}))},s.requestLicense=function(a,T){var L=this;return new Promise(function(I,H){var W=L.getLicenseServerUrl(a.keySystem);L.log("Sending license request to URL: "+W);var w=new XMLHttpRequest;w.responseType="arraybuffer",w.onreadystatechange=function(){if(!L.hls||!a.mediaKeysSession)return H(new Error("invalid state"));if(w.readyState===4)if(w.status===200){L._requestLicenseFailureCount=0;var G=w.response;L.log("License received "+(G instanceof ArrayBuffer?G.byteLength:G));var Y=L.config.licenseResponseCallback;if(Y)try{G=Y.call(L.hls,w,W,a)}catch(X){L.error(X)}I(G)}else if(L._requestLicenseFailureCount++,L._requestLicenseFailureCount>h||w.status>=400&&w.status<500)H(new A({type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:w},"License Request XHR failed ("+W+"). Status: "+w.status+" ("+w.statusText+")"));else{var j=h-L._requestLicenseFailureCount+1;L.warn("Retrying license request, "+j+" attempts left"),L.requestLicense(a,T).then(I,H)}},a.licenseXhr&&a.licenseXhr.readyState!==XMLHttpRequest.DONE&&a.licenseXhr.abort(),a.licenseXhr=w,L.setupLicenseXHR(w,W,a,T).then(function(G){var Y=G.xhr,j=G.licenseChallenge;Y.send(j)})})},s.onMediaAttached=function(a,T){if(this.config.emeEnabled){var L=T.media;this.media=L,L.addEventListener("encrypted",this.onMediaEncrypted),L.addEventListener("waitingforkey",this.onWaitingForKey)}},s.onMediaDetached=function(){var a=this,T=this.media,L=this.mediaKeySessions;T&&(T.removeEventListener("encrypted",this.onMediaEncrypted),T.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},F.LevelKey.clearKeyUriToKeyIdMap();var I=L.length;c.CDMCleanupPromise=Promise.all(L.map(function(H){return a.removeSession(H)}).concat(T==null?void 0:T.setMediaKeys(null).catch(function(H){a.log("Could not clear media keys: "+H+". media.src: "+(T==null?void 0:T.src))}))).then(function(){I&&(a.log("finished closing key sessions and clearing media keys"),L.length=0)}).catch(function(H){a.log("Could not close sessions and clear media keys: "+H+". media.src: "+(T==null?void 0:T.src))})},s.onManifestLoaded=function(a,T){var L=T.sessionKeys;if(!(!L||!this.config.emeEnabled)&&!this.keyFormatPromise){var I=L.reduce(function(H,W){return H.indexOf(W.keyFormat)===-1&&H.push(W.keyFormat),H},[]);this.log("Selecting key-system from session-keys "+I.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(I)}},s.removeSession=function(a){var T=this,L=a.mediaKeysSession,I=a.licenseXhr;if(L){this.log("Remove licenses and keys and close session "+L.sessionId),L.onmessage=null,L.onkeystatuseschange=null,I&&I.readyState!==XMLHttpRequest.DONE&&I.abort(),a.mediaKeysSession=a.decryptdata=a.licenseXhr=void 0;var H=this.mediaKeySessions.indexOf(a);return H>-1&&this.mediaKeySessions.splice(H,1),L.remove().catch(function(W){T.log("Could not remove session: "+W)}).then(function(){return L.close()}).catch(function(W){T.log("Could not close session: "+W)})}},c}();E.CDMCleanupPromise=void 0;var A=function(c){N(s,c);function s(p,a){var T;return T=c.call(this,a)||this,T.data=void 0,T.data=p,p.err=p.error,T}return s}(S(Error));const v=E},"./src/controller/fps-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>D});var R=u("./src/events.ts"),_=u("./src/utils/logger.ts"),U=function(){function K(F){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=F,this.registerListeners()}var k=K.prototype;return k.setStreamController=function(B){this.streamController=B},k.registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},k.unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching)},k.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},k.onMediaAttaching=function(B,O){var P=this.hls.config;if(P.capLevelOnFPSDrop){var g=O.media instanceof self.HTMLVideoElement?O.media:null;this.media=g,g&&typeof g.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),P.fpsDroppedMonitoringPeriod)}},k.checkFPS=function(B,O,P){var g=performance.now();if(O){if(this.lastTime){var N=g-this.lastTime,S=P-this.lastDroppedFrames,f=O-this.lastDecodedFrames,m=1e3*S/N,d=this.hls;if(d.trigger(R.Events.FPS_DROP,{currentDropped:S,currentDecoded:f,totalDroppedFrames:P}),m>0&&S>d.config.fpsDroppedMonitoringThreshold*f){var l=d.currentLevel;_.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=l)&&(l=l-1,d.trigger(R.Events.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:d.currentLevel}),d.autoLevelCapping=l,this.streamController.nextLevelSwitch())}}this.lastTime=g,this.lastDroppedFrames=P,this.lastDecodedFrames=O}},k.checkFPSInterval=function(){var B=this.media;if(B)if(this.isVideoPlaybackQualityAvailable){var O=B.getVideoPlaybackQuality();this.checkFPS(B,O.totalVideoFrames,O.droppedVideoFrames)}else this.checkFPS(B,B.webkitDecodedFrameCount,B.webkitDroppedFrameCount)},K}();const D=U},"./src/controller/fragment-finders.ts":(M,C,u)=>{u.r(C),u.d(C,{findFragWithCC:()=>F,findFragmentByPDT:()=>U,findFragmentByPTS:()=>D,fragmentWithinToleranceTest:()=>K,pdtWithinToleranceTest:()=>k});var R=u("./src/polyfills/number.ts"),_=u("./src/utils/binary-search.ts");function U(B,O,P){if(O===null||!Array.isArray(B)||!B.length||!(0,R.isFiniteNumber)(O))return null;var g=B[0].programDateTime;if(O<(g||0))return null;var N=B[B.length-1].endProgramDateTime;if(O>=(N||0))return null;P=P||0;for(var S=0;S<B.length;++S){var f=B[S];if(k(O,P,f))return f}return null}function D(B,O,P,g){P===void 0&&(P=0),g===void 0&&(g=0);var N=null;if(B?N=O[B.sn-O[0].sn+1]||null:P===0&&O[0].start===0&&(N=O[0]),N&&K(P,g,N)===0)return N;var S=_.default.search(O,K.bind(null,P,g));return S&&(S!==B||!N)?S:N}function K(B,O,P){if(B===void 0&&(B=0),O===void 0&&(O=0),P.start<=B&&P.start+P.duration>B)return 0;var g=Math.min(O,P.duration+(P.deltaPTS?P.deltaPTS:0));return P.start+P.duration-g<=B?1:P.start-g>B&&P.start?-1:0}function k(B,O,P){var g=Math.min(O,P.duration+(P.deltaPTS?P.deltaPTS:0))*1e3,N=P.endProgramDateTime||0;return N-g>B}function F(B,O){return _.default.search(B,function(P){return P.cc<O?1:P.cc>O?-1:0})}},"./src/controller/fragment-tracker.ts":(M,C,u)=>{u.r(C),u.d(C,{FragmentState:()=>U,FragmentTracker:()=>D});var R=u("./src/events.ts"),_=u("./src/types/loader.ts"),U;(function(F){F.NOT_LOADED="NOT_LOADED",F.APPENDING="APPENDING",F.PARTIAL="PARTIAL",F.OK="OK"})(U||(U={}));var D=function(){function F(O){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=O,this._registerListeners()}var B=F.prototype;return B._registerListeners=function(){var P=this.hls;P.on(R.Events.BUFFER_APPENDED,this.onBufferAppended,this),P.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this),P.on(R.Events.FRAG_LOADED,this.onFragLoaded,this)},B._unregisterListeners=function(){var P=this.hls;P.off(R.Events.BUFFER_APPENDED,this.onBufferAppended,this),P.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this),P.off(R.Events.FRAG_LOADED,this.onFragLoaded,this)},B.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},B.getAppendedFrag=function(P,g){if(g===_.PlaylistLevelType.MAIN){var N=this.activeFragment,S=this.activeParts;if(!N)return null;if(S)for(var f=S.length;f--;){var m=S[f],d=m?m.end:N.appendedPTS;if(m.start<=P&&d!==void 0&&P<=d)return f>9&&(this.activeParts=S.slice(f-9)),m}else if(N.start<=P&&N.appendedPTS!==void 0&&P<=N.appendedPTS)return N}return this.getBufferedFrag(P,g)},B.getBufferedFrag=function(P,g){for(var N=this.fragments,S=Object.keys(N),f=S.length;f--;){var m=N[S[f]];if((m==null?void 0:m.body.type)===g&&m.buffered){var d=m.body;if(d.start<=P&&P<=d.end)return d}}return null},B.detectEvictedFragments=function(P,g,N){var S=this;this.timeRanges&&(this.timeRanges[P]=g),Object.keys(this.fragments).forEach(function(f){var m=S.fragments[f];if(m){if(!m.buffered&&!m.loaded){m.body.type===N&&S.removeFragment(m.body);return}var d=m.range[P];d&&d.time.some(function(l){var b=!S.isTimeBuffered(l.startPTS,l.endPTS,g);return b&&S.removeFragment(m.body),b})}})},B.detectPartialFragments=function(P){var g=this,N=this.timeRanges,S=P.frag,f=P.part;if(!(!N||S.sn==="initSegment")){var m=k(S),d=this.fragments[m];d&&(Object.keys(N).forEach(function(l){var b=S.elementaryStreams[l];if(b){var h=N[l],o=f!==null||b.partial===!0;d.range[l]=g.getBufferedTimes(S,f,o,h)}}),d.loaded=null,Object.keys(d.range).length?(d.buffered=!0,d.body.endList&&(this.endListFragments[d.body.type]=d)):this.removeFragment(d.body))}},B.fragBuffered=function(P){var g=k(P),N=this.fragments[g];N&&(N.loaded=null,N.buffered=!0)},B.getBufferedTimes=function(P,g,N,S){for(var f={time:[],partial:N},m=g?g.start:P.start,d=g?g.end:P.end,l=P.minEndPTS||d,b=P.maxStartPTS||m,h=0;h<S.length;h++){var o=S.start(h)-this.bufferPadding,E=S.end(h)+this.bufferPadding;if(b>=o&&l<=E){f.time.push({startPTS:Math.max(m,S.start(h)),endPTS:Math.min(d,S.end(h))});break}else if(m<E&&d>o)f.partial=!0,f.time.push({startPTS:Math.max(m,S.start(h)),endPTS:Math.min(d,S.end(h))});else if(d<=o)break}return f},B.getPartialFragment=function(P){var g=null,N,S,f,m=0,d=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach(function(b){var h=l[b];h&&K(h)&&(S=h.body.start-d,f=h.body.end+d,P>=S&&P<=f&&(N=Math.min(P-S,f-P),m<=N&&(g=h.body,m=N)))}),g},B.isEndListAppended=function(P){var g=this.endListFragments[P];return g!==void 0&&(g.buffered||K(g))},B.getState=function(P){var g=k(P),N=this.fragments[g];return N?N.buffered?K(N)?U.PARTIAL:U.OK:U.APPENDING:U.NOT_LOADED},B.isTimeBuffered=function(P,g,N){for(var S,f,m=0;m<N.length;m++){if(S=N.start(m)-this.bufferPadding,f=N.end(m)+this.bufferPadding,P>=S&&g<=f)return!0;if(g<=S)return!1}return!1},B.onFragLoaded=function(P,g){var N=g.frag,S=g.part;if(!(N.sn==="initSegment"||N.bitrateTest||S)){var f=k(N);this.fragments[f]={body:N,loaded:g,buffered:!1,range:Object.create(null)}}},B.onBufferAppended=function(P,g){var N=this,S=g.frag,f=g.part,m=g.timeRanges;if(S.type===_.PlaylistLevelType.MAIN)if(this.activeFragment!==S&&(this.activeFragment=S,S.appendedPTS=void 0),f){var d=this.activeParts;d||(this.activeParts=d=[]),d.push(f)}else this.activeParts=null;this.timeRanges=m,Object.keys(m).forEach(function(l){var b=m[l];if(N.detectEvictedFragments(l,b),!f&&S.type===_.PlaylistLevelType.MAIN){var h=S.elementaryStreams[l];if(!h)return;for(var o=0;o<b.length;o++){var E=b.end(o);E<=h.endPTS&&E>h.startPTS?S.appendedPTS=Math.max(E,S.appendedPTS||0):S.appendedPTS=h.endPTS}}})},B.onFragBuffered=function(P,g){this.detectPartialFragments(g)},B.hasFragment=function(P){var g=k(P);return!!this.fragments[g]},B.removeFragmentsInRange=function(P,g,N){var S=this;Object.keys(this.fragments).forEach(function(f){var m=S.fragments[f];if(m&&m.buffered){var d=m.body;d.type===N&&d.start<g&&d.end>P&&S.removeFragment(d)}})},B.removeFragment=function(P){var g=k(P);P.stats.loaded=0,P.clearElementaryStreamInfo(),P.appendedPTS=void 0,delete this.fragments[g],P.endList&&delete this.endListFragments[P.type]},B.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},F}();function K(F){var B,O;return F.buffered&&(((B=F.range.video)===null||B===void 0?void 0:B.partial)||((O=F.range.audio)===null||O===void 0?void 0:O.partial))}function k(F){return F.type+"_"+F.level+"_"+F.urlId+"_"+F.sn}},"./src/controller/gap-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{MAX_START_GAP_JUMP:()=>k,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>F,SKIP_BUFFER_RANGE_START:()=>B,STALL_MINIMUM_DURATION_MS:()=>K,default:()=>O});var R=u("./src/utils/buffer-helper.ts"),_=u("./src/errors.ts"),U=u("./src/events.ts"),D=u("./src/utils/logger.ts"),K=250,k=2,F=.1,B=.05,O=function(){function P(N,S,f,m){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=N,this.media=S,this.fragmentTracker=f,this.hls=m}var g=P.prototype;return g.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},g.poll=function(S,f){var m=this.config,d=this.media,l=this.stalled;if(d!==null){var b=d.currentTime,h=d.seeking,o=this.seeking&&!h,E=!this.seeking&&h;if(this.seeking=h,b!==S){if(this.moved=!0,l!==null){if(this.stallReported){var A=self.performance.now()-l;D.logger.warn("playback not stuck anymore @"+b+", after "+Math.round(A)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((E||o)&&(this.stalled=null),!(d.paused&&!h||d.ended||d.playbackRate===0||!R.BufferHelper.getBuffered(d).length)){var v=R.BufferHelper.bufferInfo(d,b,0),c=v.len>0,s=v.nextStart||0;if(!(!c&&!s)){if(h){var p=v.len>k,a=!s||f&&f.start<=b||s-b>k&&!this.fragmentTracker.getPartialFragment(b);if(p||a)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var T,L=Math.max(s,v.start||0)-b,I=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,H=I==null||(T=I.details)===null||T===void 0?void 0:T.live,W=H?I.details.targetduration*2:k;if(L>0&&L<=W){this._trySkipBufferHole(null);return}}var w=self.performance.now();if(l===null){this.stalled=w;return}var G=w-l;if(!(!h&&G>=K&&(this._reportStall(v),!this.media))){var Y=R.BufferHelper.bufferInfo(d,b,m.maxBufferHole);this._tryFixBufferStall(Y,G)}}}}},g._tryFixBufferStall=function(S,f){var m=this.config,d=this.fragmentTracker,l=this.media;if(l!==null){var b=l.currentTime,h=d.getPartialFragment(b);if(h){var o=this._trySkipBufferHole(h);if(o||!this.media)return}S.len>m.maxBufferHole&&f>m.highBufferWatchdogPeriod*1e3&&(D.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},g._reportStall=function(S){var f=this.hls,m=this.media,d=this.stallReported;!d&&m&&(this.stallReported=!0,D.logger.warn("Playback stalling at @"+m.currentTime+" due to low buffer ("+JSON.stringify(S)+")"),f.trigger(U.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:S.len}))},g._trySkipBufferHole=function(S){var f=this.config,m=this.hls,d=this.media;if(d===null)return 0;for(var l=d.currentTime,b=0,h=R.BufferHelper.getBuffered(d),o=0;o<h.length;o++){var E=h.start(o);if(l+f.maxBufferHole>=b&&l<E){var A=Math.max(E+B,d.currentTime+F);return D.logger.warn("skipping hole, adjusting currentTime from "+l+" to "+A),this.moved=!0,this.stalled=null,d.currentTime=A,S&&m.trigger(U.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+l+" to "+A,frag:S}),A}b=h.end(o)}return 0},g._tryNudgeBuffer=function(){var S=this.config,f=this.hls,m=this.media,d=this.nudgeRetry;if(m!==null){var l=m.currentTime;if(this.nudgeRetry++,d<S.nudgeMaxRetry){var b=l+(d+1)*S.nudgeOffset;D.logger.warn("Nudging 'currentTime' from "+l+" to "+b),m.currentTime=b,f.trigger(U.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else D.logger.error("Playhead still not moving while enough data buffered @"+l+" after "+S.nudgeMaxRetry+" nudges"),f.trigger(U.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},P}()},"./src/controller/id3-track-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>S});var R=u("./src/polyfills/number.ts"),_=u("./src/events.ts"),U=u("./src/utils/texttrack-utils.ts"),D=u("./src/demux/id3.ts"),K=u("./src/loader/date-range.ts"),k=u("./src/types/demuxer.ts"),F=.25;function B(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var O=function(){var f=B();try{new f(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function P(f,m){return f.getTime()/1e3-m}function g(f){return Uint8Array.from(f.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var N=function(){function f(d){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=d,this._registerListeners()}var m=f.prototype;return m.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},m._registerListeners=function(){var l=this.hls;l.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),l.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),l.on(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},m._unregisterListeners=function(){var l=this.hls;l.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),l.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),l.off(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},m.onMediaAttached=function(l,b){this.media=b.media},m.onMediaDetaching=function(){this.id3Track&&((0,U.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},m.onManifestLoading=function(){this.dateRangeCuesAppended={}},m.createTrack=function(l){var b=this.getID3Track(l.textTracks);return b.mode="hidden",b},m.getID3Track=function(l){if(this.media){for(var b=0;b<l.length;b++){var h=l[b];if(h.kind==="metadata"&&h.label==="id3")return(0,U.sendAddTrackEvent)(h,this.media),h}return this.media.addTextTrack("metadata","id3")}},m.onFragParsingMetadata=function(l,b){if(this.media){var h=this.hls.config,o=h.enableEmsgMetadataCues,E=h.enableID3MetadataCues;if(!(!o&&!E)){var A=b.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var v=B(),c=0;c<A.length;c++){var s=A[c].type;if(!(s===k.MetadataSchema.emsg&&!o||!E)){var p=D.getID3Frames(A[c].data);if(p){var a=A[c].pts,T=a+A[c].duration;T>O&&(T=O);var L=T-a;L<=0&&(T=a+F);for(var I=0;I<p.length;I++){var H=p[I];if(!D.isTimeStampFrame(H)){this.updateId3CueEnds(a);var W=new v(a,T,"");W.value=H,s&&(W.type=s),this.id3Track.addCue(W)}}}}}}}},m.updateId3CueEnds=function(l){var b,h=(b=this.id3Track)===null||b===void 0?void 0:b.cues;if(h)for(var o=h.length;o--;){var E=h[o];E.startTime<l&&E.endTime===O&&(E.endTime=l)}},m.onBufferFlushing=function(l,b){var h=b.startOffset,o=b.endOffset,E=b.type,A=this.id3Track,v=this.hls;if(v){var c=v.config,s=c.enableEmsgMetadataCues,p=c.enableID3MetadataCues;if(A&&(s||p)){var a;E==="audio"?a=function(L){return L.type===k.MetadataSchema.audioId3&&p}:E==="video"?a=function(L){return L.type===k.MetadataSchema.emsg&&s}:a=function(L){return L.type===k.MetadataSchema.audioId3&&p||L.type===k.MetadataSchema.emsg&&s},(0,U.removeCuesInRange)(A,h,o,a)}}},m.onLevelUpdated=function(l,b){var h=this,o=b.details;if(!(!this.media||!o.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var E=this.dateRangeCuesAppended,A=this.id3Track,v=o.dateRanges,c=Object.keys(v);if(A)for(var s=Object.keys(E).filter(function(w){return!c.includes(w)}),p=function(G){var Y=s[G];Object.keys(E[Y].cues).forEach(function(j){A.removeCue(E[Y].cues[j])}),delete E[Y]},a=s.length;a--;)p(a);var T=o.fragments[o.fragments.length-1];if(!(c.length===0||!(0,R.isFiniteNumber)(T==null?void 0:T.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var L=T.programDateTime/1e3-T.start,I=B(),H=function(G){var Y=c[G],j=v[Y],X=E[Y],q=(X==null?void 0:X.cues)||{},J=(X==null?void 0:X.durationKnown)||!1,V=P(j.startDate,L),Q=O,ee=j.endDate;if(ee)Q=P(ee,L),J=!0;else if(j.endOnNext&&!J){var Z=c.reduce(function(ue,ge){var he=v[ge];return he.class===j.class&&he.id!==ge&&he.startDate>j.startDate&&ue.push(he),ue},[]).sort(function(ue,ge){return ue.startDate.getTime()-ge.startDate.getTime()})[0];Z&&(Q=P(Z.startDate,L),J=!0)}for(var re=Object.keys(j.attr),ae=0;ae<re.length;ae++){var le=re[ae];if(!(le===K.DateRangeAttribute.ID||le===K.DateRangeAttribute.CLASS||le===K.DateRangeAttribute.START_DATE||le===K.DateRangeAttribute.DURATION||le===K.DateRangeAttribute.END_DATE||le===K.DateRangeAttribute.END_ON_NEXT)){var ne=q[le];if(ne)J&&!X.durationKnown&&(ne.endTime=Q);else{var ie=j.attr[le];ne=new I(V,Q,""),(le===K.DateRangeAttribute.SCTE35_OUT||le===K.DateRangeAttribute.SCTE35_IN)&&(ie=g(ie)),ne.value={key:le,data:ie},ne.type=k.MetadataSchema.dateRange,h.id3Track.addCue(ne),q[le]=ne}}}E[Y]={cues:q,dateRange:j,durationKnown:J}},W=0;W<c.length;W++)H(W)}}},f}();const S=N},"./src/controller/latency-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>B});var R=u("./src/errors.ts"),_=u("./src/events.ts"),U=u("./src/utils/logger.ts");function D(O,P){for(var g=0;g<P.length;g++){var N=P[g];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(O,k(N.key),N)}}function K(O,P,g){return P&&D(O.prototype,P),g&&D(O,g),Object.defineProperty(O,"prototype",{writable:!1}),O}function k(O){var P=F(O,"string");return typeof P=="symbol"?P:String(P)}function F(O,P){if(typeof O!="object"||O===null)return O;var g=O[Symbol.toPrimitive];if(g!==void 0){var N=g.call(O,P||"default");if(typeof N!="object")return N;throw new TypeError("@@toPrimitive must return a primitive value.")}return(P==="string"?String:Number)(O)}var B=function(){function O(g){var N=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return N.timeupdate()},this.hls=g,this.config=g.config,this.registerListeners()}var P=O.prototype;return P.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},P.registerListeners=function(){this.hls.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(_.Events.ERROR,this.onError,this)},P.unregisterListeners=function(){this.hls.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(_.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(_.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(_.Events.ERROR,this.onError)},P.onMediaAttached=function(N,S){this.media=S.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},P.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},P.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},P.onLevelUpdated=function(N,S){var f=S.details;this.levelDetails=f,f.advanced&&this.timeupdate(),!f.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},P.onError=function(N,S){S.details===R.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,U.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},P.timeupdate=function(){var N=this.media,S=this.levelDetails;if(!(!N||!S)){this.currentTime=N.currentTime;var f=this.computeLatency();if(f!==null){this._latency=f;var m=this.config,d=m.lowLatencyMode,l=m.maxLiveSyncPlaybackRate;if(!(!d||l===1)){var b=this.targetLatency;if(b!==null){var h=f-b,o=Math.min(this.maxLatency,b+S.targetduration),E=h<o;if(S.live&&E&&h>.05&&this.forwardBufferLength>1){var A=Math.min(2,Math.max(1,l)),v=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;N.playbackRate=Math.min(A,Math.max(1,v))}else N.playbackRate!==1&&N.playbackRate!==0&&(N.playbackRate=1)}}}}},P.estimateLiveEdge=function(){var N=this.levelDetails;return N===null?null:N.edge+N.age},P.computeLatency=function(){var N=this.estimateLiveEdge();return N===null?null:N-this.currentTime},K(O,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var N=this.config,S=this.levelDetails;return N.liveMaxLatencyDuration!==void 0?N.liveMaxLatencyDuration:S?N.liveMaxLatencyDurationCount*S.targetduration:0}},{key:"targetLatency",get:function(){var N=this.levelDetails;if(N===null)return null;var S=N.holdBack,f=N.partHoldBack,m=N.targetduration,d=this.config,l=d.liveSyncDuration,b=d.liveSyncDurationCount,h=d.lowLatencyMode,o=this.hls.userConfig,E=h&&f||S;(o.liveSyncDuration||o.liveSyncDurationCount||E===0)&&(E=l!==void 0?l:b*m);var A=m,v=1;return E+Math.min(this.stallCount*v,A)}},{key:"liveSyncPosition",get:function(){var N=this.estimateLiveEdge(),S=this.targetLatency,f=this.levelDetails;if(N===null||S===null||f===null)return null;var m=f.edge,d=N-S-this.edgeStalled,l=m-f.totalduration,b=m-(this.config.lowLatencyMode&&f.partTarget||f.targetduration);return Math.min(Math.max(l,d),b)}},{key:"drift",get:function(){var N=this.levelDetails;return N===null?1:N.drift}},{key:"edgeStalled",get:function(){var N=this.levelDetails;if(N===null)return 0;var S=(this.config.lowLatencyMode&&N.partTarget||N.targetduration)*3;return Math.max(N.age-S,0)}},{key:"forwardBufferLength",get:function(){var N=this.media,S=this.levelDetails;if(!N||!S)return 0;var f=N.buffered.length;return(f?N.buffered.end(f-1):S.edge)-this.currentTime}}]),O}()},"./src/controller/level-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>d});var R=u("./src/types/level.ts"),_=u("./src/events.ts"),U=u("./src/errors.ts"),D=u("./src/utils/codecs.ts"),K=u("./src/controller/level-helper.ts"),k=u("./src/controller/base-playlist-controller.ts"),F=u("./src/types/loader.ts");function B(){return B=Object.assign?Object.assign.bind():function(l){for(var b=1;b<arguments.length;b++){var h=arguments[b];for(var o in h)Object.prototype.hasOwnProperty.call(h,o)&&(l[o]=h[o])}return l},B.apply(this,arguments)}function O(l,b){for(var h=0;h<b.length;h++){var o=b[h];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(l,g(o.key),o)}}function P(l,b,h){return b&&O(l.prototype,b),h&&O(l,h),Object.defineProperty(l,"prototype",{writable:!1}),l}function g(l){var b=N(l,"string");return typeof b=="symbol"?b:String(b)}function N(l,b){if(typeof l!="object"||l===null)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var o=h.call(l,b||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(b==="string"?String:Number)(l)}function S(l,b){l.prototype=Object.create(b.prototype),l.prototype.constructor=l,f(l,b)}function f(l,b){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,E){return o.__proto__=E,o},f(l,b)}var m=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),d=function(l){S(b,l);function b(o){var E;return E=l.call(this,o,"[level-controller]")||this,E._levels=[],E._firstLevel=-1,E._startLevel=void 0,E.currentLevelIndex=-1,E.manualLevelIndex=-1,E.onParsedComplete=void 0,E._registerListeners(),E}var h=b.prototype;return h._registerListeners=function(){var E=this.hls;E.on(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),E.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.on(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),E.on(_.Events.FRAG_LOADED,this.onFragLoaded,this),E.on(_.Events.ERROR,this.onError,this)},h._unregisterListeners=function(){var E=this.hls;E.off(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),E.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.off(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),E.off(_.Events.FRAG_LOADED,this.onFragLoaded,this),E.off(_.Events.ERROR,this.onError,this)},h.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,l.prototype.destroy.call(this)},h.startLoad=function(){var E=this._levels;E.forEach(function(A){A.loadError=0}),l.prototype.startLoad.call(this)},h.onManifestLoaded=function(E,A){var v=[],c=[],s=[],p,a={},T,L=!1,I=!1,H=!1;if(A.levels.forEach(function(Y){var j=Y.attrs;L=L||!!(Y.width&&Y.height),I=I||!!Y.videoCodec,H=H||!!Y.audioCodec,m&&Y.audioCodec&&Y.audioCodec.indexOf("mp4a.40.34")!==-1&&(Y.audioCodec=void 0);var X=Y.bitrate+"-"+Y.attrs.RESOLUTION+"-"+Y.attrs.CODECS;T=a[X],T?T.url.push(Y.url):(T=new R.Level(Y),a[X]=T,v.push(T)),j&&(j.AUDIO&&(0,K.addGroupId)(T,"audio",j.AUDIO),j.SUBTITLES&&(0,K.addGroupId)(T,"text",j.SUBTITLES))}),(L||I)&&H&&(v=v.filter(function(Y){var j=Y.videoCodec,X=Y.width,q=Y.height;return!!j||!!(X&&q)})),v=v.filter(function(Y){var j=Y.audioCodec,X=Y.videoCodec;return(!j||(0,D.isCodecSupportedInMp4)(j,"audio"))&&(!X||(0,D.isCodecSupportedInMp4)(X,"video"))}),A.audioTracks&&(c=A.audioTracks.filter(function(Y){return!Y.audioCodec||(0,D.isCodecSupportedInMp4)(Y.audioCodec,"audio")}),(0,K.assignTrackIdsByGroup)(c)),A.subtitles&&(s=A.subtitles,(0,K.assignTrackIdsByGroup)(s)),v.length>0){p=v[0].bitrate,v.sort(function(Y,j){return Y.attrs["HDCP-LEVEL"]!==j.attrs["HDCP-LEVEL"]?(Y.attrs["HDCP-LEVEL"]||"")>(j.attrs["HDCP-LEVEL"]||"")?1:-1:Y.bitrate!==j.bitrate?Y.bitrate-j.bitrate:Y.attrs.SCORE!==j.attrs.SCORE?Y.attrs.decimalFloatingPoint("SCORE")-j.attrs.decimalFloatingPoint("SCORE"):L&&Y.height!==j.height?Y.height-j.height:0}),this._levels=v;for(var W=0;W<v.length;W++)if(v[W].bitrate===p){this._firstLevel=W,this.log("manifest loaded, "+v.length+" level(s) found, first bitrate: "+p);break}var w=H&&!I,G={levels:v,audioTracks:c,subtitleTracks:s,sessionData:A.sessionData,sessionKeys:A.sessionKeys,firstLevel:this._firstLevel,stats:A.stats,audio:H,video:I,altAudio:!w&&c.some(function(Y){return!!Y.url})};this.hls.trigger(_.Events.MANIFEST_PARSED,G),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(_.Events.ERROR,{type:U.ErrorTypes.MEDIA_ERROR,details:U.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:A.url,reason:"no level with compatible codecs found in manifest"})},h.onError=function(E,A){var v,c;if(l.prototype.onError.call(this,E,A),!A.fatal){var s=A.context,p=this._levels[this.currentLevelIndex];if(s&&(s.type===F.PlaylistContextType.AUDIO_TRACK&&p.audioGroupIds&&s.groupId===p.audioGroupIds[p.urlId]||s.type===F.PlaylistContextType.SUBTITLE_TRACK&&p.textGroupIds&&s.groupId===p.textGroupIds[p.urlId])){this.redundantFailover(this.currentLevelIndex);return}var a=!1,T=!0,L;switch(A.details){case U.ErrorDetails.FRAG_LOAD_ERROR:case U.ErrorDetails.FRAG_LOAD_TIMEOUT:case U.ErrorDetails.KEY_LOAD_ERROR:case U.ErrorDetails.KEY_LOAD_TIMEOUT:if(A.frag){var I=A.frag.type===F.PlaylistLevelType.MAIN?A.frag.level:this.currentLevelIndex,H=this._levels[I];H?(H.fragmentError++,H.fragmentError>this.hls.config.fragLoadingMaxRetry&&(L=I)):L=I}break;case U.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var W=p.attrs["HDCP-LEVEL"];W&&(this.hls.maxHdcpLevel=R.HdcpLevels[R.HdcpLevels.indexOf(W)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'))}case U.ErrorDetails.FRAG_PARSING_ERROR:case U.ErrorDetails.KEY_SYSTEM_NO_SESSION:L=((v=A.frag)===null||v===void 0?void 0:v.type)===F.PlaylistLevelType.MAIN?A.frag.level:this.currentLevelIndex,A.levelRetry=!1;break;case U.ErrorDetails.LEVEL_LOAD_ERROR:case U.ErrorDetails.LEVEL_LOAD_TIMEOUT:s&&(s.deliveryDirectives&&(T=!1),L=s.level),a=!0;break;case U.ErrorDetails.REMUX_ALLOC_ERROR:L=(c=A.level)!=null?c:this.currentLevelIndex,a=!0;break}L!==void 0&&this.recoverLevel(A,L,a,T)}},h.recoverLevel=function(E,A,v,c){var s=E.details,p=this._levels[A];if(p.loadError++,v){var a=this.retryLoadingOrFail(E);if(a)E.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(c){var T=p.url.length;if(T>1&&p.loadError<T)E.levelRetry=!0,this.redundantFailover(A);else if(this.manualLevelIndex===-1){for(var L=-1,I=this._levels,H=I.length;H--;){var W=(H+this.currentLevelIndex)%I.length;if(W!==this.currentLevelIndex&&I[W].loadError===0){L=W;break}}L>-1&&this.currentLevelIndex!==L?(this.warn(s+": switch to "+L),E.levelRetry=!0,this.hls.nextAutoLevel=L):E.levelRetry===!1&&(E.fatal=!0)}}},h.redundantFailover=function(E){var A=this._levels[E],v=A.url.length;if(v>1){var c=(A.urlId+1)%v;this.warn("Switching to redundant URL-id "+c),this._levels.forEach(function(s){s.urlId=c}),this.level=E}},h.onFragLoaded=function(E,A){var v=A.frag;if(v!==void 0&&v.type===F.PlaylistLevelType.MAIN){var c=this._levels[v.level];c!==void 0&&(c.fragmentError=0,c.loadError=0)}},h.onLevelLoaded=function(E,A){var v,c=A.level,s=A.details,p=this._levels[c];if(!p){var a;this.warn("Invalid level index "+c),(a=A.deliveryDirectives)!==null&&a!==void 0&&a.skip&&(s.deltaUpdateFailed=!0);return}c===this.currentLevelIndex?(p.fragmentError===0&&(p.loadError=0,this.retryCount=0),this.playlistLoaded(c,A,p.details)):(v=A.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(s.deltaUpdateFailed=!0)},h.onAudioTrackSwitched=function(E,A){var v=this.hls.levels[this.currentLevelIndex];if(v&&v.audioGroupIds){for(var c=-1,s=this.hls.audioTracks[A.id].groupId,p=0;p<v.audioGroupIds.length;p++)if(v.audioGroupIds[p]===s){c=p;break}c!==v.urlId&&(v.urlId=c,this.startLoad())}},h.loadPlaylist=function(E){l.prototype.loadPlaylist.call(this);var A=this.currentLevelIndex,v=this._levels[A];if(this.canLoad&&v&&v.url.length>0){var c=v.urlId,s=v.url[c];if(E)try{s=E.addDirectives(s)}catch(p){this.warn("Could not construct new URL with HLS Delivery Directives: "+p)}this.log("Attempt loading level index "+A+(E?" at sn "+E.msn+" part "+E.part:"")+" with URL-id "+c+" "+s),this.clearTimer(),this.hls.trigger(_.Events.LEVEL_LOADING,{url:s,level:A,id:c,deliveryDirectives:E||null})}},h.removeLevel=function(E,A){var v=function(p,a){return a!==A},c=this._levels.filter(function(s,p){return p!==E?!0:s.url.length>1&&A!==void 0?(s.url=s.url.filter(v),s.audioGroupIds&&(s.audioGroupIds=s.audioGroupIds.filter(v)),s.textGroupIds&&(s.textGroupIds=s.textGroupIds.filter(v)),s.urlId=0,!0):!1}).map(function(s,p){var a=s.details;return a!=null&&a.fragments&&a.fragments.forEach(function(T){T.level=p}),s});this._levels=c,this.hls.trigger(_.Events.LEVELS_UPDATED,{levels:c})},P(b,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(E){var A,v=this._levels;if(v.length!==0&&!(this.currentLevelIndex===E&&(A=v[E])!==null&&A!==void 0&&A.details)){if(E<0||E>=v.length){var c=E<0;if(this.hls.trigger(_.Events.ERROR,{type:U.ErrorTypes.OTHER_ERROR,details:U.ErrorDetails.LEVEL_SWITCH_ERROR,level:E,fatal:c,reason:"invalid level idx"}),c)return;E=Math.min(E,v.length-1)}this.clearTimer();var s=this.currentLevelIndex,p=v[s],a=v[E];this.log("switching to level "+E+" from "+s),this.currentLevelIndex=E;var T=B({},a,{level:E,maxBitrate:a.maxBitrate,uri:a.uri,urlId:a.urlId});delete T._urlId,this.hls.trigger(_.Events.LEVEL_SWITCHING,T);var L=a.details;if(!L||L.live){var I=this.switchParams(a.uri,p==null?void 0:p.details);this.loadPlaylist(I)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(E){this.manualLevelIndex=E,this._startLevel===void 0&&(this._startLevel=E),E!==-1&&(this.level=E)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(E){this._firstLevel=E}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var E=this.hls.config.startLevel;return E!==void 0?E:this._firstLevel}else return this._startLevel},set:function(E){this._startLevel=E}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(E){this.level=E,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=E)}}]),b}(k.default)},"./src/controller/level-helper.ts":(M,C,u)=>{u.r(C),u.d(C,{addGroupId:()=>K,addSliding:()=>m,adjustSliding:()=>f,assignTrackIdsByGroup:()=>k,computeReloadInterval:()=>d,getFragmentWithSN:()=>l,getPartWith:()=>b,mapFragmentIntersection:()=>S,mapPartIntersection:()=>N,mergeDetails:()=>P,updateFragPTSDTS:()=>O,updatePTS:()=>F});var R=u("./src/polyfills/number.ts"),_=u("./src/utils/logger.ts"),U=u("./src/loader/date-range.ts");function D(){return D=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var E=arguments[o];for(var A in E)Object.prototype.hasOwnProperty.call(E,A)&&(h[A]=E[A])}return h},D.apply(this,arguments)}function K(h,o,E){switch(o){case"audio":h.audioGroupIds||(h.audioGroupIds=[]),h.audioGroupIds.push(E);break;case"text":h.textGroupIds||(h.textGroupIds=[]),h.textGroupIds.push(E);break}}function k(h){var o={};h.forEach(function(E){var A=E.groupId||"";E.id=o[A]=o[A]||0,o[A]++})}function F(h,o,E){var A=h[o],v=h[E];B(A,v)}function B(h,o){var E=o.startPTS;if((0,R.isFiniteNumber)(E)){var A=0,v;o.sn>h.sn?(A=E-h.start,v=h):(A=h.start-E,v=o),v.duration!==A&&(v.duration=A)}else if(o.sn>h.sn){var c=h.cc===o.cc;c&&h.minEndPTS?o.start=h.start+(h.minEndPTS-h.start):o.start=h.start+h.duration}else o.start=Math.max(h.start-o.duration,0)}function O(h,o,E,A,v,c){var s=A-E;s<=0&&(_.logger.warn("Fragment should have a positive duration",o),A=E+o.duration,c=v+o.duration);var p=E,a=A,T=o.startPTS,L=o.endPTS;if((0,R.isFiniteNumber)(T)){var I=Math.abs(T-E);(0,R.isFiniteNumber)(o.deltaPTS)?o.deltaPTS=Math.max(I,o.deltaPTS):o.deltaPTS=I,p=Math.max(E,T),E=Math.min(E,T),v=Math.min(v,o.startDTS),a=Math.min(A,L),A=Math.max(A,L),c=Math.max(c,o.endDTS)}o.duration=A-E;var H=E-o.start;o.start=o.startPTS=E,o.maxStartPTS=p,o.startDTS=v,o.endPTS=A,o.minEndPTS=a,o.endDTS=c;var W=o.sn;if(!h||W<h.startSN||W>h.endSN)return 0;var w,G=W-h.startSN,Y=h.fragments;for(Y[G]=o,w=G;w>0;w--)B(Y[w],Y[w-1]);for(w=G;w<Y.length-1;w++)B(Y[w],Y[w+1]);return h.fragmentHint&&B(Y[Y.length-1],h.fragmentHint),h.PTSKnown=h.alignedSliding=!0,H}function P(h,o){for(var E=null,A=h.fragments,v=A.length-1;v>=0;v--){var c=A[v].initSegment;if(c){E=c;break}}h.fragmentHint&&delete h.fragmentHint.endPTS;var s=0,p;if(S(h,o,function(w,G){w.relurl&&(s=w.cc-G.cc),(0,R.isFiniteNumber)(w.startPTS)&&(0,R.isFiniteNumber)(w.endPTS)&&(G.start=G.startPTS=w.startPTS,G.startDTS=w.startDTS,G.appendedPTS=w.appendedPTS,G.maxStartPTS=w.maxStartPTS,G.endPTS=w.endPTS,G.endDTS=w.endDTS,G.minEndPTS=w.minEndPTS,G.duration=w.endPTS-w.startPTS,G.duration&&(p=G),o.PTSKnown=o.alignedSliding=!0),G.elementaryStreams=w.elementaryStreams,G.loader=w.loader,G.stats=w.stats,G.urlId=w.urlId,w.initSegment&&(G.initSegment=w.initSegment,E=w.initSegment)}),E){var a=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments;a.forEach(function(w){var G;(!w.initSegment||w.initSegment.relurl===((G=E)===null||G===void 0?void 0:G.relurl))&&(w.initSegment=E)})}if(o.skippedSegments)if(o.deltaUpdateFailed=o.fragments.some(function(w){return!w}),o.deltaUpdateFailed){_.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var T=o.skippedSegments;T--;)o.fragments.shift();o.startSN=o.fragments[0].sn,o.startCC=o.fragments[0].cc}else o.canSkipDateRanges&&(o.dateRanges=g(h.dateRanges,o.dateRanges,o.recentlyRemovedDateranges));var L=o.fragments;if(s){_.logger.warn("discontinuity sliding from playlist, take drift into account");for(var I=0;I<L.length;I++)L[I].cc+=s}o.skippedSegments&&(o.startCC=o.fragments[0].cc),N(h.partList,o.partList,function(w,G){G.elementaryStreams=w.elementaryStreams,G.stats=w.stats}),p?O(o,p,p.startPTS,p.endPTS,p.startDTS,p.endDTS):f(h,o),L.length&&(o.totalduration=o.edge-L[0].start),o.driftStartTime=h.driftStartTime,o.driftStart=h.driftStart;var H=o.advancedDateTime;if(o.advanced&&H){var W=o.edge;o.driftStart||(o.driftStartTime=H,o.driftStart=W),o.driftEndTime=H,o.driftEnd=W}else o.driftEndTime=h.driftEndTime,o.driftEnd=h.driftEnd,o.advancedDateTime=h.advancedDateTime}function g(h,o,E){var A=D({},h);return E&&E.forEach(function(v){delete A[v]}),Object.keys(o).forEach(function(v){var c=new U.DateRange(o[v].attr,A[v]);c.isValid?A[v]=c:_.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(o[v].attr)+'"')}),A}function N(h,o,E){if(h&&o)for(var A=0,v=0,c=h.length;v<=c;v++){var s=h[v],p=o[v+A];s&&p&&s.index===p.index&&s.fragment.sn===p.fragment.sn?E(s,p):A--}}function S(h,o,E){for(var A=o.skippedSegments,v=Math.max(h.startSN,o.startSN)-o.startSN,c=(h.fragmentHint?1:0)+(A?o.endSN:Math.min(h.endSN,o.endSN))-o.startSN,s=o.startSN-h.startSN,p=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments,a=h.fragmentHint?h.fragments.concat(h.fragmentHint):h.fragments,T=v;T<=c;T++){var L=a[s+T],I=p[T];A&&!I&&T<A&&(I=o.fragments[T]=L),L&&I&&E(L,I)}}function f(h,o){var E=o.startSN+o.skippedSegments-h.startSN,A=h.fragments;E<0||E>=A.length||m(o,A[E].start)}function m(h,o){if(o){for(var E=h.fragments,A=h.skippedSegments;A<E.length;A++)E[A].start+=o;h.fragmentHint&&(h.fragmentHint.start+=o)}}function d(h,o){o===void 0&&(o=1/0);var E=1e3*h.targetduration;if(h.updated){var A=h.fragments,v=4;if(A.length&&E*v>o){var c=A[A.length-1].duration*1e3;c<E&&(E=c)}}else E/=2;return Math.round(E)}function l(h,o,E){if(!h||!h.details)return null;var A=h.details,v=A.fragments[o-A.startSN];return v||(v=A.fragmentHint,v&&v.sn===o)?v:o<A.startSN&&E&&E.sn===o?E:null}function b(h,o,E){if(!h||!h.details)return null;var A=h.details.partList;if(A)for(var v=A.length;v--;){var c=A[v];if(c.index===E&&c.fragment.sn===o)return c}return null}},"./src/controller/stream-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>o});var R=u("./src/polyfills/number.ts"),_=u("./src/controller/base-stream-controller.ts"),U=u("./src/is-supported.ts"),D=u("./src/events.ts"),K=u("./src/utils/buffer-helper.ts"),k=u("./src/controller/fragment-tracker.ts"),F=u("./src/types/loader.ts"),B=u("./src/loader/fragment.ts"),O=u("./src/demux/transmuxer-interface.ts"),P=u("./src/types/transmuxer.ts"),g=u("./src/controller/gap-controller.ts"),N=u("./src/errors.ts");function S(E,A){for(var v=0;v<A.length;v++){var c=A[v];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(E,m(c.key),c)}}function f(E,A,v){return A&&S(E.prototype,A),v&&S(E,v),Object.defineProperty(E,"prototype",{writable:!1}),E}function m(E){var A=d(E,"string");return typeof A=="symbol"?A:String(A)}function d(E,A){if(typeof E!="object"||E===null)return E;var v=E[Symbol.toPrimitive];if(v!==void 0){var c=v.call(E,A||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(A==="string"?String:Number)(E)}function l(E,A){E.prototype=Object.create(A.prototype),E.prototype.constructor=E,b(E,A)}function b(E,A){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,s){return c.__proto__=s,c},b(E,A)}var h=100,o=function(E){l(A,E);function A(c,s,p){var a;return a=E.call(this,c,s,p,"[stream-controller]")||this,a.audioCodecSwap=!1,a.gapController=null,a.level=-1,a._forceStartLoad=!1,a.altAudio=!1,a.audioOnly=!1,a.fragPlaying=null,a.onvplaying=null,a.onvseeked=null,a.fragLastKbps=0,a.couldBacktrack=!1,a.backtrackFragment=null,a.audioCodecSwitch=!1,a.videoBuffer=null,a._registerListeners(),a}var v=A.prototype;return v._registerListeners=function(){var s=this.hls;s.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),s.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),s.on(D.Events.ERROR,this.onError,this),s.on(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(D.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(D.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var s=this.hls;s.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),s.off(D.Events.ERROR,this.onError,this),s.off(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(D.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(D.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},v.startLoad=function(s){if(this.levels){var p=this.lastCurrentTime,a=this.hls;if(this.stopLoad(),this.setInterval(h),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var T=a.startLevel;T===-1&&(a.config.testBandwidth&&this.levels.length>1?(T=0,this.bitrateTest=!0):T=a.nextAutoLevel),this.level=a.nextLoadLevel=T,this.loadedmetadata=!1}p>0&&s===-1&&(this.log("Override startPosition with lastCurrentTime @"+p.toFixed(3)),s=p),this.state=_.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()}else this._forceStartLoad=!0,this.state=_.State.STOPPED},v.stopLoad=function(){this._forceStartLoad=!1,E.prototype.stopLoad.call(this)},v.doTick=function(){switch(this.state){case _.State.IDLE:this.doTickIdle();break;case _.State.WAITING_LEVEL:{var s,p=this.levels,a=this.level,T=p==null||(s=p[a])===null||s===void 0?void 0:s.details;if(T&&(!T.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(T))break;this.state=_.State.IDLE;break}break}case _.State.FRAG_LOADING_WAITING_RETRY:{var L,I=self.performance.now(),H=this.retryDate;(!H||I>=H||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=_.State.IDLE)}break}this.onTickEnd()},v.onTickEnd=function(){E.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},v.doTickIdle=function(){var s=this.hls,p=this.levelLastLoaded,a=this.levels,T=this.media,L=s.config,I=s.nextLoadLevel;if(!(p===null||!T&&(this.startFragRequested||!L.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!a||!a[I])){var H=a[I],W=this.getMainFwdBufferInfo();if(W!==null){var w=this.getLevelDetails();if(w&&this._streamEnded(W,w)){var G={};this.altAudio&&(G.type="video"),this.hls.trigger(D.Events.BUFFER_EOS,G),this.state=_.State.ENDED;return}this.level=s.nextLoadLevel=I;var Y=H.details;if(!Y||this.state===_.State.WAITING_LEVEL||Y.live&&this.levelLastLoaded!==I){this.level=I,this.state=_.State.WAITING_LEVEL;return}var j=W.len,X=this.getMaxBufferLength(H.maxBitrate);if(!(j>=X)){this.backtrackFragment&&this.backtrackFragment.start>W.end&&(this.backtrackFragment=null);var q=this.backtrackFragment?this.backtrackFragment.start:W.end,J=this.getNextFragment(q,Y);if(this.couldBacktrack&&!this.fragPrevious&&J&&J.sn!=="initSegment"&&this.fragmentTracker.getState(J)!==k.FragmentState.OK){var V,Q=((V=this.backtrackFragment)!=null?V:J).sn,ee=Q-Y.startSN,Z=Y.fragments[ee-1];Z&&J.cc===Z.cc&&(J=Z,this.fragmentTracker.removeFragment(Z))}else this.backtrackFragment&&W.len&&(this.backtrackFragment=null);if(J&&this.fragmentTracker.getState(J)===k.FragmentState.OK&&this.nextLoadPosition>q){var re=this.audioOnly&&!this.altAudio?B.ElementaryStreamTypes.AUDIO:B.ElementaryStreamTypes.VIDEO,ae=(re===B.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;ae&&this.afterBufferFlushed(ae,re,F.PlaylistLevelType.MAIN),J=this.getNextFragment(this.nextLoadPosition,Y)}J&&(J.initSegment&&!J.initSegment.data&&!this.bitrateTest&&(J=J.initSegment),this.loadFragment(J,Y,q))}}}},v.loadFragment=function(s,p,a){var T,L=this.fragmentTracker.getState(s);this.fragCurrent=s,L===k.FragmentState.NOT_LOADED?s.sn==="initSegment"?this._loadInitSegment(s,p):this.bitrateTest?(this.log("Fragment "+s.sn+" of level "+s.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(s,p)):(this.startFragRequested=!0,E.prototype.loadFragment.call(this,s,p,a)):L===k.FragmentState.APPENDING?this.reduceMaxBufferLength(s.duration)&&this.fragmentTracker.removeFragment(s):((T=this.media)===null||T===void 0?void 0:T.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},v.getAppendedFrag=function(s){var p=this.fragmentTracker.getAppendedFrag(s,F.PlaylistLevelType.MAIN);return p&&"fragment"in p?p.fragment:p},v.getBufferedFrag=function(s){return this.fragmentTracker.getBufferedFrag(s,F.PlaylistLevelType.MAIN)},v.followingBufferedFrag=function(s){return s?this.getBufferedFrag(s.end+.5):null},v.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},v.nextLevelSwitch=function(){var s=this.levels,p=this.media;if(p!=null&&p.readyState){var a,T=this.getAppendedFrag(p.currentTime);if(T&&T.start>1&&this.flushMainBuffer(0,T.start-1),!p.paused&&s){var L=this.hls.nextLoadLevel,I=s[L],H=this.fragLastKbps;H&&this.fragCurrent?a=this.fragCurrent.duration*I.maxBitrate/(1e3*H)+1:a=0}else a=0;var W=this.getBufferedFrag(p.currentTime+a);if(W){var w=this.followingBufferedFrag(W);if(w){this.abortCurrentFrag();var G=w.maxStartPTS?w.maxStartPTS:w.start,Y=w.duration,j=Math.max(W.end,G+Math.min(Math.max(Y-this.config.maxFragLookUpTolerance,Y*.5),Y*.75));this.flushMainBuffer(j,Number.POSITIVE_INFINITY)}}}},v.abortCurrentFrag=function(){var s=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,s&&s.abortRequests(),this.state){case _.State.KEY_LOADING:case _.State.FRAG_LOADING:case _.State.FRAG_LOADING_WAITING_RETRY:case _.State.PARSING:case _.State.PARSED:this.state=_.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},v.flushMainBuffer=function(s,p){E.prototype.flushMainBuffer.call(this,s,p,this.altAudio?"video":null)},v.onMediaAttached=function(s,p){E.prototype.onMediaAttached.call(this,s,p);var a=p.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),a.addEventListener("playing",this.onvplaying),a.addEventListener("seeked",this.onvseeked),this.gapController=new g.default(this.config,a,this.fragmentTracker,this.hls)},v.onMediaDetaching=function(){var s=this.media;s&&this.onvplaying&&this.onvseeked&&(s.removeEventListener("playing",this.onvplaying),s.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),E.prototype.onMediaDetaching.call(this)},v.onMediaPlaying=function(){this.tick()},v.onMediaSeeked=function(){var s=this.media,p=s?s.currentTime:null;(0,R.isFiniteNumber)(p)&&this.log("Media seeked to "+p.toFixed(3)),this.tick()},v.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(D.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},v.onManifestParsed=function(s,p){var a=!1,T=!1,L;p.levels.forEach(function(I){L=I.audioCodec,L&&(L.indexOf("mp4a.40.2")!==-1&&(a=!0),L.indexOf("mp4a.40.5")!==-1&&(T=!0))}),this.audioCodecSwitch=a&&T&&!(0,U.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=p.levels,this.startFragRequested=!1},v.onLevelLoading=function(s,p){var a=this.levels;if(!(!a||this.state!==_.State.IDLE)){var T=a[p.level];(!T.details||T.details.live&&this.levelLastLoaded!==p.level||this.waitForCdnTuneIn(T.details))&&(this.state=_.State.WAITING_LEVEL)}},v.onLevelLoaded=function(s,p){var a,T=this.levels,L=p.level,I=p.details,H=I.totalduration;if(!T){this.warn("Levels were reset while loading level "+L);return}this.log("Level "+L+" loaded ["+I.startSN+","+I.endSN+"], cc ["+I.startCC+", "+I.endCC+"] duration:"+H);var W=this.fragCurrent;W&&(this.state===_.State.FRAG_LOADING||this.state===_.State.FRAG_LOADING_WAITING_RETRY)&&W.level!==p.level&&W.loader&&(this.state=_.State.IDLE,this.backtrackFragment=null,W.abortRequests());var w=T[L],G=0;if(I.live||(a=w.details)!==null&&a!==void 0&&a.live){if(I.fragments[0]||(I.deltaUpdateFailed=!0),I.deltaUpdateFailed)return;G=this.alignPlaylists(I,w.details)}if(w.details=I,this.levelLastLoaded=L,this.hls.trigger(D.Events.LEVEL_UPDATED,{details:I,level:L}),this.state===_.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(I))return;this.state=_.State.IDLE}this.startFragRequested?I.live&&this.synchronizeToLiveEdge(I):this.setStartPosition(I,G),this.tick()},v._handleFragmentLoadProgress=function(s){var p,a=s.frag,T=s.part,L=s.payload,I=this.levels;if(!I){this.warn("Levels were reset while fragment load was in progress. Fragment "+a.sn+" of level "+a.level+" will not be buffered");return}var H=I[a.level],W=H.details;if(!W){this.warn("Dropping fragment "+a.sn+" of level "+a.level+" after level details were reset");return}var w=H.videoCodec,G=W.PTSKnown||!W.live,Y=(p=a.initSegment)===null||p===void 0?void 0:p.data,j=this._getAudioCodec(H),X=this.transmuxer=this.transmuxer||new O.default(this.hls,F.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),q=T?T.index:-1,J=q!==-1,V=new P.ChunkMetadata(a.level,a.sn,a.stats.chunkCount,L.byteLength,q,J),Q=this.initPTS[a.cc];X.push(L,Y,j,w,a,T,W.totalduration,G,V,Q)},v.onAudioTrackSwitching=function(s,p){var a=this.altAudio,T=!!p.url,L=p.id;if(!T){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var I=this.fragCurrent;I&&(this.log("Switching to main audio track, cancel main fragment load"),I.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var H=this.hls;a&&H.trigger(D.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),H.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:L})}},v.onAudioTrackSwitched=function(s,p){var a=p.id,T=!!this.hls.audioTracks[a].url;if(T){var L=this.videoBuffer;L&&this.mediaBuffer!==L&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=L)}this.altAudio=T,this.tick()},v.onBufferCreated=function(s,p){var a=p.tracks,T,L,I=!1;for(var H in a){var W=a[H];if(W.id==="main"){if(L=H,T=W,H==="video"){var w=a[H];w&&(this.videoBuffer=w.buffer)}}else I=!0}I&&T?(this.log("Alternate track found, use "+L+".buffered to schedule main fragment loading"),this.mediaBuffer=T.buffer):this.mediaBuffer=this.media},v.onFragBuffered=function(s,p){var a=p.frag,T=p.part;if(!(a&&a.type!==F.PlaylistLevelType.MAIN)){if(this.fragContextChanged(a)){this.warn("Fragment "+a.sn+(T?" p: "+T.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state),this.state===_.State.PARSED&&(this.state=_.State.IDLE);return}var L=T?T.stats:a.stats;this.fragLastKbps=Math.round(8*L.total/(L.buffering.end-L.loading.first)),a.sn!=="initSegment"&&(this.fragPrevious=a),this.fragBufferedComplete(a,T)}},v.onError=function(s,p){if(p.type===N.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(F.PlaylistLevelType.MAIN,p);return}switch(p.details){case N.ErrorDetails.FRAG_LOAD_ERROR:case N.ErrorDetails.FRAG_LOAD_TIMEOUT:case N.ErrorDetails.FRAG_PARSING_ERROR:case N.ErrorDetails.KEY_LOAD_ERROR:case N.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(F.PlaylistLevelType.MAIN,p);break;case N.ErrorDetails.LEVEL_LOAD_ERROR:case N.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==_.State.ERROR&&(p.fatal?(this.warn(""+p.details),this.state=_.State.ERROR):!p.levelRetry&&this.state===_.State.WAITING_LEVEL&&(this.state=_.State.IDLE));break;case N.ErrorDetails.BUFFER_FULL_ERROR:if(p.parent==="main"&&(this.state===_.State.PARSING||this.state===_.State.PARSED)){var a=!0,T=this.getFwdBufferInfo(this.media,F.PlaylistLevelType.MAIN);T&&T.len>.5&&(a=!this.reduceMaxBufferLength(T.len)),a&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},v.checkBuffer=function(){var s=this.media,p=this.gapController;if(!(!s||!p||!s.readyState)){if(this.loadedmetadata||!K.BufferHelper.getBuffered(s).length){var a=this.state!==_.State.IDLE?this.fragCurrent:null;p.poll(this.lastCurrentTime,a)}this.lastCurrentTime=s.currentTime}},v.onFragLoadEmergencyAborted=function(){this.state=_.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},v.onBufferFlushed=function(s,p){var a=p.type;if(a!==B.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var T=(a===B.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(T,a,F.PlaylistLevelType.MAIN)}},v.onLevelsUpdated=function(s,p){this.levels=p.levels},v.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},v.seekToStartPos=function(){var s=this.media;if(s){var p=s.currentTime,a=this.startPosition;if(a>=0&&p<a){if(s.seeking){this.log("could not seek to "+a+", already seeking at "+p);return}var T=K.BufferHelper.getBuffered(s),L=T.length?T.start(0):0,I=L-a;I>0&&(I<this.config.maxBufferHole||I<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+I+" to match buffer start"),a+=I,this.startPosition=a),this.log("seek to target start position "+a+" from current time "+p),s.currentTime=a}}},v._getAudioCodec=function(s){var p=this.config.defaultAudioCodec||s.audioCodec;return this.audioCodecSwap&&p&&(this.log("Swapping audio codec"),p.indexOf("mp4a.40.5")!==-1?p="mp4a.40.2":p="mp4a.40.5"),p},v._loadBitrateTestFrag=function(s,p){var a=this;s.bitrateTest=!0,this._doFragLoad(s,p).then(function(T){var L=a.hls;if(!(!T||L.nextLoadLevel||a.fragContextChanged(s))){a.fragLoadError=0,a.state=_.State.IDLE,a.startFragRequested=!1,a.bitrateTest=!1;var I=s.stats;I.parsing.start=I.parsing.end=I.buffering.start=I.buffering.end=self.performance.now(),L.trigger(D.Events.FRAG_LOADED,T),s.bitrateTest=!1}})},v._handleTransmuxComplete=function(s){var p,a="main",T=this.hls,L=s.remuxResult,I=s.chunkMeta,H=this.getCurrentContext(I);if(!H){this.warn("The loading context changed while buffering fragment "+I.sn+" of level "+I.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(I.level);return}var W=H.frag,w=H.part,G=H.level,Y=L.video,j=L.text,X=L.id3,q=L.initSegment,J=G.details,V=this.altAudio?void 0:L.audio;if(!this.fragContextChanged(W)){if(this.state=_.State.PARSING,q){q.tracks&&(this._bufferInitSegment(G,q.tracks,W,I),T.trigger(D.Events.FRAG_PARSING_INIT_SEGMENT,{frag:W,id:a,tracks:q.tracks}));var Q=q.initPTS,ee=q.timescale;(0,R.isFiniteNumber)(Q)&&(this.initPTS[W.cc]=Q,T.trigger(D.Events.INIT_PTS_FOUND,{frag:W,id:a,initPTS:Q,timescale:ee}))}if(Y&&L.independent!==!1){if(J){var Z=Y.startPTS,re=Y.endPTS,ae=Y.startDTS,le=Y.endDTS;if(w)w.elementaryStreams[Y.type]={startPTS:Z,endPTS:re,startDTS:ae,endDTS:le};else if(Y.firstKeyFrame&&Y.independent&&I.id===1&&(this.couldBacktrack=!0),Y.dropped&&Y.independent){var ne=this.getMainFwdBufferInfo(),ie=(ne?ne.end:this.getLoadPosition())+this.config.maxBufferHole,ue=Y.firstKeyFramePTS?Y.firstKeyFramePTS:Z;if(ie<ue-this.config.maxBufferHole){this.backtrack(W);return}W.setElementaryStreamInfo(Y.type,W.start,re,W.start,le,!0)}W.setElementaryStreamInfo(Y.type,Z,re,ae,le),this.backtrackFragment&&(this.backtrackFragment=W),this.bufferFragmentData(Y,W,w,I)}}else if(L.independent===!1){this.backtrack(W);return}if(V){var ge=V.startPTS,he=V.endPTS,Ee=V.startDTS,me=V.endDTS;w&&(w.elementaryStreams[B.ElementaryStreamTypes.AUDIO]={startPTS:ge,endPTS:he,startDTS:Ee,endDTS:me}),W.setElementaryStreamInfo(B.ElementaryStreamTypes.AUDIO,ge,he,Ee,me),this.bufferFragmentData(V,W,w,I)}if(J&&X!==null&&X!==void 0&&(p=X.samples)!==null&&p!==void 0&&p.length){var pe={id:a,frag:W,details:J,samples:X.samples};T.trigger(D.Events.FRAG_PARSING_METADATA,pe)}if(J&&j){var Te={id:a,frag:W,details:J,samples:j.samples};T.trigger(D.Events.FRAG_PARSING_USERDATA,Te)}}},v._bufferInitSegment=function(s,p,a,T){var L=this;if(this.state===_.State.PARSING){this.audioOnly=!!p.audio&&!p.video,this.altAudio&&!this.audioOnly&&delete p.audio;var I=p.audio,H=p.video,W=p.audiovideo;if(I){var w=s.audioCodec,G=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(w&&(w.indexOf("mp4a.40.5")!==-1?w="mp4a.40.2":w="mp4a.40.5"),I.metadata.channelCount!==1&&G.indexOf("firefox")===-1&&(w="mp4a.40.5")),G.indexOf("android")!==-1&&I.container!=="audio/mpeg"&&(w="mp4a.40.2",this.log("Android: force audio codec to "+w)),s.audioCodec&&s.audioCodec!==w&&this.log('Swapping manifest audio codec "'+s.audioCodec+'" for "'+w+'"'),I.levelCodec=w,I.id="main",this.log("Init audio buffer, container:"+I.container+", codecs[selected/level/parsed]=["+(w||"")+"/"+(s.audioCodec||"")+"/"+I.codec+"]")}H&&(H.levelCodec=s.videoCodec,H.id="main",this.log("Init video buffer, container:"+H.container+", codecs[level/parsed]=["+(s.videoCodec||"")+"/"+H.codec+"]")),W&&this.log("Init audiovideo buffer, container:"+W.container+", codecs[level/parsed]=["+(s.attrs.CODECS||"")+"/"+W.codec+"]"),this.hls.trigger(D.Events.BUFFER_CODECS,p),Object.keys(p).forEach(function(Y){var j=p[Y],X=j.initSegment;X!=null&&X.byteLength&&L.hls.trigger(D.Events.BUFFER_APPENDING,{type:Y,data:X,frag:a,part:null,chunkMeta:T,parent:a.type})}),this.tick()}},v.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,F.PlaylistLevelType.MAIN)},v.backtrack=function(s){this.couldBacktrack=!0,this.backtrackFragment=s,this.resetTransmuxer(),this.flushBufferGap(s),this.fragmentTracker.removeFragment(s),this.fragPrevious=null,this.nextLoadPosition=s.start,this.state=_.State.IDLE},v.checkFragmentChanged=function(){var s=this.media,p=null;if(s&&s.readyState>1&&s.seeking===!1){var a=s.currentTime;if(K.BufferHelper.isBuffered(s,a)?p=this.getAppendedFrag(a):K.BufferHelper.isBuffered(s,a+.1)&&(p=this.getAppendedFrag(a+.1)),p){this.backtrackFragment=null;var T=this.fragPlaying,L=p.level;(!T||p.sn!==T.sn||T.level!==L||p.urlId!==T.urlId)&&(this.fragPlaying=p,this.hls.trigger(D.Events.FRAG_CHANGED,{frag:p}),(!T||T.level!==L)&&this.hls.trigger(D.Events.LEVEL_SWITCHED,{level:L}))}}},f(A,[{key:"nextLevel",get:function(){var s=this.nextBufferedFrag;return s?s.level:-1}},{key:"currentFrag",get:function(){var s=this.media;return s?this.fragPlaying||this.getAppendedFrag(s.currentTime):null}},{key:"currentProgramDateTime",get:function(){var s=this.media;if(s){var p=s.currentTime,a=this.currentFrag;if(a&&(0,R.isFiniteNumber)(p)&&(0,R.isFiniteNumber)(a.programDateTime)){var T=a.programDateTime+(p-a.start)*1e3;return new Date(T)}}return null}},{key:"currentLevel",get:function(){var s=this.currentFrag;return s?s.level:-1}},{key:"nextBufferedFrag",get:function(){var s=this.currentFrag;return s?this.followingBufferedFrag(s):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),A}(_.default)},"./src/controller/subtitle-stream-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{SubtitleStreamController:()=>l});var R=u("./src/events.ts"),_=u("./src/utils/buffer-helper.ts"),U=u("./src/controller/fragment-finders.ts"),D=u("./src/utils/discontinuities.ts"),K=u("./src/controller/level-helper.ts"),k=u("./src/controller/fragment-tracker.ts"),F=u("./src/controller/base-stream-controller.ts"),B=u("./src/types/loader.ts"),O=u("./src/types/level.ts");function P(h,o){for(var E=0;E<o.length;E++){var A=o[E];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(h,N(A.key),A)}}function g(h,o,E){return o&&P(h.prototype,o),E&&P(h,E),Object.defineProperty(h,"prototype",{writable:!1}),h}function N(h){var o=S(h,"string");return typeof o=="symbol"?o:String(o)}function S(h,o){if(typeof h!="object"||h===null)return h;var E=h[Symbol.toPrimitive];if(E!==void 0){var A=E.call(h,o||"default");if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(h)}function f(h,o){h.prototype=Object.create(o.prototype),h.prototype.constructor=h,m(h,o)}function m(h,o){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(A,v){return A.__proto__=v,A},m(h,o)}var d=500,l=function(h){f(o,h);function o(A,v,c){var s;return s=h.call(this,A,v,c,"[subtitle-stream-controller]")||this,s.levels=[],s.currentTrackId=-1,s.tracksBuffered=[],s.mainDetails=null,s._registerListeners(),s}var E=o.prototype;return E.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},E._registerListeners=function(){var v=this.hls;v.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(R.Events.ERROR,this.onError,this),v.on(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.on(R.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.on(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.on(R.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),v.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},E._unregisterListeners=function(){var v=this.hls;v.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(R.Events.ERROR,this.onError,this),v.off(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.off(R.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.off(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.off(R.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),v.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},E.startLoad=function(v){this.stopLoad(),this.state=F.State.IDLE,this.setInterval(d),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=v,this.tick()},E.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},E.onLevelLoaded=function(v,c){this.mainDetails=c.details},E.onSubtitleFragProcessed=function(v,c){var s=c.frag,p=c.success;if(this.fragPrevious=s,this.state=F.State.IDLE,!!p){var a=this.tracksBuffered[this.currentTrackId];if(a){for(var T,L=s.start,I=0;I<a.length;I++)if(L>=a[I].start&&L<=a[I].end){T=a[I];break}var H=s.start+s.duration;T?T.end=H:(T={start:L,end:H},a.push(T)),this.fragmentTracker.fragBuffered(s)}}},E.onBufferFlushing=function(v,c){var s=c.startOffset,p=c.endOffset;if(s===0&&p!==Number.POSITIVE_INFINITY){var a=this.currentTrackId,T=this.levels;if(!T.length||!T[a]||!T[a].details)return;var L=T[a].details,I=L.targetduration,H=p-I;if(H<=0)return;c.endOffsetSubtitles=Math.max(0,H),this.tracksBuffered.forEach(function(W){for(var w=0;w<W.length;){if(W[w].end<=H){W.shift();continue}else if(W[w].start<H)W[w].start=H;else break;w++}}),this.fragmentTracker.removeFragmentsInRange(s,H,B.PlaylistLevelType.SUBTITLE)}},E.onFragBuffered=function(v,c){if(!this.loadedmetadata&&c.frag.type===B.PlaylistLevelType.MAIN){var s;(s=this.media)!==null&&s!==void 0&&s.buffered.length&&(this.loadedmetadata=!0)}},E.onError=function(v,c){var s=c.frag;!s||s.type!==B.PlaylistLevelType.SUBTITLE||(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=F.State.IDLE)},E.onSubtitleTracksUpdated=function(v,c){var s=this,p=c.subtitleTracks;this.tracksBuffered=[],this.levels=p.map(function(a){return new O.Level(a)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(a){s.tracksBuffered[a.id]=[]}),this.mediaBuffer=null},E.onSubtitleTrackSwitch=function(v,c){if(this.currentTrackId=c.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.setInterval(d)},E.onSubtitleTrackLoaded=function(v,c){var s,p=c.details,a=c.id,T=this.currentTrackId,L=this.levels;if(L.length){var I=L[T];if(!(a>=L.length||a!==T||!I)){this.mediaBuffer=this.mediaBufferTimeRanges;var H=0;if(p.live||(s=I.details)!==null&&s!==void 0&&s.live){var W=this.mainDetails;if(p.deltaUpdateFailed||!W)return;var w=W.fragments[0];I.details?(H=this.alignPlaylists(p,I.details),H===0&&w&&(H=w.start,(0,K.addSliding)(p,H))):p.hasProgramDateTime&&W.hasProgramDateTime?((0,D.alignMediaPlaylistByPDT)(p,W),H=p.fragments[0].start):w&&(H=w.start,(0,K.addSliding)(p,H))}if(I.details=p,this.levelLastLoaded=a,!this.startFragRequested&&(this.mainDetails||!p.live)&&this.setStartPosition(I.details,H),this.tick(),p.live&&!this.fragCurrent&&this.media&&this.state===F.State.IDLE){var G=(0,U.findFragmentByPTS)(null,p.fragments,this.media.currentTime,0);G||(this.warn("Subtitle playlist not aligned with playback"),I.details=void 0)}}}},E._handleFragmentLoadComplete=function(v){var c=this,s=v.frag,p=v.payload,a=s.decryptdata,T=this.hls;if(!this.fragContextChanged(s)&&p&&p.byteLength>0&&a&&a.key&&a.iv&&a.method==="AES-128"){var L=performance.now();this.decrypter.decrypt(new Uint8Array(p),a.key.buffer,a.iv.buffer).then(function(I){var H=performance.now();T.trigger(R.Events.FRAG_DECRYPTED,{frag:s,payload:I,stats:{tstart:L,tdecrypt:H}})}).catch(function(I){c.warn(I.name+": "+I.message),c.state=F.State.IDLE})}},E.doTick=function(){if(!this.media){this.state=F.State.IDLE;return}if(this.state===F.State.IDLE){var v=this.currentTrackId,c=this.levels;if(!c.length||!c[v]||!c[v].details)return;var s=c[v].details,p=s.targetduration,a=this.config,T=this.getLoadPosition(),L=_.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],T-p,a.maxBufferHole),I=L.end,H=L.len,W=this.getFwdBufferInfo(this.media,B.PlaylistLevelType.MAIN),w=this.getMaxBufferLength(W==null?void 0:W.len)+p;if(H>w)return;console.assert(s,"Subtitle track details are defined on idle subtitle stream controller tick");var G=s.fragments,Y=G.length,j=s.edge,X=null,q=this.fragPrevious;if(I<j){var J=a.maxFragLookUpTolerance;X=(0,U.findFragmentByPTS)(q,G,Math.max(G[0].start,I),J),!X&&q&&q.start<G[0].start&&(X=G[0])}else X=G[Y-1];if(!X)return;X=this.mapToInitFragWhenRequired(X),this.fragmentTracker.getState(X)===k.FragmentState.NOT_LOADED&&this.loadFragment(X,s,I)}},E.getMaxBufferLength=function(v){var c=h.prototype.getMaxBufferLength.call(this);return v?Math.max(c,v):c},E.loadFragment=function(v,c,s){this.fragCurrent=v,v.sn==="initSegment"?this._loadInitSegment(v,c):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,v,c,s))},g(o,[{key:"mediaBufferTimeRanges",get:function(){return new b(this.tracksBuffered[this.currentTrackId]||[])}}]),o}(F.default),b=function(o){this.buffered=void 0;var E=function(v,c,s){if(c=c>>>0,c>s-1)throw new DOMException("Failed to execute '"+v+"' on 'TimeRanges': The index provided ("+c+") is greater than the maximum bound ("+s+")");return o[c][v]};this.buffered={get length(){return o.length},end:function(v){return E("end",v,o.length)},start:function(v){return E("start",v,o.length)}}}},"./src/controller/subtitle-track-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>S});var R=u("./src/events.ts"),_=u("./src/utils/texttrack-utils.ts"),U=u("./src/controller/base-playlist-controller.ts"),D=u("./src/types/loader.ts");function K(f,m){for(var d=0;d<m.length;d++){var l=m[d];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(f,F(l.key),l)}}function k(f,m,d){return m&&K(f.prototype,m),d&&K(f,d),Object.defineProperty(f,"prototype",{writable:!1}),f}function F(f){var m=B(f,"string");return typeof m=="symbol"?m:String(m)}function B(f,m){if(typeof f!="object"||f===null)return f;var d=f[Symbol.toPrimitive];if(d!==void 0){var l=d.call(f,m||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(f)}function O(f,m){f.prototype=Object.create(m.prototype),f.prototype.constructor=f,P(f,m)}function P(f,m){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,b){return l.__proto__=b,l},P(f,m)}var g=function(f){O(m,f);function m(l){var b;return b=f.call(this,l,"[subtitle-track-controller]")||this,b.media=null,b.tracks=[],b.groupId=null,b.tracksInGroup=[],b.trackId=-1,b.selectDefaultTrack=!0,b.queuedDefaultTrack=-1,b.trackChangeListener=function(){return b.onTextTracksChanged()},b.asyncPollTrackChange=function(){return b.pollTrackChange(0)},b.useTextTrackPolling=!1,b.subtitlePollingInterval=-1,b._subtitleDisplay=!0,b.registerListeners(),b}var d=m.prototype;return d.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,f.prototype.destroy.call(this)},d.registerListeners=function(){var b=this.hls;b.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),b.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),b.on(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),b.on(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),b.on(R.Events.ERROR,this.onError,this)},d.unregisterListeners=function(){var b=this.hls;b.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),b.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),b.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),b.off(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),b.off(R.Events.ERROR,this.onError,this)},d.onMediaAttached=function(b,h){this.media=h.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},d.pollTrackChange=function(b){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,b)},d.onMediaDetaching=function(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var b=N(this.media.textTracks);b.forEach(function(h){(0,_.clearCurrentCues)(h)}),this.subtitleTrack=-1,this.media=null}},d.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},d.onManifestParsed=function(b,h){this.tracks=h.subtitleTracks},d.onSubtitleTrackLoaded=function(b,h){var o=h.id,E=h.details,A=this.trackId,v=this.tracksInGroup[A];if(!v){this.warn("Invalid subtitle track id "+o);return}var c=v.details;v.details=h.details,this.log("subtitle track "+o+" loaded ["+E.startSN+"-"+E.endSN+"]"),o===this.trackId&&(this.retryCount=0,this.playlistLoaded(o,h,c))},d.onLevelLoading=function(b,h){this.switchLevel(h.level)},d.onLevelSwitching=function(b,h){this.switchLevel(h.level)},d.switchLevel=function(b){var h=this.hls.levels[b];if(h!=null&&h.textGroupIds){var o=h.textGroupIds[h.urlId];if(this.groupId!==o){var E=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,A=this.tracks.filter(function(s){return!o||s.groupId===o});this.tracksInGroup=A;var v=this.findTrackId(E==null?void 0:E.name)||this.findTrackId();this.groupId=o;var c={subtitleTracks:A};this.log("Updating subtitle tracks, "+A.length+' track(s) found in "'+o+'" group-id'),this.hls.trigger(R.Events.SUBTITLE_TRACKS_UPDATED,c),v!==-1&&this.setSubtitleTrack(v,E)}}},d.findTrackId=function(b){for(var h=this.tracksInGroup,o=0;o<h.length;o++){var E=h[o];if((!this.selectDefaultTrack||E.default)&&(!b||b===E.name))return E.id}return-1},d.onError=function(b,h){f.prototype.onError.call(this,b,h),!(h.fatal||!h.context)&&h.context.type===D.PlaylistContextType.SUBTITLE_TRACK&&h.context.id===this.trackId&&h.context.groupId===this.groupId&&this.retryLoadingOrFail(h)},d.loadPlaylist=function(b){f.prototype.loadPlaylist.call(this);var h=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(h)){var o=h.id,E=h.groupId,A=h.url;if(b)try{A=b.addDirectives(A)}catch(v){this.warn("Could not construct new URL with HLS Delivery Directives: "+v)}this.log("Loading subtitle playlist for id "+o),this.hls.trigger(R.Events.SUBTITLE_TRACK_LOADING,{url:A,id:o,groupId:E,deliveryDirectives:b||null})}},d.toggleTrackModes=function(b){var h=this,o=this.media,E=this.trackId;if(o){var A=N(o.textTracks),v=A.filter(function(p){return p.groupId===h.groupId});if(b===-1)[].slice.call(A).forEach(function(p){p.mode="disabled"});else{var c=v[E];c&&(c.mode="disabled")}var s=v[b];s&&(s.mode=this.subtitleDisplay?"showing":"hidden")}},d.setSubtitleTrack=function(b,h){var o,E=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=b;return}if(this.trackId!==b&&this.toggleTrackModes(b),!(this.trackId===b&&(b===-1||(o=E[b])!==null&&o!==void 0&&o.details)||b<-1||b>=E.length)){this.clearTimer();var A=E[b];if(this.log("Switching to subtitle track "+b),this.trackId=b,A){var v=A.id,c=A.groupId,s=c===void 0?"":c,p=A.name,a=A.type,T=A.url;this.hls.trigger(R.Events.SUBTITLE_TRACK_SWITCH,{id:v,groupId:s,name:p,type:a,url:T});var L=this.switchParams(A.url,h==null?void 0:h.details);this.loadPlaylist(L)}else this.hls.trigger(R.Events.SUBTITLE_TRACK_SWITCH,{id:b})}},d.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var b=-1,h=N(this.media.textTracks),o=0;o<h.length;o++)if(h[o].mode==="hidden")b=o;else if(h[o].mode==="showing"){b=o;break}this.subtitleTrack!==b&&(this.subtitleTrack=b)}},k(m,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(b){this._subtitleDisplay=b,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(b){this.selectDefaultTrack=!1;var h=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(b,h)}}]),m}(U.default);function N(f){for(var m=[],d=0;d<f.length;d++){var l=f[d];l.kind==="subtitles"&&l.label&&m.push(f[d])}return m}const S=g},"./src/controller/timeline-controller.ts":(M,C,u)=>{u.r(C),u.d(C,{TimelineController:()=>g});var R=u("./src/polyfills/number.ts"),_=u("./src/events.ts"),U=u("./src/utils/cea-608-parser.ts"),D=u("./src/utils/output-filter.ts"),K=u("./src/utils/webvtt-parser.ts"),k=u("./src/utils/texttrack-utils.ts"),F=u("./src/utils/imsc1-ttml-parser.ts"),B=u("./src/utils/mp4-tools.ts"),O=u("./src/types/loader.ts"),P=u("./src/utils/logger.ts"),g=function(){function m(l){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=f(),this.captionsProperties=void 0,this.hls=l,this.config=l.config,this.Cues=l.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var b=new D.default(this,"textTrack1"),h=new D.default(this,"textTrack2"),o=new D.default(this,"textTrack3"),E=new D.default(this,"textTrack4");this.cea608Parser1=new U.default(1,b,h),this.cea608Parser2=new U.default(3,o,E)}l.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),l.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.on(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.on(_.Events.FRAG_LOADING,this.onFragLoading,this),l.on(_.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(_.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),l.on(_.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),l.on(_.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),l.on(_.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),l.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var d=m.prototype;return d.destroy=function(){var b=this.hls;b.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),b.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.off(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),b.off(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),b.off(_.Events.FRAG_LOADING,this.onFragLoading,this),b.off(_.Events.FRAG_LOADED,this.onFragLoaded,this),b.off(_.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),b.off(_.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),b.off(_.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),b.off(_.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),b.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},d.addCues=function(b,h,o,E,A){for(var v=!1,c=A.length;c--;){var s=A[c],p=S(s[0],s[1],h,o);if(p>=0&&(s[0]=Math.min(s[0],h),s[1]=Math.max(s[1],o),v=!0,p/(o-h)>.5))return}if(v||A.push([h,o]),this.config.renderTextTracksNatively){var a=this.captionsTracks[b];this.Cues.newCue(a,h,o,E)}else{var T=this.Cues.newCue(null,h,o,E);this.hls.trigger(_.Events.CUES_PARSED,{type:"captions",cues:T,track:b})}},d.onInitPtsFound=function(b,h){var o=this,E=h.frag,A=h.id,v=h.initPTS,c=h.timescale,s=this.unparsedVttFrags;A==="main"&&(this.initPTS[E.cc]=v,this.timescale[E.cc]=c),s.length&&(this.unparsedVttFrags=[],s.forEach(function(p){o.onFragLoaded(_.Events.FRAG_LOADED,p)}))},d.getExistingTrack=function(b){var h=this.media;if(h)for(var o=0;o<h.textTracks.length;o++){var E=h.textTracks[o];if(E[b])return E}return null},d.createCaptionsTrack=function(b){this.config.renderTextTracksNatively?this.createNativeTrack(b):this.createNonNativeTrack(b)},d.createNativeTrack=function(b){if(!this.captionsTracks[b]){var h=this.captionsProperties,o=this.captionsTracks,E=this.media,A=h[b],v=A.label,c=A.languageCode,s=this.getExistingTrack(b);if(s)o[b]=s,(0,k.clearCurrentCues)(o[b]),(0,k.sendAddTrackEvent)(o[b],E);else{var p=this.createTextTrack("captions",v,c);p&&(p[b]=!0,o[b]=p)}}},d.createNonNativeTrack=function(b){if(!this.nonNativeCaptionsTracks[b]){var h=this.captionsProperties[b];if(h){var o=h.label,E={_id:b,label:o,kind:"captions",default:h.media?!!h.media.default:!1,closedCaptions:h.media};this.nonNativeCaptionsTracks[b]=E,this.hls.trigger(_.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[E]})}}},d.createTextTrack=function(b,h,o){var E=this.media;if(E)return E.addTextTrack(b,h,o)},d.onMediaAttaching=function(b,h){this.media=h.media,this._cleanTracks()},d.onMediaDetaching=function(){var b=this.captionsTracks;Object.keys(b).forEach(function(h){(0,k.clearCurrentCues)(b[h]),delete b[h]}),this.nonNativeCaptionsTracks={}},d.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=f(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},d._cleanTracks=function(){var b=this.media;if(b){var h=b.textTracks;if(h)for(var o=0;o<h.length;o++)(0,k.clearCurrentCues)(h[o])}},d.onSubtitleTracksUpdated=function(b,h){var o=this;this.textTracks=[];var E=h.subtitleTracks||[],A=E.some(function(p){return p.textCodec===F.IMSC1_CODEC});if(this.config.enableWebVTT||A&&this.config.enableIMSC1){var v=this.tracks&&E&&this.tracks.length===E.length;if(this.tracks=E||[],this.config.renderTextTracksNatively){var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(p,a){var T;if(a<c.length){for(var L=null,I=0;I<c.length;I++)if(N(c[I],p)){L=c[I];break}L&&(T=L)}if(T)(0,k.clearCurrentCues)(T);else{var H=o._captionsOrSubtitlesFromCharacteristics(p);T=o.createTextTrack(H,p.name,p.lang),T&&(T.mode="disabled")}T&&(T.groupId=p.groupId,o.textTracks.push(T))})}else if(!v&&this.tracks&&this.tracks.length){var s=this.tracks.map(function(p){return{label:p.name,kind:p.type.toLowerCase(),default:p.default,subtitleTrack:p}});this.hls.trigger(_.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:s})}}},d._captionsOrSubtitlesFromCharacteristics=function(b){var h;if((h=b.attrs)!==null&&h!==void 0&&h.CHARACTERISTICS){var o=/transcribes-spoken-dialog/gi.test(b.attrs.CHARACTERISTICS),E=/describes-music-and-sound/gi.test(b.attrs.CHARACTERISTICS);if(o&&E)return"captions"}return"subtitles"},d.onManifestLoaded=function(b,h){var o=this;this.config.enableCEA708Captions&&h.captions&&h.captions.forEach(function(E){var A=/(?:CC|SERVICE)([1-4])/.exec(E.instreamId);if(A){var v="textTrack"+A[1],c=o.captionsProperties[v];c&&(c.label=E.name,E.lang&&(c.languageCode=E.lang),c.media=E)}})},d.closedCaptionsForLevel=function(b){var h=this.hls.levels[b.level];return h==null?void 0:h.attrs["CLOSED-CAPTIONS"]},d.onFragLoading=function(b,h){var o=this.cea608Parser1,E=this.cea608Parser2,A=this.lastSn,v=this.lastPartIndex;if(!(!this.enabled||!(o&&E))&&h.frag.type===O.PlaylistLevelType.MAIN){var c,s,p=h.frag.sn,a=(c=h==null||(s=h.part)===null||s===void 0?void 0:s.index)!=null?c:-1;p===A+1||p===A&&a===v+1||(o.reset(),E.reset()),this.lastSn=p,this.lastPartIndex=a}},d.onFragLoaded=function(b,h){var o=h.frag,E=h.payload,A=this.initPTS,v=this.unparsedVttFrags;if(o.type===O.PlaylistLevelType.SUBTITLE)if(E.byteLength){if(!(0,R.isFiniteNumber)(A[o.cc])){v.push(h),A.length&&this.hls.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Missing initial subtitle PTS")});return}var c=o.decryptdata,s="stats"in h;if(c==null||!c.encrypted||s){var p=this.tracks[o.level],a=this.vttCCs;a[o.cc]||(a[o.cc]={start:o.start,prevCC:this.prevCC,new:!0},this.prevCC=o.cc),p&&p.textCodec===F.IMSC1_CODEC?this._parseIMSC1(o,E):this._parseVTTs(o,E,a)}}else this.hls.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Empty subtitle payload")})},d._parseIMSC1=function(b,h){var o=this,E=this.hls;(0,F.parseIMSC1)(h,this.initPTS[b.cc],this.timescale[b.cc],function(A){o._appendCues(A,b.level),E.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:b})},function(A){P.logger.log("Failed to parse IMSC1: "+A),E.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b,error:A})})},d._parseVTTs=function(b,h,o){var E,A=this,v=this.hls,c=(E=b.initSegment)!==null&&E!==void 0&&E.data?(0,B.appendUint8Array)(b.initSegment.data,new Uint8Array(h)):h;(0,K.parseWebVTT)(c,this.initPTS[b.cc],this.timescale[b.cc],o,b.cc,b.start,function(s){A._appendCues(s,b.level),v.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:b})},function(s){A._fallbackToIMSC1(b,h),P.logger.log("Failed to parse VTT cue: "+s),v.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b,error:s})})},d._fallbackToIMSC1=function(b,h){var o=this,E=this.tracks[b.level];E.textCodec||(0,F.parseIMSC1)(h,this.initPTS[b.cc],this.timescale[b.cc],function(){E.textCodec=F.IMSC1_CODEC,o._parseIMSC1(b,h)},function(){E.textCodec="wvtt"})},d._appendCues=function(b,h){var o=this.hls;if(this.config.renderTextTracksNatively){var E=this.textTracks[h];if(!E||E.mode==="disabled")return;b.forEach(function(c){return(0,k.addCueToTrack)(E,c)})}else{var A=this.tracks[h];if(!A)return;var v=A.default?"default":"subtitles"+h;o.trigger(_.Events.CUES_PARSED,{type:"subtitles",cues:b,track:v})}},d.onFragDecrypted=function(b,h){var o=h.frag;if(o.type===O.PlaylistLevelType.SUBTITLE){if(!(0,R.isFiniteNumber)(this.initPTS[o.cc])){this.unparsedVttFrags.push(h);return}this.onFragLoaded(_.Events.FRAG_LOADED,h)}},d.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},d.onFragParsingUserdata=function(b,h){var o=this.cea608Parser1,E=this.cea608Parser2;if(!(!this.enabled||!(o&&E))){var A=h.frag,v=h.samples;if(!(A.type===O.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(A)==="NONE"))for(var c=0;c<v.length;c++){var s=v[c].bytes;if(s){var p=this.extractCea608Data(s);o.addData(v[c].pts,p[0]),E.addData(v[c].pts,p[1])}}}},d.onBufferFlushing=function(b,h){var o=h.startOffset,E=h.endOffset,A=h.endOffsetSubtitles,v=h.type,c=this.media;if(!(!c||c.currentTime<E)){if(!v||v==="video"){var s=this.captionsTracks;Object.keys(s).forEach(function(a){return(0,k.removeCuesInRange)(s[a],o,E)})}if(this.config.renderTextTracksNatively&&o===0&&A!==void 0){var p=this.textTracks;Object.keys(p).forEach(function(a){return(0,k.removeCuesInRange)(p[a],o,A)})}}},d.extractCea608Data=function(b){for(var h=[[],[]],o=b[0]&31,E=2,A=0;A<o;A++){var v=b[E++],c=127&b[E++],s=127&b[E++];if(!(c===0&&s===0)){var p=(4&v)!==0;if(p){var a=3&v;(a===0||a===1)&&(h[a].push(c),h[a].push(s))}}}return h},m}();function N(m,d){return m&&m.label===d.name&&!(m.textTrack1||m.textTrack2)}function S(m,d,l,b){return Math.min(d,b)-Math.max(m,l)}function f(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>R});var R=function(){function _(D,K){this.subtle=void 0,this.aesIV=void 0,this.subtle=D,this.aesIV=K}var U=_.prototype;return U.decrypt=function(K,k){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},k,K)},_}()},"./src/crypt/aes-decryptor.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>U,removePadding:()=>_});var R=u("./src/utils/typed-array.ts");function _(D){var K=D.byteLength,k=K&&new DataView(D.buffer).getUint8(K-1);return k?(0,R.sliceUint8)(D,0,K-k):D}var U=function(){function D(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var K=D.prototype;return K.uint8ArrayToUint32Array_=function(F){for(var B=new DataView(F),O=new Uint32Array(4),P=0;P<4;P++)O[P]=B.getUint32(P*4);return O},K.initTable=function(){var F=this.sBox,B=this.invSBox,O=this.subMix,P=O[0],g=O[1],N=O[2],S=O[3],f=this.invSubMix,m=f[0],d=f[1],l=f[2],b=f[3],h=new Uint32Array(256),o=0,E=0,A=0;for(A=0;A<256;A++)A<128?h[A]=A<<1:h[A]=A<<1^283;for(A=0;A<256;A++){var v=E^E<<1^E<<2^E<<3^E<<4;v=v>>>8^v&255^99,F[o]=v,B[v]=o;var c=h[o],s=h[c],p=h[s],a=h[v]*257^v*16843008;P[o]=a<<24|a>>>8,g[o]=a<<16|a>>>16,N[o]=a<<8|a>>>24,S[o]=a,a=p*16843009^s*65537^c*257^o*16843008,m[v]=a<<24|a>>>8,d[v]=a<<16|a>>>16,l[v]=a<<8|a>>>24,b[v]=a,o?(o=c^h[h[h[p^c]]],E^=h[h[E]]):o=E=1}},K.expandKey=function(F){for(var B=this.uint8ArrayToUint32Array_(F),O=!0,P=0;P<B.length&&O;)O=B[P]===this.key[P],P++;if(!O){this.key=B;var g=this.keySize=B.length;if(g!==4&&g!==6&&g!==8)throw new Error("Invalid aes key size="+g);var N=this.ksRows=(g+6+1)*4,S,f,m=this.keySchedule=new Uint32Array(N),d=this.invKeySchedule=new Uint32Array(N),l=this.sBox,b=this.rcon,h=this.invSubMix,o=h[0],E=h[1],A=h[2],v=h[3],c,s;for(S=0;S<N;S++){if(S<g){c=m[S]=B[S];continue}s=c,S%g===0?(s=s<<8|s>>>24,s=l[s>>>24]<<24|l[s>>>16&255]<<16|l[s>>>8&255]<<8|l[s&255],s^=b[S/g|0]<<24):g>6&&S%g===4&&(s=l[s>>>24]<<24|l[s>>>16&255]<<16|l[s>>>8&255]<<8|l[s&255]),m[S]=c=(m[S-g]^s)>>>0}for(f=0;f<N;f++)S=N-f,f&3?s=m[S]:s=m[S-4],f<4||S<=4?d[f]=s:d[f]=o[l[s>>>24]]^E[l[s>>>16&255]]^A[l[s>>>8&255]]^v[l[s&255]],d[f]=d[f]>>>0}},K.networkToHostOrderSwap=function(F){return F<<24|(F&65280)<<8|(F&16711680)>>8|F>>>24},K.decrypt=function(F,B,O){for(var P=this.keySize+6,g=this.invKeySchedule,N=this.invSBox,S=this.invSubMix,f=S[0],m=S[1],d=S[2],l=S[3],b=this.uint8ArrayToUint32Array_(O),h=b[0],o=b[1],E=b[2],A=b[3],v=new Int32Array(F),c=new Int32Array(v.length),s,p,a,T,L,I,H,W,w,G,Y,j,X,q,J=this.networkToHostOrderSwap;B<v.length;){for(w=J(v[B]),G=J(v[B+1]),Y=J(v[B+2]),j=J(v[B+3]),L=w^g[0],I=j^g[1],H=Y^g[2],W=G^g[3],X=4,q=1;q<P;q++)s=f[L>>>24]^m[I>>16&255]^d[H>>8&255]^l[W&255]^g[X],p=f[I>>>24]^m[H>>16&255]^d[W>>8&255]^l[L&255]^g[X+1],a=f[H>>>24]^m[W>>16&255]^d[L>>8&255]^l[I&255]^g[X+2],T=f[W>>>24]^m[L>>16&255]^d[I>>8&255]^l[H&255]^g[X+3],L=s,I=p,H=a,W=T,X=X+4;s=N[L>>>24]<<24^N[I>>16&255]<<16^N[H>>8&255]<<8^N[W&255]^g[X],p=N[I>>>24]<<24^N[H>>16&255]<<16^N[W>>8&255]<<8^N[L&255]^g[X+1],a=N[H>>>24]<<24^N[W>>16&255]<<16^N[L>>8&255]<<8^N[I&255]^g[X+2],T=N[W>>>24]<<24^N[L>>16&255]<<16^N[I>>8&255]<<8^N[H&255]^g[X+3],c[B]=J(s^h),c[B+1]=J(T^o),c[B+2]=J(a^E),c[B+3]=J(p^A),h=w,o=G,E=Y,A=j,B=B+4}return c.buffer},D}()},"./src/crypt/decrypter.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>B});var R=u("./src/crypt/aes-crypto.ts"),_=u("./src/crypt/fast-aes-key.ts"),U=u("./src/crypt/aes-decryptor.ts"),D=u("./src/utils/logger.ts"),K=u("./src/utils/mp4-tools.ts"),k=u("./src/utils/typed-array.ts"),F=16,B=function(){function O(g,N){var S=N===void 0?{}:N,f=S.removePKCS7Padding,m=f===void 0?!0:f;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=g.enableSoftwareAES,this.removePKCS7Padding=m,m)try{var d=self.crypto;d&&(this.subtle=d.subtle||d.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}var P=O.prototype;return P.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},P.isSync=function(){return this.useSoftware},P.flush=function(){var N=this.currentResult,S=this.remainderData;if(!N||S)return D.logger.error("[softwareDecrypt] "+(S?"overflow bytes: "+S.byteLength:"no result")),this.reset(),null;var f=new Uint8Array(N);return this.reset(),this.removePKCS7Padding?(0,U.removePadding)(f):f},P.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},P.decrypt=function(N,S,f){var m=this;return this.useSoftware?new Promise(function(d,l){m.softwareDecrypt(new Uint8Array(N),S,f);var b=m.flush();b?d(b.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(N),S,f)},P.softwareDecrypt=function(N,S,f){var m=this.currentIV,d=this.currentResult,l=this.remainderData;this.logOnce("JS AES decrypt"),l&&(N=(0,K.appendUint8Array)(l,N),this.remainderData=null);var b=this.getValidChunk(N);if(!b.length)return null;m&&(f=m);var h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new U.default),h.expandKey(S);var o=d;return this.currentResult=h.decrypt(b.buffer,0,f),this.currentIV=(0,k.sliceUint8)(b,-16).buffer,o||null},P.webCryptoDecrypt=function(N,S,f){var m=this,d=this.subtle;return(this.key!==S||!this.fastAesKey)&&(this.key=S,this.fastAesKey=new _.default(d,S)),this.fastAesKey.expandKey().then(function(l){if(!d)return Promise.reject(new Error("web crypto not initialized"));m.logOnce("WebCrypto AES decrypt");var b=new R.default(d,new Uint8Array(f));return b.decrypt(N.buffer,l)}).catch(function(l){return D.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+l.name+": "+l.message),m.onWebCryptoError(N,S,f)})},P.onWebCryptoError=function(N,S,f){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(N,S,f);var m=this.flush();if(m)return m.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},P.getValidChunk=function(N){var S=N,f=N.length-N.length%F;return f!==N.length&&(S=(0,k.sliceUint8)(N,0,f),this.remainderData=(0,k.sliceUint8)(N,f)),S},P.logOnce=function(N){this.logEnabled&&(D.logger.log("[decrypter]: "+N),this.logEnabled=!1)},O}()},"./src/crypt/fast-aes-key.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>R});var R=function(){function _(D,K){this.subtle=void 0,this.key=void 0,this.subtle=D,this.key=K}var U=_.prototype;return U.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},_}()},"./src/demux/aacdemuxer.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>B});var R=u("./src/demux/base-audio-demuxer.ts"),_=u("./src/demux/adts.ts"),U=u("./src/utils/logger.ts"),D=u("./src/demux/id3.ts");function K(O,P){O.prototype=Object.create(P.prototype),O.prototype.constructor=O,k(O,P)}function k(O,P){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(N,S){return N.__proto__=S,N},k(O,P)}var F=function(O){K(P,O);function P(N,S){var f;return f=O.call(this)||this,f.observer=void 0,f.config=void 0,f.observer=N,f.config=S,f}var g=P.prototype;return g.resetInitSegment=function(S,f,m,d){O.prototype.resetInitSegment.call(this,S,f,m,d),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:f,duration:d,inputTimeScale:9e4,dropped:0}},P.probe=function(S){if(!S)return!1;for(var f=D.getID3Data(S,0)||[],m=f.length,d=S.length;m<d;m++)if(_.probe(S,m))return U.logger.log("ADTS sync word found !"),!0;return!1},g.canParse=function(S,f){return _.canParse(S,f)},g.appendFrame=function(S,f,m){_.initTrackConfig(S,this.observer,f,m,S.manifestCodec);var d=_.appendFrame(S,f,m,this.basePTS,this.frameIndex);if(d&&d.missing===0)return d},P}(R.default);const B=F},"./src/demux/adts.ts":(M,C,u)=>{u.r(C),u.d(C,{appendFrame:()=>m,canGetFrameLength:()=>B,canParse:()=>P,getAudioConfig:()=>D,getFrameDuration:()=>S,getFullFrameLength:()=>F,getHeaderLength:()=>k,initTrackConfig:()=>N,isHeader:()=>O,isHeaderPattern:()=>K,parseFrameHeader:()=>f,probe:()=>g});var R=u("./src/utils/logger.ts"),_=u("./src/errors.ts"),U=u("./src/events.ts");function D(d,l,b,h){var o,E,A,v,c=navigator.userAgent.toLowerCase(),s=h,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];o=((l[b+2]&192)>>>6)+1;var a=(l[b+2]&60)>>>2;if(a>p.length-1){d.trigger(U.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+a});return}return A=(l[b+2]&1)<<2,A|=(l[b+3]&192)>>>6,R.logger.log("manifest codec:"+h+", ADTS type:"+o+", samplingIndex:"+a),/firefox/i.test(c)?a>=6?(o=5,v=new Array(4),E=a-3):(o=2,v=new Array(2),E=a):c.indexOf("android")!==-1?(o=2,v=new Array(2),E=a):(o=5,v=new Array(4),h&&(h.indexOf("mp4a.40.29")!==-1||h.indexOf("mp4a.40.5")!==-1)||!h&&a>=6?E=a-3:((h&&h.indexOf("mp4a.40.2")!==-1&&(a>=6&&A===1||/vivaldi/i.test(c))||!h&&A===1)&&(o=2,v=new Array(2)),E=a)),v[0]=o<<3,v[0]|=(a&14)>>1,v[1]|=(a&1)<<7,v[1]|=A<<3,o===5&&(v[1]|=(E&14)>>1,v[2]=(E&1)<<7,v[2]|=8,v[3]=0),{config:v,samplerate:p[a],channelCount:A,codec:"mp4a.40."+o,manifestCodec:s}}function K(d,l){return d[l]===255&&(d[l+1]&246)===240}function k(d,l){return d[l+1]&1?7:9}function F(d,l){return(d[l+3]&3)<<11|d[l+4]<<3|(d[l+5]&224)>>>5}function B(d,l){return l+5<d.length}function O(d,l){return l+1<d.length&&K(d,l)}function P(d,l){return B(d,l)&&K(d,l)&&F(d,l)<=d.length-l}function g(d,l){if(O(d,l)){var b=k(d,l);if(l+b>=d.length)return!1;var h=F(d,l);if(h<=b)return!1;var o=l+h;return o===d.length||O(d,o)}return!1}function N(d,l,b,h,o){if(!d.samplerate){var E=D(l,b,h,o);if(!E)return;d.config=E.config,d.samplerate=E.samplerate,d.channelCount=E.channelCount,d.codec=E.codec,d.manifestCodec=E.manifestCodec,R.logger.log("parsed codec:"+d.codec+", rate:"+E.samplerate+", channels:"+E.channelCount)}}function S(d){return 9216e4/d}function f(d,l){var b=k(d,l);if(l+b<=d.length){var h=F(d,l)-b;if(h>0)return{headerLength:b,frameLength:h}}}function m(d,l,b,h,o){var E=S(d.samplerate),A=h+o*E,v=f(l,b),c;if(v){var s=v.frameLength,p=v.headerLength,a=p+s,T=Math.max(0,b+a-l.length);T?(c=new Uint8Array(a-p),c.set(l.subarray(b+p,l.length),0)):c=l.subarray(b+p,b+a);var L={unit:c,pts:A};return T||d.samples.push(L),{sample:L,length:a,missing:T}}var I=l.length-b;c=new Uint8Array(I),c.set(l.subarray(b,l.length),0);var H={unit:c,pts:A};return{sample:H,length:I,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>O,initPTSFn:()=>B});var R=u("./src/polyfills/number.ts"),_=u("./src/demux/id3.ts"),U=u("./src/types/demuxer.ts"),D=u("./src/demux/dummy-demuxed-track.ts"),K=u("./src/utils/mp4-tools.ts"),k=u("./src/utils/typed-array.ts"),F=function(){function P(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var g=P.prototype;return g.resetInitSegment=function(S,f,m,d){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},g.resetTimeStamp=function(S){this.initPTS=S,this.resetContiguity()},g.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},g.canParse=function(S,f){return!1},g.appendFrame=function(S,f,m){},g.demux=function(S,f){this.cachedData&&(S=(0,K.appendUint8Array)(this.cachedData,S),this.cachedData=null);var m=_.getID3Data(S,0),d=m?m.length:0,l,b=this._audioTrack,h=this._id3Track,o=m?_.getTimeStamp(m):void 0,E=S.length;for((this.basePTS===null||this.frameIndex===0&&(0,R.isFiniteNumber)(o))&&(this.basePTS=B(o,f,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),m&&m.length>0&&h.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:m,type:U.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});d<E;){if(this.canParse(S,d)){var A=this.appendFrame(b,S,d);A?(this.frameIndex++,this.lastPTS=A.sample.pts,d+=A.length,l=d):d=E}else _.canParse(S,d)?(m=_.getID3Data(S,d),h.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:m,type:U.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),d+=m.length,l=d):d++;if(d===E&&l!==E){var v=(0,k.sliceUint8)(S,l);this.cachedData?this.cachedData=(0,K.appendUint8Array)(this.cachedData,v):this.cachedData=v}}return{audioTrack:b,videoTrack:(0,D.dummyTrack)(),id3Track:h,textTrack:(0,D.dummyTrack)()}},g.demuxSampleAes=function(S,f,m){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},g.flush=function(S){var f=this.cachedData;return f&&(this.cachedData=null,this.demux(f,0)),{audioTrack:this._audioTrack,videoTrack:(0,D.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,D.dummyTrack)()}},g.destroy=function(){},P}(),B=function(g,N,S){return(0,R.isFiniteNumber)(g)?g*90:N*9e4+(S||0)};const O=F},"./src/demux/chunk-cache.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>R});var R=function(){function U(){this.chunks=[],this.dataLength=0}var D=U.prototype;return D.push=function(k){this.chunks.push(k),this.dataLength+=k.length},D.flush=function(){var k=this.chunks,F=this.dataLength,B;if(k.length)k.length===1?B=k[0]:B=_(k,F);else return new Uint8Array(0);return this.reset(),B},D.reset=function(){this.chunks.length=0,this.dataLength=0},U}();function _(U,D){for(var K=new Uint8Array(D),k=0,F=0;F<U.length;F++){var B=U[F];K.set(B,k),k+=B.length}return K}},"./src/demux/dummy-demuxed-track.ts":(M,C,u)=>{u.r(C),u.d(C,{dummyTrack:()=>R});function R(_,U){return _===void 0&&(_=""),U===void 0&&(U=9e4),{type:_,id:-1,pid:-1,inputTimeScale:U,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>U});var R=u("./src/utils/logger.ts"),_=function(){function D(k){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=k,this.bytesAvailable=k.byteLength,this.word=0,this.bitsAvailable=0}var K=D.prototype;return K.loadWord=function(){var F=this.data,B=this.bytesAvailable,O=F.byteLength-B,P=new Uint8Array(4),g=Math.min(4,B);if(g===0)throw new Error("no bytes available");P.set(F.subarray(O,O+g)),this.word=new DataView(P.buffer).getUint32(0),this.bitsAvailable=g*8,this.bytesAvailable-=g},K.skipBits=function(F){var B;F=Math.min(F,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>F?(this.word<<=F,this.bitsAvailable-=F):(F-=this.bitsAvailable,B=F>>3,F-=B<<3,this.bytesAvailable-=B,this.loadWord(),this.word<<=F,this.bitsAvailable-=F)},K.readBits=function(F){var B=Math.min(this.bitsAvailable,F),O=this.word>>>32-B;if(F>32&&R.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=B,this.bitsAvailable>0)this.word<<=B;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return B=F-B,B>0&&this.bitsAvailable?O<<B|this.readBits(B):O},K.skipLZ=function(){var F;for(F=0;F<this.bitsAvailable;++F)if(this.word&2147483648>>>F)return this.word<<=F,this.bitsAvailable-=F,F;return this.loadWord(),F+this.skipLZ()},K.skipUEG=function(){this.skipBits(1+this.skipLZ())},K.skipEG=function(){this.skipBits(1+this.skipLZ())},K.readUEG=function(){var F=this.skipLZ();return this.readBits(F+1)-1},K.readEG=function(){var F=this.readUEG();return 1&F?1+F>>>1:-1*(F>>>1)},K.readBoolean=function(){return this.readBits(1)===1},K.readUByte=function(){return this.readBits(8)},K.readUShort=function(){return this.readBits(16)},K.readUInt=function(){return this.readBits(32)},K.skipScalingList=function(F){for(var B=8,O=8,P,g=0;g<F;g++)O!==0&&(P=this.readEG(),O=(B+P+256)%256),B=O===0?B:O},K.readSPS=function(){var F=0,B=0,O=0,P=0,g,N,S,f=this.readUByte.bind(this),m=this.readBits.bind(this),d=this.readUEG.bind(this),l=this.readBoolean.bind(this),b=this.skipBits.bind(this),h=this.skipEG.bind(this),o=this.skipUEG.bind(this),E=this.skipScalingList.bind(this);f();var A=f();if(m(5),b(3),f(),o(),A===100||A===110||A===122||A===244||A===44||A===83||A===86||A===118||A===128){var v=d();if(v===3&&b(1),o(),o(),b(1),l())for(N=v!==3?8:12,S=0;S<N;S++)l()&&(S<6?E(16):E(64))}o();var c=d();if(c===0)d();else if(c===1)for(b(1),h(),h(),g=d(),S=0;S<g;S++)h();o(),b(1);var s=d(),p=d(),a=m(1);a===0&&b(1),b(1),l()&&(F=d(),B=d(),O=d(),P=d());var T=[1,1];if(l()&&l()){var L=f();switch(L){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:{T=[f()<<8|f(),f()<<8|f()];break}}}return{width:Math.ceil((s+1)*16-F*2-B*2),height:(2-a)*(p+1)*16-(a?2:4)*(O+P),pixelRatio:T}},K.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},D}();const U=_},"./src/demux/id3.ts":(M,C,u)=>{u.r(C),u.d(C,{canParse:()=>K,decodeFrame:()=>P,getID3Data:()=>U,getID3Frames:()=>O,getTimeStamp:()=>k,isFooter:()=>_,isHeader:()=>R,isTimeStampFrame:()=>F,testables:()=>d,utf8ArrayToStr:()=>m});var R=function(o,E){return E+10<=o.length&&o[E]===73&&o[E+1]===68&&o[E+2]===51&&o[E+3]<255&&o[E+4]<255&&o[E+6]<128&&o[E+7]<128&&o[E+8]<128&&o[E+9]<128},_=function(o,E){return E+10<=o.length&&o[E]===51&&o[E+1]===68&&o[E+2]===73&&o[E+3]<255&&o[E+4]<255&&o[E+6]<128&&o[E+7]<128&&o[E+8]<128&&o[E+9]<128},U=function(o,E){for(var A=E,v=0;R(o,E);){v+=10;var c=D(o,E+6);v+=c,_(o,E+10)&&(v+=10),E+=v}if(v>0)return o.subarray(A,A+v)},D=function(o,E){var A=0;return A=(o[E]&127)<<21,A|=(o[E+1]&127)<<14,A|=(o[E+2]&127)<<7,A|=o[E+3]&127,A},K=function(o,E){return R(o,E)&&D(o,E+6)+10<=o.length-E},k=function(o){for(var E=O(o),A=0;A<E.length;A++){var v=E[A];if(F(v))return f(v)}},F=function(o){return o&&o.key==="PRIV"&&o.info==="com.apple.streaming.transportStreamTimestamp"},B=function(o){var E=String.fromCharCode(o[0],o[1],o[2],o[3]),A=D(o,4),v=10;return{type:E,size:A,data:o.subarray(v,v+A)}},O=function(o){for(var E=0,A=[];R(o,E);){var v=D(o,E+6);E+=10;for(var c=E+v;E+8<c;){var s=B(o.subarray(E)),p=P(s);p&&A.push(p),E+=s.size+10}_(o,E)&&(E+=10)}return A},P=function(o){return o.type==="PRIV"?g(o):o.type[0]==="W"?S(o):N(o)},g=function(o){if(!(o.size<2)){var E=m(o.data,!0),A=new Uint8Array(o.data.subarray(E.length+1));return{key:o.type,info:E,data:A.buffer}}},N=function(o){if(!(o.size<2)){if(o.type==="TXXX"){var E=1,A=m(o.data.subarray(E),!0);E+=A.length+1;var v=m(o.data.subarray(E));return{key:o.type,info:A,data:v}}var c=m(o.data.subarray(1));return{key:o.type,data:c}}},S=function(o){if(o.type==="WXXX"){if(o.size<2)return;var E=1,A=m(o.data.subarray(E),!0);E+=A.length+1;var v=m(o.data.subarray(E));return{key:o.type,info:A,data:v}}var c=m(o.data);return{key:o.type,data:c}},f=function(o){if(o.data.byteLength===8){var E=new Uint8Array(o.data),A=E[3]&1,v=(E[4]<<23)+(E[5]<<15)+(E[6]<<7)+E[7];return v/=45,A&&(v+=4772185884e-2),Math.round(v)}},m=function(o,E){E===void 0&&(E=!1);var A=b();if(A){var v=A.decode(o);if(E){var c=v.indexOf("\0");return c!==-1?v.substring(0,c):v}return v.replace(/\0/g,"")}for(var s=o.length,p,a,T,L="",I=0;I<s;){if(p=o[I++],p===0&&E)return L;if(p===0||p===3)continue;switch(p>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:L+=String.fromCharCode(p);break;case 12:case 13:a=o[I++],L+=String.fromCharCode((p&31)<<6|a&63);break;case 14:a=o[I++],T=o[I++],L+=String.fromCharCode((p&15)<<12|(a&63)<<6|(T&63)<<0);break}}return L},d={decodeTextFrame:N},l;function b(){return!l&&typeof self.TextDecoder<"u"&&(l=new self.TextDecoder("utf-8")),l}},"./src/demux/mp3demuxer.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>B});var R=u("./src/demux/base-audio-demuxer.ts"),_=u("./src/demux/id3.ts"),U=u("./src/utils/logger.ts"),D=u("./src/demux/mpegaudio.ts");function K(O,P){O.prototype=Object.create(P.prototype),O.prototype.constructor=O,k(O,P)}function k(O,P){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(N,S){return N.__proto__=S,N},k(O,P)}var F=function(O){K(P,O);function P(){return O.apply(this,arguments)||this}var g=P.prototype;return g.resetInitSegment=function(S,f,m,d){O.prototype.resetInitSegment.call(this,S,f,m,d),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:f,duration:d,inputTimeScale:9e4,dropped:0}},P.probe=function(S){if(!S)return!1;for(var f=_.getID3Data(S,0)||[],m=f.length,d=S.length;m<d;m++)if(D.probe(S,m))return U.logger.log("MPEG Audio sync word found !"),!0;return!1},g.canParse=function(S,f){return D.canParse(S,f)},g.appendFrame=function(S,f,m){if(this.basePTS!==null)return D.appendFrame(S,f,m,this.basePTS,this.frameIndex)},P}(R.default);const B=F},"./src/demux/mp4demuxer.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>F});var R=u("./src/polyfills/number.ts"),_=u("./src/types/demuxer.ts"),U=u("./src/utils/mp4-tools.ts"),D=u("./src/demux/dummy-demuxed-track.ts"),K=/\/emsg[-/]ID3/i,k=function(){function B(P,g){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=g}var O=B.prototype;return O.resetTimeStamp=function(){},O.resetInitSegment=function(g,N,S,f){var m=this.videoTrack=(0,D.dummyTrack)("video",1),d=this.audioTrack=(0,D.dummyTrack)("audio",1),l=this.txtTrack=(0,D.dummyTrack)("text",1);if(this.id3Track=(0,D.dummyTrack)("id3",1),this.timeOffset=0,!(!g||!g.byteLength)){var b=(0,U.parseInitSegment)(g);if(b.video){var h=b.video,o=h.id,E=h.timescale,A=h.codec;m.id=o,m.timescale=l.timescale=E,m.codec=A}if(b.audio){var v=b.audio,c=v.id,s=v.timescale,p=v.codec;d.id=c,d.timescale=s,d.codec=p}l.id=U.RemuxerTrackIdConfig.text,m.sampleDuration=0,m.duration=d.duration=f}},O.resetContiguity=function(){},B.probe=function(g){return g=g.length>16384?g.subarray(0,16384):g,(0,U.findBox)(g,["moof"]).length>0},O.demux=function(g,N){this.timeOffset=N;var S=g,f=this.videoTrack,m=this.txtTrack;if(this.config.progressive){this.remainderData&&(S=(0,U.appendUint8Array)(this.remainderData,g));var d=(0,U.segmentValidRange)(S);this.remainderData=d.remainder,f.samples=d.valid||new Uint8Array}else f.samples=S;var l=this.extractID3Track(f,N);return m.samples=(0,U.parseSamples)(N,f),{videoTrack:f,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}},O.flush=function(){var g=this.timeOffset,N=this.videoTrack,S=this.txtTrack;N.samples=this.remainderData||new Uint8Array,this.remainderData=null;var f=this.extractID3Track(N,this.timeOffset);return S.samples=(0,U.parseSamples)(g,N),{videoTrack:N,audioTrack:(0,D.dummyTrack)(),id3Track:f,textTrack:(0,D.dummyTrack)()}},O.extractID3Track=function(g,N){var S=this.id3Track;if(g.samples.length){var f=(0,U.findBox)(g.samples,["emsg"]);f&&f.forEach(function(m){var d=(0,U.parseEmsg)(m);if(K.test(d.schemeIdUri)){var l=(0,R.isFiniteNumber)(d.presentationTime)?d.presentationTime/d.timeScale:N+d.presentationTimeDelta/d.timeScale,b=d.eventDuration===4294967295?Number.POSITIVE_INFINITY:d.eventDuration/d.timeScale;b<=.001&&(b=Number.POSITIVE_INFINITY);var h=d.payload;S.samples.push({data:h,len:h.byteLength,dts:l,pts:l,type:_.MetadataSchema.emsg,duration:b})}})}return S},O.demuxSampleAes=function(g,N,S){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},O.destroy=function(){},B}();const F=k},"./src/demux/mpegaudio.ts":(M,C,u)=>{u.r(C),u.d(C,{appendFrame:()=>k,canParse:()=>P,isHeader:()=>O,isHeaderPattern:()=>B,parseHeader:()=>F,probe:()=>g});var R=null,_=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],U=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],D=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],K=[0,1,1,4];function k(N,S,f,m,d){if(!(f+24>S.length)){var l=F(S,f);if(l&&f+l.frameLength<=S.length){var b=l.samplesPerFrame*9e4/l.sampleRate,h=m+d*b,o={unit:S.subarray(f,f+l.frameLength),pts:h,dts:h};return N.config=[],N.channelCount=l.channelCount,N.samplerate=l.sampleRate,N.samples.push(o),{sample:o,length:l.frameLength,missing:0}}}}function F(N,S){var f=N[S+1]>>3&3,m=N[S+1]>>1&3,d=N[S+2]>>4&15,l=N[S+2]>>2&3;if(f!==1&&d!==0&&d!==15&&l!==3){var b=N[S+2]>>1&1,h=N[S+3]>>6,o=f===3?3-m:m===3?3:4,E=_[o*14+d-1]*1e3,A=f===3?0:f===2?1:2,v=U[A*3+l],c=h===3?1:2,s=D[f][m],p=K[m],a=s*8*p,T=Math.floor(s*E/v+b)*p;if(R===null){var L=navigator.userAgent||"",I=L.match(/Chrome\/(\d+)/i);R=I?parseInt(I[1]):0}var H=!!R&&R<=87;return H&&m===2&&E>=224e3&&h===0&&(N[S+3]=N[S+3]|128),{sampleRate:v,channelCount:c,frameLength:T,samplesPerFrame:a}}}function B(N,S){return N[S]===255&&(N[S+1]&224)===224&&(N[S+1]&6)!==0}function O(N,S){return S+1<N.length&&B(N,S)}function P(N,S){var f=4;return B(N,S)&&f<=N.length-S}function g(N,S){if(S+1<N.length&&B(N,S)){var f=4,m=F(N,S),d=f;m!=null&&m.frameLength&&(d=m.frameLength);var l=S+d;return l===N.length||O(N,l)}return!1}},"./src/demux/sample-aes.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>D});var R=u("./src/crypt/decrypter.ts"),_=u("./src/utils/mp4-tools.ts"),U=function(){function K(F,B,O){this.keyData=void 0,this.decrypter=void 0,this.keyData=O,this.decrypter=new R.default(B,{removePKCS7Padding:!1})}var k=K.prototype;return k.decryptBuffer=function(B){return this.decrypter.decrypt(B,this.keyData.key.buffer,this.keyData.iv.buffer)},k.decryptAacSample=function(B,O,P){var g=this,N=B[O].unit;if(!(N.length<=16)){var S=N.subarray(16,N.length-N.length%16),f=S.buffer.slice(S.byteOffset,S.byteOffset+S.length);this.decryptBuffer(f).then(function(m){var d=new Uint8Array(m);N.set(d,16),g.decrypter.isSync()||g.decryptAacSamples(B,O+1,P)})}},k.decryptAacSamples=function(B,O,P){for(;;O++){if(O>=B.length){P();return}if(!(B[O].unit.length<32)&&(this.decryptAacSample(B,O,P),!this.decrypter.isSync()))return}},k.getAvcEncryptedData=function(B){for(var O=Math.floor((B.length-48)/160)*16+16,P=new Int8Array(O),g=0,N=32;N<B.length-16;N+=160,g+=16)P.set(B.subarray(N,N+16),g);return P},k.getAvcDecryptedUnit=function(B,O){for(var P=new Uint8Array(O),g=0,N=32;N<B.length-16;N+=160,g+=16)B.set(P.subarray(g,g+16),N);return B},k.decryptAvcSample=function(B,O,P,g,N){var S=this,f=(0,_.discardEPB)(N.data),m=this.getAvcEncryptedData(f);this.decryptBuffer(m.buffer).then(function(d){N.data=S.getAvcDecryptedUnit(f,d),S.decrypter.isSync()||S.decryptAvcSamples(B,O,P+1,g)})},k.decryptAvcSamples=function(B,O,P,g){if(B instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;O++,P=0){if(O>=B.length){g();return}for(var N=B[O].units;!(P>=N.length);P++){var S=N[P];if(!(S.data.length<=48||S.type!==1&&S.type!==5)&&(this.decryptAvcSample(B,O,P,g,S),!this.decrypter.isSync()))return}}},K}();const D=U},"./src/demux/transmuxer-interface.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>O});var R=u("./src/demux/webworkify-webpack.js"),_=u("./src/events.ts"),U=u("./src/demux/transmuxer.ts"),D=u("./src/utils/logger.ts"),K=u("./src/errors.ts"),k=u("./src/utils/mediasource-helper.ts"),F=u("./node_modules/eventemitter3/index.js"),B=(0,k.getMediaSource)()||{isTypeSupported:function(){return!1}},O=function(){function P(N,S,f,m){var d=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var l=N.config;this.hls=N,this.id=S,this.useWorker=!!l.enableWorker,this.onTransmuxComplete=f,this.onFlush=m;var b=function(v,c){c=c||{},c.frag=d.frag,c.id=d.id,d.hls.trigger(v,c)};this.observer=new F.EventEmitter,this.observer.on(_.Events.FRAG_DECRYPTED,b),this.observer.on(_.Events.ERROR,b);var h={mp4:B.isTypeSupported("video/mp4"),mpeg:B.isTypeSupported("audio/mpeg"),mp3:B.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){D.logger.log("demuxing in webworker");var E;try{E=this.worker=(0,R.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),E.addEventListener("message",this.onwmsg),E.onerror=function(A){d.useWorker=!1,D.logger.warn("Exception in webworker, fallback to inline"),d.hls.trigger(_.Events.ERROR,{type:K.ErrorTypes.OTHER_ERROR,details:K.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(A.message+"  ("+A.filename+":"+A.lineno+")")})},E.postMessage({cmd:"init",typeSupported:h,vendor:o,id:S,config:JSON.stringify(l)})}catch(A){D.logger.warn("Error in worker:",A),D.logger.error("Error while initializing DemuxerWorker, fallback to inline"),E&&self.URL.revokeObjectURL(E.objectURL),this.transmuxer=new U.default(this.observer,h,l,o,S),this.worker=null}}else this.transmuxer=new U.default(this.observer,h,l,o,S)}var g=P.prototype;return g.destroy=function(){var S=this.worker;if(S)S.removeEventListener("message",this.onwmsg),S.terminate(),this.worker=null,this.onwmsg=void 0;else{var f=this.transmuxer;f&&(f.destroy(),this.transmuxer=null)}var m=this.observer;m&&m.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},g.push=function(S,f,m,d,l,b,h,o,E,A){var v,c,s=this;E.transmuxing.start=self.performance.now();var p=this.transmuxer,a=this.worker,T=b?b.start:l.start,L=l.decryptdata,I=this.frag,H=!(I&&l.cc===I.cc),W=!(I&&E.level===I.level),w=I?E.sn-I.sn:-1,G=this.part?E.part-this.part.index:-1,Y=w===0&&E.id>1&&E.id===(I==null?void 0:I.stats.chunkCount),j=!W&&(w===1||w===0&&(G===1||Y&&G<=0)),X=self.performance.now();(W||w||l.stats.parsing.start===0)&&(l.stats.parsing.start=X),b&&(G||!j)&&(b.stats.parsing.start=X);var q=!(I&&((v=l.initSegment)===null||v===void 0?void 0:v.url)===((c=I.initSegment)===null||c===void 0?void 0:c.url)),J=new U.TransmuxState(H,j,o,W,T,q);if(!j||H||q){D.logger.log("[transmuxer-interface, "+l.type+"]: Starting new transmux session for sn: "+E.sn+" p: "+E.part+" level: "+E.level+" id: "+E.id+`
        discontinuity: `+H+`
        trackSwitch: `+W+`
        contiguous: `+j+`
        accurateTimeOffset: `+o+`
        timeOffset: `+T+`
        initSegmentChange: `+q);var V=new U.TransmuxConfig(m,d,f,h,A);this.configureTransmuxer(V)}if(this.frag=l,this.part=b,a)a.postMessage({cmd:"demux",data:S,decryptdata:L,chunkMeta:E,state:J},S instanceof ArrayBuffer?[S]:[]);else if(p){var Q=p.push(S,L,E,J);(0,U.isPromise)(Q)?(p.async=!0,Q.then(function(ee){s.handleTransmuxComplete(ee)}).catch(function(ee){s.transmuxerError(ee,E,"transmuxer-interface push error")})):(p.async=!1,this.handleTransmuxComplete(Q))}},g.flush=function(S){var f=this;S.transmuxing.start=self.performance.now();var m=this.transmuxer,d=this.worker;if(d)d.postMessage({cmd:"flush",chunkMeta:S});else if(m){var l=m.flush(S),b=(0,U.isPromise)(l);b||m.async?((0,U.isPromise)(l)||(l=Promise.resolve(l)),l.then(function(h){f.handleFlushResult(h,S)}).catch(function(h){f.transmuxerError(h,S,"transmuxer-interface flush error")})):this.handleFlushResult(l,S)}},g.transmuxerError=function(S,f,m){this.hls&&this.hls.trigger(_.Events.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:f,fatal:!1,error:S,err:S,reason:m})},g.handleFlushResult=function(S,f){var m=this;S.forEach(function(d){m.handleTransmuxComplete(d)}),this.onFlush(f)},g.onWorkerMessage=function(S){var f=S.data,m=this.hls;switch(f.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(f.data);break}case"flush":{this.onFlush(f.data);break}case"workerLog":D.logger[f.data.logType]&&D.logger[f.data.logType](f.data.message);break;default:{f.data=f.data||{},f.data.frag=this.frag,f.data.id=this.id,m.trigger(f.event,f.data);break}}},g.configureTransmuxer=function(S){var f=this.worker,m=this.transmuxer;f?f.postMessage({cmd:"configure",config:S}):m&&m.configure(S)},g.handleTransmuxComplete=function(S){S.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(S)},P}()},"./src/demux/transmuxer-worker.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>k});var R=u("./src/demux/transmuxer.ts"),_=u("./src/events.ts"),U=u("./src/utils/logger.ts"),D=u("./node_modules/eventemitter3/index.js"),K=u("./src/errors.ts");function k(g){var N=new D.EventEmitter,S=function(d,l){g.postMessage({event:d,data:l})};N.on(_.Events.FRAG_DECRYPTED,S),N.on(_.Events.ERROR,S);var f=function(){var d=function(h){var o=function(A){S("workerLog",{logType:h,message:A})};U.logger[h]=o};for(var l in U.logger)d(l)};g.addEventListener("message",function(m){var d=m.data;switch(d.cmd){case"init":{var l=JSON.parse(d.config);g.transmuxer=new R.default(N,d.typeSupported,l,d.vendor,d.id),(0,U.enableLogs)(l.debug,d.id),f(),S("init",null);break}case"configure":{g.transmuxer.configure(d.config);break}case"demux":{var b=g.transmuxer.push(d.data,d.decryptdata,d.chunkMeta,d.state);(0,R.isPromise)(b)?(g.transmuxer.async=!0,b.then(function(A){F(g,A)}).catch(function(A){S(_.Events.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:d.chunkMeta,fatal:!1,error:A,err:A,reason:"transmuxer-worker push error"})})):(g.transmuxer.async=!1,F(g,b));break}case"flush":{var h=d.chunkMeta,o=g.transmuxer.flush(h),E=(0,R.isPromise)(o);E||g.transmuxer.async?((0,R.isPromise)(o)||(o=Promise.resolve(o)),o.then(function(A){O(g,A,h)}).catch(function(A){S(_.Events.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:d.chunkMeta,fatal:!1,error:A,err:A,reason:"transmuxer-worker flush error"})})):O(g,o,h);break}}})}function F(g,N){if(P(N.remuxResult))return!1;var S=[],f=N.remuxResult,m=f.audio,d=f.video;return m&&B(S,m),d&&B(S,d),g.postMessage({event:"transmuxComplete",data:N},S),!0}function B(g,N){N.data1&&g.push(N.data1.buffer),N.data2&&g.push(N.data2.buffer)}function O(g,N,S){var f=N.reduce(function(m,d){return F(g,d)||m},!1);f||g.postMessage({event:"transmuxComplete",data:N[0]}),g.postMessage({event:"flush",data:S})}function P(g){return!g.audio&&!g.video&&!g.text&&!g.id3&&!g.initSegment}},"./src/demux/transmuxer.ts":(M,C,u)=>{u.r(C),u.d(C,{TransmuxConfig:()=>l,TransmuxState:()=>b,default:()=>S,isPromise:()=>d});var R=u("./src/events.ts"),_=u("./src/errors.ts"),U=u("./src/crypt/decrypter.ts"),D=u("./src/demux/aacdemuxer.ts"),K=u("./src/demux/mp4demuxer.ts"),k=u("./src/demux/tsdemuxer.ts"),F=u("./src/demux/mp3demuxer.ts"),B=u("./src/remux/mp4-remuxer.ts"),O=u("./src/remux/passthrough-remuxer.ts"),P=u("./src/utils/logger.ts"),g;try{g=self.performance.now.bind(self.performance)}catch{P.logger.debug("Unable to use Performance API on this environment"),g=self.Date.now}var N=[{demux:K.default,remux:O.default},{demux:k.default,remux:B.default},{demux:D.default,remux:B.default},{demux:F.default,remux:B.default}],S=function(){function h(E,A,v,c,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=E,this.typeSupported=A,this.config=v,this.vendor=c,this.id=s}var o=h.prototype;return o.configure=function(A){this.transmuxConfig=A,this.decrypter&&this.decrypter.reset()},o.push=function(A,v,c,s){var p=this,a=c.transmuxing;a.executeStart=g();var T=new Uint8Array(A),L=this.currentTransmuxState,I=this.transmuxConfig;s&&(this.currentTransmuxState=s);var H=s||L,W=H.contiguous,w=H.discontinuity,G=H.trackSwitch,Y=H.accurateTimeOffset,j=H.timeOffset,X=H.initSegmentChange,q=I.audioCodec,J=I.videoCodec,V=I.defaultInitPts,Q=I.duration,ee=I.initSegmentData,Z=f(T,v);if(Z&&Z.method==="AES-128"){var re=this.getDecrypter();if(re.isSync()){var ae=re.softwareDecrypt(T,Z.key.buffer,Z.iv.buffer);if(!ae)return a.executeEnd=g(),m(c);T=new Uint8Array(ae)}else return this.decryptionPromise=re.webCryptoDecrypt(T,Z.key.buffer,Z.iv.buffer).then(function(ue){var ge=p.push(ue,null,c);return p.decryptionPromise=null,ge}),this.decryptionPromise}var le=this.needsProbing(w,G);le&&this.configureTransmuxer(T),(w||G||X||le)&&this.resetInitSegment(ee,q,J,Q,v),(w||X||le)&&this.resetInitialTimestamp(V),W||this.resetContiguity();var ne=this.transmux(T,Z,j,Y,c),ie=this.currentTransmuxState;return ie.contiguous=!0,ie.discontinuity=!1,ie.trackSwitch=!1,a.executeEnd=g(),ne},o.flush=function(A){var v=this,c=A.transmuxing;c.executeStart=g();var s=this.decrypter,p=this.currentTransmuxState,a=this.decryptionPromise;if(a)return a.then(function(){return v.flush(A)});var T=[],L=p.timeOffset;if(s){var I=s.flush();I&&T.push(this.push(I,null,A))}var H=this.demuxer,W=this.remuxer;if(!H||!W)return this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),c.executeEnd=g(),[m(A)];var w=H.flush(L);return d(w)?w.then(function(G){return v.flushRemux(T,G,A),T}):(this.flushRemux(T,w,A),T)},o.flushRemux=function(A,v,c){var s=v.audioTrack,p=v.videoTrack,a=v.id3Track,T=v.textTrack,L=this.currentTransmuxState,I=L.accurateTimeOffset,H=L.timeOffset;P.logger.log("[transmuxer.ts]: Flushed fragment "+c.sn+(c.part>-1?" p: "+c.part:"")+" of level "+c.level);var W=this.remuxer.remux(s,p,a,T,H,I,!0,this.id);A.push({remuxResult:W,chunkMeta:c}),c.transmuxing.executeEnd=g()},o.resetInitialTimestamp=function(A){var v=this.demuxer,c=this.remuxer;!v||!c||(v.resetTimeStamp(A),c.resetTimeStamp(A))},o.resetContiguity=function(){var A=this.demuxer,v=this.remuxer;!A||!v||(A.resetContiguity(),v.resetNextTimestamp())},o.resetInitSegment=function(A,v,c,s,p){var a=this.demuxer,T=this.remuxer;!a||!T||(a.resetInitSegment(A,v,c,s),T.resetInitSegment(A,v,c,p))},o.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},o.transmux=function(A,v,c,s,p){var a;return v&&v.method==="SAMPLE-AES"?a=this.transmuxSampleAes(A,v,c,s,p):a=this.transmuxUnencrypted(A,c,s,p),a},o.transmuxUnencrypted=function(A,v,c,s){var p=this.demuxer.demux(A,v,!1,!this.config.progressive),a=p.audioTrack,T=p.videoTrack,L=p.id3Track,I=p.textTrack,H=this.remuxer.remux(a,T,L,I,v,c,!1,this.id);return{remuxResult:H,chunkMeta:s}},o.transmuxSampleAes=function(A,v,c,s,p){var a=this;return this.demuxer.demuxSampleAes(A,v,c).then(function(T){var L=a.remuxer.remux(T.audioTrack,T.videoTrack,T.id3Track,T.textTrack,c,s,!1,a.id);return{remuxResult:L,chunkMeta:p}})},o.configureTransmuxer=function(A){for(var v=this.config,c=this.observer,s=this.typeSupported,p=this.vendor,a,T=0,L=N.length;T<L;T++)if(N[T].demux.probe(A)){a=N[T];break}a||(P.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),a={demux:K.default,remux:O.default});var I=this.demuxer,H=this.remuxer,W=a.remux,w=a.demux;(!H||!(H instanceof W))&&(this.remuxer=new W(c,v,s,p)),(!I||!(I instanceof w))&&(this.demuxer=new w(c,v,s),this.probe=w.probe)},o.needsProbing=function(A,v){return!this.demuxer||!this.remuxer||A||v},o.getDecrypter=function(){var A=this.decrypter;return A||(A=this.decrypter=new U.default(this.config)),A},h}();function f(h,o){var E=null;return h.byteLength>0&&o!=null&&o.key!=null&&o.iv!==null&&o.method!=null&&(E=o),E}var m=function(o){return{remuxResult:{},chunkMeta:o}};function d(h){return"then"in h&&h.then instanceof Function}var l=function(o,E,A,v,c){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=o,this.videoCodec=E,this.initSegmentData=A,this.duration=v,this.defaultInitPts=c},b=function(o,E,A,v,c,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=o,this.contiguous=E,this.accurateTimeOffset=A,this.trackSwitch=v,this.timeOffset=c,this.initSegmentChange=s}},"./src/demux/tsdemuxer.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>b});var R=u("./src/demux/adts.ts"),_=u("./src/demux/mpegaudio.ts"),U=u("./src/demux/exp-golomb.ts"),D=u("./src/demux/sample-aes.ts"),K=u("./src/events.ts"),k=u("./src/utils/mp4-tools.ts"),F=u("./src/utils/logger.ts"),B=u("./src/errors.ts"),O=u("./src/types/demuxer.ts");function P(){return P=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var E=arguments[o];for(var A in E)Object.prototype.hasOwnProperty.call(E,A)&&(h[A]=E[A])}return h},P.apply(this,arguments)}var g=188,N=function(){function h(E,A,v){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=E,this.config=A,this.typeSupported=v}h.probe=function(A){var v=h.syncOffset(A);return v>0&&F.logger.warn("MPEG2-TS detected but first sync word found @ offset "+v),v!==-1},h.syncOffset=function(A){for(var v=Math.min(g*5,A.length-g*2)+1,c=0;c<v;){if(A[c]===71&&A[c+g]===71)return c;c++}return-1},h.createTrack=function(A,v){return{container:A==="video"||A==="audio"?"video/mp2t":void 0,type:A,id:k.RemuxerTrackIdConfig[A],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:A==="audio"?v:void 0}};var o=h.prototype;return o.resetInitSegment=function(A,v,c,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=h.createTrack("video"),this._audioTrack=h.createTrack("audio",s),this._id3Track=h.createTrack("id3"),this._txtTrack=h.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=v,this.videoCodec=c,this._duration=s},o.resetTimeStamp=function(){},o.resetContiguity=function(){var A=this._audioTrack,v=this._avcTrack,c=this._id3Track;A&&(A.pesData=null),v&&(v.pesData=null),c&&(c.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},o.demux=function(A,v,c,s){c===void 0&&(c=!1),s===void 0&&(s=!1),c||(this.sampleAes=null);var p,a=this._avcTrack,T=this._audioTrack,L=this._id3Track,I=this._txtTrack,H=a.pid,W=a.pesData,w=T.pid,G=L.pid,Y=T.pesData,j=L.pesData,X=null,q=this.pmtParsed,J=this._pmtId,V=A.length;if(this.remainderData&&(A=(0,k.appendUint8Array)(this.remainderData,A),V=A.length,this.remainderData=null),V<g&&!s)return this.remainderData=A,{audioTrack:T,videoTrack:a,id3Track:L,textTrack:I};var Q=Math.max(0,h.syncOffset(A));V-=(V-Q)%g,V<A.byteLength&&!s&&(this.remainderData=new Uint8Array(A.buffer,V,A.buffer.byteLength-V));for(var ee=0,Z=Q;Z<V;Z+=g)if(A[Z]===71){var re=!!(A[Z+1]&64),ae=((A[Z+1]&31)<<8)+A[Z+2],le=(A[Z+3]&48)>>4,ne=void 0;if(le>1){if(ne=Z+5+A[Z+4],ne===Z+g)continue}else ne=Z+4;switch(ae){case H:re&&(W&&(p=d(W))&&this.parseAVCPES(a,I,p,!1),W={data:[],size:0}),W&&(W.data.push(A.subarray(ne,Z+g)),W.size+=Z+g-ne);break;case w:if(re){if(Y&&(p=d(Y)))switch(T.segmentCodec){case"aac":this.parseAACPES(T,p);break;case"mp3":this.parseMPEGPES(T,p);break}Y={data:[],size:0}}Y&&(Y.data.push(A.subarray(ne,Z+g)),Y.size+=Z+g-ne);break;case G:re&&(j&&(p=d(j))&&this.parseID3PES(L,p),j={data:[],size:0}),j&&(j.data.push(A.subarray(ne,Z+g)),j.size+=Z+g-ne);break;case 0:re&&(ne+=A[ne]+1),J=this._pmtId=f(A,ne);break;case J:{re&&(ne+=A[ne]+1);var ie=m(A,ne,this.typeSupported,c);H=ie.avc,H>0&&(a.pid=H),w=ie.audio,w>0&&(T.pid=w,T.segmentCodec=ie.segmentCodec),G=ie.id3,G>0&&(L.pid=G),X!==null&&!q&&(F.logger.log("unknown PID '"+X+"' in TS found"),X=null,Z=Q-188),q=this.pmtParsed=!0;break}case 17:case 8191:break;default:X=ae;break}}else ee++;ee>0&&this.observer.emit(K.Events.ERROR,K.Events.ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+ee+" TS packet/s that do not start with 0x47"}),a.pesData=W,T.pesData=Y,L.pesData=j;var ue={audioTrack:T,videoTrack:a,id3Track:L,textTrack:I};return s&&this.extractRemainingSamples(ue),ue},o.flush=function(){var A=this.remainderData;this.remainderData=null;var v;return A?v=this.demux(A,-1,!1,!0):v={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(v),this.sampleAes?this.decrypt(v,this.sampleAes):v},o.extractRemainingSamples=function(A){var v=A.audioTrack,c=A.videoTrack,s=A.id3Track,p=A.textTrack,a=c.pesData,T=v.pesData,L=s.pesData,I;if(a&&(I=d(a))?(this.parseAVCPES(c,p,I,!0),c.pesData=null):c.pesData=a,T&&(I=d(T))){switch(v.segmentCodec){case"aac":this.parseAACPES(v,I);break;case"mp3":this.parseMPEGPES(v,I);break}v.pesData=null}else T!=null&&T.size&&F.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=T;L&&(I=d(L))?(this.parseID3PES(s,I),s.pesData=null):s.pesData=L},o.demuxSampleAes=function(A,v,c){var s=this.demux(A,c,!0,!this.config.progressive),p=this.sampleAes=new D.default(this.observer,this.config,v);return this.decrypt(s,p)},o.decrypt=function(A,v){return new Promise(function(c){var s=A.audioTrack,p=A.videoTrack;s.samples&&s.segmentCodec==="aac"?v.decryptAacSamples(s.samples,0,function(){p.samples?v.decryptAvcSamples(p.samples,0,0,function(){c(A)}):c(A)}):p.samples&&v.decryptAvcSamples(p.samples,0,0,function(){c(A)})})},o.destroy=function(){this._duration=0},o.parseAVCPES=function(A,v,c,s){var p=this,a=this.parseAVCNALu(A,c.data),T=this.avcSample,L,I=!1;c.data=null,T&&a.length&&!A.audFound&&(l(T,A),T=this.avcSample=S(!1,c.pts,c.dts,"")),a.forEach(function(H){switch(H.type){case 1:{L=!0,T||(T=p.avcSample=S(!0,c.pts,c.dts,"")),T.frame=!0;var W=H.data;if(I&&W.length>4){var w=new U.default(W).readSliceType();(w===2||w===4||w===7||w===9)&&(T.key=!0)}break}case 5:L=!0,T||(T=p.avcSample=S(!0,c.pts,c.dts,"")),T.key=!0,T.frame=!0;break;case 6:{L=!0,(0,k.parseSEIMessageFromNALu)(H.data,1,c.pts,v.samples);break}case 7:if(L=!0,I=!0,!A.sps){var G=new U.default(H.data),Y=G.readSPS();A.width=Y.width,A.height=Y.height,A.pixelRatio=Y.pixelRatio,A.sps=[H.data],A.duration=p._duration;for(var j=H.data.subarray(1,4),X="avc1.",q=0;q<3;q++){var J=j[q].toString(16);J.length<2&&(J="0"+J),X+=J}A.codec=X}break;case 8:L=!0,A.pps||(A.pps=[H.data]);break;case 9:L=!1,A.audFound=!0,T&&l(T,A),T=p.avcSample=S(!1,c.pts,c.dts,"");break;case 12:L=!0;break;default:L=!1,T&&(T.debug+="unknown NAL "+H.type+" ");break}if(T&&L){var V=T.units;V.push(H)}}),s&&T&&(l(T,A),this.avcSample=null)},o.getLastNalUnit=function(A){var v,c=this.avcSample,s;if((!c||c.units.length===0)&&(c=A[A.length-1]),(v=c)!==null&&v!==void 0&&v.units){var p=c.units;s=p[p.length-1]}return s},o.parseAVCNALu=function(A,v){var c=v.byteLength,s=A.naluState||0,p=s,a=[],T=0,L,I,H,W=-1,w=0;for(s===-1&&(W=0,w=v[0]&31,s=0,T=1);T<c;){if(L=v[T++],!s){s=L?0:1;continue}if(s===1){s=L?0:2;continue}if(!L)s=3;else if(L===1){if(W>=0){var G={data:v.subarray(W,T-s-1),type:w};a.push(G)}else{var Y=this.getLastNalUnit(A.samples);if(Y&&(p&&T<=4-p&&Y.state&&(Y.data=Y.data.subarray(0,Y.data.byteLength-p)),I=T-s-1,I>0)){var j=new Uint8Array(Y.data.byteLength+I);j.set(Y.data,0),j.set(v.subarray(0,I),Y.data.byteLength),Y.data=j,Y.state=0}}T<c?(H=v[T]&31,W=T,w=H,s=0):s=-1}else s=0}if(W>=0&&s>=0){var X={data:v.subarray(W,c),type:w,state:s};a.push(X)}if(a.length===0){var q=this.getLastNalUnit(A.samples);if(q){var J=new Uint8Array(q.data.byteLength+v.byteLength);J.set(q.data,0),J.set(v,q.data.byteLength),q.data=J}}return A.naluState=s,a},o.parseAACPES=function(A,v){var c=0,s=this.aacOverFlow,p=v.data;if(s){this.aacOverFlow=null;var a=s.missing,T=s.sample.unit.byteLength;if(a===-1){var L=new Uint8Array(T+p.byteLength);L.set(s.sample.unit,0),L.set(p,T),p=L}else{var I=T-a;s.sample.unit.set(p.subarray(0,a),I),A.samples.push(s.sample),c=s.missing}}var H,W;for(H=c,W=p.length;H<W-1&&!R.isHeader(p,H);H++);if(H!==c){var w,G;if(H<W-1?(w="AAC PES did not start with ADTS header,offset:"+H,G=!1):(w="no ADTS header found in AAC PES",G=!0),F.logger.warn("parsing error:"+w),this.observer.emit(K.Events.ERROR,K.Events.ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.FRAG_PARSING_ERROR,fatal:G,reason:w}),G)return}R.initTrackConfig(A,this.observer,p,H,this.audioCodec);var Y;if(v.pts!==void 0)Y=v.pts;else if(s){var j=R.getFrameDuration(A.samplerate);Y=s.sample.pts+j}else{F.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var X=0,q;H<W;)if(q=R.appendFrame(A,p,H,Y,X),H+=q.length,q.missing){this.aacOverFlow=q;break}else for(X++;H<W-1&&!R.isHeader(p,H);H++);},o.parseMPEGPES=function(A,v){var c=v.data,s=c.length,p=0,a=0,T=v.pts;if(T===void 0){F.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<s;)if(_.isHeader(c,a)){var L=_.appendFrame(A,c,a,T,p);if(L)a+=L.length,p++;else break}else a++},o.parseID3PES=function(A,v){if(v.pts===void 0){F.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var c=P({},v,{type:this._avcTrack?O.MetadataSchema.emsg:O.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});A.samples.push(c)},h}();function S(h,o,E,A){return{key:h,frame:!1,pts:o,dts:E,units:[],debug:A,length:0}}function f(h,o){return(h[o+10]&31)<<8|h[o+11]}function m(h,o,E,A){var v={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},c=(h[o+1]&15)<<8|h[o+2],s=o+3+c-4,p=(h[o+10]&15)<<8|h[o+11];for(o+=12+p;o<s;){var a=(h[o+1]&31)<<8|h[o+2];switch(h[o]){case 207:if(!A){F.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:v.audio===-1&&(v.audio=a);break;case 21:v.id3===-1&&(v.id3=a);break;case 219:if(!A){F.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:v.avc===-1&&(v.avc=a);break;case 3:case 4:E.mpeg!==!0&&E.mp3!==!0?F.logger.log("MPEG audio found, not supported in this browser"):v.audio===-1&&(v.audio=a,v.segmentCodec="mp3");break;case 36:F.logger.warn("Unsupported HEVC stream type found");break}o+=((h[o+3]&15)<<8|h[o+4])+5}return v}function d(h){var o=0,E,A,v,c,s,p=h.data;if(!h||h.size===0)return null;for(;p[0].length<19&&p.length>1;){var a=new Uint8Array(p[0].length+p[1].length);a.set(p[0]),a.set(p[1],p[0].length),p[0]=a,p.splice(1,1)}E=p[0];var T=(E[0]<<16)+(E[1]<<8)+E[2];if(T===1){if(A=(E[4]<<8)+E[5],A&&A>h.size-6)return null;var L=E[7];L&192&&(c=(E[9]&14)*536870912+(E[10]&255)*4194304+(E[11]&254)*16384+(E[12]&255)*128+(E[13]&254)/2,L&64?(s=(E[14]&14)*536870912+(E[15]&255)*4194304+(E[16]&254)*16384+(E[17]&255)*128+(E[18]&254)/2,c-s>54e5&&(F.logger.warn(Math.round((c-s)/9e4)+"s delta between PTS and DTS, align them"),c=s)):s=c),v=E[8];var I=v+9;if(h.size<=I)return null;h.size-=I;for(var H=new Uint8Array(h.size),W=0,w=p.length;W<w;W++){E=p[W];var G=E.byteLength;if(I)if(I>G){I-=G;continue}else E=E.subarray(I),G-=I,I=0;H.set(E,o),o+=G}return A&&(A-=v+3),{data:H,pts:c,dts:s,len:A}}return null}function l(h,o){if(h.units.length&&h.frame){if(h.pts===void 0){var E=o.samples,A=E.length;if(A){var v=E[A-1];h.pts=v.pts,h.dts=v.dts}else{o.dropped++;return}}o.samples.push(h)}h.debug.length&&F.logger.log(h.pts+"/"+h.dts+":"+h.debug)}const b=N},"./src/demux/webworkify-webpack.js":(M,C,u)=>{u.r(C),u.d(C,{default:()=>g});var R=function(){var S=ENTRY_MODULE,f={},m=function l(b){var h=f[b];if(h!==void 0)return h.exports;var o=f[b]={exports:{}};return S[b].call(o.exports,o,o.exports,l),o.exports};m.m=S,function(){m.n=function(l){var b=l&&l.__esModule?function(){return l.default}:function(){return l};return m.d(b,{a:b}),b}}(),function(){m.d=function(l,b){for(var h in b)m.o(b,h)&&!m.o(l,h)&&Object.defineProperty(l,h,{enumerable:!0,get:b[h]})}}(),function(){m.o=function(l,b){return Object.prototype.hasOwnProperty.call(l,b)}}(),function(){m.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})}}();var d=m(ENTRY_MODULE);return d.default||d},_=R.toString().split("ENTRY_MODULE"),U="[\\.|\\-|\\+|\\w|/|@]+",D="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+U+").*?\\)";function K(N){return(N+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function k(N){return!isNaN(1*N)}function F(N,S,f){var m={};m[f]=[];var d=S.toString().replace(/^"[^"]+"/,"function"),l=d.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||d.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!l)return m;for(var b=l[1],h=new RegExp("(\\\\n|\\W)"+K(b)+D,"g"),o;o=h.exec(d);)o[3]!=="dll-reference"&&m[f].push(o[3]);for(h=new RegExp("\\("+K(b)+'\\("(dll-reference\\s('+U+'))"\\)\\)'+D,"g");o=h.exec(d);)N[o[2]]||(m[f].push(o[1]),N[o[2]]=u(o[1]).m),m[o[2]]=m[o[2]]||[],m[o[2]].push(o[4]);for(var E=Object.keys(m),A=0;A<E.length;A++)for(var v=0;v<m[E[A]].length;v++)k(m[E[A]][v])&&(m[E[A]][v]=1*m[E[A]][v]);return m}function B(N){var S=Object.keys(N);return S.reduce(function(f,m){return f||N[m].length>0},!1)}function O(N,S){for(var f={main:[S]},m={main:[]},d={main:{}};B(f);)for(var l=Object.keys(f),b=0;b<l.length;b++){var h=l[b],o=f[h],E=o.pop();if(d[h]=d[h]||{},!(d[h][E]||!N[h][E])){d[h][E]=!0,m[h]=m[h]||[],m[h].push(E);for(var A=F(N,N[h][E],h),v=Object.keys(A),c=0;c<v.length;c++)f[v[c]]=f[v[c]]||[],f[v[c]]=f[v[c]].concat(A[v[c]])}}return m}function P(N,S,f,m){var d=N[m].map(function(l){return'"'+l+'": '+S[m][l].toString().replace(/^"[^"]+"/,"function")}).join(",");return _[0]+"{"+d+"}"+_[1]+'"'+f+'"'+_[2]}function g(N,S){S=S||{};var f={main:u.m},m=S.all?{main:Object.keys(f.main)}:O(f,N),d="";Object.keys(m).filter(function(E){return E!=="main"}).forEach(function(E){for(var A=0;m[E][A];)A++;m[E].push(A),f[E][A]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",d=d+("var "+E+" = ("+P(m,f,A,modules)+`)();
`)}),d=d+("new (("+P(m,f,N,"main")+")())(self);");var l=new window.Blob([d],{type:"text/javascript"}),b=window.URL||window.webkitURL||window.mozURL||window.msURL,h=b.createObjectURL(l),o=new window.Worker(h);return o.objectURL=h,o}},"./src/errors.ts":(M,C,u)=>{u.r(C),u.d(C,{ErrorDetails:()=>_,ErrorTypes:()=>R});var R;(function(U){U.NETWORK_ERROR="networkError",U.MEDIA_ERROR="mediaError",U.KEY_SYSTEM_ERROR="keySystemError",U.MUX_ERROR="muxError",U.OTHER_ERROR="otherError"})(R||(R={}));var _;(function(U){U.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",U.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",U.KEY_SYSTEM_NO_SESSION="keySystemNoSession",U.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",U.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",U.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",U.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",U.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",U.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",U.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",U.MANIFEST_LOAD_ERROR="manifestLoadError",U.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",U.MANIFEST_PARSING_ERROR="manifestParsingError",U.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",U.LEVEL_EMPTY_ERROR="levelEmptyError",U.LEVEL_LOAD_ERROR="levelLoadError",U.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",U.LEVEL_SWITCH_ERROR="levelSwitchError",U.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",U.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",U.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",U.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",U.FRAG_LOAD_ERROR="fragLoadError",U.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",U.FRAG_DECRYPT_ERROR="fragDecryptError",U.FRAG_PARSING_ERROR="fragParsingError",U.REMUX_ALLOC_ERROR="remuxAllocError",U.KEY_LOAD_ERROR="keyLoadError",U.KEY_LOAD_TIMEOUT="keyLoadTimeOut",U.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",U.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",U.BUFFER_APPEND_ERROR="bufferAppendError",U.BUFFER_APPENDING_ERROR="bufferAppendingError",U.BUFFER_STALLED_ERROR="bufferStalledError",U.BUFFER_FULL_ERROR="bufferFullError",U.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",U.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",U.INTERNAL_EXCEPTION="internalException",U.INTERNAL_ABORTED="aborted",U.UNKNOWN="unknown"})(_||(_={}))},"./src/events.ts":(M,C,u)=>{u.r(C),u.d(C,{Events:()=>R});var R;(function(_){_.MEDIA_ATTACHING="hlsMediaAttaching",_.MEDIA_ATTACHED="hlsMediaAttached",_.MEDIA_DETACHING="hlsMediaDetaching",_.MEDIA_DETACHED="hlsMediaDetached",_.BUFFER_RESET="hlsBufferReset",_.BUFFER_CODECS="hlsBufferCodecs",_.BUFFER_CREATED="hlsBufferCreated",_.BUFFER_APPENDING="hlsBufferAppending",_.BUFFER_APPENDED="hlsBufferAppended",_.BUFFER_EOS="hlsBufferEos",_.BUFFER_FLUSHING="hlsBufferFlushing",_.BUFFER_FLUSHED="hlsBufferFlushed",_.MANIFEST_LOADING="hlsManifestLoading",_.MANIFEST_LOADED="hlsManifestLoaded",_.MANIFEST_PARSED="hlsManifestParsed",_.LEVEL_SWITCHING="hlsLevelSwitching",_.LEVEL_SWITCHED="hlsLevelSwitched",_.LEVEL_LOADING="hlsLevelLoading",_.LEVEL_LOADED="hlsLevelLoaded",_.LEVEL_UPDATED="hlsLevelUpdated",_.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",_.LEVELS_UPDATED="hlsLevelsUpdated",_.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",_.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",_.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",_.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",_.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",_.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",_.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",_.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",_.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",_.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",_.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",_.CUES_PARSED="hlsCuesParsed",_.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",_.INIT_PTS_FOUND="hlsInitPtsFound",_.FRAG_LOADING="hlsFragLoading",_.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",_.FRAG_LOADED="hlsFragLoaded",_.FRAG_DECRYPTED="hlsFragDecrypted",_.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",_.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",_.FRAG_PARSING_METADATA="hlsFragParsingMetadata",_.FRAG_PARSED="hlsFragParsed",_.FRAG_BUFFERED="hlsFragBuffered",_.FRAG_CHANGED="hlsFragChanged",_.FPS_DROP="hlsFpsDrop",_.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",_.ERROR="hlsError",_.DESTROYING="hlsDestroying",_.KEY_LOADING="hlsKeyLoading",_.KEY_LOADED="hlsKeyLoaded",_.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",_.BACK_BUFFER_REACHED="hlsBackBufferReached"})(R||(R={}))},"./src/hls.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>o});var R=u("./node_modules/url-toolkit/src/url-toolkit.js"),_=u("./src/loader/playlist-loader.ts"),U=u("./src/controller/id3-track-controller.ts"),D=u("./src/controller/latency-controller.ts"),K=u("./src/controller/level-controller.ts"),k=u("./src/controller/fragment-tracker.ts"),F=u("./src/loader/key-loader.ts"),B=u("./src/controller/stream-controller.ts"),O=u("./src/is-supported.ts"),P=u("./src/utils/logger.ts"),g=u("./src/config.ts"),N=u("./node_modules/eventemitter3/index.js"),S=u("./src/events.ts"),f=u("./src/errors.ts"),m=u("./src/types/level.ts");function d(E,A){for(var v=0;v<A.length;v++){var c=A[v];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(E,b(c.key),c)}}function l(E,A,v){return A&&d(E.prototype,A),v&&d(E,v),Object.defineProperty(E,"prototype",{writable:!1}),E}function b(E){var A=h(E,"string");return typeof A=="symbol"?A:String(A)}function h(E,A){if(typeof E!="object"||E===null)return E;var v=E[Symbol.toPrimitive];if(v!==void 0){var c=v.call(E,A||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(A==="string"?String:Number)(E)}var o=function(){E.isSupported=function(){return(0,O.isSupported)()};function E(v){v===void 0&&(v={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new N.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var c=this.config=(0,g.mergeConfig)(E.DefaultConfig,v);this.userConfig=v,(0,P.enableLogs)(c.debug,"Hls instance"),this._autoLevelCapping=-1,c.progressive&&(0,g.enableStreamingMode)(c);var s=c.abrController,p=c.bufferController,a=c.capLevelController,T=c.fpsController,L=this.abrController=new s(this),I=this.bufferController=new p(this),H=this.capLevelController=new a(this),W=new T(this),w=new _.default(this),G=new U.default(this),Y=this.levelController=new K.default(this),j=new k.FragmentTracker(this),X=new F.default(this.config),q=this.streamController=new B.default(this,j,X);H.setStreamController(q),W.setStreamController(q);var J=[w,Y,q];this.networkControllers=J;var V=[L,I,H,W,G,j];this.audioTrackController=this.createController(c.audioTrackController,J);var Q=c.audioStreamController;Q&&J.push(new Q(this,j,X)),this.subtitleTrackController=this.createController(c.subtitleTrackController,J);var ee=c.subtitleStreamController;ee&&J.push(new ee(this,j,X)),this.createController(c.timelineController,V),X.emeController=this.emeController=this.createController(c.emeController,V),this.cmcdController=this.createController(c.cmcdController,V),this.latencyController=this.createController(D.default,V),this.coreComponents=V}var A=E.prototype;return A.createController=function(c,s){if(c){var p=new c(this);return s&&s.push(p),p}return null},A.on=function(c,s,p){p===void 0&&(p=this),this._emitter.on(c,s,p)},A.once=function(c,s,p){p===void 0&&(p=this),this._emitter.once(c,s,p)},A.removeAllListeners=function(c){this._emitter.removeAllListeners(c)},A.off=function(c,s,p,a){p===void 0&&(p=this),this._emitter.off(c,s,p,a)},A.listeners=function(c){return this._emitter.listeners(c)},A.emit=function(c,s,p){return this._emitter.emit(c,s,p)},A.trigger=function(c,s){if(this.config.debug)return this.emit(c,c,s);try{return this.emit(c,c,s)}catch(p){P.logger.error("An internal error happened while handling event "+c+'. Error message: "'+p.message+'". Here is a stacktrace:',p),this.trigger(S.Events.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:c,error:p})}return!1},A.listenerCount=function(c){return this._emitter.listenerCount(c)},A.destroy=function(){P.logger.log("destroy"),this.trigger(S.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(c){return c.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(c){return c.destroy()}),this.coreComponents.length=0},A.attachMedia=function(c){P.logger.log("attachMedia"),this._media=c,this.trigger(S.Events.MEDIA_ATTACHING,{media:c})},A.detachMedia=function(){P.logger.log("detachMedia"),this.trigger(S.Events.MEDIA_DETACHING,void 0),this._media=null},A.loadSource=function(c){this.stopLoad();var s=this.media,p=this.url,a=this.url=R.buildAbsoluteURL(self.location.href,c,{alwaysNormalize:!0});P.logger.log("loadSource:"+a),s&&p&&p!==a&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(s)),this.trigger(S.Events.MANIFEST_LOADING,{url:c})},A.startLoad=function(c){c===void 0&&(c=-1),P.logger.log("startLoad("+c+")"),this.networkControllers.forEach(function(s){s.startLoad(c)})},A.stopLoad=function(){P.logger.log("stopLoad"),this.networkControllers.forEach(function(c){c.stopLoad()})},A.swapAudioCodec=function(){P.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},A.recoverMediaError=function(){P.logger.log("recoverMediaError");var c=this._media;this.detachMedia(),c&&this.attachMedia(c)},A.removeLevel=function(c,s){s===void 0&&(s=0),this.levelController.removeLevel(c,s)},l(E,[{key:"levels",get:function(){var c=this.levelController.levels;return c||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(c){P.logger.log("set currentLevel:"+c),this.loadLevel=c,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(c){P.logger.log("set nextLevel:"+c),this.levelController.manualLevel=c,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(c){P.logger.log("set loadLevel:"+c),this.levelController.manualLevel=c}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(c){this.levelController.nextLoadLevel=c}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(c){P.logger.log("set firstLevel:"+c),this.levelController.firstLevel=c}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(c){P.logger.log("set startLevel:"+c),c!==-1&&(c=Math.max(c,this.minAutoLevel)),this.levelController.startLevel=c}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(c){var s=!!c;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(c){this._autoLevelCapping!==c&&(P.logger.log("set autoLevelCapping:"+c),this._autoLevelCapping=c)}},{key:"bandwidthEstimate",get:function(){var c=this.abrController.bwEstimator;return c?c.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(c){m.HdcpLevels.indexOf(c)>-1&&(this._maxHdcpLevel=c)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var c=this.levels,s=this.config.minAutoBitrate;if(!c)return 0;for(var p=c.length,a=0;a<p;a++)if(c[a].maxBitrate>=s)return a;return 0}},{key:"maxAutoLevel",get:function(){var c=this.levels,s=this.autoLevelCapping,p=this.maxHdcpLevel,a;if(s===-1&&c&&c.length?a=c.length-1:a=s,p)for(var T=a;T--;){var L=c[T].attrs["HDCP-LEVEL"];if(L&&L<=p)return T}return a}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(c){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,c)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var c=this.audioTrackController;return c?c.audioTracks:[]}},{key:"audioTrack",get:function(){var c=this.audioTrackController;return c?c.audioTrack:-1},set:function(c){var s=this.audioTrackController;s&&(s.audioTrack=c)}},{key:"subtitleTracks",get:function(){var c=this.subtitleTrackController;return c?c.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var c=this.subtitleTrackController;return c?c.subtitleTrack:-1},set:function(c){var s=this.subtitleTrackController;s&&(s.subtitleTrack=c)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var c=this.subtitleTrackController;return c?c.subtitleDisplay:!1},set:function(c){var s=this.subtitleTrackController;s&&(s.subtitleDisplay=c)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(c){this.config.lowLatencyMode=c}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.3.1"}},{key:"Events",get:function(){return S.Events}},{key:"ErrorTypes",get:function(){return f.ErrorTypes}},{key:"ErrorDetails",get:function(){return f.ErrorDetails}},{key:"DefaultConfig",get:function(){return E.defaultConfig?E.defaultConfig:g.hlsDefaultConfig},set:function(c){E.defaultConfig=c}}]),E}();o.defaultConfig=void 0},"./src/is-supported.ts":(M,C,u)=>{u.r(C),u.d(C,{changeTypeSupported:()=>D,isSupported:()=>U});var R=u("./src/utils/mediasource-helper.ts");function _(){return self.SourceBuffer||self.WebKitSourceBuffer}function U(){var K=(0,R.getMediaSource)();if(!K)return!1;var k=_(),F=K&&typeof K.isTypeSupported=="function"&&K.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),B=!k||k.prototype&&typeof k.prototype.appendBuffer=="function"&&typeof k.prototype.remove=="function";return!!F&&!!B}function D(){var K,k=_();return typeof(k==null||(K=k.prototype)===null||K===void 0?void 0:K.changeType)=="function"}},"./src/loader/date-range.ts":(M,C,u)=>{u.r(C),u.d(C,{DateRange:()=>P,DateRangeAttribute:()=>O});var R=u("./src/polyfills/number.ts"),_=u("./src/utils/attr-list.ts"),U=u("./src/utils/logger.ts");function D(){return D=Object.assign?Object.assign.bind():function(g){for(var N=1;N<arguments.length;N++){var S=arguments[N];for(var f in S)Object.prototype.hasOwnProperty.call(S,f)&&(g[f]=S[f])}return g},D.apply(this,arguments)}function K(g,N){for(var S=0;S<N.length;S++){var f=N[S];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(g,F(f.key),f)}}function k(g,N,S){return N&&K(g.prototype,N),S&&K(g,S),Object.defineProperty(g,"prototype",{writable:!1}),g}function F(g){var N=B(g,"string");return typeof N=="symbol"?N:String(N)}function B(g,N){if(typeof g!="object"||g===null)return g;var S=g[Symbol.toPrimitive];if(S!==void 0){var f=S.call(g,N||"default");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return(N==="string"?String:Number)(g)}var O;(function(g){g.ID="ID",g.CLASS="CLASS",g.START_DATE="START-DATE",g.DURATION="DURATION",g.END_DATE="END-DATE",g.END_ON_NEXT="END-ON-NEXT",g.PLANNED_DURATION="PLANNED-DURATION",g.SCTE35_OUT="SCTE35-OUT",g.SCTE35_IN="SCTE35-IN"})(O||(O={}));var P=function(){function g(N,S){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,S){var f=S.attr;for(var m in f)if(Object.prototype.hasOwnProperty.call(N,m)&&N[m]!==f[m]){U.logger.warn('DATERANGE tag attribute: "'+m+'" does not match for tags with ID: "'+N.ID+'"'),this._badValueForSameId=m;break}N=D(new _.AttrList({}),f,N)}if(this.attr=N,this._startDate=new Date(N[O.START_DATE]),O.END_DATE in this.attr){var d=new Date(this.attr[O.END_DATE]);(0,R.isFiniteNumber)(d.getTime())&&(this._endDate=d)}}return k(g,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var S=this.duration;return S!==null?new Date(this._startDate.getTime()+S*1e3):null}},{key:"duration",get:function(){if(O.DURATION in this.attr){var S=this.attr.decimalFloatingPoint(O.DURATION);if((0,R.isFiniteNumber)(S))return S}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return O.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(O.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(O.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,R.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),g}()},"./src/loader/fragment-loader.ts":(M,C,u)=>{u.r(C),u.d(C,{LoadError:()=>S,default:()=>g});var R=u("./src/polyfills/number.ts"),_=u("./src/errors.ts");function U(f,m){f.prototype=Object.create(m.prototype),f.prototype.constructor=f,B(f,m)}function D(f){var m=typeof Map=="function"?new Map:void 0;return D=function(l){if(l===null||!F(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(typeof m<"u"){if(m.has(l))return m.get(l);m.set(l,b)}function b(){return K(l,arguments,O(this).constructor)}return b.prototype=Object.create(l.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),B(b,l)},D(f)}function K(f,m,d){return k()?K=Reflect.construct.bind():K=function(b,h,o){var E=[null];E.push.apply(E,h);var A=Function.bind.apply(b,E),v=new A;return o&&B(v,o.prototype),v},K.apply(null,arguments)}function k(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function F(f){return Function.toString.call(f).indexOf("[native code]")!==-1}function B(f,m){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,b){return l.__proto__=b,l},B(f,m)}function O(f){return O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},O(f)}var P=Math.pow(2,17),g=function(){function f(d){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=d}var m=f.prototype;return m.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},m.abort=function(){this.loader&&this.loader.abort()},m.load=function(l,b){var h=this,o=l.url;if(!o)return Promise.reject(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,networkDetails:null},"Fragment does not have a "+(o?"part list":"url")));this.abort();var E=this.config,A=E.fLoader,v=E.loader;return new Promise(function(c,s){h.loader&&h.loader.destroy();var p=h.loader=l.loader=A?new A(E):new v(E),a=N(l),T={timeout:E.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:E.fragLoadingMaxRetryTimeout,highWaterMark:l.sn==="initSegment"?1/0:P};l.stats=p.stats,p.load(a,T,{onSuccess:function(I,H,W,w){h.resetLoader(l,p);var G=I.data;W.resetIV&&l.decryptdata&&(l.decryptdata.iv=new Uint8Array(G.slice(0,16)),G=G.slice(16)),c({frag:l,part:null,payload:G,networkDetails:w})},onError:function(I,H,W){h.resetLoader(l,p),s(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,response:I,networkDetails:W}))},onAbort:function(I,H,W){h.resetLoader(l,p),s(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:l,networkDetails:W}))},onTimeout:function(I,H,W){h.resetLoader(l,p),s(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,networkDetails:W}))},onProgress:function(I,H,W,w){b&&b({frag:l,part:null,payload:W,networkDetails:w})}})})},m.loadPart=function(l,b,h){var o=this;this.abort();var E=this.config,A=E.fLoader,v=E.loader;return new Promise(function(c,s){o.loader&&o.loader.destroy();var p=o.loader=l.loader=A?new A(E):new v(E),a=N(l,b),T={timeout:E.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:E.fragLoadingMaxRetryTimeout,highWaterMark:P};b.stats=p.stats,p.load(a,T,{onSuccess:function(I,H,W,w){o.resetLoader(l,p),o.updateStatsFromPart(l,b);var G={frag:l,part:b,payload:I.data,networkDetails:w};h(G),c(G)},onError:function(I,H,W){o.resetLoader(l,p),s(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,part:b,response:I,networkDetails:W}))},onAbort:function(I,H,W){l.stats.aborted=b.stats.aborted,o.resetLoader(l,p),s(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:l,part:b,networkDetails:W}))},onTimeout:function(I,H,W){o.resetLoader(l,p),s(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,part:b,networkDetails:W}))}})})},m.updateStatsFromPart=function(l,b){var h=l.stats,o=b.stats,E=o.total;if(h.loaded+=o.loaded,E){var A=Math.round(l.duration/b.duration),v=Math.min(Math.round(h.loaded/E),A),c=A-v,s=c*Math.round(h.loaded/v);h.total=h.loaded+s}else h.total=Math.max(h.loaded,h.total);var p=h.loading,a=o.loading;p.start?p.first+=a.first-a.start:(p.start=a.start,p.first=a.first),p.end=a.end},m.resetLoader=function(l,b){l.loader=null,this.loader===b&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),b.destroy()},f}();function N(f,m){m===void 0&&(m=null);var d=m||f,l={frag:f,part:m,responseType:"arraybuffer",url:d.url,headers:{},rangeStart:0,rangeEnd:0},b=d.byteRangeStartOffset,h=d.byteRangeEndOffset;if((0,R.isFiniteNumber)(b)&&(0,R.isFiniteNumber)(h)){var o,E=b,A=h;if(f.sn==="initSegment"&&((o=f.decryptdata)===null||o===void 0?void 0:o.method)==="AES-128"){var v=h-b;v%16&&(A=h+(16-v%16)),b!==0&&(l.resetIV=!0,E=b-16)}l.rangeStart=E,l.rangeEnd=A}return l}var S=function(f){U(m,f);function m(d){for(var l,b=arguments.length,h=new Array(b>1?b-1:0),o=1;o<b;o++)h[o-1]=arguments[o];return l=f.call.apply(f,[this].concat(h))||this,l.data=void 0,l.data=d,l}return m}(D(Error))},"./src/loader/fragment.ts":(M,C,u)=>{u.r(C),u.d(C,{BaseSegment:()=>g,ElementaryStreamTypes:()=>P,Fragment:()=>N,Part:()=>S});var R=u("./src/polyfills/number.ts"),_=u("./node_modules/url-toolkit/src/url-toolkit.js"),U=u("./src/loader/load-stats.ts");function D(f,m){f.prototype=Object.create(m.prototype),f.prototype.constructor=f,K(f,m)}function K(f,m){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,b){return l.__proto__=b,l},K(f,m)}function k(f,m){for(var d=0;d<m.length;d++){var l=m[d];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(f,B(l.key),l)}}function F(f,m,d){return m&&k(f.prototype,m),d&&k(f,d),Object.defineProperty(f,"prototype",{writable:!1}),f}function B(f){var m=O(f,"string");return typeof m=="symbol"?m:String(m)}function O(f,m){if(typeof f!="object"||f===null)return f;var d=f[Symbol.toPrimitive];if(d!==void 0){var l=d.call(f,m||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(f)}var P;(function(f){f.AUDIO="audio",f.VIDEO="video",f.AUDIOVIDEO="audiovideo"})(P||(P={}));var g=function(){function f(d){var l;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(l={},l[P.AUDIO]=null,l[P.VIDEO]=null,l[P.AUDIOVIDEO]=null,l),this.baseurl=d}var m=f.prototype;return m.setByteRange=function(l,b){var h=l.split("@",2),o=[];h.length===1?o[0]=b?b.byteRangeEndOffset:0:o[0]=parseInt(h[1]),o[1]=parseInt(h[0])+o[0],this._byteRange=o},F(f,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,_.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(l){this._url=l}}]),f}(),N=function(f){D(m,f);function m(l,b){var h;return h=f.call(this,b)||this,h._decryptdata=null,h.rawProgramDateTime=null,h.programDateTime=null,h.tagList=[],h.duration=0,h.sn=0,h.levelkeys=void 0,h.type=void 0,h.loader=null,h.keyLoader=null,h.level=-1,h.cc=0,h.startPTS=void 0,h.endPTS=void 0,h.appendedPTS=void 0,h.startDTS=void 0,h.endDTS=void 0,h.start=0,h.deltaPTS=void 0,h.maxStartPTS=void 0,h.minEndPTS=void 0,h.stats=new U.LoadStats,h.urlId=0,h.data=void 0,h.bitrateTest=!1,h.title=null,h.initSegment=null,h.endList=void 0,h.type=l,h}var d=m.prototype;return d.setKeyFormat=function(b){if(this.levelkeys){var h=this.levelkeys[b];h&&!this._decryptdata&&(this._decryptdata=h.getDecryptData(this.sn))}},d.abortRequests=function(){var b,h;(b=this.loader)===null||b===void 0||b.abort(),(h=this.keyLoader)===null||h===void 0||h.abort()},d.setElementaryStreamInfo=function(b,h,o,E,A,v){v===void 0&&(v=!1);var c=this.elementaryStreams,s=c[b];if(!s){c[b]={startPTS:h,endPTS:o,startDTS:E,endDTS:A,partial:v};return}s.startPTS=Math.min(s.startPTS,h),s.endPTS=Math.max(s.endPTS,o),s.startDTS=Math.min(s.startDTS,E),s.endDTS=Math.max(s.endDTS,A)},d.clearElementaryStreamInfo=function(){var b=this.elementaryStreams;b[P.AUDIO]=null,b[P.VIDEO]=null,b[P.AUDIOVIDEO]=null},F(m,[{key:"decryptdata",get:function(){var b=this.levelkeys;if(!b&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var h=this.levelkeys.identity;if(h)this._decryptdata=h.getDecryptData(this.sn);else{var o=Object.keys(this.levelkeys);if(o.length===1)return this._decryptdata=this.levelkeys[o[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,R.isFiniteNumber)(this.programDateTime))return null;var b=(0,R.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+b*1e3}},{key:"encrypted",get:function(){var b;if((b=this._decryptdata)!==null&&b!==void 0&&b.encrypted)return!0;if(this.levelkeys){var h=Object.keys(this.levelkeys),o=h.length;if(o>1||o===1&&this.levelkeys[h[0]].encrypted)return!0}return!1}}]),m}(g),S=function(f){D(m,f);function m(d,l,b,h,o){var E;E=f.call(this,b)||this,E.fragOffset=0,E.duration=0,E.gap=!1,E.independent=!1,E.relurl=void 0,E.fragment=void 0,E.index=void 0,E.stats=new U.LoadStats,E.duration=d.decimalFloatingPoint("DURATION"),E.gap=d.bool("GAP"),E.independent=d.bool("INDEPENDENT"),E.relurl=d.enumeratedString("URI"),E.fragment=l,E.index=h;var A=d.enumeratedString("BYTERANGE");return A&&E.setByteRange(A,o),o&&(E.fragOffset=o.fragOffset+o.duration),E}return F(m,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var l=this.elementaryStreams;return!!(l.audio||l.video||l.audiovideo)}}]),m}(g)},"./src/loader/key-loader.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>U});var R=u("./src/errors.ts"),_=u("./src/loader/fragment-loader.ts"),U=function(){function D(k){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=k}var K=D.prototype;return K.abort=function(){for(var F in this.keyUriToKeyInfo){var B=this.keyUriToKeyInfo[F].loader;B&&B.abort()}},K.detach=function(){for(var F in this.keyUriToKeyInfo){var B=this.keyUriToKeyInfo[F];(B.mediaKeySessionContext||B.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[F]}},K.destroy=function(){this.detach();for(var F in this.keyUriToKeyInfo){var B=this.keyUriToKeyInfo[F].loader;B&&B.destroy()}this.keyUriToKeyInfo={}},K.createKeyLoadError=function(F,B,O,P){return B===void 0&&(B=R.ErrorDetails.KEY_LOAD_ERROR),new _.LoadError({type:R.ErrorTypes.NETWORK_ERROR,details:B,fatal:!1,frag:F,networkDetails:O})},K.loadClear=function(F,B){var O=this;if(this.emeController&&this.config.emeEnabled)for(var P=F.sn,g=F.cc,N=function(d){var l=B[d];if(g<=l.cc&&(P==="initSegment"||P<l.sn))return O.emeController.selectKeySystemFormat(l).then(function(b){l.setKeyFormat(b)}),"break"},S=0;S<B.length;S++){var f=N(S);if(f==="break")break}},K.load=function(F){var B=this;return!F.decryptdata&&F.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(F).then(function(O){return B.loadInternal(F,O)}):this.loadInternal(F)},K.loadInternal=function(F,B){var O,P;B&&F.setKeyFormat(B);var g=F.decryptdata;if(!g){var N=B?"Expected frag.decryptdata to be defined after setting format "+B:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(F,R.ErrorDetails.KEY_LOAD_ERROR,null,N))}var S=g.uri;if(!S)return Promise.reject(this.createKeyLoadError(F,R.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+S+'"'));var f=this.keyUriToKeyInfo[S];if((O=f)!==null&&O!==void 0&&O.decryptdata.key)return g.key=f.decryptdata.key,Promise.resolve({frag:F,keyInfo:f});if((P=f)!==null&&P!==void 0&&P.keyLoadPromise){var m;switch((m=f.mediaKeySessionContext)===null||m===void 0?void 0:m.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return f.keyLoadPromise}}switch(f=this.keyUriToKeyInfo[S]={decryptdata:g,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},g.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return g.keyFormat==="identity"?this.loadKeyHTTP(f,F):this.loadKeyEME(f,F);case"AES-128":return this.loadKeyHTTP(f,F);default:return Promise.reject(this.createKeyLoadError(F,R.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+g.method+'"'))}},K.loadKeyEME=function(F,B){var O={frag:B,keyInfo:F};if(this.emeController&&this.config.emeEnabled){var P=this.emeController.loadKey(O);if(P)return(F.keyLoadPromise=P.then(function(g){return F.mediaKeySessionContext=g,O})).catch(function(g){throw F.keyLoadPromise=null,g})}return Promise.resolve(O)},K.loadKeyHTTP=function(F,B){var O=this,P=this.config,g=P.loader,N=new g(P);return B.keyLoader=F.loader=N,F.keyLoadPromise=new Promise(function(S,f){var m={keyInfo:F,frag:B,responseType:"arraybuffer",url:F.decryptdata.uri},d={timeout:P.fragLoadingTimeOut,maxRetry:0,retryDelay:P.fragLoadingRetryDelay,maxRetryDelay:P.fragLoadingMaxRetryTimeout,highWaterMark:0},l={onSuccess:function(h,o,E,A){var v=E.frag,c=E.keyInfo,s=E.url;if(!v.decryptdata||c!==O.keyUriToKeyInfo[s])return f(O.createKeyLoadError(v,R.ErrorDetails.KEY_LOAD_ERROR,A,"after key load, decryptdata unset or changed"));c.decryptdata.key=v.decryptdata.key=new Uint8Array(h.data),v.keyLoader=null,c.loader=null,S({frag:v,keyInfo:c})},onError:function(h,o,E){O.resetLoader(o),f(O.createKeyLoadError(B,R.ErrorDetails.KEY_LOAD_ERROR,E))},onTimeout:function(h,o,E){O.resetLoader(o),f(O.createKeyLoadError(B,R.ErrorDetails.KEY_LOAD_TIMEOUT,E))},onAbort:function(h,o,E){O.resetLoader(o),f(O.createKeyLoadError(B,R.ErrorDetails.INTERNAL_ABORTED,E))}};N.load(m,d,l)})},K.resetLoader=function(F){var B=F.frag,O=F.keyInfo,P=F.url,g=O.loader;B.keyLoader===g&&(B.keyLoader=null,O.loader=null),delete this.keyUriToKeyInfo[P],g&&g.destroy()},D}()},"./src/loader/level-details.ts":(M,C,u)=>{u.r(C),u.d(C,{LevelDetails:()=>F});var R=u("./src/polyfills/number.ts");function _(B,O){for(var P=0;P<O.length;P++){var g=O[P];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(B,D(g.key),g)}}function U(B,O,P){return O&&_(B.prototype,O),P&&_(B,P),Object.defineProperty(B,"prototype",{writable:!1}),B}function D(B){var O=K(B,"string");return typeof O=="symbol"?O:String(O)}function K(B,O){if(typeof B!="object"||B===null)return B;var P=B[Symbol.toPrimitive];if(P!==void 0){var g=P.call(B,O||"default");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return(O==="string"?String:Number)(B)}var k=10,F=function(){function B(P){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=P}var O=B.prototype;return O.reloaded=function(g){if(!g){this.advanced=!0,this.updated=!0;return}var N=this.lastPartSn-g.lastPartSn,S=this.lastPartIndex-g.lastPartIndex;this.updated=this.endSN!==g.endSN||!!S||!!N,this.advanced=this.endSN>g.endSN||N>0||N===0&&S>0,this.updated||this.advanced?this.misses=Math.floor(g.misses*.6):this.misses=g.misses+1,this.availabilityDelay=g.availabilityDelay},U(B,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,R.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||k}},{key:"drift",get:function(){var g=this.driftEndTime-this.driftStartTime;if(g>0){var N=this.driftEnd-this.driftStart;return N*1e3/g}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var g;return(g=this.partList)!==null&&g!==void 0&&g.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var g;return(g=this.fragments)!==null&&g!==void 0&&g.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var g;return(g=this.partList)!==null&&g!==void 0&&g.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var g;return(g=this.partList)!==null&&g!==void 0&&g.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),B}()},"./src/loader/level-key.ts":(M,C,u)=>{u.r(C),u.d(C,{LevelKey:()=>F});var R=u("./src/utils/keysystem-util.ts"),_=u("./src/utils/mediakeys-helper.ts"),U=u("./src/utils/mp4-tools.ts"),D=u("./src/utils/logger.ts"),K=u("./src/utils/numeric-encoding-utils.ts"),k={},F=function(){O.clearKeyUriToKeyIdMap=function(){k={}};function O(g,N,S,f,m){f===void 0&&(f=[1]),m===void 0&&(m=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=g,this.uri=N,this.keyFormat=S,this.keyFormatVersions=f,this.iv=m,this.encrypted=g?g!=="NONE":!1,this.isCommonEncryption=this.encrypted&&g!=="AES-128"}var P=O.prototype;return P.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;switch(this.keyFormat){case"identity":return this.method==="SAMPLE-AES";case _.KeySystemFormats.FAIRPLAY:case _.KeySystemFormats.WIDEVINE:case _.KeySystemFormats.PLAYREADY:case _.KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},P.getDecryptData=function(N){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof N!="number"&&(this.method==="AES-128"&&!this.iv&&D.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),N=0);var S=B(N),f=new O(this.method,this.uri,"identity",this.keyFormatVersions,S);return f}var m=(0,R.convertDataUriToArrayBytes)(this.uri);if(m)switch(this.keyFormat){case _.KeySystemFormats.WIDEVINE:this.pssh=m,m.length>=22&&(this.keyId=m.subarray(m.length-22,m.length-6));break;case _.KeySystemFormats.PLAYREADY:{var d=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,U.mp4pssh)(d,null,m);var l=new Uint16Array(m.buffer,m.byteOffset,m.byteLength/2),b=String.fromCharCode.apply(null,Array.from(l)),h=b.substring(b.indexOf("<"),b.length),o=new DOMParser,E=o.parseFromString(h,"text/xml"),A=E.getElementsByTagName("KID")[0];if(A){var v=A.childNodes[0]?A.childNodes[0].nodeValue:A.getAttribute("VALUE");if(v){var c=(0,K.base64Decode)(v).subarray(0,16);(0,R.changeEndianness)(c),this.keyId=c}}break}default:{var s=m.subarray(0,16);if(s.length!==16){var p=new Uint8Array(16);p.set(s,16-s.length),s=p}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){var a=k[this.uri];if(!a){var T=Object.keys(k).length%Number.MAX_SAFE_INTEGER;a=new Uint8Array(16);var L=new DataView(a.buffer,12,4);L.setUint32(0,T),k[this.uri]=a}this.keyId=a}return this},O}();function B(O){for(var P=new Uint8Array(16),g=12;g<16;g++)P[g]=O>>8*(15-g)&255;return P}},"./src/loader/load-stats.ts":(M,C,u)=>{u.r(C),u.d(C,{LoadStats:()=>R});var R=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>m});var R=u("./src/polyfills/number.ts"),_=u("./node_modules/url-toolkit/src/url-toolkit.js"),U=u("./src/loader/date-range.ts"),D=u("./src/loader/fragment.ts"),K=u("./src/loader/level-details.ts"),k=u("./src/loader/level-key.ts"),F=u("./src/utils/attr-list.ts"),B=u("./src/utils/logger.ts"),O=u("./src/utils/codecs.ts");function P(){return P=Object.assign?Object.assign.bind():function(A){for(var v=1;v<arguments.length;v++){var c=arguments[v];for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&(A[s]=c[s])}return A},P.apply(this,arguments)}var g=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,N=/#EXT-X-MEDIA:(.*)/g,S=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),f=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),m=function(){function A(){}return A.findGroup=function(c,s){for(var p=0;p<c.length;p++){var a=c[p];if(a.id===s)return a}},A.convertAVC1ToAVCOTI=function(c){var s=c.split(".");if(s.length>2){var p=s.shift()+".";return p+=parseInt(s.shift()).toString(16),p+=("000"+parseInt(s.shift()).toString(16)).slice(-4),p}return c},A.resolve=function(c,s){return(0,_.buildAbsoluteURL)(s,c,{alwaysNormalize:!0})},A.parseMasterPlaylist=function(c,s){var p=[],a=[],T={},L=[],I=!1;g.lastIndex=0;for(var H;(H=g.exec(c))!=null;)if(H[1]){var W,w=new F.AttrList(H[1]),G={attrs:w,bitrate:w.decimalInteger("AVERAGE-BANDWIDTH")||w.decimalInteger("BANDWIDTH"),name:w.NAME,url:A.resolve(H[2],s)},Y=w.decimalResolution("RESOLUTION");Y&&(G.width=Y.width,G.height=Y.height),l((w.CODECS||"").split(/[ ,]+/).filter(function(V){return V}),G),G.videoCodec&&G.videoCodec.indexOf("avc1")!==-1&&(G.videoCodec=A.convertAVC1ToAVCOTI(G.videoCodec)),(W=G.unknownCodecs)!==null&&W!==void 0&&W.length||a.push(G),p.push(G)}else if(H[3]){var j=new F.AttrList(H[3]);j["DATA-ID"]&&(I=!0,T[j["DATA-ID"]]=j)}else if(H[4]){var X=H[4],q=d(X,s);q.encrypted&&q.isSupported()?L.push(q):B.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+X+'"')}var J=a.length>0&&a.length<p.length;return{levels:J?a:p,sessionData:I?T:null,sessionKeys:L.length?L:null}},A.parseMasterPlaylistMedia=function(c,s,p,a){a===void 0&&(a=[]);var T,L=[],I=0;for(N.lastIndex=0;(T=N.exec(c))!==null;){var H=new F.AttrList(T[1]);if(H.TYPE===p){var W={attrs:H,bitrate:0,id:I++,groupId:H["GROUP-ID"],instreamId:H["INSTREAM-ID"],name:H.NAME||H.LANGUAGE||"",type:p,default:H.bool("DEFAULT"),autoselect:H.bool("AUTOSELECT"),forced:H.bool("FORCED"),lang:H.LANGUAGE,url:H.URI?A.resolve(H.URI,s):""};if(a.length){var w=A.findGroup(a,W.groupId)||a[0];b(W,w,"audioCodec"),b(W,w,"textCodec")}L.push(W)}}return L},A.parseLevelPlaylist=function(c,s,p,a,T){var L=new K.LevelDetails(s),I=L.fragments,H=null,W=0,w=0,G=0,Y=0,j=null,X=new D.Fragment(a,s),q,J,V,Q=-1,ee=!1;for(S.lastIndex=0,L.m3u8=c;(q=S.exec(c))!==null;){ee&&(ee=!1,X=new D.Fragment(a,s),X.start=G,X.sn=W,X.cc=Y,X.level=p,H&&(X.initSegment=H,X.rawProgramDateTime=H.rawProgramDateTime,H.rawProgramDateTime=null));var Z=q[1];if(Z){X.duration=parseFloat(Z);var re=(" "+q[2]).slice(1);X.title=re||null,X.tagList.push(re?["INF",Z,re]:["INF",Z])}else if(q[3]){if((0,R.isFiniteNumber)(X.duration)){if(X.start=G,V){X.levelkeys=V;var ae=L.encryptedFragments;X.levelkeys&&Object.keys(X.levelkeys).some(function(gt){return X.levelkeys[gt].isCommonEncryption})&&(!ae.length||ae[ae.length-1].levelkeys!==V)&&ae.push(X)}X.sn=W,X.level=p,X.cc=Y,X.urlId=T,I.push(X),X.relurl=(" "+q[3]).slice(1),o(X,j),j=X,G+=X.duration,W++,w=0,ee=!0}}else if(q[4]){var le=(" "+q[4]).slice(1);j?X.setByteRange(le,j):X.setByteRange(le)}else if(q[5])X.rawProgramDateTime=(" "+q[5]).slice(1),X.tagList.push(["PROGRAM-DATE-TIME",X.rawProgramDateTime]),Q===-1&&(Q=I.length);else{if(q=q[0].match(f),!q){B.logger.warn("No matches on slow regex match for level playlist!");continue}for(J=1;J<q.length&&!(typeof q[J]<"u");J++);var ne=(" "+q[J]).slice(1),ie=(" "+q[J+1]).slice(1),ue=q[J+2]?(" "+q[J+2]).slice(1):"";switch(ne){case"PLAYLIST-TYPE":L.type=ie.toUpperCase();break;case"MEDIA-SEQUENCE":W=L.startSN=parseInt(ie);break;case"SKIP":{var ge=new F.AttrList(ie),he=ge.decimalInteger("SKIPPED-SEGMENTS");if((0,R.isFiniteNumber)(he)){L.skippedSegments=he;for(var Ee=he;Ee--;)I.unshift(null);W+=he}var me=ge.enumeratedString("RECENTLY-REMOVED-DATERANGES");me&&(L.recentlyRemovedDateranges=me.split("	"));break}case"TARGETDURATION":L.targetduration=parseFloat(ie);break;case"VERSION":L.version=parseInt(ie);break;case"EXTM3U":break;case"ENDLIST":L.live=!1;break;case"#":(ie||ue)&&X.tagList.push(ue?[ie,ue]:[ie]);break;case"DISCONTINUITY":Y++,X.tagList.push(["DIS"]);break;case"GAP":X.tagList.push([ne]);break;case"BITRATE":X.tagList.push([ne,ie]);break;case"DATERANGE":{var pe=new F.AttrList(ie),Te=new U.DateRange(pe,L.dateRanges[pe.ID]);Te.isValid||L.skippedSegments?L.dateRanges[Te.id]=Te:B.logger.warn('Ignoring invalid DATERANGE tag: "'+ie+'"'),X.tagList.push(["EXT-X-DATERANGE",ie]);break}case"DISCONTINUITY-SEQUENCE":Y=parseInt(ie);break;case"KEY":{var _e=d(ie,s);if(_e.isSupported()){if(_e.method==="NONE"){V=void 0;break}V||(V={}),V[_e.keyFormat]&&(V=P({},V)),V[_e.keyFormat]=_e}else B.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+ie+'"');break}case"START":{var ye=new F.AttrList(ie),Le=ye.decimalFloatingPoint("TIME-OFFSET");(0,R.isFiniteNumber)(Le)&&(L.startTimeOffset=Le);break}case"MAP":{var Fe=new F.AttrList(ie);if(X.duration){var we=new D.Fragment(a,s);E(we,Fe,p,V),H=we,X.initSegment=H,H.rawProgramDateTime&&!X.rawProgramDateTime&&(X.rawProgramDateTime=H.rawProgramDateTime)}else E(X,Fe,p,V),H=X,ee=!0;break}case"SERVER-CONTROL":{var He=new F.AttrList(ie);L.canBlockReload=He.bool("CAN-BLOCK-RELOAD"),L.canSkipUntil=He.optionalFloat("CAN-SKIP-UNTIL",0),L.canSkipDateRanges=L.canSkipUntil>0&&He.bool("CAN-SKIP-DATERANGES"),L.partHoldBack=He.optionalFloat("PART-HOLD-BACK",0),L.holdBack=He.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var ot=new F.AttrList(ie);L.partTarget=ot.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Pe=L.partList;Pe||(Pe=L.partList=[]);var We=w>0?Pe[Pe.length-1]:void 0,tt=w++,ft=new D.Part(new F.AttrList(ie),X,s,tt,We);Pe.push(ft),X.duration+=ft.duration;break}case"PRELOAD-HINT":{var dt=new F.AttrList(ie);L.preloadHint=dt;break}case"RENDITION-REPORT":{var $e=new F.AttrList(ie);L.renditionReports=L.renditionReports||[],L.renditionReports.push($e);break}default:B.logger.warn("line parsed but not handled: "+q);break}}}j&&!j.relurl?(I.pop(),G-=j.duration,L.partList&&(L.fragmentHint=j)):L.partList&&(o(X,j),X.cc=Y,L.fragmentHint=X);var Xe=I.length,ht=I[0],vt=I[Xe-1];if(G+=L.skippedSegments*L.targetduration,G>0&&Xe&&vt){L.averagetargetduration=G/Xe;var Ge=vt.sn;L.endSN=Ge!=="initSegment"?Ge:0,L.live||(vt.endList=!0),ht&&(L.startCC=ht.cc)}else L.endSN=0,L.startCC=0;return L.fragmentHint&&(G+=L.fragmentHint.duration),L.totalduration=G,L.endCC=Y,Q>0&&h(I,Q),L},A}();function d(A,v){var c,s,p=new F.AttrList(A),a=(c=p.enumeratedString("METHOD"))!=null?c:"",T=p.URI,L=p.hexadecimalInteger("IV"),I=p.enumeratedString("KEYFORMATVERSIONS"),H=(s=p.enumeratedString("KEYFORMAT"))!=null?s:"identity";T&&p.IV&&!L&&B.logger.error("Invalid IV: "+p.IV);var W=T?m.resolve(T,v):"",w=(I||"1").split("/").map(Number).filter(Number.isFinite);return new k.LevelKey(a,W,H,w,L)}function l(A,v){["video","audio","text"].forEach(function(c){var s=A.filter(function(a){return(0,O.isCodecType)(a,c)});if(s.length){var p=s.filter(function(a){return a.lastIndexOf("avc1",0)===0||a.lastIndexOf("mp4a",0)===0});v[c+"Codec"]=p.length>0?p[0]:s[0],A=A.filter(function(a){return s.indexOf(a)===-1})}}),v.unknownCodecs=A}function b(A,v,c){var s=v[c];s&&(A[c]=s)}function h(A,v){for(var c=A[v],s=v;s--;){var p=A[s];if(!p)return;p.programDateTime=c.programDateTime-p.duration*1e3,c=p}}function o(A,v){A.rawProgramDateTime?A.programDateTime=Date.parse(A.rawProgramDateTime):v!=null&&v.programDateTime&&(A.programDateTime=v.endProgramDateTime),(0,R.isFiniteNumber)(A.programDateTime)||(A.programDateTime=null,A.rawProgramDateTime=null)}function E(A,v,c,s){A.relurl=v.URI,v.BYTERANGE&&A.setByteRange(v.BYTERANGE),A.level=c,A.sn="initSegment",s&&(A.levelkeys=s),A.initSegment=null}},"./src/loader/playlist-loader.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>g});var R=u("./src/polyfills/number.ts"),_=u("./src/events.ts"),U=u("./src/errors.ts"),D=u("./src/utils/logger.ts"),K=u("./src/loader/m3u8-parser.ts"),k=u("./src/types/loader.ts"),F=u("./src/utils/attr-list.ts");function B(N){var S=N.type;switch(S){case k.PlaylistContextType.AUDIO_TRACK:return k.PlaylistLevelType.AUDIO;case k.PlaylistContextType.SUBTITLE_TRACK:return k.PlaylistLevelType.SUBTITLE;default:return k.PlaylistLevelType.MAIN}}function O(N,S){var f=N.url;return(f===void 0||f.indexOf("data:")===0)&&(f=S.url),f}var P=function(){function N(f){this.hls=void 0,this.loaders=Object.create(null),this.hls=f,this.registerListeners()}var S=N.prototype;return S.startLoad=function(m){},S.stopLoad=function(){this.destroyInternalLoaders()},S.registerListeners=function(){var m=this.hls;m.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),m.on(_.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),m.on(_.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},S.unregisterListeners=function(){var m=this.hls;m.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),m.off(_.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),m.off(_.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},S.createInternalLoader=function(m){var d=this.hls.config,l=d.pLoader,b=d.loader,h=l||b,o=new h(d);return m.loader=o,this.loaders[m.type]=o,o},S.getInternalLoader=function(m){return this.loaders[m.type]},S.resetInternalLoader=function(m){this.loaders[m]&&delete this.loaders[m]},S.destroyInternalLoaders=function(){for(var m in this.loaders){var d=this.loaders[m];d&&d.destroy(),this.resetInternalLoader(m)}},S.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},S.onManifestLoading=function(m,d){var l=d.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:k.PlaylistContextType.MANIFEST,url:l,deliveryDirectives:null})},S.onLevelLoading=function(m,d){var l=d.id,b=d.level,h=d.url,o=d.deliveryDirectives;this.load({id:l,groupId:null,level:b,responseType:"text",type:k.PlaylistContextType.LEVEL,url:h,deliveryDirectives:o})},S.onAudioTrackLoading=function(m,d){var l=d.id,b=d.groupId,h=d.url,o=d.deliveryDirectives;this.load({id:l,groupId:b,level:null,responseType:"text",type:k.PlaylistContextType.AUDIO_TRACK,url:h,deliveryDirectives:o})},S.onSubtitleTrackLoading=function(m,d){var l=d.id,b=d.groupId,h=d.url,o=d.deliveryDirectives;this.load({id:l,groupId:b,level:null,responseType:"text",type:k.PlaylistContextType.SUBTITLE_TRACK,url:h,deliveryDirectives:o})},S.load=function(m){var d,l=this.hls.config,b=this.getInternalLoader(m);if(b){var h=b.context;if(h&&h.url===m.url){D.logger.trace("[playlist-loader]: playlist request ongoing");return}D.logger.log("[playlist-loader]: aborting previous loader for type: "+m.type),b.abort()}var o,E,A,v;switch(m.type){case k.PlaylistContextType.MANIFEST:o=l.manifestLoadingMaxRetry,E=l.manifestLoadingTimeOut,A=l.manifestLoadingRetryDelay,v=l.manifestLoadingMaxRetryTimeout;break;case k.PlaylistContextType.LEVEL:case k.PlaylistContextType.AUDIO_TRACK:case k.PlaylistContextType.SUBTITLE_TRACK:o=0,E=l.levelLoadingTimeOut;break;default:o=l.levelLoadingMaxRetry,E=l.levelLoadingTimeOut,A=l.levelLoadingRetryDelay,v=l.levelLoadingMaxRetryTimeout;break}if(b=this.createInternalLoader(m),(d=m.deliveryDirectives)!==null&&d!==void 0&&d.part){var c;if(m.type===k.PlaylistContextType.LEVEL&&m.level!==null?c=this.hls.levels[m.level].details:m.type===k.PlaylistContextType.AUDIO_TRACK&&m.id!==null?c=this.hls.audioTracks[m.id].details:m.type===k.PlaylistContextType.SUBTITLE_TRACK&&m.id!==null&&(c=this.hls.subtitleTracks[m.id].details),c){var s=c.partTarget,p=c.targetduration;s&&p&&(E=Math.min(Math.max(s*3,p*.8)*1e3,E))}}var a={timeout:E,maxRetry:o,retryDelay:A,maxRetryDelay:v,highWaterMark:0},T={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};b.load(m,a,T)},S.loadsuccess=function(m,d,l,b){b===void 0&&(b=null),this.resetInternalLoader(l.type);var h=m.data;if(h.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(m,l,"no EXTM3U delimiter",b);return}d.parsing.start=performance.now(),h.indexOf("#EXTINF:")>0||h.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(m,d,l,b):this.handleMasterPlaylist(m,d,l,b)},S.loaderror=function(m,d,l){l===void 0&&(l=null),this.handleNetworkError(d,l,!1,m)},S.loadtimeout=function(m,d,l){l===void 0&&(l=null),this.handleNetworkError(d,l,!0)},S.handleMasterPlaylist=function(m,d,l,b){var h=this.hls,o=m.data,E=O(m,l),A=K.default.parseMasterPlaylist(o,E),v=A.levels,c=A.sessionData,s=A.sessionKeys;if(!v.length){this.handleManifestParsingError(m,l,"no level found in manifest",b);return}var p=v.map(function(W){return{id:W.attrs.AUDIO,audioCodec:W.audioCodec}}),a=v.map(function(W){return{id:W.attrs.SUBTITLES,textCodec:W.textCodec}}),T=K.default.parseMasterPlaylistMedia(o,E,"AUDIO",p),L=K.default.parseMasterPlaylistMedia(o,E,"SUBTITLES",a),I=K.default.parseMasterPlaylistMedia(o,E,"CLOSED-CAPTIONS");if(T.length){var H=T.some(function(W){return!W.url});!H&&v[0].audioCodec&&!v[0].attrs.AUDIO&&(D.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),T.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new F.AttrList({}),bitrate:0,url:""}))}h.trigger(_.Events.MANIFEST_LOADED,{levels:v,audioTracks:T,subtitles:L,captions:I,url:E,stats:d,networkDetails:b,sessionData:c,sessionKeys:s})},S.handleTrackOrLevelPlaylist=function(m,d,l,b){var h=this.hls,o=l.id,E=l.level,A=l.type,v=O(m,l),c=(0,R.isFiniteNumber)(o)?o:0,s=(0,R.isFiniteNumber)(E)?E:c,p=B(l),a=K.default.parseLevelPlaylist(m.data,v,s,p,c);if(!a.fragments.length){h.trigger(_.Events.ERROR,{type:U.ErrorTypes.NETWORK_ERROR,details:U.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:typeof l.level=="number"?l.level:void 0});return}if(A===k.PlaylistContextType.MANIFEST){var T={attrs:new F.AttrList({}),bitrate:0,details:a,name:"",url:v};h.trigger(_.Events.MANIFEST_LOADED,{levels:[T],audioTracks:[],url:v,stats:d,networkDetails:b,sessionData:null,sessionKeys:null})}d.parsing.end=performance.now(),l.levelDetails=a,this.handlePlaylistLoaded(m,d,l,b)},S.handleManifestParsingError=function(m,d,l,b){this.hls.trigger(_.Events.ERROR,{type:U.ErrorTypes.NETWORK_ERROR,details:U.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:d.type===k.PlaylistContextType.MANIFEST,url:m.url,reason:l,response:m,context:d,networkDetails:b})},S.handleNetworkError=function(m,d,l,b){l===void 0&&(l=!1),D.logger.warn("[playlist-loader]: A network "+(l?"timeout":"error")+" occurred while loading "+m.type+" level: "+m.level+" id: "+m.id+' group-id: "'+m.groupId+'"');var h=U.ErrorDetails.UNKNOWN,o=!1,E=this.getInternalLoader(m);switch(m.type){case k.PlaylistContextType.MANIFEST:h=l?U.ErrorDetails.MANIFEST_LOAD_TIMEOUT:U.ErrorDetails.MANIFEST_LOAD_ERROR,o=!0;break;case k.PlaylistContextType.LEVEL:h=l?U.ErrorDetails.LEVEL_LOAD_TIMEOUT:U.ErrorDetails.LEVEL_LOAD_ERROR,o=!1;break;case k.PlaylistContextType.AUDIO_TRACK:h=l?U.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:U.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,o=!1;break;case k.PlaylistContextType.SUBTITLE_TRACK:h=l?U.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:U.ErrorDetails.SUBTITLE_LOAD_ERROR,o=!1;break}E&&this.resetInternalLoader(m.type);var A={type:U.ErrorTypes.NETWORK_ERROR,details:h,fatal:o,url:m.url,loader:E,context:m,networkDetails:d};b&&(A.response=b),this.hls.trigger(_.Events.ERROR,A)},S.handlePlaylistLoaded=function(m,d,l,b){var h=l.type,o=l.level,E=l.id,A=l.groupId,v=l.loader,c=l.levelDetails,s=l.deliveryDirectives;if(!(c!=null&&c.targetduration)){this.handleManifestParsingError(m,l,"invalid target duration",b);return}if(v)switch(c.live&&(v.getCacheAge&&(c.ageHeader=v.getCacheAge()||0),(!v.getCacheAge||isNaN(c.ageHeader))&&(c.ageHeader=0)),h){case k.PlaylistContextType.MANIFEST:case k.PlaylistContextType.LEVEL:this.hls.trigger(_.Events.LEVEL_LOADED,{details:c,level:o||0,id:E||0,stats:d,networkDetails:b,deliveryDirectives:s});break;case k.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(_.Events.AUDIO_TRACK_LOADED,{details:c,id:E||0,groupId:A||"",stats:d,networkDetails:b,deliveryDirectives:s});break;case k.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(_.Events.SUBTITLE_TRACK_LOADED,{details:c,id:E||0,groupId:A||"",stats:d,networkDetails:b,deliveryDirectives:s});break}},N}();const g=P},"./src/polyfills/number.ts":(M,C,u)=>{u.r(C),u.d(C,{MAX_SAFE_INTEGER:()=>_,isFiniteNumber:()=>R});var R=Number.isFinite||function(U){return typeof U=="number"&&isFinite(U)},_=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>_});var R=function(){function U(){}return U.getSilentFrame=function(K,k){switch(K){case"mp4a.40.2":if(k===1)return new Uint8Array([0,200,0,128,35,128]);if(k===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(k===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(k===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(k===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(k===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(k===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},U}();const _=R},"./src/remux/mp4-generator.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>U});var R=Math.pow(2,32)-1,_=function(){function D(){}return D.init=function(){D.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var k;for(k in D.types)D.types.hasOwnProperty(k)&&(D.types[k]=[k.charCodeAt(0),k.charCodeAt(1),k.charCodeAt(2),k.charCodeAt(3)]);var F=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),B=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);D.HDLR_TYPES={video:F,audio:B};var O=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),P=new Uint8Array([0,0,0,0,0,0,0,0]);D.STTS=D.STSC=D.STCO=P,D.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),D.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),D.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),D.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),N=new Uint8Array([97,118,99,49]),S=new Uint8Array([0,0,0,1]);D.FTYP=D.box(D.types.ftyp,g,S,g,N),D.DINF=D.box(D.types.dinf,D.box(D.types.dref,O))},D.box=function(k){for(var F=8,B=arguments.length,O=new Array(B>1?B-1:0),P=1;P<B;P++)O[P-1]=arguments[P];for(var g=O.length,N=g;g--;)F+=O[g].byteLength;var S=new Uint8Array(F);for(S[0]=F>>24&255,S[1]=F>>16&255,S[2]=F>>8&255,S[3]=F&255,S.set(k,4),g=0,F=8;g<N;g++)S.set(O[g],F),F+=O[g].byteLength;return S},D.hdlr=function(k){return D.box(D.types.hdlr,D.HDLR_TYPES[k])},D.mdat=function(k){return D.box(D.types.mdat,k)},D.mdhd=function(k,F){F*=k;var B=Math.floor(F/(R+1)),O=Math.floor(F%(R+1));return D.box(D.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,k&255,B>>24,B>>16&255,B>>8&255,B&255,O>>24,O>>16&255,O>>8&255,O&255,85,196,0,0]))},D.mdia=function(k){return D.box(D.types.mdia,D.mdhd(k.timescale,k.duration),D.hdlr(k.type),D.minf(k))},D.mfhd=function(k){return D.box(D.types.mfhd,new Uint8Array([0,0,0,0,k>>24,k>>16&255,k>>8&255,k&255]))},D.minf=function(k){return k.type==="audio"?D.box(D.types.minf,D.box(D.types.smhd,D.SMHD),D.DINF,D.stbl(k)):D.box(D.types.minf,D.box(D.types.vmhd,D.VMHD),D.DINF,D.stbl(k))},D.moof=function(k,F,B){return D.box(D.types.moof,D.mfhd(k),D.traf(B,F))},D.moov=function(k){for(var F=k.length,B=[];F--;)B[F]=D.trak(k[F]);return D.box.apply(null,[D.types.moov,D.mvhd(k[0].timescale,k[0].duration)].concat(B).concat(D.mvex(k)))},D.mvex=function(k){for(var F=k.length,B=[];F--;)B[F]=D.trex(k[F]);return D.box.apply(null,[D.types.mvex].concat(B))},D.mvhd=function(k,F){F*=k;var B=Math.floor(F/(R+1)),O=Math.floor(F%(R+1)),P=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,k&255,B>>24,B>>16&255,B>>8&255,B&255,O>>24,O>>16&255,O>>8&255,O&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return D.box(D.types.mvhd,P)},D.sdtp=function(k){var F=k.samples||[],B=new Uint8Array(4+F.length),O,P;for(O=0;O<F.length;O++)P=F[O].flags,B[O+4]=P.dependsOn<<4|P.isDependedOn<<2|P.hasRedundancy;return D.box(D.types.sdtp,B)},D.stbl=function(k){return D.box(D.types.stbl,D.stsd(k),D.box(D.types.stts,D.STTS),D.box(D.types.stsc,D.STSC),D.box(D.types.stsz,D.STSZ),D.box(D.types.stco,D.STCO))},D.avc1=function(k){var F=[],B=[],O,P,g;for(O=0;O<k.sps.length;O++)P=k.sps[O],g=P.byteLength,F.push(g>>>8&255),F.push(g&255),F=F.concat(Array.prototype.slice.call(P));for(O=0;O<k.pps.length;O++)P=k.pps[O],g=P.byteLength,B.push(g>>>8&255),B.push(g&255),B=B.concat(Array.prototype.slice.call(P));var N=D.box(D.types.avcC,new Uint8Array([1,F[3],F[4],F[5],255,224|k.sps.length].concat(F).concat([k.pps.length]).concat(B))),S=k.width,f=k.height,m=k.pixelRatio[0],d=k.pixelRatio[1];return D.box(D.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,S>>8&255,S&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),N,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,d>>24,d>>16&255,d>>8&255,d&255])))},D.esds=function(k){var F=k.config.length;return new Uint8Array([0,0,0,0,3,23+F,0,1,0,4,15+F,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([F]).concat(k.config).concat([6,1,2]))},D.mp4a=function(k){var F=k.samplerate;return D.box(D.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,F>>8&255,F&255,0,0]),D.box(D.types.esds,D.esds(k)))},D.mp3=function(k){var F=k.samplerate;return D.box(D.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,F>>8&255,F&255,0,0]))},D.stsd=function(k){return k.type==="audio"?k.segmentCodec==="mp3"&&k.codec==="mp3"?D.box(D.types.stsd,D.STSD,D.mp3(k)):D.box(D.types.stsd,D.STSD,D.mp4a(k)):D.box(D.types.stsd,D.STSD,D.avc1(k))},D.tkhd=function(k){var F=k.id,B=k.duration*k.timescale,O=k.width,P=k.height,g=Math.floor(B/(R+1)),N=Math.floor(B%(R+1));return D.box(D.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,F>>24&255,F>>16&255,F>>8&255,F&255,0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255,N>>24,N>>16&255,N>>8&255,N&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,O>>8&255,O&255,0,0,P>>8&255,P&255,0,0]))},D.traf=function(k,F){var B=D.sdtp(k),O=k.id,P=Math.floor(F/(R+1)),g=Math.floor(F%(R+1));return D.box(D.types.traf,D.box(D.types.tfhd,new Uint8Array([0,0,0,0,O>>24,O>>16&255,O>>8&255,O&255])),D.box(D.types.tfdt,new Uint8Array([1,0,0,0,P>>24,P>>16&255,P>>8&255,P&255,g>>24,g>>16&255,g>>8&255,g&255])),D.trun(k,B.length+16+20+8+16+8+8),B)},D.trak=function(k){return k.duration=k.duration||4294967295,D.box(D.types.trak,D.tkhd(k),D.mdia(k))},D.trex=function(k){var F=k.id;return D.box(D.types.trex,new Uint8Array([0,0,0,0,F>>24,F>>16&255,F>>8&255,F&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},D.trun=function(k,F){var B=k.samples||[],O=B.length,P=12+16*O,g=new Uint8Array(P),N,S,f,m,d,l;for(F+=8+P,g.set([k.type==="video"?1:0,0,15,1,O>>>24&255,O>>>16&255,O>>>8&255,O&255,F>>>24&255,F>>>16&255,F>>>8&255,F&255],0),N=0;N<O;N++)S=B[N],f=S.duration,m=S.size,d=S.flags,l=S.cts,g.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,m>>>24&255,m>>>16&255,m>>>8&255,m&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&240<<8,d.degradPrio&15,l>>>24&255,l>>>16&255,l>>>8&255,l&255],12+16*N);return D.box(D.types.trun,g)},D.initSegment=function(k){D.types||D.init();var F=D.moov(k),B=new Uint8Array(D.FTYP.byteLength+F.byteLength);return B.set(D.FTYP),B.set(F,D.FTYP.byteLength),B},D}();_.types=void 0,_.HDLR_TYPES=void 0,_.STTS=void 0,_.STSC=void 0,_.STCO=void 0,_.STSZ=void 0,_.VMHD=void 0,_.SMHD=void 0,_.STSD=void 0,_.FTYP=void 0,_.DINF=void 0;const U=_},"./src/remux/mp4-remuxer.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>m,flushTextTrackMetadataCueSamples:()=>b,flushTextTrackUserdataCueSamples:()=>h,normalizePts:()=>d});var R=u("./src/polyfills/number.ts"),_=u("./src/remux/aac-helper.ts"),U=u("./src/remux/mp4-generator.ts"),D=u("./src/events.ts"),K=u("./src/errors.ts"),k=u("./src/utils/logger.ts"),F=u("./src/types/loader.ts"),B=u("./src/utils/timescale-conversion.ts");function O(){return O=Object.assign?Object.assign.bind():function(A){for(var v=1;v<arguments.length;v++){var c=arguments[v];for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&(A[s]=c[s])}return A},O.apply(this,arguments)}var P=10*1e3,g=1024,N=1152,S=null,f=null,m=function(){function A(c,s,p,a){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=c,this.config=s,this.typeSupported=p,this.ISGenerated=!1,S===null){var T=navigator.userAgent||"",L=T.match(/Chrome\/(\d+)/i);S=L?parseInt(L[1]):0}if(f===null){var I=navigator.userAgent.match(/Safari\/(\d+)/i);f=I?parseInt(I[1]):0}}var v=A.prototype;return v.destroy=function(){},v.resetTimeStamp=function(s){k.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=s},v.resetNextTimestamp=function(){k.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},v.resetInitSegment=function(){k.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},v.getVideoStartPts=function(s){var p=!1,a=s.reduce(function(T,L){var I=L.pts-T;return I<-4294967296?(p=!0,d(T,L.pts)):I>0?T:L.pts},s[0].pts);return p&&k.logger.debug("PTS rollover detected"),a},v.remux=function(s,p,a,T,L,I,H,W){var w,G,Y,j,X,q,J=L,V=L,Q=s.pid>-1,ee=p.pid>-1,Z=p.samples.length,re=s.samples.length>0,ae=H&&Z>0||Z>1,le=(!Q||re)&&(!ee||ae)||this.ISGenerated||H;if(le){this.ISGenerated||(Y=this.generateIS(s,p,L));var ne=this.isVideoContiguous,ie=-1,ue;if(ae&&(ie=l(p.samples),!ne&&this.config.forceKeyFrameOnDiscontinuity))if(q=!0,ie>0){k.logger.warn("[mp4-remuxer]: Dropped "+ie+" out of "+Z+" video samples due to a missing keyframe");var ge=this.getVideoStartPts(p.samples);p.samples=p.samples.slice(ie),p.dropped+=ie,V+=(p.samples[0].pts-ge)/p.inputTimeScale,ue=V}else ie===-1&&(k.logger.warn("[mp4-remuxer]: No keyframe found out of "+Z+" video samples"),q=!1);if(this.ISGenerated){if(re&&ae){var he=this.getVideoStartPts(p.samples),Ee=d(s.samples[0].pts,he)-he,me=Ee/p.inputTimeScale;J+=Math.max(0,me),V+=Math.max(0,-me)}if(re){if(s.samplerate||(k.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),Y=this.generateIS(s,p,L)),G=this.remuxAudio(s,J,this.isAudioContiguous,I,ee||ae||W===F.PlaylistLevelType.AUDIO?V:void 0),ae){var pe=G?G.endPTS-G.startPTS:0;p.inputTimeScale||(k.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),Y=this.generateIS(s,p,L)),w=this.remuxVideo(p,V,ne,pe)}}else ae&&(w=this.remuxVideo(p,V,ne,0));w&&(w.firstKeyFrame=ie,w.independent=ie!==-1,w.firstKeyFramePTS=ue)}}return this.ISGenerated&&(a.samples.length&&(X=b(a,L,this._initPTS,this._initDTS)),T.samples.length&&(j=h(T,L,this._initPTS))),{audio:G,video:w,initSegment:Y,independent:q,text:j,id3:X}},v.generateIS=function(s,p,a){var T=s.samples,L=p.samples,I=this.typeSupported,H={},W=!(0,R.isFiniteNumber)(this._initPTS),w="audio/mp4",G,Y,j;if(W&&(G=Y=1/0),s.config&&T.length){switch(s.timescale=s.samplerate,s.segmentCodec){case"mp3":I.mpeg?(w="audio/mpeg",s.codec=""):I.mp3&&(s.codec="mp3");break}H.audio={id:"audio",container:w,codec:s.codec,initSegment:s.segmentCodec==="mp3"&&I.mpeg?new Uint8Array(0):U.default.initSegment([s]),metadata:{channelCount:s.channelCount}},W&&(j=s.inputTimeScale,G=Y=T[0].pts-Math.round(j*a))}if(p.sps&&p.pps&&L.length&&(p.timescale=p.inputTimeScale,H.video={id:"main",container:"video/mp4",codec:p.codec,initSegment:U.default.initSegment([p]),metadata:{width:p.width,height:p.height}},W)){j=p.inputTimeScale;var X=this.getVideoStartPts(L),q=Math.round(j*a);Y=Math.min(Y,d(L[0].dts,X)-q),G=Math.min(G,X-q)}if(Object.keys(H).length)return this.ISGenerated=!0,W&&(this._initPTS=G,this._initDTS=Y),{tracks:H,initPTS:G,timescale:j}},v.remuxVideo=function(s,p,a,T){var L=s.inputTimeScale,I=s.samples,H=[],W=I.length,w=this._initPTS,G=this.nextAvcDts,Y=8,j=this.videoSampleDuration,X,q,J=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,Q=!1;if(!a||G===null){var ee=p*L,Z=I[0].pts-d(I[0].dts,I[0].pts);G=ee-Z}for(var re=0;re<W;re++){var ae=I[re];ae.pts=d(ae.pts-w,G),ae.dts=d(ae.dts-w,G),ae.dts<I[re>0?re-1:re].dts&&(Q=!0)}Q&&I.sort(function(Ni,Aa){var Dc=Ni.dts-Aa.dts,Rc=Ni.pts-Aa.pts;return Dc||Rc}),X=I[0].dts,q=I[I.length-1].dts;var le=q-X,ne=le?Math.round(le/(W-1)):j||s.inputTimeScale/30;if(a){var ie=X-G,ue=ie>ne,ge=ie<-1;if((ue||ge)&&(ue?k.logger.warn("AVC: "+(0,B.toMsFromMpegTsClock)(ie,!0)+" ms ("+ie+"dts) hole between fragments detected, filling it"):k.logger.warn("AVC: "+(0,B.toMsFromMpegTsClock)(-ie,!0)+" ms ("+ie+"dts) overlapping between fragments detected"),!ge||G>I[0].pts)){X=G;var he=I[0].pts-ie;I[0].dts=X,I[0].pts=he,k.logger.log("Video: First PTS/DTS adjusted: "+(0,B.toMsFromMpegTsClock)(he,!0)+"/"+(0,B.toMsFromMpegTsClock)(X,!0)+", delta: "+(0,B.toMsFromMpegTsClock)(ie,!0)+" ms")}}X=Math.max(0,X);for(var Ee=0,me=0,pe=0;pe<W;pe++){for(var Te=I[pe],_e=Te.units,ye=_e.length,Le=0,Fe=0;Fe<ye;Fe++)Le+=_e[Fe].data.length;me+=Le,Ee+=ye,Te.length=Le,Te.dts=Math.max(Te.dts,X),J=Math.min(Te.pts,J),V=Math.max(Te.pts,V)}q=I[W-1].dts;var we=me+4*Ee+8,He;try{He=new Uint8Array(we)}catch{this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:K.ErrorTypes.MUX_ERROR,details:K.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:we,reason:"fail allocating video mdat "+we});return}var ot=new DataView(He.buffer);ot.setUint32(0,we),He.set(U.default.types.mdat,4);for(var Pe=!1,We=Number.POSITIVE_INFINITY,tt=Number.POSITIVE_INFINITY,ft=Number.NEGATIVE_INFINITY,dt=Number.NEGATIVE_INFINITY,$e=0;$e<W;$e++){for(var Xe=I[$e],ht=Xe.units,vt=0,Ge=0,gt=ht.length;Ge<gt;Ge++){var pt=ht[Ge],xn=pt.data,tr=pt.data.byteLength;ot.setUint32(Y,tr),Y+=4,He.set(xn,Y),Y+=tr,vt+=4+tr}var Tr=void 0;if($e<W-1)j=I[$e+1].dts-Xe.dts,Tr=I[$e+1].pts-Xe.pts;else{var va=this.config,Cn=$e>0?Xe.dts-I[$e-1].dts:ne;if(Tr=$e>0?Xe.pts-I[$e-1].pts:ne,va.stretchShortVideoTrack&&this.nextAudioPts!==null){var yc=Math.floor(va.maxBufferHole*L),Oi=(T?J+T*L:this.nextAudioPts)-Xe.pts;Oi>yc?(j=Oi-Cn,j<0?j=Cn:Pe=!0,k.logger.log("[mp4-remuxer]: It is approximately "+Oi/90+" ms to the next segment; using duration "+j/90+" ms for the last video frame.")):j=Cn}else j=Cn}var bc=Math.round(Xe.pts-Xe.dts);We=Math.min(We,j),ft=Math.max(ft,j),tt=Math.min(tt,Tr),dt=Math.max(dt,Tr),H.push(new o(Xe.key,j,vt,bc))}if(H.length){if(S){if(S<70){var pa=H[0].flags;pa.dependsOn=2,pa.isNonSync=0}}else if(f&&dt-tt<ft-We&&ne/ft<.025&&H[0].cts===0){k.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Pi=X,Tt=0,Ta=H.length;Tt<Ta;Tt++){var _a=Pi+H[Tt].duration,Sc=Pi+H[Tt].cts;if(Tt<Ta-1){var Ic=_a+H[Tt+1].cts;H[Tt].duration=Ic-Sc}else H[Tt].duration=Tt?H[Tt-1].duration:ne;H[Tt].cts=0,Pi=_a}}}console.assert(j!==null,"mp4SampleDuration must be computed"),j=Pe||!j?ne:j,this.nextAvcDts=G=q+j,this.videoSampleDuration=j,this.isVideoContiguous=!0;var xc=U.default.moof(s.sequenceNumber++,X,O({},s,{samples:H})),Cc="video",Lc={data1:xc,data2:He,startPTS:J/L,endPTS:(V+j)/L,startDTS:X/L,endDTS:G/L,type:Cc,hasAudio:!1,hasVideo:!0,nb:H.length,dropped:s.dropped};return s.samples=[],s.dropped=0,console.assert(He.length,"MDAT length must not be zero"),Lc},v.remuxAudio=function(s,p,a,T,L){var I=s.inputTimeScale,H=s.samplerate?s.samplerate:I,W=I/H,w=s.segmentCodec==="aac"?g:N,G=w*W,Y=this._initPTS,j=s.segmentCodec==="mp3"&&this.typeSupported.mpeg,X=[],q=L!==void 0,J=s.samples,V=j?0:8,Q=this.nextAudioPts||-1,ee=p*I;if(this.isAudioContiguous=a=a||J.length&&Q>0&&(T&&Math.abs(ee-Q)<9e3||Math.abs(d(J[0].pts-Y,ee)-Q)<20*G),J.forEach(function(pt){pt.pts=d(pt.pts-Y,ee)}),!a||Q<0){if(J=J.filter(function(pt){return pt.pts>=0}),!J.length)return;L===0?Q=0:T&&!q?Q=Math.max(0,ee):Q=J[0].pts}if(s.segmentCodec==="aac")for(var Z=this.config.maxAudioFramesDrift,re=0,ae=Q;re<J.length;re++){var le=J[re],ne=le.pts,ie=ne-ae,ue=Math.abs(1e3*ie/I);if(ie<=-Z*G&&q)re===0&&(k.logger.warn("Audio frame @ "+(ne/I).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ie/I)+" ms."),this.nextAudioPts=Q=ae=ne);else if(ie>=Z*G&&ue<P&&q){var ge=Math.round(ie/G);ae=ne-ge*G,ae<0&&(ge--,ae+=G),re===0&&(this.nextAudioPts=Q=ae),k.logger.warn("[mp4-remuxer]: Injecting "+ge+" audio frame @ "+(ae/I).toFixed(3)+"s due to "+Math.round(1e3*ie/I)+" ms gap.");for(var he=0;he<ge;he++){var Ee=Math.max(ae,0),me=_.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);me||(k.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),me=le.unit.subarray()),J.splice(re,0,{unit:me,pts:Ee}),ae+=G,re++}}le.pts=ae,ae+=G}for(var pe=null,Te=null,_e,ye=0,Le=J.length;Le--;)ye+=J[Le].unit.byteLength;for(var Fe=0,we=J.length;Fe<we;Fe++){var He=J[Fe],ot=He.unit,Pe=He.pts;if(Te!==null){var We=X[Fe-1];We.duration=Math.round((Pe-Te)/W)}else if(a&&s.segmentCodec==="aac"&&(Pe=Q),pe=Pe,ye>0){ye+=V;try{_e=new Uint8Array(ye)}catch{this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:K.ErrorTypes.MUX_ERROR,details:K.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ye,reason:"fail allocating audio mdat "+ye});return}if(!j){var tt=new DataView(_e.buffer);tt.setUint32(0,ye),_e.set(U.default.types.mdat,4)}}else return;_e.set(ot,V);var ft=ot.byteLength;V+=ft,X.push(new o(!0,w,ft,0)),Te=Pe}var dt=X.length;if(dt){var $e=X[X.length-1];this.nextAudioPts=Q=Te+W*$e.duration;var Xe=j?new Uint8Array(0):U.default.moof(s.sequenceNumber++,pe/W,O({},s,{samples:X}));s.samples=[];var ht=pe/I,vt=Q/I,Ge="audio",gt={data1:Xe,data2:_e,startPTS:ht,endPTS:vt,startDTS:ht,endDTS:vt,type:Ge,hasAudio:!0,hasVideo:!1,nb:dt};return this.isAudioContiguous=!0,console.assert(_e.length,"MDAT length must not be zero"),gt}},v.remuxEmptyAudio=function(s,p,a,T){var L=s.inputTimeScale,I=s.samplerate?s.samplerate:L,H=L/I,W=this.nextAudioPts,w=(W!==null?W:T.startDTS*L)+this._initDTS,G=T.endDTS*L+this._initDTS,Y=H*g,j=Math.ceil((G-w)/Y),X=_.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);if(k.logger.warn("[mp4-remuxer]: remux empty Audio"),!X){k.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var q=[],J=0;J<j;J++){var V=w+J*Y;q.push({unit:X,pts:V,dts:V})}return s.samples=q,this.remuxAudio(s,p,a,!1)},A}();function d(A,v){var c;if(v===null)return A;for(v<A?c=-8589934592:c=8589934592;Math.abs(A-v)>4294967296;)A+=c;return A}function l(A){for(var v=0;v<A.length;v++)if(A[v].key)return v;return-1}function b(A,v,c,s){var p=A.samples.length;if(p){for(var a=A.inputTimeScale,T=0;T<p;T++){var L=A.samples[T];L.pts=d(L.pts-c,v*a)/a,L.dts=d(L.dts-s,v*a)/a}var I=A.samples;return A.samples=[],{samples:I}}}function h(A,v,c){var s=A.samples.length;if(s){for(var p=A.inputTimeScale,a=0;a<s;a++){var T=A.samples[a];T.pts=d(T.pts-c,v*p)/p}A.samples.sort(function(I,H){return I.pts-H.pts});var L=A.samples;return A.samples=[],{samples:L}}}var o=function(v,c,s,p){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=c,this.size=s,this.cts=p,this.flags=new E(v)},E=function(v){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=v?2:1,this.isNonSync=v?0:1}},"./src/remux/passthrough-remuxer.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>B});var R=u("./src/polyfills/number.ts"),_=u("./src/remux/mp4-remuxer.ts"),U=u("./src/utils/mp4-tools.ts"),D=u("./src/loader/fragment.ts"),K=u("./src/utils/logger.ts"),k=function(){function O(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var P=O.prototype;return P.destroy=function(){},P.resetTimeStamp=function(N){this.initPTS=N,this.lastEndTime=null},P.resetNextTimestamp=function(){this.lastEndTime=null},P.resetInitSegment=function(N,S,f,m){this.audioCodec=S,this.videoCodec=f,this.generateInitSegment((0,U.patchEncyptionData)(N,m)),this.emitInitSegment=!0},P.generateInitSegment=function(N){var S=this.audioCodec,f=this.videoCodec;if(!N||!N.byteLength){this.initTracks=void 0,this.initData=void 0;return}var m=this.initData=(0,U.parseInitSegment)(N);S||(S=F(m.audio,D.ElementaryStreamTypes.AUDIO)),f||(f=F(m.video,D.ElementaryStreamTypes.VIDEO));var d={};m.audio&&m.video?d.audiovideo={container:"video/mp4",codec:S+","+f,initSegment:N,id:"main"}:m.audio?d.audio={container:"audio/mp4",codec:S,initSegment:N,id:"audio"}:m.video?d.video={container:"video/mp4",codec:f,initSegment:N,id:"main"}:K.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=d},P.remux=function(N,S,f,m,d){var l,b=this.initPTS,h=this.lastEndTime,o={audio:void 0,video:void 0,text:m,id3:f,initSegment:void 0};(0,R.isFiniteNumber)(h)||(h=this.lastEndTime=d||0);var E=S.samples;if(!E||!E.length)return o;var A={initPTS:void 0,timescale:1},v=this.initData;if((!v||!v.length)&&(this.generateInitSegment(E),v=this.initData),!v||!v.length)return K.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),o;this.emitInitSegment&&(A.tracks=this.initTracks,this.emitInitSegment=!1);var c=(0,U.getStartDTS)(v,E);(0,R.isFiniteNumber)(b)||(this.initPTS=A.initPTS=b=c-d);var s=(0,U.getDuration)(E,v),p=N?c-b:h,a=p+s;(0,U.offsetStartDTS)(v,E,b),s>0?this.lastEndTime=a:(K.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var T=!!v.audio,L=!!v.video,I="";T&&(I+="audio"),L&&(I+="video");var H={data1:E,startPTS:p,startDTS:p,endPTS:a,endDTS:a,type:I,hasAudio:T,hasVideo:L,nb:1,dropped:0};o.audio=H.type==="audio"?H:void 0,o.video=H.type!=="audio"?H:void 0,o.initSegment=A;var W=(l=this.initPTS)!=null?l:0;return o.id3=(0,_.flushTextTrackMetadataCueSamples)(f,d,W,W),m.samples.length&&(o.text=(0,_.flushTextTrackUserdataCueSamples)(m,d,W)),o},O}();function F(O,P){var g=O==null?void 0:O.codec;return g&&g.length>4?g:g==="hvc1"||g==="hev1"?"hvc1.1.c.L120.90":g==="av01"?"av01.0.04M.08":g==="avc1"||P===D.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const B=k},"./src/task-loop.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>R});var R=function(){function _(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var U=_.prototype;return U.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},U.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},U.onHandlerDestroyed=function(){},U.hasInterval=function(){return!!this._tickInterval},U.hasNextTick=function(){return!!this._tickTimer},U.setInterval=function(K){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,K),!0)},U.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},U.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},U.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},U.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},U.doTick=function(){},_}()},"./src/types/cmcd.ts":(M,C,u)=>{u.r(C),u.d(C,{CMCDObjectType:()=>_,CMCDStreamType:()=>D,CMCDStreamingFormat:()=>U,CMCDVersion:()=>R});var R=1,_;(function(K){K.MANIFEST="m",K.AUDIO="a",K.VIDEO="v",K.MUXED="av",K.INIT="i",K.CAPTION="c",K.TIMED_TEXT="tt",K.KEY="k",K.OTHER="o"})(_||(_={}));var U;(function(K){K.DASH="d",K.HLS="h",K.SMOOTH="s",K.OTHER="o"})(U||(U={}));var D;(function(K){K.VOD="v",K.LIVE="l"})(D||(D={}))},"./src/types/demuxer.ts":(M,C,u)=>{u.r(C),u.d(C,{MetadataSchema:()=>R});var R;(function(_){_.audioId3="org.id3",_.dateRange="com.apple.quicktime.HLS",_.emsg="https://aomedia.org/emsg/ID3"})(R||(R={}))},"./src/types/level.ts":(M,C,u)=>{u.r(C),u.d(C,{HdcpLevels:()=>K,HlsSkip:()=>k,HlsUrlParameters:()=>B,Level:()=>O,getSkipValue:()=>F});function R(P,g){for(var N=0;N<g.length;N++){var S=g[N];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(P,U(S.key),S)}}function _(P,g,N){return g&&R(P.prototype,g),N&&R(P,N),Object.defineProperty(P,"prototype",{writable:!1}),P}function U(P){var g=D(P,"string");return typeof g=="symbol"?g:String(g)}function D(P,g){if(typeof P!="object"||P===null)return P;var N=P[Symbol.toPrimitive];if(N!==void 0){var S=N.call(P,g||"default");if(typeof S!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(P)}var K=["NONE","TYPE-0","TYPE-1","TYPE-2",null],k;(function(P){P.No="",P.Yes="YES",P.v2="v2"})(k||(k={}));function F(P,g){var N=P.canSkipUntil,S=P.canSkipDateRanges,f=P.endSN,m=g!==void 0?g-f:0;return N&&m<N?S?k.v2:k.Yes:k.No}var B=function(){function P(N,S,f){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=N,this.part=S,this.skip=f}var g=P.prototype;return g.addDirectives=function(S){var f=new self.URL(S);return this.msn!==void 0&&f.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&f.searchParams.set("_HLS_part",this.part.toString()),this.skip&&f.searchParams.set("_HLS_skip",this.skip),f.href},P}(),O=function(){function P(g){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[g.url],this.attrs=g.attrs,this.bitrate=g.bitrate,g.details&&(this.details=g.details),this.id=g.id||0,this.name=g.name,this.width=g.width||0,this.height=g.height||0,this.audioCodec=g.audioCodec,this.videoCodec=g.videoCodec,this.unknownCodecs=g.unknownCodecs,this.codecSet=[g.videoCodec,g.audioCodec].filter(function(N){return N}).join(",").replace(/\.[^.,]+/g,"")}return _(P,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(N){var S=N%this.url.length;this._urlId!==S&&(this.details=void 0,this._urlId=S)}}]),P}()},"./src/types/loader.ts":(M,C,u)=>{u.r(C),u.d(C,{PlaylistContextType:()=>R,PlaylistLevelType:()=>_});var R;(function(U){U.MANIFEST="manifest",U.LEVEL="level",U.AUDIO_TRACK="audioTrack",U.SUBTITLE_TRACK="subtitleTrack"})(R||(R={}));var _;(function(U){U.MAIN="main",U.AUDIO="audio",U.SUBTITLE="subtitle"})(_||(_={}))},"./src/types/transmuxer.ts":(M,C,u)=>{u.r(C),u.d(C,{ChunkMetadata:()=>R});var R=function(D,K,k,F,B,O){F===void 0&&(F=0),B===void 0&&(B=-1),O===void 0&&(O=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=_(),this.buffering={audio:_(),video:_(),audiovideo:_()},this.level=D,this.sn=K,this.id=k,this.size=F,this.part=B,this.partial=O};function _(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(M,C,u)=>{u.r(C),u.d(C,{AttrList:()=>U});var R=/^(\d+)x(\d+)$/,_=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,U=function(){function D(k){typeof k=="string"&&(k=D.parseAttrList(k));for(var F in k)k.hasOwnProperty(F)&&(this[F]=k[F])}var K=D.prototype;return K.decimalInteger=function(F){var B=parseInt(this[F],10);return B>Number.MAX_SAFE_INTEGER?1/0:B},K.hexadecimalInteger=function(F){if(this[F]){var B=(this[F]||"0x").slice(2);B=(B.length&1?"0":"")+B;for(var O=new Uint8Array(B.length/2),P=0;P<B.length/2;P++)O[P]=parseInt(B.slice(P*2,P*2+2),16);return O}else return null},K.hexadecimalIntegerAsNumber=function(F){var B=parseInt(this[F],16);return B>Number.MAX_SAFE_INTEGER?1/0:B},K.decimalFloatingPoint=function(F){return parseFloat(this[F])},K.optionalFloat=function(F,B){var O=this[F];return O?parseFloat(O):B},K.enumeratedString=function(F){return this[F]},K.bool=function(F){return this[F]==="YES"},K.decimalResolution=function(F){var B=R.exec(this[F]);if(B!==null)return{width:parseInt(B[1],10),height:parseInt(B[2],10)}},D.parseAttrList=function(F){var B,O={},P='"';for(_.lastIndex=0;(B=_.exec(F))!==null;){var g=B[2];g.indexOf(P)===0&&g.lastIndexOf(P)===g.length-1&&(g=g.slice(1,-1)),O[B[1]]=g}return O},D}()},"./src/utils/binary-search.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>_});var R={search:function(D,K){for(var k=0,F=D.length-1,B=null,O=null;k<=F;){B=(k+F)/2|0,O=D[B];var P=K(O);if(P>0)k=B+1;else if(P<0)F=B-1;else return O}return null}};const _=R},"./src/utils/buffer-helper.ts":(M,C,u)=>{u.r(C),u.d(C,{BufferHelper:()=>U});var R=u("./src/utils/logger.ts"),_={length:0,start:function(){return 0},end:function(){return 0}},U=function(){function D(){}return D.isBuffered=function(k,F){try{if(k){for(var B=D.getBuffered(k),O=0;O<B.length;O++)if(F>=B.start(O)&&F<=B.end(O))return!0}}catch{}return!1},D.bufferInfo=function(k,F,B){try{if(k){var O=D.getBuffered(k),P=[],g;for(g=0;g<O.length;g++)P.push({start:O.start(g),end:O.end(g)});return this.bufferedInfo(P,F,B)}}catch{}return{len:0,start:F,end:F,nextStart:void 0}},D.bufferedInfo=function(k,F,B){F=Math.max(0,F),k.sort(function(o,E){var A=o.start-E.start;return A||E.end-o.end});var O=[];if(B)for(var P=0;P<k.length;P++){var g=O.length;if(g){var N=O[g-1].end;k[P].start-N<B?k[P].end>N&&(O[g-1].end=k[P].end):O.push(k[P])}else O.push(k[P])}else O=k;for(var S=0,f,m=F,d=F,l=0;l<O.length;l++){var b=O[l].start,h=O[l].end;if(F+B>=b&&F<h)m=b,d=h,S=d-F;else if(F+B<b){f=b;break}}return{len:S,start:m||0,end:d||0,nextStart:f}},D.getBuffered=function(k){try{return k.buffered}catch(F){return R.logger.log("failed to get media.buffered",F),_}},D}()},"./src/utils/cea-608-parser.ts":(M,C,u)=>{u.r(C),u.d(C,{CaptionScreen:()=>l,Row:()=>d,default:()=>v});var R=u("./src/utils/logger.ts"),_={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},U=function(s){var p=s;return _.hasOwnProperty(s)&&(p=_[s]),String.fromCharCode(p)},D=15,K=100,k={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},F={17:2,18:4,21:6,22:8,23:10,19:13,20:15},B={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},O={25:2,26:4,29:6,30:8,31:10,27:13,28:15},P=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],g;(function(c){c[c.ERROR=0]="ERROR",c[c.TEXT=1]="TEXT",c[c.WARNING=2]="WARNING",c[c.INFO=2]="INFO",c[c.DEBUG=3]="DEBUG",c[c.DATA=3]="DATA"})(g||(g={}));var N=function(){function c(){this.time=null,this.verboseLevel=g.ERROR}var s=c.prototype;return s.log=function(a,T){if(this.verboseLevel>=a){var L=typeof T=="function"?T():T;R.logger.log(this.time+" ["+a+"] "+L)}},c}(),S=function(s){for(var p=[],a=0;a<s.length;a++)p.push(s[a].toString(16));return p},f=function(){function c(p,a,T,L,I){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=p||"white",this.underline=a||!1,this.italics=T||!1,this.background=L||"black",this.flash=I||!1}var s=c.prototype;return s.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},s.setStyles=function(a){for(var T=["foreground","underline","italics","background","flash"],L=0;L<T.length;L++){var I=T[L];a.hasOwnProperty(I)&&(this[I]=a[I])}},s.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},s.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},s.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},s.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},c}(),m=function(){function c(p,a,T,L,I,H){this.uchar=void 0,this.penState=void 0,this.uchar=p||" ",this.penState=new f(a,T,L,I,H)}var s=c.prototype;return s.reset=function(){this.uchar=" ",this.penState.reset()},s.setChar=function(a,T){this.uchar=a,this.penState.copy(T)},s.setPenState=function(a){this.penState.copy(a)},s.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},s.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},s.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},c}(),d=function(){function c(p){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var a=0;a<K;a++)this.chars.push(new m);this.logger=p,this.pos=0,this.currPenState=new f}var s=c.prototype;return s.equals=function(a){for(var T=!0,L=0;L<K;L++)if(!this.chars[L].equals(a.chars[L])){T=!1;break}return T},s.copy=function(a){for(var T=0;T<K;T++)this.chars[T].copy(a.chars[T])},s.isEmpty=function(){for(var a=!0,T=0;T<K;T++)if(!this.chars[T].isEmpty()){a=!1;break}return a},s.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(this.logger.log(g.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>K&&(this.logger.log(g.DEBUG,"Too large cursor position "+this.pos),this.pos=K)},s.moveCursor=function(a){var T=this.pos+a;if(a>1)for(var L=this.pos+1;L<T+1;L++)this.chars[L].setPenState(this.currPenState);this.setCursor(T)},s.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},s.insertChar=function(a){var T=this;a>=144&&this.backSpace();var L=U(a);if(this.pos>=K){this.logger.log(g.ERROR,function(){return"Cannot insert "+a.toString(16)+" ("+L+") at position "+T.pos+". Skipping it!"});return}this.chars[this.pos].setChar(L,this.currPenState),this.moveCursor(1)},s.clearFromPos=function(a){var T;for(T=a;T<K;T++)this.chars[T].reset()},s.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},s.clearToEndOfRow=function(){this.clearFromPos(this.pos)},s.getTextString=function(){for(var a=[],T=!0,L=0;L<K;L++){var I=this.chars[L].uchar;I!==" "&&(T=!1),a.push(I)}return T?"":a.join("")},s.setPenStyles=function(a){this.currPenState.setStyles(a);var T=this.chars[this.pos];T.setPenState(this.currPenState)},c}(),l=function(){function c(p){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var a=0;a<D;a++)this.rows.push(new d(p));this.logger=p,this.currRow=D-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var s=c.prototype;return s.reset=function(){for(var a=0;a<D;a++)this.rows[a].clear();this.currRow=D-1},s.equals=function(a){for(var T=!0,L=0;L<D;L++)if(!this.rows[L].equals(a.rows[L])){T=!1;break}return T},s.copy=function(a){for(var T=0;T<D;T++)this.rows[T].copy(a.rows[T])},s.isEmpty=function(){for(var a=!0,T=0;T<D;T++)if(!this.rows[T].isEmpty()){a=!1;break}return a},s.backSpace=function(){var a=this.rows[this.currRow];a.backSpace()},s.clearToEndOfRow=function(){var a=this.rows[this.currRow];a.clearToEndOfRow()},s.insertChar=function(a){var T=this.rows[this.currRow];T.insertChar(a)},s.setPen=function(a){var T=this.rows[this.currRow];T.setPenStyles(a)},s.moveCursor=function(a){var T=this.rows[this.currRow];T.moveCursor(a)},s.setCursor=function(a){this.logger.log(g.INFO,"setCursor: "+a);var T=this.rows[this.currRow];T.setCursor(a)},s.setPAC=function(a){this.logger.log(g.INFO,function(){return"pacData = "+JSON.stringify(a)});var T=a.row-1;if(this.nrRollUpRows&&T<this.nrRollUpRows-1&&(T=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==T){for(var L=0;L<D;L++)this.rows[L].clear();var I=this.currRow+1-this.nrRollUpRows,H=this.lastOutputScreen;if(H){var W=H.rows[I].cueStartTime,w=this.logger.time;if(W&&w!==null&&W<w)for(var G=0;G<this.nrRollUpRows;G++)this.rows[T-this.nrRollUpRows+G+1].copy(H.rows[I+G])}}this.currRow=T;var Y=this.rows[this.currRow];if(a.indent!==null){var j=a.indent,X=Math.max(j-1,0);Y.setCursor(a.indent),a.color=Y.chars[X].penState.foreground}var q={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(q)},s.setBkgData=function(a){this.logger.log(g.INFO,function(){return"bkgData = "+JSON.stringify(a)}),this.backSpace(),this.setPen(a),this.insertChar(32)},s.setRollUpRows=function(a){this.nrRollUpRows=a},s.rollUp=function(){var a=this;if(this.nrRollUpRows===null){this.logger.log(g.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(g.TEXT,function(){return a.getDisplayText()});var T=this.currRow+1-this.nrRollUpRows,L=this.rows.splice(T,1)[0];L.clear(),this.rows.splice(this.currRow,0,L),this.logger.log(g.INFO,"Rolling up")},s.getDisplayText=function(a){a=a||!1;for(var T=[],L="",I=-1,H=0;H<D;H++){var W=this.rows[H].getTextString();W&&(I=H+1,a?T.push("Row "+I+": '"+W+"'"):T.push(W.trim()))}return T.length>0&&(a?L="["+T.join(" | ")+"]":L=T.join(`
`)),L},s.getTextAndFormat=function(){return this.rows},c}(),b=function(){function c(p,a,T){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=p,this.outputFilter=a,this.mode=null,this.verbose=0,this.displayedMemory=new l(T),this.nonDisplayedMemory=new l(T),this.lastOutputScreen=new l(T),this.currRollUpRow=this.displayedMemory.rows[D-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=T}var s=c.prototype;return s.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[D-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},s.getHandler=function(){return this.outputFilter},s.setHandler=function(a){this.outputFilter=a},s.setPAC=function(a){this.writeScreen.setPAC(a)},s.setBkgData=function(a){this.writeScreen.setBkgData(a)},s.setMode=function(a){a!==this.mode&&(this.mode=a,this.logger.log(g.INFO,function(){return"MODE="+a}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},s.insertChars=function(a){for(var T=this,L=0;L<a.length;L++)this.writeScreen.insertChar(a[L]);var I=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(g.INFO,function(){return I+": "+T.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(g.TEXT,function(){return"DISPLAYED: "+T.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},s.ccRCL=function(){this.logger.log(g.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},s.ccBS=function(){this.logger.log(g.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},s.ccAOF=function(){},s.ccAON=function(){},s.ccDER=function(){this.logger.log(g.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},s.ccRU=function(a){this.logger.log(g.INFO,"RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},s.ccFON=function(){this.logger.log(g.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},s.ccRDC=function(){this.logger.log(g.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},s.ccTR=function(){this.logger.log(g.INFO,"TR"),this.setMode("MODE_TEXT")},s.ccRTD=function(){this.logger.log(g.INFO,"RTD"),this.setMode("MODE_TEXT")},s.ccEDM=function(){this.logger.log(g.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},s.ccCR=function(){this.logger.log(g.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},s.ccENM=function(){this.logger.log(g.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},s.ccEOC=function(){var a=this;if(this.logger.log(g.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var T=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=T,this.writeScreen=this.nonDisplayedMemory,this.logger.log(g.TEXT,function(){return"DISP: "+a.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},s.ccTO=function(a){this.logger.log(g.INFO,"TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},s.ccMIDROW=function(a){var T={flash:!1};if(T.underline=a%2===1,T.italics=a>=46,T.italics)T.foreground="white";else{var L=Math.floor(a/2)-16,I=["white","green","blue","cyan","red","yellow","magenta"];T.foreground=I[L]}this.logger.log(g.INFO,"MIDROW: "+JSON.stringify(T)),this.writeScreen.setPen(T)},s.outputDataUpdate=function(a){a===void 0&&(a=!1);var T=this.logger.time;T!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=T:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,T,this.lastOutputScreen),a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:T),this.lastOutputScreen.copy(this.displayedMemory))},s.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},c}(),h=function(){function c(p,a,T){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var L=new N;this.channels=[null,new b(p,a,L),new b(p+1,T,L)],this.cmdHistory=A(),this.logger=L}var s=c.prototype;return s.getHandler=function(a){return this.channels[a].getHandler()},s.setHandler=function(a,T){this.channels[a].setHandler(T)},s.addData=function(a,T){var L,I,H,W=!1;this.logger.time=a;for(var w=0;w<T.length;w+=2)if(I=T[w]&127,H=T[w+1]&127,!(I===0&&H===0)){if(this.logger.log(g.DATA,"["+S([T[w],T[w+1]])+"] -> ("+S([I,H])+")"),L=this.parseCmd(I,H),L||(L=this.parseMidrow(I,H)),L||(L=this.parsePAC(I,H)),L||(L=this.parseBackgroundAttributes(I,H)),!L&&(W=this.parseChars(I,H),W)){var G=this.currentChannel;if(G&&G>0){var Y=this.channels[G];Y.insertChars(W)}else this.logger.log(g.WARNING,"No channel found yet. TEXT-MODE?")}!L&&!W&&this.logger.log(g.WARNING,"Couldn't parse cleaned data "+S([I,H])+" orig: "+S([T[w],T[w+1]]))}},s.parseCmd=function(a,T){var L=this.cmdHistory,I=(a===20||a===28||a===21||a===29)&&T>=32&&T<=47,H=(a===23||a===31)&&T>=33&&T<=35;if(!(I||H))return!1;if(E(a,T,L))return o(null,null,L),this.logger.log(g.DEBUG,"Repeated command ("+S([a,T])+") is dropped"),!0;var W=a===20||a===21||a===23?1:2,w=this.channels[W];return a===20||a===21||a===28||a===29?T===32?w.ccRCL():T===33?w.ccBS():T===34?w.ccAOF():T===35?w.ccAON():T===36?w.ccDER():T===37?w.ccRU(2):T===38?w.ccRU(3):T===39?w.ccRU(4):T===40?w.ccFON():T===41?w.ccRDC():T===42?w.ccTR():T===43?w.ccRTD():T===44?w.ccEDM():T===45?w.ccCR():T===46?w.ccENM():T===47&&w.ccEOC():w.ccTO(T-32),o(a,T,L),this.currentChannel=W,!0},s.parseMidrow=function(a,T){var L=0;if((a===17||a===25)&&T>=32&&T<=47){if(a===17?L=1:L=2,L!==this.currentChannel)return this.logger.log(g.ERROR,"Mismatch channel in midrow parsing"),!1;var I=this.channels[L];return I?(I.ccMIDROW(T),this.logger.log(g.DEBUG,"MIDROW ("+S([a,T])+")"),!0):!1}return!1},s.parsePAC=function(a,T){var L,I=this.cmdHistory,H=(a>=17&&a<=23||a>=25&&a<=31)&&T>=64&&T<=127,W=(a===16||a===24)&&T>=64&&T<=95;if(!(H||W))return!1;if(E(a,T,I))return o(null,null,I),!0;var w=a<=23?1:2;T>=64&&T<=95?L=w===1?k[a]:B[a]:L=w===1?F[a]:O[a];var G=this.channels[w];return G?(G.setPAC(this.interpretPAC(L,T)),o(a,T,I),this.currentChannel=w,!0):!1},s.interpretPAC=function(a,T){var L,I={color:null,italics:!1,indent:null,underline:!1,row:a};return T>95?L=T-96:L=T-64,I.underline=(L&1)===1,L<=13?I.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(L/2)]:L<=15?(I.italics=!0,I.color="white"):I.indent=Math.floor((L-16)/2)*4,I},s.parseChars=function(a,T){var L,I=null,H=null;if(a>=25?(L=2,H=a-8):(L=1,H=a),H>=17&&H<=19){var W;H===17?W=T+80:H===18?W=T+112:W=T+144,this.logger.log(g.INFO,"Special char '"+U(W)+"' in channel "+L),I=[W]}else a>=32&&a<=127&&(I=T===0?[a]:[a,T]);if(I){var w=S(I);this.logger.log(g.DEBUG,"Char codes =  "+w.join(",")),o(a,T,this.cmdHistory)}return I},s.parseBackgroundAttributes=function(a,T){var L=(a===16||a===24)&&T>=32&&T<=47,I=(a===23||a===31)&&T>=45&&T<=47;if(!(L||I))return!1;var H,W={};a===16||a===24?(H=Math.floor((T-32)/2),W.background=P[H],T%2===1&&(W.background=W.background+"_semi")):T===45?W.background="transparent":(W.foreground="black",T===47&&(W.underline=!0));var w=a<=23?1:2,G=this.channels[w];return G.setBkgData(W),o(a,T,this.cmdHistory),!0},s.reset=function(){for(var a=0;a<Object.keys(this.channels).length;a++){var T=this.channels[a];T&&T.reset()}this.cmdHistory=A()},s.cueSplitAtTime=function(a){for(var T=0;T<this.channels.length;T++){var L=this.channels[T];L&&L.cueSplitAtTime(a)}},c}();function o(c,s,p){p.a=c,p.b=s}function E(c,s,p){return p.a===c&&p.b===s}function A(){return{a:null,b:null}}const v=h},"./src/utils/codecs.ts":(M,C,u)=>{u.r(C),u.d(C,{isCodecSupportedInMp4:()=>U,isCodecType:()=>_});var R={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function _(D,K){var k=R[K];return!!k&&k[D.slice(0,4)]===!0}function U(D,K){return MediaSource.isTypeSupported((K||"video")+'/mp4;codecs="'+D+'"')}},"./src/utils/cues.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>k});var R=u("./src/utils/vttparser.ts"),_=u("./src/utils/webvtt-parser.ts"),U=u("./src/utils/texttrack-utils.ts"),D=/\s/,K={newCue:function(B,O,P,g){for(var N=[],S,f,m,d,l,b=self.VTTCue||self.TextTrackCue,h=0;h<g.rows.length;h++)if(S=g.rows[h],m=!0,d=0,l="",!S.isEmpty()){for(var o=0;o<S.chars.length;o++)D.test(S.chars[o].uchar)&&m?d++:(l+=S.chars[o].uchar,m=!1);S.cueStartTime=O,O===P&&(P+=1e-4),d>=16?d--:d++;var E=(0,R.fixLineBreaks)(l.trim()),A=(0,_.generateCueId)(O,P,E);(!B||!B.cues||!B.cues.getCueById(A))&&(f=new b(O,P,E),f.id=A,f.line=h+1,f.align="left",f.position=10+Math.min(80,Math.floor(d*8/32)*10),N.push(f))}return B&&N.length&&(N.sort(function(v,c){return v.line==="auto"||c.line==="auto"?0:v.line>8&&c.line>8?c.line-v.line:v.line-c.line}),N.forEach(function(v){return(0,U.addCueToTrack)(B,v)})),N}};const k=K},"./src/utils/discontinuities.ts":(M,C,u)=>{u.r(C),u.d(C,{adjustSlidingStart:()=>B,alignMediaPlaylistByPDT:()=>N,alignPDT:()=>g,alignStream:()=>O,findDiscontinuousReferenceFrag:()=>k,findFirstFragWithCC:()=>D,shouldAlignOnDiscontinuities:()=>K});var R=u("./src/polyfills/number.ts"),_=u("./src/utils/logger.ts"),U=u("./src/controller/level-helper.ts");function D(S,f){for(var m=null,d=0,l=S.length;d<l;d++){var b=S[d];if(b&&b.cc===f){m=b;break}}return m}function K(S,f,m){return!!(f.details&&(m.endCC>m.startCC||S&&S.cc<m.startCC))}function k(S,f,m){var d=S.fragments,l=f.fragments;if(!l.length||!d.length){_.logger.log("No fragments to align");return}var b=D(d,l[0].cc);if(!b||b&&!b.startPTS){_.logger.log("No frag in previous level to align on");return}return b}function F(S,f){if(S){var m=S.start+f;S.start=S.startPTS=m,S.endPTS=m+S.duration}}function B(S,f){for(var m=f.fragments,d=0,l=m.length;d<l;d++)F(m[d],S);f.fragmentHint&&F(f.fragmentHint,S),f.alignedSliding=!0}function O(S,f,m){f&&(P(S,m,f),!m.alignedSliding&&f.details&&g(m,f.details),!m.alignedSliding&&f.details&&!m.skippedSegments&&(0,U.adjustSliding)(f.details,m))}function P(S,f,m){if(K(S,m,f)){var d=k(m.details,f);d&&(0,R.isFiniteNumber)(d.start)&&(_.logger.log("Adjusting PTS using last level due to CC increase within current level "+f.url),B(d.start,f))}}function g(S,f){if(!(!f.fragments.length||!S.hasProgramDateTime||!f.hasProgramDateTime)){var m=f.fragments[0].programDateTime,d=S.fragments[0].programDateTime,l=(d-m)/1e3+f.fragments[0].start;l&&(0,R.isFiniteNumber)(l)&&(_.logger.log("Adjusting PTS using programDateTime delta "+(d-m)+"ms, sliding:"+l.toFixed(3)+" "+S.url+" "),B(l,S))}}function N(S,f){if(!(!S.hasProgramDateTime||!f.hasProgramDateTime)){var m=S.fragments,d=f.fragments;if(!(!m.length||!d.length)){var l=Math.round(d.length/2)-1,b=d[l],h=D(m,b.cc)||m[Math.round(m.length/2)-1],o=b.programDateTime,E=h.programDateTime;if(!(o===null||E===null)){var A=(E-o)/1e3-(h.start-b.start);B(A,S)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>U});var R=u("./src/utils/ewma.ts"),_=function(){function D(k,F,B){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=B,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new R.default(k),this.fast_=new R.default(F)}var K=D.prototype;return K.update=function(F,B){var O=this.slow_,P=this.fast_;this.slow_.halfLife!==F&&(this.slow_=new R.default(F,O.getEstimate(),O.getTotalWeight())),this.fast_.halfLife!==B&&(this.fast_=new R.default(B,P.getEstimate(),P.getTotalWeight()))},K.sample=function(F,B){F=Math.max(F,this.minDelayMs_);var O=8*B,P=F/1e3,g=O/P;this.fast_.sample(P,g),this.slow_.sample(P,g)},K.canEstimate=function(){var F=this.fast_;return F&&F.getTotalWeight()>=this.minWeight_},K.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},K.destroy=function(){},D}();const U=_},"./src/utils/ewma.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>_});var R=function(){function U(K,k,F){k===void 0&&(k=0),F===void 0&&(F=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=K,this.alpha_=K?Math.exp(Math.log(.5)/K):0,this.estimate_=k,this.totalWeight_=F}var D=U.prototype;return D.sample=function(k,F){var B=Math.pow(this.alpha_,k);this.estimate_=F*(1-B)+B*this.estimate_,this.totalWeight_+=k},D.getTotalWeight=function(){return this.totalWeight_},D.getEstimate=function(){if(this.alpha_){var k=1-Math.pow(this.alpha_,this.totalWeight_);if(k)return this.estimate_/k}return this.estimate_},U}();const _=R},"./src/utils/fetch-loader.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>l,fetchSupported:()=>N});var R=u("./src/polyfills/number.ts"),_=u("./src/loader/load-stats.ts"),U=u("./src/demux/chunk-cache.ts");function D(b,h){b.prototype=Object.create(h.prototype),b.prototype.constructor=b,O(b,h)}function K(b){var h=typeof Map=="function"?new Map:void 0;return K=function(E){if(E===null||!B(E))return E;if(typeof E!="function")throw new TypeError("Super expression must either be null or a function");if(typeof h<"u"){if(h.has(E))return h.get(E);h.set(E,A)}function A(){return k(E,arguments,P(this).constructor)}return A.prototype=Object.create(E.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),O(A,E)},K(b)}function k(b,h,o){return F()?k=Reflect.construct.bind():k=function(A,v,c){var s=[null];s.push.apply(s,v);var p=Function.bind.apply(A,s),a=new p;return c&&O(a,c.prototype),a},k.apply(null,arguments)}function F(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function B(b){return Function.toString.call(b).indexOf("[native code]")!==-1}function O(b,h){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,A){return E.__proto__=A,E},O(b,h)}function P(b){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},P(b)}function g(){return g=Object.assign?Object.assign.bind():function(b){for(var h=1;h<arguments.length;h++){var o=arguments[h];for(var E in o)Object.prototype.hasOwnProperty.call(o,E)&&(b[E]=o[E])}return b},g.apply(this,arguments)}function N(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var S=function(){function b(o){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=o.fetchSetup||m,this.controller=new self.AbortController,this.stats=new _.LoadStats}var h=b.prototype;return h.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},h.abortInternal=function(){var E=this.response;(!E||!E.ok)&&(this.stats.aborted=!0,this.controller.abort())},h.abort=function(){var E;this.abortInternal(),(E=this.callbacks)!==null&&E!==void 0&&E.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},h.load=function(E,A,v){var c=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var p=f(E,this.controller.signal),a=v.onProgress,T=E.responseType==="arraybuffer",L=T?"byteLength":"length";this.context=E,this.config=A,this.callbacks=v,this.request=this.fetchSetup(E,p),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){c.abortInternal(),v.onTimeout(s,E,c.response)},A.timeout),self.fetch(this.request).then(function(I){if(c.response=c.loader=I,!I.ok){var H=I.status,W=I.statusText;throw new d(W||"fetch, bad network response",H,I)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(I.headers.get("Content-Length")||"0"),a&&(0,R.isFiniteNumber)(A.highWaterMark)?c.loadProgressively(I,s,E,A.highWaterMark,a):T?I.arrayBuffer():I.text()}).then(function(I){var H=c.response;self.clearTimeout(c.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var W=I[L];W&&(s.loaded=s.total=W);var w={url:H.url,data:I};a&&!(0,R.isFiniteNumber)(A.highWaterMark)&&a(s,E,I,H),v.onSuccess(w,s,E,H)}).catch(function(I){if(self.clearTimeout(c.requestTimeout),!s.aborted){var H=I&&I.code||0,W=I?I.message:null;v.onError({code:H,text:W},E,I?I.details:null)}})},h.getCacheAge=function(){var E=null;if(this.response){var A=this.response.headers.get("age");E=A?parseFloat(A):null}return E},h.loadProgressively=function(E,A,v,c,s){c===void 0&&(c=0);var p=new U.default,a=E.body.getReader(),T=function L(){return a.read().then(function(I){if(I.done)return p.dataLength&&s(A,v,p.flush(),E),Promise.resolve(new ArrayBuffer(0));var H=I.value,W=H.length;return A.loaded+=W,W<c||p.dataLength?(p.push(H),p.dataLength>=c&&s(A,v,p.flush(),E)):s(A,v,H,E),L()}).catch(function(){return Promise.reject()})};return T()},b}();function f(b,h){var o={method:"GET",mode:"cors",credentials:"same-origin",signal:h,headers:new self.Headers(g({},b.headers))};return b.rangeEnd&&o.headers.set("Range","bytes="+b.rangeStart+"-"+String(b.rangeEnd-1)),o}function m(b,h){return new self.Request(b.url,h)}var d=function(b){D(h,b);function h(o,E,A){var v;return v=b.call(this,o)||this,v.code=void 0,v.details=void 0,v.code=E,v.details=A,v}return h}(K(Error));const l=S},"./src/utils/hex.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>_});var R={hexDump:function(D){for(var K="",k=0;k<D.length;k++){var F=D[k].toString(16);F.length<2&&(F="0"+F),K+=F}return K}};const _=R},"./src/utils/imsc1-ttml-parser.ts":(M,C,u)=>{u.r(C),u.d(C,{IMSC1_CODEC:()=>B,parseIMSC1:()=>N});var R=u("./src/utils/mp4-tools.ts"),_=u("./src/utils/vttparser.ts"),U=u("./src/utils/vttcue.ts"),D=u("./src/demux/id3.ts"),K=u("./src/utils/timescale-conversion.ts"),k=u("./src/utils/webvtt-parser.ts");function F(){return F=Object.assign?Object.assign.bind():function(v){for(var c=1;c<arguments.length;c++){var s=arguments[c];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(v[p]=s[p])}return v},F.apply(this,arguments)}var B="stpp.ttml.im1t",O=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,P=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,g={left:"start",center:"center",right:"end",start:"start",end:"end"};function N(v,c,s,p,a){var T=(0,R.findBox)(new Uint8Array(v),["mdat"]);if(T.length===0){a(new Error("Could not parse IMSC1 mdat"));return}var L=T.map(function(H){return(0,D.utf8ArrayToStr)(H)}),I=(0,K.toTimescaleFromScale)(c,1,s);try{L.forEach(function(H){return p(S(H,I))})}catch(H){a(H)}}function S(v,c){var s=new DOMParser,p=s.parseFromString(v,"text/xml"),a=p.getElementsByTagName("tt")[0];if(!a)throw new Error("Invalid ttml");var T={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},L=Object.keys(T).reduce(function(G,Y){return G[Y]=a.getAttribute("ttp:"+Y)||T[Y],G},{}),I=a.getAttribute("xml:space")!=="preserve",H=m(f(a,"styling","style")),W=m(f(a,"layout","region")),w=f(a,"body","[begin]");return[].map.call(w,function(G){var Y=d(G,I);if(!Y||!G.hasAttribute("begin"))return null;var j=o(G.getAttribute("begin"),L),X=o(G.getAttribute("dur"),L),q=o(G.getAttribute("end"),L);if(j===null)throw h(G);if(q===null){if(X===null)throw h(G);q=j+X}var J=new U.default(j-c,q-c,Y);J.id=(0,k.generateCueId)(J.startTime,J.endTime,J.text);var V=W[G.getAttribute("region")],Q=H[G.getAttribute("style")],ee=l(V,Q,H),Z=ee.textAlign;if(Z){var re=g[Z];re&&(J.lineAlign=re),J.align=Z}return F(J,ee),J}).filter(function(G){return G!==null})}function f(v,c,s){var p=v.getElementsByTagName(c)[0];return p?[].slice.call(p.querySelectorAll(s)):[]}function m(v){return v.reduce(function(c,s){var p=s.getAttribute("xml:id");return p&&(c[p]=s),c},{})}function d(v,c){return[].slice.call(v.childNodes).reduce(function(s,p,a){var T;return p.nodeName==="br"&&a?s+`
`:(T=p.childNodes)!==null&&T!==void 0&&T.length?d(p,c):c?s+p.textContent.trim().replace(/\s+/g," "):s+p.textContent},"")}function l(v,c,s){var p="http://www.w3.org/ns/ttml#styling",a=null,T=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],L=v!=null&&v.hasAttribute("style")?v.getAttribute("style"):null;return L&&s.hasOwnProperty(L)&&(a=s[L]),T.reduce(function(I,H){var W=b(c,p,H)||b(v,p,H)||b(a,p,H);return W&&(I[H]=W),I},{})}function b(v,c,s){return v&&v.hasAttributeNS(c,s)?v.getAttributeNS(c,s):null}function h(v){return new Error("Could not parse ttml timestamp "+v)}function o(v,c){if(!v)return null;var s=(0,_.parseTimeStamp)(v);return s===null&&(O.test(v)?s=E(v,c):P.test(v)&&(s=A(v,c))),s}function E(v,c){var s=O.exec(v),p=(s[4]|0)+(s[5]|0)/c.subFrameRate;return(s[1]|0)*3600+(s[2]|0)*60+(s[3]|0)+p/c.frameRate}function A(v,c){var s=P.exec(v),p=Number(s[1]),a=s[2];switch(a){case"h":return p*3600;case"m":return p*60;case"ms":return p*1e3;case"f":return p/c.frameRate;case"t":return p/c.tickRate}return p}},"./src/utils/keysystem-util.ts":(M,C,u)=>{u.r(C),u.d(C,{changeEndianness:()=>U,convertDataUriToArrayBytes:()=>D,strToUtf8array:()=>K});var R=u("./src/utils/numeric-encoding-utils.ts");function _(k){var F=K(k).subarray(0,16),B=new Uint8Array(16);return B.set(F,16-F.length),B}function U(k){var F=function(O,P,g){var N=O[P];O[P]=O[g],O[g]=N};F(k,0,3),F(k,1,2),F(k,4,5),F(k,6,7)}function D(k){var F=k.split(":"),B=null;if(F[0]==="data"&&F.length===2){var O=F[1].split(";"),P=O[O.length-1].split(",");if(P.length===2){var g=P[0]==="base64",N=P[1];g?(O.splice(-1,1),B=(0,R.base64Decode)(N)):B=_(N)}}return B}function K(k){return Uint8Array.from(unescape(encodeURIComponent(k)),function(F){return F.charCodeAt(0)})}},"./src/utils/logger.ts":(M,C,u)=>{u.r(C),u.d(C,{enableLogs:()=>k,logger:()=>F});var R=function(){},_={trace:R,debug:R,log:R,warn:R,info:R,error:R},U=_;function D(B){var O=self.console[B];return O?O.bind(self.console,"["+B+"] >"):R}function K(B){for(var O=arguments.length,P=new Array(O>1?O-1:0),g=1;g<O;g++)P[g-1]=arguments[g];P.forEach(function(N){U[N]=B[N]?B[N].bind(B):D(N)})}function k(B,O){if(self.console&&B===!0||typeof B=="object"){K(B,"debug","log","info","warn","error");try{U.log('Debug logs enabled for "'+O+'"')}catch{U=_}}else U=_}var F=U},"./src/utils/mediakeys-helper.ts":(M,C,u)=>{u.r(C),u.d(C,{KeySystemFormats:()=>_,KeySystemIds:()=>D,KeySystems:()=>R,getKeySystemsForConfig:()=>F,getSupportedMediaKeySystemConfigurations:()=>O,keySystemDomainToKeySystemFormat:()=>k,keySystemFormatToKeySystemDomain:()=>U,keySystemIdToKeySystemDomain:()=>K,requestMediaKeySystemAccess:()=>B});var R;(function(g){g.CLEARKEY="org.w3.clearkey",g.FAIRPLAY="com.apple.fps",g.PLAYREADY="com.microsoft.playready",g.WIDEVINE="com.widevine.alpha"})(R||(R={}));var _;(function(g){g.CLEARKEY="org.w3.clearkey",g.FAIRPLAY="com.apple.streamingkeydelivery",g.PLAYREADY="com.microsoft.playready",g.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"})(_||(_={}));function U(g){switch(g){case _.FAIRPLAY:return R.FAIRPLAY;case _.PLAYREADY:return R.PLAYREADY;case _.WIDEVINE:return R.WIDEVINE;case _.CLEARKEY:return R.CLEARKEY}}var D;(function(g){g.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"})(D||(D={}));function K(g){if(g===D.WIDEVINE)return R.WIDEVINE}function k(g){switch(g){case R.FAIRPLAY:return _.FAIRPLAY;case R.PLAYREADY:return _.PLAYREADY;case R.WIDEVINE:return _.WIDEVINE;case R.CLEARKEY:return _.CLEARKEY}}function F(g){var N=g.drmSystems,S=g.widevineLicenseUrl,f=N?[R.FAIRPLAY,R.WIDEVINE,R.PLAYREADY,R.CLEARKEY].filter(function(m){return!!N[m]}):[];return!f[R.WIDEVINE]&&S&&f.push(R.WIDEVINE),f}var B=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function O(g,N,S,f){var m;switch(g){case R.FAIRPLAY:m=["cenc","sinf"];break;case R.WIDEVINE:case R.PLAYREADY:m=["cenc"];break;case R.CLEARKEY:m=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+g)}return P(m,N,S,f)}function P(g,N,S,f){var m={initDataTypes:g,persistentState:f.persistentState||"not-allowed",distinctiveIdentifier:f.distinctiveIdentifier||"not-allowed",sessionTypes:f.sessionTypes||[f.sessionType||"temporary"],audioCapabilities:N.map(function(d){return{contentType:'audio/mp4; codecs="'+d+'"',robustness:f.audioRobustness||"",encryptionScheme:f.audioEncryptionScheme||null}}),videoCapabilities:S.map(function(d){return{contentType:'video/mp4; codecs="'+d+'"',robustness:f.videoRobustness||"",encryptionScheme:f.videoEncryptionScheme||null}})};return[m]}},"./src/utils/mediasource-helper.ts":(M,C,u)=>{u.r(C),u.d(C,{getMediaSource:()=>R});function R(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(M,C,u)=>{u.r(C),u.d(C,{RemuxerTrackIdConfig:()=>B,appendUint8Array:()=>c,bin2str:()=>O,computeRawDurationFromSamples:()=>E,discardEPB:()=>L,findBox:()=>f,getDuration:()=>o,getStartDTS:()=>h,mp4Box:()=>H,mp4pssh:()=>W,offsetStartDTS:()=>A,parseEmsg:()=>I,parseInitSegment:()=>d,parsePssh:()=>w,parseSEIMessageFromNALu:()=>T,parseSamples:()=>s,parseSegmentIndex:()=>m,parseSinf:()=>b,patchEncyptionData:()=>l,readSint32:()=>N,readUint16:()=>P,readUint32:()=>g,segmentValidRange:()=>v,writeUint32:()=>S});var R=u("./src/loader/fragment.ts"),_=u("./src/utils/typed-array.ts"),U=u("./src/demux/id3.ts"),D=u("./src/utils/logger.ts"),K=u("./src/utils/hex.ts"),k=Math.pow(2,32)-1,F=[].push,B={video:1,audio:2,id3:3,text:4};function O(G){return String.fromCharCode.apply(null,G)}function P(G,Y){var j=G[Y]<<8|G[Y+1];return j<0?65536+j:j}function g(G,Y){var j=N(G,Y);return j<0?4294967296+j:j}function N(G,Y){return G[Y]<<24|G[Y+1]<<16|G[Y+2]<<8|G[Y+3]}function S(G,Y,j){G[Y]=j>>24,G[Y+1]=j>>16&255,G[Y+2]=j>>8&255,G[Y+3]=j&255}function f(G,Y){var j=[];if(!Y.length)return j;for(var X=G.byteLength,q=0;q<X;){var J=g(G,q),V=O(G.subarray(q+4,q+8)),Q=J>1?q+J:X;if(V===Y[0])if(Y.length===1)j.push(G.subarray(q+8,Q));else{var ee=f(G.subarray(q+8,Q),Y.slice(1));ee.length&&F.apply(j,ee)}q=Q}return j}function m(G){var Y=[],j=G[0],X=8,q=g(G,X);X+=4;var J=0,V=0;j===0?X+=8:X+=16,X+=2;var Q=G.length+V,ee=P(G,X);X+=2;for(var Z=0;Z<ee;Z++){var re=X,ae=g(G,re);re+=4;var le=ae&2147483647,ne=(ae&2147483648)>>>31;if(ne===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var ie=g(G,re);re+=4,Y.push({referenceSize:le,subsegmentDuration:ie,info:{duration:ie/q,start:Q,end:Q+le-1}}),Q+=le,re+=4,X=re}return{earliestPresentationTime:J,timescale:q,version:j,referencesCount:ee,references:Y}}function d(G){for(var Y=[],j=f(G,["moov","trak"]),X=0;X<j.length;X++){var q=j[X],J=f(q,["tkhd"])[0];if(J){var V=J[0],Q=V===0?12:20,ee=g(J,Q),Z=f(q,["mdia","mdhd"])[0];if(Z){V=Z[0],Q=V===0?12:20;var re=g(Z,Q),ae=f(q,["mdia","hdlr"])[0];if(ae){var le=O(ae.subarray(8,12)),ne={soun:R.ElementaryStreamTypes.AUDIO,vide:R.ElementaryStreamTypes.VIDEO}[le];if(ne){var ie=f(q,["mdia","minf","stbl","stsd"])[0],ue=void 0;ie&&(ue=O(ie.subarray(12,16))),Y[ee]={timescale:re,type:ne},Y[ne]={timescale:re,id:ee,codec:ue}}}}}}var ge=f(G,["moov","mvex","trex"]);return ge.forEach(function(he){var Ee=g(he,4),me=Y[Ee];me&&(me.default={duration:g(he,12),flags:g(he,20)})}),Y}function l(G,Y){if(!G||!Y)return G;var j=Y.keyId;if(j&&Y.isCommonEncryption){var X=f(G,["moov","trak"]);X.forEach(function(q){var J=f(q,["mdia","minf","stbl","stsd"])[0],V=J.subarray(8),Q=f(V,["enca"]),ee=Q.length>0;ee||(Q=f(V,["encv"])),Q.forEach(function(Z){var re=ee?Z.subarray(28):Z.subarray(78),ae=f(re,["sinf"]);ae.forEach(function(le){var ne=b(le);if(ne){var ie=ne.subarray(8,24);ie.some(function(ue){return ue!==0})||(D.logger.log("[eme] Patching keyId in 'enc"+(ee?"a":"v")+">sinf>>tenc' box: "+K.default.hexDump(ie)+" -> "+K.default.hexDump(j)),ne.set(j,8))}})})})}return G}function b(G){var Y=f(G,["schm"])[0];if(Y){var j=O(Y.subarray(4,8));if(j==="cbcs"||j==="cenc")return f(G,["schi","tenc"])[0]}return D.logger.error("[eme] missing 'schm' box"),null}function h(G,Y){return f(Y,["moof","traf"]).reduce(function(j,X){var q=f(X,["tfdt"])[0],J=q[0],V=f(X,["tfhd"]).reduce(function(Q,ee){var Z=g(ee,4),re=G[Z];if(re){var ae=g(q,4);J===1&&(ae*=Math.pow(2,32),ae+=g(q,8));var le=re.timescale||9e4,ne=ae/le;if(isFinite(ne)&&(Q===null||ne<Q))return ne}return Q},null);return V!==null&&isFinite(V)&&(j===null||V<j)?V:j},null)||0}function o(G,Y){for(var j=0,X=0,q=0,J=f(G,["moof","traf"]),V=0;V<J.length;V++){var Q=J[V],ee=f(Q,["tfhd"])[0],Z=g(ee,4),re=Y[Z];if(re){var ae=re.default,le=g(ee,0)|(ae==null?void 0:ae.flags),ne=ae==null?void 0:ae.duration;le&8&&(le&2?ne=g(ee,12):ne=g(ee,8));for(var ie=re.timescale||9e4,ue=f(Q,["trun"]),ge=0;ge<ue.length;ge++){if(j=E(ue[ge]),!j&&ne){var he=g(ue[ge],4);j=ne*he}re.type===R.ElementaryStreamTypes.VIDEO?X+=j/ie:re.type===R.ElementaryStreamTypes.AUDIO&&(q+=j/ie)}}}if(X===0&&q===0){for(var Ee=0,me=f(G,["sidx"]),pe=0;pe<me.length;pe++){var Te=m(me[pe]);Te!=null&&Te.references&&(Ee+=Te.references.reduce(function(_e,ye){return _e+ye.info.duration||0},0))}return Ee}return X||q}function E(G){var Y=g(G,0),j=8;Y&1&&(j+=4),Y&4&&(j+=4);for(var X=0,q=g(G,4),J=0;J<q;J++){if(Y&256){var V=g(G,j);X+=V,j+=4}Y&512&&(j+=4),Y&1024&&(j+=4),Y&2048&&(j+=4)}return X}function A(G,Y,j){f(Y,["moof","traf"]).forEach(function(X){f(X,["tfhd"]).forEach(function(q){var J=g(q,4),V=G[J];if(V){var Q=V.timescale||9e4;f(X,["tfdt"]).forEach(function(ee){var Z=ee[0],re=g(ee,4);if(Z===0)re-=j*Q,re=Math.max(re,0),S(ee,4,re);else{re*=Math.pow(2,32),re+=g(ee,8),re-=j*Q,re=Math.max(re,0);var ae=Math.floor(re/(k+1)),le=Math.floor(re%(k+1));S(ee,4,ae),S(ee,8,le)}})}})})}function v(G){var Y={valid:null,remainder:null},j=f(G,["moof"]);if(j){if(j.length<2)return Y.remainder=G,Y}else return Y;var X=j[j.length-1];return Y.valid=(0,_.sliceUint8)(G,0,X.byteOffset-8),Y.remainder=(0,_.sliceUint8)(G,X.byteOffset-8),Y}function c(G,Y){var j=new Uint8Array(G.length+Y.length);return j.set(G),j.set(Y,G.length),j}function s(G,Y){var j=[],X=Y.samples,q=Y.timescale,J=Y.id,V=!1,Q=f(X,["moof"]);return Q.map(function(ee){var Z=ee.byteOffset-8,re=f(ee,["traf"]);re.map(function(ae){var le=f(ae,["tfdt"]).map(function(ne){var ie=ne[0],ue=g(ne,4);return ie===1&&(ue*=Math.pow(2,32),ue+=g(ne,8)),ue/q})[0];return le!==void 0&&(G=le),f(ae,["tfhd"]).map(function(ne){var ie=g(ne,4),ue=g(ne,0)&16777215,ge=(ue&1)!==0,he=(ue&2)!==0,Ee=(ue&8)!==0,me=0,pe=(ue&16)!==0,Te=0,_e=(ue&32)!==0,ye=8;ie===J&&(ge&&(ye+=8),he&&(ye+=4),Ee&&(me=g(ne,ye),ye+=4),pe&&(Te=g(ne,ye),ye+=4),_e&&(ye+=4),Y.type==="video"&&(V=p(Y.codec)),f(ae,["trun"]).map(function(Le){var Fe=Le[0],we=g(Le,0)&16777215,He=(we&1)!==0,ot=0,Pe=(we&4)!==0,We=(we&256)!==0,tt=0,ft=(we&512)!==0,dt=0,$e=(we&1024)!==0,Xe=(we&2048)!==0,ht=0,vt=g(Le,4),Ge=8;He&&(ot=g(Le,Ge),Ge+=4),Pe&&(Ge+=4);for(var gt=ot+Z,pt=0;pt<vt;pt++){if(We?(tt=g(Le,Ge),Ge+=4):tt=me,ft?(dt=g(Le,Ge),Ge+=4):dt=Te,$e&&(Ge+=4),Xe&&(Fe===0?ht=g(Le,Ge):ht=N(Le,Ge),Ge+=4),Y.type===R.ElementaryStreamTypes.VIDEO)for(var xn=0;xn<dt;){var tr=g(X,gt);if(gt+=4,a(V,X[gt])){var Tr=X.subarray(gt,gt+tr);T(Tr,V?2:1,G+ht/q,j)}gt+=tr,xn+=tr+4}G+=tt/q}}))})})}),j}function p(G){if(!G)return!1;var Y=G.indexOf("."),j=Y<0?G:G.substring(0,Y);return j==="hvc1"||j==="hev1"||j==="dvh1"||j==="dvhe"}function a(G,Y){if(G){var j=Y>>1&63;return j===39||j===40}else{var X=Y&31;return X===6}}function T(G,Y,j,X){var q=L(G),J=0;J+=Y;for(var V=0,Q=0,ee=!1,Z=0;J<q.length;){V=0;do{if(J>=q.length)break;Z=q[J++],V+=Z}while(Z===255);Q=0;do{if(J>=q.length)break;Z=q[J++],Q+=Z}while(Z===255);var re=q.length-J;if(!ee&&V===4&&J<q.length){ee=!0;var ae=q[J++];if(ae===181){var le=P(q,J);if(J+=2,le===49){var ne=g(q,J);if(J+=4,ne===1195456820){var ie=q[J++];if(ie===3){var ue=q[J++],ge=31&ue,he=64&ue,Ee=he?2+ge*3:0,me=new Uint8Array(Ee);if(he){me[0]=ue;for(var pe=1;pe<Ee;pe++)me[pe]=q[J++]}X.push({type:ie,payloadType:V,pts:j,bytes:me})}}}}}else if(V===5&&Q<re){if(ee=!0,Q>16){for(var Te=[],_e=0;_e<16;_e++){var ye=q[J++].toString(16);Te.push(ye.length==1?"0"+ye:ye),(_e===3||_e===5||_e===7||_e===9)&&Te.push("-")}for(var Le=Q-16,Fe=new Uint8Array(Le),we=0;we<Le;we++)Fe[we]=q[J++];X.push({payloadType:V,pts:j,uuid:Te.join(""),userData:(0,U.utf8ArrayToStr)(Fe),userDataBytes:Fe})}}else if(Q<re)J+=Q;else if(Q>re)break}}function L(G){for(var Y=G.byteLength,j=[],X=1;X<Y-2;)G[X]===0&&G[X+1]===0&&G[X+2]===3?(j.push(X+2),X+=2):X++;if(j.length===0)return G;var q=Y-j.length,J=new Uint8Array(q),V=0;for(X=0;X<q;V++,X++)V===j[0]&&(V++,j.shift()),J[X]=G[V];return J}function I(G){var Y=G[0],j="",X="",q=0,J=0,V=0,Q=0,ee=0,Z=0;if(Y===0){for(;O(G.subarray(Z,Z+1))!=="\0";)j+=O(G.subarray(Z,Z+1)),Z+=1;for(j+=O(G.subarray(Z,Z+1)),Z+=1;O(G.subarray(Z,Z+1))!=="\0";)X+=O(G.subarray(Z,Z+1)),Z+=1;X+=O(G.subarray(Z,Z+1)),Z+=1,q=g(G,12),J=g(G,16),Q=g(G,20),ee=g(G,24),Z=28}else if(Y===1){Z+=4,q=g(G,Z),Z+=4;var re=g(G,Z);Z+=4;var ae=g(G,Z);for(Z+=4,V=Math.pow(2,32)*re+ae,Number.isSafeInteger(V)||(V=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),Q=g(G,Z),Z+=4,ee=g(G,Z),Z+=4;O(G.subarray(Z,Z+1))!=="\0";)j+=O(G.subarray(Z,Z+1)),Z+=1;for(j+=O(G.subarray(Z,Z+1)),Z+=1;O(G.subarray(Z,Z+1))!=="\0";)X+=O(G.subarray(Z,Z+1)),Z+=1;X+=O(G.subarray(Z,Z+1)),Z+=1}var le=G.subarray(Z,G.byteLength);return{schemeIdUri:j,value:X,timeScale:q,presentationTime:V,presentationTimeDelta:J,eventDuration:Q,id:ee,payload:le}}function H(G){for(var Y=arguments.length,j=new Array(Y>1?Y-1:0),X=1;X<Y;X++)j[X-1]=arguments[X];for(var q=j.length,J=8,V=q;V--;)J+=j[V].byteLength;var Q=new Uint8Array(J);for(Q[0]=J>>24&255,Q[1]=J>>16&255,Q[2]=J>>8&255,Q[3]=J&255,Q.set(G,4),V=0,J=8;V<q;V++)Q.set(j[V],J),J+=j[V].byteLength;return Q}function W(G,Y,j){if(G.byteLength!==16)throw new RangeError("Invalid system id");var X,q;if(Y){X=1,q=new Uint8Array(Y.length*16);for(var J=0;J<Y.length;J++){var V=Y[J];if(V.byteLength!==16)throw new RangeError("Invalid key");q.set(V,J*16)}}else X=0,q=new Uint8Array;var Q;X>0?(Q=new Uint8Array(4),Y.length>0&&new DataView(Q.buffer).setUint32(0,Y.length,!1)):Q=new Uint8Array;var ee=new Uint8Array(4);return j&&j.byteLength>0&&new DataView(ee.buffer).setUint32(0,j.byteLength,!1),H([112,115,115,104],new Uint8Array([X,0,0,0]),G,Q,q,ee,j||new Uint8Array)}function w(G){if(!(G instanceof ArrayBuffer)||G.byteLength<32)return null;var Y={version:0,systemId:"",kids:null,data:null},j=new DataView(G),X=j.getUint32(0);if(G.byteLength!==X&&X>44)return null;var q=j.getUint32(4);if(q!==1886614376||(Y.version=j.getUint32(8)>>>24,Y.version>1))return null;Y.systemId=K.default.hexDump(new Uint8Array(G,12,16));var J=j.getUint32(28);if(Y.version===0){if(X-32<J)return null;Y.data=new Uint8Array(G,32,J)}else if(Y.version===1){Y.kids=[];for(var V=0;V<J;V++)Y.kids.push(new Uint8Array(G,32+V*16,16))}return Y}},"./src/utils/numeric-encoding-utils.ts":(M,C,u)=>{u.r(C),u.d(C,{base64Decode:()=>k,base64DecodeToStr:()=>U,base64Encode:()=>D,base64ToBase64Url:()=>R,base64UrlEncode:()=>K,strToBase64Encode:()=>_});function R(F){return F.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function _(F){return btoa(F)}function U(F){return atob(F)}function D(F){return btoa(String.fromCharCode.apply(String,F))}function K(F){return R(D(F))}function k(F){return Uint8Array.from(atob(F),function(B){return B.charCodeAt(0)})}},"./src/utils/output-filter.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>R});var R=function(){function _(D,K){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=D,this.trackName=K}var U=_.prototype;return U.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},U.newCue=function(K,k,F){(this.startTime===null||this.startTime>K)&&(this.startTime=K),this.endTime=k,this.screen=F,this.timelineController.createCaptionsTrack(this.trackName)},U.reset=function(){this.cueRanges=[],this.startTime=null},_}()},"./src/utils/texttrack-utils.ts":(M,C,u)=>{u.r(C),u.d(C,{addCueToTrack:()=>U,clearCurrentCues:()=>D,getCuesInRange:()=>F,removeCuesInRange:()=>K,sendAddTrackEvent:()=>_});var R=u("./src/utils/logger.ts");function _(B,O){var P;try{P=new Event("addtrack")}catch{P=document.createEvent("Event"),P.initEvent("addtrack",!1,!1)}P.track=B,O.dispatchEvent(P)}function U(B,O){var P=B.mode;if(P==="disabled"&&(B.mode="hidden"),B.cues&&!B.cues.getCueById(O.id))try{if(B.addCue(O),!B.cues.getCueById(O.id))throw new Error("addCue is failed for: "+O)}catch(N){R.logger.debug("[texttrack-utils]: "+N);var g=new self.TextTrackCue(O.startTime,O.endTime,O.text);g.id=O.id,B.addCue(g)}P==="disabled"&&(B.mode=P)}function D(B){var O=B.mode;if(O==="disabled"&&(B.mode="hidden"),B.cues)for(var P=B.cues.length;P--;)B.removeCue(B.cues[P]);O==="disabled"&&(B.mode=O)}function K(B,O,P,g){var N=B.mode;if(N==="disabled"&&(B.mode="hidden"),B.cues&&B.cues.length>0)for(var S=F(B.cues,O,P),f=0;f<S.length;f++)(!g||g(S[f]))&&B.removeCue(S[f]);N==="disabled"&&(B.mode=N)}function k(B,O){if(O<B[0].startTime)return 0;var P=B.length-1;if(O>B[P].endTime)return-1;for(var g=0,N=P;g<=N;){var S=Math.floor((N+g)/2);if(O<B[S].startTime)N=S-1;else if(O>B[S].startTime&&g<P)g=S+1;else return S}return B[g].startTime-O<O-B[N].startTime?g:N}function F(B,O,P){var g=[],N=k(B,O);if(N>-1)for(var S=N,f=B.length;S<f;S++){var m=B[S];if(m.startTime>=O&&m.endTime<=P)g.push(m);else if(m.startTime>P)return g}return g}},"./src/utils/time-ranges.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>_});var R={toString:function(D){for(var K="",k=D.length,F=0;F<k;F++)K+="["+D.start(F).toFixed(3)+","+D.end(F).toFixed(3)+"]";return K}};const _=R},"./src/utils/timescale-conversion.ts":(M,C,u)=>{u.r(C),u.d(C,{toMpegTsClockFromTimescale:()=>K,toMsFromMpegTsClock:()=>D,toTimescaleFromBase:()=>_,toTimescaleFromScale:()=>U});var R=9e4;function _(k,F,B,O){B===void 0&&(B=1),O===void 0&&(O=!1);var P=k*F*B;return O?Math.round(P):P}function U(k,F,B,O){return B===void 0&&(B=1),O===void 0&&(O=!1),_(k,F,1/B,O)}function D(k,F){return F===void 0&&(F=!1),_(k,1e3,1/R,F)}function K(k,F){return F===void 0&&(F=1),_(k,R,1/F)}},"./src/utils/typed-array.ts":(M,C,u)=>{u.r(C),u.d(C,{sliceUint8:()=>R});function R(_,U,D){return Uint8Array.prototype.slice?_.slice(U,D):new Uint8Array(Array.prototype.slice.call(_,U,D))}},"./src/utils/vttcue.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>R});const R=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var _=["","lr","rl"],U=["start","middle","end","left","right"];function D(O,P){if(typeof P!="string"||!Array.isArray(O))return!1;var g=P.toLowerCase();return~O.indexOf(g)?g:!1}function K(O){return D(_,O)}function k(O){return D(U,O)}function F(O){for(var P=arguments.length,g=new Array(P>1?P-1:0),N=1;N<P;N++)g[N-1]=arguments[N];for(var S=1;S<arguments.length;S++){var f=arguments[S];for(var m in f)O[m]=f[m]}return O}function B(O,P,g){var N=this,S={enumerable:!0};N.hasBeenReset=!1;var f="",m=!1,d=O,l=P,b=g,h=null,o="",E=!0,A="auto",v="start",c=50,s="middle",p=50,a="middle";Object.defineProperty(N,"id",F({},S,{get:function(){return f},set:function(L){f=""+L}})),Object.defineProperty(N,"pauseOnExit",F({},S,{get:function(){return m},set:function(L){m=!!L}})),Object.defineProperty(N,"startTime",F({},S,{get:function(){return d},set:function(L){if(typeof L!="number")throw new TypeError("Start time must be set to a number.");d=L,this.hasBeenReset=!0}})),Object.defineProperty(N,"endTime",F({},S,{get:function(){return l},set:function(L){if(typeof L!="number")throw new TypeError("End time must be set to a number.");l=L,this.hasBeenReset=!0}})),Object.defineProperty(N,"text",F({},S,{get:function(){return b},set:function(L){b=""+L,this.hasBeenReset=!0}})),Object.defineProperty(N,"region",F({},S,{get:function(){return h},set:function(L){h=L,this.hasBeenReset=!0}})),Object.defineProperty(N,"vertical",F({},S,{get:function(){return o},set:function(L){var I=K(L);if(I===!1)throw new SyntaxError("An invalid or illegal string was specified.");o=I,this.hasBeenReset=!0}})),Object.defineProperty(N,"snapToLines",F({},S,{get:function(){return E},set:function(L){E=!!L,this.hasBeenReset=!0}})),Object.defineProperty(N,"line",F({},S,{get:function(){return A},set:function(L){if(typeof L!="number"&&L!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");A=L,this.hasBeenReset=!0}})),Object.defineProperty(N,"lineAlign",F({},S,{get:function(){return v},set:function(L){var I=k(L);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");v=I,this.hasBeenReset=!0}})),Object.defineProperty(N,"position",F({},S,{get:function(){return c},set:function(L){if(L<0||L>100)throw new Error("Position must be between 0 and 100.");c=L,this.hasBeenReset=!0}})),Object.defineProperty(N,"positionAlign",F({},S,{get:function(){return s},set:function(L){var I=k(L);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");s=I,this.hasBeenReset=!0}})),Object.defineProperty(N,"size",F({},S,{get:function(){return p},set:function(L){if(L<0||L>100)throw new Error("Size must be between 0 and 100.");p=L,this.hasBeenReset=!0}})),Object.defineProperty(N,"align",F({},S,{get:function(){return a},set:function(L){var I=k(L);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");a=I,this.hasBeenReset=!0}})),N.displayState=void 0}return B.prototype.getCueAsHTML=function(){var O=self.WebVTT;return O.convertCueToDOMTree(self,this.text)},B}()},"./src/utils/vttparser.ts":(M,C,u)=>{u.r(C),u.d(C,{VTTParser:()=>P,fixLineBreaks:()=>O,parseTimeStamp:()=>U});var R=u("./src/utils/vttcue.ts"),_=function(){function g(){}var N=g.prototype;return N.decode=function(f,m){if(!f)return"";if(typeof f!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(f))},g}();function U(g){function N(f,m,d,l){return(f|0)*3600+(m|0)*60+(d|0)+parseFloat(l||0)}var S=g.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return S?parseFloat(S[2])>59?N(S[2],S[3],0,S[4]):N(S[1],S[2],S[3],S[4]):null}var D=function(){function g(){this.values=Object.create(null)}var N=g.prototype;return N.set=function(f,m){!this.get(f)&&m!==""&&(this.values[f]=m)},N.get=function(f,m,d){return d?this.has(f)?this.values[f]:m[d]:this.has(f)?this.values[f]:m},N.has=function(f){return f in this.values},N.alt=function(f,m,d){for(var l=0;l<d.length;++l)if(m===d[l]){this.set(f,m);break}},N.integer=function(f,m){/^-?\d+$/.test(m)&&this.set(f,parseInt(m,10))},N.percent=function(f,m){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(m)){var d=parseFloat(m);if(d>=0&&d<=100)return this.set(f,d),!0}return!1},g}();function K(g,N,S,f){var m=f?g.split(f):[g];for(var d in m)if(typeof m[d]=="string"){var l=m[d].split(S);if(l.length===2){var b=l[0],h=l[1];N(b,h)}}}var k=new R.default(0,0,""),F=k.align==="middle"?"middle":"center";function B(g,N,S){var f=g;function m(){var b=U(g);if(b===null)throw new Error("Malformed timestamp: "+f);return g=g.replace(/^[^\sa-zA-Z-]+/,""),b}function d(b,h){var o=new D;K(b,function(v,c){var s;switch(v){case"region":for(var p=S.length-1;p>=0;p--)if(S[p].id===c){o.set(v,S[p].region);break}break;case"vertical":o.alt(v,c,["rl","lr"]);break;case"line":s=c.split(","),o.integer(v,s[0]),o.percent(v,s[0])&&o.set("snapToLines",!1),o.alt(v,s[0],["auto"]),s.length===2&&o.alt("lineAlign",s[1],["start",F,"end"]);break;case"position":s=c.split(","),o.percent(v,s[0]),s.length===2&&o.alt("positionAlign",s[1],["start",F,"end","line-left","line-right","auto"]);break;case"size":o.percent(v,c);break;case"align":o.alt(v,c,["start",F,"end","left","right"]);break}},/:/,/\s/),h.region=o.get("region",null),h.vertical=o.get("vertical","");var E=o.get("line","auto");E==="auto"&&k.line===-1&&(E=-1),h.line=E,h.lineAlign=o.get("lineAlign","start"),h.snapToLines=o.get("snapToLines",!0),h.size=o.get("size",100),h.align=o.get("align",F);var A=o.get("position","auto");A==="auto"&&k.position===50&&(A=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=A}function l(){g=g.replace(/^\s+/,"")}if(l(),N.startTime=m(),l(),g.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+f);g=g.slice(3),l(),N.endTime=m(),l(),d(g,N)}function O(g){return g.replace(/<br(?: \/)?>/gi,`
`)}var P=function(){function g(){this.state="INITIAL",this.buffer="",this.decoder=new _,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var N=g.prototype;return N.parse=function(f){var m=this;f&&(m.buffer+=m.decoder.decode(f,{stream:!0}));function d(){var A=m.buffer,v=0;for(A=O(A);v<A.length&&A[v]!=="\r"&&A[v]!==`
`;)++v;var c=A.slice(0,v);return A[v]==="\r"&&++v,A[v]===`
`&&++v,m.buffer=A.slice(v),c}function l(A){K(A,function(v,c){},/:/)}try{var b="";if(m.state==="INITIAL"){if(!/\r\n|\n/.test(m.buffer))return this;b=d();var h=b.match(/^()?WEBVTT([ \t].*)?$/);if(!h||!h[0])throw new Error("Malformed WebVTT signature.");m.state="HEADER"}for(var o=!1;m.buffer;){if(!/\r\n|\n/.test(m.buffer))return this;switch(o?o=!1:b=d(),m.state){case"HEADER":/:/.test(b)?l(b):b||(m.state="ID");continue;case"NOTE":b||(m.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(b)){m.state="NOTE";break}if(!b)continue;if(m.cue=new R.default(0,0,""),m.state="CUE",b.indexOf("-->")===-1){m.cue.id=b;continue}case"CUE":if(!m.cue){m.state="BADCUE";continue}try{B(b,m.cue,m.regionList)}catch{m.cue=null,m.state="BADCUE";continue}m.state="CUETEXT";continue;case"CUETEXT":{var E=b.indexOf("-->")!==-1;if(!b||E&&(o=!0)){m.oncue&&m.cue&&m.oncue(m.cue),m.cue=null,m.state="ID";continue}if(m.cue===null)continue;m.cue.text&&(m.cue.text+=`
`),m.cue.text+=b}continue;case"BADCUE":b||(m.state="ID")}}}catch{m.state==="CUETEXT"&&m.cue&&m.oncue&&m.oncue(m.cue),m.cue=null,m.state=m.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},N.flush=function(){var f=this;try{if((f.cue||f.state==="HEADER")&&(f.buffer+=`

`,f.parse()),f.state==="INITIAL"||f.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(m){f.onparsingerror&&f.onparsingerror(m)}return f.onflush&&f.onflush(),this},g}()},"./src/utils/webvtt-parser.ts":(M,C,u)=>{u.r(C),u.d(C,{generateCueId:()=>P,parseWebVTT:()=>N});var R=u("./src/polyfills/number.ts"),_=u("./src/utils/vttparser.ts"),U=u("./src/demux/id3.ts"),D=u("./src/utils/timescale-conversion.ts"),K=u("./src/remux/mp4-remuxer.ts"),k=/\r\n|\n\r|\n|\r/g,F=function(f,m,d){return d===void 0&&(d=0),f.slice(d,d+m.length)===m},B=function(f){var m=parseInt(f.slice(-3)),d=parseInt(f.slice(-6,-4)),l=parseInt(f.slice(-9,-7)),b=f.length>9?parseInt(f.substring(0,f.indexOf(":"))):0;if(!(0,R.isFiniteNumber)(m)||!(0,R.isFiniteNumber)(d)||!(0,R.isFiniteNumber)(l)||!(0,R.isFiniteNumber)(b))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+f);return m+=1e3*d,m+=60*1e3*l,m+=60*60*1e3*b,m},O=function(f){for(var m=5381,d=f.length;d;)m=m*33^f.charCodeAt(--d);return(m>>>0).toString()};function P(S,f,m){return O(S.toString())+O(f.toString())+O(m)}var g=function(f,m,d){var l=f[m],b=f[l.prevCC];if(!b||!b.new&&l.new){f.ccOffset=f.presentationOffset=l.start,l.new=!1;return}for(;(h=b)!==null&&h!==void 0&&h.new;){var h;f.ccOffset+=l.start-b.start,l.new=!1,l=b,b=f[l.prevCC]}f.presentationOffset=d};function N(S,f,m,d,l,b,h,o){var E=new _.VTTParser,A=(0,U.utf8ArrayToStr)(new Uint8Array(S)).trim().replace(k,`
`).split(`
`),v=[],c=(0,D.toMpegTsClockFromTimescale)(f,m),s="00:00.000",p=0,a=0,T,L=!0;E.oncue=function(I){var H=d[l],W=d.ccOffset,w=(p-c)/9e4;H!=null&&H.new&&(a!==void 0?W=d.ccOffset=H.start:g(d,l,w)),w&&(W=w-d.presentationOffset);var G=I.endTime-I.startTime,Y=(0,K.normalizePts)((I.startTime+W-a)*9e4,b*9e4)/9e4;I.startTime=Math.max(Y,0),I.endTime=Math.max(Y+G,0);var j=I.text.trim();I.text=decodeURIComponent(encodeURIComponent(j)),I.id||(I.id=P(I.startTime,I.endTime,j)),I.endTime>0&&v.push(I)},E.onparsingerror=function(I){T=I},E.onflush=function(){if(T){o(T);return}h(v)},A.forEach(function(I){if(L)if(F(I,"X-TIMESTAMP-MAP=")){L=!1,I.slice(16).split(",").forEach(function(H){F(H,"LOCAL:")?s=H.slice(6):F(H,"MPEGTS:")&&(p=parseInt(H.slice(7)))});try{a=B(s)/1e3}catch(H){T=H}return}else I===""&&(L=!1);E.parse(I+`
`)}),E.flush()}},"./src/utils/xhr-loader.ts":(M,C,u)=>{u.r(C),u.d(C,{default:()=>K});var R=u("./src/utils/logger.ts"),_=u("./src/loader/load-stats.ts"),U=/^age:\s*[\d.]+\s*$/m,D=function(){function k(B){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=B?B.xhrSetup:null,this.stats=new _.LoadStats,this.retryDelay=0}var F=k.prototype;return F.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},F.abortInternal=function(){var O=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),O&&(O.onreadystatechange=null,O.onprogress=null,O.readyState!==4&&(this.stats.aborted=!0,O.abort()))},F.abort=function(){var O;this.abortInternal(),(O=this.callbacks)!==null&&O!==void 0&&O.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},F.load=function(O,P,g){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=O,this.config=P,this.callbacks=g,this.retryDelay=P.retryDelay,this.loadInternal()},F.loadInternal=function(){var O=this.config,P=this.context;if(O){var g=this.loader=new self.XMLHttpRequest,N=this.stats;N.loading.first=0,N.loaded=0;var S=this.xhrSetup;try{if(S)try{S(g,P.url)}catch{g.open("GET",P.url,!0),S(g,P.url)}g.readyState||g.open("GET",P.url,!0);var f=this.context.headers;if(f)for(var m in f)g.setRequestHeader(m,f[m])}catch(d){this.callbacks.onError({code:g.status,text:d.message},P,g);return}P.rangeEnd&&g.setRequestHeader("Range","bytes="+P.rangeStart+"-"+(P.rangeEnd-1)),g.onreadystatechange=this.readystatechange.bind(this),g.onprogress=this.loadprogress.bind(this),g.responseType=P.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),O.timeout),g.send()}},F.readystatechange=function(){var O=this.context,P=this.loader,g=this.stats;if(!(!O||!P)){var N=P.readyState,S=this.config;if(!g.aborted&&N>=2)if(self.clearTimeout(this.requestTimeout),g.loading.first===0&&(g.loading.first=Math.max(self.performance.now(),g.loading.start)),N===4){P.onreadystatechange=null,P.onprogress=null;var f=P.status,m=P.responseType==="arraybuffer";if(f>=200&&f<300&&(m&&P.response||P.responseText!==null)){g.loading.end=Math.max(self.performance.now(),g.loading.first);var d,l;if(m?(d=P.response,l=d.byteLength):(d=P.responseText,l=d.length),g.loaded=g.total=l,!this.callbacks)return;var b=this.callbacks.onProgress;if(b&&b(g,O,d,P),!this.callbacks)return;var h={url:P.responseURL,data:d};this.callbacks.onSuccess(h,g,O,P)}else g.retry>=S.maxRetry||f>=400&&f<499?(R.logger.error(f+" while loading "+O.url),this.callbacks.onError({code:f,text:P.statusText},O,P)):(R.logger.warn(f+" while loading "+O.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,S.maxRetryDelay),g.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),S.timeout)}},F.loadtimeout=function(){R.logger.warn("timeout while loading "+this.context.url);var O=this.callbacks;O&&(this.abortInternal(),O.onTimeout(this.stats,this.context,this.loader))},F.loadprogress=function(O){var P=this.stats;P.loaded=O.loaded,O.lengthComputable&&(P.total=O.total)},F.getCacheAge=function(){var O=null;if(this.loader&&U.test(this.loader.getAllResponseHeaders())){var P=this.loader.getResponseHeader("age");O=P?parseFloat(P):null}return O},k}();const K=D},"./node_modules/eventemitter3/index.js":M=>{var C=Object.prototype.hasOwnProperty,u="~";function R(){}Object.create&&(R.prototype=Object.create(null),new R().__proto__||(u=!1));function _(k,F,B){this.fn=k,this.context=F,this.once=B||!1}function U(k,F,B,O,P){if(typeof B!="function")throw new TypeError("The listener must be a function");var g=new _(B,O||k,P),N=u?u+F:F;return k._events[N]?k._events[N].fn?k._events[N]=[k._events[N],g]:k._events[N].push(g):(k._events[N]=g,k._eventsCount++),k}function D(k,F){--k._eventsCount===0?k._events=new R:delete k._events[F]}function K(){this._events=new R,this._eventsCount=0}K.prototype.eventNames=function(){var F=[],B,O;if(this._eventsCount===0)return F;for(O in B=this._events)C.call(B,O)&&F.push(u?O.slice(1):O);return Object.getOwnPropertySymbols?F.concat(Object.getOwnPropertySymbols(B)):F},K.prototype.listeners=function(F){var B=u?u+F:F,O=this._events[B];if(!O)return[];if(O.fn)return[O.fn];for(var P=0,g=O.length,N=new Array(g);P<g;P++)N[P]=O[P].fn;return N},K.prototype.listenerCount=function(F){var B=u?u+F:F,O=this._events[B];return O?O.fn?1:O.length:0},K.prototype.emit=function(F,B,O,P,g,N){var S=u?u+F:F;if(!this._events[S])return!1;var f=this._events[S],m=arguments.length,d,l;if(f.fn){switch(f.once&&this.removeListener(F,f.fn,void 0,!0),m){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,B),!0;case 3:return f.fn.call(f.context,B,O),!0;case 4:return f.fn.call(f.context,B,O,P),!0;case 5:return f.fn.call(f.context,B,O,P,g),!0;case 6:return f.fn.call(f.context,B,O,P,g,N),!0}for(l=1,d=new Array(m-1);l<m;l++)d[l-1]=arguments[l];f.fn.apply(f.context,d)}else{var b=f.length,h;for(l=0;l<b;l++)switch(f[l].once&&this.removeListener(F,f[l].fn,void 0,!0),m){case 1:f[l].fn.call(f[l].context);break;case 2:f[l].fn.call(f[l].context,B);break;case 3:f[l].fn.call(f[l].context,B,O);break;case 4:f[l].fn.call(f[l].context,B,O,P);break;default:if(!d)for(h=1,d=new Array(m-1);h<m;h++)d[h-1]=arguments[h];f[l].fn.apply(f[l].context,d)}}return!0},K.prototype.on=function(F,B,O){return U(this,F,B,O,!1)},K.prototype.once=function(F,B,O){return U(this,F,B,O,!0)},K.prototype.removeListener=function(F,B,O,P){var g=u?u+F:F;if(!this._events[g])return this;if(!B)return D(this,g),this;var N=this._events[g];if(N.fn)N.fn===B&&(!P||N.once)&&(!O||N.context===O)&&D(this,g);else{for(var S=0,f=[],m=N.length;S<m;S++)(N[S].fn!==B||P&&!N[S].once||O&&N[S].context!==O)&&f.push(N[S]);f.length?this._events[g]=f.length===1?f[0]:f:D(this,g)}return this},K.prototype.removeAllListeners=function(F){var B;return F?(B=u?u+F:F,this._events[B]&&D(this,B)):(this._events=new R,this._eventsCount=0),this},K.prototype.off=K.prototype.removeListener,K.prototype.addListener=K.prototype.on,K.prefixed=u,K.EventEmitter=K,M.exports=K},"./node_modules/url-toolkit/src/url-toolkit.js":function(M){(function(C){var u=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,R=/^(?=([^\/?#]*))\1([^]*)$/,_=/(?:\/|^)\.(?=\/)/g,U=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,D={buildAbsoluteURL:function(K,k,F){if(F=F||{},K=K.trim(),k=k.trim(),!k){if(!F.alwaysNormalize)return K;var B=D.parseURL(K);if(!B)throw new Error("Error trying to parse base URL.");return B.path=D.normalizePath(B.path),D.buildURLFromParts(B)}var O=D.parseURL(k);if(!O)throw new Error("Error trying to parse relative URL.");if(O.scheme)return F.alwaysNormalize?(O.path=D.normalizePath(O.path),D.buildURLFromParts(O)):k;var P=D.parseURL(K);if(!P)throw new Error("Error trying to parse base URL.");if(!P.netLoc&&P.path&&P.path[0]!=="/"){var g=R.exec(P.path);P.netLoc=g[1],P.path=g[2]}P.netLoc&&!P.path&&(P.path="/");var N={scheme:P.scheme,netLoc:O.netLoc,path:null,params:O.params,query:O.query,fragment:O.fragment};if(!O.netLoc&&(N.netLoc=P.netLoc,O.path[0]!=="/"))if(!O.path)N.path=P.path,O.params||(N.params=P.params,O.query||(N.query=P.query));else{var S=P.path,f=S.substring(0,S.lastIndexOf("/")+1)+O.path;N.path=D.normalizePath(f)}return N.path===null&&(N.path=F.alwaysNormalize?D.normalizePath(O.path):O.path),D.buildURLFromParts(N)},parseURL:function(K){var k=u.exec(K);return k?{scheme:k[1]||"",netLoc:k[2]||"",path:k[3]||"",params:k[4]||"",query:k[5]||"",fragment:k[6]||""}:null},normalizePath:function(K){for(K=K.split("").reverse().join("").replace(_,"");K.length!==(K=K.replace(U,"")).length;);return K.split("").reverse().join("")},buildURLFromParts:function(K){return K.scheme+K.netLoc+K.path+K.params+K.query+K.fragment}};M.exports=D})()}},n={};function i(M){var C=n[M];if(C!==void 0)return C.exports;var u=n[M]={exports:{}};return r[M].call(u.exports,u,u.exports,i),u.exports}i.m=r,i.n=M=>{var C=M&&M.__esModule?()=>M.default:()=>M;return i.d(C,{a:C}),C},i.d=(M,C)=>{for(var u in C)i.o(C,u)&&!i.o(M,u)&&Object.defineProperty(M,u,{enumerable:!0,get:C[u]})},i.o=(M,C)=>Object.prototype.hasOwnProperty.call(M,C),i.r=M=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(M,"__esModule",{value:!0})};var y=i("./src/hls.ts");return y=y.default,y})())})(nT);const ET=bg(Cs);export{wt as F,Tf as a,lt as b,uT as c,Lo as d,Go as e,Ad as f,sT as g,Gf as h,aT as i,qe as j,oT as k,Vf as l,ET as m,fT as n,md as o,cT as p,lT as q,An as r,iT as t,Lr as u};
