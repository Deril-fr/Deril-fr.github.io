import{r as Ce,a as qe,l as et}from"./index-9bc5cc7d.js";import{g as tt,a as rt}from"./animehelper-a615122c.js";import{d as it,a as nt,q as at,c as st,k as ot,o as lt,e as ut}from"./vendor-49e97ae7.js";var ft=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dt(xe){return xe&&xe.__esModule&&Object.prototype.hasOwnProperty.call(xe,"default")?xe.default:xe}var we={},ht={get exports(){return we},set exports(xe){we=xe}};(function(xe,Fe){typeof window<"u"&&function(Le,ue){xe.exports=ue()}(ft,()=>(()=>{var Re={"./src/config.ts":(V,w,x)=>{x.r(w),x.d(w,{enableStreamingMode:()=>h,hlsDefaultConfig:()=>u,mergeConfig:()=>t});var F=x("./src/controller/abr-controller.ts"),A=x("./src/controller/audio-stream-controller.ts"),b=x("./src/controller/audio-track-controller.ts"),I=x("./src/controller/subtitle-stream-controller.ts"),k=x("./src/controller/subtitle-track-controller.ts"),P=x("./src/controller/buffer-controller.ts"),L=x("./src/controller/timeline-controller.ts"),S=x("./src/controller/cap-level-controller.ts"),_=x("./src/controller/fps-controller.ts"),T=x("./src/controller/eme-controller.ts"),c=x("./src/controller/cmcd-controller.ts"),y=x("./src/utils/xhr-loader.ts"),m=x("./src/utils/fetch-loader.ts"),l=x("./src/utils/cues.ts"),f=x("./src/utils/mediakeys-helper.ts"),a=x("./src/utils/logger.ts");function i(){return i=Object.assign?Object.assign.bind():function(e){for(var d=1;d<arguments.length;d++){var p=arguments[d];for(var E in p)Object.prototype.hasOwnProperty.call(p,E)&&(e[E]=p[E])}return e},i.apply(this,arguments)}function g(e,d){var p=Object.keys(e);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(e);d&&(E=E.filter(function(D){return Object.getOwnPropertyDescriptor(e,D).enumerable})),p.push.apply(p,E)}return p}function s(e){for(var d=1;d<arguments.length;d++){var p=arguments[d]!=null?arguments[d]:{};d%2?g(Object(p),!0).forEach(function(E){r(e,E,p[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(p)):g(Object(p)).forEach(function(E){Object.defineProperty(e,E,Object.getOwnPropertyDescriptor(p,E))})}return e}function r(e,d,p){return d=o(d),d in e?Object.defineProperty(e,d,{value:p,enumerable:!0,configurable:!0,writable:!0}):e[d]=p,e}function o(e){var d=v(e,"string");return typeof d=="symbol"?d:String(d)}function v(e,d){if(typeof e!="object"||e===null)return e;var p=e[Symbol.toPrimitive];if(p!==void 0){var E=p.call(e,d||"default");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return(d==="string"?String:Number)(e)}var u=s(s({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:y.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:F.default,bufferController:P.default,capLevelController:S.default,fpsController:_.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:f.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},n()),{},{subtitleStreamController:I.SubtitleStreamController,subtitleTrackController:k.default,timelineController:L.TimelineController,audioStreamController:A.default,audioTrackController:b.default,emeController:T.default,cmcdController:c.default});function n(){return{cueHandler:l.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function t(e,d){if((d.liveSyncDurationCount||d.liveMaxLatencyDurationCount)&&(d.liveSyncDuration||d.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(d.liveMaxLatencyDurationCount!==void 0&&(d.liveSyncDurationCount===void 0||d.liveMaxLatencyDurationCount<=d.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(d.liveMaxLatencyDuration!==void 0&&(d.liveSyncDuration===void 0||d.liveMaxLatencyDuration<=d.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return i({},e,d)}function h(e){var d=e.loader;if(d!==m.default&&d!==y.default)a.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{var p=(0,m.fetchSupported)();p&&(e.loader=m.default,e.progressive=!0,e.enableSoftwareAES=!0,a.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>y});var F=x("./src/polyfills/number.ts"),A=x("./src/utils/ewma-bandwidth-estimator.ts"),b=x("./src/events.ts"),I=x("./src/errors.ts"),k=x("./src/types/loader.ts"),P=x("./src/utils/logger.ts");function L(m,l){for(var f=0;f<l.length;f++){var a=l[f];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(m,_(a.key),a)}}function S(m,l,f){return l&&L(m.prototype,l),f&&L(m,f),Object.defineProperty(m,"prototype",{writable:!1}),m}function _(m){var l=T(m,"string");return typeof l=="symbol"?l:String(l)}function T(m,l){if(typeof m!="object"||m===null)return m;var f=m[Symbol.toPrimitive];if(f!==void 0){var a=f.call(m,l||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(m)}var c=function(){function m(f){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=f;var a=f.config;this.bwEstimator=new A.default(a.abrEwmaSlowVoD,a.abrEwmaFastVoD,a.abrEwmaDefaultEstimate),this.registerListeners()}var l=m.prototype;return l.registerListeners=function(){var a=this.hls;a.on(b.Events.FRAG_LOADING,this.onFragLoading,this),a.on(b.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(b.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var a=this.hls;a.off(b.Events.FRAG_LOADING,this.onFragLoading,this),a.off(b.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(b.Events.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},l.onFragLoading=function(a,i){var g=i.frag;if(g.type===k.PlaylistLevelType.MAIN&&!this.timer){var s;this.fragCurrent=g,this.partCurrent=(s=i.part)!=null?s:null,this.timer=self.setInterval(this.onCheck,100)}},l.onLevelLoaded=function(a,i){var g=this.hls.config;i.details.live?this.bwEstimator.update(g.abrEwmaSlowLive,g.abrEwmaFastLive):this.bwEstimator.update(g.abrEwmaSlowVoD,g.abrEwmaFastVoD)},l._abandonRulesCheck=function(){var a=this.fragCurrent,i=this.partCurrent,g=this.hls,s=g.autoLevelEnabled,r=g.media;if(!(!a||!r)){var o=i?i.stats:a.stats,v=i?i.duration:a.duration;if(o.aborted||o.loaded&&o.loaded===o.total||a.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!s||r.paused||!r.playbackRate||!r.readyState)){var u=g.mainForwardBufferInfo;if(u!==null){var n=performance.now()-o.loading.start,t=Math.abs(r.playbackRate);if(!(n<=500*v/t)){var h=o.loaded&&o.loading.first,e=this.bwEstimator.getEstimate(),d=g.levels,p=g.minAutoLevel,E=d[a.level],D=o.total||Math.max(o.loaded,Math.round(v*E.maxBitrate/8)),R=h?o.loaded*1e3/n:0,O=R?(D-o.loaded)/R:D*8/e,C=u.len/t;if(!(O<=C)){var M=Number.POSITIVE_INFINITY,U;for(U=a.level-1;U>p;U--){var B=d[U].maxBitrate;if(M=R?v*B/(8*.8*R):v*B/e,M<C)break}M>=O||(P.logger.warn("Fragment "+a.sn+(i?" part "+i.index:"")+" of level "+a.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+U+`
      Current BW estimate: `+((0,F.isFiniteNumber)(e)?(e/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+O.toFixed(3)+` s
      Estimated load time for the next fragment: `+M.toFixed(3)+` s
      Time to underbuffer: `+C.toFixed(3)+" s"),g.nextLoadLevel=U,h&&this.bwEstimator.sample(n,o.loaded),this.clearTimer(),(a.loader||a.keyLoader)&&(this.fragCurrent=this.partCurrent=null,a.abortRequests()),g.trigger(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:a,part:i,stats:o}))}}}}}},l.onFragLoaded=function(a,i){var g=i.frag,s=i.part;if(g.type===k.PlaylistLevelType.MAIN&&(0,F.isFiniteNumber)(g.sn)){var r=s?s.stats:g.stats,o=s?s.duration:g.duration;if(this.clearTimer(),this.lastLoadedFragLevel=g.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var v=this.hls.levels[g.level],u=(v.loaded?v.loaded.bytes:0)+r.loaded,n=(v.loaded?v.loaded.duration:0)+o;v.loaded={bytes:u,duration:n},v.realBitrate=Math.round(8*u/n)}if(g.bitrateTest){var t={stats:r,frag:g,part:s,id:g.type};this.onFragBuffered(b.Events.FRAG_BUFFERED,t)}}},l.onFragBuffered=function(a,i){var g=i.frag,s=i.part,r=s?s.stats:g.stats;if(!r.aborted&&!(g.type!==k.PlaylistLevelType.MAIN||g.sn==="initSegment")){var o=r.parsing.end-r.loading.start;this.bwEstimator.sample(o,r.loaded),r.bwEstimate=this.bwEstimator.getEstimate(),g.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}},l.onError=function(a,i){var g;if(((g=i.frag)===null||g===void 0?void 0:g.type)===k.PlaylistLevelType.MAIN){if(i.type===I.ErrorTypes.KEY_SYSTEM_ERROR){this.clearTimer();return}switch(i.details){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:case I.ErrorDetails.KEY_LOAD_ERROR:case I.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer();break}}},l.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},l.getNextABRAutoLevel=function(){var a=this.fragCurrent,i=this.partCurrent,g=this.hls,s=g.maxAutoLevel,r=g.config,o=g.minAutoLevel,v=g.media,u=i?i.duration:a?a.duration:0,n=v&&v.playbackRate!==0?Math.abs(v.playbackRate):1,t=this.bwEstimator?this.bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,h=g.mainForwardBufferInfo,e=(h?h.len:0)/n,d=this.findBestLevel(t,o,s,e,r.abrBandWidthFactor,r.abrBandWidthUpFactor);if(d>=0)return d;P.logger.trace((e?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var p=u?Math.min(u,r.maxStarvationDelay):r.maxStarvationDelay,E=r.abrBandWidthFactor,D=r.abrBandWidthUpFactor;if(!e){var R=this.bitrateTestDelay;if(R){var O=u?Math.min(u,r.maxLoadingDelay):r.maxLoadingDelay;p=O-R,P.logger.trace("bitrate test took "+Math.round(1e3*R)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),E=D=1}}return d=this.findBestLevel(t,o,s,e+p,E,D),Math.max(d,0)},l.findBestLevel=function(a,i,g,s,r,o){for(var v,u=this.fragCurrent,n=this.partCurrent,t=this.lastLoadedFragLevel,h=this.hls.levels,e=h[t],d=!!(e!=null&&(v=e.details)!==null&&v!==void 0&&v.live),p=e==null?void 0:e.codecSet,E=n?n.duration:u?u.duration:0,D=g;D>=i;D--){var R=h[D];if(!(!R||p&&R.codecSet!==p)){var O=R.details,C=(n?O==null?void 0:O.partTarget:O==null?void 0:O.averagetargetduration)||E,M=void 0;D<=t?M=r*a:M=o*a;var U=h[D].maxBitrate,B=U*C/M;if(P.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+D+"/"+Math.round(M)+"/"+U+"/"+C+"/"+s+"/"+B),M>U&&(B===0||!(0,F.isFiniteNumber)(B)||d&&!this.bitrateTestDelay||B<s))return D}}return-1},S(m,[{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,i=this.bwEstimator;if(a!==-1&&!i.canEstimate())return a;var g=this.getNextABRAutoLevel();return a!==-1&&this.hls.levels[g].loadError?a:(a!==-1&&(g=Math.min(a,g)),g)},set:function(a){this._nextAutoLevel=a}}]),m}();const y=c},"./src/controller/audio-stream-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>r});var F=x("./src/polyfills/number.ts"),A=x("./src/controller/base-stream-controller.ts"),b=x("./src/events.ts"),I=x("./src/utils/buffer-helper.ts"),k=x("./src/controller/fragment-tracker.ts"),P=x("./src/types/level.ts"),L=x("./src/types/loader.ts"),S=x("./src/loader/fragment.ts"),_=x("./src/demux/chunk-cache.ts"),T=x("./src/demux/transmuxer-interface.ts"),c=x("./src/types/transmuxer.ts"),y=x("./src/controller/fragment-finders.ts"),m=x("./src/utils/discontinuities.ts"),l=x("./src/errors.ts");function f(){return f=Object.assign?Object.assign.bind():function(o){for(var v=1;v<arguments.length;v++){var u=arguments[v];for(var n in u)Object.prototype.hasOwnProperty.call(u,n)&&(o[n]=u[n])}return o},f.apply(this,arguments)}function a(o,v){o.prototype=Object.create(v.prototype),o.prototype.constructor=o,i(o,v)}function i(o,v){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},i(o,v)}var g=100,s=function(o){a(v,o);function v(n,t,h){var e;return e=o.call(this,n,t,h,"[audio-stream-controller]")||this,e.videoBuffer=null,e.videoTrackCC=-1,e.waitingVideoCC=-1,e.audioSwitch=!1,e.trackId=-1,e.waitingData=null,e.mainDetails=null,e.bufferFlushed=!1,e.cachedTrackLoadedData=null,e._registerListeners(),e}var u=v.prototype;return u.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},u._registerListeners=function(){var t=this.hls;t.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(b.Events.ERROR,this.onError,this),t.on(b.Events.BUFFER_RESET,this.onBufferReset,this),t.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u._unregisterListeners=function(){var t=this.hls;t.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(b.Events.ERROR,this.onError,this),t.off(b.Events.BUFFER_RESET,this.onBufferReset,this),t.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u.onInitPtsFound=function(t,h){var e=h.frag,d=h.id,p=h.initPTS;if(d==="main"){var E=e.cc;this.initPTS[e.cc]=p,this.log("InitPTS for cc: "+E+" found from main: "+p),this.videoTrackCC=E,this.state===A.State.WAITING_INIT_PTS&&this.tick()}},u.startLoad=function(t){if(!this.levels){this.startPosition=t,this.state=A.State.STOPPED;return}var h=this.lastCurrentTime;this.stopLoad(),this.setInterval(g),this.fragLoadError=0,h>0&&t===-1?(this.log("Override startPosition with lastCurrentTime @"+h.toFixed(3)),t=h,this.state=A.State.IDLE):(this.loadedmetadata=!1,this.state=A.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},u.doTick=function(){switch(this.state){case A.State.IDLE:this.doTickIdle();break;case A.State.WAITING_TRACK:{var t,h=this.levels,e=this.trackId,d=h==null||(t=h[e])===null||t===void 0?void 0:t.details;if(d){if(this.waitForCdnTuneIn(d))break;this.state=A.State.WAITING_INIT_PTS}break}case A.State.FRAG_LOADING_WAITING_RETRY:{var p,E=performance.now(),D=this.retryDate;(!D||E>=D||(p=this.media)!==null&&p!==void 0&&p.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=A.State.IDLE);break}case A.State.WAITING_INIT_PTS:{var R=this.waitingData;if(R){var O=R.frag,C=R.part,M=R.cache,U=R.complete;if(this.initPTS[O.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=A.State.FRAG_LOADING;var B=M.flush(),N={frag:O,part:C,payload:B,networkDetails:null};this._handleFragmentLoadProgress(N),U&&o.prototype._handleFragmentLoadComplete.call(this,N)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+O.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var K=this.getLoadPosition(),W=I.BufferHelper.bufferInfo(this.mediaBuffer,K,this.config.maxBufferHole),G=(0,y.fragmentWithinToleranceTest)(W.end,this.config.maxFragLookUpTolerance,O);G<0&&(this.log("Waiting fragment cc ("+O.cc+") @ "+O.start+" cancelled because another fragment at "+W.end+" is needed"),this.clearWaitingFragment())}}else this.state=A.State.IDLE}}this.onTickEnd()},u.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=A.State.IDLE)},u.resetLoadingState=function(){this.clearWaitingFragment(),o.prototype.resetLoadingState.call(this)},u.onTickEnd=function(){var t=this.media;!t||!t.readyState||(this.lastCurrentTime=t.currentTime)},u.doTickIdle=function(){var t=this.hls,h=this.levels,e=this.media,d=this.trackId,p=t.config;if(!(!h||!h[d])&&!(!e&&(this.startFragRequested||!p.startFragPrefetch))){var E=h[d],D=E.details;if(!D||D.live&&this.levelLastLoaded!==d||this.waitForCdnTuneIn(D)){this.state=A.State.WAITING_TRACK;return}var R=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&R&&(this.bufferFlushed=!1,this.afterBufferFlushed(R,S.ElementaryStreamTypes.AUDIO,L.PlaylistLevelType.AUDIO));var O=this.getFwdBufferInfo(R,L.PlaylistLevelType.AUDIO);if(O!==null){var C=this.audioSwitch;if(!C&&this._streamEnded(O,D)){t.trigger(b.Events.BUFFER_EOS,{type:"audio"}),this.state=A.State.ENDED;return}var M=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,L.PlaylistLevelType.MAIN),U=O.len,B=this.getMaxBufferLength(M==null?void 0:M.len);if(!(U>=B&&!C)){var N=D.fragments,K=N[0].start,W=O.end;if(C&&e){var G=this.getLoadPosition();W=G,D.PTSKnown&&G<K&&(O.end>K||O.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),e.currentTime=K+.05)}if(!(M&&W>M.end+D.targetduration)&&!((!M||!M.len)&&O.len)){var j=this.getNextFragment(W,D);if(!j){this.bufferFlushed=!0;return}this.loadFragment(j,D,W)}}}}},u.getMaxBufferLength=function(t){var h=o.prototype.getMaxBufferLength.call(this);return t?Math.max(h,t):h},u.onMediaDetaching=function(){this.videoBuffer=null,o.prototype.onMediaDetaching.call(this)},u.onAudioTracksUpdated=function(t,h){var e=h.audioTracks;this.resetTransmuxer(),this.levels=e.map(function(d){return new P.Level(d)})},u.onAudioTrackSwitching=function(t,h){var e=!!h.url;this.trackId=h.id;var d=this.fragCurrent;d&&d.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),e?this.setInterval(g):this.resetTransmuxer(),e?(this.audioSwitch=!0,this.state=A.State.IDLE):this.state=A.State.STOPPED,this.tick()},u.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},u.onLevelLoaded=function(t,h){this.mainDetails=h.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(b.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},u.onAudioTrackLoaded=function(t,h){var e;if(this.mainDetails==null){this.cachedTrackLoadedData=h;return}var d=this.levels,p=h.details,E=h.id;if(!d){this.warn("Audio tracks were reset while loading level "+E);return}this.log("Track "+E+" loaded ["+p.startSN+","+p.endSN+"],duration:"+p.totalduration);var D=d[E],R=0;if(p.live||(e=D.details)!==null&&e!==void 0&&e.live){var O=this.mainDetails;if(p.fragments[0]||(p.deltaUpdateFailed=!0),p.deltaUpdateFailed||!O)return;!D.details&&p.hasProgramDateTime&&O.hasProgramDateTime?((0,m.alignMediaPlaylistByPDT)(p,O),R=p.fragments[0].start):R=this.alignPlaylists(p,D.details)}D.details=p,this.levelLastLoaded=E,!this.startFragRequested&&(this.mainDetails||!p.live)&&this.setStartPosition(D.details,R),this.state===A.State.WAITING_TRACK&&!this.waitForCdnTuneIn(p)&&(this.state=A.State.IDLE),this.tick()},u._handleFragmentLoadProgress=function(t){var h,e=t.frag,d=t.part,p=t.payload,E=this.config,D=this.trackId,R=this.levels;if(!R){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered");return}var O=R[D];console.assert(O,"Audio track is defined on fragment load progress");var C=O.details;console.assert(C,"Audio track details are defined on fragment load progress");var M=E.defaultAudioCodec||O.audioCodec||"mp4a.40.2",U=this.transmuxer;U||(U=this.transmuxer=new T.default(this.hls,L.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var B=this.initPTS[e.cc],N=(h=e.initSegment)===null||h===void 0?void 0:h.data;if(B!==void 0){var K=!1,W=d?d.index:-1,G=W!==-1,j=new c.ChunkMetadata(e.level,e.sn,e.stats.chunkCount,p.byteLength,W,G);U.push(p,N,M,"",e,d,C.totalduration,K,j,B)}else{this.log("Unknown video PTS for cc "+e.cc+", waiting for video PTS before demuxing audio frag "+e.sn+" of ["+C.startSN+" ,"+C.endSN+"],track "+D);var H=this.waitingData=this.waitingData||{frag:e,part:d,cache:new _.default,complete:!1},Y=H.cache;Y.push(new Uint8Array(p)),this.waitingVideoCC=this.videoTrackCC,this.state=A.State.WAITING_INIT_PTS}},u._handleFragmentLoadComplete=function(t){if(this.waitingData){this.waitingData.complete=!0;return}o.prototype._handleFragmentLoadComplete.call(this,t)},u.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},u.onBufferCreated=function(t,h){var e=h.tracks.audio;e&&(this.mediaBuffer=e.buffer||null),h.tracks.video&&(this.videoBuffer=h.tracks.video.buffer||null)},u.onFragBuffered=function(t,h){var e=h.frag,d=h.part;if(e.type!==L.PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&e.type===L.PlaylistLevelType.MAIN){var p;(p=this.videoBuffer||this.media)!==null&&p!==void 0&&p.buffered.length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(e)){this.warn("Fragment "+e.sn+(d?" p: "+d.index:"")+" of level "+e.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}e.sn!=="initSegment"&&(this.fragPrevious=e,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(e,d)},u.onError=function(t,h){if(h.type===l.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(L.PlaylistLevelType.AUDIO,h);return}switch(h.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:case l.ErrorDetails.FRAG_PARSING_ERROR:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(L.PlaylistLevelType.AUDIO,h);break;case l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case l.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==A.State.ERROR&&this.state!==A.State.STOPPED&&(this.state=h.fatal?A.State.ERROR:A.State.IDLE,this.warn(h.details+" while loading frag, switching to "+this.state+" state"));break;case l.ErrorDetails.BUFFER_FULL_ERROR:if(h.parent==="audio"&&(this.state===A.State.PARSING||this.state===A.State.PARSED)){var e=!0,d=this.getFwdBufferInfo(this.mediaBuffer,L.PlaylistLevelType.AUDIO);d&&d.len>.5&&(e=!this.reduceMaxBufferLength(d.len)),e&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},u.onBufferFlushed=function(t,h){var e=h.type;e===S.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===A.State.ENDED&&(this.state=A.State.IDLE))},u._handleTransmuxComplete=function(t){var h,e="audio",d=this.hls,p=t.remuxResult,E=t.chunkMeta,D=this.getCurrentContext(E);if(!D){this.warn("The loading context changed while buffering fragment "+E.sn+" of level "+E.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(E.level);return}var R=D.frag,O=D.part,C=D.level.details,M=p.audio,U=p.text,B=p.id3,N=p.initSegment;if(!(this.fragContextChanged(R)||!C)){if(this.state=A.State.PARSING,this.audioSwitch&&M&&this.completeAudioSwitch(),N!=null&&N.tracks&&(this._bufferInitSegment(N.tracks,R,E),d.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:R,id:e,tracks:N.tracks})),M){var K=M.startPTS,W=M.endPTS,G=M.startDTS,j=M.endDTS;O&&(O.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:K,endPTS:W,startDTS:G,endDTS:j}),R.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,K,W,G,j),this.bufferFragmentData(M,R,O,E)}if(B!=null&&(h=B.samples)!==null&&h!==void 0&&h.length){var H=f({id:e,frag:R,details:C},B);d.trigger(b.Events.FRAG_PARSING_METADATA,H)}if(U){var Y=f({id:e,frag:R,details:C},U);d.trigger(b.Events.FRAG_PARSING_USERDATA,Y)}}},u._bufferInitSegment=function(t,h,e){if(this.state===A.State.PARSING){t.video&&delete t.video;var d=t.audio;if(d){d.levelCodec=d.codec,d.id="audio",this.log("Init audio buffer, container:"+d.container+", codecs[parsed]=["+d.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,t);var p=d.initSegment;if(p!=null&&p.byteLength){var E={type:"audio",frag:h,part:null,chunkMeta:e,parent:h.type,data:p};this.hls.trigger(b.Events.BUFFER_APPENDING,E)}this.tick()}}},u.loadFragment=function(t,h,e){var d=this.fragmentTracker.getState(t);this.fragCurrent=t,(this.audioSwitch||d===k.FragmentState.NOT_LOADED||d===k.FragmentState.PARTIAL)&&(t.sn==="initSegment"?this._loadInitSegment(t,h):h.live&&!(0,F.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=A.State.WAITING_INIT_PTS):(this.startFragRequested=!0,o.prototype.loadFragment.call(this,t,h,e)))},u.completeAudioSwitch=function(){var t=this.hls,h=this.media,e=this.trackId;h&&(this.log("Switching audio track : flushing all audio"),o.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:e})},v}(A.default);const r=s},"./src/controller/audio-track-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>y});var F=x("./src/events.ts"),A=x("./src/errors.ts"),b=x("./src/controller/base-playlist-controller.ts"),I=x("./src/types/loader.ts");function k(m,l){for(var f=0;f<l.length;f++){var a=l[f];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(m,L(a.key),a)}}function P(m,l,f){return l&&k(m.prototype,l),f&&k(m,f),Object.defineProperty(m,"prototype",{writable:!1}),m}function L(m){var l=S(m,"string");return typeof l=="symbol"?l:String(l)}function S(m,l){if(typeof m!="object"||m===null)return m;var f=m[Symbol.toPrimitive];if(f!==void 0){var a=f.call(m,l||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(m)}function _(m,l){m.prototype=Object.create(l.prototype),m.prototype.constructor=m,T(m,l)}function T(m,l){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,i){return a.__proto__=i,a},T(m,l)}var c=function(m){_(l,m);function l(a){var i;return i=m.call(this,a,"[audio-track-controller]")||this,i.tracks=[],i.groupId=null,i.tracksInGroup=[],i.trackId=-1,i.trackName="",i.selectDefaultTrack=!0,i.registerListeners(),i}var f=l.prototype;return f.registerListeners=function(){var i=this.hls;i.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(F.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(F.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(F.Events.ERROR,this.onError,this)},f.unregisterListeners=function(){var i=this.hls;i.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(F.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(F.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(F.Events.ERROR,this.onError,this)},f.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,m.prototype.destroy.call(this)},f.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},f.onManifestParsed=function(i,g){this.tracks=g.audioTracks||[]},f.onAudioTrackLoaded=function(i,g){var s=g.id,r=g.details,o=this.tracksInGroup[s];if(!o){this.warn("Invalid audio track id "+s);return}var v=o.details;o.details=g.details,this.log("audioTrack "+s+" loaded ["+r.startSN+"-"+r.endSN+"]"),s===this.trackId&&(this.retryCount=0,this.playlistLoaded(s,g,v))},f.onLevelLoading=function(i,g){this.switchLevel(g.level)},f.onLevelSwitching=function(i,g){this.switchLevel(g.level)},f.switchLevel=function(i){var g=this.hls.levels[i];if(g!=null&&g.audioGroupIds){var s=g.audioGroupIds[g.urlId];if(this.groupId!==s){this.groupId=s;var r=this.tracks.filter(function(v){return!s||v.groupId===s});this.selectDefaultTrack&&!r.some(function(v){return v.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=r;var o={audioTracks:r};this.log("Updating audio tracks, "+r.length+' track(s) found in "'+s+'" group-id'),this.hls.trigger(F.Events.AUDIO_TRACKS_UPDATED,o),this.selectInitialTrack()}}},f.onError=function(i,g){m.prototype.onError.call(this,i,g),!(g.fatal||!g.context)&&g.context.type===I.PlaylistContextType.AUDIO_TRACK&&g.context.id===this.trackId&&g.context.groupId===this.groupId&&this.retryLoadingOrFail(g)},f.setAudioTrack=function(i){var g=this.tracksInGroup;if(i<0||i>=g.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var s=g[this.trackId];this.log("Now switching to audio-track index "+i);var r=g[i],o=r.id,v=r.groupId,u=v===void 0?"":v,n=r.name,t=r.type,h=r.url;if(this.trackId=i,this.trackName=n,this.selectDefaultTrack=!1,this.hls.trigger(F.Events.AUDIO_TRACK_SWITCHING,{id:o,groupId:u,name:n,type:t,url:h}),!(r.details&&!r.details.live)){var e=this.switchParams(r.url,s==null?void 0:s.details);this.loadPlaylist(e)}},f.selectInitialTrack=function(){var i=this.tracksInGroup;console.assert(i.length,"Initial audio track should be selected when tracks are known");var g=this.trackName,s=this.findTrackId(g)||this.findTrackId();s!==-1?this.setAudioTrack(s):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},f.findTrackId=function(i){for(var g=this.tracksInGroup,s=0;s<g.length;s++){var r=g[s];if((!this.selectDefaultTrack||r.default)&&(!i||i===r.name))return r.id}return-1},f.loadPlaylist=function(i){m.prototype.loadPlaylist.call(this);var g=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(g)){var s=g.id,r=g.groupId,o=g.url;if(i)try{o=i.addDirectives(o)}catch(v){this.warn("Could not construct new URL with HLS Delivery Directives: "+v)}this.log("loading audio-track playlist for id: "+s),this.clearTimer(),this.hls.trigger(F.Events.AUDIO_TRACK_LOADING,{url:o,id:s,groupId:r,deliveryDirectives:i||null})}},P(l,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}}]),l}(b.default);const y=c},"./src/controller/base-playlist-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>k});var F=x("./src/types/level.ts"),A=x("./src/controller/level-helper.ts"),b=x("./src/utils/logger.ts"),I=x("./src/errors.ts"),k=function(){function P(S,_){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=b.logger.log.bind(b.logger,_+":"),this.warn=b.logger.warn.bind(b.logger,_+":"),this.hls=S}var L=P.prototype;return L.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},L.onError=function(_,T){T.fatal&&(T.type===I.ErrorTypes.NETWORK_ERROR||T.type===I.ErrorTypes.KEY_SYSTEM_ERROR)&&this.stopLoad()},L.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},L.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},L.stopLoad=function(){this.canLoad=!1,this.clearTimer()},L.switchParams=function(_,T){var c=T==null?void 0:T.renditionReports;if(c)for(var y=0;y<c.length;y++){var m=c[y],l=void 0;try{l=new self.URL(m.URI,T.url).href}catch(g){b.logger.warn("Could not construct new URL for Rendition Report: "+g),l=m.URI||""}if(l===_.slice(-l.length)){var f=parseInt(m["LAST-MSN"])||(T==null?void 0:T.lastPartSn),a=parseInt(m["LAST-PART"])||(T==null?void 0:T.lastPartIndex);if(this.hls.config.lowLatencyMode){var i=Math.min(T.age-T.partTarget,T.targetduration);a>=0&&i>T.partTarget&&(a+=1)}return new F.HlsUrlParameters(f,a>=0?a:void 0,F.HlsSkip.No)}}},L.loadPlaylist=function(_){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},L.shouldLoadTrack=function(_){return this.canLoad&&_&&!!_.url&&(!_.details||_.details.live)},L.playlistLoaded=function(_,T,c){var y=this,m=T.details,l=T.stats,f=self.performance.now(),a=l.loading.first?Math.max(0,f-l.loading.first):0;if(m.advancedDateTime=Date.now()-a,m.live||c!=null&&c.live){if(m.reloaded(c),c&&this.log("live playlist "+_+" "+(m.advanced?"REFRESHED "+m.lastPartSn+"-"+m.lastPartIndex:"MISSED")),c&&m.fragments.length>0&&(0,A.mergeDetails)(c,m),!this.canLoad||!m.live)return;var i,g=void 0,s=void 0;if(m.canBlockReload&&m.endSN&&m.advanced){var r=this.hls.config.lowLatencyMode,o=m.lastPartSn,v=m.endSN,u=m.lastPartIndex,n=u!==-1,t=o===v,h=r?0:u;n?(g=t?v+1:o,s=t?h:u+1):g=v+1;var e=m.age,d=e+m.ageHeader,p=Math.min(d-m.partTarget,m.targetduration*1.5);if(p>0){if(c&&p>c.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+c.tuneInGoal+" to: "+p+" with playlist age: "+m.age),p=0;else{var E=Math.floor(p/m.targetduration);if(g+=E,s!==void 0){var D=Math.round(p%m.targetduration/m.partTarget);s+=D}this.log("CDN Tune-in age: "+m.ageHeader+"s last advanced "+e.toFixed(2)+"s goal: "+p+" skip sn "+E+" to part "+s)}m.tuneInGoal=p}if(i=this.getDeliveryDirectives(m,T.deliveryDirectives,g,s),r||!t){this.loadPlaylist(i);return}}else i=this.getDeliveryDirectives(m,T.deliveryDirectives,g,s);var R=this.hls.mainForwardBufferInfo,O=R?R.end-R.len:0,C=(m.edge-O)*1e3,M=(0,A.computeReloadInterval)(m,C);m.updated?f>this.requestScheduled+M&&(this.requestScheduled=l.loading.start):this.requestScheduled=-1,g!==void 0&&m.canBlockReload?this.requestScheduled=l.loading.first+M-(m.partTarget*1e3||1e3):this.requestScheduled=(this.requestScheduled===-1?f:this.requestScheduled)+M;var U=this.requestScheduled-f;U=Math.max(0,U),this.log("reload live playlist "+_+" in "+Math.round(U)+" ms"),this.timer=self.setTimeout(function(){return y.loadPlaylist(i)},U)}else this.clearTimer()},L.getDeliveryDirectives=function(_,T,c,y){var m=(0,F.getSkipValue)(_,c);return T!=null&&T.skip&&_.deltaUpdateFailed&&(c=T.msn,y=T.part,m=F.HlsSkip.No),new F.HlsUrlParameters(c,y,m)},L.retryLoadingOrFail=function(_){var T=this,c=this.hls.config,y=this.retryCount<c.levelLoadingMaxRetry;if(y){var m;if(this.requestScheduled=-1,this.retryCount++,_.details.indexOf("LoadTimeOut")>-1&&(m=_.context)!==null&&m!==void 0&&m.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+_.details+'"'),this.loadPlaylist();else{var l=Math.min(Math.pow(2,this.retryCount)*c.levelLoadingRetryDelay,c.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return T.loadPlaylist()},l),this.warn("retry playlist loading #"+this.retryCount+" in "+l+' ms after "'+_.details+'"')}}else this.warn('cannot recover from error "'+_.details+'"'),this.clearTimer(),_.fatal=!0;return y},P}()},"./src/controller/base-stream-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{State:()=>n,default:()=>t});var F=x("./src/polyfills/number.ts"),A=x("./src/task-loop.ts"),b=x("./src/controller/fragment-tracker.ts"),I=x("./src/utils/buffer-helper.ts"),k=x("./src/utils/logger.ts"),P=x("./src/events.ts"),L=x("./src/errors.ts"),S=x("./src/types/transmuxer.ts"),_=x("./src/utils/mp4-tools.ts"),T=x("./src/utils/discontinuities.ts"),c=x("./src/controller/fragment-finders.ts"),y=x("./src/controller/level-helper.ts"),m=x("./src/loader/fragment-loader.ts"),l=x("./src/crypt/decrypter.ts"),f=x("./src/utils/time-ranges.ts"),a=x("./src/types/loader.ts");function i(h,e){for(var d=0;d<e.length;d++){var p=e[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(h,s(p.key),p)}}function g(h,e,d){return e&&i(h.prototype,e),d&&i(h,d),Object.defineProperty(h,"prototype",{writable:!1}),h}function s(h){var e=r(h,"string");return typeof e=="symbol"?e:String(e)}function r(h,e){if(typeof h!="object"||h===null)return h;var d=h[Symbol.toPrimitive];if(d!==void 0){var p=d.call(h,e||"default");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(h)}function o(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function v(h,e){h.prototype=Object.create(e.prototype),h.prototype.constructor=h,u(h,e)}function u(h,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,E){return p.__proto__=E,p},u(h,e)}var n={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},t=function(h){v(e,h);function e(p,E,D,R){var O;return O=h.call(this)||this,O.hls=void 0,O.fragPrevious=null,O.fragCurrent=null,O.fragmentTracker=void 0,O.transmuxer=null,O._state=n.STOPPED,O.media=null,O.mediaBuffer=null,O.config=void 0,O.bitrateTest=!1,O.lastCurrentTime=0,O.nextLoadPosition=0,O.startPosition=0,O.loadedmetadata=!1,O.fragLoadError=0,O.retryDate=0,O.levels=null,O.fragmentLoader=void 0,O.keyLoader=void 0,O.levelLastLoaded=null,O.startFragRequested=!1,O.decrypter=void 0,O.initPTS=[],O.onvseeking=null,O.onvended=null,O.logPrefix="",O.log=void 0,O.warn=void 0,O.logPrefix=R,O.log=k.logger.log.bind(k.logger,R+":"),O.warn=k.logger.warn.bind(k.logger,R+":"),O.hls=p,O.fragmentLoader=new m.default(p.config),O.keyLoader=D,O.fragmentTracker=E,O.config=p.config,O.decrypter=new l.default(p.config),p.on(P.Events.LEVEL_SWITCHING,O.onLevelSwitching,o(O)),O}var d=e.prototype;return d.doTick=function(){this.onTickEnd()},d.onTickEnd=function(){},d.startLoad=function(E){},d.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var E=this.fragCurrent;E&&(E.abortRequests(),this.fragmentTracker.removeFragment(E)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=n.STOPPED},d._streamEnded=function(E,D){if(D.live||E.nextStart||!E.end||!this.media)return!1;var R=D.partList;if(R!=null&&R.length){var O=R[R.length-1],C=I.BufferHelper.isBuffered(this.media,O.start+O.duration/2);return C}var M=D.fragments[D.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(M)},d.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var E;return(E=this.levels[this.levelLastLoaded])===null||E===void 0?void 0:E.details}},d.onMediaAttached=function(E,D){var R=this.media=this.mediaBuffer=D.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),R.addEventListener("seeking",this.onvseeking),R.addEventListener("ended",this.onvended);var O=this.config;this.levels&&O.autoStartLoad&&this.state===n.STOPPED&&this.startLoad(O.startPosition)},d.onMediaDetaching=function(){var E=this.media;E!=null&&E.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),E&&this.onvseeking&&this.onvended&&(E.removeEventListener("seeking",this.onvseeking),E.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},d.onMediaSeeking=function(){var E=this.config,D=this.fragCurrent,R=this.media,O=this.mediaBuffer,C=this.state,M=R?R.currentTime:0,U=I.BufferHelper.bufferInfo(O||R,M,E.maxBufferHole);if(this.log("media seeking to "+((0,F.isFiniteNumber)(M)?M.toFixed(3):M)+", state: "+C),this.state===n.ENDED)this.resetLoadingState();else if(D){var B=E.maxFragLookUpTolerance,N=D.start-B,K=D.start+D.duration+B;if(!U.len||K<U.start||N>U.end){var W=M>K;(M<N||W)&&(W&&D.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),D.abortRequests()),this.resetLoadingState())}}R&&(this.lastCurrentTime=M),!this.loadedmetadata&&!U.len&&(this.nextLoadPosition=this.startPosition=M),this.tickImmediate()},d.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},d.onLevelSwitching=function(E,D){this.fragLoadError=0},d.onHandlerDestroying=function(){this.stopLoad(),h.prototype.onHandlerDestroying.call(this)},d.onHandlerDestroyed=function(){this.state=n.STOPPED,this.hls.off(P.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,h.prototype.onHandlerDestroyed.call(this)},d.loadFragment=function(E,D,R){this._loadFragForPlayback(E,D,R)},d._loadFragForPlayback=function(E,D,R){var O=this,C=function(U){if(O.fragContextChanged(E)){O.warn("Fragment "+E.sn+(U.part?" p: "+U.part.index:"")+" of level "+E.level+" was dropped during download."),O.fragmentTracker.removeFragment(E);return}E.stats.chunkCount++,O._handleFragmentLoadProgress(U)};this._doFragLoad(E,D,R,C).then(function(M){if(M){O.fragLoadError=0;var U=O.state;if(O.fragContextChanged(E)){(U===n.FRAG_LOADING||!O.fragCurrent&&U===n.PARSING)&&(O.fragmentTracker.removeFragment(E),O.state=n.IDLE);return}"payload"in M&&(O.log("Loaded fragment "+E.sn+" of level "+E.level),O.hls.trigger(P.Events.FRAG_LOADED,M)),O._handleFragmentLoadComplete(M)}}).catch(function(M){O.state===n.STOPPED||O.state===n.ERROR||(O.warn(M),O.resetFragmentLoading(E))})},d.flushMainBuffer=function(E,D,R){if(R===void 0&&(R=null),!!(E-D)){var O={startOffset:E,endOffset:D,type:R};this.fragLoadError=0,this.hls.trigger(P.Events.BUFFER_FLUSHING,O)}},d._loadInitSegment=function(E,D){var R=this;this._doFragLoad(E,D).then(function(O){if(!O||R.fragContextChanged(E)||!R.levels)throw new Error("init load aborted");return O}).then(function(O){var C=R.hls,M=O.payload,U=E.decryptdata;if(M&&M.byteLength>0&&U&&U.key&&U.iv&&U.method==="AES-128"){var B=self.performance.now();return R.decrypter.decrypt(new Uint8Array(M),U.key.buffer,U.iv.buffer).then(function(N){var K=self.performance.now();return C.trigger(P.Events.FRAG_DECRYPTED,{frag:E,payload:N,stats:{tstart:B,tdecrypt:K}}),O.payload=N,O})}return O}).then(function(O){var C=R.fragCurrent,M=R.hls,U=R.levels;if(!U)throw new Error("init load aborted, missing levels");var B=U[E.level].details;console.assert(B,"Level details are defined when init segment is loaded");var N=E.stats;R.state=n.IDLE,R.fragLoadError=0,E.data=new Uint8Array(O.payload),N.parsing.start=N.buffering.start=self.performance.now(),N.parsing.end=N.buffering.end=self.performance.now(),O.frag===C&&M.trigger(P.Events.FRAG_BUFFERED,{stats:N,frag:C,part:null,id:E.type}),R.tick()}).catch(function(O){R.state===n.STOPPED||R.state===n.ERROR||(R.warn(O),R.resetFragmentLoading(E))})},d.fragContextChanged=function(E){var D=this.fragCurrent;return!E||!D||E.level!==D.level||E.sn!==D.sn||E.urlId!==D.urlId},d.fragBufferedComplete=function(E,D){var R,O,C=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+E.type+" sn: "+E.sn+(D?" part: "+D.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+E.level+" "+(C?f.default.toString(I.BufferHelper.getBuffered(C)):"(detached)")),this.state=n.IDLE,C&&(!this.loadedmetadata&&E.type==a.PlaylistLevelType.MAIN&&C.buffered.length&&((R=this.fragCurrent)===null||R===void 0?void 0:R.sn)===((O=this.fragPrevious)===null||O===void 0?void 0:O.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},d.seekToStartPos=function(){},d._handleFragmentLoadComplete=function(E){var D=this.transmuxer;if(D){var R=E.frag,O=E.part,C=E.partsLoaded,M=!C||C.length===0||C.some(function(B){return!B}),U=new S.ChunkMetadata(R.level,R.sn,R.stats.chunkCount+1,0,O?O.index:-1,!M);D.flush(U)}},d._handleFragmentLoadProgress=function(E){},d._doFragLoad=function(E,D,R,O){var C,M=this;if(R===void 0&&(R=null),!this.levels)throw new Error("frag load aborted, missing levels");var U=null;if(E.encrypted&&!((C=E.decryptdata)!==null&&C!==void 0&&C.key)?(this.log("Loading key for "+E.sn+" of ["+D.startSN+"-"+D.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+E.level),this.state=n.KEY_LOADING,this.fragCurrent=E,U=this.keyLoader.load(E).then(function(G){if(!M.fragContextChanged(G.frag))return M.hls.trigger(P.Events.KEY_LOADED,G),G}),this.hls.trigger(P.Events.KEY_LOADING,{frag:E}),this.throwIfFragContextChanged("KEY_LOADING")):!E.encrypted&&D.encryptedFragments.length&&this.keyLoader.loadClear(E,D.encryptedFragments),R=Math.max(E.start,R||0),this.config.lowLatencyMode&&D){var B=D.partList;if(B&&O){R>E.end&&D.fragmentHint&&(E=D.fragmentHint);var N=this.getNextPart(B,E,R);if(N>-1){var K=B[N];return this.log("Loading part sn: "+E.sn+" p: "+K.index+" cc: "+E.cc+" of playlist ["+D.startSN+"-"+D.endSN+"] parts [0-"+N+"-"+(B.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+E.level+", target: "+parseFloat(R.toFixed(3))),this.nextLoadPosition=K.start+K.duration,this.state=n.FRAG_LOADING,this.hls.trigger(P.Events.FRAG_LOADING,{frag:E,part:B[N],targetBufferTime:R}),this.throwIfFragContextChanged("FRAG_LOADING parts"),U?U.then(function(G){return!G||M.fragContextChanged(G.frag)?null:M.doFragPartsLoad(E,B,N,O)}).catch(function(G){return M.handleFragLoadError(G)}):this.doFragPartsLoad(E,B,N,O).catch(function(G){return M.handleFragLoadError(G)})}else if(!E.url||this.loadedEndOfParts(B,R))return Promise.resolve(null)}}this.log("Loading fragment "+E.sn+" cc: "+E.cc+" "+(D?"of ["+D.startSN+"-"+D.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+E.level+", target: "+parseFloat(R.toFixed(3))),(0,F.isFiniteNumber)(E.sn)&&!this.bitrateTest&&(this.nextLoadPosition=E.start+E.duration),this.state=n.FRAG_LOADING,this.hls.trigger(P.Events.FRAG_LOADING,{frag:E,targetBufferTime:R}),this.throwIfFragContextChanged("FRAG_LOADING");var W=this.config.progressive;return W&&U?U.then(function(G){return!G||M.fragContextChanged(G==null?void 0:G.frag)?null:M.fragmentLoader.load(E,O)}).catch(function(G){return M.handleFragLoadError(G)}):Promise.all([this.fragmentLoader.load(E,W?O:void 0),U]).then(function(G){var j=G[0];return!W&&j&&O&&O(j),j}).catch(function(G){return M.handleFragLoadError(G)})},d.throwIfFragContextChanged=function(E){if(this.fragCurrent===null)throw new Error("frag load aborted, context changed in "+E)},d.doFragPartsLoad=function(E,D,R,O){var C=this;return new Promise(function(M,U){var B=[],N=function K(W){var G=D[W];C.fragmentLoader.loadPart(E,G,O).then(function(j){B[G.index]=j;var H=j.part;C.hls.trigger(P.Events.FRAG_LOADED,j);var Y=D[W+1];if(Y&&Y.fragment===E)K(W+1);else return M({frag:E,part:H,partsLoaded:B})}).catch(U)};N(R)})},d.handleFragLoadError=function(E){if("data"in E){var D=E.data;E.data&&D.details===L.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(D.frag,D.part):this.hls.trigger(P.Events.ERROR,D)}else this.hls.trigger(P.Events.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.INTERNAL_EXCEPTION,err:E,fatal:!0});return null},d._handleTransmuxerFlush=function(E){var D=this.getCurrentContext(E);if(!D||this.state!==n.PARSING){!this.fragCurrent&&this.state!==n.STOPPED&&this.state!==n.ERROR&&(this.state=n.IDLE);return}var R=D.frag,O=D.part,C=D.level,M=self.performance.now();R.stats.parsing.end=M,O&&(O.stats.parsing.end=M),this.updateLevelTiming(R,O,C,E.partial)},d.getCurrentContext=function(E){var D=this.levels,R=E.level,O=E.sn,C=E.part;if(!D||!D[R])return this.warn("Levels object was unset while buffering fragment "+O+" of level "+R+". The current chunk will not be buffered."),null;var M=D[R],U=C>-1?(0,y.getPartWith)(M,O,C):null,B=U?U.fragment:(0,y.getFragmentWithSN)(M,O,this.fragCurrent);return B?{frag:B,part:U,level:M}:null},d.bufferFragmentData=function(E,D,R,O){if(!(!E||this.state!==n.PARSING)){var C=E.data1,M=E.data2,U=C;if(C&&M&&(U=(0,_.appendUint8Array)(C,M)),!(!U||!U.length)){var B={type:E.type,frag:D,part:R,chunkMeta:O,parent:D.type,data:U};this.hls.trigger(P.Events.BUFFER_APPENDING,B),E.dropped&&E.independent&&!R&&this.flushBufferGap(D)}}},d.flushBufferGap=function(E){var D=this.media;if(D){if(!I.BufferHelper.isBuffered(D,D.currentTime)){this.flushMainBuffer(0,E.start);return}var R=D.currentTime,O=I.BufferHelper.bufferInfo(D,R,0),C=E.duration,M=Math.min(this.config.maxFragLookUpTolerance*2,C*.25),U=Math.max(Math.min(E.start-M,O.end-M),R+M);E.start-U>M&&this.flushMainBuffer(U,E.start)}},d.getFwdBufferInfo=function(E,D){var R=this.config,O=this.getLoadPosition();if(!(0,F.isFiniteNumber)(O))return null;var C=I.BufferHelper.bufferInfo(E,O,R.maxBufferHole);if(C.len===0&&C.nextStart!==void 0){var M=this.fragmentTracker.getBufferedFrag(O,D);if(M&&C.nextStart<M.end)return I.BufferHelper.bufferInfo(E,O,Math.max(C.nextStart,R.maxBufferHole))}return C},d.getMaxBufferLength=function(E){var D=this.config,R;return E?R=Math.max(8*D.maxBufferSize/E,D.maxBufferLength):R=D.maxBufferLength,Math.min(R,D.maxMaxBufferLength)},d.reduceMaxBufferLength=function(E){var D=this.config,R=E||D.maxBufferLength;return D.maxMaxBufferLength>=R?(D.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+D.maxMaxBufferLength+"s"),!0):!1},d.getNextFragment=function(E,D){var R=D.fragments,O=R.length;if(!O)return null;var C=this.config,M=R[0].start,U;if(D.live){var B=C.initialLiveManifestSize;if(O<B)return this.warn("Not enough fragments to start playback (have: "+O+", need: "+B+")"),null;!D.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(U=this.getInitialLiveFragment(D,R),this.startPosition=U?this.hls.liveSyncPosition||U.start:E)}else E<=M&&(U=R[0]);if(!U){var N=C.lowLatencyMode?D.partEnd:D.fragmentEnd;U=this.getFragmentAtPosition(E,N,D)}return this.mapToInitFragWhenRequired(U)},d.mapToInitFragWhenRequired=function(E){return E!=null&&E.initSegment&&!(E!=null&&E.initSegment.data)&&!this.bitrateTest?E.initSegment:E},d.getNextPart=function(E,D,R){for(var O=-1,C=!1,M=!0,U=0,B=E.length;U<B;U++){var N=E[U];if(M=M&&!N.independent,O>-1&&R<N.start)break;var K=N.loaded;K?O=-1:(C||N.independent||M)&&N.fragment===D&&(O=U),C=K}return O},d.loadedEndOfParts=function(E,D){var R=E[E.length-1];return R&&D>R.start&&R.loaded},d.getInitialLiveFragment=function(E,D){var R=this.fragPrevious,O=null;if(R){if(E.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+R.programDateTime),O=(0,c.findFragmentByPDT)(D,R.endProgramDateTime,this.config.maxFragLookUpTolerance)),!O){var C=R.sn+1;if(C>=E.startSN&&C<=E.endSN){var M=D[C-E.startSN];R.cc===M.cc&&(O=M,this.log("Live playlist, switching playlist, load frag with next SN: "+O.sn))}O||(O=(0,c.findFragWithCC)(D,R.cc),O&&this.log("Live playlist, switching playlist, load frag with same CC: "+O.sn))}}else{var U=this.hls.liveSyncPosition;U!==null&&(O=this.getFragmentAtPosition(U,this.bitrateTest?E.fragmentEnd:E.edge,E))}return O},d.getFragmentAtPosition=function(E,D,R){var O=this.config,C=this.fragPrevious,M=R.fragments,U=R.endSN,B=R.fragmentHint,N=O.maxFragLookUpTolerance,K=!!(O.lowLatencyMode&&R.partList&&B);K&&B&&!this.bitrateTest&&(M=M.concat(B),U=B.sn);var W;if(E<D){var G=E>D-N?0:N;W=(0,c.findFragmentByPTS)(C,M,E,G)}else W=M[M.length-1];if(W){var j=W.sn-R.startSN;if(this.fragmentTracker.getState(W)===b.FragmentState.OK&&(C=W),C&&W.sn===C.sn&&!K){var H=C&&W.level===C.level;if(H){var Y=M[j+1];W.sn<U&&this.fragmentTracker.getState(Y)!==b.FragmentState.OK?(this.log("SN "+W.sn+" just loaded, load next one: "+Y.sn),W=Y):W=null}}}return W},d.synchronizeToLiveEdge=function(E){var D=this.config,R=this.media;if(R){var O=this.hls.liveSyncPosition,C=R.currentTime,M=E.fragments[0].start,U=E.edge,B=C>=M-D.maxFragLookUpTolerance&&C<=U;if(O!==null&&R.duration>O&&(C<O||!B)){var N=D.liveMaxLatencyDuration!==void 0?D.liveMaxLatencyDuration:D.liveMaxLatencyDurationCount*E.targetduration;(!B&&R.readyState<4||C<U-N)&&(this.loadedmetadata||(this.nextLoadPosition=O),R.readyState&&(this.warn("Playback: "+C.toFixed(3)+" is located too far from the end of live sliding playlist: "+U+", reset currentTime to : "+O.toFixed(3)),R.currentTime=O))}}},d.alignPlaylists=function(E,D){var R=this.levels,O=this.levelLastLoaded,C=this.fragPrevious,M=O!==null?R[O]:null,U=E.fragments.length;if(!U)return this.warn("No fragments in live playlist"),0;var B=E.fragments[0].start,N=!D,K=E.alignedSliding&&(0,F.isFiniteNumber)(B);if(N||!K&&!B){(0,T.alignStream)(C,M,E);var W=E.fragments[0].start;return this.log("Live playlist sliding: "+W.toFixed(2)+" start-sn: "+(D?D.startSN:"na")+"->"+E.startSN+" prev-sn: "+(C?C.sn:"na")+" fragments: "+U),W}return B},d.waitForCdnTuneIn=function(E){var D=3;return E.live&&E.canBlockReload&&E.partTarget&&E.tuneInGoal>Math.max(E.partHoldBack,E.partTarget*D)},d.setStartPosition=function(E,D){var R=this.startPosition;if(R<D&&(R=-1),R===-1||this.lastCurrentTime===-1){var O=E.startTimeOffset;(0,F.isFiniteNumber)(O)?(R=D+O,O<0&&(R+=E.totalduration),R=Math.min(Math.max(D,R),D+E.totalduration),this.log("Start time offset "+O+" found in playlist, adjust startPosition to "+R),this.startPosition=R):E.live?R=this.hls.liveSyncPosition||D:this.startPosition=R=0,this.lastCurrentTime=R}this.nextLoadPosition=R},d.getLoadPosition=function(){var E=this.media,D=0;return this.loadedmetadata&&E?D=E.currentTime:this.nextLoadPosition&&(D=this.nextLoadPosition),D},d.handleFragLoadAborted=function(E,D){this.transmuxer&&E.sn!=="initSegment"&&E.stats.aborted&&(this.warn("Fragment "+E.sn+(D?" part"+D.index:"")+" of level "+E.level+" was aborted"),this.resetFragmentLoading(E))},d.resetFragmentLoading=function(E){(!this.fragCurrent||!this.fragContextChanged(E)&&this.state!==n.FRAG_LOADING_WAITING_RETRY)&&(this.state=n.IDLE)},d.onFragmentOrKeyLoadError=function(E,D){if(D.fatal){this.stopLoad(),this.state=n.ERROR;return}var R=this.config;if(D.chunkMeta){var O=this.getCurrentContext(D.chunkMeta);O&&(D.frag=O.frag,D.levelRetry=!0,this.fragLoadError=R.fragLoadingMaxRetry)}var C=D.frag;if(!(!C||C.type!==E)){var M=this.fragCurrent;if(console.assert(M&&C.sn===M.sn&&C.level===M.level&&C.urlId===M.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=R.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var U=Math.min(Math.pow(2,this.fragLoadError)*R.fragLoadingRetryDelay,R.fragLoadingMaxRetryTimeout);this.warn("Fragment "+C.sn+" of "+E+" "+C.level+" failed to load, retrying in "+U+"ms"),this.retryDate=self.performance.now()+U,this.fragLoadError++,this.state=n.FRAG_LOADING_WAITING_RETRY}else D.levelRetry?(E===a.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=n.IDLE):(k.logger.error(D.details+" reaches max retry, redispatch as fatal ..."),D.fatal=!0,this.hls.stopLoad(),this.state=n.ERROR)}},d.afterBufferFlushed=function(E,D,R){if(E){var O=I.BufferHelper.getBuffered(E);this.fragmentTracker.detectEvictedFragments(D,O,R),this.state===n.ENDED&&this.resetLoadingState()}},d.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=n.IDLE},d.resetStartWhenNotLoaded=function(E){if(!this.loadedmetadata){this.startFragRequested=!1;var D=this.levels?this.levels[E].details:null;D!=null&&D.live?(this.startPosition=-1,this.setStartPosition(D,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},d.updateLevelTiming=function(E,D,R,O){var C=this,M=R.details;console.assert(!!M,"level.details must be defined");var U=Object.keys(E.elementaryStreams).reduce(function(B,N){var K=E.elementaryStreams[N];if(K){var W=K.endPTS-K.startPTS;if(W<=0)return C.warn("Could not parse fragment "+E.sn+" "+N+" duration reliably ("+W+")"),B||!1;var G=O?0:(0,y.updateFragPTSDTS)(M,E,K.startPTS,K.endPTS,K.startDTS,K.endDTS);return C.hls.trigger(P.Events.LEVEL_PTS_UPDATED,{details:M,level:R,drift:G,type:N,frag:E,start:K.startPTS,end:K.endPTS}),!0}return B},!1);U||(this.warn("Found no media in fragment "+E.sn+" of level "+R.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=n.PARSED,this.hls.trigger(P.Events.FRAG_PARSED,{frag:E,part:D})},d.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},g(e,[{key:"state",get:function(){return this._state},set:function(E){var D=this._state;D!==E&&(this._state=E,this.log(D+"->"+E))}}]),e}(A.default)},"./src/controller/buffer-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>c});var F=x("./src/polyfills/number.ts"),A=x("./src/events.ts"),b=x("./src/utils/logger.ts"),I=x("./src/errors.ts"),k=x("./src/utils/buffer-helper.ts"),P=x("./src/utils/mediasource-helper.ts"),L=x("./src/loader/fragment.ts"),S=x("./src/controller/buffer-operation-queue.ts"),_=(0,P.getMediaSource)(),T=/([ha]vc.)(?:\.[^.,]+)+/,c=function(){function y(l){var f=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var a=f.hls,i=f.media,g=f.mediaSource;b.logger.log("[buffer-controller]: Media source opened"),i&&(f.updateMediaElementDuration(),a.trigger(A.Events.MEDIA_ATTACHED,{media:i})),g&&g.removeEventListener("sourceopen",f._onMediaSourceOpen),f.checkPendingTracks()},this._onMediaSourceClose=function(){b.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){b.logger.log("[buffer-controller]: Media source ended")},this.hls=l,this._initSourceBuffer(),this.registerListeners()}var m=y.prototype;return m.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},m.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},m.registerListeners=function(){var f=this.hls;f.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.on(A.Events.BUFFER_RESET,this.onBufferReset,this),f.on(A.Events.BUFFER_APPENDING,this.onBufferAppending,this),f.on(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),f.on(A.Events.BUFFER_EOS,this.onBufferEos,this),f.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),f.on(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this),f.on(A.Events.FRAG_PARSED,this.onFragParsed,this),f.on(A.Events.FRAG_CHANGED,this.onFragChanged,this)},m.unregisterListeners=function(){var f=this.hls;f.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.off(A.Events.BUFFER_RESET,this.onBufferReset,this),f.off(A.Events.BUFFER_APPENDING,this.onBufferAppending,this),f.off(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),f.off(A.Events.BUFFER_EOS,this.onBufferEos,this),f.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),f.off(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this),f.off(A.Events.FRAG_PARSED,this.onFragParsed,this),f.off(A.Events.FRAG_CHANGED,this.onFragChanged,this)},m._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new S.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},m.onManifestParsed=function(f,a){var i=2;(a.audio&&!a.video||!a.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,b.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},m.onMediaAttaching=function(f,a){var i=this.media=a.media;if(i&&_){var g=this.mediaSource=new _;g.addEventListener("sourceopen",this._onMediaSourceOpen),g.addEventListener("sourceended",this._onMediaSourceEnded),g.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(g),this._objectUrl=i.src}},m.onMediaDetaching=function(){var f=this.media,a=this.mediaSource,i=this._objectUrl;if(a){if(b.logger.log("[buffer-controller]: media source detaching"),a.readyState==="open")try{a.endOfStream()}catch(g){b.logger.warn("[buffer-controller]: onMediaDetaching: "+g.message+" while calling endOfStream")}this.onBufferReset(),a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),f&&(i&&self.URL.revokeObjectURL(i),f.src===i?(f.removeAttribute("src"),f.load()):b.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(A.Events.MEDIA_DETACHED,void 0)},m.onBufferReset=function(){var f=this;this.getSourceBufferTypes().forEach(function(a){var i=f.sourceBuffer[a];try{i&&(f.removeBufferListeners(a),f.mediaSource&&f.mediaSource.removeSourceBuffer(i),f.sourceBuffer[a]=void 0)}catch(g){b.logger.warn("[buffer-controller]: Failed to reset the "+a+" buffer",g)}}),this._initSourceBuffer()},m.onBufferCodecs=function(f,a){var i=this,g=this.getSourceBufferTypes().length;Object.keys(a).forEach(function(s){if(g){var r=i.tracks[s];if(r&&typeof r.buffer.changeType=="function"){var o=a[s],v=o.id,u=o.codec,n=o.levelCodec,t=o.container,h=o.metadata,e=(r.levelCodec||r.codec).replace(T,"$1"),d=(n||u).replace(T,"$1");if(e!==d){var p=t+";codecs="+(n||u);i.appendChangeType(s,p),b.logger.log("[buffer-controller]: switching codec "+e+" to "+d),i.tracks[s]={buffer:r.buffer,codec:u,container:t,levelCodec:n,metadata:h,id:v}}}}else i.pendingTracks[s]=a[s]}),!g&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},m.appendChangeType=function(f,a){var i=this,g=this.operationQueue,s={execute:function(){var o=i.sourceBuffer[f];o&&(b.logger.log("[buffer-controller]: changing "+f+" sourceBuffer type to "+a),o.changeType(a)),g.shiftAndExecuteNext(f)},onStart:function(){},onComplete:function(){},onError:function(o){b.logger.warn("[buffer-controller]: Failed to change "+f+" SourceBuffer type",o)}};g.append(s,f)},m.onBufferAppending=function(f,a){var i=this,g=this.hls,s=this.operationQueue,r=this.tracks,o=a.data,v=a.type,u=a.frag,n=a.part,t=a.chunkMeta,h=t.buffering[v],e=self.performance.now();h.start=e;var d=u.stats.buffering,p=n?n.stats.buffering:null;d.start===0&&(d.start=e),p&&p.start===0&&(p.start=e);var E=r.audio,D=!1;v==="audio"&&(E==null?void 0:E.container)==="audio/mpeg"&&(D=!this.lastMpegAudioChunk||t.id===1||this.lastMpegAudioChunk.sn!==t.sn,this.lastMpegAudioChunk=t);var R=u.start,O={execute:function(){if(h.executeStart=self.performance.now(),D){var M=i.sourceBuffer[v];if(M){var U=R-M.timestampOffset;Math.abs(U)>=.1&&(b.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+R+" (delta: "+U+") sn: "+u.sn+")"),M.timestampOffset=R)}}i.appendExecutor(o,v)},onStart:function(){},onComplete:function(){var M=self.performance.now();h.executeEnd=h.end=M,d.first===0&&(d.first=M),p&&p.first===0&&(p.first=M);var U=i.sourceBuffer,B={};for(var N in U)B[N]=k.BufferHelper.getBuffered(U[N]);i.appendError=0,i.hls.trigger(A.Events.BUFFER_APPENDED,{type:v,frag:u,part:n,chunkMeta:t,parent:u.type,timeRanges:B})},onError:function(M){b.logger.error("[buffer-controller]: Error encountered while trying to append to the "+v+" SourceBuffer",M);var U={type:I.ErrorTypes.MEDIA_ERROR,parent:u.type,details:I.ErrorDetails.BUFFER_APPEND_ERROR,err:M,fatal:!1};M.code===DOMException.QUOTA_EXCEEDED_ERR?U.details=I.ErrorDetails.BUFFER_FULL_ERROR:(i.appendError++,U.details=I.ErrorDetails.BUFFER_APPEND_ERROR,i.appendError>g.config.appendErrorMaxRetry&&(b.logger.error("[buffer-controller]: Failed "+g.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),U.fatal=!0,g.stopLoad())),g.trigger(A.Events.ERROR,U)}};s.append(O,v)},m.onBufferFlushing=function(f,a){var i=this,g=this.operationQueue,s=function(o){return{execute:i.removeExecutor.bind(i,o,a.startOffset,a.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(A.Events.BUFFER_FLUSHED,{type:o})},onError:function(u){b.logger.warn("[buffer-controller]: Failed to remove from "+o+" SourceBuffer",u)}}};a.type?g.append(s(a.type),a.type):this.getSourceBufferTypes().forEach(function(r){g.append(s(r),r)})},m.onFragParsed=function(f,a){var i=this,g=a.frag,s=a.part,r=[],o=s?s.elementaryStreams:g.elementaryStreams;o[L.ElementaryStreamTypes.AUDIOVIDEO]?r.push("audiovideo"):(o[L.ElementaryStreamTypes.AUDIO]&&r.push("audio"),o[L.ElementaryStreamTypes.VIDEO]&&r.push("video"));var v=function(){var n=self.performance.now();g.stats.buffering.end=n,s&&(s.stats.buffering.end=n);var t=s?s.stats:g.stats;i.hls.trigger(A.Events.FRAG_BUFFERED,{frag:g,part:s,stats:t,id:g.type})};r.length===0&&b.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+g.type+" level: "+g.level+" sn: "+g.sn),this.blockBuffers(v,r)},m.onFragChanged=function(f,a){this.flushBackBuffer()},m.onBufferEos=function(f,a){var i=this,g=this.getSourceBufferTypes().reduce(function(s,r){var o=i.sourceBuffer[r];return o&&(!a.type||a.type===r)&&(o.ending=!0,o.ended||(o.ended=!0,b.logger.log("[buffer-controller]: "+r+" sourceBuffer now EOS"))),s&&!!(!o||o.ended)},!0);g&&(b.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){i.getSourceBufferTypes().forEach(function(r){var o=i.sourceBuffer[r];o&&(o.ending=!1)});var s=i.mediaSource;if(!s||s.readyState!=="open"){s&&b.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+s.readyState);return}b.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),s.endOfStream()}))},m.onLevelUpdated=function(f,a){var i=a.details;i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},m.flushBackBuffer=function(){var f=this.hls,a=this.details,i=this.media,g=this.sourceBuffer;if(!(!i||a===null)){var s=this.getSourceBufferTypes();if(s.length){var r=a.live&&f.config.liveBackBufferLength!==null?f.config.liveBackBufferLength:f.config.backBufferLength;if(!(!(0,F.isFiniteNumber)(r)||r<0)){var o=i.currentTime,v=a.levelTargetDuration,u=Math.max(r,v),n=Math.floor(o/v)*v-u;s.forEach(function(t){var h=g[t];if(h){var e=k.BufferHelper.getBuffered(h);if(e.length>0&&n>e.start(0)){if(f.trigger(A.Events.BACK_BUFFER_REACHED,{bufferEnd:n}),a.live)f.trigger(A.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(h.ended&&e.end(e.length-1)-o<v*2){b.logger.info("[buffer-controller]: Cannot flush "+t+" back buffer while SourceBuffer is in ended state");return}f.trigger(A.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:t})}}})}}}},m.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var f=this.details,a=this.hls,i=this.media,g=this.mediaSource,s=f.fragments[0].start+f.totalduration,r=i.duration,o=(0,F.isFiniteNumber)(g.duration)?g.duration:0;f.live&&a.config.liveDurationInfinity?(b.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),g.duration=1/0,this.updateSeekableRange(f)):(s>o&&s>r||!(0,F.isFiniteNumber)(r))&&(b.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),g.duration=s)}},m.updateSeekableRange=function(f){var a=this.mediaSource,i=f.fragments,g=i.length;if(g&&f.live&&a!==null&&a!==void 0&&a.setLiveSeekableRange){var s=Math.max(0,i[0].start),r=Math.max(s,s+f.totalduration);a.setLiveSeekableRange(s,r)}},m.checkPendingTracks=function(){var f=this.bufferCodecEventsExpected,a=this.operationQueue,i=this.pendingTracks,g=Object.keys(i).length;if(g&&!f||g===2){this.createSourceBuffers(i),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length===0){this.hls.trigger(A.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}s.forEach(function(r){a.executeNext(r)})}},m.createSourceBuffers=function(f){var a=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var g=0;for(var s in f)if(!a[s]){var r=f[s];if(!r)throw Error("source buffer exists for track "+s+", however track does not");var o=r.levelCodec||r.codec,v=r.container+";codecs="+o;b.logger.log("[buffer-controller]: creating sourceBuffer("+v+")");try{var u=a[s]=i.addSourceBuffer(v),n=s;this.addBufferListener(n,"updatestart",this._onSBUpdateStart),this.addBufferListener(n,"updateend",this._onSBUpdateEnd),this.addBufferListener(n,"error",this._onSBUpdateError),this.tracks[s]={buffer:u,codec:o,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},g++}catch(t){b.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(A.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:v})}}g&&this.hls.trigger(A.Events.BUFFER_CREATED,{tracks:this.tracks})},m._onSBUpdateStart=function(f){var a=this.operationQueue,i=a.current(f);i.onStart()},m._onSBUpdateEnd=function(f){var a=this.operationQueue,i=a.current(f);i.onComplete(),a.shiftAndExecuteNext(f)},m._onSBUpdateError=function(f,a){b.logger.error("[buffer-controller]: "+f+" SourceBuffer error",a),this.hls.trigger(A.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var i=this.operationQueue.current(f);i&&i.onError(a)},m.removeExecutor=function(f,a,i){var g=this.media,s=this.mediaSource,r=this.operationQueue,o=this.sourceBuffer,v=o[f];if(!g||!s||!v){b.logger.warn("[buffer-controller]: Attempting to remove from the "+f+" SourceBuffer, but it does not exist"),r.shiftAndExecuteNext(f);return}var u=(0,F.isFiniteNumber)(g.duration)?g.duration:1/0,n=(0,F.isFiniteNumber)(s.duration)?s.duration:1/0,t=Math.max(0,a),h=Math.min(i,u,n);h>t&&!v.ending?(v.ended=!1,b.logger.log("[buffer-controller]: Removing ["+t+","+h+"] from the "+f+" SourceBuffer"),console.assert(!v.updating,f+" sourceBuffer must not be updating"),v.remove(t,h)):r.shiftAndExecuteNext(f)},m.appendExecutor=function(f,a){var i=this.operationQueue,g=this.sourceBuffer,s=g[a];if(!s){b.logger.warn("[buffer-controller]: Attempting to append to the "+a+" SourceBuffer, but it does not exist"),i.shiftAndExecuteNext(a);return}s.ended=!1,console.assert(!s.updating,a+" sourceBuffer must not be updating"),s.appendBuffer(f)},m.blockBuffers=function(f,a){var i=this;if(a===void 0&&(a=this.getSourceBufferTypes()),!a.length){b.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(f);return}var g=this.operationQueue,s=a.map(function(r){return g.appendBlocker(r)});Promise.all(s).then(function(){f(),a.forEach(function(r){var o=i.sourceBuffer[r];(!o||!o.updating)&&g.shiftAndExecuteNext(r)})})},m.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},m.addBufferListener=function(f,a,i){var g=this.sourceBuffer[f];if(g){var s=i.bind(this,f);this.listeners[f].push({event:a,listener:s}),g.addEventListener(a,s)}},m.removeBufferListeners=function(f){var a=this.sourceBuffer[f];a&&this.listeners[f].forEach(function(i){a.removeEventListener(i.event,i.listener)})},y}()},"./src/controller/buffer-operation-queue.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>A});var F=x("./src/utils/logger.ts"),A=function(){function b(k){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=k}var I=b.prototype;return I.append=function(P,L){var S=this.queues[L];S.push(P),S.length===1&&this.buffers[L]&&this.executeNext(L)},I.insertAbort=function(P,L){var S=this.queues[L];S.unshift(P),this.executeNext(L)},I.appendBlocker=function(P){var L,S=new Promise(function(T){L=T}),_={execute:L,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(_,P),S},I.executeNext=function(P){var L=this.buffers,S=this.queues,_=L[P],T=S[P];if(T.length){var c=T[0];try{c.execute()}catch(y){F.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),c.onError(y),(!_||!_.updating)&&(T.shift(),this.executeNext(P))}}},I.shiftAndExecuteNext=function(P){this.queues[P].shift(),this.executeNext(P)},I.current=function(P){return this.queues[P][0]},b}()},"./src/controller/cap-level-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>L});var F=x("./src/events.ts");function A(S,_){for(var T=0;T<_.length;T++){var c=_[T];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(S,I(c.key),c)}}function b(S,_,T){return _&&A(S.prototype,_),T&&A(S,T),Object.defineProperty(S,"prototype",{writable:!1}),S}function I(S){var _=k(S,"string");return typeof _=="symbol"?_:String(_)}function k(S,_){if(typeof S!="object"||S===null)return S;var T=S[Symbol.toPrimitive];if(T!==void 0){var c=T.call(S,_||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(S)}var P=function(){function S(T){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=T,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var _=S.prototype;return _.setStreamController=function(c){this.streamController=c},_.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},_.registerListeners=function(){var c=this.hls;c.on(F.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),c.on(F.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.on(F.Events.BUFFER_CODECS,this.onBufferCodecs,this),c.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},_.unregisterListener=function(){var c=this.hls;c.off(F.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),c.off(F.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.off(F.Events.BUFFER_CODECS,this.onBufferCodecs,this),c.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},_.onFpsDropLevelCapping=function(c,y){S.isLevelAllowed(y.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(y.droppedLevel)},_.onMediaAttaching=function(c,y){this.media=y.media instanceof HTMLVideoElement?y.media:null,this.clientRect=null},_.onManifestParsed=function(c,y){var m=this.hls;this.restrictedLevels=[],this.firstLevel=y.firstLevel,m.config.capLevelToPlayerSize&&y.video&&this.startCapping()},_.onBufferCodecs=function(c,y){var m=this.hls;m.config.capLevelToPlayerSize&&y.video&&this.startCapping()},_.onMediaDetaching=function(){this.stopCapping()},_.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var c=this.hls.levels;if(c.length){var y=this.hls;y.autoLevelCapping=this.getMaxLevel(c.length-1),y.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=y.autoLevelCapping}}},_.getMaxLevel=function(c){var y=this,m=this.hls.levels;if(!m.length)return-1;var l=m.filter(function(f,a){return S.isLevelAllowed(a,y.restrictedLevels)&&a<=c});return this.clientRect=null,S.getMaxLevelByMediaSize(l,this.mediaWidth,this.mediaHeight)},_.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},_.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},_.getDimensions=function(){if(this.clientRect)return this.clientRect;var c=this.media,y={width:0,height:0};if(c){var m=c.getBoundingClientRect();y.width=m.width,y.height=m.height,!y.width&&!y.height&&(y.width=m.right-m.left||c.width||0,y.height=m.bottom-m.top||c.height||0)}return this.clientRect=y,y},S.isLevelAllowed=function(c,y){return y===void 0&&(y=[]),y.indexOf(c)===-1},S.getMaxLevelByMediaSize=function(c,y,m){if(!c||!c.length)return-1;for(var l=function(s,r){return r?s.width!==r.width||s.height!==r.height:!0},f=c.length-1,a=0;a<c.length;a+=1){var i=c[a];if((i.width>=y||i.height>=m)&&l(i,c[a+1])){f=a;break}}return f},b(S,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var c=1;if(!this.hls.config.ignoreDevicePixelRatio)try{c=self.devicePixelRatio}catch{}return c}}]),S}();const L=P},"./src/controller/cmcd-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>m});var F=x("./src/events.ts"),A=x("./src/types/cmcd.ts"),b=x("./src/utils/buffer-helper.ts"),I=x("./src/utils/logger.ts");function k(l,f){for(var a=0;a<f.length;a++){var i=f[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(l,L(i.key),i)}}function P(l,f,a){return f&&k(l.prototype,f),a&&k(l,a),Object.defineProperty(l,"prototype",{writable:!1}),l}function L(l){var f=S(l,"string");return typeof f=="symbol"?f:String(f)}function S(l,f){if(typeof l!="object"||l===null)return l;var a=l[Symbol.toPrimitive];if(a!==void 0){var i=a.call(l,f||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(l)}function _(l,f){var a=typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(a)return(a=a.call(l)).next.bind(a);if(Array.isArray(l)||(a=T(l))||f&&l&&typeof l.length=="number"){a&&(l=a);var i=0;return function(){return i>=l.length?{done:!0}:{done:!1,value:l[i++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T(l,f){if(l){if(typeof l=="string")return c(l,f);var a=Object.prototype.toString.call(l).slice(8,-1);if(a==="Object"&&l.constructor&&(a=l.constructor.name),a==="Map"||a==="Set")return Array.from(l);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return c(l,f)}}function c(l,f){(f==null||f>l.length)&&(f=l.length);for(var a=0,i=new Array(f);a<f;a++)i[a]=l[a];return i}function y(){return y=Object.assign?Object.assign.bind():function(l){for(var f=1;f<arguments.length;f++){var a=arguments[f];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(l[i]=a[i])}return l},y.apply(this,arguments)}var m=function(){function l(a){var i=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){i.initialized&&(i.starved=!0),i.buffering=!0},this.onPlaying=function(){i.initialized||(i.initialized=!0),i.buffering=!1},this.applyPlaylistData=function(r){try{i.apply(r,{ot:A.CMCDObjectType.MANIFEST,su:!i.initialized})}catch(o){I.logger.warn("Could not generate manifest CMCD data.",o)}},this.applyFragmentData=function(r){try{var o=r.frag,v=i.hls.levels[o.level],u=i.getObjectType(o),n={d:o.duration*1e3,ot:u};(u===A.CMCDObjectType.VIDEO||u===A.CMCDObjectType.AUDIO||u==A.CMCDObjectType.MUXED)&&(n.br=v.bitrate/1e3,n.tb=i.getTopBandwidth(u)/1e3,n.bl=i.getBufferLength(u)),i.apply(r,n)}catch(t){I.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=a;var g=this.config=a.config,s=g.cmcd;s!=null&&(g.pLoader=this.createPlaylistLoader(),g.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||l.uuid(),this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.registerListeners())}var f=l.prototype;return f.registerListeners=function(){var i=this.hls;i.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),i.on(F.Events.BUFFER_CREATED,this.onBufferCreated,this)},f.unregisterListeners=function(){var i=this.hls;i.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),i.off(F.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},f.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},f.onMediaAttached=function(i,g){this.media=g.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},f.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},f.onBufferCreated=function(i,g){var s,r;this.audioBuffer=(s=g.tracks.audio)===null||s===void 0?void 0:s.buffer,this.videoBuffer=(r=g.tracks.video)===null||r===void 0?void 0:r.buffer},f.createData=function(){var i;return{v:A.CMCDVersion,sf:A.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(i=this.media)===null||i===void 0?void 0:i.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},f.apply=function(i,g){g===void 0&&(g={}),y(g,this.createData());var s=g.ot===A.CMCDObjectType.INIT||g.ot===A.CMCDObjectType.VIDEO||g.ot===A.CMCDObjectType.MUXED;if(this.starved&&s&&(g.bs=!0,g.su=!0,this.starved=!1),g.su==null&&(g.su=this.buffering),this.useHeaders){var r=l.toHeaders(g);if(!Object.keys(r).length)return;i.headers||(i.headers={}),y(i.headers,r)}else{var o=l.toQuery(g);if(!o)return;i.url=l.appendQueryToUri(i.url,o)}},f.getObjectType=function(i){var g=i.type;if(g==="subtitle")return A.CMCDObjectType.TIMED_TEXT;if(i.sn==="initSegment")return A.CMCDObjectType.INIT;if(g==="audio")return A.CMCDObjectType.AUDIO;if(g==="main")return this.hls.audioTracks.length?A.CMCDObjectType.VIDEO:A.CMCDObjectType.MUXED},f.getTopBandwidth=function(i){var g=0,s,r=this.hls;if(i===A.CMCDObjectType.AUDIO)s=r.audioTracks;else{var o=r.maxAutoLevel,v=o>-1?o+1:r.levels.length;s=r.levels.slice(0,v)}for(var u=_(s),n;!(n=u()).done;){var t=n.value;t.bitrate>g&&(g=t.bitrate)}return g>0?g:NaN},f.getBufferLength=function(i){var g=this.hls.media,s=i===A.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!s||!g)return NaN;var r=b.BufferHelper.bufferInfo(s,g.currentTime,this.config.maxBufferHole);return r.len*1e3},f.createPlaylistLoader=function(){var i=this.config.pLoader,g=this.applyPlaylistData,s=i||this.config.loader;return function(){function r(v){this.loader=void 0,this.loader=new s(v)}var o=r.prototype;return o.destroy=function(){this.loader.destroy()},o.abort=function(){this.loader.abort()},o.load=function(u,n,t){g(u),this.loader.load(u,n,t)},P(r,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),r}()},f.createFragmentLoader=function(){var i=this.config.fLoader,g=this.applyFragmentData,s=i||this.config.loader;return function(){function r(v){this.loader=void 0,this.loader=new s(v)}var o=r.prototype;return o.destroy=function(){this.loader.destroy()},o.abort=function(){this.loader.abort()},o.load=function(u,n,t){g(u),this.loader.load(u,n,t)},P(r,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),r}()},l.uuid=function(){var i=URL.createObjectURL(new Blob),g=i.toString();return URL.revokeObjectURL(i),g.slice(g.lastIndexOf("/")+1)},l.serialize=function(i){for(var g=[],s=function(O){return!Number.isNaN(O)&&O!=null&&O!==""&&O!==!1},r=function(O){return Math.round(O)},o=function(O){return r(O/100)*100},v=function(O){return encodeURIComponent(O)},u={br:r,d:r,bl:o,dl:o,mtp:o,nor:v,rtp:o,tb:r},n=Object.keys(i||{}).sort(),t=_(n),h;!(h=t()).done;){var e=h.value,d=i[e];if(s(d)&&!(e==="v"&&d===1)&&!(e=="pr"&&d===1)){var p=u[e];p&&(d=p(d));var E=typeof d,D=void 0;e==="ot"||e==="sf"||e==="st"?D=e+"="+d:E==="boolean"?D=e:E==="number"?D=e+"="+d:D=e+"="+JSON.stringify(d),g.push(D)}}return g.join(",")},l.toHeaders=function(i){for(var g=Object.keys(i),s={},r=["Object","Request","Session","Status"],o=[{},{},{},{}],v={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},u=0,n=g;u<n.length;u++){var t=n[u],h=v[t]!=null?v[t]:1;o[h][t]=i[t]}for(var e=0;e<o.length;e++){var d=l.serialize(o[e]);d&&(s["CMCD-"+r[e]]=d)}return s},l.toQuery=function(i){return"CMCD="+encodeURIComponent(l.serialize(i))},l.appendQueryToUri=function(i,g){if(!g)return i;var s=i.includes("?")?"&":"?";return""+i+s+g},l}()},"./src/controller/eme-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>u});var F=x("./src/events.ts"),A=x("./src/errors.ts"),b=x("./src/utils/logger.ts"),I=x("./src/utils/mediakeys-helper.ts"),k=x("./src/utils/keysystem-util.ts"),P=x("./src/utils/numeric-encoding-utils.ts"),L=x("./src/loader/level-key.ts"),S=x("./src/utils/hex.ts"),_=x("./src/utils/mp4-tools.ts"),T=x("./node_modules/eventemitter3/index.js"),c=x.n(T);function y(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,i(n,t)}function m(n){var t=typeof Map=="function"?new Map:void 0;return m=function(e){if(e===null||!a(e))return e;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(e))return t.get(e);t.set(e,d)}function d(){return l(e,arguments,g(this).constructor)}return d.prototype=Object.create(e.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),i(d,e)},m(n)}function l(n,t,h){return f()?l=Reflect.construct.bind():l=function(d,p,E){var D=[null];D.push.apply(D,p);var R=Function.bind.apply(d,D),O=new R;return E&&i(O,E.prototype),O},l.apply(null,arguments)}function f(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function a(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function i(n,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,d){return e.__proto__=d,e},i(n,t)}function g(n){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(h){return h.__proto__||Object.getPrototypeOf(h)},g(n)}var s=3,r="[eme]",o=function(){function n(h){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=n.CDMCleanupPromise?[n.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=b.logger.debug.bind(b.logger,r),this.log=b.logger.log.bind(b.logger,r),this.warn=b.logger.warn.bind(b.logger,r),this.error=b.logger.error.bind(b.logger,r),this.hls=h,this.config=h.config,this.registerListeners()}var t=n.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},t.registerListeners=function(){this.hls.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(F.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.unregisterListeners=function(){this.hls.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(F.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.getLicenseServerUrl=function(e){var d=this.config,p=d.drmSystems,E=d.widevineLicenseUrl,D=p[e];if(D)return D.licenseUrl;if(e===I.KeySystems.WIDEVINE&&E)return E;throw new Error('no license server URL configured for key-system "'+e+'"')},t.getServerCertificateUrl=function(e){var d=this.config.drmSystems,p=d[e];if(p)return p.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},t.attemptKeySystemAccess=function(e){var d=this,p=this.hls.levels,E=function(C,M,U){return!!C&&U.indexOf(C)===M},D=p.map(function(O){return O.audioCodec}).filter(E),R=p.map(function(O){return O.videoCodec}).filter(E);return D.length+R.length===0&&R.push("avc1.42e01e"),new Promise(function(O,C){var M=function U(B){var N=B.shift();d.getMediaKeysPromise(N,D,R).then(function(K){return O({keySystem:N,mediaKeys:K})}).catch(function(K){B.length?U(B):K instanceof v?C(K):C(new v({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:K,fatal:!0},K.message))})};M(e)})},t.requestMediaKeySystemAccess=function(e,d){var p=this.config.requestMediaKeySystemAccessFunc;if(typeof p!="function"){var E="Configured requestMediaKeySystemAccess is not a function "+p;return I.requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(E="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(E))}return p(e,d)},t.getMediaKeysPromise=function(e,d,p){var E=this,D=(0,I.getSupportedMediaKeySystemConfigurations)(e,d,p,this.config.drmSystemOptions),R=this.keySystemAccessPromises[e],O=R==null?void 0:R.keySystemAccess;if(!O){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(D)),O=this.requestMediaKeySystemAccess(e,D);var C=this.keySystemAccessPromises[e]={keySystemAccess:O};return O.catch(function(M){E.log('Failed to obtain access to key-system "'+e+'": '+M)}),O.then(function(M){E.log('Access for key-system "'+M.keySystem+'" obtained');var U=E.fetchServerCertificate(e);return E.log('Create media-keys for "'+e+'"'),C.mediaKeys=M.createMediaKeys().then(function(B){return E.log('Media-keys created for "'+e+'"'),U.then(function(N){return N?E.setMediaKeysServerCertificate(B,e,N):B})}),C.mediaKeys.catch(function(B){E.error('Failed to create media-keys for "'+e+'"}: '+B)}),C.mediaKeys})}return O.then(function(){return R.mediaKeys})},t.createMediaKeySessionContext=function(e){var d=e.decryptdata,p=e.keySystem,E=e.mediaKeys;console.assert(!!E,"mediaKeys is defined"),this.log('Creating key-system session "'+p+'" keyId: '+S.default.hexDump(d.keyId||[]));var D=E.createSession(),R={decryptdata:d,keySystem:p,mediaKeys:E,mediaKeysSession:D,keyStatus:"status-pending"};return this.mediaKeySessions.push(R),R},t.renewKeySession=function(e){var d=e.decryptdata;if(d.pssh){var p=this.createMediaKeySessionContext(e),E=this.getKeyIdString(d),D="cenc";this.keyIdToKeySessionPromise[E]=this.generateRequestWithPreferredKeySession(p,D,d.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},t.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return S.default.hexDump(e.keyId)},t.updateKeySession=function(e,d){var p,E=e.mediaKeysSession;return this.log('Updating key-session "'+E.sessionId+'" for keyID '+S.default.hexDump(((p=e.decryptdata)===null||p===void 0?void 0:p.keyId)||[])+`
      } (data length: `+(d&&d.byteLength)+")"),E.update(d)},t.selectKeySystemFormat=function(e){var d=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+d.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(d)),this.keyFormatPromise},t.getKeyFormatPromise=function(e){var d=this;return new Promise(function(p,E){var D=(0,I.getKeySystemsForConfig)(d.config),R=e.map(I.keySystemFormatToKeySystemDomain).filter(function(O){return!!O&&D.indexOf(O)!==-1});return d.getKeySystemSelectionPromise(R).then(function(O){var C=O.keySystem,M=(0,I.keySystemDomainToKeySystemFormat)(C);M?p(M):E(new Error('Unable to find format for key-system "'+C+'"'))}).catch(E)})},t.loadKey=function(e){var d=this,p=e.keyInfo.decryptdata,E=this.getKeyIdString(p),D="(keyId: "+E+' format: "'+p.keyFormat+'" method: '+p.method+" uri: "+p.uri+")";this.log("Starting session for key "+D);var R=this.keyIdToKeySessionPromise[E];return R||(R=this.keyIdToKeySessionPromise[E]=this.getKeySystemForKeyPromise(p).then(function(O){var C=O.keySystem,M=O.mediaKeys;return d.throwIfDestroyed(),d.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+D),d.attemptSetMediaKeys(C,M).then(function(){d.throwIfDestroyed();var U=d.createMediaKeySessionContext({keySystem:C,mediaKeys:M,decryptdata:p}),B="cenc";return d.generateRequestWithPreferredKeySession(U,B,p.pssh,"playlist-key")})}),R.catch(function(O){return d.handleError(O)})),R},t.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},t.handleError=function(e){this.hls&&(this.error(e.message),e instanceof v?this.hls.trigger(F.Events.ERROR,e.data):this.hls.trigger(F.Events.ERROR,{type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},t.getKeySystemForKeyPromise=function(e){var d=this.getKeyIdString(e),p=this.keyIdToKeySessionPromise[d];if(!p){var E=(0,I.keySystemFormatToKeySystemDomain)(e.keyFormat),D=E?[E]:(0,I.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(D)}return p},t.getKeySystemSelectionPromise=function(e){if(e.length||(e=(0,I.getKeySystemsForConfig)(this.config)),e.length===0)throw new v({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},t._onMediaEncrypted=function(e){var d=this,p=e.initDataType,E=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+p+'"'),E!==null){var D,R;if(p==="sinf"&&this.config.drmSystems[I.KeySystems.FAIRPLAY]){var O=(0,_.bin2str)(new Uint8Array(E));try{var C=(0,P.base64Decode)(JSON.parse(O).sinf),M=(0,_.parseSinf)(new Uint8Array(C));if(!M)return;D=M.subarray(8,24),R=I.KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{var U=(0,_.parsePssh)(E);if(U===null)return;U.version===0&&U.systemId===I.KeySystemIds.WIDEVINE&&U.data&&(D=U.data.subarray(8,24)),R=(0,I.keySystemIdToKeySystemDomain)(U.systemId)}if(!(!R||!D)){for(var B=S.default.hexDump(D),N=this.keyIdToKeySessionPromise,K=this.mediaKeySessions,W=N[B],G=function(Q){var $=K[Q],z=$.decryptdata;if(z.pssh||!z.keyId)return"continue";var X=S.default.hexDump(z.keyId);if(B===X||z.uri.replace(/-/g,"").indexOf(B)!==-1)return W=N[X],delete N[X],z.pssh=new Uint8Array(E),z.keyId=D,W=N[B]=W.then(function(){return d.generateRequestWithPreferredKeySession($,p,E,"encrypted-event-key-match")}),"break"},j=0;j<K.length;j++){var H=G(j);if(H!=="continue"&&H==="break")break}W||(W=N[B]=this.getKeySystemSelectionPromise([R]).then(function(Y){var Q,$=Y.keySystem,z=Y.mediaKeys;d.throwIfDestroyed();var X=new L.LevelKey("ISO-23001-7",B,(Q=(0,I.keySystemDomainToKeySystemFormat)($))!=null?Q:"");return X.pssh=new Uint8Array(E),X.keyId=D,d.attemptSetMediaKeys($,z).then(function(){d.throwIfDestroyed();var Z=d.createMediaKeySessionContext({decryptdata:X,keySystem:$,mediaKeys:z});return d.generateRequestWithPreferredKeySession(Z,p,E,"encrypted-event-no-match")})})),W.catch(function(Y){return d.handleError(Y)})}}},t._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},t.attemptSetMediaKeys=function(e,d){var p=this,E=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var D=Promise.all(E).then(function(){if(!p.media)throw new Error("Attempted to set mediaKeys without media element attached");return p.media.setMediaKeys(d)});return this.setMediaKeysQueue.push(D),D.then(function(){p.log('Media-keys set for "'+e+'"'),E.push(D),p.setMediaKeysQueue=p.setMediaKeysQueue.filter(function(R){return E.indexOf(R)===-1})})},t.generateRequestWithPreferredKeySession=function(e,d,p,E){var D,R,O=this,C=(D=this.config.drmSystems)===null||D===void 0||(R=D[e.keySystem])===null||R===void 0?void 0:R.generateRequest;if(C)try{var M=C.call(this.hls,d,p,e);if(!M)throw new Error("Invalid response from configured generateRequest filter");d=M.initDataType,p=e.decryptdata.pssh=M.initData?new Uint8Array(M.initData):null}catch(W){var U;if(this.warn(W.message),(U=this.hls)!==null&&U!==void 0&&U.config.debug)throw W}if(p===null)return this.log('Skipping key-session request for "'+E+'" (no initData)'),Promise.resolve(e);var B=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+E+'": '+B+" (init data type: "+d+" length: "+(p?p.byteLength:null)+")");var N=new(c());e.mediaKeysSession.onmessage=function(W){var G=e.mediaKeysSession;if(!G){N.emit("error",new Error("invalid state"));return}var j=W.messageType,H=W.message;O.log('"'+j+'" message event for session "'+G.sessionId+'" message size: '+H.byteLength),j==="license-request"||j==="license-renewal"?O.renewLicense(e,H).catch(function(Y){O.handleError(Y),N.emit("error",Y)}):j==="license-release"?e.keySystem===I.KeySystems.FAIRPLAY&&(O.updateKeySession(e,(0,k.strToUtf8array)("acknowledged")),O.removeSession(e)):O.warn('unhandled media key message type "'+j+'"')},e.mediaKeysSession.onkeystatuseschange=function(W){var G=e.mediaKeysSession;if(!G){N.emit("error",new Error("invalid state"));return}O.onKeyStatusChange(e);var j=e.keyStatus;N.emit("keyStatus",j),j==="expired"&&(O.warn(e.keySystem+" expired for key "+B),O.renewKeySession(e))};var K=new Promise(function(W,G){N.on("error",G),N.on("keyStatus",function(j){j.startsWith("usable")?W():j==="output-restricted"?G(new v({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):j==="internal-error"?G(new v({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+j+'"')):j==="expired"?G(new Error("key expired while generating request")):O.warn('unhandled key status change "'+j+'"')})});return e.mediaKeysSession.generateRequest(d,p).then(function(){var W;O.log('Request generated for key-session "'+((W=e.mediaKeysSession)===null||W===void 0?void 0:W.sessionId)+'" keyId: '+B)}).catch(function(W){throw new v({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:W,fatal:!1},"Error generating key-session request: "+W)}).then(function(){return K}).catch(function(W){throw N.removeAllListeners(),O.removeSession(e),W}).then(function(){return N.removeAllListeners(),e})},t.onKeyStatusChange=function(e){var d=this;e.mediaKeysSession.keyStatuses.forEach(function(p,E){d.log('key status change "'+p+'" for keyStatuses keyId: '+S.default.hexDump("buffer"in E?new Uint8Array(E.buffer,E.byteOffset,E.byteLength):new Uint8Array(E))+" session keyId: "+S.default.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=p})},t.fetchServerCertificate=function(e){var d=this;return new Promise(function(p,E){var D=d.getServerCertificateUrl(e);if(!D)return p();d.log('Fetching serverCertificate for "'+e+'"');var R=new XMLHttpRequest;R.open("GET",D,!0),R.responseType="arraybuffer",R.onreadystatechange=function(){R.readyState===XMLHttpRequest.DONE&&(R.status===200?p(R.response):E(new v({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:R},'"'+e+'" certificate request XHR failed ('+D+"). Status: "+R.status+" ("+R.statusText+")")))},R.send()})},t.setMediaKeysServerCertificate=function(e,d,p){var E=this;return new Promise(function(D,R){e.setServerCertificate(p).then(function(O){E.log("setServerCertificate "+(O?"success":"not supported by CDM")+" ("+(p==null?void 0:p.byteLength)+') on "'+d+'"'),D(e)}).catch(function(O){R(new v({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:O,fatal:!0},O.message))})})},t.renewLicense=function(e,d){var p=this;return this.requestLicense(e,new Uint8Array(d)).then(function(E){return p.updateKeySession(e,new Uint8Array(E)).catch(function(D){throw new v({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:D,fatal:!0},D.message)})})},t.setupLicenseXHR=function(e,d,p,E){var D=this,R=this.config.licenseXhrSetup;return R?Promise.resolve().then(function(){if(!p.decryptdata)throw new Error("Key removed");return R.call(D.hls,e,d,p,E)}).catch(function(O){if(!p.decryptdata)throw O;return e.open("POST",d,!0),R.call(D.hls,e,d,p,E)}).then(function(O){e.readyState||e.open("POST",d,!0);var C=O||E;return{xhr:e,licenseChallenge:C}}):(e.open("POST",d,!0),Promise.resolve({xhr:e,licenseChallenge:E}))},t.requestLicense=function(e,d){var p=this;return new Promise(function(E,D){var R=p.getLicenseServerUrl(e.keySystem);p.log("Sending license request to URL: "+R);var O=new XMLHttpRequest;O.responseType="arraybuffer",O.onreadystatechange=function(){if(!p.hls||!e.mediaKeysSession)return D(new Error("invalid state"));if(O.readyState===4)if(O.status===200){p._requestLicenseFailureCount=0;var C=O.response;p.log("License received "+(C instanceof ArrayBuffer?C.byteLength:C));var M=p.config.licenseResponseCallback;if(M)try{C=M.call(p.hls,O,R,e)}catch(B){p.error(B)}E(C)}else if(p._requestLicenseFailureCount++,p._requestLicenseFailureCount>s||O.status>=400&&O.status<500)D(new v({type:A.ErrorTypes.KEY_SYSTEM_ERROR,details:A.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:O},"License Request XHR failed ("+R+"). Status: "+O.status+" ("+O.statusText+")"));else{var U=s-p._requestLicenseFailureCount+1;p.warn("Retrying license request, "+U+" attempts left"),p.requestLicense(e,d).then(E,D)}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=O,p.setupLicenseXHR(O,R,e,d).then(function(C){var M=C.xhr,U=C.licenseChallenge;M.send(U)})})},t.onMediaAttached=function(e,d){if(this.config.emeEnabled){var p=d.media;this.media=p,p.addEventListener("encrypted",this.onMediaEncrypted),p.addEventListener("waitingforkey",this.onWaitingForKey)}},t.onMediaDetached=function(){var e=this,d=this.media,p=this.mediaKeySessions;d&&(d.removeEventListener("encrypted",this.onMediaEncrypted),d.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},L.LevelKey.clearKeyUriToKeyIdMap();var E=p.length;n.CDMCleanupPromise=Promise.all(p.map(function(D){return e.removeSession(D)}).concat(d==null?void 0:d.setMediaKeys(null).catch(function(D){e.log("Could not clear media keys: "+D+". media.src: "+(d==null?void 0:d.src))}))).then(function(){E&&(e.log("finished closing key sessions and clearing media keys"),p.length=0)}).catch(function(D){e.log("Could not close sessions and clear media keys: "+D+". media.src: "+(d==null?void 0:d.src))})},t.onManifestLoaded=function(e,d){var p=d.sessionKeys;if(!(!p||!this.config.emeEnabled)&&!this.keyFormatPromise){var E=p.reduce(function(D,R){return D.indexOf(R.keyFormat)===-1&&D.push(R.keyFormat),D},[]);this.log("Selecting key-system from session-keys "+E.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(E)}},t.removeSession=function(e){var d=this,p=e.mediaKeysSession,E=e.licenseXhr;if(p){this.log("Remove licenses and keys and close session "+p.sessionId),p.onmessage=null,p.onkeystatuseschange=null,E&&E.readyState!==XMLHttpRequest.DONE&&E.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var D=this.mediaKeySessions.indexOf(e);return D>-1&&this.mediaKeySessions.splice(D,1),p.remove().catch(function(R){d.log("Could not remove session: "+R)}).then(function(){return p.close()}).catch(function(R){d.log("Could not close session: "+R)})}},n}();o.CDMCleanupPromise=void 0;var v=function(n){y(t,n);function t(h,e){var d;return d=n.call(this,e)||this,d.data=void 0,d.data=h,h.err=h.error,d}return t}(m(Error));const u=o},"./src/controller/fps-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>I});var F=x("./src/events.ts"),A=x("./src/utils/logger.ts"),b=function(){function k(L){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=L,this.registerListeners()}var P=k.prototype;return P.setStreamController=function(S){this.streamController=S},P.registerListeners=function(){this.hls.on(F.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},P.unregisterListeners=function(){this.hls.off(F.Events.MEDIA_ATTACHING,this.onMediaAttaching)},P.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},P.onMediaAttaching=function(S,_){var T=this.hls.config;if(T.capLevelOnFPSDrop){var c=_.media instanceof self.HTMLVideoElement?_.media:null;this.media=c,c&&typeof c.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),T.fpsDroppedMonitoringPeriod)}},P.checkFPS=function(S,_,T){var c=performance.now();if(_){if(this.lastTime){var y=c-this.lastTime,m=T-this.lastDroppedFrames,l=_-this.lastDecodedFrames,f=1e3*m/y,a=this.hls;if(a.trigger(F.Events.FPS_DROP,{currentDropped:m,currentDecoded:l,totalDroppedFrames:T}),f>0&&m>a.config.fpsDroppedMonitoringThreshold*l){var i=a.currentLevel;A.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+i),i>0&&(a.autoLevelCapping===-1||a.autoLevelCapping>=i)&&(i=i-1,a.trigger(F.Events.FPS_DROP_LEVEL_CAPPING,{level:i,droppedLevel:a.currentLevel}),a.autoLevelCapping=i,this.streamController.nextLevelSwitch())}}this.lastTime=c,this.lastDroppedFrames=T,this.lastDecodedFrames=_}},P.checkFPSInterval=function(){var S=this.media;if(S)if(this.isVideoPlaybackQualityAvailable){var _=S.getVideoPlaybackQuality();this.checkFPS(S,_.totalVideoFrames,_.droppedVideoFrames)}else this.checkFPS(S,S.webkitDecodedFrameCount,S.webkitDroppedFrameCount)},k}();const I=b},"./src/controller/fragment-finders.ts":(V,w,x)=>{x.r(w),x.d(w,{findFragWithCC:()=>L,findFragmentByPDT:()=>b,findFragmentByPTS:()=>I,fragmentWithinToleranceTest:()=>k,pdtWithinToleranceTest:()=>P});var F=x("./src/polyfills/number.ts"),A=x("./src/utils/binary-search.ts");function b(S,_,T){if(_===null||!Array.isArray(S)||!S.length||!(0,F.isFiniteNumber)(_))return null;var c=S[0].programDateTime;if(_<(c||0))return null;var y=S[S.length-1].endProgramDateTime;if(_>=(y||0))return null;T=T||0;for(var m=0;m<S.length;++m){var l=S[m];if(P(_,T,l))return l}return null}function I(S,_,T,c){T===void 0&&(T=0),c===void 0&&(c=0);var y=null;if(S?y=_[S.sn-_[0].sn+1]||null:T===0&&_[0].start===0&&(y=_[0]),y&&k(T,c,y)===0)return y;var m=A.default.search(_,k.bind(null,T,c));return m&&(m!==S||!y)?m:y}function k(S,_,T){if(S===void 0&&(S=0),_===void 0&&(_=0),T.start<=S&&T.start+T.duration>S)return 0;var c=Math.min(_,T.duration+(T.deltaPTS?T.deltaPTS:0));return T.start+T.duration-c<=S?1:T.start-c>S&&T.start?-1:0}function P(S,_,T){var c=Math.min(_,T.duration+(T.deltaPTS?T.deltaPTS:0))*1e3,y=T.endProgramDateTime||0;return y-c>S}function L(S,_){return A.default.search(S,function(T){return T.cc<_?1:T.cc>_?-1:0})}},"./src/controller/fragment-tracker.ts":(V,w,x)=>{x.r(w),x.d(w,{FragmentState:()=>b,FragmentTracker:()=>I});var F=x("./src/events.ts"),A=x("./src/types/loader.ts"),b;(function(L){L.NOT_LOADED="NOT_LOADED",L.APPENDING="APPENDING",L.PARTIAL="PARTIAL",L.OK="OK"})(b||(b={}));var I=function(){function L(_){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=_,this._registerListeners()}var S=L.prototype;return S._registerListeners=function(){var T=this.hls;T.on(F.Events.BUFFER_APPENDED,this.onBufferAppended,this),T.on(F.Events.FRAG_BUFFERED,this.onFragBuffered,this),T.on(F.Events.FRAG_LOADED,this.onFragLoaded,this)},S._unregisterListeners=function(){var T=this.hls;T.off(F.Events.BUFFER_APPENDED,this.onBufferAppended,this),T.off(F.Events.FRAG_BUFFERED,this.onFragBuffered,this),T.off(F.Events.FRAG_LOADED,this.onFragLoaded,this)},S.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},S.getAppendedFrag=function(T,c){if(c===A.PlaylistLevelType.MAIN){var y=this.activeFragment,m=this.activeParts;if(!y)return null;if(m)for(var l=m.length;l--;){var f=m[l],a=f?f.end:y.appendedPTS;if(f.start<=T&&a!==void 0&&T<=a)return l>9&&(this.activeParts=m.slice(l-9)),f}else if(y.start<=T&&y.appendedPTS!==void 0&&T<=y.appendedPTS)return y}return this.getBufferedFrag(T,c)},S.getBufferedFrag=function(T,c){for(var y=this.fragments,m=Object.keys(y),l=m.length;l--;){var f=y[m[l]];if((f==null?void 0:f.body.type)===c&&f.buffered){var a=f.body;if(a.start<=T&&T<=a.end)return a}}return null},S.detectEvictedFragments=function(T,c,y){var m=this;this.timeRanges&&(this.timeRanges[T]=c),Object.keys(this.fragments).forEach(function(l){var f=m.fragments[l];if(f){if(!f.buffered&&!f.loaded){f.body.type===y&&m.removeFragment(f.body);return}var a=f.range[T];a&&a.time.some(function(i){var g=!m.isTimeBuffered(i.startPTS,i.endPTS,c);return g&&m.removeFragment(f.body),g})}})},S.detectPartialFragments=function(T){var c=this,y=this.timeRanges,m=T.frag,l=T.part;if(!(!y||m.sn==="initSegment")){var f=P(m),a=this.fragments[f];a&&(Object.keys(y).forEach(function(i){var g=m.elementaryStreams[i];if(g){var s=y[i],r=l!==null||g.partial===!0;a.range[i]=c.getBufferedTimes(m,l,r,s)}}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,a.body.endList&&(this.endListFragments[a.body.type]=a)):this.removeFragment(a.body))}},S.fragBuffered=function(T){var c=P(T),y=this.fragments[c];y&&(y.loaded=null,y.buffered=!0)},S.getBufferedTimes=function(T,c,y,m){for(var l={time:[],partial:y},f=c?c.start:T.start,a=c?c.end:T.end,i=T.minEndPTS||a,g=T.maxStartPTS||f,s=0;s<m.length;s++){var r=m.start(s)-this.bufferPadding,o=m.end(s)+this.bufferPadding;if(g>=r&&i<=o){l.time.push({startPTS:Math.max(f,m.start(s)),endPTS:Math.min(a,m.end(s))});break}else if(f<o&&a>r)l.partial=!0,l.time.push({startPTS:Math.max(f,m.start(s)),endPTS:Math.min(a,m.end(s))});else if(a<=r)break}return l},S.getPartialFragment=function(T){var c=null,y,m,l,f=0,a=this.bufferPadding,i=this.fragments;return Object.keys(i).forEach(function(g){var s=i[g];s&&k(s)&&(m=s.body.start-a,l=s.body.end+a,T>=m&&T<=l&&(y=Math.min(T-m,l-T),f<=y&&(c=s.body,f=y)))}),c},S.isEndListAppended=function(T){var c=this.endListFragments[T];return c!==void 0&&(c.buffered||k(c))},S.getState=function(T){var c=P(T),y=this.fragments[c];return y?y.buffered?k(y)?b.PARTIAL:b.OK:b.APPENDING:b.NOT_LOADED},S.isTimeBuffered=function(T,c,y){for(var m,l,f=0;f<y.length;f++){if(m=y.start(f)-this.bufferPadding,l=y.end(f)+this.bufferPadding,T>=m&&c<=l)return!0;if(c<=m)return!1}return!1},S.onFragLoaded=function(T,c){var y=c.frag,m=c.part;if(!(y.sn==="initSegment"||y.bitrateTest||m)){var l=P(y);this.fragments[l]={body:y,loaded:c,buffered:!1,range:Object.create(null)}}},S.onBufferAppended=function(T,c){var y=this,m=c.frag,l=c.part,f=c.timeRanges;if(m.type===A.PlaylistLevelType.MAIN)if(this.activeFragment!==m&&(this.activeFragment=m,m.appendedPTS=void 0),l){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(l)}else this.activeParts=null;this.timeRanges=f,Object.keys(f).forEach(function(i){var g=f[i];if(y.detectEvictedFragments(i,g),!l&&m.type===A.PlaylistLevelType.MAIN){var s=m.elementaryStreams[i];if(!s)return;for(var r=0;r<g.length;r++){var o=g.end(r);o<=s.endPTS&&o>s.startPTS?m.appendedPTS=Math.max(o,m.appendedPTS||0):m.appendedPTS=s.endPTS}}})},S.onFragBuffered=function(T,c){this.detectPartialFragments(c)},S.hasFragment=function(T){var c=P(T);return!!this.fragments[c]},S.removeFragmentsInRange=function(T,c,y){var m=this;Object.keys(this.fragments).forEach(function(l){var f=m.fragments[l];if(f&&f.buffered){var a=f.body;a.type===y&&a.start<c&&a.end>T&&m.removeFragment(a)}})},S.removeFragment=function(T){var c=P(T);T.stats.loaded=0,T.clearElementaryStreamInfo(),T.appendedPTS=void 0,delete this.fragments[c],T.endList&&delete this.endListFragments[T.type]},S.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},L}();function k(L){var S,_;return L.buffered&&(((S=L.range.video)===null||S===void 0?void 0:S.partial)||((_=L.range.audio)===null||_===void 0?void 0:_.partial))}function P(L){return L.type+"_"+L.level+"_"+L.urlId+"_"+L.sn}},"./src/controller/gap-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{MAX_START_GAP_JUMP:()=>P,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>L,SKIP_BUFFER_RANGE_START:()=>S,STALL_MINIMUM_DURATION_MS:()=>k,default:()=>_});var F=x("./src/utils/buffer-helper.ts"),A=x("./src/errors.ts"),b=x("./src/events.ts"),I=x("./src/utils/logger.ts"),k=250,P=2,L=.1,S=.05,_=function(){function T(y,m,l,f){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=y,this.media=m,this.fragmentTracker=l,this.hls=f}var c=T.prototype;return c.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},c.poll=function(m,l){var f=this.config,a=this.media,i=this.stalled;if(a!==null){var g=a.currentTime,s=a.seeking,r=this.seeking&&!s,o=!this.seeking&&s;if(this.seeking=s,g!==m){if(this.moved=!0,i!==null){if(this.stallReported){var v=self.performance.now()-i;I.logger.warn("playback not stuck anymore @"+g+", after "+Math.round(v)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((o||r)&&(this.stalled=null),!(a.paused&&!s||a.ended||a.playbackRate===0||!F.BufferHelper.getBuffered(a).length)){var u=F.BufferHelper.bufferInfo(a,g,0),n=u.len>0,t=u.nextStart||0;if(!(!n&&!t)){if(s){var h=u.len>P,e=!t||l&&l.start<=g||t-g>P&&!this.fragmentTracker.getPartialFragment(g);if(h||e)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var d,p=Math.max(t,u.start||0)-g,E=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,D=E==null||(d=E.details)===null||d===void 0?void 0:d.live,R=D?E.details.targetduration*2:P;if(p>0&&p<=R){this._trySkipBufferHole(null);return}}var O=self.performance.now();if(i===null){this.stalled=O;return}var C=O-i;if(!(!s&&C>=k&&(this._reportStall(u),!this.media))){var M=F.BufferHelper.bufferInfo(a,g,f.maxBufferHole);this._tryFixBufferStall(M,C)}}}}},c._tryFixBufferStall=function(m,l){var f=this.config,a=this.fragmentTracker,i=this.media;if(i!==null){var g=i.currentTime,s=a.getPartialFragment(g);if(s){var r=this._trySkipBufferHole(s);if(r||!this.media)return}m.len>f.maxBufferHole&&l>f.highBufferWatchdogPeriod*1e3&&(I.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},c._reportStall=function(m){var l=this.hls,f=this.media,a=this.stallReported;!a&&f&&(this.stallReported=!0,I.logger.warn("Playback stalling at @"+f.currentTime+" due to low buffer ("+JSON.stringify(m)+")"),l.trigger(b.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:m.len}))},c._trySkipBufferHole=function(m){var l=this.config,f=this.hls,a=this.media;if(a===null)return 0;for(var i=a.currentTime,g=0,s=F.BufferHelper.getBuffered(a),r=0;r<s.length;r++){var o=s.start(r);if(i+l.maxBufferHole>=g&&i<o){var v=Math.max(o+S,a.currentTime+L);return I.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+v),this.moved=!0,this.stalled=null,a.currentTime=v,m&&f.trigger(b.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+v,frag:m}),v}g=s.end(r)}return 0},c._tryNudgeBuffer=function(){var m=this.config,l=this.hls,f=this.media,a=this.nudgeRetry;if(f!==null){var i=f.currentTime;if(this.nudgeRetry++,a<m.nudgeMaxRetry){var g=i+(a+1)*m.nudgeOffset;I.logger.warn("Nudging 'currentTime' from "+i+" to "+g),f.currentTime=g,l.trigger(b.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else I.logger.error("Playhead still not moving while enough data buffered @"+i+" after "+m.nudgeMaxRetry+" nudges"),l.trigger(b.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},T}()},"./src/controller/id3-track-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>m});var F=x("./src/polyfills/number.ts"),A=x("./src/events.ts"),b=x("./src/utils/texttrack-utils.ts"),I=x("./src/demux/id3.ts"),k=x("./src/loader/date-range.ts"),P=x("./src/types/demuxer.ts"),L=.25;function S(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var _=function(){var l=S();try{new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function T(l,f){return l.getTime()/1e3-f}function c(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var y=function(){function l(a){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=a,this._registerListeners()}var f=l.prototype;return f.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},f._registerListeners=function(){var i=this.hls;i.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(A.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),i.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},f._unregisterListeners=function(){var i=this.hls;i.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(A.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),i.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},f.onMediaAttached=function(i,g){this.media=g.media},f.onMediaDetaching=function(){this.id3Track&&((0,b.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},f.onManifestLoading=function(){this.dateRangeCuesAppended={}},f.createTrack=function(i){var g=this.getID3Track(i.textTracks);return g.mode="hidden",g},f.getID3Track=function(i){if(this.media){for(var g=0;g<i.length;g++){var s=i[g];if(s.kind==="metadata"&&s.label==="id3")return(0,b.sendAddTrackEvent)(s,this.media),s}return this.media.addTextTrack("metadata","id3")}},f.onFragParsingMetadata=function(i,g){if(this.media){var s=this.hls.config,r=s.enableEmsgMetadataCues,o=s.enableID3MetadataCues;if(!(!r&&!o)){var v=g.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var u=S(),n=0;n<v.length;n++){var t=v[n].type;if(!(t===P.MetadataSchema.emsg&&!r||!o)){var h=I.getID3Frames(v[n].data);if(h){var e=v[n].pts,d=e+v[n].duration;d>_&&(d=_);var p=d-e;p<=0&&(d=e+L);for(var E=0;E<h.length;E++){var D=h[E];if(!I.isTimeStampFrame(D)){this.updateId3CueEnds(e);var R=new u(e,d,"");R.value=D,t&&(R.type=t),this.id3Track.addCue(R)}}}}}}}},f.updateId3CueEnds=function(i){var g,s=(g=this.id3Track)===null||g===void 0?void 0:g.cues;if(s)for(var r=s.length;r--;){var o=s[r];o.startTime<i&&o.endTime===_&&(o.endTime=i)}},f.onBufferFlushing=function(i,g){var s=g.startOffset,r=g.endOffset,o=g.type,v=this.id3Track,u=this.hls;if(u){var n=u.config,t=n.enableEmsgMetadataCues,h=n.enableID3MetadataCues;if(v&&(t||h)){var e;o==="audio"?e=function(p){return p.type===P.MetadataSchema.audioId3&&h}:o==="video"?e=function(p){return p.type===P.MetadataSchema.emsg&&t}:e=function(p){return p.type===P.MetadataSchema.audioId3&&h||p.type===P.MetadataSchema.emsg&&t},(0,b.removeCuesInRange)(v,s,r,e)}}},f.onLevelUpdated=function(i,g){var s=this,r=g.details;if(!(!this.media||!r.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var o=this.dateRangeCuesAppended,v=this.id3Track,u=r.dateRanges,n=Object.keys(u);if(v)for(var t=Object.keys(o).filter(function(O){return!n.includes(O)}),h=function(C){var M=t[C];Object.keys(o[M].cues).forEach(function(U){v.removeCue(o[M].cues[U])}),delete o[M]},e=t.length;e--;)h(e);var d=r.fragments[r.fragments.length-1];if(!(n.length===0||!(0,F.isFiniteNumber)(d==null?void 0:d.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var p=d.programDateTime/1e3-d.start,E=S(),D=function(C){var M=n[C],U=u[M],B=o[M],N=(B==null?void 0:B.cues)||{},K=(B==null?void 0:B.durationKnown)||!1,W=T(U.startDate,p),G=_,j=U.endDate;if(j)G=T(j,p),K=!0;else if(U.endOnNext&&!K){var H=n.reduce(function(Z,J){var q=u[J];return q.class===U.class&&q.id!==J&&q.startDate>U.startDate&&Z.push(q),Z},[]).sort(function(Z,J){return Z.startDate.getTime()-J.startDate.getTime()})[0];H&&(G=T(H.startDate,p),K=!0)}for(var Y=Object.keys(U.attr),Q=0;Q<Y.length;Q++){var $=Y[Q];if(!($===k.DateRangeAttribute.ID||$===k.DateRangeAttribute.CLASS||$===k.DateRangeAttribute.START_DATE||$===k.DateRangeAttribute.DURATION||$===k.DateRangeAttribute.END_DATE||$===k.DateRangeAttribute.END_ON_NEXT)){var z=N[$];if(z)K&&!B.durationKnown&&(z.endTime=G);else{var X=U.attr[$];z=new E(W,G,""),($===k.DateRangeAttribute.SCTE35_OUT||$===k.DateRangeAttribute.SCTE35_IN)&&(X=c(X)),z.value={key:$,data:X},z.type=P.MetadataSchema.dateRange,s.id3Track.addCue(z),N[$]=z}}}o[M]={cues:N,dateRange:U,durationKnown:K}},R=0;R<n.length;R++)D(R)}}},l}();const m=y},"./src/controller/latency-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>S});var F=x("./src/errors.ts"),A=x("./src/events.ts"),b=x("./src/utils/logger.ts");function I(_,T){for(var c=0;c<T.length;c++){var y=T[c];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(_,P(y.key),y)}}function k(_,T,c){return T&&I(_.prototype,T),c&&I(_,c),Object.defineProperty(_,"prototype",{writable:!1}),_}function P(_){var T=L(_,"string");return typeof T=="symbol"?T:String(T)}function L(_,T){if(typeof _!="object"||_===null)return _;var c=_[Symbol.toPrimitive];if(c!==void 0){var y=c.call(_,T||"default");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(T==="string"?String:Number)(_)}var S=function(){function _(c){var y=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return y.timeupdate()},this.hls=c,this.config=c.config,this.registerListeners()}var T=_.prototype;return T.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},T.registerListeners=function(){this.hls.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(A.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){this.hls.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(A.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(A.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(A.Events.ERROR,this.onError)},T.onMediaAttached=function(y,m){this.media=m.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},T.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},T.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},T.onLevelUpdated=function(y,m){var l=m.details;this.levelDetails=l,l.advanced&&this.timeupdate(),!l.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},T.onError=function(y,m){m.details===F.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,b.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},T.timeupdate=function(){var y=this.media,m=this.levelDetails;if(!(!y||!m)){this.currentTime=y.currentTime;var l=this.computeLatency();if(l!==null){this._latency=l;var f=this.config,a=f.lowLatencyMode,i=f.maxLiveSyncPlaybackRate;if(!(!a||i===1)){var g=this.targetLatency;if(g!==null){var s=l-g,r=Math.min(this.maxLatency,g+m.targetduration),o=s<r;if(m.live&&o&&s>.05&&this.forwardBufferLength>1){var v=Math.min(2,Math.max(1,i)),u=Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20;y.playbackRate=Math.min(v,Math.max(1,u))}else y.playbackRate!==1&&y.playbackRate!==0&&(y.playbackRate=1)}}}}},T.estimateLiveEdge=function(){var y=this.levelDetails;return y===null?null:y.edge+y.age},T.computeLatency=function(){var y=this.estimateLiveEdge();return y===null?null:y-this.currentTime},k(_,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var y=this.config,m=this.levelDetails;return y.liveMaxLatencyDuration!==void 0?y.liveMaxLatencyDuration:m?y.liveMaxLatencyDurationCount*m.targetduration:0}},{key:"targetLatency",get:function(){var y=this.levelDetails;if(y===null)return null;var m=y.holdBack,l=y.partHoldBack,f=y.targetduration,a=this.config,i=a.liveSyncDuration,g=a.liveSyncDurationCount,s=a.lowLatencyMode,r=this.hls.userConfig,o=s&&l||m;(r.liveSyncDuration||r.liveSyncDurationCount||o===0)&&(o=i!==void 0?i:g*f);var v=f,u=1;return o+Math.min(this.stallCount*u,v)}},{key:"liveSyncPosition",get:function(){var y=this.estimateLiveEdge(),m=this.targetLatency,l=this.levelDetails;if(y===null||m===null||l===null)return null;var f=l.edge,a=y-m-this.edgeStalled,i=f-l.totalduration,g=f-(this.config.lowLatencyMode&&l.partTarget||l.targetduration);return Math.min(Math.max(i,a),g)}},{key:"drift",get:function(){var y=this.levelDetails;return y===null?1:y.drift}},{key:"edgeStalled",get:function(){var y=this.levelDetails;if(y===null)return 0;var m=(this.config.lowLatencyMode&&y.partTarget||y.targetduration)*3;return Math.max(y.age-m,0)}},{key:"forwardBufferLength",get:function(){var y=this.media,m=this.levelDetails;if(!y||!m)return 0;var l=y.buffered.length;return(l?y.buffered.end(l-1):m.edge)-this.currentTime}}]),_}()},"./src/controller/level-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>a});var F=x("./src/types/level.ts"),A=x("./src/events.ts"),b=x("./src/errors.ts"),I=x("./src/utils/codecs.ts"),k=x("./src/controller/level-helper.ts"),P=x("./src/controller/base-playlist-controller.ts"),L=x("./src/types/loader.ts");function S(){return S=Object.assign?Object.assign.bind():function(i){for(var g=1;g<arguments.length;g++){var s=arguments[g];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])}return i},S.apply(this,arguments)}function _(i,g){for(var s=0;s<g.length;s++){var r=g[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,c(r.key),r)}}function T(i,g,s){return g&&_(i.prototype,g),s&&_(i,s),Object.defineProperty(i,"prototype",{writable:!1}),i}function c(i){var g=y(i,"string");return typeof g=="symbol"?g:String(g)}function y(i,g){if(typeof i!="object"||i===null)return i;var s=i[Symbol.toPrimitive];if(s!==void 0){var r=s.call(i,g||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(i)}function m(i,g){i.prototype=Object.create(g.prototype),i.prototype.constructor=i,l(i,g)}function l(i,g){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},l(i,g)}var f=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),a=function(i){m(g,i);function g(r){var o;return o=i.call(this,r,"[level-controller]")||this,o._levels=[],o._firstLevel=-1,o._startLevel=void 0,o.currentLevelIndex=-1,o.manualLevelIndex=-1,o.onParsedComplete=void 0,o._registerListeners(),o}var s=g.prototype;return s._registerListeners=function(){var o=this.hls;o.on(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),o.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(A.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),o.on(A.Events.ERROR,this.onError,this)},s._unregisterListeners=function(){var o=this.hls;o.off(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),o.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(A.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),o.off(A.Events.ERROR,this.onError,this)},s.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,i.prototype.destroy.call(this)},s.startLoad=function(){var o=this._levels;o.forEach(function(v){v.loadError=0}),i.prototype.startLoad.call(this)},s.onManifestLoaded=function(o,v){var u=[],n=[],t=[],h,e={},d,p=!1,E=!1,D=!1;if(v.levels.forEach(function(M){var U=M.attrs;p=p||!!(M.width&&M.height),E=E||!!M.videoCodec,D=D||!!M.audioCodec,f&&M.audioCodec&&M.audioCodec.indexOf("mp4a.40.34")!==-1&&(M.audioCodec=void 0);var B=M.bitrate+"-"+M.attrs.RESOLUTION+"-"+M.attrs.CODECS;d=e[B],d?d.url.push(M.url):(d=new F.Level(M),e[B]=d,u.push(d)),U&&(U.AUDIO&&(0,k.addGroupId)(d,"audio",U.AUDIO),U.SUBTITLES&&(0,k.addGroupId)(d,"text",U.SUBTITLES))}),(p||E)&&D&&(u=u.filter(function(M){var U=M.videoCodec,B=M.width,N=M.height;return!!U||!!(B&&N)})),u=u.filter(function(M){var U=M.audioCodec,B=M.videoCodec;return(!U||(0,I.isCodecSupportedInMp4)(U,"audio"))&&(!B||(0,I.isCodecSupportedInMp4)(B,"video"))}),v.audioTracks&&(n=v.audioTracks.filter(function(M){return!M.audioCodec||(0,I.isCodecSupportedInMp4)(M.audioCodec,"audio")}),(0,k.assignTrackIdsByGroup)(n)),v.subtitles&&(t=v.subtitles,(0,k.assignTrackIdsByGroup)(t)),u.length>0){h=u[0].bitrate,u.sort(function(M,U){return M.attrs["HDCP-LEVEL"]!==U.attrs["HDCP-LEVEL"]?(M.attrs["HDCP-LEVEL"]||"")>(U.attrs["HDCP-LEVEL"]||"")?1:-1:M.bitrate!==U.bitrate?M.bitrate-U.bitrate:M.attrs.SCORE!==U.attrs.SCORE?M.attrs.decimalFloatingPoint("SCORE")-U.attrs.decimalFloatingPoint("SCORE"):p&&M.height!==U.height?M.height-U.height:0}),this._levels=u;for(var R=0;R<u.length;R++)if(u[R].bitrate===h){this._firstLevel=R,this.log("manifest loaded, "+u.length+" level(s) found, first bitrate: "+h);break}var O=D&&!E,C={levels:u,audioTracks:n,subtitleTracks:t,sessionData:v.sessionData,sessionKeys:v.sessionKeys,firstLevel:this._firstLevel,stats:v.stats,audio:D,video:E,altAudio:!O&&n.some(function(M){return!!M.url})};this.hls.trigger(A.Events.MANIFEST_PARSED,C),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(A.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:v.url,reason:"no level with compatible codecs found in manifest"})},s.onError=function(o,v){var u,n;if(i.prototype.onError.call(this,o,v),!v.fatal){var t=v.context,h=this._levels[this.currentLevelIndex];if(t&&(t.type===L.PlaylistContextType.AUDIO_TRACK&&h.audioGroupIds&&t.groupId===h.audioGroupIds[h.urlId]||t.type===L.PlaylistContextType.SUBTITLE_TRACK&&h.textGroupIds&&t.groupId===h.textGroupIds[h.urlId])){this.redundantFailover(this.currentLevelIndex);return}var e=!1,d=!0,p;switch(v.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:if(v.frag){var E=v.frag.type===L.PlaylistLevelType.MAIN?v.frag.level:this.currentLevelIndex,D=this._levels[E];D?(D.fragmentError++,D.fragmentError>this.hls.config.fragLoadingMaxRetry&&(p=E)):p=E}break;case b.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var R=h.attrs["HDCP-LEVEL"];R&&(this.hls.maxHdcpLevel=F.HdcpLevels[F.HdcpLevels.indexOf(R)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'))}case b.ErrorDetails.FRAG_PARSING_ERROR:case b.ErrorDetails.KEY_SYSTEM_NO_SESSION:p=((u=v.frag)===null||u===void 0?void 0:u.type)===L.PlaylistLevelType.MAIN?v.frag.level:this.currentLevelIndex,v.levelRetry=!1;break;case b.ErrorDetails.LEVEL_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:t&&(t.deliveryDirectives&&(d=!1),p=t.level),e=!0;break;case b.ErrorDetails.REMUX_ALLOC_ERROR:p=(n=v.level)!=null?n:this.currentLevelIndex,e=!0;break}p!==void 0&&this.recoverLevel(v,p,e,d)}},s.recoverLevel=function(o,v,u,n){var t=o.details,h=this._levels[v];if(h.loadError++,u){var e=this.retryLoadingOrFail(o);if(e)o.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(n){var d=h.url.length;if(d>1&&h.loadError<d)o.levelRetry=!0,this.redundantFailover(v);else if(this.manualLevelIndex===-1){for(var p=-1,E=this._levels,D=E.length;D--;){var R=(D+this.currentLevelIndex)%E.length;if(R!==this.currentLevelIndex&&E[R].loadError===0){p=R;break}}p>-1&&this.currentLevelIndex!==p?(this.warn(t+": switch to "+p),o.levelRetry=!0,this.hls.nextAutoLevel=p):o.levelRetry===!1&&(o.fatal=!0)}}},s.redundantFailover=function(o){var v=this._levels[o],u=v.url.length;if(u>1){var n=(v.urlId+1)%u;this.warn("Switching to redundant URL-id "+n),this._levels.forEach(function(t){t.urlId=n}),this.level=o}},s.onFragLoaded=function(o,v){var u=v.frag;if(u!==void 0&&u.type===L.PlaylistLevelType.MAIN){var n=this._levels[u.level];n!==void 0&&(n.fragmentError=0,n.loadError=0)}},s.onLevelLoaded=function(o,v){var u,n=v.level,t=v.details,h=this._levels[n];if(!h){var e;this.warn("Invalid level index "+n),(e=v.deliveryDirectives)!==null&&e!==void 0&&e.skip&&(t.deltaUpdateFailed=!0);return}n===this.currentLevelIndex?(h.fragmentError===0&&(h.loadError=0,this.retryCount=0),this.playlistLoaded(n,v,h.details)):(u=v.deliveryDirectives)!==null&&u!==void 0&&u.skip&&(t.deltaUpdateFailed=!0)},s.onAudioTrackSwitched=function(o,v){var u=this.hls.levels[this.currentLevelIndex];if(u&&u.audioGroupIds){for(var n=-1,t=this.hls.audioTracks[v.id].groupId,h=0;h<u.audioGroupIds.length;h++)if(u.audioGroupIds[h]===t){n=h;break}n!==u.urlId&&(u.urlId=n,this.startLoad())}},s.loadPlaylist=function(o){i.prototype.loadPlaylist.call(this);var v=this.currentLevelIndex,u=this._levels[v];if(this.canLoad&&u&&u.url.length>0){var n=u.urlId,t=u.url[n];if(o)try{t=o.addDirectives(t)}catch(h){this.warn("Could not construct new URL with HLS Delivery Directives: "+h)}this.log("Attempt loading level index "+v+(o?" at sn "+o.msn+" part "+o.part:"")+" with URL-id "+n+" "+t),this.clearTimer(),this.hls.trigger(A.Events.LEVEL_LOADING,{url:t,level:v,id:n,deliveryDirectives:o||null})}},s.removeLevel=function(o,v){var u=function(h,e){return e!==v},n=this._levels.filter(function(t,h){return h!==o?!0:t.url.length>1&&v!==void 0?(t.url=t.url.filter(u),t.audioGroupIds&&(t.audioGroupIds=t.audioGroupIds.filter(u)),t.textGroupIds&&(t.textGroupIds=t.textGroupIds.filter(u)),t.urlId=0,!0):!1}).map(function(t,h){var e=t.details;return e!=null&&e.fragments&&e.fragments.forEach(function(d){d.level=h}),t});this._levels=n,this.hls.trigger(A.Events.LEVELS_UPDATED,{levels:n})},T(g,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(o){var v,u=this._levels;if(u.length!==0&&!(this.currentLevelIndex===o&&(v=u[o])!==null&&v!==void 0&&v.details)){if(o<0||o>=u.length){var n=o<0;if(this.hls.trigger(A.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.LEVEL_SWITCH_ERROR,level:o,fatal:n,reason:"invalid level idx"}),n)return;o=Math.min(o,u.length-1)}this.clearTimer();var t=this.currentLevelIndex,h=u[t],e=u[o];this.log("switching to level "+o+" from "+t),this.currentLevelIndex=o;var d=S({},e,{level:o,maxBitrate:e.maxBitrate,uri:e.uri,urlId:e.urlId});delete d._urlId,this.hls.trigger(A.Events.LEVEL_SWITCHING,d);var p=e.details;if(!p||p.live){var E=this.switchParams(e.uri,h==null?void 0:h.details);this.loadPlaylist(E)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(o){this.manualLevelIndex=o,this._startLevel===void 0&&(this._startLevel=o),o!==-1&&(this.level=o)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(o){this._firstLevel=o}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var o=this.hls.config.startLevel;return o!==void 0?o:this._firstLevel}else return this._startLevel},set:function(o){this._startLevel=o}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(o){this.level=o,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=o)}}]),g}(P.default)},"./src/controller/level-helper.ts":(V,w,x)=>{x.r(w),x.d(w,{addGroupId:()=>k,addSliding:()=>f,adjustSliding:()=>l,assignTrackIdsByGroup:()=>P,computeReloadInterval:()=>a,getFragmentWithSN:()=>i,getPartWith:()=>g,mapFragmentIntersection:()=>m,mapPartIntersection:()=>y,mergeDetails:()=>T,updateFragPTSDTS:()=>_,updatePTS:()=>L});var F=x("./src/polyfills/number.ts"),A=x("./src/utils/logger.ts"),b=x("./src/loader/date-range.ts");function I(){return I=Object.assign?Object.assign.bind():function(s){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&(s[v]=o[v])}return s},I.apply(this,arguments)}function k(s,r,o){switch(r){case"audio":s.audioGroupIds||(s.audioGroupIds=[]),s.audioGroupIds.push(o);break;case"text":s.textGroupIds||(s.textGroupIds=[]),s.textGroupIds.push(o);break}}function P(s){var r={};s.forEach(function(o){var v=o.groupId||"";o.id=r[v]=r[v]||0,r[v]++})}function L(s,r,o){var v=s[r],u=s[o];S(v,u)}function S(s,r){var o=r.startPTS;if((0,F.isFiniteNumber)(o)){var v=0,u;r.sn>s.sn?(v=o-s.start,u=s):(v=s.start-o,u=r),u.duration!==v&&(u.duration=v)}else if(r.sn>s.sn){var n=s.cc===r.cc;n&&s.minEndPTS?r.start=s.start+(s.minEndPTS-s.start):r.start=s.start+s.duration}else r.start=Math.max(s.start-r.duration,0)}function _(s,r,o,v,u,n){var t=v-o;t<=0&&(A.logger.warn("Fragment should have a positive duration",r),v=o+r.duration,n=u+r.duration);var h=o,e=v,d=r.startPTS,p=r.endPTS;if((0,F.isFiniteNumber)(d)){var E=Math.abs(d-o);(0,F.isFiniteNumber)(r.deltaPTS)?r.deltaPTS=Math.max(E,r.deltaPTS):r.deltaPTS=E,h=Math.max(o,d),o=Math.min(o,d),u=Math.min(u,r.startDTS),e=Math.min(v,p),v=Math.max(v,p),n=Math.max(n,r.endDTS)}r.duration=v-o;var D=o-r.start;r.start=r.startPTS=o,r.maxStartPTS=h,r.startDTS=u,r.endPTS=v,r.minEndPTS=e,r.endDTS=n;var R=r.sn;if(!s||R<s.startSN||R>s.endSN)return 0;var O,C=R-s.startSN,M=s.fragments;for(M[C]=r,O=C;O>0;O--)S(M[O],M[O-1]);for(O=C;O<M.length-1;O++)S(M[O],M[O+1]);return s.fragmentHint&&S(M[M.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,D}function T(s,r){for(var o=null,v=s.fragments,u=v.length-1;u>=0;u--){var n=v[u].initSegment;if(n){o=n;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;var t=0,h;if(m(s,r,function(O,C){O.relurl&&(t=O.cc-C.cc),(0,F.isFiniteNumber)(O.startPTS)&&(0,F.isFiniteNumber)(O.endPTS)&&(C.start=C.startPTS=O.startPTS,C.startDTS=O.startDTS,C.appendedPTS=O.appendedPTS,C.maxStartPTS=O.maxStartPTS,C.endPTS=O.endPTS,C.endDTS=O.endDTS,C.minEndPTS=O.minEndPTS,C.duration=O.endPTS-O.startPTS,C.duration&&(h=C),r.PTSKnown=r.alignedSliding=!0),C.elementaryStreams=O.elementaryStreams,C.loader=O.loader,C.stats=O.stats,C.urlId=O.urlId,O.initSegment&&(C.initSegment=O.initSegment,o=O.initSegment)}),o){var e=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;e.forEach(function(O){var C;(!O.initSegment||O.initSegment.relurl===((C=o)===null||C===void 0?void 0:C.relurl))&&(O.initSegment=o)})}if(r.skippedSegments)if(r.deltaUpdateFailed=r.fragments.some(function(O){return!O}),r.deltaUpdateFailed){A.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var d=r.skippedSegments;d--;)r.fragments.shift();r.startSN=r.fragments[0].sn,r.startCC=r.fragments[0].cc}else r.canSkipDateRanges&&(r.dateRanges=c(s.dateRanges,r.dateRanges,r.recentlyRemovedDateranges));var p=r.fragments;if(t){A.logger.warn("discontinuity sliding from playlist, take drift into account");for(var E=0;E<p.length;E++)p[E].cc+=t}r.skippedSegments&&(r.startCC=r.fragments[0].cc),y(s.partList,r.partList,function(O,C){C.elementaryStreams=O.elementaryStreams,C.stats=O.stats}),h?_(r,h,h.startPTS,h.endPTS,h.startDTS,h.endDTS):l(s,r),p.length&&(r.totalduration=r.edge-p[0].start),r.driftStartTime=s.driftStartTime,r.driftStart=s.driftStart;var D=r.advancedDateTime;if(r.advanced&&D){var R=r.edge;r.driftStart||(r.driftStartTime=D,r.driftStart=R),r.driftEndTime=D,r.driftEnd=R}else r.driftEndTime=s.driftEndTime,r.driftEnd=s.driftEnd,r.advancedDateTime=s.advancedDateTime}function c(s,r,o){var v=I({},s);return o&&o.forEach(function(u){delete v[u]}),Object.keys(r).forEach(function(u){var n=new b.DateRange(r[u].attr,v[u]);n.isValid?v[u]=n:A.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(r[u].attr)+'"')}),v}function y(s,r,o){if(s&&r)for(var v=0,u=0,n=s.length;u<=n;u++){var t=s[u],h=r[u+v];t&&h&&t.index===h.index&&t.fragment.sn===h.fragment.sn?o(t,h):v--}}function m(s,r,o){for(var v=r.skippedSegments,u=Math.max(s.startSN,r.startSN)-r.startSN,n=(s.fragmentHint?1:0)+(v?r.endSN:Math.min(s.endSN,r.endSN))-r.startSN,t=r.startSN-s.startSN,h=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,e=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,d=u;d<=n;d++){var p=e[t+d],E=h[d];v&&!E&&d<v&&(E=r.fragments[d]=p),p&&E&&o(p,E)}}function l(s,r){var o=r.startSN+r.skippedSegments-s.startSN,v=s.fragments;o<0||o>=v.length||f(r,v[o].start)}function f(s,r){if(r){for(var o=s.fragments,v=s.skippedSegments;v<o.length;v++)o[v].start+=r;s.fragmentHint&&(s.fragmentHint.start+=r)}}function a(s,r){r===void 0&&(r=1/0);var o=1e3*s.targetduration;if(s.updated){var v=s.fragments,u=4;if(v.length&&o*u>r){var n=v[v.length-1].duration*1e3;n<o&&(o=n)}}else o/=2;return Math.round(o)}function i(s,r,o){if(!s||!s.details)return null;var v=s.details,u=v.fragments[r-v.startSN];return u||(u=v.fragmentHint,u&&u.sn===r)?u:r<v.startSN&&o&&o.sn===r?o:null}function g(s,r,o){if(!s||!s.details)return null;var v=s.details.partList;if(v)for(var u=v.length;u--;){var n=v[u];if(n.index===o&&n.fragment.sn===r)return n}return null}},"./src/controller/stream-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>r});var F=x("./src/polyfills/number.ts"),A=x("./src/controller/base-stream-controller.ts"),b=x("./src/is-supported.ts"),I=x("./src/events.ts"),k=x("./src/utils/buffer-helper.ts"),P=x("./src/controller/fragment-tracker.ts"),L=x("./src/types/loader.ts"),S=x("./src/loader/fragment.ts"),_=x("./src/demux/transmuxer-interface.ts"),T=x("./src/types/transmuxer.ts"),c=x("./src/controller/gap-controller.ts"),y=x("./src/errors.ts");function m(o,v){for(var u=0;u<v.length;u++){var n=v[u];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,f(n.key),n)}}function l(o,v,u){return v&&m(o.prototype,v),u&&m(o,u),Object.defineProperty(o,"prototype",{writable:!1}),o}function f(o){var v=a(o,"string");return typeof v=="symbol"?v:String(v)}function a(o,v){if(typeof o!="object"||o===null)return o;var u=o[Symbol.toPrimitive];if(u!==void 0){var n=u.call(o,v||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(v==="string"?String:Number)(o)}function i(o,v){o.prototype=Object.create(v.prototype),o.prototype.constructor=o,g(o,v)}function g(o,v){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},g(o,v)}var s=100,r=function(o){i(v,o);function v(n,t,h){var e;return e=o.call(this,n,t,h,"[stream-controller]")||this,e.audioCodecSwap=!1,e.gapController=null,e.level=-1,e._forceStartLoad=!1,e.altAudio=!1,e.audioOnly=!1,e.fragPlaying=null,e.onvplaying=null,e.onvseeked=null,e.fragLastKbps=0,e.couldBacktrack=!1,e.backtrackFragment=null,e.audioCodecSwitch=!1,e.videoBuffer=null,e._registerListeners(),e}var u=v.prototype;return u._registerListeners=function(){var t=this.hls;t.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(I.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(I.Events.ERROR,this.onError,this),t.on(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(I.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u._unregisterListeners=function(){var t=this.hls;t.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(I.Events.ERROR,this.onError,this),t.off(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(I.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},u.startLoad=function(t){if(this.levels){var h=this.lastCurrentTime,e=this.hls;if(this.stopLoad(),this.setInterval(s),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=e.startLevel;d===-1&&(e.config.testBandwidth&&this.levels.length>1?(d=0,this.bitrateTest=!0):d=e.nextAutoLevel),this.level=e.nextLoadLevel=d,this.loadedmetadata=!1}h>0&&t===-1&&(this.log("Override startPosition with lastCurrentTime @"+h.toFixed(3)),t=h),this.state=A.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=A.State.STOPPED},u.stopLoad=function(){this._forceStartLoad=!1,o.prototype.stopLoad.call(this)},u.doTick=function(){switch(this.state){case A.State.IDLE:this.doTickIdle();break;case A.State.WAITING_LEVEL:{var t,h=this.levels,e=this.level,d=h==null||(t=h[e])===null||t===void 0?void 0:t.details;if(d&&(!d.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(d))break;this.state=A.State.IDLE;break}break}case A.State.FRAG_LOADING_WAITING_RETRY:{var p,E=self.performance.now(),D=this.retryDate;(!D||E>=D||(p=this.media)!==null&&p!==void 0&&p.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=A.State.IDLE)}break}this.onTickEnd()},u.onTickEnd=function(){o.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},u.doTickIdle=function(){var t=this.hls,h=this.levelLastLoaded,e=this.levels,d=this.media,p=t.config,E=t.nextLoadLevel;if(!(h===null||!d&&(this.startFragRequested||!p.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!e||!e[E])){var D=e[E],R=this.getMainFwdBufferInfo();if(R!==null){var O=this.getLevelDetails();if(O&&this._streamEnded(R,O)){var C={};this.altAudio&&(C.type="video"),this.hls.trigger(I.Events.BUFFER_EOS,C),this.state=A.State.ENDED;return}this.level=t.nextLoadLevel=E;var M=D.details;if(!M||this.state===A.State.WAITING_LEVEL||M.live&&this.levelLastLoaded!==E){this.level=E,this.state=A.State.WAITING_LEVEL;return}var U=R.len,B=this.getMaxBufferLength(D.maxBitrate);if(!(U>=B)){this.backtrackFragment&&this.backtrackFragment.start>R.end&&(this.backtrackFragment=null);var N=this.backtrackFragment?this.backtrackFragment.start:R.end,K=this.getNextFragment(N,M);if(this.couldBacktrack&&!this.fragPrevious&&K&&K.sn!=="initSegment"&&this.fragmentTracker.getState(K)!==P.FragmentState.OK){var W,G=((W=this.backtrackFragment)!=null?W:K).sn,j=G-M.startSN,H=M.fragments[j-1];H&&K.cc===H.cc&&(K=H,this.fragmentTracker.removeFragment(H))}else this.backtrackFragment&&R.len&&(this.backtrackFragment=null);if(K&&this.fragmentTracker.getState(K)===P.FragmentState.OK&&this.nextLoadPosition>N){var Y=this.audioOnly&&!this.altAudio?S.ElementaryStreamTypes.AUDIO:S.ElementaryStreamTypes.VIDEO,Q=(Y===S.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;Q&&this.afterBufferFlushed(Q,Y,L.PlaylistLevelType.MAIN),K=this.getNextFragment(this.nextLoadPosition,M)}K&&(K.initSegment&&!K.initSegment.data&&!this.bitrateTest&&(K=K.initSegment),this.loadFragment(K,M,N))}}}},u.loadFragment=function(t,h,e){var d,p=this.fragmentTracker.getState(t);this.fragCurrent=t,p===P.FragmentState.NOT_LOADED?t.sn==="initSegment"?this._loadInitSegment(t,h):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,h)):(this.startFragRequested=!0,o.prototype.loadFragment.call(this,t,h,e)):p===P.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):((d=this.media)===null||d===void 0?void 0:d.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},u.getAppendedFrag=function(t){var h=this.fragmentTracker.getAppendedFrag(t,L.PlaylistLevelType.MAIN);return h&&"fragment"in h?h.fragment:h},u.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,L.PlaylistLevelType.MAIN)},u.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},u.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},u.nextLevelSwitch=function(){var t=this.levels,h=this.media;if(h!=null&&h.readyState){var e,d=this.getAppendedFrag(h.currentTime);if(d&&d.start>1&&this.flushMainBuffer(0,d.start-1),!h.paused&&t){var p=this.hls.nextLoadLevel,E=t[p],D=this.fragLastKbps;D&&this.fragCurrent?e=this.fragCurrent.duration*E.maxBitrate/(1e3*D)+1:e=0}else e=0;var R=this.getBufferedFrag(h.currentTime+e);if(R){var O=this.followingBufferedFrag(R);if(O){this.abortCurrentFrag();var C=O.maxStartPTS?O.maxStartPTS:O.start,M=O.duration,U=Math.max(R.end,C+Math.min(Math.max(M-this.config.maxFragLookUpTolerance,M*.5),M*.75));this.flushMainBuffer(U,Number.POSITIVE_INFINITY)}}}},u.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&t.abortRequests(),this.state){case A.State.KEY_LOADING:case A.State.FRAG_LOADING:case A.State.FRAG_LOADING_WAITING_RETRY:case A.State.PARSING:case A.State.PARSED:this.state=A.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},u.flushMainBuffer=function(t,h){o.prototype.flushMainBuffer.call(this,t,h,this.altAudio?"video":null)},u.onMediaAttached=function(t,h){o.prototype.onMediaAttached.call(this,t,h);var e=h.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),e.addEventListener("playing",this.onvplaying),e.addEventListener("seeked",this.onvseeked),this.gapController=new c.default(this.config,e,this.fragmentTracker,this.hls)},u.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),o.prototype.onMediaDetaching.call(this)},u.onMediaPlaying=function(){this.tick()},u.onMediaSeeked=function(){var t=this.media,h=t?t.currentTime:null;(0,F.isFiniteNumber)(h)&&this.log("Media seeked to "+h.toFixed(3)),this.tick()},u.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(I.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},u.onManifestParsed=function(t,h){var e=!1,d=!1,p;h.levels.forEach(function(E){p=E.audioCodec,p&&(p.indexOf("mp4a.40.2")!==-1&&(e=!0),p.indexOf("mp4a.40.5")!==-1&&(d=!0))}),this.audioCodecSwitch=e&&d&&!(0,b.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=h.levels,this.startFragRequested=!1},u.onLevelLoading=function(t,h){var e=this.levels;if(!(!e||this.state!==A.State.IDLE)){var d=e[h.level];(!d.details||d.details.live&&this.levelLastLoaded!==h.level||this.waitForCdnTuneIn(d.details))&&(this.state=A.State.WAITING_LEVEL)}},u.onLevelLoaded=function(t,h){var e,d=this.levels,p=h.level,E=h.details,D=E.totalduration;if(!d){this.warn("Levels were reset while loading level "+p);return}this.log("Level "+p+" loaded ["+E.startSN+","+E.endSN+"], cc ["+E.startCC+", "+E.endCC+"] duration:"+D);var R=this.fragCurrent;R&&(this.state===A.State.FRAG_LOADING||this.state===A.State.FRAG_LOADING_WAITING_RETRY)&&R.level!==h.level&&R.loader&&(this.state=A.State.IDLE,this.backtrackFragment=null,R.abortRequests());var O=d[p],C=0;if(E.live||(e=O.details)!==null&&e!==void 0&&e.live){if(E.fragments[0]||(E.deltaUpdateFailed=!0),E.deltaUpdateFailed)return;C=this.alignPlaylists(E,O.details)}if(O.details=E,this.levelLastLoaded=p,this.hls.trigger(I.Events.LEVEL_UPDATED,{details:E,level:p}),this.state===A.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(E))return;this.state=A.State.IDLE}this.startFragRequested?E.live&&this.synchronizeToLiveEdge(E):this.setStartPosition(E,C),this.tick()},u._handleFragmentLoadProgress=function(t){var h,e=t.frag,d=t.part,p=t.payload,E=this.levels;if(!E){this.warn("Levels were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered");return}var D=E[e.level],R=D.details;if(!R){this.warn("Dropping fragment "+e.sn+" of level "+e.level+" after level details were reset");return}var O=D.videoCodec,C=R.PTSKnown||!R.live,M=(h=e.initSegment)===null||h===void 0?void 0:h.data,U=this._getAudioCodec(D),B=this.transmuxer=this.transmuxer||new _.default(this.hls,L.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),N=d?d.index:-1,K=N!==-1,W=new T.ChunkMetadata(e.level,e.sn,e.stats.chunkCount,p.byteLength,N,K),G=this.initPTS[e.cc];B.push(p,M,U,O,e,d,R.totalduration,C,W,G)},u.onAudioTrackSwitching=function(t,h){var e=this.altAudio,d=!!h.url,p=h.id;if(!d){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var E=this.fragCurrent;E&&(this.log("Switching to main audio track, cancel main fragment load"),E.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var D=this.hls;e&&D.trigger(I.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),D.trigger(I.Events.AUDIO_TRACK_SWITCHED,{id:p})}},u.onAudioTrackSwitched=function(t,h){var e=h.id,d=!!this.hls.audioTracks[e].url;if(d){var p=this.videoBuffer;p&&this.mediaBuffer!==p&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=p)}this.altAudio=d,this.tick()},u.onBufferCreated=function(t,h){var e=h.tracks,d,p,E=!1;for(var D in e){var R=e[D];if(R.id==="main"){if(p=D,d=R,D==="video"){var O=e[D];O&&(this.videoBuffer=O.buffer)}}else E=!0}E&&d?(this.log("Alternate track found, use "+p+".buffered to schedule main fragment loading"),this.mediaBuffer=d.buffer):this.mediaBuffer=this.media},u.onFragBuffered=function(t,h){var e=h.frag,d=h.part;if(!(e&&e.type!==L.PlaylistLevelType.MAIN)){if(this.fragContextChanged(e)){this.warn("Fragment "+e.sn+(d?" p: "+d.index:"")+" of level "+e.level+" finished buffering, but was aborted. state: "+this.state),this.state===A.State.PARSED&&(this.state=A.State.IDLE);return}var p=d?d.stats:e.stats;this.fragLastKbps=Math.round(8*p.total/(p.buffering.end-p.loading.first)),e.sn!=="initSegment"&&(this.fragPrevious=e),this.fragBufferedComplete(e,d)}},u.onError=function(t,h){if(h.type===y.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(L.PlaylistLevelType.MAIN,h);return}switch(h.details){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:case y.ErrorDetails.FRAG_PARSING_ERROR:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(L.PlaylistLevelType.MAIN,h);break;case y.ErrorDetails.LEVEL_LOAD_ERROR:case y.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==A.State.ERROR&&(h.fatal?(this.warn(""+h.details),this.state=A.State.ERROR):!h.levelRetry&&this.state===A.State.WAITING_LEVEL&&(this.state=A.State.IDLE));break;case y.ErrorDetails.BUFFER_FULL_ERROR:if(h.parent==="main"&&(this.state===A.State.PARSING||this.state===A.State.PARSED)){var e=!0,d=this.getFwdBufferInfo(this.media,L.PlaylistLevelType.MAIN);d&&d.len>.5&&(e=!this.reduceMaxBufferLength(d.len)),e&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},u.checkBuffer=function(){var t=this.media,h=this.gapController;if(!(!t||!h||!t.readyState)){if(this.loadedmetadata||!k.BufferHelper.getBuffered(t).length){var e=this.state!==A.State.IDLE?this.fragCurrent:null;h.poll(this.lastCurrentTime,e)}this.lastCurrentTime=t.currentTime}},u.onFragLoadEmergencyAborted=function(){this.state=A.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},u.onBufferFlushed=function(t,h){var e=h.type;if(e!==S.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var d=(e===S.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(d,e,L.PlaylistLevelType.MAIN)}},u.onLevelsUpdated=function(t,h){this.levels=h.levels},u.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},u.seekToStartPos=function(){var t=this.media;if(t){var h=t.currentTime,e=this.startPosition;if(e>=0&&h<e){if(t.seeking){this.log("could not seek to "+e+", already seeking at "+h);return}var d=k.BufferHelper.getBuffered(t),p=d.length?d.start(0):0,E=p-e;E>0&&(E<this.config.maxBufferHole||E<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+E+" to match buffer start"),e+=E,this.startPosition=e),this.log("seek to target start position "+e+" from current time "+h),t.currentTime=e}}},u._getAudioCodec=function(t){var h=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&h&&(this.log("Swapping audio codec"),h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5"),h},u._loadBitrateTestFrag=function(t,h){var e=this;t.bitrateTest=!0,this._doFragLoad(t,h).then(function(d){var p=e.hls;if(!(!d||p.nextLoadLevel||e.fragContextChanged(t))){e.fragLoadError=0,e.state=A.State.IDLE,e.startFragRequested=!1,e.bitrateTest=!1;var E=t.stats;E.parsing.start=E.parsing.end=E.buffering.start=E.buffering.end=self.performance.now(),p.trigger(I.Events.FRAG_LOADED,d),t.bitrateTest=!1}})},u._handleTransmuxComplete=function(t){var h,e="main",d=this.hls,p=t.remuxResult,E=t.chunkMeta,D=this.getCurrentContext(E);if(!D){this.warn("The loading context changed while buffering fragment "+E.sn+" of level "+E.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(E.level);return}var R=D.frag,O=D.part,C=D.level,M=p.video,U=p.text,B=p.id3,N=p.initSegment,K=C.details,W=this.altAudio?void 0:p.audio;if(!this.fragContextChanged(R)){if(this.state=A.State.PARSING,N){N.tracks&&(this._bufferInitSegment(C,N.tracks,R,E),d.trigger(I.Events.FRAG_PARSING_INIT_SEGMENT,{frag:R,id:e,tracks:N.tracks}));var G=N.initPTS,j=N.timescale;(0,F.isFiniteNumber)(G)&&(this.initPTS[R.cc]=G,d.trigger(I.Events.INIT_PTS_FOUND,{frag:R,id:e,initPTS:G,timescale:j}))}if(M&&p.independent!==!1){if(K){var H=M.startPTS,Y=M.endPTS,Q=M.startDTS,$=M.endDTS;if(O)O.elementaryStreams[M.type]={startPTS:H,endPTS:Y,startDTS:Q,endDTS:$};else if(M.firstKeyFrame&&M.independent&&E.id===1&&(this.couldBacktrack=!0),M.dropped&&M.independent){var z=this.getMainFwdBufferInfo(),X=(z?z.end:this.getLoadPosition())+this.config.maxBufferHole,Z=M.firstKeyFramePTS?M.firstKeyFramePTS:H;if(X<Z-this.config.maxBufferHole){this.backtrack(R);return}R.setElementaryStreamInfo(M.type,R.start,Y,R.start,$,!0)}R.setElementaryStreamInfo(M.type,H,Y,Q,$),this.backtrackFragment&&(this.backtrackFragment=R),this.bufferFragmentData(M,R,O,E)}}else if(p.independent===!1){this.backtrack(R);return}if(W){var J=W.startPTS,q=W.endPTS,ae=W.startDTS,te=W.endDTS;O&&(O.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:J,endPTS:q,startDTS:ae,endDTS:te}),R.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,J,q,ae,te),this.bufferFragmentData(W,R,O,E)}if(K&&B!==null&&B!==void 0&&(h=B.samples)!==null&&h!==void 0&&h.length){var ne={id:e,frag:R,details:K,samples:B.samples};d.trigger(I.Events.FRAG_PARSING_METADATA,ne)}if(K&&U){var ee={id:e,frag:R,details:K,samples:U.samples};d.trigger(I.Events.FRAG_PARSING_USERDATA,ee)}}},u._bufferInitSegment=function(t,h,e,d){var p=this;if(this.state===A.State.PARSING){this.audioOnly=!!h.audio&&!h.video,this.altAudio&&!this.audioOnly&&delete h.audio;var E=h.audio,D=h.video,R=h.audiovideo;if(E){var O=t.audioCodec,C=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(O&&(O.indexOf("mp4a.40.5")!==-1?O="mp4a.40.2":O="mp4a.40.5"),E.metadata.channelCount!==1&&C.indexOf("firefox")===-1&&(O="mp4a.40.5")),C.indexOf("android")!==-1&&E.container!=="audio/mpeg"&&(O="mp4a.40.2",this.log("Android: force audio codec to "+O)),t.audioCodec&&t.audioCodec!==O&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+O+'"'),E.levelCodec=O,E.id="main",this.log("Init audio buffer, container:"+E.container+", codecs[selected/level/parsed]=["+(O||"")+"/"+(t.audioCodec||"")+"/"+E.codec+"]")}D&&(D.levelCodec=t.videoCodec,D.id="main",this.log("Init video buffer, container:"+D.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+D.codec+"]")),R&&this.log("Init audiovideo buffer, container:"+R.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+R.codec+"]"),this.hls.trigger(I.Events.BUFFER_CODECS,h),Object.keys(h).forEach(function(M){var U=h[M],B=U.initSegment;B!=null&&B.byteLength&&p.hls.trigger(I.Events.BUFFER_APPENDING,{type:M,data:B,frag:e,part:null,chunkMeta:d,parent:e.type})}),this.tick()}},u.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,L.PlaylistLevelType.MAIN)},u.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=A.State.IDLE},u.checkFragmentChanged=function(){var t=this.media,h=null;if(t&&t.readyState>1&&t.seeking===!1){var e=t.currentTime;if(k.BufferHelper.isBuffered(t,e)?h=this.getAppendedFrag(e):k.BufferHelper.isBuffered(t,e+.1)&&(h=this.getAppendedFrag(e+.1)),h){this.backtrackFragment=null;var d=this.fragPlaying,p=h.level;(!d||h.sn!==d.sn||d.level!==p||h.urlId!==d.urlId)&&(this.fragPlaying=h,this.hls.trigger(I.Events.FRAG_CHANGED,{frag:h}),(!d||d.level!==p)&&this.hls.trigger(I.Events.LEVEL_SWITCHED,{level:p}))}}},l(v,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var h=t.currentTime,e=this.currentFrag;if(e&&(0,F.isFiniteNumber)(h)&&(0,F.isFiniteNumber)(e.programDateTime)){var d=e.programDateTime+(h-e.start)*1e3;return new Date(d)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),v}(A.default)},"./src/controller/subtitle-stream-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{SubtitleStreamController:()=>i});var F=x("./src/events.ts"),A=x("./src/utils/buffer-helper.ts"),b=x("./src/controller/fragment-finders.ts"),I=x("./src/utils/discontinuities.ts"),k=x("./src/controller/level-helper.ts"),P=x("./src/controller/fragment-tracker.ts"),L=x("./src/controller/base-stream-controller.ts"),S=x("./src/types/loader.ts"),_=x("./src/types/level.ts");function T(s,r){for(var o=0;o<r.length;o++){var v=r[o];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(s,y(v.key),v)}}function c(s,r,o){return r&&T(s.prototype,r),o&&T(s,o),Object.defineProperty(s,"prototype",{writable:!1}),s}function y(s){var r=m(s,"string");return typeof r=="symbol"?r:String(r)}function m(s,r){if(typeof s!="object"||s===null)return s;var o=s[Symbol.toPrimitive];if(o!==void 0){var v=o.call(s,r||"default");if(typeof v!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(s)}function l(s,r){s.prototype=Object.create(r.prototype),s.prototype.constructor=s,f(s,r)}function f(s,r){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,u){return v.__proto__=u,v},f(s,r)}var a=500,i=function(s){l(r,s);function r(v,u,n){var t;return t=s.call(this,v,u,n,"[subtitle-stream-controller]")||this,t.levels=[],t.currentTrackId=-1,t.tracksBuffered=[],t.mainDetails=null,t._registerListeners(),t}var o=r.prototype;return o.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},o._registerListeners=function(){var u=this.hls;u.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(F.Events.ERROR,this.onError,this),u.on(F.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),u.on(F.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),u.on(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),u.on(F.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),u.on(F.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),u.on(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o._unregisterListeners=function(){var u=this.hls;u.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(F.Events.ERROR,this.onError,this),u.off(F.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),u.off(F.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),u.off(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),u.off(F.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),u.off(F.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),u.off(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o.startLoad=function(u){this.stopLoad(),this.state=L.State.IDLE,this.setInterval(a),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u,this.tick()},o.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},o.onLevelLoaded=function(u,n){this.mainDetails=n.details},o.onSubtitleFragProcessed=function(u,n){var t=n.frag,h=n.success;if(this.fragPrevious=t,this.state=L.State.IDLE,!!h){var e=this.tracksBuffered[this.currentTrackId];if(e){for(var d,p=t.start,E=0;E<e.length;E++)if(p>=e[E].start&&p<=e[E].end){d=e[E];break}var D=t.start+t.duration;d?d.end=D:(d={start:p,end:D},e.push(d)),this.fragmentTracker.fragBuffered(t)}}},o.onBufferFlushing=function(u,n){var t=n.startOffset,h=n.endOffset;if(t===0&&h!==Number.POSITIVE_INFINITY){var e=this.currentTrackId,d=this.levels;if(!d.length||!d[e]||!d[e].details)return;var p=d[e].details,E=p.targetduration,D=h-E;if(D<=0)return;n.endOffsetSubtitles=Math.max(0,D),this.tracksBuffered.forEach(function(R){for(var O=0;O<R.length;){if(R[O].end<=D){R.shift();continue}else if(R[O].start<D)R[O].start=D;else break;O++}}),this.fragmentTracker.removeFragmentsInRange(t,D,S.PlaylistLevelType.SUBTITLE)}},o.onFragBuffered=function(u,n){if(!this.loadedmetadata&&n.frag.type===S.PlaylistLevelType.MAIN){var t;(t=this.media)!==null&&t!==void 0&&t.buffered.length&&(this.loadedmetadata=!0)}},o.onError=function(u,n){var t=n.frag;!t||t.type!==S.PlaylistLevelType.SUBTITLE||(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=L.State.IDLE)},o.onSubtitleTracksUpdated=function(u,n){var t=this,h=n.subtitleTracks;this.tracksBuffered=[],this.levels=h.map(function(e){return new _.Level(e)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(e){t.tracksBuffered[e.id]=[]}),this.mediaBuffer=null},o.onSubtitleTrackSwitch=function(u,n){if(this.currentTrackId=n.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var t=this.levels[this.currentTrackId];t!=null&&t.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,t&&this.setInterval(a)},o.onSubtitleTrackLoaded=function(u,n){var t,h=n.details,e=n.id,d=this.currentTrackId,p=this.levels;if(p.length){var E=p[d];if(!(e>=p.length||e!==d||!E)){this.mediaBuffer=this.mediaBufferTimeRanges;var D=0;if(h.live||(t=E.details)!==null&&t!==void 0&&t.live){var R=this.mainDetails;if(h.deltaUpdateFailed||!R)return;var O=R.fragments[0];E.details?(D=this.alignPlaylists(h,E.details),D===0&&O&&(D=O.start,(0,k.addSliding)(h,D))):h.hasProgramDateTime&&R.hasProgramDateTime?((0,I.alignMediaPlaylistByPDT)(h,R),D=h.fragments[0].start):O&&(D=O.start,(0,k.addSliding)(h,D))}if(E.details=h,this.levelLastLoaded=e,!this.startFragRequested&&(this.mainDetails||!h.live)&&this.setStartPosition(E.details,D),this.tick(),h.live&&!this.fragCurrent&&this.media&&this.state===L.State.IDLE){var C=(0,b.findFragmentByPTS)(null,h.fragments,this.media.currentTime,0);C||(this.warn("Subtitle playlist not aligned with playback"),E.details=void 0)}}}},o._handleFragmentLoadComplete=function(u){var n=this,t=u.frag,h=u.payload,e=t.decryptdata,d=this.hls;if(!this.fragContextChanged(t)&&h&&h.byteLength>0&&e&&e.key&&e.iv&&e.method==="AES-128"){var p=performance.now();this.decrypter.decrypt(new Uint8Array(h),e.key.buffer,e.iv.buffer).then(function(E){var D=performance.now();d.trigger(F.Events.FRAG_DECRYPTED,{frag:t,payload:E,stats:{tstart:p,tdecrypt:D}})}).catch(function(E){n.warn(E.name+": "+E.message),n.state=L.State.IDLE})}},o.doTick=function(){if(!this.media){this.state=L.State.IDLE;return}if(this.state===L.State.IDLE){var u=this.currentTrackId,n=this.levels;if(!n.length||!n[u]||!n[u].details)return;var t=n[u].details,h=t.targetduration,e=this.config,d=this.getLoadPosition(),p=A.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],d-h,e.maxBufferHole),E=p.end,D=p.len,R=this.getFwdBufferInfo(this.media,S.PlaylistLevelType.MAIN),O=this.getMaxBufferLength(R==null?void 0:R.len)+h;if(D>O)return;console.assert(t,"Subtitle track details are defined on idle subtitle stream controller tick");var C=t.fragments,M=C.length,U=t.edge,B=null,N=this.fragPrevious;if(E<U){var K=e.maxFragLookUpTolerance;B=(0,b.findFragmentByPTS)(N,C,Math.max(C[0].start,E),K),!B&&N&&N.start<C[0].start&&(B=C[0])}else B=C[M-1];if(!B)return;B=this.mapToInitFragWhenRequired(B),this.fragmentTracker.getState(B)===P.FragmentState.NOT_LOADED&&this.loadFragment(B,t,E)}},o.getMaxBufferLength=function(u){var n=s.prototype.getMaxBufferLength.call(this);return u?Math.max(n,u):n},o.loadFragment=function(u,n,t){this.fragCurrent=u,u.sn==="initSegment"?this._loadInitSegment(u,n):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,u,n,t))},c(r,[{key:"mediaBufferTimeRanges",get:function(){return new g(this.tracksBuffered[this.currentTrackId]||[])}}]),r}(L.default),g=function(r){this.buffered=void 0;var o=function(u,n,t){if(n=n>>>0,n>t-1)throw new DOMException("Failed to execute '"+u+"' on 'TimeRanges': The index provided ("+n+") is greater than the maximum bound ("+t+")");return r[n][u]};this.buffered={get length(){return r.length},end:function(u){return o("end",u,r.length)},start:function(u){return o("start",u,r.length)}}}},"./src/controller/subtitle-track-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>m});var F=x("./src/events.ts"),A=x("./src/utils/texttrack-utils.ts"),b=x("./src/controller/base-playlist-controller.ts"),I=x("./src/types/loader.ts");function k(l,f){for(var a=0;a<f.length;a++){var i=f[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(l,L(i.key),i)}}function P(l,f,a){return f&&k(l.prototype,f),a&&k(l,a),Object.defineProperty(l,"prototype",{writable:!1}),l}function L(l){var f=S(l,"string");return typeof f=="symbol"?f:String(f)}function S(l,f){if(typeof l!="object"||l===null)return l;var a=l[Symbol.toPrimitive];if(a!==void 0){var i=a.call(l,f||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(l)}function _(l,f){l.prototype=Object.create(f.prototype),l.prototype.constructor=l,T(l,f)}function T(l,f){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,g){return i.__proto__=g,i},T(l,f)}var c=function(l){_(f,l);function f(i){var g;return g=l.call(this,i,"[subtitle-track-controller]")||this,g.media=null,g.tracks=[],g.groupId=null,g.tracksInGroup=[],g.trackId=-1,g.selectDefaultTrack=!0,g.queuedDefaultTrack=-1,g.trackChangeListener=function(){return g.onTextTracksChanged()},g.asyncPollTrackChange=function(){return g.pollTrackChange(0)},g.useTextTrackPolling=!1,g.subtitlePollingInterval=-1,g._subtitleDisplay=!0,g.registerListeners(),g}var a=f.prototype;return a.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,l.prototype.destroy.call(this)},a.registerListeners=function(){var g=this.hls;g.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),g.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(F.Events.LEVEL_LOADING,this.onLevelLoading,this),g.on(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),g.on(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),g.on(F.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var g=this.hls;g.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),g.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(F.Events.LEVEL_LOADING,this.onLevelLoading,this),g.off(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),g.off(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),g.off(F.Events.ERROR,this.onError,this)},a.onMediaAttached=function(g,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},a.pollTrackChange=function(g){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,g)},a.onMediaDetaching=function(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var g=y(this.media.textTracks);g.forEach(function(s){(0,A.clearCurrentCues)(s)}),this.subtitleTrack=-1,this.media=null}},a.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},a.onManifestParsed=function(g,s){this.tracks=s.subtitleTracks},a.onSubtitleTrackLoaded=function(g,s){var r=s.id,o=s.details,v=this.trackId,u=this.tracksInGroup[v];if(!u){this.warn("Invalid subtitle track id "+r);return}var n=u.details;u.details=s.details,this.log("subtitle track "+r+" loaded ["+o.startSN+"-"+o.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,s,n))},a.onLevelLoading=function(g,s){this.switchLevel(s.level)},a.onLevelSwitching=function(g,s){this.switchLevel(s.level)},a.switchLevel=function(g){var s=this.hls.levels[g];if(s!=null&&s.textGroupIds){var r=s.textGroupIds[s.urlId];if(this.groupId!==r){var o=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,v=this.tracks.filter(function(t){return!r||t.groupId===r});this.tracksInGroup=v;var u=this.findTrackId(o==null?void 0:o.name)||this.findTrackId();this.groupId=r;var n={subtitleTracks:v};this.log("Updating subtitle tracks, "+v.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(F.Events.SUBTITLE_TRACKS_UPDATED,n),u!==-1&&this.setSubtitleTrack(u,o)}}},a.findTrackId=function(g){for(var s=this.tracksInGroup,r=0;r<s.length;r++){var o=s[r];if((!this.selectDefaultTrack||o.default)&&(!g||g===o.name))return o.id}return-1},a.onError=function(g,s){l.prototype.onError.call(this,g,s),!(s.fatal||!s.context)&&s.context.type===I.PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},a.loadPlaylist=function(g){l.prototype.loadPlaylist.call(this);var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var r=s.id,o=s.groupId,v=s.url;if(g)try{v=g.addDirectives(v)}catch(u){this.warn("Could not construct new URL with HLS Delivery Directives: "+u)}this.log("Loading subtitle playlist for id "+r),this.hls.trigger(F.Events.SUBTITLE_TRACK_LOADING,{url:v,id:r,groupId:o,deliveryDirectives:g||null})}},a.toggleTrackModes=function(g){var s=this,r=this.media,o=this.trackId;if(r){var v=y(r.textTracks),u=v.filter(function(h){return h.groupId===s.groupId});if(g===-1)[].slice.call(v).forEach(function(h){h.mode="disabled"});else{var n=u[o];n&&(n.mode="disabled")}var t=u[g];t&&(t.mode=this.subtitleDisplay?"showing":"hidden")}},a.setSubtitleTrack=function(g,s){var r,o=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=g;return}if(this.trackId!==g&&this.toggleTrackModes(g),!(this.trackId===g&&(g===-1||(r=o[g])!==null&&r!==void 0&&r.details)||g<-1||g>=o.length)){this.clearTimer();var v=o[g];if(this.log("Switching to subtitle track "+g),this.trackId=g,v){var u=v.id,n=v.groupId,t=n===void 0?"":n,h=v.name,e=v.type,d=v.url;this.hls.trigger(F.Events.SUBTITLE_TRACK_SWITCH,{id:u,groupId:t,name:h,type:e,url:d});var p=this.switchParams(v.url,s==null?void 0:s.details);this.loadPlaylist(p)}else this.hls.trigger(F.Events.SUBTITLE_TRACK_SWITCH,{id:g})}},a.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var g=-1,s=y(this.media.textTracks),r=0;r<s.length;r++)if(s[r].mode==="hidden")g=r;else if(s[r].mode==="showing"){g=r;break}this.subtitleTrack!==g&&(this.subtitleTrack=g)}},P(f,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(g){this._subtitleDisplay=g,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(g){this.selectDefaultTrack=!1;var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(g,s)}}]),f}(b.default);function y(l){for(var f=[],a=0;a<l.length;a++){var i=l[a];i.kind==="subtitles"&&i.label&&f.push(l[a])}return f}const m=c},"./src/controller/timeline-controller.ts":(V,w,x)=>{x.r(w),x.d(w,{TimelineController:()=>c});var F=x("./src/polyfills/number.ts"),A=x("./src/events.ts"),b=x("./src/utils/cea-608-parser.ts"),I=x("./src/utils/output-filter.ts"),k=x("./src/utils/webvtt-parser.ts"),P=x("./src/utils/texttrack-utils.ts"),L=x("./src/utils/imsc1-ttml-parser.ts"),S=x("./src/utils/mp4-tools.ts"),_=x("./src/types/loader.ts"),T=x("./src/utils/logger.ts"),c=function(){function f(i){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this.captionsProperties=void 0,this.hls=i,this.config=i.config,this.Cues=i.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var g=new I.default(this,"textTrack1"),s=new I.default(this,"textTrack2"),r=new I.default(this,"textTrack3"),o=new I.default(this,"textTrack4");this.cea608Parser1=new b.default(1,g,s),this.cea608Parser2=new b.default(3,r,o)}i.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(A.Events.FRAG_LOADING,this.onFragLoading,this),i.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(A.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),i.on(A.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),i.on(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),i.on(A.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),i.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var a=f.prototype;return a.destroy=function(){var g=this.hls;g.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.off(A.Events.MANIFEST_LOADED,this.onManifestLoaded,this),g.off(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),g.off(A.Events.FRAG_LOADING,this.onFragLoading,this),g.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),g.off(A.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),g.off(A.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),g.off(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),g.off(A.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),g.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},a.addCues=function(g,s,r,o,v){for(var u=!1,n=v.length;n--;){var t=v[n],h=m(t[0],t[1],s,r);if(h>=0&&(t[0]=Math.min(t[0],s),t[1]=Math.max(t[1],r),u=!0,h/(r-s)>.5))return}if(u||v.push([s,r]),this.config.renderTextTracksNatively){var e=this.captionsTracks[g];this.Cues.newCue(e,s,r,o)}else{var d=this.Cues.newCue(null,s,r,o);this.hls.trigger(A.Events.CUES_PARSED,{type:"captions",cues:d,track:g})}},a.onInitPtsFound=function(g,s){var r=this,o=s.frag,v=s.id,u=s.initPTS,n=s.timescale,t=this.unparsedVttFrags;v==="main"&&(this.initPTS[o.cc]=u,this.timescale[o.cc]=n),t.length&&(this.unparsedVttFrags=[],t.forEach(function(h){r.onFragLoaded(A.Events.FRAG_LOADED,h)}))},a.getExistingTrack=function(g){var s=this.media;if(s)for(var r=0;r<s.textTracks.length;r++){var o=s.textTracks[r];if(o[g])return o}return null},a.createCaptionsTrack=function(g){this.config.renderTextTracksNatively?this.createNativeTrack(g):this.createNonNativeTrack(g)},a.createNativeTrack=function(g){if(!this.captionsTracks[g]){var s=this.captionsProperties,r=this.captionsTracks,o=this.media,v=s[g],u=v.label,n=v.languageCode,t=this.getExistingTrack(g);if(t)r[g]=t,(0,P.clearCurrentCues)(r[g]),(0,P.sendAddTrackEvent)(r[g],o);else{var h=this.createTextTrack("captions",u,n);h&&(h[g]=!0,r[g]=h)}}},a.createNonNativeTrack=function(g){if(!this.nonNativeCaptionsTracks[g]){var s=this.captionsProperties[g];if(s){var r=s.label,o={_id:g,label:r,kind:"captions",default:s.media?!!s.media.default:!1,closedCaptions:s.media};this.nonNativeCaptionsTracks[g]=o,this.hls.trigger(A.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[o]})}}},a.createTextTrack=function(g,s,r){var o=this.media;if(o)return o.addTextTrack(g,s,r)},a.onMediaAttaching=function(g,s){this.media=s.media,this._cleanTracks()},a.onMediaDetaching=function(){var g=this.captionsTracks;Object.keys(g).forEach(function(s){(0,P.clearCurrentCues)(g[s]),delete g[s]}),this.nonNativeCaptionsTracks={}},a.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},a._cleanTracks=function(){var g=this.media;if(g){var s=g.textTracks;if(s)for(var r=0;r<s.length;r++)(0,P.clearCurrentCues)(s[r])}},a.onSubtitleTracksUpdated=function(g,s){var r=this;this.textTracks=[];var o=s.subtitleTracks||[],v=o.some(function(h){return h.textCodec===L.IMSC1_CODEC});if(this.config.enableWebVTT||v&&this.config.enableIMSC1){var u=this.tracks&&o&&this.tracks.length===o.length;if(this.tracks=o||[],this.config.renderTextTracksNatively){var n=this.media?this.media.textTracks:[];this.tracks.forEach(function(h,e){var d;if(e<n.length){for(var p=null,E=0;E<n.length;E++)if(y(n[E],h)){p=n[E];break}p&&(d=p)}if(d)(0,P.clearCurrentCues)(d);else{var D=r._captionsOrSubtitlesFromCharacteristics(h);d=r.createTextTrack(D,h.name,h.lang),d&&(d.mode="disabled")}d&&(d.groupId=h.groupId,r.textTracks.push(d))})}else if(!u&&this.tracks&&this.tracks.length){var t=this.tracks.map(function(h){return{label:h.name,kind:h.type.toLowerCase(),default:h.default,subtitleTrack:h}});this.hls.trigger(A.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:t})}}},a._captionsOrSubtitlesFromCharacteristics=function(g){var s;if((s=g.attrs)!==null&&s!==void 0&&s.CHARACTERISTICS){var r=/transcribes-spoken-dialog/gi.test(g.attrs.CHARACTERISTICS),o=/describes-music-and-sound/gi.test(g.attrs.CHARACTERISTICS);if(r&&o)return"captions"}return"subtitles"},a.onManifestLoaded=function(g,s){var r=this;this.config.enableCEA708Captions&&s.captions&&s.captions.forEach(function(o){var v=/(?:CC|SERVICE)([1-4])/.exec(o.instreamId);if(v){var u="textTrack"+v[1],n=r.captionsProperties[u];n&&(n.label=o.name,o.lang&&(n.languageCode=o.lang),n.media=o)}})},a.closedCaptionsForLevel=function(g){var s=this.hls.levels[g.level];return s==null?void 0:s.attrs["CLOSED-CAPTIONS"]},a.onFragLoading=function(g,s){var r=this.cea608Parser1,o=this.cea608Parser2,v=this.lastSn,u=this.lastPartIndex;if(!(!this.enabled||!(r&&o))&&s.frag.type===_.PlaylistLevelType.MAIN){var n,t,h=s.frag.sn,e=(n=s==null||(t=s.part)===null||t===void 0?void 0:t.index)!=null?n:-1;h===v+1||h===v&&e===u+1||(r.reset(),o.reset()),this.lastSn=h,this.lastPartIndex=e}},a.onFragLoaded=function(g,s){var r=s.frag,o=s.payload,v=this.initPTS,u=this.unparsedVttFrags;if(r.type===_.PlaylistLevelType.SUBTITLE)if(o.byteLength){if(!(0,F.isFiniteNumber)(v[r.cc])){u.push(s),v.length&&this.hls.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")});return}var n=r.decryptdata,t="stats"in s;if(n==null||!n.encrypted||t){var h=this.tracks[r.level],e=this.vttCCs;e[r.cc]||(e[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),h&&h.textCodec===L.IMSC1_CODEC?this._parseIMSC1(r,o):this._parseVTTs(r,o,e)}}else this.hls.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},a._parseIMSC1=function(g,s){var r=this,o=this.hls;(0,L.parseIMSC1)(s,this.initPTS[g.cc],this.timescale[g.cc],function(v){r._appendCues(v,g.level),o.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:g})},function(v){T.logger.log("Failed to parse IMSC1: "+v),o.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:g,error:v})})},a._parseVTTs=function(g,s,r){var o,v=this,u=this.hls,n=(o=g.initSegment)!==null&&o!==void 0&&o.data?(0,S.appendUint8Array)(g.initSegment.data,new Uint8Array(s)):s;(0,k.parseWebVTT)(n,this.initPTS[g.cc],this.timescale[g.cc],r,g.cc,g.start,function(t){v._appendCues(t,g.level),u.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:g})},function(t){v._fallbackToIMSC1(g,s),T.logger.log("Failed to parse VTT cue: "+t),u.trigger(A.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:g,error:t})})},a._fallbackToIMSC1=function(g,s){var r=this,o=this.tracks[g.level];o.textCodec||(0,L.parseIMSC1)(s,this.initPTS[g.cc],this.timescale[g.cc],function(){o.textCodec=L.IMSC1_CODEC,r._parseIMSC1(g,s)},function(){o.textCodec="wvtt"})},a._appendCues=function(g,s){var r=this.hls;if(this.config.renderTextTracksNatively){var o=this.textTracks[s];if(!o||o.mode==="disabled")return;g.forEach(function(n){return(0,P.addCueToTrack)(o,n)})}else{var v=this.tracks[s];if(!v)return;var u=v.default?"default":"subtitles"+s;r.trigger(A.Events.CUES_PARSED,{type:"subtitles",cues:g,track:u})}},a.onFragDecrypted=function(g,s){var r=s.frag;if(r.type===_.PlaylistLevelType.SUBTITLE){if(!(0,F.isFiniteNumber)(this.initPTS[r.cc])){this.unparsedVttFrags.push(s);return}this.onFragLoaded(A.Events.FRAG_LOADED,s)}},a.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},a.onFragParsingUserdata=function(g,s){var r=this.cea608Parser1,o=this.cea608Parser2;if(!(!this.enabled||!(r&&o))){var v=s.frag,u=s.samples;if(!(v.type===_.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(v)==="NONE"))for(var n=0;n<u.length;n++){var t=u[n].bytes;if(t){var h=this.extractCea608Data(t);r.addData(u[n].pts,h[0]),o.addData(u[n].pts,h[1])}}}},a.onBufferFlushing=function(g,s){var r=s.startOffset,o=s.endOffset,v=s.endOffsetSubtitles,u=s.type,n=this.media;if(!(!n||n.currentTime<o)){if(!u||u==="video"){var t=this.captionsTracks;Object.keys(t).forEach(function(e){return(0,P.removeCuesInRange)(t[e],r,o)})}if(this.config.renderTextTracksNatively&&r===0&&v!==void 0){var h=this.textTracks;Object.keys(h).forEach(function(e){return(0,P.removeCuesInRange)(h[e],r,v)})}}},a.extractCea608Data=function(g){for(var s=[[],[]],r=g[0]&31,o=2,v=0;v<r;v++){var u=g[o++],n=127&g[o++],t=127&g[o++];if(!(n===0&&t===0)){var h=(4&u)!==0;if(h){var e=3&u;(e===0||e===1)&&(s[e].push(n),s[e].push(t))}}}return s},f}();function y(f,a){return f&&f.label===a.name&&!(f.textTrack1||f.textTrack2)}function m(f,a,i,g){return Math.min(a,g)-Math.max(f,i)}function l(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>F});var F=function(){function A(I,k){this.subtle=void 0,this.aesIV=void 0,this.subtle=I,this.aesIV=k}var b=A.prototype;return b.decrypt=function(k,P){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},P,k)},A}()},"./src/crypt/aes-decryptor.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>b,removePadding:()=>A});var F=x("./src/utils/typed-array.ts");function A(I){var k=I.byteLength,P=k&&new DataView(I.buffer).getUint8(k-1);return P?(0,F.sliceUint8)(I,0,k-P):I}var b=function(){function I(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var k=I.prototype;return k.uint8ArrayToUint32Array_=function(L){for(var S=new DataView(L),_=new Uint32Array(4),T=0;T<4;T++)_[T]=S.getUint32(T*4);return _},k.initTable=function(){var L=this.sBox,S=this.invSBox,_=this.subMix,T=_[0],c=_[1],y=_[2],m=_[3],l=this.invSubMix,f=l[0],a=l[1],i=l[2],g=l[3],s=new Uint32Array(256),r=0,o=0,v=0;for(v=0;v<256;v++)v<128?s[v]=v<<1:s[v]=v<<1^283;for(v=0;v<256;v++){var u=o^o<<1^o<<2^o<<3^o<<4;u=u>>>8^u&255^99,L[r]=u,S[u]=r;var n=s[r],t=s[n],h=s[t],e=s[u]*257^u*16843008;T[r]=e<<24|e>>>8,c[r]=e<<16|e>>>16,y[r]=e<<8|e>>>24,m[r]=e,e=h*16843009^t*65537^n*257^r*16843008,f[u]=e<<24|e>>>8,a[u]=e<<16|e>>>16,i[u]=e<<8|e>>>24,g[u]=e,r?(r=n^s[s[s[h^n]]],o^=s[s[o]]):r=o=1}},k.expandKey=function(L){for(var S=this.uint8ArrayToUint32Array_(L),_=!0,T=0;T<S.length&&_;)_=S[T]===this.key[T],T++;if(!_){this.key=S;var c=this.keySize=S.length;if(c!==4&&c!==6&&c!==8)throw new Error("Invalid aes key size="+c);var y=this.ksRows=(c+6+1)*4,m,l,f=this.keySchedule=new Uint32Array(y),a=this.invKeySchedule=new Uint32Array(y),i=this.sBox,g=this.rcon,s=this.invSubMix,r=s[0],o=s[1],v=s[2],u=s[3],n,t;for(m=0;m<y;m++){if(m<c){n=f[m]=S[m];continue}t=n,m%c===0?(t=t<<8|t>>>24,t=i[t>>>24]<<24|i[t>>>16&255]<<16|i[t>>>8&255]<<8|i[t&255],t^=g[m/c|0]<<24):c>6&&m%c===4&&(t=i[t>>>24]<<24|i[t>>>16&255]<<16|i[t>>>8&255]<<8|i[t&255]),f[m]=n=(f[m-c]^t)>>>0}for(l=0;l<y;l++)m=y-l,l&3?t=f[m]:t=f[m-4],l<4||m<=4?a[l]=t:a[l]=r[i[t>>>24]]^o[i[t>>>16&255]]^v[i[t>>>8&255]]^u[i[t&255]],a[l]=a[l]>>>0}},k.networkToHostOrderSwap=function(L){return L<<24|(L&65280)<<8|(L&16711680)>>8|L>>>24},k.decrypt=function(L,S,_){for(var T=this.keySize+6,c=this.invKeySchedule,y=this.invSBox,m=this.invSubMix,l=m[0],f=m[1],a=m[2],i=m[3],g=this.uint8ArrayToUint32Array_(_),s=g[0],r=g[1],o=g[2],v=g[3],u=new Int32Array(L),n=new Int32Array(u.length),t,h,e,d,p,E,D,R,O,C,M,U,B,N,K=this.networkToHostOrderSwap;S<u.length;){for(O=K(u[S]),C=K(u[S+1]),M=K(u[S+2]),U=K(u[S+3]),p=O^c[0],E=U^c[1],D=M^c[2],R=C^c[3],B=4,N=1;N<T;N++)t=l[p>>>24]^f[E>>16&255]^a[D>>8&255]^i[R&255]^c[B],h=l[E>>>24]^f[D>>16&255]^a[R>>8&255]^i[p&255]^c[B+1],e=l[D>>>24]^f[R>>16&255]^a[p>>8&255]^i[E&255]^c[B+2],d=l[R>>>24]^f[p>>16&255]^a[E>>8&255]^i[D&255]^c[B+3],p=t,E=h,D=e,R=d,B=B+4;t=y[p>>>24]<<24^y[E>>16&255]<<16^y[D>>8&255]<<8^y[R&255]^c[B],h=y[E>>>24]<<24^y[D>>16&255]<<16^y[R>>8&255]<<8^y[p&255]^c[B+1],e=y[D>>>24]<<24^y[R>>16&255]<<16^y[p>>8&255]<<8^y[E&255]^c[B+2],d=y[R>>>24]<<24^y[p>>16&255]<<16^y[E>>8&255]<<8^y[D&255]^c[B+3],n[S]=K(t^s),n[S+1]=K(d^r),n[S+2]=K(e^o),n[S+3]=K(h^v),s=O,r=C,o=M,v=U,S=S+4}return n.buffer},I}()},"./src/crypt/decrypter.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>S});var F=x("./src/crypt/aes-crypto.ts"),A=x("./src/crypt/fast-aes-key.ts"),b=x("./src/crypt/aes-decryptor.ts"),I=x("./src/utils/logger.ts"),k=x("./src/utils/mp4-tools.ts"),P=x("./src/utils/typed-array.ts"),L=16,S=function(){function _(c,y){var m=y===void 0?{}:y,l=m.removePKCS7Padding,f=l===void 0?!0:l;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=c.enableSoftwareAES,this.removePKCS7Padding=f,f)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}var T=_.prototype;return T.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},T.isSync=function(){return this.useSoftware},T.flush=function(){var y=this.currentResult,m=this.remainderData;if(!y||m)return I.logger.error("[softwareDecrypt] "+(m?"overflow bytes: "+m.byteLength:"no result")),this.reset(),null;var l=new Uint8Array(y);return this.reset(),this.removePKCS7Padding?(0,b.removePadding)(l):l},T.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},T.decrypt=function(y,m,l){var f=this;return this.useSoftware?new Promise(function(a,i){f.softwareDecrypt(new Uint8Array(y),m,l);var g=f.flush();g?a(g.buffer):i(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(y),m,l)},T.softwareDecrypt=function(y,m,l){var f=this.currentIV,a=this.currentResult,i=this.remainderData;this.logOnce("JS AES decrypt"),i&&(y=(0,k.appendUint8Array)(i,y),this.remainderData=null);var g=this.getValidChunk(y);if(!g.length)return null;f&&(l=f);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new b.default),s.expandKey(m);var r=a;return this.currentResult=s.decrypt(g.buffer,0,l),this.currentIV=(0,P.sliceUint8)(g,-16).buffer,r||null},T.webCryptoDecrypt=function(y,m,l){var f=this,a=this.subtle;return(this.key!==m||!this.fastAesKey)&&(this.key=m,this.fastAesKey=new A.default(a,m)),this.fastAesKey.expandKey().then(function(i){if(!a)return Promise.reject(new Error("web crypto not initialized"));f.logOnce("WebCrypto AES decrypt");var g=new F.default(a,new Uint8Array(l));return g.decrypt(y.buffer,i)}).catch(function(i){return I.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+i.name+": "+i.message),f.onWebCryptoError(y,m,l)})},T.onWebCryptoError=function(y,m,l){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(y,m,l);var f=this.flush();if(f)return f.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},T.getValidChunk=function(y){var m=y,l=y.length-y.length%L;return l!==y.length&&(m=(0,P.sliceUint8)(y,0,l),this.remainderData=(0,P.sliceUint8)(y,l)),m},T.logOnce=function(y){this.logEnabled&&(I.logger.log("[decrypter]: "+y),this.logEnabled=!1)},_}()},"./src/crypt/fast-aes-key.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>F});var F=function(){function A(I,k){this.subtle=void 0,this.key=void 0,this.subtle=I,this.key=k}var b=A.prototype;return b.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},A}()},"./src/demux/aacdemuxer.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>S});var F=x("./src/demux/base-audio-demuxer.ts"),A=x("./src/demux/adts.ts"),b=x("./src/utils/logger.ts"),I=x("./src/demux/id3.ts");function k(_,T){_.prototype=Object.create(T.prototype),_.prototype.constructor=_,P(_,T)}function P(_,T){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,m){return y.__proto__=m,y},P(_,T)}var L=function(_){k(T,_);function T(y,m){var l;return l=_.call(this)||this,l.observer=void 0,l.config=void 0,l.observer=y,l.config=m,l}var c=T.prototype;return c.resetInitSegment=function(m,l,f,a){_.prototype.resetInitSegment.call(this,m,l,f,a),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:l,duration:a,inputTimeScale:9e4,dropped:0}},T.probe=function(m){if(!m)return!1;for(var l=I.getID3Data(m,0)||[],f=l.length,a=m.length;f<a;f++)if(A.probe(m,f))return b.logger.log("ADTS sync word found !"),!0;return!1},c.canParse=function(m,l){return A.canParse(m,l)},c.appendFrame=function(m,l,f){A.initTrackConfig(m,this.observer,l,f,m.manifestCodec);var a=A.appendFrame(m,l,f,this.basePTS,this.frameIndex);if(a&&a.missing===0)return a},T}(F.default);const S=L},"./src/demux/adts.ts":(V,w,x)=>{x.r(w),x.d(w,{appendFrame:()=>f,canGetFrameLength:()=>S,canParse:()=>T,getAudioConfig:()=>I,getFrameDuration:()=>m,getFullFrameLength:()=>L,getHeaderLength:()=>P,initTrackConfig:()=>y,isHeader:()=>_,isHeaderPattern:()=>k,parseFrameHeader:()=>l,probe:()=>c});var F=x("./src/utils/logger.ts"),A=x("./src/errors.ts"),b=x("./src/events.ts");function I(a,i,g,s){var r,o,v,u,n=navigator.userAgent.toLowerCase(),t=s,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=((i[g+2]&192)>>>6)+1;var e=(i[g+2]&60)>>>2;if(e>h.length-1){a.trigger(b.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+e});return}return v=(i[g+2]&1)<<2,v|=(i[g+3]&192)>>>6,F.logger.log("manifest codec:"+s+", ADTS type:"+r+", samplingIndex:"+e),/firefox/i.test(n)?e>=6?(r=5,u=new Array(4),o=e-3):(r=2,u=new Array(2),o=e):n.indexOf("android")!==-1?(r=2,u=new Array(2),o=e):(r=5,u=new Array(4),s&&(s.indexOf("mp4a.40.29")!==-1||s.indexOf("mp4a.40.5")!==-1)||!s&&e>=6?o=e-3:((s&&s.indexOf("mp4a.40.2")!==-1&&(e>=6&&v===1||/vivaldi/i.test(n))||!s&&v===1)&&(r=2,u=new Array(2)),o=e)),u[0]=r<<3,u[0]|=(e&14)>>1,u[1]|=(e&1)<<7,u[1]|=v<<3,r===5&&(u[1]|=(o&14)>>1,u[2]=(o&1)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:h[e],channelCount:v,codec:"mp4a.40."+r,manifestCodec:t}}function k(a,i){return a[i]===255&&(a[i+1]&246)===240}function P(a,i){return a[i+1]&1?7:9}function L(a,i){return(a[i+3]&3)<<11|a[i+4]<<3|(a[i+5]&224)>>>5}function S(a,i){return i+5<a.length}function _(a,i){return i+1<a.length&&k(a,i)}function T(a,i){return S(a,i)&&k(a,i)&&L(a,i)<=a.length-i}function c(a,i){if(_(a,i)){var g=P(a,i);if(i+g>=a.length)return!1;var s=L(a,i);if(s<=g)return!1;var r=i+s;return r===a.length||_(a,r)}return!1}function y(a,i,g,s,r){if(!a.samplerate){var o=I(i,g,s,r);if(!o)return;a.config=o.config,a.samplerate=o.samplerate,a.channelCount=o.channelCount,a.codec=o.codec,a.manifestCodec=o.manifestCodec,F.logger.log("parsed codec:"+a.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function m(a){return 9216e4/a}function l(a,i){var g=P(a,i);if(i+g<=a.length){var s=L(a,i)-g;if(s>0)return{headerLength:g,frameLength:s}}}function f(a,i,g,s,r){var o=m(a.samplerate),v=s+r*o,u=l(i,g),n;if(u){var t=u.frameLength,h=u.headerLength,e=h+t,d=Math.max(0,g+e-i.length);d?(n=new Uint8Array(e-h),n.set(i.subarray(g+h,i.length),0)):n=i.subarray(g+h,g+e);var p={unit:n,pts:v};return d||a.samples.push(p),{sample:p,length:e,missing:d}}var E=i.length-g;n=new Uint8Array(E),n.set(i.subarray(g,i.length),0);var D={unit:n,pts:v};return{sample:D,length:E,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>_,initPTSFn:()=>S});var F=x("./src/polyfills/number.ts"),A=x("./src/demux/id3.ts"),b=x("./src/types/demuxer.ts"),I=x("./src/demux/dummy-demuxed-track.ts"),k=x("./src/utils/mp4-tools.ts"),P=x("./src/utils/typed-array.ts"),L=function(){function T(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var c=T.prototype;return c.resetInitSegment=function(m,l,f,a){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},c.resetTimeStamp=function(m){this.initPTS=m,this.resetContiguity()},c.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},c.canParse=function(m,l){return!1},c.appendFrame=function(m,l,f){},c.demux=function(m,l){this.cachedData&&(m=(0,k.appendUint8Array)(this.cachedData,m),this.cachedData=null);var f=A.getID3Data(m,0),a=f?f.length:0,i,g=this._audioTrack,s=this._id3Track,r=f?A.getTimeStamp(f):void 0,o=m.length;for((this.basePTS===null||this.frameIndex===0&&(0,F.isFiniteNumber)(r))&&(this.basePTS=S(r,l,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),f&&f.length>0&&s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:f,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});a<o;){if(this.canParse(m,a)){var v=this.appendFrame(g,m,a);v?(this.frameIndex++,this.lastPTS=v.sample.pts,a+=v.length,i=a):a=o}else A.canParse(m,a)?(f=A.getID3Data(m,a),s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:f,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),a+=f.length,i=a):a++;if(a===o&&i!==o){var u=(0,P.sliceUint8)(m,i);this.cachedData?this.cachedData=(0,k.appendUint8Array)(this.cachedData,u):this.cachedData=u}}return{audioTrack:g,videoTrack:(0,I.dummyTrack)(),id3Track:s,textTrack:(0,I.dummyTrack)()}},c.demuxSampleAes=function(m,l,f){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},c.flush=function(m){var l=this.cachedData;return l&&(this.cachedData=null,this.demux(l,0)),{audioTrack:this._audioTrack,videoTrack:(0,I.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,I.dummyTrack)()}},c.destroy=function(){},T}(),S=function(c,y,m){return(0,F.isFiniteNumber)(c)?c*90:y*9e4+(m||0)};const _=L},"./src/demux/chunk-cache.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>F});var F=function(){function b(){this.chunks=[],this.dataLength=0}var I=b.prototype;return I.push=function(P){this.chunks.push(P),this.dataLength+=P.length},I.flush=function(){var P=this.chunks,L=this.dataLength,S;if(P.length)P.length===1?S=P[0]:S=A(P,L);else return new Uint8Array(0);return this.reset(),S},I.reset=function(){this.chunks.length=0,this.dataLength=0},b}();function A(b,I){for(var k=new Uint8Array(I),P=0,L=0;L<b.length;L++){var S=b[L];k.set(S,P),P+=S.length}return k}},"./src/demux/dummy-demuxed-track.ts":(V,w,x)=>{x.r(w),x.d(w,{dummyTrack:()=>F});function F(A,b){return A===void 0&&(A=""),b===void 0&&(b=9e4),{type:A,id:-1,pid:-1,inputTimeScale:b,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>b});var F=x("./src/utils/logger.ts"),A=function(){function I(P){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=P,this.bytesAvailable=P.byteLength,this.word=0,this.bitsAvailable=0}var k=I.prototype;return k.loadWord=function(){var L=this.data,S=this.bytesAvailable,_=L.byteLength-S,T=new Uint8Array(4),c=Math.min(4,S);if(c===0)throw new Error("no bytes available");T.set(L.subarray(_,_+c)),this.word=new DataView(T.buffer).getUint32(0),this.bitsAvailable=c*8,this.bytesAvailable-=c},k.skipBits=function(L){var S;L=Math.min(L,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>L?(this.word<<=L,this.bitsAvailable-=L):(L-=this.bitsAvailable,S=L>>3,L-=S<<3,this.bytesAvailable-=S,this.loadWord(),this.word<<=L,this.bitsAvailable-=L)},k.readBits=function(L){var S=Math.min(this.bitsAvailable,L),_=this.word>>>32-S;if(L>32&&F.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=S,this.bitsAvailable>0)this.word<<=S;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return S=L-S,S>0&&this.bitsAvailable?_<<S|this.readBits(S):_},k.skipLZ=function(){var L;for(L=0;L<this.bitsAvailable;++L)if(this.word&2147483648>>>L)return this.word<<=L,this.bitsAvailable-=L,L;return this.loadWord(),L+this.skipLZ()},k.skipUEG=function(){this.skipBits(1+this.skipLZ())},k.skipEG=function(){this.skipBits(1+this.skipLZ())},k.readUEG=function(){var L=this.skipLZ();return this.readBits(L+1)-1},k.readEG=function(){var L=this.readUEG();return 1&L?1+L>>>1:-1*(L>>>1)},k.readBoolean=function(){return this.readBits(1)===1},k.readUByte=function(){return this.readBits(8)},k.readUShort=function(){return this.readBits(16)},k.readUInt=function(){return this.readBits(32)},k.skipScalingList=function(L){for(var S=8,_=8,T,c=0;c<L;c++)_!==0&&(T=this.readEG(),_=(S+T+256)%256),S=_===0?S:_},k.readSPS=function(){var L=0,S=0,_=0,T=0,c,y,m,l=this.readUByte.bind(this),f=this.readBits.bind(this),a=this.readUEG.bind(this),i=this.readBoolean.bind(this),g=this.skipBits.bind(this),s=this.skipEG.bind(this),r=this.skipUEG.bind(this),o=this.skipScalingList.bind(this);l();var v=l();if(f(5),g(3),l(),r(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){var u=a();if(u===3&&g(1),r(),r(),g(1),i())for(y=u!==3?8:12,m=0;m<y;m++)i()&&(m<6?o(16):o(64))}r();var n=a();if(n===0)a();else if(n===1)for(g(1),s(),s(),c=a(),m=0;m<c;m++)s();r(),g(1);var t=a(),h=a(),e=f(1);e===0&&g(1),g(1),i()&&(L=a(),S=a(),_=a(),T=a());var d=[1,1];if(i()&&i()){var p=l();switch(p){case 1:d=[1,1];break;case 2:d=[12,11];break;case 3:d=[10,11];break;case 4:d=[16,11];break;case 5:d=[40,33];break;case 6:d=[24,11];break;case 7:d=[20,11];break;case 8:d=[32,11];break;case 9:d=[80,33];break;case 10:d=[18,11];break;case 11:d=[15,11];break;case 12:d=[64,33];break;case 13:d=[160,99];break;case 14:d=[4,3];break;case 15:d=[3,2];break;case 16:d=[2,1];break;case 255:{d=[l()<<8|l(),l()<<8|l()];break}}}return{width:Math.ceil((t+1)*16-L*2-S*2),height:(2-e)*(h+1)*16-(e?2:4)*(_+T),pixelRatio:d}},k.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},I}();const b=A},"./src/demux/id3.ts":(V,w,x)=>{x.r(w),x.d(w,{canParse:()=>k,decodeFrame:()=>T,getID3Data:()=>b,getID3Frames:()=>_,getTimeStamp:()=>P,isFooter:()=>A,isHeader:()=>F,isTimeStampFrame:()=>L,testables:()=>a,utf8ArrayToStr:()=>f});var F=function(r,o){return o+10<=r.length&&r[o]===73&&r[o+1]===68&&r[o+2]===51&&r[o+3]<255&&r[o+4]<255&&r[o+6]<128&&r[o+7]<128&&r[o+8]<128&&r[o+9]<128},A=function(r,o){return o+10<=r.length&&r[o]===51&&r[o+1]===68&&r[o+2]===73&&r[o+3]<255&&r[o+4]<255&&r[o+6]<128&&r[o+7]<128&&r[o+8]<128&&r[o+9]<128},b=function(r,o){for(var v=o,u=0;F(r,o);){u+=10;var n=I(r,o+6);u+=n,A(r,o+10)&&(u+=10),o+=u}if(u>0)return r.subarray(v,v+u)},I=function(r,o){var v=0;return v=(r[o]&127)<<21,v|=(r[o+1]&127)<<14,v|=(r[o+2]&127)<<7,v|=r[o+3]&127,v},k=function(r,o){return F(r,o)&&I(r,o+6)+10<=r.length-o},P=function(r){for(var o=_(r),v=0;v<o.length;v++){var u=o[v];if(L(u))return l(u)}},L=function(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"},S=function(r){var o=String.fromCharCode(r[0],r[1],r[2],r[3]),v=I(r,4),u=10;return{type:o,size:v,data:r.subarray(u,u+v)}},_=function(r){for(var o=0,v=[];F(r,o);){var u=I(r,o+6);o+=10;for(var n=o+u;o+8<n;){var t=S(r.subarray(o)),h=T(t);h&&v.push(h),o+=t.size+10}A(r,o)&&(o+=10)}return v},T=function(r){return r.type==="PRIV"?c(r):r.type[0]==="W"?m(r):y(r)},c=function(r){if(!(r.size<2)){var o=f(r.data,!0),v=new Uint8Array(r.data.subarray(o.length+1));return{key:r.type,info:o,data:v.buffer}}},y=function(r){if(!(r.size<2)){if(r.type==="TXXX"){var o=1,v=f(r.data.subarray(o),!0);o+=v.length+1;var u=f(r.data.subarray(o));return{key:r.type,info:v,data:u}}var n=f(r.data.subarray(1));return{key:r.type,data:n}}},m=function(r){if(r.type==="WXXX"){if(r.size<2)return;var o=1,v=f(r.data.subarray(o),!0);o+=v.length+1;var u=f(r.data.subarray(o));return{key:r.type,info:v,data:u}}var n=f(r.data);return{key:r.type,data:n}},l=function(r){if(r.data.byteLength===8){var o=new Uint8Array(r.data),v=o[3]&1,u=(o[4]<<23)+(o[5]<<15)+(o[6]<<7)+o[7];return u/=45,v&&(u+=4772185884e-2),Math.round(u)}},f=function(r,o){o===void 0&&(o=!1);var v=g();if(v){var u=v.decode(r);if(o){var n=u.indexOf("\0");return n!==-1?u.substring(0,n):u}return u.replace(/\0/g,"")}for(var t=r.length,h,e,d,p="",E=0;E<t;){if(h=r[E++],h===0&&o)return p;if(h===0||h===3)continue;switch(h>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:p+=String.fromCharCode(h);break;case 12:case 13:e=r[E++],p+=String.fromCharCode((h&31)<<6|e&63);break;case 14:e=r[E++],d=r[E++],p+=String.fromCharCode((h&15)<<12|(e&63)<<6|(d&63)<<0);break}}return p},a={decodeTextFrame:y},i;function g(){return!i&&typeof self.TextDecoder<"u"&&(i=new self.TextDecoder("utf-8")),i}},"./src/demux/mp3demuxer.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>S});var F=x("./src/demux/base-audio-demuxer.ts"),A=x("./src/demux/id3.ts"),b=x("./src/utils/logger.ts"),I=x("./src/demux/mpegaudio.ts");function k(_,T){_.prototype=Object.create(T.prototype),_.prototype.constructor=_,P(_,T)}function P(_,T){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,m){return y.__proto__=m,y},P(_,T)}var L=function(_){k(T,_);function T(){return _.apply(this,arguments)||this}var c=T.prototype;return c.resetInitSegment=function(m,l,f,a){_.prototype.resetInitSegment.call(this,m,l,f,a),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:l,duration:a,inputTimeScale:9e4,dropped:0}},T.probe=function(m){if(!m)return!1;for(var l=A.getID3Data(m,0)||[],f=l.length,a=m.length;f<a;f++)if(I.probe(m,f))return b.logger.log("MPEG Audio sync word found !"),!0;return!1},c.canParse=function(m,l){return I.canParse(m,l)},c.appendFrame=function(m,l,f){if(this.basePTS!==null)return I.appendFrame(m,l,f,this.basePTS,this.frameIndex)},T}(F.default);const S=L},"./src/demux/mp4demuxer.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>L});var F=x("./src/polyfills/number.ts"),A=x("./src/types/demuxer.ts"),b=x("./src/utils/mp4-tools.ts"),I=x("./src/demux/dummy-demuxed-track.ts"),k=/\/emsg[-/]ID3/i,P=function(){function S(T,c){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=c}var _=S.prototype;return _.resetTimeStamp=function(){},_.resetInitSegment=function(c,y,m,l){var f=this.videoTrack=(0,I.dummyTrack)("video",1),a=this.audioTrack=(0,I.dummyTrack)("audio",1),i=this.txtTrack=(0,I.dummyTrack)("text",1);if(this.id3Track=(0,I.dummyTrack)("id3",1),this.timeOffset=0,!(!c||!c.byteLength)){var g=(0,b.parseInitSegment)(c);if(g.video){var s=g.video,r=s.id,o=s.timescale,v=s.codec;f.id=r,f.timescale=i.timescale=o,f.codec=v}if(g.audio){var u=g.audio,n=u.id,t=u.timescale,h=u.codec;a.id=n,a.timescale=t,a.codec=h}i.id=b.RemuxerTrackIdConfig.text,f.sampleDuration=0,f.duration=a.duration=l}},_.resetContiguity=function(){},S.probe=function(c){return c=c.length>16384?c.subarray(0,16384):c,(0,b.findBox)(c,["moof"]).length>0},_.demux=function(c,y){this.timeOffset=y;var m=c,l=this.videoTrack,f=this.txtTrack;if(this.config.progressive){this.remainderData&&(m=(0,b.appendUint8Array)(this.remainderData,c));var a=(0,b.segmentValidRange)(m);this.remainderData=a.remainder,l.samples=a.valid||new Uint8Array}else l.samples=m;var i=this.extractID3Track(l,y);return f.samples=(0,b.parseSamples)(y,l),{videoTrack:l,audioTrack:this.audioTrack,id3Track:i,textTrack:this.txtTrack}},_.flush=function(){var c=this.timeOffset,y=this.videoTrack,m=this.txtTrack;y.samples=this.remainderData||new Uint8Array,this.remainderData=null;var l=this.extractID3Track(y,this.timeOffset);return m.samples=(0,b.parseSamples)(c,y),{videoTrack:y,audioTrack:(0,I.dummyTrack)(),id3Track:l,textTrack:(0,I.dummyTrack)()}},_.extractID3Track=function(c,y){var m=this.id3Track;if(c.samples.length){var l=(0,b.findBox)(c.samples,["emsg"]);l&&l.forEach(function(f){var a=(0,b.parseEmsg)(f);if(k.test(a.schemeIdUri)){var i=(0,F.isFiniteNumber)(a.presentationTime)?a.presentationTime/a.timeScale:y+a.presentationTimeDelta/a.timeScale,g=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;g<=.001&&(g=Number.POSITIVE_INFINITY);var s=a.payload;m.samples.push({data:s,len:s.byteLength,dts:i,pts:i,type:A.MetadataSchema.emsg,duration:g})}})}return m},_.demuxSampleAes=function(c,y,m){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},_.destroy=function(){},S}();const L=P},"./src/demux/mpegaudio.ts":(V,w,x)=>{x.r(w),x.d(w,{appendFrame:()=>P,canParse:()=>T,isHeader:()=>_,isHeaderPattern:()=>S,parseHeader:()=>L,probe:()=>c});var F=null,A=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],b=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],I=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],k=[0,1,1,4];function P(y,m,l,f,a){if(!(l+24>m.length)){var i=L(m,l);if(i&&l+i.frameLength<=m.length){var g=i.samplesPerFrame*9e4/i.sampleRate,s=f+a*g,r={unit:m.subarray(l,l+i.frameLength),pts:s,dts:s};return y.config=[],y.channelCount=i.channelCount,y.samplerate=i.sampleRate,y.samples.push(r),{sample:r,length:i.frameLength,missing:0}}}}function L(y,m){var l=y[m+1]>>3&3,f=y[m+1]>>1&3,a=y[m+2]>>4&15,i=y[m+2]>>2&3;if(l!==1&&a!==0&&a!==15&&i!==3){var g=y[m+2]>>1&1,s=y[m+3]>>6,r=l===3?3-f:f===3?3:4,o=A[r*14+a-1]*1e3,v=l===3?0:l===2?1:2,u=b[v*3+i],n=s===3?1:2,t=I[l][f],h=k[f],e=t*8*h,d=Math.floor(t*o/u+g)*h;if(F===null){var p=navigator.userAgent||"",E=p.match(/Chrome\/(\d+)/i);F=E?parseInt(E[1]):0}var D=!!F&&F<=87;return D&&f===2&&o>=224e3&&s===0&&(y[m+3]=y[m+3]|128),{sampleRate:u,channelCount:n,frameLength:d,samplesPerFrame:e}}}function S(y,m){return y[m]===255&&(y[m+1]&224)===224&&(y[m+1]&6)!==0}function _(y,m){return m+1<y.length&&S(y,m)}function T(y,m){var l=4;return S(y,m)&&l<=y.length-m}function c(y,m){if(m+1<y.length&&S(y,m)){var l=4,f=L(y,m),a=l;f!=null&&f.frameLength&&(a=f.frameLength);var i=m+a;return i===y.length||_(y,i)}return!1}},"./src/demux/sample-aes.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>I});var F=x("./src/crypt/decrypter.ts"),A=x("./src/utils/mp4-tools.ts"),b=function(){function k(L,S,_){this.keyData=void 0,this.decrypter=void 0,this.keyData=_,this.decrypter=new F.default(S,{removePKCS7Padding:!1})}var P=k.prototype;return P.decryptBuffer=function(S){return this.decrypter.decrypt(S,this.keyData.key.buffer,this.keyData.iv.buffer)},P.decryptAacSample=function(S,_,T){var c=this,y=S[_].unit;if(!(y.length<=16)){var m=y.subarray(16,y.length-y.length%16),l=m.buffer.slice(m.byteOffset,m.byteOffset+m.length);this.decryptBuffer(l).then(function(f){var a=new Uint8Array(f);y.set(a,16),c.decrypter.isSync()||c.decryptAacSamples(S,_+1,T)})}},P.decryptAacSamples=function(S,_,T){for(;;_++){if(_>=S.length){T();return}if(!(S[_].unit.length<32)&&(this.decryptAacSample(S,_,T),!this.decrypter.isSync()))return}},P.getAvcEncryptedData=function(S){for(var _=Math.floor((S.length-48)/160)*16+16,T=new Int8Array(_),c=0,y=32;y<S.length-16;y+=160,c+=16)T.set(S.subarray(y,y+16),c);return T},P.getAvcDecryptedUnit=function(S,_){for(var T=new Uint8Array(_),c=0,y=32;y<S.length-16;y+=160,c+=16)S.set(T.subarray(c,c+16),y);return S},P.decryptAvcSample=function(S,_,T,c,y){var m=this,l=(0,A.discardEPB)(y.data),f=this.getAvcEncryptedData(l);this.decryptBuffer(f.buffer).then(function(a){y.data=m.getAvcDecryptedUnit(l,a),m.decrypter.isSync()||m.decryptAvcSamples(S,_,T+1,c)})},P.decryptAvcSamples=function(S,_,T,c){if(S instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;_++,T=0){if(_>=S.length){c();return}for(var y=S[_].units;!(T>=y.length);T++){var m=y[T];if(!(m.data.length<=48||m.type!==1&&m.type!==5)&&(this.decryptAvcSample(S,_,T,c,m),!this.decrypter.isSync()))return}}},k}();const I=b},"./src/demux/transmuxer-interface.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>_});var F=x("./src/demux/webworkify-webpack.js"),A=x("./src/events.ts"),b=x("./src/demux/transmuxer.ts"),I=x("./src/utils/logger.ts"),k=x("./src/errors.ts"),P=x("./src/utils/mediasource-helper.ts"),L=x("./node_modules/eventemitter3/index.js"),S=(0,P.getMediaSource)()||{isTypeSupported:function(){return!1}},_=function(){function T(y,m,l,f){var a=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var i=y.config;this.hls=y,this.id=m,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=l,this.onFlush=f;var g=function(u,n){n=n||{},n.frag=a.frag,n.id=a.id,a.hls.trigger(u,n)};this.observer=new L.EventEmitter,this.observer.on(A.Events.FRAG_DECRYPTED,g),this.observer.on(A.Events.ERROR,g);var s={mp4:S.isTypeSupported("video/mp4"),mpeg:S.isTypeSupported("audio/mpeg"),mp3:S.isTypeSupported('audio/mp4; codecs="mp3"')},r=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){I.logger.log("demuxing in webworker");var o;try{o=this.worker=(0,F.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(v){a.useWorker=!1,I.logger.warn("Exception in webworker, fallback to inline"),a.hls.trigger(A.Events.ERROR,{type:k.ErrorTypes.OTHER_ERROR,details:k.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(v.message+"  ("+v.filename+":"+v.lineno+")")})},o.postMessage({cmd:"init",typeSupported:s,vendor:r,id:m,config:JSON.stringify(i)})}catch(v){I.logger.warn("Error in worker:",v),I.logger.error("Error while initializing DemuxerWorker, fallback to inline"),o&&self.URL.revokeObjectURL(o.objectURL),this.transmuxer=new b.default(this.observer,s,i,r,m),this.worker=null}}else this.transmuxer=new b.default(this.observer,s,i,r,m)}var c=T.prototype;return c.destroy=function(){var m=this.worker;if(m)m.removeEventListener("message",this.onwmsg),m.terminate(),this.worker=null,this.onwmsg=void 0;else{var l=this.transmuxer;l&&(l.destroy(),this.transmuxer=null)}var f=this.observer;f&&f.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},c.push=function(m,l,f,a,i,g,s,r,o,v){var u,n,t=this;o.transmuxing.start=self.performance.now();var h=this.transmuxer,e=this.worker,d=g?g.start:i.start,p=i.decryptdata,E=this.frag,D=!(E&&i.cc===E.cc),R=!(E&&o.level===E.level),O=E?o.sn-E.sn:-1,C=this.part?o.part-this.part.index:-1,M=O===0&&o.id>1&&o.id===(E==null?void 0:E.stats.chunkCount),U=!R&&(O===1||O===0&&(C===1||M&&C<=0)),B=self.performance.now();(R||O||i.stats.parsing.start===0)&&(i.stats.parsing.start=B),g&&(C||!U)&&(g.stats.parsing.start=B);var N=!(E&&((u=i.initSegment)===null||u===void 0?void 0:u.url)===((n=E.initSegment)===null||n===void 0?void 0:n.url)),K=new b.TransmuxState(D,U,r,R,d,N);if(!U||D||N){I.logger.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for sn: "+o.sn+" p: "+o.part+" level: "+o.level+" id: "+o.id+`
        discontinuity: `+D+`
        trackSwitch: `+R+`
        contiguous: `+U+`
        accurateTimeOffset: `+r+`
        timeOffset: `+d+`
        initSegmentChange: `+N);var W=new b.TransmuxConfig(f,a,l,s,v);this.configureTransmuxer(W)}if(this.frag=i,this.part=g,e)e.postMessage({cmd:"demux",data:m,decryptdata:p,chunkMeta:o,state:K},m instanceof ArrayBuffer?[m]:[]);else if(h){var G=h.push(m,p,o,K);(0,b.isPromise)(G)?(h.async=!0,G.then(function(j){t.handleTransmuxComplete(j)}).catch(function(j){t.transmuxerError(j,o,"transmuxer-interface push error")})):(h.async=!1,this.handleTransmuxComplete(G))}},c.flush=function(m){var l=this;m.transmuxing.start=self.performance.now();var f=this.transmuxer,a=this.worker;if(a)a.postMessage({cmd:"flush",chunkMeta:m});else if(f){var i=f.flush(m),g=(0,b.isPromise)(i);g||f.async?((0,b.isPromise)(i)||(i=Promise.resolve(i)),i.then(function(s){l.handleFlushResult(s,m)}).catch(function(s){l.transmuxerError(s,m,"transmuxer-interface flush error")})):this.handleFlushResult(i,m)}},c.transmuxerError=function(m,l,f){this.hls&&this.hls.trigger(A.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:l,fatal:!1,error:m,err:m,reason:f})},c.handleFlushResult=function(m,l){var f=this;m.forEach(function(a){f.handleTransmuxComplete(a)}),this.onFlush(l)},c.onWorkerMessage=function(m){var l=m.data,f=this.hls;switch(l.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(l.data);break}case"flush":{this.onFlush(l.data);break}case"workerLog":I.logger[l.data.logType]&&I.logger[l.data.logType](l.data.message);break;default:{l.data=l.data||{},l.data.frag=this.frag,l.data.id=this.id,f.trigger(l.event,l.data);break}}},c.configureTransmuxer=function(m){var l=this.worker,f=this.transmuxer;l?l.postMessage({cmd:"configure",config:m}):f&&f.configure(m)},c.handleTransmuxComplete=function(m){m.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(m)},T}()},"./src/demux/transmuxer-worker.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>P});var F=x("./src/demux/transmuxer.ts"),A=x("./src/events.ts"),b=x("./src/utils/logger.ts"),I=x("./node_modules/eventemitter3/index.js"),k=x("./src/errors.ts");function P(c){var y=new I.EventEmitter,m=function(a,i){c.postMessage({event:a,data:i})};y.on(A.Events.FRAG_DECRYPTED,m),y.on(A.Events.ERROR,m);var l=function(){var a=function(s){var r=function(v){m("workerLog",{logType:s,message:v})};b.logger[s]=r};for(var i in b.logger)a(i)};c.addEventListener("message",function(f){var a=f.data;switch(a.cmd){case"init":{var i=JSON.parse(a.config);c.transmuxer=new F.default(y,a.typeSupported,i,a.vendor,a.id),(0,b.enableLogs)(i.debug,a.id),l(),m("init",null);break}case"configure":{c.transmuxer.configure(a.config);break}case"demux":{var g=c.transmuxer.push(a.data,a.decryptdata,a.chunkMeta,a.state);(0,F.isPromise)(g)?(c.transmuxer.async=!0,g.then(function(v){L(c,v)}).catch(function(v){m(A.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:a.chunkMeta,fatal:!1,error:v,err:v,reason:"transmuxer-worker push error"})})):(c.transmuxer.async=!1,L(c,g));break}case"flush":{var s=a.chunkMeta,r=c.transmuxer.flush(s),o=(0,F.isPromise)(r);o||c.transmuxer.async?((0,F.isPromise)(r)||(r=Promise.resolve(r)),r.then(function(v){_(c,v,s)}).catch(function(v){m(A.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:a.chunkMeta,fatal:!1,error:v,err:v,reason:"transmuxer-worker flush error"})})):_(c,r,s);break}}})}function L(c,y){if(T(y.remuxResult))return!1;var m=[],l=y.remuxResult,f=l.audio,a=l.video;return f&&S(m,f),a&&S(m,a),c.postMessage({event:"transmuxComplete",data:y},m),!0}function S(c,y){y.data1&&c.push(y.data1.buffer),y.data2&&c.push(y.data2.buffer)}function _(c,y,m){var l=y.reduce(function(f,a){return L(c,a)||f},!1);l||c.postMessage({event:"transmuxComplete",data:y[0]}),c.postMessage({event:"flush",data:m})}function T(c){return!c.audio&&!c.video&&!c.text&&!c.id3&&!c.initSegment}},"./src/demux/transmuxer.ts":(V,w,x)=>{x.r(w),x.d(w,{TransmuxConfig:()=>i,TransmuxState:()=>g,default:()=>m,isPromise:()=>a});var F=x("./src/events.ts"),A=x("./src/errors.ts"),b=x("./src/crypt/decrypter.ts"),I=x("./src/demux/aacdemuxer.ts"),k=x("./src/demux/mp4demuxer.ts"),P=x("./src/demux/tsdemuxer.ts"),L=x("./src/demux/mp3demuxer.ts"),S=x("./src/remux/mp4-remuxer.ts"),_=x("./src/remux/passthrough-remuxer.ts"),T=x("./src/utils/logger.ts"),c;try{c=self.performance.now.bind(self.performance)}catch{T.logger.debug("Unable to use Performance API on this environment"),c=self.Date.now}var y=[{demux:k.default,remux:_.default},{demux:P.default,remux:S.default},{demux:I.default,remux:S.default},{demux:L.default,remux:S.default}],m=function(){function s(o,v,u,n,t){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=o,this.typeSupported=v,this.config=u,this.vendor=n,this.id=t}var r=s.prototype;return r.configure=function(v){this.transmuxConfig=v,this.decrypter&&this.decrypter.reset()},r.push=function(v,u,n,t){var h=this,e=n.transmuxing;e.executeStart=c();var d=new Uint8Array(v),p=this.currentTransmuxState,E=this.transmuxConfig;t&&(this.currentTransmuxState=t);var D=t||p,R=D.contiguous,O=D.discontinuity,C=D.trackSwitch,M=D.accurateTimeOffset,U=D.timeOffset,B=D.initSegmentChange,N=E.audioCodec,K=E.videoCodec,W=E.defaultInitPts,G=E.duration,j=E.initSegmentData,H=l(d,u);if(H&&H.method==="AES-128"){var Y=this.getDecrypter();if(Y.isSync()){var Q=Y.softwareDecrypt(d,H.key.buffer,H.iv.buffer);if(!Q)return e.executeEnd=c(),f(n);d=new Uint8Array(Q)}else return this.decryptionPromise=Y.webCryptoDecrypt(d,H.key.buffer,H.iv.buffer).then(function(Z){var J=h.push(Z,null,n);return h.decryptionPromise=null,J}),this.decryptionPromise}var $=this.needsProbing(O,C);$&&this.configureTransmuxer(d),(O||C||B||$)&&this.resetInitSegment(j,N,K,G,u),(O||B||$)&&this.resetInitialTimestamp(W),R||this.resetContiguity();var z=this.transmux(d,H,U,M,n),X=this.currentTransmuxState;return X.contiguous=!0,X.discontinuity=!1,X.trackSwitch=!1,e.executeEnd=c(),z},r.flush=function(v){var u=this,n=v.transmuxing;n.executeStart=c();var t=this.decrypter,h=this.currentTransmuxState,e=this.decryptionPromise;if(e)return e.then(function(){return u.flush(v)});var d=[],p=h.timeOffset;if(t){var E=t.flush();E&&d.push(this.push(E,null,v))}var D=this.demuxer,R=this.remuxer;if(!D||!R)return this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),n.executeEnd=c(),[f(v)];var O=D.flush(p);return a(O)?O.then(function(C){return u.flushRemux(d,C,v),d}):(this.flushRemux(d,O,v),d)},r.flushRemux=function(v,u,n){var t=u.audioTrack,h=u.videoTrack,e=u.id3Track,d=u.textTrack,p=this.currentTransmuxState,E=p.accurateTimeOffset,D=p.timeOffset;T.logger.log("[transmuxer.ts]: Flushed fragment "+n.sn+(n.part>-1?" p: "+n.part:"")+" of level "+n.level);var R=this.remuxer.remux(t,h,e,d,D,E,!0,this.id);v.push({remuxResult:R,chunkMeta:n}),n.transmuxing.executeEnd=c()},r.resetInitialTimestamp=function(v){var u=this.demuxer,n=this.remuxer;!u||!n||(u.resetTimeStamp(v),n.resetTimeStamp(v))},r.resetContiguity=function(){var v=this.demuxer,u=this.remuxer;!v||!u||(v.resetContiguity(),u.resetNextTimestamp())},r.resetInitSegment=function(v,u,n,t,h){var e=this.demuxer,d=this.remuxer;!e||!d||(e.resetInitSegment(v,u,n,t),d.resetInitSegment(v,u,n,h))},r.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},r.transmux=function(v,u,n,t,h){var e;return u&&u.method==="SAMPLE-AES"?e=this.transmuxSampleAes(v,u,n,t,h):e=this.transmuxUnencrypted(v,n,t,h),e},r.transmuxUnencrypted=function(v,u,n,t){var h=this.demuxer.demux(v,u,!1,!this.config.progressive),e=h.audioTrack,d=h.videoTrack,p=h.id3Track,E=h.textTrack,D=this.remuxer.remux(e,d,p,E,u,n,!1,this.id);return{remuxResult:D,chunkMeta:t}},r.transmuxSampleAes=function(v,u,n,t,h){var e=this;return this.demuxer.demuxSampleAes(v,u,n).then(function(d){var p=e.remuxer.remux(d.audioTrack,d.videoTrack,d.id3Track,d.textTrack,n,t,!1,e.id);return{remuxResult:p,chunkMeta:h}})},r.configureTransmuxer=function(v){for(var u=this.config,n=this.observer,t=this.typeSupported,h=this.vendor,e,d=0,p=y.length;d<p;d++)if(y[d].demux.probe(v)){e=y[d];break}e||(T.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),e={demux:k.default,remux:_.default});var E=this.demuxer,D=this.remuxer,R=e.remux,O=e.demux;(!D||!(D instanceof R))&&(this.remuxer=new R(n,u,t,h)),(!E||!(E instanceof O))&&(this.demuxer=new O(n,u,t),this.probe=O.probe)},r.needsProbing=function(v,u){return!this.demuxer||!this.remuxer||v||u},r.getDecrypter=function(){var v=this.decrypter;return v||(v=this.decrypter=new b.default(this.config)),v},s}();function l(s,r){var o=null;return s.byteLength>0&&r!=null&&r.key!=null&&r.iv!==null&&r.method!=null&&(o=r),o}var f=function(r){return{remuxResult:{},chunkMeta:r}};function a(s){return"then"in s&&s.then instanceof Function}var i=function(r,o,v,u,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=r,this.videoCodec=o,this.initSegmentData=v,this.duration=u,this.defaultInitPts=n},g=function(r,o,v,u,n,t){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=r,this.contiguous=o,this.accurateTimeOffset=v,this.trackSwitch=u,this.timeOffset=n,this.initSegmentChange=t}},"./src/demux/tsdemuxer.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>g});var F=x("./src/demux/adts.ts"),A=x("./src/demux/mpegaudio.ts"),b=x("./src/demux/exp-golomb.ts"),I=x("./src/demux/sample-aes.ts"),k=x("./src/events.ts"),P=x("./src/utils/mp4-tools.ts"),L=x("./src/utils/logger.ts"),S=x("./src/errors.ts"),_=x("./src/types/demuxer.ts");function T(){return T=Object.assign?Object.assign.bind():function(s){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&(s[v]=o[v])}return s},T.apply(this,arguments)}var c=188,y=function(){function s(o,v,u){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=o,this.config=v,this.typeSupported=u}s.probe=function(v){var u=s.syncOffset(v);return u>0&&L.logger.warn("MPEG2-TS detected but first sync word found @ offset "+u),u!==-1},s.syncOffset=function(v){for(var u=Math.min(c*5,v.length-c*2)+1,n=0;n<u;){if(v[n]===71&&v[n+c]===71)return n;n++}return-1},s.createTrack=function(v,u){return{container:v==="video"||v==="audio"?"video/mp2t":void 0,type:v,id:P.RemuxerTrackIdConfig[v],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:v==="audio"?u:void 0}};var r=s.prototype;return r.resetInitSegment=function(v,u,n,t){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=s.createTrack("video"),this._audioTrack=s.createTrack("audio",t),this._id3Track=s.createTrack("id3"),this._txtTrack=s.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=u,this.videoCodec=n,this._duration=t},r.resetTimeStamp=function(){},r.resetContiguity=function(){var v=this._audioTrack,u=this._avcTrack,n=this._id3Track;v&&(v.pesData=null),u&&(u.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},r.demux=function(v,u,n,t){n===void 0&&(n=!1),t===void 0&&(t=!1),n||(this.sampleAes=null);var h,e=this._avcTrack,d=this._audioTrack,p=this._id3Track,E=this._txtTrack,D=e.pid,R=e.pesData,O=d.pid,C=p.pid,M=d.pesData,U=p.pesData,B=null,N=this.pmtParsed,K=this._pmtId,W=v.length;if(this.remainderData&&(v=(0,P.appendUint8Array)(this.remainderData,v),W=v.length,this.remainderData=null),W<c&&!t)return this.remainderData=v,{audioTrack:d,videoTrack:e,id3Track:p,textTrack:E};var G=Math.max(0,s.syncOffset(v));W-=(W-G)%c,W<v.byteLength&&!t&&(this.remainderData=new Uint8Array(v.buffer,W,v.buffer.byteLength-W));for(var j=0,H=G;H<W;H+=c)if(v[H]===71){var Y=!!(v[H+1]&64),Q=((v[H+1]&31)<<8)+v[H+2],$=(v[H+3]&48)>>4,z=void 0;if($>1){if(z=H+5+v[H+4],z===H+c)continue}else z=H+4;switch(Q){case D:Y&&(R&&(h=a(R))&&this.parseAVCPES(e,E,h,!1),R={data:[],size:0}),R&&(R.data.push(v.subarray(z,H+c)),R.size+=H+c-z);break;case O:if(Y){if(M&&(h=a(M)))switch(d.segmentCodec){case"aac":this.parseAACPES(d,h);break;case"mp3":this.parseMPEGPES(d,h);break}M={data:[],size:0}}M&&(M.data.push(v.subarray(z,H+c)),M.size+=H+c-z);break;case C:Y&&(U&&(h=a(U))&&this.parseID3PES(p,h),U={data:[],size:0}),U&&(U.data.push(v.subarray(z,H+c)),U.size+=H+c-z);break;case 0:Y&&(z+=v[z]+1),K=this._pmtId=l(v,z);break;case K:{Y&&(z+=v[z]+1);var X=f(v,z,this.typeSupported,n);D=X.avc,D>0&&(e.pid=D),O=X.audio,O>0&&(d.pid=O,d.segmentCodec=X.segmentCodec),C=X.id3,C>0&&(p.pid=C),B!==null&&!N&&(L.logger.log("unknown PID '"+B+"' in TS found"),B=null,H=G-188),N=this.pmtParsed=!0;break}case 17:case 8191:break;default:B=Q;break}}else j++;j>0&&this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+j+" TS packet/s that do not start with 0x47"}),e.pesData=R,d.pesData=M,p.pesData=U;var Z={audioTrack:d,videoTrack:e,id3Track:p,textTrack:E};return t&&this.extractRemainingSamples(Z),Z},r.flush=function(){var v=this.remainderData;this.remainderData=null;var u;return v?u=this.demux(v,-1,!1,!0):u={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(u),this.sampleAes?this.decrypt(u,this.sampleAes):u},r.extractRemainingSamples=function(v){var u=v.audioTrack,n=v.videoTrack,t=v.id3Track,h=v.textTrack,e=n.pesData,d=u.pesData,p=t.pesData,E;if(e&&(E=a(e))?(this.parseAVCPES(n,h,E,!0),n.pesData=null):n.pesData=e,d&&(E=a(d))){switch(u.segmentCodec){case"aac":this.parseAACPES(u,E);break;case"mp3":this.parseMPEGPES(u,E);break}u.pesData=null}else d!=null&&d.size&&L.logger.log("last AAC PES packet truncated,might overlap between fragments"),u.pesData=d;p&&(E=a(p))?(this.parseID3PES(t,E),t.pesData=null):t.pesData=p},r.demuxSampleAes=function(v,u,n){var t=this.demux(v,n,!0,!this.config.progressive),h=this.sampleAes=new I.default(this.observer,this.config,u);return this.decrypt(t,h)},r.decrypt=function(v,u){return new Promise(function(n){var t=v.audioTrack,h=v.videoTrack;t.samples&&t.segmentCodec==="aac"?u.decryptAacSamples(t.samples,0,function(){h.samples?u.decryptAvcSamples(h.samples,0,0,function(){n(v)}):n(v)}):h.samples&&u.decryptAvcSamples(h.samples,0,0,function(){n(v)})})},r.destroy=function(){this._duration=0},r.parseAVCPES=function(v,u,n,t){var h=this,e=this.parseAVCNALu(v,n.data),d=this.avcSample,p,E=!1;n.data=null,d&&e.length&&!v.audFound&&(i(d,v),d=this.avcSample=m(!1,n.pts,n.dts,"")),e.forEach(function(D){switch(D.type){case 1:{p=!0,d||(d=h.avcSample=m(!0,n.pts,n.dts,"")),d.frame=!0;var R=D.data;if(E&&R.length>4){var O=new b.default(R).readSliceType();(O===2||O===4||O===7||O===9)&&(d.key=!0)}break}case 5:p=!0,d||(d=h.avcSample=m(!0,n.pts,n.dts,"")),d.key=!0,d.frame=!0;break;case 6:{p=!0,(0,P.parseSEIMessageFromNALu)(D.data,1,n.pts,u.samples);break}case 7:if(p=!0,E=!0,!v.sps){var C=new b.default(D.data),M=C.readSPS();v.width=M.width,v.height=M.height,v.pixelRatio=M.pixelRatio,v.sps=[D.data],v.duration=h._duration;for(var U=D.data.subarray(1,4),B="avc1.",N=0;N<3;N++){var K=U[N].toString(16);K.length<2&&(K="0"+K),B+=K}v.codec=B}break;case 8:p=!0,v.pps||(v.pps=[D.data]);break;case 9:p=!1,v.audFound=!0,d&&i(d,v),d=h.avcSample=m(!1,n.pts,n.dts,"");break;case 12:p=!0;break;default:p=!1,d&&(d.debug+="unknown NAL "+D.type+" ");break}if(d&&p){var W=d.units;W.push(D)}}),t&&d&&(i(d,v),this.avcSample=null)},r.getLastNalUnit=function(v){var u,n=this.avcSample,t;if((!n||n.units.length===0)&&(n=v[v.length-1]),(u=n)!==null&&u!==void 0&&u.units){var h=n.units;t=h[h.length-1]}return t},r.parseAVCNALu=function(v,u){var n=u.byteLength,t=v.naluState||0,h=t,e=[],d=0,p,E,D,R=-1,O=0;for(t===-1&&(R=0,O=u[0]&31,t=0,d=1);d<n;){if(p=u[d++],!t){t=p?0:1;continue}if(t===1){t=p?0:2;continue}if(!p)t=3;else if(p===1){if(R>=0){var C={data:u.subarray(R,d-t-1),type:O};e.push(C)}else{var M=this.getLastNalUnit(v.samples);if(M&&(h&&d<=4-h&&M.state&&(M.data=M.data.subarray(0,M.data.byteLength-h)),E=d-t-1,E>0)){var U=new Uint8Array(M.data.byteLength+E);U.set(M.data,0),U.set(u.subarray(0,E),M.data.byteLength),M.data=U,M.state=0}}d<n?(D=u[d]&31,R=d,O=D,t=0):t=-1}else t=0}if(R>=0&&t>=0){var B={data:u.subarray(R,n),type:O,state:t};e.push(B)}if(e.length===0){var N=this.getLastNalUnit(v.samples);if(N){var K=new Uint8Array(N.data.byteLength+u.byteLength);K.set(N.data,0),K.set(u,N.data.byteLength),N.data=K}}return v.naluState=t,e},r.parseAACPES=function(v,u){var n=0,t=this.aacOverFlow,h=u.data;if(t){this.aacOverFlow=null;var e=t.missing,d=t.sample.unit.byteLength;if(e===-1){var p=new Uint8Array(d+h.byteLength);p.set(t.sample.unit,0),p.set(h,d),h=p}else{var E=d-e;t.sample.unit.set(h.subarray(0,e),E),v.samples.push(t.sample),n=t.missing}}var D,R;for(D=n,R=h.length;D<R-1&&!F.isHeader(h,D);D++);if(D!==n){var O,C;if(D<R-1?(O="AAC PES did not start with ADTS header,offset:"+D,C=!1):(O="no ADTS header found in AAC PES",C=!0),L.logger.warn("parsing error:"+O),this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:C,reason:O}),C)return}F.initTrackConfig(v,this.observer,h,D,this.audioCodec);var M;if(u.pts!==void 0)M=u.pts;else if(t){var U=F.getFrameDuration(v.samplerate);M=t.sample.pts+U}else{L.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var B=0,N;D<R;)if(N=F.appendFrame(v,h,D,M,B),D+=N.length,N.missing){this.aacOverFlow=N;break}else for(B++;D<R-1&&!F.isHeader(h,D);D++);},r.parseMPEGPES=function(v,u){var n=u.data,t=n.length,h=0,e=0,d=u.pts;if(d===void 0){L.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;e<t;)if(A.isHeader(n,e)){var p=A.appendFrame(v,n,e,d,h);if(p)e+=p.length,h++;else break}else e++},r.parseID3PES=function(v,u){if(u.pts===void 0){L.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var n=T({},u,{type:this._avcTrack?_.MetadataSchema.emsg:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});v.samples.push(n)},s}();function m(s,r,o,v){return{key:s,frame:!1,pts:r,dts:o,units:[],debug:v,length:0}}function l(s,r){return(s[r+10]&31)<<8|s[r+11]}function f(s,r,o,v){var u={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},n=(s[r+1]&15)<<8|s[r+2],t=r+3+n-4,h=(s[r+10]&15)<<8|s[r+11];for(r+=12+h;r<t;){var e=(s[r+1]&31)<<8|s[r+2];switch(s[r]){case 207:if(!v){L.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:u.audio===-1&&(u.audio=e);break;case 21:u.id3===-1&&(u.id3=e);break;case 219:if(!v){L.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:u.avc===-1&&(u.avc=e);break;case 3:case 4:o.mpeg!==!0&&o.mp3!==!0?L.logger.log("MPEG audio found, not supported in this browser"):u.audio===-1&&(u.audio=e,u.segmentCodec="mp3");break;case 36:L.logger.warn("Unsupported HEVC stream type found");break}r+=((s[r+3]&15)<<8|s[r+4])+5}return u}function a(s){var r=0,o,v,u,n,t,h=s.data;if(!s||s.size===0)return null;for(;h[0].length<19&&h.length>1;){var e=new Uint8Array(h[0].length+h[1].length);e.set(h[0]),e.set(h[1],h[0].length),h[0]=e,h.splice(1,1)}o=h[0];var d=(o[0]<<16)+(o[1]<<8)+o[2];if(d===1){if(v=(o[4]<<8)+o[5],v&&v>s.size-6)return null;var p=o[7];p&192&&(n=(o[9]&14)*536870912+(o[10]&255)*4194304+(o[11]&254)*16384+(o[12]&255)*128+(o[13]&254)/2,p&64?(t=(o[14]&14)*536870912+(o[15]&255)*4194304+(o[16]&254)*16384+(o[17]&255)*128+(o[18]&254)/2,n-t>54e5&&(L.logger.warn(Math.round((n-t)/9e4)+"s delta between PTS and DTS, align them"),n=t)):t=n),u=o[8];var E=u+9;if(s.size<=E)return null;s.size-=E;for(var D=new Uint8Array(s.size),R=0,O=h.length;R<O;R++){o=h[R];var C=o.byteLength;if(E)if(E>C){E-=C;continue}else o=o.subarray(E),C-=E,E=0;D.set(o,r),r+=C}return v&&(v-=u+3),{data:D,pts:n,dts:t,len:v}}return null}function i(s,r){if(s.units.length&&s.frame){if(s.pts===void 0){var o=r.samples,v=o.length;if(v){var u=o[v-1];s.pts=u.pts,s.dts=u.dts}else{r.dropped++;return}}r.samples.push(s)}s.debug.length&&L.logger.log(s.pts+"/"+s.dts+":"+s.debug)}const g=y},"./src/demux/webworkify-webpack.js":(V,w,x)=>{x.r(w),x.d(w,{default:()=>c});var F=function(){var m=ENTRY_MODULE,l={},f=function i(g){var s=l[g];if(s!==void 0)return s.exports;var r=l[g]={exports:{}};return m[g].call(r.exports,r,r.exports,i),r.exports};f.m=m,function(){f.n=function(i){var g=i&&i.__esModule?function(){return i.default}:function(){return i};return f.d(g,{a:g}),g}}(),function(){f.d=function(i,g){for(var s in g)f.o(g,s)&&!f.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:g[s]})}}(),function(){f.o=function(i,g){return Object.prototype.hasOwnProperty.call(i,g)}}(),function(){f.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})}}();var a=f(ENTRY_MODULE);return a.default||a},A=F.toString().split("ENTRY_MODULE"),b="[\\.|\\-|\\+|\\w|/|@]+",I="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+b+").*?\\)";function k(y){return(y+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function P(y){return!isNaN(1*y)}function L(y,m,l){var f={};f[l]=[];var a=m.toString().replace(/^"[^"]+"/,"function"),i=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||a.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!i)return f;for(var g=i[1],s=new RegExp("(\\\\n|\\W)"+k(g)+I,"g"),r;r=s.exec(a);)r[3]!=="dll-reference"&&f[l].push(r[3]);for(s=new RegExp("\\("+k(g)+'\\("(dll-reference\\s('+b+'))"\\)\\)'+I,"g");r=s.exec(a);)y[r[2]]||(f[l].push(r[1]),y[r[2]]=x(r[1]).m),f[r[2]]=f[r[2]]||[],f[r[2]].push(r[4]);for(var o=Object.keys(f),v=0;v<o.length;v++)for(var u=0;u<f[o[v]].length;u++)P(f[o[v]][u])&&(f[o[v]][u]=1*f[o[v]][u]);return f}function S(y){var m=Object.keys(y);return m.reduce(function(l,f){return l||y[f].length>0},!1)}function _(y,m){for(var l={main:[m]},f={main:[]},a={main:{}};S(l);)for(var i=Object.keys(l),g=0;g<i.length;g++){var s=i[g],r=l[s],o=r.pop();if(a[s]=a[s]||{},!(a[s][o]||!y[s][o])){a[s][o]=!0,f[s]=f[s]||[],f[s].push(o);for(var v=L(y,y[s][o],s),u=Object.keys(v),n=0;n<u.length;n++)l[u[n]]=l[u[n]]||[],l[u[n]]=l[u[n]].concat(v[u[n]])}}return f}function T(y,m,l,f){var a=y[f].map(function(i){return'"'+i+'": '+m[f][i].toString().replace(/^"[^"]+"/,"function")}).join(",");return A[0]+"{"+a+"}"+A[1]+'"'+l+'"'+A[2]}function c(y,m){m=m||{};var l={main:x.m},f=m.all?{main:Object.keys(l.main)}:_(l,y),a="";Object.keys(f).filter(function(o){return o!=="main"}).forEach(function(o){for(var v=0;f[o][v];)v++;f[o].push(v),l[o][v]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+("var "+o+" = ("+T(f,l,v,modules)+`)();
`)}),a=a+("new (("+T(f,l,y,"main")+")())(self);");var i=new window.Blob([a],{type:"text/javascript"}),g=window.URL||window.webkitURL||window.mozURL||window.msURL,s=g.createObjectURL(i),r=new window.Worker(s);return r.objectURL=s,r}},"./src/errors.ts":(V,w,x)=>{x.r(w),x.d(w,{ErrorDetails:()=>A,ErrorTypes:()=>F});var F;(function(b){b.NETWORK_ERROR="networkError",b.MEDIA_ERROR="mediaError",b.KEY_SYSTEM_ERROR="keySystemError",b.MUX_ERROR="muxError",b.OTHER_ERROR="otherError"})(F||(F={}));var A;(function(b){b.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",b.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",b.KEY_SYSTEM_NO_SESSION="keySystemNoSession",b.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",b.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",b.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",b.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",b.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",b.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",b.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",b.MANIFEST_LOAD_ERROR="manifestLoadError",b.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",b.MANIFEST_PARSING_ERROR="manifestParsingError",b.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",b.LEVEL_EMPTY_ERROR="levelEmptyError",b.LEVEL_LOAD_ERROR="levelLoadError",b.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",b.LEVEL_SWITCH_ERROR="levelSwitchError",b.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",b.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",b.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",b.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",b.FRAG_LOAD_ERROR="fragLoadError",b.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",b.FRAG_DECRYPT_ERROR="fragDecryptError",b.FRAG_PARSING_ERROR="fragParsingError",b.REMUX_ALLOC_ERROR="remuxAllocError",b.KEY_LOAD_ERROR="keyLoadError",b.KEY_LOAD_TIMEOUT="keyLoadTimeOut",b.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",b.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",b.BUFFER_APPEND_ERROR="bufferAppendError",b.BUFFER_APPENDING_ERROR="bufferAppendingError",b.BUFFER_STALLED_ERROR="bufferStalledError",b.BUFFER_FULL_ERROR="bufferFullError",b.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",b.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",b.INTERNAL_EXCEPTION="internalException",b.INTERNAL_ABORTED="aborted",b.UNKNOWN="unknown"})(A||(A={}))},"./src/events.ts":(V,w,x)=>{x.r(w),x.d(w,{Events:()=>F});var F;(function(A){A.MEDIA_ATTACHING="hlsMediaAttaching",A.MEDIA_ATTACHED="hlsMediaAttached",A.MEDIA_DETACHING="hlsMediaDetaching",A.MEDIA_DETACHED="hlsMediaDetached",A.BUFFER_RESET="hlsBufferReset",A.BUFFER_CODECS="hlsBufferCodecs",A.BUFFER_CREATED="hlsBufferCreated",A.BUFFER_APPENDING="hlsBufferAppending",A.BUFFER_APPENDED="hlsBufferAppended",A.BUFFER_EOS="hlsBufferEos",A.BUFFER_FLUSHING="hlsBufferFlushing",A.BUFFER_FLUSHED="hlsBufferFlushed",A.MANIFEST_LOADING="hlsManifestLoading",A.MANIFEST_LOADED="hlsManifestLoaded",A.MANIFEST_PARSED="hlsManifestParsed",A.LEVEL_SWITCHING="hlsLevelSwitching",A.LEVEL_SWITCHED="hlsLevelSwitched",A.LEVEL_LOADING="hlsLevelLoading",A.LEVEL_LOADED="hlsLevelLoaded",A.LEVEL_UPDATED="hlsLevelUpdated",A.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",A.LEVELS_UPDATED="hlsLevelsUpdated",A.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",A.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",A.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",A.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",A.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",A.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",A.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",A.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",A.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",A.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",A.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",A.CUES_PARSED="hlsCuesParsed",A.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",A.INIT_PTS_FOUND="hlsInitPtsFound",A.FRAG_LOADING="hlsFragLoading",A.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",A.FRAG_LOADED="hlsFragLoaded",A.FRAG_DECRYPTED="hlsFragDecrypted",A.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",A.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",A.FRAG_PARSING_METADATA="hlsFragParsingMetadata",A.FRAG_PARSED="hlsFragParsed",A.FRAG_BUFFERED="hlsFragBuffered",A.FRAG_CHANGED="hlsFragChanged",A.FPS_DROP="hlsFpsDrop",A.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",A.ERROR="hlsError",A.DESTROYING="hlsDestroying",A.KEY_LOADING="hlsKeyLoading",A.KEY_LOADED="hlsKeyLoaded",A.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",A.BACK_BUFFER_REACHED="hlsBackBufferReached"})(F||(F={}))},"./src/hls.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>r});var F=x("./node_modules/url-toolkit/src/url-toolkit.js"),A=x("./src/loader/playlist-loader.ts"),b=x("./src/controller/id3-track-controller.ts"),I=x("./src/controller/latency-controller.ts"),k=x("./src/controller/level-controller.ts"),P=x("./src/controller/fragment-tracker.ts"),L=x("./src/loader/key-loader.ts"),S=x("./src/controller/stream-controller.ts"),_=x("./src/is-supported.ts"),T=x("./src/utils/logger.ts"),c=x("./src/config.ts"),y=x("./node_modules/eventemitter3/index.js"),m=x("./src/events.ts"),l=x("./src/errors.ts"),f=x("./src/types/level.ts");function a(o,v){for(var u=0;u<v.length;u++){var n=v[u];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,g(n.key),n)}}function i(o,v,u){return v&&a(o.prototype,v),u&&a(o,u),Object.defineProperty(o,"prototype",{writable:!1}),o}function g(o){var v=s(o,"string");return typeof v=="symbol"?v:String(v)}function s(o,v){if(typeof o!="object"||o===null)return o;var u=o[Symbol.toPrimitive];if(u!==void 0){var n=u.call(o,v||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(v==="string"?String:Number)(o)}var r=function(){o.isSupported=function(){return(0,_.isSupported)()};function o(u){u===void 0&&(u={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new y.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var n=this.config=(0,c.mergeConfig)(o.DefaultConfig,u);this.userConfig=u,(0,T.enableLogs)(n.debug,"Hls instance"),this._autoLevelCapping=-1,n.progressive&&(0,c.enableStreamingMode)(n);var t=n.abrController,h=n.bufferController,e=n.capLevelController,d=n.fpsController,p=this.abrController=new t(this),E=this.bufferController=new h(this),D=this.capLevelController=new e(this),R=new d(this),O=new A.default(this),C=new b.default(this),M=this.levelController=new k.default(this),U=new P.FragmentTracker(this),B=new L.default(this.config),N=this.streamController=new S.default(this,U,B);D.setStreamController(N),R.setStreamController(N);var K=[O,M,N];this.networkControllers=K;var W=[p,E,D,R,C,U];this.audioTrackController=this.createController(n.audioTrackController,K);var G=n.audioStreamController;G&&K.push(new G(this,U,B)),this.subtitleTrackController=this.createController(n.subtitleTrackController,K);var j=n.subtitleStreamController;j&&K.push(new j(this,U,B)),this.createController(n.timelineController,W),B.emeController=this.emeController=this.createController(n.emeController,W),this.cmcdController=this.createController(n.cmcdController,W),this.latencyController=this.createController(I.default,W),this.coreComponents=W}var v=o.prototype;return v.createController=function(n,t){if(n){var h=new n(this);return t&&t.push(h),h}return null},v.on=function(n,t,h){h===void 0&&(h=this),this._emitter.on(n,t,h)},v.once=function(n,t,h){h===void 0&&(h=this),this._emitter.once(n,t,h)},v.removeAllListeners=function(n){this._emitter.removeAllListeners(n)},v.off=function(n,t,h,e){h===void 0&&(h=this),this._emitter.off(n,t,h,e)},v.listeners=function(n){return this._emitter.listeners(n)},v.emit=function(n,t,h){return this._emitter.emit(n,t,h)},v.trigger=function(n,t){if(this.config.debug)return this.emit(n,n,t);try{return this.emit(n,n,t)}catch(h){T.logger.error("An internal error happened while handling event "+n+'. Error message: "'+h.message+'". Here is a stacktrace:',h),this.trigger(m.Events.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:n,error:h})}return!1},v.listenerCount=function(n){return this._emitter.listenerCount(n)},v.destroy=function(){T.logger.log("destroy"),this.trigger(m.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(n){return n.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(n){return n.destroy()}),this.coreComponents.length=0},v.attachMedia=function(n){T.logger.log("attachMedia"),this._media=n,this.trigger(m.Events.MEDIA_ATTACHING,{media:n})},v.detachMedia=function(){T.logger.log("detachMedia"),this.trigger(m.Events.MEDIA_DETACHING,void 0),this._media=null},v.loadSource=function(n){this.stopLoad();var t=this.media,h=this.url,e=this.url=F.buildAbsoluteURL(self.location.href,n,{alwaysNormalize:!0});T.logger.log("loadSource:"+e),t&&h&&h!==e&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(m.Events.MANIFEST_LOADING,{url:n})},v.startLoad=function(n){n===void 0&&(n=-1),T.logger.log("startLoad("+n+")"),this.networkControllers.forEach(function(t){t.startLoad(n)})},v.stopLoad=function(){T.logger.log("stopLoad"),this.networkControllers.forEach(function(n){n.stopLoad()})},v.swapAudioCodec=function(){T.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},v.recoverMediaError=function(){T.logger.log("recoverMediaError");var n=this._media;this.detachMedia(),n&&this.attachMedia(n)},v.removeLevel=function(n,t){t===void 0&&(t=0),this.levelController.removeLevel(n,t)},i(o,[{key:"levels",get:function(){var n=this.levelController.levels;return n||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(n){T.logger.log("set currentLevel:"+n),this.loadLevel=n,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(n){T.logger.log("set nextLevel:"+n),this.levelController.manualLevel=n,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(n){T.logger.log("set loadLevel:"+n),this.levelController.manualLevel=n}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(n){this.levelController.nextLoadLevel=n}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(n){T.logger.log("set firstLevel:"+n),this.levelController.firstLevel=n}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(n){T.logger.log("set startLevel:"+n),n!==-1&&(n=Math.max(n,this.minAutoLevel)),this.levelController.startLevel=n}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(n){var t=!!n;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(n){this._autoLevelCapping!==n&&(T.logger.log("set autoLevelCapping:"+n),this._autoLevelCapping=n)}},{key:"bandwidthEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(n){f.HdcpLevels.indexOf(n)>-1&&(this._maxHdcpLevel=n)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var n=this.levels,t=this.config.minAutoBitrate;if(!n)return 0;for(var h=n.length,e=0;e<h;e++)if(n[e].maxBitrate>=t)return e;return 0}},{key:"maxAutoLevel",get:function(){var n=this.levels,t=this.autoLevelCapping,h=this.maxHdcpLevel,e;if(t===-1&&n&&n.length?e=n.length-1:e=t,h)for(var d=e;d--;){var p=n[d].attrs["HDCP-LEVEL"];if(p&&p<=h)return d}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(n){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,n)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var n=this.audioTrackController;return n?n.audioTracks:[]}},{key:"audioTrack",get:function(){var n=this.audioTrackController;return n?n.audioTrack:-1},set:function(n){var t=this.audioTrackController;t&&(t.audioTrack=n)}},{key:"subtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTrack:-1},set:function(n){var t=this.subtitleTrackController;t&&(t.subtitleTrack=n)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var n=this.subtitleTrackController;return n?n.subtitleDisplay:!1},set:function(n){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=n)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(n){this.config.lowLatencyMode=n}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.3.1"}},{key:"Events",get:function(){return m.Events}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return o.defaultConfig?o.defaultConfig:c.hlsDefaultConfig},set:function(n){o.defaultConfig=n}}]),o}();r.defaultConfig=void 0},"./src/is-supported.ts":(V,w,x)=>{x.r(w),x.d(w,{changeTypeSupported:()=>I,isSupported:()=>b});var F=x("./src/utils/mediasource-helper.ts");function A(){return self.SourceBuffer||self.WebKitSourceBuffer}function b(){var k=(0,F.getMediaSource)();if(!k)return!1;var P=A(),L=k&&typeof k.isTypeSupported=="function"&&k.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),S=!P||P.prototype&&typeof P.prototype.appendBuffer=="function"&&typeof P.prototype.remove=="function";return!!L&&!!S}function I(){var k,P=A();return typeof(P==null||(k=P.prototype)===null||k===void 0?void 0:k.changeType)=="function"}},"./src/loader/date-range.ts":(V,w,x)=>{x.r(w),x.d(w,{DateRange:()=>T,DateRangeAttribute:()=>_});var F=x("./src/polyfills/number.ts"),A=x("./src/utils/attr-list.ts"),b=x("./src/utils/logger.ts");function I(){return I=Object.assign?Object.assign.bind():function(c){for(var y=1;y<arguments.length;y++){var m=arguments[y];for(var l in m)Object.prototype.hasOwnProperty.call(m,l)&&(c[l]=m[l])}return c},I.apply(this,arguments)}function k(c,y){for(var m=0;m<y.length;m++){var l=y[m];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(c,L(l.key),l)}}function P(c,y,m){return y&&k(c.prototype,y),m&&k(c,m),Object.defineProperty(c,"prototype",{writable:!1}),c}function L(c){var y=S(c,"string");return typeof y=="symbol"?y:String(y)}function S(c,y){if(typeof c!="object"||c===null)return c;var m=c[Symbol.toPrimitive];if(m!==void 0){var l=m.call(c,y||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(c)}var _;(function(c){c.ID="ID",c.CLASS="CLASS",c.START_DATE="START-DATE",c.DURATION="DURATION",c.END_DATE="END-DATE",c.END_ON_NEXT="END-ON-NEXT",c.PLANNED_DURATION="PLANNED-DURATION",c.SCTE35_OUT="SCTE35-OUT",c.SCTE35_IN="SCTE35-IN"})(_||(_={}));var T=function(){function c(y,m){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,m){var l=m.attr;for(var f in l)if(Object.prototype.hasOwnProperty.call(y,f)&&y[f]!==l[f]){b.logger.warn('DATERANGE tag attribute: "'+f+'" does not match for tags with ID: "'+y.ID+'"'),this._badValueForSameId=f;break}y=I(new A.AttrList({}),l,y)}if(this.attr=y,this._startDate=new Date(y[_.START_DATE]),_.END_DATE in this.attr){var a=new Date(this.attr[_.END_DATE]);(0,F.isFiniteNumber)(a.getTime())&&(this._endDate=a)}}return P(c,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var m=this.duration;return m!==null?new Date(this._startDate.getTime()+m*1e3):null}},{key:"duration",get:function(){if(_.DURATION in this.attr){var m=this.attr.decimalFloatingPoint(_.DURATION);if((0,F.isFiniteNumber)(m))return m}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return _.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(_.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(_.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,F.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),c}()},"./src/loader/fragment-loader.ts":(V,w,x)=>{x.r(w),x.d(w,{LoadError:()=>m,default:()=>c});var F=x("./src/polyfills/number.ts"),A=x("./src/errors.ts");function b(l,f){l.prototype=Object.create(f.prototype),l.prototype.constructor=l,S(l,f)}function I(l){var f=typeof Map=="function"?new Map:void 0;return I=function(i){if(i===null||!L(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof f<"u"){if(f.has(i))return f.get(i);f.set(i,g)}function g(){return k(i,arguments,_(this).constructor)}return g.prototype=Object.create(i.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),S(g,i)},I(l)}function k(l,f,a){return P()?k=Reflect.construct.bind():k=function(g,s,r){var o=[null];o.push.apply(o,s);var v=Function.bind.apply(g,o),u=new v;return r&&S(u,r.prototype),u},k.apply(null,arguments)}function P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function L(l){return Function.toString.call(l).indexOf("[native code]")!==-1}function S(l,f){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,g){return i.__proto__=g,i},S(l,f)}function _(l){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_(l)}var T=Math.pow(2,17),c=function(){function l(a){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=a}var f=l.prototype;return f.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},f.abort=function(){this.loader&&this.loader.abort()},f.load=function(i,g){var s=this,r=i.url;if(!r)return Promise.reject(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var o=this.config,v=o.fLoader,u=o.loader;return new Promise(function(n,t){s.loader&&s.loader.destroy();var h=s.loader=i.loader=v?new v(o):new u(o),e=y(i),d={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:i.sn==="initSegment"?1/0:T};i.stats=h.stats,h.load(e,d,{onSuccess:function(E,D,R,O){s.resetLoader(i,h);var C=E.data;R.resetIV&&i.decryptdata&&(i.decryptdata.iv=new Uint8Array(C.slice(0,16)),C=C.slice(16)),n({frag:i,part:null,payload:C,networkDetails:O})},onError:function(E,D,R){s.resetLoader(i,h),t(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,response:E,networkDetails:R}))},onAbort:function(E,D,R){s.resetLoader(i,h),t(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:i,networkDetails:R}))},onTimeout:function(E,D,R){s.resetLoader(i,h),t(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i,networkDetails:R}))},onProgress:function(E,D,R,O){g&&g({frag:i,part:null,payload:R,networkDetails:O})}})})},f.loadPart=function(i,g,s){var r=this;this.abort();var o=this.config,v=o.fLoader,u=o.loader;return new Promise(function(n,t){r.loader&&r.loader.destroy();var h=r.loader=i.loader=v?new v(o):new u(o),e=y(i,g),d={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:T};g.stats=h.stats,h.load(e,d,{onSuccess:function(E,D,R,O){r.resetLoader(i,h),r.updateStatsFromPart(i,g);var C={frag:i,part:g,payload:E.data,networkDetails:O};s(C),n(C)},onError:function(E,D,R){r.resetLoader(i,h),t(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,part:g,response:E,networkDetails:R}))},onAbort:function(E,D,R){i.stats.aborted=g.stats.aborted,r.resetLoader(i,h),t(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:i,part:g,networkDetails:R}))},onTimeout:function(E,D,R){r.resetLoader(i,h),t(new m({type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i,part:g,networkDetails:R}))}})})},f.updateStatsFromPart=function(i,g){var s=i.stats,r=g.stats,o=r.total;if(s.loaded+=r.loaded,o){var v=Math.round(i.duration/g.duration),u=Math.min(Math.round(s.loaded/o),v),n=v-u,t=n*Math.round(s.loaded/u);s.total=s.loaded+t}else s.total=Math.max(s.loaded,s.total);var h=s.loading,e=r.loading;h.start?h.first+=e.first-e.start:(h.start=e.start,h.first=e.first),h.end=e.end},f.resetLoader=function(i,g){i.loader=null,this.loader===g&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),g.destroy()},l}();function y(l,f){f===void 0&&(f=null);var a=f||l,i={frag:l,part:f,responseType:"arraybuffer",url:a.url,headers:{},rangeStart:0,rangeEnd:0},g=a.byteRangeStartOffset,s=a.byteRangeEndOffset;if((0,F.isFiniteNumber)(g)&&(0,F.isFiniteNumber)(s)){var r,o=g,v=s;if(l.sn==="initSegment"&&((r=l.decryptdata)===null||r===void 0?void 0:r.method)==="AES-128"){var u=s-g;u%16&&(v=s+(16-u%16)),g!==0&&(i.resetIV=!0,o=g-16)}i.rangeStart=o,i.rangeEnd=v}return i}var m=function(l){b(f,l);function f(a){for(var i,g=arguments.length,s=new Array(g>1?g-1:0),r=1;r<g;r++)s[r-1]=arguments[r];return i=l.call.apply(l,[this].concat(s))||this,i.data=void 0,i.data=a,i}return f}(I(Error))},"./src/loader/fragment.ts":(V,w,x)=>{x.r(w),x.d(w,{BaseSegment:()=>c,ElementaryStreamTypes:()=>T,Fragment:()=>y,Part:()=>m});var F=x("./src/polyfills/number.ts"),A=x("./node_modules/url-toolkit/src/url-toolkit.js"),b=x("./src/loader/load-stats.ts");function I(l,f){l.prototype=Object.create(f.prototype),l.prototype.constructor=l,k(l,f)}function k(l,f){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,g){return i.__proto__=g,i},k(l,f)}function P(l,f){for(var a=0;a<f.length;a++){var i=f[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(l,S(i.key),i)}}function L(l,f,a){return f&&P(l.prototype,f),a&&P(l,a),Object.defineProperty(l,"prototype",{writable:!1}),l}function S(l){var f=_(l,"string");return typeof f=="symbol"?f:String(f)}function _(l,f){if(typeof l!="object"||l===null)return l;var a=l[Symbol.toPrimitive];if(a!==void 0){var i=a.call(l,f||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(l)}var T;(function(l){l.AUDIO="audio",l.VIDEO="video",l.AUDIOVIDEO="audiovideo"})(T||(T={}));var c=function(){function l(a){var i;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(i={},i[T.AUDIO]=null,i[T.VIDEO]=null,i[T.AUDIOVIDEO]=null,i),this.baseurl=a}var f=l.prototype;return f.setByteRange=function(i,g){var s=i.split("@",2),r=[];s.length===1?r[0]=g?g.byteRangeEndOffset:0:r[0]=parseInt(s[1]),r[1]=parseInt(s[0])+r[0],this._byteRange=r},L(l,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,A.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(i){this._url=i}}]),l}(),y=function(l){I(f,l);function f(i,g){var s;return s=l.call(this,g)||this,s._decryptdata=null,s.rawProgramDateTime=null,s.programDateTime=null,s.tagList=[],s.duration=0,s.sn=0,s.levelkeys=void 0,s.type=void 0,s.loader=null,s.keyLoader=null,s.level=-1,s.cc=0,s.startPTS=void 0,s.endPTS=void 0,s.appendedPTS=void 0,s.startDTS=void 0,s.endDTS=void 0,s.start=0,s.deltaPTS=void 0,s.maxStartPTS=void 0,s.minEndPTS=void 0,s.stats=new b.LoadStats,s.urlId=0,s.data=void 0,s.bitrateTest=!1,s.title=null,s.initSegment=null,s.endList=void 0,s.type=i,s}var a=f.prototype;return a.setKeyFormat=function(g){if(this.levelkeys){var s=this.levelkeys[g];s&&!this._decryptdata&&(this._decryptdata=s.getDecryptData(this.sn))}},a.abortRequests=function(){var g,s;(g=this.loader)===null||g===void 0||g.abort(),(s=this.keyLoader)===null||s===void 0||s.abort()},a.setElementaryStreamInfo=function(g,s,r,o,v,u){u===void 0&&(u=!1);var n=this.elementaryStreams,t=n[g];if(!t){n[g]={startPTS:s,endPTS:r,startDTS:o,endDTS:v,partial:u};return}t.startPTS=Math.min(t.startPTS,s),t.endPTS=Math.max(t.endPTS,r),t.startDTS=Math.min(t.startDTS,o),t.endDTS=Math.max(t.endDTS,v)},a.clearElementaryStreamInfo=function(){var g=this.elementaryStreams;g[T.AUDIO]=null,g[T.VIDEO]=null,g[T.AUDIOVIDEO]=null},L(f,[{key:"decryptdata",get:function(){var g=this.levelkeys;if(!g&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var s=this.levelkeys.identity;if(s)this._decryptdata=s.getDecryptData(this.sn);else{var r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,F.isFiniteNumber)(this.programDateTime))return null;var g=(0,F.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+g*1e3}},{key:"encrypted",get:function(){var g;if((g=this._decryptdata)!==null&&g!==void 0&&g.encrypted)return!0;if(this.levelkeys){var s=Object.keys(this.levelkeys),r=s.length;if(r>1||r===1&&this.levelkeys[s[0]].encrypted)return!0}return!1}}]),f}(c),m=function(l){I(f,l);function f(a,i,g,s,r){var o;o=l.call(this,g)||this,o.fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new b.LoadStats,o.duration=a.decimalFloatingPoint("DURATION"),o.gap=a.bool("GAP"),o.independent=a.bool("INDEPENDENT"),o.relurl=a.enumeratedString("URI"),o.fragment=i,o.index=s;var v=a.enumeratedString("BYTERANGE");return v&&o.setByteRange(v,r),r&&(o.fragOffset=r.fragOffset+r.duration),o}return L(f,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var i=this.elementaryStreams;return!!(i.audio||i.video||i.audiovideo)}}]),f}(c)},"./src/loader/key-loader.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>b});var F=x("./src/errors.ts"),A=x("./src/loader/fragment-loader.ts"),b=function(){function I(P){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=P}var k=I.prototype;return k.abort=function(){for(var L in this.keyUriToKeyInfo){var S=this.keyUriToKeyInfo[L].loader;S&&S.abort()}},k.detach=function(){for(var L in this.keyUriToKeyInfo){var S=this.keyUriToKeyInfo[L];(S.mediaKeySessionContext||S.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[L]}},k.destroy=function(){this.detach();for(var L in this.keyUriToKeyInfo){var S=this.keyUriToKeyInfo[L].loader;S&&S.destroy()}this.keyUriToKeyInfo={}},k.createKeyLoadError=function(L,S,_,T){return S===void 0&&(S=F.ErrorDetails.KEY_LOAD_ERROR),new A.LoadError({type:F.ErrorTypes.NETWORK_ERROR,details:S,fatal:!1,frag:L,networkDetails:_})},k.loadClear=function(L,S){var _=this;if(this.emeController&&this.config.emeEnabled)for(var T=L.sn,c=L.cc,y=function(a){var i=S[a];if(c<=i.cc&&(T==="initSegment"||T<i.sn))return _.emeController.selectKeySystemFormat(i).then(function(g){i.setKeyFormat(g)}),"break"},m=0;m<S.length;m++){var l=y(m);if(l==="break")break}},k.load=function(L){var S=this;return!L.decryptdata&&L.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(L).then(function(_){return S.loadInternal(L,_)}):this.loadInternal(L)},k.loadInternal=function(L,S){var _,T;S&&L.setKeyFormat(S);var c=L.decryptdata;if(!c){var y=S?"Expected frag.decryptdata to be defined after setting format "+S:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(L,F.ErrorDetails.KEY_LOAD_ERROR,null,y))}var m=c.uri;if(!m)return Promise.reject(this.createKeyLoadError(L,F.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+m+'"'));var l=this.keyUriToKeyInfo[m];if((_=l)!==null&&_!==void 0&&_.decryptdata.key)return c.key=l.decryptdata.key,Promise.resolve({frag:L,keyInfo:l});if((T=l)!==null&&T!==void 0&&T.keyLoadPromise){var f;switch((f=l.mediaKeySessionContext)===null||f===void 0?void 0:f.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return l.keyLoadPromise}}switch(l=this.keyUriToKeyInfo[m]={decryptdata:c,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},c.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return c.keyFormat==="identity"?this.loadKeyHTTP(l,L):this.loadKeyEME(l,L);case"AES-128":return this.loadKeyHTTP(l,L);default:return Promise.reject(this.createKeyLoadError(L,F.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+c.method+'"'))}},k.loadKeyEME=function(L,S){var _={frag:S,keyInfo:L};if(this.emeController&&this.config.emeEnabled){var T=this.emeController.loadKey(_);if(T)return(L.keyLoadPromise=T.then(function(c){return L.mediaKeySessionContext=c,_})).catch(function(c){throw L.keyLoadPromise=null,c})}return Promise.resolve(_)},k.loadKeyHTTP=function(L,S){var _=this,T=this.config,c=T.loader,y=new c(T);return S.keyLoader=L.loader=y,L.keyLoadPromise=new Promise(function(m,l){var f={keyInfo:L,frag:S,responseType:"arraybuffer",url:L.decryptdata.uri},a={timeout:T.fragLoadingTimeOut,maxRetry:0,retryDelay:T.fragLoadingRetryDelay,maxRetryDelay:T.fragLoadingMaxRetryTimeout,highWaterMark:0},i={onSuccess:function(s,r,o,v){var u=o.frag,n=o.keyInfo,t=o.url;if(!u.decryptdata||n!==_.keyUriToKeyInfo[t])return l(_.createKeyLoadError(u,F.ErrorDetails.KEY_LOAD_ERROR,v,"after key load, decryptdata unset or changed"));n.decryptdata.key=u.decryptdata.key=new Uint8Array(s.data),u.keyLoader=null,n.loader=null,m({frag:u,keyInfo:n})},onError:function(s,r,o){_.resetLoader(r),l(_.createKeyLoadError(S,F.ErrorDetails.KEY_LOAD_ERROR,o))},onTimeout:function(s,r,o){_.resetLoader(r),l(_.createKeyLoadError(S,F.ErrorDetails.KEY_LOAD_TIMEOUT,o))},onAbort:function(s,r,o){_.resetLoader(r),l(_.createKeyLoadError(S,F.ErrorDetails.INTERNAL_ABORTED,o))}};y.load(f,a,i)})},k.resetLoader=function(L){var S=L.frag,_=L.keyInfo,T=L.url,c=_.loader;S.keyLoader===c&&(S.keyLoader=null,_.loader=null),delete this.keyUriToKeyInfo[T],c&&c.destroy()},I}()},"./src/loader/level-details.ts":(V,w,x)=>{x.r(w),x.d(w,{LevelDetails:()=>L});var F=x("./src/polyfills/number.ts");function A(S,_){for(var T=0;T<_.length;T++){var c=_[T];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(S,I(c.key),c)}}function b(S,_,T){return _&&A(S.prototype,_),T&&A(S,T),Object.defineProperty(S,"prototype",{writable:!1}),S}function I(S){var _=k(S,"string");return typeof _=="symbol"?_:String(_)}function k(S,_){if(typeof S!="object"||S===null)return S;var T=S[Symbol.toPrimitive];if(T!==void 0){var c=T.call(S,_||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(S)}var P=10,L=function(){function S(T){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=T}var _=S.prototype;return _.reloaded=function(c){if(!c){this.advanced=!0,this.updated=!0;return}var y=this.lastPartSn-c.lastPartSn,m=this.lastPartIndex-c.lastPartIndex;this.updated=this.endSN!==c.endSN||!!m||!!y,this.advanced=this.endSN>c.endSN||y>0||y===0&&m>0,this.updated||this.advanced?this.misses=Math.floor(c.misses*.6):this.misses=c.misses+1,this.availabilityDelay=c.availabilityDelay},b(S,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,F.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||P}},{key:"drift",get:function(){var c=this.driftEndTime-this.driftStartTime;if(c>0){var y=this.driftEnd-this.driftStart;return y*1e3/c}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var c;return(c=this.partList)!==null&&c!==void 0&&c.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var c;return(c=this.fragments)!==null&&c!==void 0&&c.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var c;return(c=this.partList)!==null&&c!==void 0&&c.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var c;return(c=this.partList)!==null&&c!==void 0&&c.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),S}()},"./src/loader/level-key.ts":(V,w,x)=>{x.r(w),x.d(w,{LevelKey:()=>L});var F=x("./src/utils/keysystem-util.ts"),A=x("./src/utils/mediakeys-helper.ts"),b=x("./src/utils/mp4-tools.ts"),I=x("./src/utils/logger.ts"),k=x("./src/utils/numeric-encoding-utils.ts"),P={},L=function(){_.clearKeyUriToKeyIdMap=function(){P={}};function _(c,y,m,l,f){l===void 0&&(l=[1]),f===void 0&&(f=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=c,this.uri=y,this.keyFormat=m,this.keyFormatVersions=l,this.iv=f,this.encrypted=c?c!=="NONE":!1,this.isCommonEncryption=this.encrypted&&c!=="AES-128"}var T=_.prototype;return T.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;switch(this.keyFormat){case"identity":return this.method==="SAMPLE-AES";case A.KeySystemFormats.FAIRPLAY:case A.KeySystemFormats.WIDEVINE:case A.KeySystemFormats.PLAYREADY:case A.KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},T.getDecryptData=function(y){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof y!="number"&&(this.method==="AES-128"&&!this.iv&&I.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),y=0);var m=S(y),l=new _(this.method,this.uri,"identity",this.keyFormatVersions,m);return l}var f=(0,F.convertDataUriToArrayBytes)(this.uri);if(f)switch(this.keyFormat){case A.KeySystemFormats.WIDEVINE:this.pssh=f,f.length>=22&&(this.keyId=f.subarray(f.length-22,f.length-6));break;case A.KeySystemFormats.PLAYREADY:{var a=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,b.mp4pssh)(a,null,f);var i=new Uint16Array(f.buffer,f.byteOffset,f.byteLength/2),g=String.fromCharCode.apply(null,Array.from(i)),s=g.substring(g.indexOf("<"),g.length),r=new DOMParser,o=r.parseFromString(s,"text/xml"),v=o.getElementsByTagName("KID")[0];if(v){var u=v.childNodes[0]?v.childNodes[0].nodeValue:v.getAttribute("VALUE");if(u){var n=(0,k.base64Decode)(u).subarray(0,16);(0,F.changeEndianness)(n),this.keyId=n}}break}default:{var t=f.subarray(0,16);if(t.length!==16){var h=new Uint8Array(16);h.set(t,16-t.length),t=h}this.keyId=t;break}}if(!this.keyId||this.keyId.byteLength!==16){var e=P[this.uri];if(!e){var d=Object.keys(P).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);var p=new DataView(e.buffer,12,4);p.setUint32(0,d),P[this.uri]=e}this.keyId=e}return this},_}();function S(_){for(var T=new Uint8Array(16),c=12;c<16;c++)T[c]=_>>8*(15-c)&255;return T}},"./src/loader/load-stats.ts":(V,w,x)=>{x.r(w),x.d(w,{LoadStats:()=>F});var F=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>f});var F=x("./src/polyfills/number.ts"),A=x("./node_modules/url-toolkit/src/url-toolkit.js"),b=x("./src/loader/date-range.ts"),I=x("./src/loader/fragment.ts"),k=x("./src/loader/level-details.ts"),P=x("./src/loader/level-key.ts"),L=x("./src/utils/attr-list.ts"),S=x("./src/utils/logger.ts"),_=x("./src/utils/codecs.ts");function T(){return T=Object.assign?Object.assign.bind():function(v){for(var u=1;u<arguments.length;u++){var n=arguments[u];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(v[t]=n[t])}return v},T.apply(this,arguments)}var c=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,y=/#EXT-X-MEDIA:(.*)/g,m=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),l=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),f=function(){function v(){}return v.findGroup=function(n,t){for(var h=0;h<n.length;h++){var e=n[h];if(e.id===t)return e}},v.convertAVC1ToAVCOTI=function(n){var t=n.split(".");if(t.length>2){var h=t.shift()+".";return h+=parseInt(t.shift()).toString(16),h+=("000"+parseInt(t.shift()).toString(16)).slice(-4),h}return n},v.resolve=function(n,t){return(0,A.buildAbsoluteURL)(t,n,{alwaysNormalize:!0})},v.parseMasterPlaylist=function(n,t){var h=[],e=[],d={},p=[],E=!1;c.lastIndex=0;for(var D;(D=c.exec(n))!=null;)if(D[1]){var R,O=new L.AttrList(D[1]),C={attrs:O,bitrate:O.decimalInteger("AVERAGE-BANDWIDTH")||O.decimalInteger("BANDWIDTH"),name:O.NAME,url:v.resolve(D[2],t)},M=O.decimalResolution("RESOLUTION");M&&(C.width=M.width,C.height=M.height),i((O.CODECS||"").split(/[ ,]+/).filter(function(W){return W}),C),C.videoCodec&&C.videoCodec.indexOf("avc1")!==-1&&(C.videoCodec=v.convertAVC1ToAVCOTI(C.videoCodec)),(R=C.unknownCodecs)!==null&&R!==void 0&&R.length||e.push(C),h.push(C)}else if(D[3]){var U=new L.AttrList(D[3]);U["DATA-ID"]&&(E=!0,d[U["DATA-ID"]]=U)}else if(D[4]){var B=D[4],N=a(B,t);N.encrypted&&N.isSupported()?p.push(N):S.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+B+'"')}var K=e.length>0&&e.length<h.length;return{levels:K?e:h,sessionData:E?d:null,sessionKeys:p.length?p:null}},v.parseMasterPlaylistMedia=function(n,t,h,e){e===void 0&&(e=[]);var d,p=[],E=0;for(y.lastIndex=0;(d=y.exec(n))!==null;){var D=new L.AttrList(d[1]);if(D.TYPE===h){var R={attrs:D,bitrate:0,id:E++,groupId:D["GROUP-ID"],instreamId:D["INSTREAM-ID"],name:D.NAME||D.LANGUAGE||"",type:h,default:D.bool("DEFAULT"),autoselect:D.bool("AUTOSELECT"),forced:D.bool("FORCED"),lang:D.LANGUAGE,url:D.URI?v.resolve(D.URI,t):""};if(e.length){var O=v.findGroup(e,R.groupId)||e[0];g(R,O,"audioCodec"),g(R,O,"textCodec")}p.push(R)}}return p},v.parseLevelPlaylist=function(n,t,h,e,d){var p=new k.LevelDetails(t),E=p.fragments,D=null,R=0,O=0,C=0,M=0,U=null,B=new I.Fragment(e,t),N,K,W,G=-1,j=!1;for(m.lastIndex=0,p.m3u8=n;(N=m.exec(n))!==null;){j&&(j=!1,B=new I.Fragment(e,t),B.start=C,B.sn=R,B.cc=M,B.level=h,D&&(B.initSegment=D,B.rawProgramDateTime=D.rawProgramDateTime,D.rawProgramDateTime=null));var H=N[1];if(H){B.duration=parseFloat(H);var Y=(" "+N[2]).slice(1);B.title=Y||null,B.tagList.push(Y?["INF",H,Y]:["INF",H])}else if(N[3]){if((0,F.isFiniteNumber)(B.duration)){if(B.start=C,W){B.levelkeys=W;var Q=p.encryptedFragments;B.levelkeys&&Object.keys(B.levelkeys).some(function(pe){return B.levelkeys[pe].isCommonEncryption})&&(!Q.length||Q[Q.length-1].levelkeys!==W)&&Q.push(B)}B.sn=R,B.level=h,B.cc=M,B.urlId=d,E.push(B),B.relurl=(" "+N[3]).slice(1),r(B,U),U=B,C+=B.duration,R++,O=0,j=!0}}else if(N[4]){var $=(" "+N[4]).slice(1);U?B.setByteRange($,U):B.setByteRange($)}else if(N[5])B.rawProgramDateTime=(" "+N[5]).slice(1),B.tagList.push(["PROGRAM-DATE-TIME",B.rawProgramDateTime]),G===-1&&(G=E.length);else{if(N=N[0].match(l),!N){S.logger.warn("No matches on slow regex match for level playlist!");continue}for(K=1;K<N.length&&!(typeof N[K]<"u");K++);var z=(" "+N[K]).slice(1),X=(" "+N[K+1]).slice(1),Z=N[K+2]?(" "+N[K+2]).slice(1):"";switch(z){case"PLAYLIST-TYPE":p.type=X.toUpperCase();break;case"MEDIA-SEQUENCE":R=p.startSN=parseInt(X);break;case"SKIP":{var J=new L.AttrList(X),q=J.decimalInteger("SKIPPED-SEGMENTS");if((0,F.isFiniteNumber)(q)){p.skippedSegments=q;for(var ae=q;ae--;)E.unshift(null);R+=q}var te=J.enumeratedString("RECENTLY-REMOVED-DATERANGES");te&&(p.recentlyRemovedDateranges=te.split("	"));break}case"TARGETDURATION":p.targetduration=parseFloat(X);break;case"VERSION":p.version=parseInt(X);break;case"EXTM3U":break;case"ENDLIST":p.live=!1;break;case"#":(X||Z)&&B.tagList.push(Z?[X,Z]:[X]);break;case"DISCONTINUITY":M++,B.tagList.push(["DIS"]);break;case"GAP":B.tagList.push([z]);break;case"BITRATE":B.tagList.push([z,X]);break;case"DATERANGE":{var ne=new L.AttrList(X),ee=new b.DateRange(ne,p.dateRanges[ne.ID]);ee.isValid||p.skippedSegments?p.dateRanges[ee.id]=ee:S.logger.warn('Ignoring invalid DATERANGE tag: "'+X+'"'),B.tagList.push(["EXT-X-DATERANGE",X]);break}case"DISCONTINUITY-SEQUENCE":M=parseInt(X);break;case"KEY":{var re=a(X,t);if(re.isSupported()){if(re.method==="NONE"){W=void 0;break}W||(W={}),W[re.keyFormat]&&(W=T({},W)),W[re.keyFormat]=re}else S.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+X+'"');break}case"START":{var ie=new L.AttrList(X),se=ie.decimalFloatingPoint("TIME-OFFSET");(0,F.isFiniteNumber)(se)&&(p.startTimeOffset=se);break}case"MAP":{var fe=new L.AttrList(X);if(B.duration){var oe=new I.Fragment(e,t);o(oe,fe,h,W),D=oe,B.initSegment=D,D.rawProgramDateTime&&!B.rawProgramDateTime&&(B.rawProgramDateTime=D.rawProgramDateTime)}else o(B,fe,h,W),D=B,j=!0;break}case"SERVER-CONTROL":{var de=new L.AttrList(X);p.canBlockReload=de.bool("CAN-BLOCK-RELOAD"),p.canSkipUntil=de.optionalFloat("CAN-SKIP-UNTIL",0),p.canSkipDateRanges=p.canSkipUntil>0&&de.bool("CAN-SKIP-DATERANGES"),p.partHoldBack=de.optionalFloat("PART-HOLD-BACK",0),p.holdBack=de.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var De=new L.AttrList(X);p.partTarget=De.decimalFloatingPoint("PART-TARGET");break}case"PART":{var ve=p.partList;ve||(ve=p.partList=[]);var Pe=O>0?ve[ve.length-1]:void 0,ye=O++,ge=new I.Part(new L.AttrList(X),B,t,ye,Pe);ve.push(ge),B.duration+=ge.duration;break}case"PRELOAD-HINT":{var me=new L.AttrList(X);p.preloadHint=me;break}case"RENDITION-REPORT":{var ce=new L.AttrList(X);p.renditionReports=p.renditionReports||[],p.renditionReports.push(ce);break}default:S.logger.warn("line parsed but not handled: "+N);break}}}U&&!U.relurl?(E.pop(),C-=U.duration,p.partList&&(p.fragmentHint=U)):p.partList&&(r(B,U),B.cc=M,p.fragmentHint=B);var he=E.length,Ee=E[0],Te=E[he-1];if(C+=p.skippedSegments*p.targetduration,C>0&&he&&Te){p.averagetargetduration=C/he;var le=Te.sn;p.endSN=le!=="initSegment"?le:0,p.live||(Te.endList=!0),Ee&&(p.startCC=Ee.cc)}else p.endSN=0,p.startCC=0;return p.fragmentHint&&(C+=p.fragmentHint.duration),p.totalduration=C,p.endCC=M,G>0&&s(E,G),p},v}();function a(v,u){var n,t,h=new L.AttrList(v),e=(n=h.enumeratedString("METHOD"))!=null?n:"",d=h.URI,p=h.hexadecimalInteger("IV"),E=h.enumeratedString("KEYFORMATVERSIONS"),D=(t=h.enumeratedString("KEYFORMAT"))!=null?t:"identity";d&&h.IV&&!p&&S.logger.error("Invalid IV: "+h.IV);var R=d?f.resolve(d,u):"",O=(E||"1").split("/").map(Number).filter(Number.isFinite);return new P.LevelKey(e,R,D,O,p)}function i(v,u){["video","audio","text"].forEach(function(n){var t=v.filter(function(e){return(0,_.isCodecType)(e,n)});if(t.length){var h=t.filter(function(e){return e.lastIndexOf("avc1",0)===0||e.lastIndexOf("mp4a",0)===0});u[n+"Codec"]=h.length>0?h[0]:t[0],v=v.filter(function(e){return t.indexOf(e)===-1})}}),u.unknownCodecs=v}function g(v,u,n){var t=u[n];t&&(v[n]=t)}function s(v,u){for(var n=v[u],t=u;t--;){var h=v[t];if(!h)return;h.programDateTime=n.programDateTime-h.duration*1e3,n=h}}function r(v,u){v.rawProgramDateTime?v.programDateTime=Date.parse(v.rawProgramDateTime):u!=null&&u.programDateTime&&(v.programDateTime=u.endProgramDateTime),(0,F.isFiniteNumber)(v.programDateTime)||(v.programDateTime=null,v.rawProgramDateTime=null)}function o(v,u,n,t){v.relurl=u.URI,u.BYTERANGE&&v.setByteRange(u.BYTERANGE),v.level=n,v.sn="initSegment",t&&(v.levelkeys=t),v.initSegment=null}},"./src/loader/playlist-loader.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>c});var F=x("./src/polyfills/number.ts"),A=x("./src/events.ts"),b=x("./src/errors.ts"),I=x("./src/utils/logger.ts"),k=x("./src/loader/m3u8-parser.ts"),P=x("./src/types/loader.ts"),L=x("./src/utils/attr-list.ts");function S(y){var m=y.type;switch(m){case P.PlaylistContextType.AUDIO_TRACK:return P.PlaylistLevelType.AUDIO;case P.PlaylistContextType.SUBTITLE_TRACK:return P.PlaylistLevelType.SUBTITLE;default:return P.PlaylistLevelType.MAIN}}function _(y,m){var l=y.url;return(l===void 0||l.indexOf("data:")===0)&&(l=m.url),l}var T=function(){function y(l){this.hls=void 0,this.loaders=Object.create(null),this.hls=l,this.registerListeners()}var m=y.prototype;return m.startLoad=function(f){},m.stopLoad=function(){this.destroyInternalLoaders()},m.registerListeners=function(){var f=this.hls;f.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(A.Events.LEVEL_LOADING,this.onLevelLoading,this),f.on(A.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),f.on(A.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},m.unregisterListeners=function(){var f=this.hls;f.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(A.Events.LEVEL_LOADING,this.onLevelLoading,this),f.off(A.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),f.off(A.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},m.createInternalLoader=function(f){var a=this.hls.config,i=a.pLoader,g=a.loader,s=i||g,r=new s(a);return f.loader=r,this.loaders[f.type]=r,r},m.getInternalLoader=function(f){return this.loaders[f.type]},m.resetInternalLoader=function(f){this.loaders[f]&&delete this.loaders[f]},m.destroyInternalLoaders=function(){for(var f in this.loaders){var a=this.loaders[f];a&&a.destroy(),this.resetInternalLoader(f)}},m.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},m.onManifestLoading=function(f,a){var i=a.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:P.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},m.onLevelLoading=function(f,a){var i=a.id,g=a.level,s=a.url,r=a.deliveryDirectives;this.load({id:i,groupId:null,level:g,responseType:"text",type:P.PlaylistContextType.LEVEL,url:s,deliveryDirectives:r})},m.onAudioTrackLoading=function(f,a){var i=a.id,g=a.groupId,s=a.url,r=a.deliveryDirectives;this.load({id:i,groupId:g,level:null,responseType:"text",type:P.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:r})},m.onSubtitleTrackLoading=function(f,a){var i=a.id,g=a.groupId,s=a.url,r=a.deliveryDirectives;this.load({id:i,groupId:g,level:null,responseType:"text",type:P.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:r})},m.load=function(f){var a,i=this.hls.config,g=this.getInternalLoader(f);if(g){var s=g.context;if(s&&s.url===f.url){I.logger.trace("[playlist-loader]: playlist request ongoing");return}I.logger.log("[playlist-loader]: aborting previous loader for type: "+f.type),g.abort()}var r,o,v,u;switch(f.type){case P.PlaylistContextType.MANIFEST:r=i.manifestLoadingMaxRetry,o=i.manifestLoadingTimeOut,v=i.manifestLoadingRetryDelay,u=i.manifestLoadingMaxRetryTimeout;break;case P.PlaylistContextType.LEVEL:case P.PlaylistContextType.AUDIO_TRACK:case P.PlaylistContextType.SUBTITLE_TRACK:r=0,o=i.levelLoadingTimeOut;break;default:r=i.levelLoadingMaxRetry,o=i.levelLoadingTimeOut,v=i.levelLoadingRetryDelay,u=i.levelLoadingMaxRetryTimeout;break}if(g=this.createInternalLoader(f),(a=f.deliveryDirectives)!==null&&a!==void 0&&a.part){var n;if(f.type===P.PlaylistContextType.LEVEL&&f.level!==null?n=this.hls.levels[f.level].details:f.type===P.PlaylistContextType.AUDIO_TRACK&&f.id!==null?n=this.hls.audioTracks[f.id].details:f.type===P.PlaylistContextType.SUBTITLE_TRACK&&f.id!==null&&(n=this.hls.subtitleTracks[f.id].details),n){var t=n.partTarget,h=n.targetduration;t&&h&&(o=Math.min(Math.max(t*3,h*.8)*1e3,o))}}var e={timeout:o,maxRetry:r,retryDelay:v,maxRetryDelay:u,highWaterMark:0},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};g.load(f,e,d)},m.loadsuccess=function(f,a,i,g){g===void 0&&(g=null),this.resetInternalLoader(i.type);var s=f.data;if(s.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(f,i,"no EXTM3U delimiter",g);return}a.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(f,a,i,g):this.handleMasterPlaylist(f,a,i,g)},m.loaderror=function(f,a,i){i===void 0&&(i=null),this.handleNetworkError(a,i,!1,f)},m.loadtimeout=function(f,a,i){i===void 0&&(i=null),this.handleNetworkError(a,i,!0)},m.handleMasterPlaylist=function(f,a,i,g){var s=this.hls,r=f.data,o=_(f,i),v=k.default.parseMasterPlaylist(r,o),u=v.levels,n=v.sessionData,t=v.sessionKeys;if(!u.length){this.handleManifestParsingError(f,i,"no level found in manifest",g);return}var h=u.map(function(R){return{id:R.attrs.AUDIO,audioCodec:R.audioCodec}}),e=u.map(function(R){return{id:R.attrs.SUBTITLES,textCodec:R.textCodec}}),d=k.default.parseMasterPlaylistMedia(r,o,"AUDIO",h),p=k.default.parseMasterPlaylistMedia(r,o,"SUBTITLES",e),E=k.default.parseMasterPlaylistMedia(r,o,"CLOSED-CAPTIONS");if(d.length){var D=d.some(function(R){return!R.url});!D&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(I.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new L.AttrList({}),bitrate:0,url:""}))}s.trigger(A.Events.MANIFEST_LOADED,{levels:u,audioTracks:d,subtitles:p,captions:E,url:o,stats:a,networkDetails:g,sessionData:n,sessionKeys:t})},m.handleTrackOrLevelPlaylist=function(f,a,i,g){var s=this.hls,r=i.id,o=i.level,v=i.type,u=_(f,i),n=(0,F.isFiniteNumber)(r)?r:0,t=(0,F.isFiniteNumber)(o)?o:n,h=S(i),e=k.default.parseLevelPlaylist(f.data,u,t,h,n);if(!e.fragments.length){s.trigger(A.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:u,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0});return}if(v===P.PlaylistContextType.MANIFEST){var d={attrs:new L.AttrList({}),bitrate:0,details:e,name:"",url:u};s.trigger(A.Events.MANIFEST_LOADED,{levels:[d],audioTracks:[],url:u,stats:a,networkDetails:g,sessionData:null,sessionKeys:null})}a.parsing.end=performance.now(),i.levelDetails=e,this.handlePlaylistLoaded(f,a,i,g)},m.handleManifestParsingError=function(f,a,i,g){this.hls.trigger(A.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:a.type===P.PlaylistContextType.MANIFEST,url:f.url,reason:i,response:f,context:a,networkDetails:g})},m.handleNetworkError=function(f,a,i,g){i===void 0&&(i=!1),I.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+f.type+" level: "+f.level+" id: "+f.id+' group-id: "'+f.groupId+'"');var s=b.ErrorDetails.UNKNOWN,r=!1,o=this.getInternalLoader(f);switch(f.type){case P.PlaylistContextType.MANIFEST:s=i?b.ErrorDetails.MANIFEST_LOAD_TIMEOUT:b.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case P.PlaylistContextType.LEVEL:s=i?b.ErrorDetails.LEVEL_LOAD_TIMEOUT:b.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case P.PlaylistContextType.AUDIO_TRACK:s=i?b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case P.PlaylistContextType.SUBTITLE_TRACK:s=i?b.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:b.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1;break}o&&this.resetInternalLoader(f.type);var v={type:b.ErrorTypes.NETWORK_ERROR,details:s,fatal:r,url:f.url,loader:o,context:f,networkDetails:a};g&&(v.response=g),this.hls.trigger(A.Events.ERROR,v)},m.handlePlaylistLoaded=function(f,a,i,g){var s=i.type,r=i.level,o=i.id,v=i.groupId,u=i.loader,n=i.levelDetails,t=i.deliveryDirectives;if(!(n!=null&&n.targetduration)){this.handleManifestParsingError(f,i,"invalid target duration",g);return}if(u)switch(n.live&&(u.getCacheAge&&(n.ageHeader=u.getCacheAge()||0),(!u.getCacheAge||isNaN(n.ageHeader))&&(n.ageHeader=0)),s){case P.PlaylistContextType.MANIFEST:case P.PlaylistContextType.LEVEL:this.hls.trigger(A.Events.LEVEL_LOADED,{details:n,level:r||0,id:o||0,stats:a,networkDetails:g,deliveryDirectives:t});break;case P.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(A.Events.AUDIO_TRACK_LOADED,{details:n,id:o||0,groupId:v||"",stats:a,networkDetails:g,deliveryDirectives:t});break;case P.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(A.Events.SUBTITLE_TRACK_LOADED,{details:n,id:o||0,groupId:v||"",stats:a,networkDetails:g,deliveryDirectives:t});break}},y}();const c=T},"./src/polyfills/number.ts":(V,w,x)=>{x.r(w),x.d(w,{MAX_SAFE_INTEGER:()=>A,isFiniteNumber:()=>F});var F=Number.isFinite||function(b){return typeof b=="number"&&isFinite(b)},A=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>A});var F=function(){function b(){}return b.getSilentFrame=function(k,P){switch(k){case"mp4a.40.2":if(P===1)return new Uint8Array([0,200,0,128,35,128]);if(P===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(P===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(P===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(P===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(P===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(P===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(P===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(P===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},b}();const A=F},"./src/remux/mp4-generator.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>b});var F=Math.pow(2,32)-1,A=function(){function I(){}return I.init=function(){I.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var P;for(P in I.types)I.types.hasOwnProperty(P)&&(I.types[P]=[P.charCodeAt(0),P.charCodeAt(1),P.charCodeAt(2),P.charCodeAt(3)]);var L=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),S=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);I.HDLR_TYPES={video:L,audio:S};var _=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),T=new Uint8Array([0,0,0,0,0,0,0,0]);I.STTS=I.STSC=I.STCO=T,I.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),I.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),I.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),I.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var c=new Uint8Array([105,115,111,109]),y=new Uint8Array([97,118,99,49]),m=new Uint8Array([0,0,0,1]);I.FTYP=I.box(I.types.ftyp,c,m,c,y),I.DINF=I.box(I.types.dinf,I.box(I.types.dref,_))},I.box=function(P){for(var L=8,S=arguments.length,_=new Array(S>1?S-1:0),T=1;T<S;T++)_[T-1]=arguments[T];for(var c=_.length,y=c;c--;)L+=_[c].byteLength;var m=new Uint8Array(L);for(m[0]=L>>24&255,m[1]=L>>16&255,m[2]=L>>8&255,m[3]=L&255,m.set(P,4),c=0,L=8;c<y;c++)m.set(_[c],L),L+=_[c].byteLength;return m},I.hdlr=function(P){return I.box(I.types.hdlr,I.HDLR_TYPES[P])},I.mdat=function(P){return I.box(I.types.mdat,P)},I.mdhd=function(P,L){L*=P;var S=Math.floor(L/(F+1)),_=Math.floor(L%(F+1));return I.box(I.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,P&255,S>>24,S>>16&255,S>>8&255,S&255,_>>24,_>>16&255,_>>8&255,_&255,85,196,0,0]))},I.mdia=function(P){return I.box(I.types.mdia,I.mdhd(P.timescale,P.duration),I.hdlr(P.type),I.minf(P))},I.mfhd=function(P){return I.box(I.types.mfhd,new Uint8Array([0,0,0,0,P>>24,P>>16&255,P>>8&255,P&255]))},I.minf=function(P){return P.type==="audio"?I.box(I.types.minf,I.box(I.types.smhd,I.SMHD),I.DINF,I.stbl(P)):I.box(I.types.minf,I.box(I.types.vmhd,I.VMHD),I.DINF,I.stbl(P))},I.moof=function(P,L,S){return I.box(I.types.moof,I.mfhd(P),I.traf(S,L))},I.moov=function(P){for(var L=P.length,S=[];L--;)S[L]=I.trak(P[L]);return I.box.apply(null,[I.types.moov,I.mvhd(P[0].timescale,P[0].duration)].concat(S).concat(I.mvex(P)))},I.mvex=function(P){for(var L=P.length,S=[];L--;)S[L]=I.trex(P[L]);return I.box.apply(null,[I.types.mvex].concat(S))},I.mvhd=function(P,L){L*=P;var S=Math.floor(L/(F+1)),_=Math.floor(L%(F+1)),T=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,P&255,S>>24,S>>16&255,S>>8&255,S&255,_>>24,_>>16&255,_>>8&255,_&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return I.box(I.types.mvhd,T)},I.sdtp=function(P){var L=P.samples||[],S=new Uint8Array(4+L.length),_,T;for(_=0;_<L.length;_++)T=L[_].flags,S[_+4]=T.dependsOn<<4|T.isDependedOn<<2|T.hasRedundancy;return I.box(I.types.sdtp,S)},I.stbl=function(P){return I.box(I.types.stbl,I.stsd(P),I.box(I.types.stts,I.STTS),I.box(I.types.stsc,I.STSC),I.box(I.types.stsz,I.STSZ),I.box(I.types.stco,I.STCO))},I.avc1=function(P){var L=[],S=[],_,T,c;for(_=0;_<P.sps.length;_++)T=P.sps[_],c=T.byteLength,L.push(c>>>8&255),L.push(c&255),L=L.concat(Array.prototype.slice.call(T));for(_=0;_<P.pps.length;_++)T=P.pps[_],c=T.byteLength,S.push(c>>>8&255),S.push(c&255),S=S.concat(Array.prototype.slice.call(T));var y=I.box(I.types.avcC,new Uint8Array([1,L[3],L[4],L[5],255,224|P.sps.length].concat(L).concat([P.pps.length]).concat(S))),m=P.width,l=P.height,f=P.pixelRatio[0],a=P.pixelRatio[1];return I.box(I.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),y,I.box(I.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),I.box(I.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,a>>24,a>>16&255,a>>8&255,a&255])))},I.esds=function(P){var L=P.config.length;return new Uint8Array([0,0,0,0,3,23+L,0,1,0,4,15+L,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([L]).concat(P.config).concat([6,1,2]))},I.mp4a=function(P){var L=P.samplerate;return I.box(I.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,P.channelCount,0,16,0,0,0,0,L>>8&255,L&255,0,0]),I.box(I.types.esds,I.esds(P)))},I.mp3=function(P){var L=P.samplerate;return I.box(I.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,P.channelCount,0,16,0,0,0,0,L>>8&255,L&255,0,0]))},I.stsd=function(P){return P.type==="audio"?P.segmentCodec==="mp3"&&P.codec==="mp3"?I.box(I.types.stsd,I.STSD,I.mp3(P)):I.box(I.types.stsd,I.STSD,I.mp4a(P)):I.box(I.types.stsd,I.STSD,I.avc1(P))},I.tkhd=function(P){var L=P.id,S=P.duration*P.timescale,_=P.width,T=P.height,c=Math.floor(S/(F+1)),y=Math.floor(S%(F+1));return I.box(I.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,L>>24&255,L>>16&255,L>>8&255,L&255,0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255,y>>24,y>>16&255,y>>8&255,y&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,_>>8&255,_&255,0,0,T>>8&255,T&255,0,0]))},I.traf=function(P,L){var S=I.sdtp(P),_=P.id,T=Math.floor(L/(F+1)),c=Math.floor(L%(F+1));return I.box(I.types.traf,I.box(I.types.tfhd,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,_&255])),I.box(I.types.tfdt,new Uint8Array([1,0,0,0,T>>24,T>>16&255,T>>8&255,T&255,c>>24,c>>16&255,c>>8&255,c&255])),I.trun(P,S.length+16+20+8+16+8+8),S)},I.trak=function(P){return P.duration=P.duration||4294967295,I.box(I.types.trak,I.tkhd(P),I.mdia(P))},I.trex=function(P){var L=P.id;return I.box(I.types.trex,new Uint8Array([0,0,0,0,L>>24,L>>16&255,L>>8&255,L&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},I.trun=function(P,L){var S=P.samples||[],_=S.length,T=12+16*_,c=new Uint8Array(T),y,m,l,f,a,i;for(L+=8+T,c.set([P.type==="video"?1:0,0,15,1,_>>>24&255,_>>>16&255,_>>>8&255,_&255,L>>>24&255,L>>>16&255,L>>>8&255,L&255],0),y=0;y<_;y++)m=S[y],l=m.duration,f=m.size,a=m.flags,i=m.cts,c.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,a.degradPrio&240<<8,a.degradPrio&15,i>>>24&255,i>>>16&255,i>>>8&255,i&255],12+16*y);return I.box(I.types.trun,c)},I.initSegment=function(P){I.types||I.init();var L=I.moov(P),S=new Uint8Array(I.FTYP.byteLength+L.byteLength);return S.set(I.FTYP),S.set(L,I.FTYP.byteLength),S},I}();A.types=void 0,A.HDLR_TYPES=void 0,A.STTS=void 0,A.STSC=void 0,A.STCO=void 0,A.STSZ=void 0,A.VMHD=void 0,A.SMHD=void 0,A.STSD=void 0,A.FTYP=void 0,A.DINF=void 0;const b=A},"./src/remux/mp4-remuxer.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>f,flushTextTrackMetadataCueSamples:()=>g,flushTextTrackUserdataCueSamples:()=>s,normalizePts:()=>a});var F=x("./src/polyfills/number.ts"),A=x("./src/remux/aac-helper.ts"),b=x("./src/remux/mp4-generator.ts"),I=x("./src/events.ts"),k=x("./src/errors.ts"),P=x("./src/utils/logger.ts"),L=x("./src/types/loader.ts"),S=x("./src/utils/timescale-conversion.ts");function _(){return _=Object.assign?Object.assign.bind():function(v){for(var u=1;u<arguments.length;u++){var n=arguments[u];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(v[t]=n[t])}return v},_.apply(this,arguments)}var T=10*1e3,c=1024,y=1152,m=null,l=null,f=function(){function v(n,t,h,e){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=n,this.config=t,this.typeSupported=h,this.ISGenerated=!1,m===null){var d=navigator.userAgent||"",p=d.match(/Chrome\/(\d+)/i);m=p?parseInt(p[1]):0}if(l===null){var E=navigator.userAgent.match(/Safari\/(\d+)/i);l=E?parseInt(E[1]):0}}var u=v.prototype;return u.destroy=function(){},u.resetTimeStamp=function(t){P.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},u.resetNextTimestamp=function(){P.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},u.resetInitSegment=function(){P.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},u.getVideoStartPts=function(t){var h=!1,e=t.reduce(function(d,p){var E=p.pts-d;return E<-4294967296?(h=!0,a(d,p.pts)):E>0?d:p.pts},t[0].pts);return h&&P.logger.debug("PTS rollover detected"),e},u.remux=function(t,h,e,d,p,E,D,R){var O,C,M,U,B,N,K=p,W=p,G=t.pid>-1,j=h.pid>-1,H=h.samples.length,Y=t.samples.length>0,Q=D&&H>0||H>1,$=(!G||Y)&&(!j||Q)||this.ISGenerated||D;if($){this.ISGenerated||(M=this.generateIS(t,h,p));var z=this.isVideoContiguous,X=-1,Z;if(Q&&(X=i(h.samples),!z&&this.config.forceKeyFrameOnDiscontinuity))if(N=!0,X>0){P.logger.warn("[mp4-remuxer]: Dropped "+X+" out of "+H+" video samples due to a missing keyframe");var J=this.getVideoStartPts(h.samples);h.samples=h.samples.slice(X),h.dropped+=X,W+=(h.samples[0].pts-J)/h.inputTimeScale,Z=W}else X===-1&&(P.logger.warn("[mp4-remuxer]: No keyframe found out of "+H+" video samples"),N=!1);if(this.ISGenerated){if(Y&&Q){var q=this.getVideoStartPts(h.samples),ae=a(t.samples[0].pts,q)-q,te=ae/h.inputTimeScale;K+=Math.max(0,te),W+=Math.max(0,-te)}if(Y){if(t.samplerate||(P.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),M=this.generateIS(t,h,p)),C=this.remuxAudio(t,K,this.isAudioContiguous,E,j||Q||R===L.PlaylistLevelType.AUDIO?W:void 0),Q){var ne=C?C.endPTS-C.startPTS:0;h.inputTimeScale||(P.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),M=this.generateIS(t,h,p)),O=this.remuxVideo(h,W,z,ne)}}else Q&&(O=this.remuxVideo(h,W,z,0));O&&(O.firstKeyFrame=X,O.independent=X!==-1,O.firstKeyFramePTS=Z)}}return this.ISGenerated&&(e.samples.length&&(B=g(e,p,this._initPTS,this._initDTS)),d.samples.length&&(U=s(d,p,this._initPTS))),{audio:C,video:O,initSegment:M,independent:N,text:U,id3:B}},u.generateIS=function(t,h,e){var d=t.samples,p=h.samples,E=this.typeSupported,D={},R=!(0,F.isFiniteNumber)(this._initPTS),O="audio/mp4",C,M,U;if(R&&(C=M=1/0),t.config&&d.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":E.mpeg?(O="audio/mpeg",t.codec=""):E.mp3&&(t.codec="mp3");break}D.audio={id:"audio",container:O,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&E.mpeg?new Uint8Array(0):b.default.initSegment([t]),metadata:{channelCount:t.channelCount}},R&&(U=t.inputTimeScale,C=M=d[0].pts-Math.round(U*e))}if(h.sps&&h.pps&&p.length&&(h.timescale=h.inputTimeScale,D.video={id:"main",container:"video/mp4",codec:h.codec,initSegment:b.default.initSegment([h]),metadata:{width:h.width,height:h.height}},R)){U=h.inputTimeScale;var B=this.getVideoStartPts(p),N=Math.round(U*e);M=Math.min(M,a(p[0].dts,B)-N),C=Math.min(C,B-N)}if(Object.keys(D).length)return this.ISGenerated=!0,R&&(this._initPTS=C,this._initDTS=M),{tracks:D,initPTS:C,timescale:U}},u.remuxVideo=function(t,h,e,d){var p=t.inputTimeScale,E=t.samples,D=[],R=E.length,O=this._initPTS,C=this.nextAvcDts,M=8,U=this.videoSampleDuration,B,N,K=Number.POSITIVE_INFINITY,W=Number.NEGATIVE_INFINITY,G=!1;if(!e||C===null){var j=h*p,H=E[0].pts-a(E[0].dts,E[0].pts);C=j-H}for(var Y=0;Y<R;Y++){var Q=E[Y];Q.pts=a(Q.pts-O,C),Q.dts=a(Q.dts-O,C),Q.dts<E[Y>0?Y-1:Y].dts&&(G=!0)}G&&E.sort(function(Be,He){var Ze=Be.dts-He.dts,Je=Be.pts-He.pts;return Ze||Je}),B=E[0].dts,N=E[E.length-1].dts;var $=N-B,z=$?Math.round($/(R-1)):U||t.inputTimeScale/30;if(e){var X=B-C,Z=X>z,J=X<-1;if((Z||J)&&(Z?P.logger.warn("AVC: "+(0,S.toMsFromMpegTsClock)(X,!0)+" ms ("+X+"dts) hole between fragments detected, filling it"):P.logger.warn("AVC: "+(0,S.toMsFromMpegTsClock)(-X,!0)+" ms ("+X+"dts) overlapping between fragments detected"),!J||C>E[0].pts)){B=C;var q=E[0].pts-X;E[0].dts=B,E[0].pts=q,P.logger.log("Video: First PTS/DTS adjusted: "+(0,S.toMsFromMpegTsClock)(q,!0)+"/"+(0,S.toMsFromMpegTsClock)(B,!0)+", delta: "+(0,S.toMsFromMpegTsClock)(X,!0)+" ms")}}B=Math.max(0,B);for(var ae=0,te=0,ne=0;ne<R;ne++){for(var ee=E[ne],re=ee.units,ie=re.length,se=0,fe=0;fe<ie;fe++)se+=re[fe].data.length;te+=se,ae+=ie,ee.length=se,ee.dts=Math.max(ee.dts,B),K=Math.min(ee.pts,K),W=Math.max(ee.pts,W)}N=E[R-1].dts;var oe=te+4*ae+8,de;try{de=new Uint8Array(oe)}catch{this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:k.ErrorTypes.MUX_ERROR,details:k.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:oe,reason:"fail allocating video mdat "+oe});return}var De=new DataView(de.buffer);De.setUint32(0,oe),de.set(b.default.types.mdat,4);for(var ve=!1,Pe=Number.POSITIVE_INFINITY,ye=Number.POSITIVE_INFINITY,ge=Number.NEGATIVE_INFINITY,me=Number.NEGATIVE_INFINITY,ce=0;ce<R;ce++){for(var he=E[ce],Ee=he.units,Te=0,le=0,pe=Ee.length;le<pe;le++){var _e=Ee[le],Me=_e.data,Ie=_e.data.byteLength;De.setUint32(M,Ie),M+=4,de.set(Me,M),M+=Ie,Te+=4+Ie}var Oe=void 0;if(ce<R-1)U=E[ce+1].dts-he.dts,Oe=E[ce+1].pts-he.pts;else{var Ne=this.config,be=ce>0?he.dts-E[ce-1].dts:z;if(Oe=ce>0?he.pts-E[ce-1].pts:z,Ne.stretchShortVideoTrack&&this.nextAudioPts!==null){var Ve=Math.floor(Ne.maxBufferHole*p),ke=(d?K+d*p:this.nextAudioPts)-he.pts;ke>Ve?(U=ke-be,U<0?U=be:ve=!0,P.logger.log("[mp4-remuxer]: It is approximately "+ke/90+" ms to the next segment; using duration "+U/90+" ms for the last video frame.")):U=be}else U=be}var je=Math.round(he.pts-he.dts);Pe=Math.min(Pe,U),ge=Math.max(ge,U),ye=Math.min(ye,Oe),me=Math.max(me,Oe),D.push(new r(he.key,U,Te,je))}if(D.length){if(m){if(m<70){var Ke=D[0].flags;Ke.dependsOn=2,Ke.isNonSync=0}}else if(l&&me-ye<ge-Pe&&z/ge<.025&&D[0].cts===0){P.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Ue=B,Se=0,We=D.length;Se<We;Se++){var Ge=Ue+D[Se].duration,Ye=Ue+D[Se].cts;if(Se<We-1){var Xe=Ge+D[Se+1].cts;D[Se].duration=Xe-Ye}else D[Se].duration=Se?D[Se-1].duration:z;D[Se].cts=0,Ue=Ge}}}console.assert(U!==null,"mp4SampleDuration must be computed"),U=ve||!U?z:U,this.nextAvcDts=C=N+U,this.videoSampleDuration=U,this.isVideoContiguous=!0;var ze=b.default.moof(t.sequenceNumber++,B,_({},t,{samples:D})),Qe="video",$e={data1:ze,data2:de,startPTS:K/p,endPTS:(W+U)/p,startDTS:B/p,endDTS:C/p,type:Qe,hasAudio:!1,hasVideo:!0,nb:D.length,dropped:t.dropped};return t.samples=[],t.dropped=0,console.assert(de.length,"MDAT length must not be zero"),$e},u.remuxAudio=function(t,h,e,d,p){var E=t.inputTimeScale,D=t.samplerate?t.samplerate:E,R=E/D,O=t.segmentCodec==="aac"?c:y,C=O*R,M=this._initPTS,U=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,B=[],N=p!==void 0,K=t.samples,W=U?0:8,G=this.nextAudioPts||-1,j=h*E;if(this.isAudioContiguous=e=e||K.length&&G>0&&(d&&Math.abs(j-G)<9e3||Math.abs(a(K[0].pts-M,j)-G)<20*C),K.forEach(function(_e){_e.pts=a(_e.pts-M,j)}),!e||G<0){if(K=K.filter(function(_e){return _e.pts>=0}),!K.length)return;p===0?G=0:d&&!N?G=Math.max(0,j):G=K[0].pts}if(t.segmentCodec==="aac")for(var H=this.config.maxAudioFramesDrift,Y=0,Q=G;Y<K.length;Y++){var $=K[Y],z=$.pts,X=z-Q,Z=Math.abs(1e3*X/E);if(X<=-H*C&&N)Y===0&&(P.logger.warn("Audio frame @ "+(z/E).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*X/E)+" ms."),this.nextAudioPts=G=Q=z);else if(X>=H*C&&Z<T&&N){var J=Math.round(X/C);Q=z-J*C,Q<0&&(J--,Q+=C),Y===0&&(this.nextAudioPts=G=Q),P.logger.warn("[mp4-remuxer]: Injecting "+J+" audio frame @ "+(Q/E).toFixed(3)+"s due to "+Math.round(1e3*X/E)+" ms gap.");for(var q=0;q<J;q++){var ae=Math.max(Q,0),te=A.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);te||(P.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),te=$.unit.subarray()),K.splice(Y,0,{unit:te,pts:ae}),Q+=C,Y++}}$.pts=Q,Q+=C}for(var ne=null,ee=null,re,ie=0,se=K.length;se--;)ie+=K[se].unit.byteLength;for(var fe=0,oe=K.length;fe<oe;fe++){var de=K[fe],De=de.unit,ve=de.pts;if(ee!==null){var Pe=B[fe-1];Pe.duration=Math.round((ve-ee)/R)}else if(e&&t.segmentCodec==="aac"&&(ve=G),ne=ve,ie>0){ie+=W;try{re=new Uint8Array(ie)}catch{this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:k.ErrorTypes.MUX_ERROR,details:k.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ie,reason:"fail allocating audio mdat "+ie});return}if(!U){var ye=new DataView(re.buffer);ye.setUint32(0,ie),re.set(b.default.types.mdat,4)}}else return;re.set(De,W);var ge=De.byteLength;W+=ge,B.push(new r(!0,O,ge,0)),ee=ve}var me=B.length;if(me){var ce=B[B.length-1];this.nextAudioPts=G=ee+R*ce.duration;var he=U?new Uint8Array(0):b.default.moof(t.sequenceNumber++,ne/R,_({},t,{samples:B}));t.samples=[];var Ee=ne/E,Te=G/E,le="audio",pe={data1:he,data2:re,startPTS:Ee,endPTS:Te,startDTS:Ee,endDTS:Te,type:le,hasAudio:!0,hasVideo:!1,nb:me};return this.isAudioContiguous=!0,console.assert(re.length,"MDAT length must not be zero"),pe}},u.remuxEmptyAudio=function(t,h,e,d){var p=t.inputTimeScale,E=t.samplerate?t.samplerate:p,D=p/E,R=this.nextAudioPts,O=(R!==null?R:d.startDTS*p)+this._initDTS,C=d.endDTS*p+this._initDTS,M=D*c,U=Math.ceil((C-O)/M),B=A.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(P.logger.warn("[mp4-remuxer]: remux empty Audio"),!B){P.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var N=[],K=0;K<U;K++){var W=O+K*M;N.push({unit:B,pts:W,dts:W})}return t.samples=N,this.remuxAudio(t,h,e,!1)},v}();function a(v,u){var n;if(u===null)return v;for(u<v?n=-8589934592:n=8589934592;Math.abs(v-u)>4294967296;)v+=n;return v}function i(v){for(var u=0;u<v.length;u++)if(v[u].key)return u;return-1}function g(v,u,n,t){var h=v.samples.length;if(h){for(var e=v.inputTimeScale,d=0;d<h;d++){var p=v.samples[d];p.pts=a(p.pts-n,u*e)/e,p.dts=a(p.dts-t,u*e)/e}var E=v.samples;return v.samples=[],{samples:E}}}function s(v,u,n){var t=v.samples.length;if(t){for(var h=v.inputTimeScale,e=0;e<t;e++){var d=v.samples[e];d.pts=a(d.pts-n,u*h)/h}v.samples.sort(function(E,D){return E.pts-D.pts});var p=v.samples;return v.samples=[],{samples:p}}}var r=function(u,n,t,h){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=n,this.size=t,this.cts=h,this.flags=new o(u)},o=function(u){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=u?2:1,this.isNonSync=u?0:1}},"./src/remux/passthrough-remuxer.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>S});var F=x("./src/polyfills/number.ts"),A=x("./src/remux/mp4-remuxer.ts"),b=x("./src/utils/mp4-tools.ts"),I=x("./src/loader/fragment.ts"),k=x("./src/utils/logger.ts"),P=function(){function _(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var T=_.prototype;return T.destroy=function(){},T.resetTimeStamp=function(y){this.initPTS=y,this.lastEndTime=null},T.resetNextTimestamp=function(){this.lastEndTime=null},T.resetInitSegment=function(y,m,l,f){this.audioCodec=m,this.videoCodec=l,this.generateInitSegment((0,b.patchEncyptionData)(y,f)),this.emitInitSegment=!0},T.generateInitSegment=function(y){var m=this.audioCodec,l=this.videoCodec;if(!y||!y.byteLength){this.initTracks=void 0,this.initData=void 0;return}var f=this.initData=(0,b.parseInitSegment)(y);m||(m=L(f.audio,I.ElementaryStreamTypes.AUDIO)),l||(l=L(f.video,I.ElementaryStreamTypes.VIDEO));var a={};f.audio&&f.video?a.audiovideo={container:"video/mp4",codec:m+","+l,initSegment:y,id:"main"}:f.audio?a.audio={container:"audio/mp4",codec:m,initSegment:y,id:"audio"}:f.video?a.video={container:"video/mp4",codec:l,initSegment:y,id:"main"}:k.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a},T.remux=function(y,m,l,f,a){var i,g=this.initPTS,s=this.lastEndTime,r={audio:void 0,video:void 0,text:f,id3:l,initSegment:void 0};(0,F.isFiniteNumber)(s)||(s=this.lastEndTime=a||0);var o=m.samples;if(!o||!o.length)return r;var v={initPTS:void 0,timescale:1},u=this.initData;if((!u||!u.length)&&(this.generateInitSegment(o),u=this.initData),!u||!u.length)return k.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),r;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);var n=(0,b.getStartDTS)(u,o);(0,F.isFiniteNumber)(g)||(this.initPTS=v.initPTS=g=n-a);var t=(0,b.getDuration)(o,u),h=y?n-g:s,e=h+t;(0,b.offsetStartDTS)(u,o,g),t>0?this.lastEndTime=e:(k.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var d=!!u.audio,p=!!u.video,E="";d&&(E+="audio"),p&&(E+="video");var D={data1:o,startPTS:h,startDTS:h,endPTS:e,endDTS:e,type:E,hasAudio:d,hasVideo:p,nb:1,dropped:0};r.audio=D.type==="audio"?D:void 0,r.video=D.type!=="audio"?D:void 0,r.initSegment=v;var R=(i=this.initPTS)!=null?i:0;return r.id3=(0,A.flushTextTrackMetadataCueSamples)(l,a,R,R),f.samples.length&&(r.text=(0,A.flushTextTrackUserdataCueSamples)(f,a,R)),r},_}();function L(_,T){var c=_==null?void 0:_.codec;return c&&c.length>4?c:c==="hvc1"||c==="hev1"?"hvc1.1.c.L120.90":c==="av01"?"av01.0.04M.08":c==="avc1"||T===I.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const S=P},"./src/task-loop.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>F});var F=function(){function A(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=A.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(k){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,k),!0)},b.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},b.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},b.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},A}()},"./src/types/cmcd.ts":(V,w,x)=>{x.r(w),x.d(w,{CMCDObjectType:()=>A,CMCDStreamType:()=>I,CMCDStreamingFormat:()=>b,CMCDVersion:()=>F});var F=1,A;(function(k){k.MANIFEST="m",k.AUDIO="a",k.VIDEO="v",k.MUXED="av",k.INIT="i",k.CAPTION="c",k.TIMED_TEXT="tt",k.KEY="k",k.OTHER="o"})(A||(A={}));var b;(function(k){k.DASH="d",k.HLS="h",k.SMOOTH="s",k.OTHER="o"})(b||(b={}));var I;(function(k){k.VOD="v",k.LIVE="l"})(I||(I={}))},"./src/types/demuxer.ts":(V,w,x)=>{x.r(w),x.d(w,{MetadataSchema:()=>F});var F;(function(A){A.audioId3="org.id3",A.dateRange="com.apple.quicktime.HLS",A.emsg="https://aomedia.org/emsg/ID3"})(F||(F={}))},"./src/types/level.ts":(V,w,x)=>{x.r(w),x.d(w,{HdcpLevels:()=>k,HlsSkip:()=>P,HlsUrlParameters:()=>S,Level:()=>_,getSkipValue:()=>L});function F(T,c){for(var y=0;y<c.length;y++){var m=c[y];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(T,b(m.key),m)}}function A(T,c,y){return c&&F(T.prototype,c),y&&F(T,y),Object.defineProperty(T,"prototype",{writable:!1}),T}function b(T){var c=I(T,"string");return typeof c=="symbol"?c:String(c)}function I(T,c){if(typeof T!="object"||T===null)return T;var y=T[Symbol.toPrimitive];if(y!==void 0){var m=y.call(T,c||"default");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return(c==="string"?String:Number)(T)}var k=["NONE","TYPE-0","TYPE-1","TYPE-2",null],P;(function(T){T.No="",T.Yes="YES",T.v2="v2"})(P||(P={}));function L(T,c){var y=T.canSkipUntil,m=T.canSkipDateRanges,l=T.endSN,f=c!==void 0?c-l:0;return y&&f<y?m?P.v2:P.Yes:P.No}var S=function(){function T(y,m,l){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=y,this.part=m,this.skip=l}var c=T.prototype;return c.addDirectives=function(m){var l=new self.URL(m);return this.msn!==void 0&&l.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&l.searchParams.set("_HLS_part",this.part.toString()),this.skip&&l.searchParams.set("_HLS_skip",this.skip),l.href},T}(),_=function(){function T(c){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[c.url],this.attrs=c.attrs,this.bitrate=c.bitrate,c.details&&(this.details=c.details),this.id=c.id||0,this.name=c.name,this.width=c.width||0,this.height=c.height||0,this.audioCodec=c.audioCodec,this.videoCodec=c.videoCodec,this.unknownCodecs=c.unknownCodecs,this.codecSet=[c.videoCodec,c.audioCodec].filter(function(y){return y}).join(",").replace(/\.[^.,]+/g,"")}return A(T,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(y){var m=y%this.url.length;this._urlId!==m&&(this.details=void 0,this._urlId=m)}}]),T}()},"./src/types/loader.ts":(V,w,x)=>{x.r(w),x.d(w,{PlaylistContextType:()=>F,PlaylistLevelType:()=>A});var F;(function(b){b.MANIFEST="manifest",b.LEVEL="level",b.AUDIO_TRACK="audioTrack",b.SUBTITLE_TRACK="subtitleTrack"})(F||(F={}));var A;(function(b){b.MAIN="main",b.AUDIO="audio",b.SUBTITLE="subtitle"})(A||(A={}))},"./src/types/transmuxer.ts":(V,w,x)=>{x.r(w),x.d(w,{ChunkMetadata:()=>F});var F=function(I,k,P,L,S,_){L===void 0&&(L=0),S===void 0&&(S=-1),_===void 0&&(_=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=A(),this.buffering={audio:A(),video:A(),audiovideo:A()},this.level=I,this.sn=k,this.id=P,this.size=L,this.part=S,this.partial=_};function A(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(V,w,x)=>{x.r(w),x.d(w,{AttrList:()=>b});var F=/^(\d+)x(\d+)$/,A=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,b=function(){function I(P){typeof P=="string"&&(P=I.parseAttrList(P));for(var L in P)P.hasOwnProperty(L)&&(this[L]=P[L])}var k=I.prototype;return k.decimalInteger=function(L){var S=parseInt(this[L],10);return S>Number.MAX_SAFE_INTEGER?1/0:S},k.hexadecimalInteger=function(L){if(this[L]){var S=(this[L]||"0x").slice(2);S=(S.length&1?"0":"")+S;for(var _=new Uint8Array(S.length/2),T=0;T<S.length/2;T++)_[T]=parseInt(S.slice(T*2,T*2+2),16);return _}else return null},k.hexadecimalIntegerAsNumber=function(L){var S=parseInt(this[L],16);return S>Number.MAX_SAFE_INTEGER?1/0:S},k.decimalFloatingPoint=function(L){return parseFloat(this[L])},k.optionalFloat=function(L,S){var _=this[L];return _?parseFloat(_):S},k.enumeratedString=function(L){return this[L]},k.bool=function(L){return this[L]==="YES"},k.decimalResolution=function(L){var S=F.exec(this[L]);if(S!==null)return{width:parseInt(S[1],10),height:parseInt(S[2],10)}},I.parseAttrList=function(L){var S,_={},T='"';for(A.lastIndex=0;(S=A.exec(L))!==null;){var c=S[2];c.indexOf(T)===0&&c.lastIndexOf(T)===c.length-1&&(c=c.slice(1,-1)),_[S[1]]=c}return _},I}()},"./src/utils/binary-search.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>A});var F={search:function(I,k){for(var P=0,L=I.length-1,S=null,_=null;P<=L;){S=(P+L)/2|0,_=I[S];var T=k(_);if(T>0)P=S+1;else if(T<0)L=S-1;else return _}return null}};const A=F},"./src/utils/buffer-helper.ts":(V,w,x)=>{x.r(w),x.d(w,{BufferHelper:()=>b});var F=x("./src/utils/logger.ts"),A={length:0,start:function(){return 0},end:function(){return 0}},b=function(){function I(){}return I.isBuffered=function(P,L){try{if(P){for(var S=I.getBuffered(P),_=0;_<S.length;_++)if(L>=S.start(_)&&L<=S.end(_))return!0}}catch{}return!1},I.bufferInfo=function(P,L,S){try{if(P){var _=I.getBuffered(P),T=[],c;for(c=0;c<_.length;c++)T.push({start:_.start(c),end:_.end(c)});return this.bufferedInfo(T,L,S)}}catch{}return{len:0,start:L,end:L,nextStart:void 0}},I.bufferedInfo=function(P,L,S){L=Math.max(0,L),P.sort(function(r,o){var v=r.start-o.start;return v||o.end-r.end});var _=[];if(S)for(var T=0;T<P.length;T++){var c=_.length;if(c){var y=_[c-1].end;P[T].start-y<S?P[T].end>y&&(_[c-1].end=P[T].end):_.push(P[T])}else _.push(P[T])}else _=P;for(var m=0,l,f=L,a=L,i=0;i<_.length;i++){var g=_[i].start,s=_[i].end;if(L+S>=g&&L<s)f=g,a=s,m=a-L;else if(L+S<g){l=g;break}}return{len:m,start:f||0,end:a||0,nextStart:l}},I.getBuffered=function(P){try{return P.buffered}catch(L){return F.logger.log("failed to get media.buffered",L),A}},I}()},"./src/utils/cea-608-parser.ts":(V,w,x)=>{x.r(w),x.d(w,{CaptionScreen:()=>i,Row:()=>a,default:()=>u});var F=x("./src/utils/logger.ts"),A={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},b=function(t){var h=t;return A.hasOwnProperty(t)&&(h=A[t]),String.fromCharCode(h)},I=15,k=100,P={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},L={17:2,18:4,21:6,22:8,23:10,19:13,20:15},S={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},_={25:2,26:4,29:6,30:8,31:10,27:13,28:15},T=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],c;(function(n){n[n.ERROR=0]="ERROR",n[n.TEXT=1]="TEXT",n[n.WARNING=2]="WARNING",n[n.INFO=2]="INFO",n[n.DEBUG=3]="DEBUG",n[n.DATA=3]="DATA"})(c||(c={}));var y=function(){function n(){this.time=null,this.verboseLevel=c.ERROR}var t=n.prototype;return t.log=function(e,d){if(this.verboseLevel>=e){var p=typeof d=="function"?d():d;F.logger.log(this.time+" ["+e+"] "+p)}},n}(),m=function(t){for(var h=[],e=0;e<t.length;e++)h.push(t[e].toString(16));return h},l=function(){function n(h,e,d,p,E){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=h||"white",this.underline=e||!1,this.italics=d||!1,this.background=p||"black",this.flash=E||!1}var t=n.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var d=["foreground","underline","italics","background","flash"],p=0;p<d.length;p++){var E=d[p];e.hasOwnProperty(E)&&(this[E]=e[E])}},t.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},n}(),f=function(){function n(h,e,d,p,E,D){this.uchar=void 0,this.penState=void 0,this.uchar=h||" ",this.penState=new l(e,d,p,E,D)}var t=n.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,d){this.uchar=e,this.penState.copy(d)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},n}(),a=function(){function n(h){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<k;e++)this.chars.push(new f);this.logger=h,this.pos=0,this.currPenState=new l}var t=n.prototype;return t.equals=function(e){for(var d=!0,p=0;p<k;p++)if(!this.chars[p].equals(e.chars[p])){d=!1;break}return d},t.copy=function(e){for(var d=0;d<k;d++)this.chars[d].copy(e.chars[d])},t.isEmpty=function(){for(var e=!0,d=0;d<k;d++)if(!this.chars[d].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(c.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>k&&(this.logger.log(c.DEBUG,"Too large cursor position "+this.pos),this.pos=k)},t.moveCursor=function(e){var d=this.pos+e;if(e>1)for(var p=this.pos+1;p<d+1;p++)this.chars[p].setPenState(this.currPenState);this.setCursor(d)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){var d=this;e>=144&&this.backSpace();var p=b(e);if(this.pos>=k){this.logger.log(c.ERROR,function(){return"Cannot insert "+e.toString(16)+" ("+p+") at position "+d.pos+". Skipping it!"});return}this.chars[this.pos].setChar(p,this.currPenState),this.moveCursor(1)},t.clearFromPos=function(e){var d;for(d=e;d<k;d++)this.chars[d].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],d=!0,p=0;p<k;p++){var E=this.chars[p].uchar;E!==" "&&(d=!1),e.push(E)}return d?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e);var d=this.chars[this.pos];d.setPenState(this.currPenState)},n}(),i=function(){function n(h){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<I;e++)this.rows.push(new a(h));this.logger=h,this.currRow=I-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=n.prototype;return t.reset=function(){for(var e=0;e<I;e++)this.rows[e].clear();this.currRow=I-1},t.equals=function(e){for(var d=!0,p=0;p<I;p++)if(!this.rows[p].equals(e.rows[p])){d=!1;break}return d},t.copy=function(e){for(var d=0;d<I;d++)this.rows[d].copy(e.rows[d])},t.isEmpty=function(){for(var e=!0,d=0;d<I;d++)if(!this.rows[d].isEmpty()){e=!1;break}return e},t.backSpace=function(){var e=this.rows[this.currRow];e.backSpace()},t.clearToEndOfRow=function(){var e=this.rows[this.currRow];e.clearToEndOfRow()},t.insertChar=function(e){var d=this.rows[this.currRow];d.insertChar(e)},t.setPen=function(e){var d=this.rows[this.currRow];d.setPenStyles(e)},t.moveCursor=function(e){var d=this.rows[this.currRow];d.moveCursor(e)},t.setCursor=function(e){this.logger.log(c.INFO,"setCursor: "+e);var d=this.rows[this.currRow];d.setCursor(e)},t.setPAC=function(e){this.logger.log(c.INFO,function(){return"pacData = "+JSON.stringify(e)});var d=e.row-1;if(this.nrRollUpRows&&d<this.nrRollUpRows-1&&(d=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==d){for(var p=0;p<I;p++)this.rows[p].clear();var E=this.currRow+1-this.nrRollUpRows,D=this.lastOutputScreen;if(D){var R=D.rows[E].cueStartTime,O=this.logger.time;if(R&&O!==null&&R<O)for(var C=0;C<this.nrRollUpRows;C++)this.rows[d-this.nrRollUpRows+C+1].copy(D.rows[E+C])}}this.currRow=d;var M=this.rows[this.currRow];if(e.indent!==null){var U=e.indent,B=Math.max(U-1,0);M.setCursor(e.indent),e.color=M.chars[B].penState.foreground}var N={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(N)},t.setBkgData=function(e){this.logger.log(c.INFO,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){var e=this;if(this.nrRollUpRows===null){this.logger.log(c.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(c.TEXT,function(){return e.getDisplayText()});var d=this.currRow+1-this.nrRollUpRows,p=this.rows.splice(d,1)[0];p.clear(),this.rows.splice(this.currRow,0,p),this.logger.log(c.INFO,"Rolling up")},t.getDisplayText=function(e){e=e||!1;for(var d=[],p="",E=-1,D=0;D<I;D++){var R=this.rows[D].getTextString();R&&(E=D+1,e?d.push("Row "+E+": '"+R+"'"):d.push(R.trim()))}return d.length>0&&(e?p="["+d.join(" | ")+"]":p=d.join(`
`)),p},t.getTextAndFormat=function(){return this.rows},n}(),g=function(){function n(h,e,d){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=h,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new i(d),this.nonDisplayedMemory=new i(d),this.lastOutputScreen=new i(d),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=d}var t=n.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(c.INFO,function(){return"MODE="+e}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var d=this,p=0;p<e.length;p++)this.writeScreen.insertChar(e[p]);var E=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(c.INFO,function(){return E+": "+d.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(c.TEXT,function(){return"DISPLAYED: "+d.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(c.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(c.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(c.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(c.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(c.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(c.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(c.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(c.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(c.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(c.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(c.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){var e=this;if(this.logger.log(c.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var d=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=d,this.writeScreen=this.nonDisplayedMemory,this.logger.log(c.TEXT,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(c.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var d={flash:!1};if(d.underline=e%2===1,d.italics=e>=46,d.italics)d.foreground="white";else{var p=Math.floor(e/2)-16,E=["white","green","blue","cyan","red","yellow","magenta"];d.foreground=E[p]}this.logger.log(c.INFO,"MIDROW: "+JSON.stringify(d)),this.writeScreen.setPen(d)},t.outputDataUpdate=function(e){e===void 0&&(e=!1);var d=this.logger.time;d!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=d:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,d,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:d),this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},n}(),s=function(){function n(h,e,d){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var p=new y;this.channels=[null,new g(h,e,p),new g(h+1,d,p)],this.cmdHistory=v(),this.logger=p}var t=n.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,d){this.channels[e].setHandler(d)},t.addData=function(e,d){var p,E,D,R=!1;this.logger.time=e;for(var O=0;O<d.length;O+=2)if(E=d[O]&127,D=d[O+1]&127,!(E===0&&D===0)){if(this.logger.log(c.DATA,"["+m([d[O],d[O+1]])+"] -> ("+m([E,D])+")"),p=this.parseCmd(E,D),p||(p=this.parseMidrow(E,D)),p||(p=this.parsePAC(E,D)),p||(p=this.parseBackgroundAttributes(E,D)),!p&&(R=this.parseChars(E,D),R)){var C=this.currentChannel;if(C&&C>0){var M=this.channels[C];M.insertChars(R)}else this.logger.log(c.WARNING,"No channel found yet. TEXT-MODE?")}!p&&!R&&this.logger.log(c.WARNING,"Couldn't parse cleaned data "+m([E,D])+" orig: "+m([d[O],d[O+1]]))}},t.parseCmd=function(e,d){var p=this.cmdHistory,E=(e===20||e===28||e===21||e===29)&&d>=32&&d<=47,D=(e===23||e===31)&&d>=33&&d<=35;if(!(E||D))return!1;if(o(e,d,p))return r(null,null,p),this.logger.log(c.DEBUG,"Repeated command ("+m([e,d])+") is dropped"),!0;var R=e===20||e===21||e===23?1:2,O=this.channels[R];return e===20||e===21||e===28||e===29?d===32?O.ccRCL():d===33?O.ccBS():d===34?O.ccAOF():d===35?O.ccAON():d===36?O.ccDER():d===37?O.ccRU(2):d===38?O.ccRU(3):d===39?O.ccRU(4):d===40?O.ccFON():d===41?O.ccRDC():d===42?O.ccTR():d===43?O.ccRTD():d===44?O.ccEDM():d===45?O.ccCR():d===46?O.ccENM():d===47&&O.ccEOC():O.ccTO(d-32),r(e,d,p),this.currentChannel=R,!0},t.parseMidrow=function(e,d){var p=0;if((e===17||e===25)&&d>=32&&d<=47){if(e===17?p=1:p=2,p!==this.currentChannel)return this.logger.log(c.ERROR,"Mismatch channel in midrow parsing"),!1;var E=this.channels[p];return E?(E.ccMIDROW(d),this.logger.log(c.DEBUG,"MIDROW ("+m([e,d])+")"),!0):!1}return!1},t.parsePAC=function(e,d){var p,E=this.cmdHistory,D=(e>=17&&e<=23||e>=25&&e<=31)&&d>=64&&d<=127,R=(e===16||e===24)&&d>=64&&d<=95;if(!(D||R))return!1;if(o(e,d,E))return r(null,null,E),!0;var O=e<=23?1:2;d>=64&&d<=95?p=O===1?P[e]:S[e]:p=O===1?L[e]:_[e];var C=this.channels[O];return C?(C.setPAC(this.interpretPAC(p,d)),r(e,d,E),this.currentChannel=O,!0):!1},t.interpretPAC=function(e,d){var p,E={color:null,italics:!1,indent:null,underline:!1,row:e};return d>95?p=d-96:p=d-64,E.underline=(p&1)===1,p<=13?E.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(p/2)]:p<=15?(E.italics=!0,E.color="white"):E.indent=Math.floor((p-16)/2)*4,E},t.parseChars=function(e,d){var p,E=null,D=null;if(e>=25?(p=2,D=e-8):(p=1,D=e),D>=17&&D<=19){var R;D===17?R=d+80:D===18?R=d+112:R=d+144,this.logger.log(c.INFO,"Special char '"+b(R)+"' in channel "+p),E=[R]}else e>=32&&e<=127&&(E=d===0?[e]:[e,d]);if(E){var O=m(E);this.logger.log(c.DEBUG,"Char codes =  "+O.join(",")),r(e,d,this.cmdHistory)}return E},t.parseBackgroundAttributes=function(e,d){var p=(e===16||e===24)&&d>=32&&d<=47,E=(e===23||e===31)&&d>=45&&d<=47;if(!(p||E))return!1;var D,R={};e===16||e===24?(D=Math.floor((d-32)/2),R.background=T[D],d%2===1&&(R.background=R.background+"_semi")):d===45?R.background="transparent":(R.foreground="black",d===47&&(R.underline=!0));var O=e<=23?1:2,C=this.channels[O];return C.setBkgData(R),r(e,d,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var d=this.channels[e];d&&d.reset()}this.cmdHistory=v()},t.cueSplitAtTime=function(e){for(var d=0;d<this.channels.length;d++){var p=this.channels[d];p&&p.cueSplitAtTime(e)}},n}();function r(n,t,h){h.a=n,h.b=t}function o(n,t,h){return h.a===n&&h.b===t}function v(){return{a:null,b:null}}const u=s},"./src/utils/codecs.ts":(V,w,x)=>{x.r(w),x.d(w,{isCodecSupportedInMp4:()=>b,isCodecType:()=>A});var F={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function A(I,k){var P=F[k];return!!P&&P[I.slice(0,4)]===!0}function b(I,k){return MediaSource.isTypeSupported((k||"video")+'/mp4;codecs="'+I+'"')}},"./src/utils/cues.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>P});var F=x("./src/utils/vttparser.ts"),A=x("./src/utils/webvtt-parser.ts"),b=x("./src/utils/texttrack-utils.ts"),I=/\s/,k={newCue:function(S,_,T,c){for(var y=[],m,l,f,a,i,g=self.VTTCue||self.TextTrackCue,s=0;s<c.rows.length;s++)if(m=c.rows[s],f=!0,a=0,i="",!m.isEmpty()){for(var r=0;r<m.chars.length;r++)I.test(m.chars[r].uchar)&&f?a++:(i+=m.chars[r].uchar,f=!1);m.cueStartTime=_,_===T&&(T+=1e-4),a>=16?a--:a++;var o=(0,F.fixLineBreaks)(i.trim()),v=(0,A.generateCueId)(_,T,o);(!S||!S.cues||!S.cues.getCueById(v))&&(l=new g(_,T,o),l.id=v,l.line=s+1,l.align="left",l.position=10+Math.min(80,Math.floor(a*8/32)*10),y.push(l))}return S&&y.length&&(y.sort(function(u,n){return u.line==="auto"||n.line==="auto"?0:u.line>8&&n.line>8?n.line-u.line:u.line-n.line}),y.forEach(function(u){return(0,b.addCueToTrack)(S,u)})),y}};const P=k},"./src/utils/discontinuities.ts":(V,w,x)=>{x.r(w),x.d(w,{adjustSlidingStart:()=>S,alignMediaPlaylistByPDT:()=>y,alignPDT:()=>c,alignStream:()=>_,findDiscontinuousReferenceFrag:()=>P,findFirstFragWithCC:()=>I,shouldAlignOnDiscontinuities:()=>k});var F=x("./src/polyfills/number.ts"),A=x("./src/utils/logger.ts"),b=x("./src/controller/level-helper.ts");function I(m,l){for(var f=null,a=0,i=m.length;a<i;a++){var g=m[a];if(g&&g.cc===l){f=g;break}}return f}function k(m,l,f){return!!(l.details&&(f.endCC>f.startCC||m&&m.cc<f.startCC))}function P(m,l,f){var a=m.fragments,i=l.fragments;if(!i.length||!a.length){A.logger.log("No fragments to align");return}var g=I(a,i[0].cc);if(!g||g&&!g.startPTS){A.logger.log("No frag in previous level to align on");return}return g}function L(m,l){if(m){var f=m.start+l;m.start=m.startPTS=f,m.endPTS=f+m.duration}}function S(m,l){for(var f=l.fragments,a=0,i=f.length;a<i;a++)L(f[a],m);l.fragmentHint&&L(l.fragmentHint,m),l.alignedSliding=!0}function _(m,l,f){l&&(T(m,f,l),!f.alignedSliding&&l.details&&c(f,l.details),!f.alignedSliding&&l.details&&!f.skippedSegments&&(0,b.adjustSliding)(l.details,f))}function T(m,l,f){if(k(m,f,l)){var a=P(f.details,l);a&&(0,F.isFiniteNumber)(a.start)&&(A.logger.log("Adjusting PTS using last level due to CC increase within current level "+l.url),S(a.start,l))}}function c(m,l){if(!(!l.fragments.length||!m.hasProgramDateTime||!l.hasProgramDateTime)){var f=l.fragments[0].programDateTime,a=m.fragments[0].programDateTime,i=(a-f)/1e3+l.fragments[0].start;i&&(0,F.isFiniteNumber)(i)&&(A.logger.log("Adjusting PTS using programDateTime delta "+(a-f)+"ms, sliding:"+i.toFixed(3)+" "+m.url+" "),S(i,m))}}function y(m,l){if(!(!m.hasProgramDateTime||!l.hasProgramDateTime)){var f=m.fragments,a=l.fragments;if(!(!f.length||!a.length)){var i=Math.round(a.length/2)-1,g=a[i],s=I(f,g.cc)||f[Math.round(f.length/2)-1],r=g.programDateTime,o=s.programDateTime;if(!(r===null||o===null)){var v=(o-r)/1e3-(s.start-g.start);S(v,m)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>b});var F=x("./src/utils/ewma.ts"),A=function(){function I(P,L,S){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=S,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new F.default(P),this.fast_=new F.default(L)}var k=I.prototype;return k.update=function(L,S){var _=this.slow_,T=this.fast_;this.slow_.halfLife!==L&&(this.slow_=new F.default(L,_.getEstimate(),_.getTotalWeight())),this.fast_.halfLife!==S&&(this.fast_=new F.default(S,T.getEstimate(),T.getTotalWeight()))},k.sample=function(L,S){L=Math.max(L,this.minDelayMs_);var _=8*S,T=L/1e3,c=_/T;this.fast_.sample(T,c),this.slow_.sample(T,c)},k.canEstimate=function(){var L=this.fast_;return L&&L.getTotalWeight()>=this.minWeight_},k.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},k.destroy=function(){},I}();const b=A},"./src/utils/ewma.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>A});var F=function(){function b(k,P,L){P===void 0&&(P=0),L===void 0&&(L=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=k,this.alpha_=k?Math.exp(Math.log(.5)/k):0,this.estimate_=P,this.totalWeight_=L}var I=b.prototype;return I.sample=function(P,L){var S=Math.pow(this.alpha_,P);this.estimate_=L*(1-S)+S*this.estimate_,this.totalWeight_+=P},I.getTotalWeight=function(){return this.totalWeight_},I.getEstimate=function(){if(this.alpha_){var P=1-Math.pow(this.alpha_,this.totalWeight_);if(P)return this.estimate_/P}return this.estimate_},b}();const A=F},"./src/utils/fetch-loader.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>i,fetchSupported:()=>y});var F=x("./src/polyfills/number.ts"),A=x("./src/loader/load-stats.ts"),b=x("./src/demux/chunk-cache.ts");function I(g,s){g.prototype=Object.create(s.prototype),g.prototype.constructor=g,_(g,s)}function k(g){var s=typeof Map=="function"?new Map:void 0;return k=function(o){if(o===null||!S(o))return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(typeof s<"u"){if(s.has(o))return s.get(o);s.set(o,v)}function v(){return P(o,arguments,T(this).constructor)}return v.prototype=Object.create(o.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),_(v,o)},k(g)}function P(g,s,r){return L()?P=Reflect.construct.bind():P=function(v,u,n){var t=[null];t.push.apply(t,u);var h=Function.bind.apply(v,t),e=new h;return n&&_(e,n.prototype),e},P.apply(null,arguments)}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(g){return Function.toString.call(g).indexOf("[native code]")!==-1}function _(g,s){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,v){return o.__proto__=v,o},_(g,s)}function T(g){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},T(g)}function c(){return c=Object.assign?Object.assign.bind():function(g){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(g[o]=r[o])}return g},c.apply(this,arguments)}function y(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var m=function(){function g(r){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=r.fetchSetup||f,this.controller=new self.AbortController,this.stats=new A.LoadStats}var s=g.prototype;return s.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},s.abortInternal=function(){var o=this.response;(!o||!o.ok)&&(this.stats.aborted=!0,this.controller.abort())},s.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},s.load=function(o,v,u){var n=this,t=this.stats;if(t.loading.start)throw new Error("Loader can only be used once.");t.loading.start=self.performance.now();var h=l(o,this.controller.signal),e=u.onProgress,d=o.responseType==="arraybuffer",p=d?"byteLength":"length";this.context=o,this.config=v,this.callbacks=u,this.request=this.fetchSetup(o,h),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){n.abortInternal(),u.onTimeout(t,o,n.response)},v.timeout),self.fetch(this.request).then(function(E){if(n.response=n.loader=E,!E.ok){var D=E.status,R=E.statusText;throw new a(R||"fetch, bad network response",D,E)}return t.loading.first=Math.max(self.performance.now(),t.loading.start),t.total=parseInt(E.headers.get("Content-Length")||"0"),e&&(0,F.isFiniteNumber)(v.highWaterMark)?n.loadProgressively(E,t,o,v.highWaterMark,e):d?E.arrayBuffer():E.text()}).then(function(E){var D=n.response;self.clearTimeout(n.requestTimeout),t.loading.end=Math.max(self.performance.now(),t.loading.first);var R=E[p];R&&(t.loaded=t.total=R);var O={url:D.url,data:E};e&&!(0,F.isFiniteNumber)(v.highWaterMark)&&e(t,o,E,D),u.onSuccess(O,t,o,D)}).catch(function(E){if(self.clearTimeout(n.requestTimeout),!t.aborted){var D=E&&E.code||0,R=E?E.message:null;u.onError({code:D,text:R},o,E?E.details:null)}})},s.getCacheAge=function(){var o=null;if(this.response){var v=this.response.headers.get("age");o=v?parseFloat(v):null}return o},s.loadProgressively=function(o,v,u,n,t){n===void 0&&(n=0);var h=new b.default,e=o.body.getReader(),d=function p(){return e.read().then(function(E){if(E.done)return h.dataLength&&t(v,u,h.flush(),o),Promise.resolve(new ArrayBuffer(0));var D=E.value,R=D.length;return v.loaded+=R,R<n||h.dataLength?(h.push(D),h.dataLength>=n&&t(v,u,h.flush(),o)):t(v,u,D,o),p()}).catch(function(){return Promise.reject()})};return d()},g}();function l(g,s){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:s,headers:new self.Headers(c({},g.headers))};return g.rangeEnd&&r.headers.set("Range","bytes="+g.rangeStart+"-"+String(g.rangeEnd-1)),r}function f(g,s){return new self.Request(g.url,s)}var a=function(g){I(s,g);function s(r,o,v){var u;return u=g.call(this,r)||this,u.code=void 0,u.details=void 0,u.code=o,u.details=v,u}return s}(k(Error));const i=m},"./src/utils/hex.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>A});var F={hexDump:function(I){for(var k="",P=0;P<I.length;P++){var L=I[P].toString(16);L.length<2&&(L="0"+L),k+=L}return k}};const A=F},"./src/utils/imsc1-ttml-parser.ts":(V,w,x)=>{x.r(w),x.d(w,{IMSC1_CODEC:()=>S,parseIMSC1:()=>y});var F=x("./src/utils/mp4-tools.ts"),A=x("./src/utils/vttparser.ts"),b=x("./src/utils/vttcue.ts"),I=x("./src/demux/id3.ts"),k=x("./src/utils/timescale-conversion.ts"),P=x("./src/utils/webvtt-parser.ts");function L(){return L=Object.assign?Object.assign.bind():function(u){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&(u[h]=t[h])}return u},L.apply(this,arguments)}var S="stpp.ttml.im1t",_=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,T=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,c={left:"start",center:"center",right:"end",start:"start",end:"end"};function y(u,n,t,h,e){var d=(0,F.findBox)(new Uint8Array(u),["mdat"]);if(d.length===0){e(new Error("Could not parse IMSC1 mdat"));return}var p=d.map(function(D){return(0,I.utf8ArrayToStr)(D)}),E=(0,k.toTimescaleFromScale)(n,1,t);try{p.forEach(function(D){return h(m(D,E))})}catch(D){e(D)}}function m(u,n){var t=new DOMParser,h=t.parseFromString(u,"text/xml"),e=h.getElementsByTagName("tt")[0];if(!e)throw new Error("Invalid ttml");var d={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},p=Object.keys(d).reduce(function(C,M){return C[M]=e.getAttribute("ttp:"+M)||d[M],C},{}),E=e.getAttribute("xml:space")!=="preserve",D=f(l(e,"styling","style")),R=f(l(e,"layout","region")),O=l(e,"body","[begin]");return[].map.call(O,function(C){var M=a(C,E);if(!M||!C.hasAttribute("begin"))return null;var U=r(C.getAttribute("begin"),p),B=r(C.getAttribute("dur"),p),N=r(C.getAttribute("end"),p);if(U===null)throw s(C);if(N===null){if(B===null)throw s(C);N=U+B}var K=new b.default(U-n,N-n,M);K.id=(0,P.generateCueId)(K.startTime,K.endTime,K.text);var W=R[C.getAttribute("region")],G=D[C.getAttribute("style")],j=i(W,G,D),H=j.textAlign;if(H){var Y=c[H];Y&&(K.lineAlign=Y),K.align=H}return L(K,j),K}).filter(function(C){return C!==null})}function l(u,n,t){var h=u.getElementsByTagName(n)[0];return h?[].slice.call(h.querySelectorAll(t)):[]}function f(u){return u.reduce(function(n,t){var h=t.getAttribute("xml:id");return h&&(n[h]=t),n},{})}function a(u,n){return[].slice.call(u.childNodes).reduce(function(t,h,e){var d;return h.nodeName==="br"&&e?t+`
`:(d=h.childNodes)!==null&&d!==void 0&&d.length?a(h,n):n?t+h.textContent.trim().replace(/\s+/g," "):t+h.textContent},"")}function i(u,n,t){var h="http://www.w3.org/ns/ttml#styling",e=null,d=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],p=u!=null&&u.hasAttribute("style")?u.getAttribute("style"):null;return p&&t.hasOwnProperty(p)&&(e=t[p]),d.reduce(function(E,D){var R=g(n,h,D)||g(u,h,D)||g(e,h,D);return R&&(E[D]=R),E},{})}function g(u,n,t){return u&&u.hasAttributeNS(n,t)?u.getAttributeNS(n,t):null}function s(u){return new Error("Could not parse ttml timestamp "+u)}function r(u,n){if(!u)return null;var t=(0,A.parseTimeStamp)(u);return t===null&&(_.test(u)?t=o(u,n):T.test(u)&&(t=v(u,n))),t}function o(u,n){var t=_.exec(u),h=(t[4]|0)+(t[5]|0)/n.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+h/n.frameRate}function v(u,n){var t=T.exec(u),h=Number(t[1]),e=t[2];switch(e){case"h":return h*3600;case"m":return h*60;case"ms":return h*1e3;case"f":return h/n.frameRate;case"t":return h/n.tickRate}return h}},"./src/utils/keysystem-util.ts":(V,w,x)=>{x.r(w),x.d(w,{changeEndianness:()=>b,convertDataUriToArrayBytes:()=>I,strToUtf8array:()=>k});var F=x("./src/utils/numeric-encoding-utils.ts");function A(P){var L=k(P).subarray(0,16),S=new Uint8Array(16);return S.set(L,16-L.length),S}function b(P){var L=function(_,T,c){var y=_[T];_[T]=_[c],_[c]=y};L(P,0,3),L(P,1,2),L(P,4,5),L(P,6,7)}function I(P){var L=P.split(":"),S=null;if(L[0]==="data"&&L.length===2){var _=L[1].split(";"),T=_[_.length-1].split(",");if(T.length===2){var c=T[0]==="base64",y=T[1];c?(_.splice(-1,1),S=(0,F.base64Decode)(y)):S=A(y)}}return S}function k(P){return Uint8Array.from(unescape(encodeURIComponent(P)),function(L){return L.charCodeAt(0)})}},"./src/utils/logger.ts":(V,w,x)=>{x.r(w),x.d(w,{enableLogs:()=>P,logger:()=>L});var F=function(){},A={trace:F,debug:F,log:F,warn:F,info:F,error:F},b=A;function I(S){var _=self.console[S];return _?_.bind(self.console,"["+S+"] >"):F}function k(S){for(var _=arguments.length,T=new Array(_>1?_-1:0),c=1;c<_;c++)T[c-1]=arguments[c];T.forEach(function(y){b[y]=S[y]?S[y].bind(S):I(y)})}function P(S,_){if(self.console&&S===!0||typeof S=="object"){k(S,"debug","log","info","warn","error");try{b.log('Debug logs enabled for "'+_+'"')}catch{b=A}}else b=A}var L=b},"./src/utils/mediakeys-helper.ts":(V,w,x)=>{x.r(w),x.d(w,{KeySystemFormats:()=>A,KeySystemIds:()=>I,KeySystems:()=>F,getKeySystemsForConfig:()=>L,getSupportedMediaKeySystemConfigurations:()=>_,keySystemDomainToKeySystemFormat:()=>P,keySystemFormatToKeySystemDomain:()=>b,keySystemIdToKeySystemDomain:()=>k,requestMediaKeySystemAccess:()=>S});var F;(function(c){c.CLEARKEY="org.w3.clearkey",c.FAIRPLAY="com.apple.fps",c.PLAYREADY="com.microsoft.playready",c.WIDEVINE="com.widevine.alpha"})(F||(F={}));var A;(function(c){c.CLEARKEY="org.w3.clearkey",c.FAIRPLAY="com.apple.streamingkeydelivery",c.PLAYREADY="com.microsoft.playready",c.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"})(A||(A={}));function b(c){switch(c){case A.FAIRPLAY:return F.FAIRPLAY;case A.PLAYREADY:return F.PLAYREADY;case A.WIDEVINE:return F.WIDEVINE;case A.CLEARKEY:return F.CLEARKEY}}var I;(function(c){c.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"})(I||(I={}));function k(c){if(c===I.WIDEVINE)return F.WIDEVINE}function P(c){switch(c){case F.FAIRPLAY:return A.FAIRPLAY;case F.PLAYREADY:return A.PLAYREADY;case F.WIDEVINE:return A.WIDEVINE;case F.CLEARKEY:return A.CLEARKEY}}function L(c){var y=c.drmSystems,m=c.widevineLicenseUrl,l=y?[F.FAIRPLAY,F.WIDEVINE,F.PLAYREADY,F.CLEARKEY].filter(function(f){return!!y[f]}):[];return!l[F.WIDEVINE]&&m&&l.push(F.WIDEVINE),l}var S=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function _(c,y,m,l){var f;switch(c){case F.FAIRPLAY:f=["cenc","sinf"];break;case F.WIDEVINE:case F.PLAYREADY:f=["cenc"];break;case F.CLEARKEY:f=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+c)}return T(f,y,m,l)}function T(c,y,m,l){var f={initDataTypes:c,persistentState:l.persistentState||"not-allowed",distinctiveIdentifier:l.distinctiveIdentifier||"not-allowed",sessionTypes:l.sessionTypes||[l.sessionType||"temporary"],audioCapabilities:y.map(function(a){return{contentType:'audio/mp4; codecs="'+a+'"',robustness:l.audioRobustness||"",encryptionScheme:l.audioEncryptionScheme||null}}),videoCapabilities:m.map(function(a){return{contentType:'video/mp4; codecs="'+a+'"',robustness:l.videoRobustness||"",encryptionScheme:l.videoEncryptionScheme||null}})};return[f]}},"./src/utils/mediasource-helper.ts":(V,w,x)=>{x.r(w),x.d(w,{getMediaSource:()=>F});function F(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(V,w,x)=>{x.r(w),x.d(w,{RemuxerTrackIdConfig:()=>S,appendUint8Array:()=>n,bin2str:()=>_,computeRawDurationFromSamples:()=>o,discardEPB:()=>p,findBox:()=>l,getDuration:()=>r,getStartDTS:()=>s,mp4Box:()=>D,mp4pssh:()=>R,offsetStartDTS:()=>v,parseEmsg:()=>E,parseInitSegment:()=>a,parsePssh:()=>O,parseSEIMessageFromNALu:()=>d,parseSamples:()=>t,parseSegmentIndex:()=>f,parseSinf:()=>g,patchEncyptionData:()=>i,readSint32:()=>y,readUint16:()=>T,readUint32:()=>c,segmentValidRange:()=>u,writeUint32:()=>m});var F=x("./src/loader/fragment.ts"),A=x("./src/utils/typed-array.ts"),b=x("./src/demux/id3.ts"),I=x("./src/utils/logger.ts"),k=x("./src/utils/hex.ts"),P=Math.pow(2,32)-1,L=[].push,S={video:1,audio:2,id3:3,text:4};function _(C){return String.fromCharCode.apply(null,C)}function T(C,M){var U=C[M]<<8|C[M+1];return U<0?65536+U:U}function c(C,M){var U=y(C,M);return U<0?4294967296+U:U}function y(C,M){return C[M]<<24|C[M+1]<<16|C[M+2]<<8|C[M+3]}function m(C,M,U){C[M]=U>>24,C[M+1]=U>>16&255,C[M+2]=U>>8&255,C[M+3]=U&255}function l(C,M){var U=[];if(!M.length)return U;for(var B=C.byteLength,N=0;N<B;){var K=c(C,N),W=_(C.subarray(N+4,N+8)),G=K>1?N+K:B;if(W===M[0])if(M.length===1)U.push(C.subarray(N+8,G));else{var j=l(C.subarray(N+8,G),M.slice(1));j.length&&L.apply(U,j)}N=G}return U}function f(C){var M=[],U=C[0],B=8,N=c(C,B);B+=4;var K=0,W=0;U===0?B+=8:B+=16,B+=2;var G=C.length+W,j=T(C,B);B+=2;for(var H=0;H<j;H++){var Y=B,Q=c(C,Y);Y+=4;var $=Q&2147483647,z=(Q&2147483648)>>>31;if(z===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var X=c(C,Y);Y+=4,M.push({referenceSize:$,subsegmentDuration:X,info:{duration:X/N,start:G,end:G+$-1}}),G+=$,Y+=4,B=Y}return{earliestPresentationTime:K,timescale:N,version:U,referencesCount:j,references:M}}function a(C){for(var M=[],U=l(C,["moov","trak"]),B=0;B<U.length;B++){var N=U[B],K=l(N,["tkhd"])[0];if(K){var W=K[0],G=W===0?12:20,j=c(K,G),H=l(N,["mdia","mdhd"])[0];if(H){W=H[0],G=W===0?12:20;var Y=c(H,G),Q=l(N,["mdia","hdlr"])[0];if(Q){var $=_(Q.subarray(8,12)),z={soun:F.ElementaryStreamTypes.AUDIO,vide:F.ElementaryStreamTypes.VIDEO}[$];if(z){var X=l(N,["mdia","minf","stbl","stsd"])[0],Z=void 0;X&&(Z=_(X.subarray(12,16))),M[j]={timescale:Y,type:z},M[z]={timescale:Y,id:j,codec:Z}}}}}}var J=l(C,["moov","mvex","trex"]);return J.forEach(function(q){var ae=c(q,4),te=M[ae];te&&(te.default={duration:c(q,12),flags:c(q,20)})}),M}function i(C,M){if(!C||!M)return C;var U=M.keyId;if(U&&M.isCommonEncryption){var B=l(C,["moov","trak"]);B.forEach(function(N){var K=l(N,["mdia","minf","stbl","stsd"])[0],W=K.subarray(8),G=l(W,["enca"]),j=G.length>0;j||(G=l(W,["encv"])),G.forEach(function(H){var Y=j?H.subarray(28):H.subarray(78),Q=l(Y,["sinf"]);Q.forEach(function($){var z=g($);if(z){var X=z.subarray(8,24);X.some(function(Z){return Z!==0})||(I.logger.log("[eme] Patching keyId in 'enc"+(j?"a":"v")+">sinf>>tenc' box: "+k.default.hexDump(X)+" -> "+k.default.hexDump(U)),z.set(U,8))}})})})}return C}function g(C){var M=l(C,["schm"])[0];if(M){var U=_(M.subarray(4,8));if(U==="cbcs"||U==="cenc")return l(C,["schi","tenc"])[0]}return I.logger.error("[eme] missing 'schm' box"),null}function s(C,M){return l(M,["moof","traf"]).reduce(function(U,B){var N=l(B,["tfdt"])[0],K=N[0],W=l(B,["tfhd"]).reduce(function(G,j){var H=c(j,4),Y=C[H];if(Y){var Q=c(N,4);K===1&&(Q*=Math.pow(2,32),Q+=c(N,8));var $=Y.timescale||9e4,z=Q/$;if(isFinite(z)&&(G===null||z<G))return z}return G},null);return W!==null&&isFinite(W)&&(U===null||W<U)?W:U},null)||0}function r(C,M){for(var U=0,B=0,N=0,K=l(C,["moof","traf"]),W=0;W<K.length;W++){var G=K[W],j=l(G,["tfhd"])[0],H=c(j,4),Y=M[H];if(Y){var Q=Y.default,$=c(j,0)|(Q==null?void 0:Q.flags),z=Q==null?void 0:Q.duration;$&8&&($&2?z=c(j,12):z=c(j,8));for(var X=Y.timescale||9e4,Z=l(G,["trun"]),J=0;J<Z.length;J++){if(U=o(Z[J]),!U&&z){var q=c(Z[J],4);U=z*q}Y.type===F.ElementaryStreamTypes.VIDEO?B+=U/X:Y.type===F.ElementaryStreamTypes.AUDIO&&(N+=U/X)}}}if(B===0&&N===0){for(var ae=0,te=l(C,["sidx"]),ne=0;ne<te.length;ne++){var ee=f(te[ne]);ee!=null&&ee.references&&(ae+=ee.references.reduce(function(re,ie){return re+ie.info.duration||0},0))}return ae}return B||N}function o(C){var M=c(C,0),U=8;M&1&&(U+=4),M&4&&(U+=4);for(var B=0,N=c(C,4),K=0;K<N;K++){if(M&256){var W=c(C,U);B+=W,U+=4}M&512&&(U+=4),M&1024&&(U+=4),M&2048&&(U+=4)}return B}function v(C,M,U){l(M,["moof","traf"]).forEach(function(B){l(B,["tfhd"]).forEach(function(N){var K=c(N,4),W=C[K];if(W){var G=W.timescale||9e4;l(B,["tfdt"]).forEach(function(j){var H=j[0],Y=c(j,4);if(H===0)Y-=U*G,Y=Math.max(Y,0),m(j,4,Y);else{Y*=Math.pow(2,32),Y+=c(j,8),Y-=U*G,Y=Math.max(Y,0);var Q=Math.floor(Y/(P+1)),$=Math.floor(Y%(P+1));m(j,4,Q),m(j,8,$)}})}})})}function u(C){var M={valid:null,remainder:null},U=l(C,["moof"]);if(U){if(U.length<2)return M.remainder=C,M}else return M;var B=U[U.length-1];return M.valid=(0,A.sliceUint8)(C,0,B.byteOffset-8),M.remainder=(0,A.sliceUint8)(C,B.byteOffset-8),M}function n(C,M){var U=new Uint8Array(C.length+M.length);return U.set(C),U.set(M,C.length),U}function t(C,M){var U=[],B=M.samples,N=M.timescale,K=M.id,W=!1,G=l(B,["moof"]);return G.map(function(j){var H=j.byteOffset-8,Y=l(j,["traf"]);Y.map(function(Q){var $=l(Q,["tfdt"]).map(function(z){var X=z[0],Z=c(z,4);return X===1&&(Z*=Math.pow(2,32),Z+=c(z,8)),Z/N})[0];return $!==void 0&&(C=$),l(Q,["tfhd"]).map(function(z){var X=c(z,4),Z=c(z,0)&16777215,J=(Z&1)!==0,q=(Z&2)!==0,ae=(Z&8)!==0,te=0,ne=(Z&16)!==0,ee=0,re=(Z&32)!==0,ie=8;X===K&&(J&&(ie+=8),q&&(ie+=4),ae&&(te=c(z,ie),ie+=4),ne&&(ee=c(z,ie),ie+=4),re&&(ie+=4),M.type==="video"&&(W=h(M.codec)),l(Q,["trun"]).map(function(se){var fe=se[0],oe=c(se,0)&16777215,de=(oe&1)!==0,De=0,ve=(oe&4)!==0,Pe=(oe&256)!==0,ye=0,ge=(oe&512)!==0,me=0,ce=(oe&1024)!==0,he=(oe&2048)!==0,Ee=0,Te=c(se,4),le=8;de&&(De=c(se,le),le+=4),ve&&(le+=4);for(var pe=De+H,_e=0;_e<Te;_e++){if(Pe?(ye=c(se,le),le+=4):ye=te,ge?(me=c(se,le),le+=4):me=ee,ce&&(le+=4),he&&(fe===0?Ee=c(se,le):Ee=y(se,le),le+=4),M.type===F.ElementaryStreamTypes.VIDEO)for(var Me=0;Me<me;){var Ie=c(B,pe);if(pe+=4,e(W,B[pe])){var Oe=B.subarray(pe,pe+Ie);d(Oe,W?2:1,C+Ee/N,U)}pe+=Ie,Me+=Ie+4}C+=ye/N}}))})})}),U}function h(C){if(!C)return!1;var M=C.indexOf("."),U=M<0?C:C.substring(0,M);return U==="hvc1"||U==="hev1"||U==="dvh1"||U==="dvhe"}function e(C,M){if(C){var U=M>>1&63;return U===39||U===40}else{var B=M&31;return B===6}}function d(C,M,U,B){var N=p(C),K=0;K+=M;for(var W=0,G=0,j=!1,H=0;K<N.length;){W=0;do{if(K>=N.length)break;H=N[K++],W+=H}while(H===255);G=0;do{if(K>=N.length)break;H=N[K++],G+=H}while(H===255);var Y=N.length-K;if(!j&&W===4&&K<N.length){j=!0;var Q=N[K++];if(Q===181){var $=T(N,K);if(K+=2,$===49){var z=c(N,K);if(K+=4,z===1195456820){var X=N[K++];if(X===3){var Z=N[K++],J=31&Z,q=64&Z,ae=q?2+J*3:0,te=new Uint8Array(ae);if(q){te[0]=Z;for(var ne=1;ne<ae;ne++)te[ne]=N[K++]}B.push({type:X,payloadType:W,pts:U,bytes:te})}}}}}else if(W===5&&G<Y){if(j=!0,G>16){for(var ee=[],re=0;re<16;re++){var ie=N[K++].toString(16);ee.push(ie.length==1?"0"+ie:ie),(re===3||re===5||re===7||re===9)&&ee.push("-")}for(var se=G-16,fe=new Uint8Array(se),oe=0;oe<se;oe++)fe[oe]=N[K++];B.push({payloadType:W,pts:U,uuid:ee.join(""),userData:(0,b.utf8ArrayToStr)(fe),userDataBytes:fe})}}else if(G<Y)K+=G;else if(G>Y)break}}function p(C){for(var M=C.byteLength,U=[],B=1;B<M-2;)C[B]===0&&C[B+1]===0&&C[B+2]===3?(U.push(B+2),B+=2):B++;if(U.length===0)return C;var N=M-U.length,K=new Uint8Array(N),W=0;for(B=0;B<N;W++,B++)W===U[0]&&(W++,U.shift()),K[B]=C[W];return K}function E(C){var M=C[0],U="",B="",N=0,K=0,W=0,G=0,j=0,H=0;if(M===0){for(;_(C.subarray(H,H+1))!=="\0";)U+=_(C.subarray(H,H+1)),H+=1;for(U+=_(C.subarray(H,H+1)),H+=1;_(C.subarray(H,H+1))!=="\0";)B+=_(C.subarray(H,H+1)),H+=1;B+=_(C.subarray(H,H+1)),H+=1,N=c(C,12),K=c(C,16),G=c(C,20),j=c(C,24),H=28}else if(M===1){H+=4,N=c(C,H),H+=4;var Y=c(C,H);H+=4;var Q=c(C,H);for(H+=4,W=Math.pow(2,32)*Y+Q,Number.isSafeInteger(W)||(W=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),G=c(C,H),H+=4,j=c(C,H),H+=4;_(C.subarray(H,H+1))!=="\0";)U+=_(C.subarray(H,H+1)),H+=1;for(U+=_(C.subarray(H,H+1)),H+=1;_(C.subarray(H,H+1))!=="\0";)B+=_(C.subarray(H,H+1)),H+=1;B+=_(C.subarray(H,H+1)),H+=1}var $=C.subarray(H,C.byteLength);return{schemeIdUri:U,value:B,timeScale:N,presentationTime:W,presentationTimeDelta:K,eventDuration:G,id:j,payload:$}}function D(C){for(var M=arguments.length,U=new Array(M>1?M-1:0),B=1;B<M;B++)U[B-1]=arguments[B];for(var N=U.length,K=8,W=N;W--;)K+=U[W].byteLength;var G=new Uint8Array(K);for(G[0]=K>>24&255,G[1]=K>>16&255,G[2]=K>>8&255,G[3]=K&255,G.set(C,4),W=0,K=8;W<N;W++)G.set(U[W],K),K+=U[W].byteLength;return G}function R(C,M,U){if(C.byteLength!==16)throw new RangeError("Invalid system id");var B,N;if(M){B=1,N=new Uint8Array(M.length*16);for(var K=0;K<M.length;K++){var W=M[K];if(W.byteLength!==16)throw new RangeError("Invalid key");N.set(W,K*16)}}else B=0,N=new Uint8Array;var G;B>0?(G=new Uint8Array(4),M.length>0&&new DataView(G.buffer).setUint32(0,M.length,!1)):G=new Uint8Array;var j=new Uint8Array(4);return U&&U.byteLength>0&&new DataView(j.buffer).setUint32(0,U.byteLength,!1),D([112,115,115,104],new Uint8Array([B,0,0,0]),C,G,N,j,U||new Uint8Array)}function O(C){if(!(C instanceof ArrayBuffer)||C.byteLength<32)return null;var M={version:0,systemId:"",kids:null,data:null},U=new DataView(C),B=U.getUint32(0);if(C.byteLength!==B&&B>44)return null;var N=U.getUint32(4);if(N!==1886614376||(M.version=U.getUint32(8)>>>24,M.version>1))return null;M.systemId=k.default.hexDump(new Uint8Array(C,12,16));var K=U.getUint32(28);if(M.version===0){if(B-32<K)return null;M.data=new Uint8Array(C,32,K)}else if(M.version===1){M.kids=[];for(var W=0;W<K;W++)M.kids.push(new Uint8Array(C,32+W*16,16))}return M}},"./src/utils/numeric-encoding-utils.ts":(V,w,x)=>{x.r(w),x.d(w,{base64Decode:()=>P,base64DecodeToStr:()=>b,base64Encode:()=>I,base64ToBase64Url:()=>F,base64UrlEncode:()=>k,strToBase64Encode:()=>A});function F(L){return L.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function A(L){return btoa(L)}function b(L){return atob(L)}function I(L){return btoa(String.fromCharCode.apply(String,L))}function k(L){return F(I(L))}function P(L){return Uint8Array.from(atob(L),function(S){return S.charCodeAt(0)})}},"./src/utils/output-filter.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>F});var F=function(){function A(I,k){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=I,this.trackName=k}var b=A.prototype;return b.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},b.newCue=function(k,P,L){(this.startTime===null||this.startTime>k)&&(this.startTime=k),this.endTime=P,this.screen=L,this.timelineController.createCaptionsTrack(this.trackName)},b.reset=function(){this.cueRanges=[],this.startTime=null},A}()},"./src/utils/texttrack-utils.ts":(V,w,x)=>{x.r(w),x.d(w,{addCueToTrack:()=>b,clearCurrentCues:()=>I,getCuesInRange:()=>L,removeCuesInRange:()=>k,sendAddTrackEvent:()=>A});var F=x("./src/utils/logger.ts");function A(S,_){var T;try{T=new Event("addtrack")}catch{T=document.createEvent("Event"),T.initEvent("addtrack",!1,!1)}T.track=S,_.dispatchEvent(T)}function b(S,_){var T=S.mode;if(T==="disabled"&&(S.mode="hidden"),S.cues&&!S.cues.getCueById(_.id))try{if(S.addCue(_),!S.cues.getCueById(_.id))throw new Error("addCue is failed for: "+_)}catch(y){F.logger.debug("[texttrack-utils]: "+y);var c=new self.TextTrackCue(_.startTime,_.endTime,_.text);c.id=_.id,S.addCue(c)}T==="disabled"&&(S.mode=T)}function I(S){var _=S.mode;if(_==="disabled"&&(S.mode="hidden"),S.cues)for(var T=S.cues.length;T--;)S.removeCue(S.cues[T]);_==="disabled"&&(S.mode=_)}function k(S,_,T,c){var y=S.mode;if(y==="disabled"&&(S.mode="hidden"),S.cues&&S.cues.length>0)for(var m=L(S.cues,_,T),l=0;l<m.length;l++)(!c||c(m[l]))&&S.removeCue(m[l]);y==="disabled"&&(S.mode=y)}function P(S,_){if(_<S[0].startTime)return 0;var T=S.length-1;if(_>S[T].endTime)return-1;for(var c=0,y=T;c<=y;){var m=Math.floor((y+c)/2);if(_<S[m].startTime)y=m-1;else if(_>S[m].startTime&&c<T)c=m+1;else return m}return S[c].startTime-_<_-S[y].startTime?c:y}function L(S,_,T){var c=[],y=P(S,_);if(y>-1)for(var m=y,l=S.length;m<l;m++){var f=S[m];if(f.startTime>=_&&f.endTime<=T)c.push(f);else if(f.startTime>T)return c}return c}},"./src/utils/time-ranges.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>A});var F={toString:function(I){for(var k="",P=I.length,L=0;L<P;L++)k+="["+I.start(L).toFixed(3)+","+I.end(L).toFixed(3)+"]";return k}};const A=F},"./src/utils/timescale-conversion.ts":(V,w,x)=>{x.r(w),x.d(w,{toMpegTsClockFromTimescale:()=>k,toMsFromMpegTsClock:()=>I,toTimescaleFromBase:()=>A,toTimescaleFromScale:()=>b});var F=9e4;function A(P,L,S,_){S===void 0&&(S=1),_===void 0&&(_=!1);var T=P*L*S;return _?Math.round(T):T}function b(P,L,S,_){return S===void 0&&(S=1),_===void 0&&(_=!1),A(P,L,1/S,_)}function I(P,L){return L===void 0&&(L=!1),A(P,1e3,1/F,L)}function k(P,L){return L===void 0&&(L=1),A(P,F,1/L)}},"./src/utils/typed-array.ts":(V,w,x)=>{x.r(w),x.d(w,{sliceUint8:()=>F});function F(A,b,I){return Uint8Array.prototype.slice?A.slice(b,I):new Uint8Array(Array.prototype.slice.call(A,b,I))}},"./src/utils/vttcue.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>F});const F=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var A=["","lr","rl"],b=["start","middle","end","left","right"];function I(_,T){if(typeof T!="string"||!Array.isArray(_))return!1;var c=T.toLowerCase();return~_.indexOf(c)?c:!1}function k(_){return I(A,_)}function P(_){return I(b,_)}function L(_){for(var T=arguments.length,c=new Array(T>1?T-1:0),y=1;y<T;y++)c[y-1]=arguments[y];for(var m=1;m<arguments.length;m++){var l=arguments[m];for(var f in l)_[f]=l[f]}return _}function S(_,T,c){var y=this,m={enumerable:!0};y.hasBeenReset=!1;var l="",f=!1,a=_,i=T,g=c,s=null,r="",o=!0,v="auto",u="start",n=50,t="middle",h=50,e="middle";Object.defineProperty(y,"id",L({},m,{get:function(){return l},set:function(p){l=""+p}})),Object.defineProperty(y,"pauseOnExit",L({},m,{get:function(){return f},set:function(p){f=!!p}})),Object.defineProperty(y,"startTime",L({},m,{get:function(){return a},set:function(p){if(typeof p!="number")throw new TypeError("Start time must be set to a number.");a=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"endTime",L({},m,{get:function(){return i},set:function(p){if(typeof p!="number")throw new TypeError("End time must be set to a number.");i=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"text",L({},m,{get:function(){return g},set:function(p){g=""+p,this.hasBeenReset=!0}})),Object.defineProperty(y,"region",L({},m,{get:function(){return s},set:function(p){s=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"vertical",L({},m,{get:function(){return r},set:function(p){var E=k(p);if(E===!1)throw new SyntaxError("An invalid or illegal string was specified.");r=E,this.hasBeenReset=!0}})),Object.defineProperty(y,"snapToLines",L({},m,{get:function(){return o},set:function(p){o=!!p,this.hasBeenReset=!0}})),Object.defineProperty(y,"line",L({},m,{get:function(){return v},set:function(p){if(typeof p!="number"&&p!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");v=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"lineAlign",L({},m,{get:function(){return u},set:function(p){var E=P(p);if(!E)throw new SyntaxError("An invalid or illegal string was specified.");u=E,this.hasBeenReset=!0}})),Object.defineProperty(y,"position",L({},m,{get:function(){return n},set:function(p){if(p<0||p>100)throw new Error("Position must be between 0 and 100.");n=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"positionAlign",L({},m,{get:function(){return t},set:function(p){var E=P(p);if(!E)throw new SyntaxError("An invalid or illegal string was specified.");t=E,this.hasBeenReset=!0}})),Object.defineProperty(y,"size",L({},m,{get:function(){return h},set:function(p){if(p<0||p>100)throw new Error("Size must be between 0 and 100.");h=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"align",L({},m,{get:function(){return e},set:function(p){var E=P(p);if(!E)throw new SyntaxError("An invalid or illegal string was specified.");e=E,this.hasBeenReset=!0}})),y.displayState=void 0}return S.prototype.getCueAsHTML=function(){var _=self.WebVTT;return _.convertCueToDOMTree(self,this.text)},S}()},"./src/utils/vttparser.ts":(V,w,x)=>{x.r(w),x.d(w,{VTTParser:()=>T,fixLineBreaks:()=>_,parseTimeStamp:()=>b});var F=x("./src/utils/vttcue.ts"),A=function(){function c(){}var y=c.prototype;return y.decode=function(l,f){if(!l)return"";if(typeof l!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(l))},c}();function b(c){function y(l,f,a,i){return(l|0)*3600+(f|0)*60+(a|0)+parseFloat(i||0)}var m=c.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return m?parseFloat(m[2])>59?y(m[2],m[3],0,m[4]):y(m[1],m[2],m[3],m[4]):null}var I=function(){function c(){this.values=Object.create(null)}var y=c.prototype;return y.set=function(l,f){!this.get(l)&&f!==""&&(this.values[l]=f)},y.get=function(l,f,a){return a?this.has(l)?this.values[l]:f[a]:this.has(l)?this.values[l]:f},y.has=function(l){return l in this.values},y.alt=function(l,f,a){for(var i=0;i<a.length;++i)if(f===a[i]){this.set(l,f);break}},y.integer=function(l,f){/^-?\d+$/.test(f)&&this.set(l,parseInt(f,10))},y.percent=function(l,f){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(f)){var a=parseFloat(f);if(a>=0&&a<=100)return this.set(l,a),!0}return!1},c}();function k(c,y,m,l){var f=l?c.split(l):[c];for(var a in f)if(typeof f[a]=="string"){var i=f[a].split(m);if(i.length===2){var g=i[0],s=i[1];y(g,s)}}}var P=new F.default(0,0,""),L=P.align==="middle"?"middle":"center";function S(c,y,m){var l=c;function f(){var g=b(c);if(g===null)throw new Error("Malformed timestamp: "+l);return c=c.replace(/^[^\sa-zA-Z-]+/,""),g}function a(g,s){var r=new I;k(g,function(u,n){var t;switch(u){case"region":for(var h=m.length-1;h>=0;h--)if(m[h].id===n){r.set(u,m[h].region);break}break;case"vertical":r.alt(u,n,["rl","lr"]);break;case"line":t=n.split(","),r.integer(u,t[0]),r.percent(u,t[0])&&r.set("snapToLines",!1),r.alt(u,t[0],["auto"]),t.length===2&&r.alt("lineAlign",t[1],["start",L,"end"]);break;case"position":t=n.split(","),r.percent(u,t[0]),t.length===2&&r.alt("positionAlign",t[1],["start",L,"end","line-left","line-right","auto"]);break;case"size":r.percent(u,n);break;case"align":r.alt(u,n,["start",L,"end","left","right"]);break}},/:/,/\s/),s.region=r.get("region",null),s.vertical=r.get("vertical","");var o=r.get("line","auto");o==="auto"&&P.line===-1&&(o=-1),s.line=o,s.lineAlign=r.get("lineAlign","start"),s.snapToLines=r.get("snapToLines",!0),s.size=r.get("size",100),s.align=r.get("align",L);var v=r.get("position","auto");v==="auto"&&P.position===50&&(v=s.align==="start"||s.align==="left"?0:s.align==="end"||s.align==="right"?100:50),s.position=v}function i(){c=c.replace(/^\s+/,"")}if(i(),y.startTime=f(),i(),c.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+l);c=c.slice(3),i(),y.endTime=f(),i(),a(c,y)}function _(c){return c.replace(/<br(?: \/)?>/gi,`
`)}var T=function(){function c(){this.state="INITIAL",this.buffer="",this.decoder=new A,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var y=c.prototype;return y.parse=function(l){var f=this;l&&(f.buffer+=f.decoder.decode(l,{stream:!0}));function a(){var v=f.buffer,u=0;for(v=_(v);u<v.length&&v[u]!=="\r"&&v[u]!==`
`;)++u;var n=v.slice(0,u);return v[u]==="\r"&&++u,v[u]===`
`&&++u,f.buffer=v.slice(u),n}function i(v){k(v,function(u,n){},/:/)}try{var g="";if(f.state==="INITIAL"){if(!/\r\n|\n/.test(f.buffer))return this;g=a();var s=g.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");f.state="HEADER"}for(var r=!1;f.buffer;){if(!/\r\n|\n/.test(f.buffer))return this;switch(r?r=!1:g=a(),f.state){case"HEADER":/:/.test(g)?i(g):g||(f.state="ID");continue;case"NOTE":g||(f.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(g)){f.state="NOTE";break}if(!g)continue;if(f.cue=new F.default(0,0,""),f.state="CUE",g.indexOf("-->")===-1){f.cue.id=g;continue}case"CUE":if(!f.cue){f.state="BADCUE";continue}try{S(g,f.cue,f.regionList)}catch{f.cue=null,f.state="BADCUE";continue}f.state="CUETEXT";continue;case"CUETEXT":{var o=g.indexOf("-->")!==-1;if(!g||o&&(r=!0)){f.oncue&&f.cue&&f.oncue(f.cue),f.cue=null,f.state="ID";continue}if(f.cue===null)continue;f.cue.text&&(f.cue.text+=`
`),f.cue.text+=g}continue;case"BADCUE":g||(f.state="ID")}}}catch{f.state==="CUETEXT"&&f.cue&&f.oncue&&f.oncue(f.cue),f.cue=null,f.state=f.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},y.flush=function(){var l=this;try{if((l.cue||l.state==="HEADER")&&(l.buffer+=`

`,l.parse()),l.state==="INITIAL"||l.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(f){l.onparsingerror&&l.onparsingerror(f)}return l.onflush&&l.onflush(),this},c}()},"./src/utils/webvtt-parser.ts":(V,w,x)=>{x.r(w),x.d(w,{generateCueId:()=>T,parseWebVTT:()=>y});var F=x("./src/polyfills/number.ts"),A=x("./src/utils/vttparser.ts"),b=x("./src/demux/id3.ts"),I=x("./src/utils/timescale-conversion.ts"),k=x("./src/remux/mp4-remuxer.ts"),P=/\r\n|\n\r|\n|\r/g,L=function(l,f,a){return a===void 0&&(a=0),l.slice(a,a+f.length)===f},S=function(l){var f=parseInt(l.slice(-3)),a=parseInt(l.slice(-6,-4)),i=parseInt(l.slice(-9,-7)),g=l.length>9?parseInt(l.substring(0,l.indexOf(":"))):0;if(!(0,F.isFiniteNumber)(f)||!(0,F.isFiniteNumber)(a)||!(0,F.isFiniteNumber)(i)||!(0,F.isFiniteNumber)(g))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+l);return f+=1e3*a,f+=60*1e3*i,f+=60*60*1e3*g,f},_=function(l){for(var f=5381,a=l.length;a;)f=f*33^l.charCodeAt(--a);return(f>>>0).toString()};function T(m,l,f){return _(m.toString())+_(l.toString())+_(f)}var c=function(l,f,a){var i=l[f],g=l[i.prevCC];if(!g||!g.new&&i.new){l.ccOffset=l.presentationOffset=i.start,i.new=!1;return}for(;(s=g)!==null&&s!==void 0&&s.new;){var s;l.ccOffset+=i.start-g.start,i.new=!1,i=g,g=l[i.prevCC]}l.presentationOffset=a};function y(m,l,f,a,i,g,s,r){var o=new A.VTTParser,v=(0,b.utf8ArrayToStr)(new Uint8Array(m)).trim().replace(P,`
`).split(`
`),u=[],n=(0,I.toMpegTsClockFromTimescale)(l,f),t="00:00.000",h=0,e=0,d,p=!0;o.oncue=function(E){var D=a[i],R=a.ccOffset,O=(h-n)/9e4;D!=null&&D.new&&(e!==void 0?R=a.ccOffset=D.start:c(a,i,O)),O&&(R=O-a.presentationOffset);var C=E.endTime-E.startTime,M=(0,k.normalizePts)((E.startTime+R-e)*9e4,g*9e4)/9e4;E.startTime=Math.max(M,0),E.endTime=Math.max(M+C,0);var U=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(U)),E.id||(E.id=T(E.startTime,E.endTime,U)),E.endTime>0&&u.push(E)},o.onparsingerror=function(E){d=E},o.onflush=function(){if(d){r(d);return}s(u)},v.forEach(function(E){if(p)if(L(E,"X-TIMESTAMP-MAP=")){p=!1,E.slice(16).split(",").forEach(function(D){L(D,"LOCAL:")?t=D.slice(6):L(D,"MPEGTS:")&&(h=parseInt(D.slice(7)))});try{e=S(t)/1e3}catch(D){d=D}return}else E===""&&(p=!1);o.parse(E+`
`)}),o.flush()}},"./src/utils/xhr-loader.ts":(V,w,x)=>{x.r(w),x.d(w,{default:()=>k});var F=x("./src/utils/logger.ts"),A=x("./src/loader/load-stats.ts"),b=/^age:\s*[\d.]+\s*$/m,I=function(){function P(S){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=S?S.xhrSetup:null,this.stats=new A.LoadStats,this.retryDelay=0}var L=P.prototype;return L.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},L.abortInternal=function(){var _=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),_&&(_.onreadystatechange=null,_.onprogress=null,_.readyState!==4&&(this.stats.aborted=!0,_.abort()))},L.abort=function(){var _;this.abortInternal(),(_=this.callbacks)!==null&&_!==void 0&&_.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},L.load=function(_,T,c){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=_,this.config=T,this.callbacks=c,this.retryDelay=T.retryDelay,this.loadInternal()},L.loadInternal=function(){var _=this.config,T=this.context;if(_){var c=this.loader=new self.XMLHttpRequest,y=this.stats;y.loading.first=0,y.loaded=0;var m=this.xhrSetup;try{if(m)try{m(c,T.url)}catch{c.open("GET",T.url,!0),m(c,T.url)}c.readyState||c.open("GET",T.url,!0);var l=this.context.headers;if(l)for(var f in l)c.setRequestHeader(f,l[f])}catch(a){this.callbacks.onError({code:c.status,text:a.message},T,c);return}T.rangeEnd&&c.setRequestHeader("Range","bytes="+T.rangeStart+"-"+(T.rangeEnd-1)),c.onreadystatechange=this.readystatechange.bind(this),c.onprogress=this.loadprogress.bind(this),c.responseType=T.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),_.timeout),c.send()}},L.readystatechange=function(){var _=this.context,T=this.loader,c=this.stats;if(!(!_||!T)){var y=T.readyState,m=this.config;if(!c.aborted&&y>=2)if(self.clearTimeout(this.requestTimeout),c.loading.first===0&&(c.loading.first=Math.max(self.performance.now(),c.loading.start)),y===4){T.onreadystatechange=null,T.onprogress=null;var l=T.status,f=T.responseType==="arraybuffer";if(l>=200&&l<300&&(f&&T.response||T.responseText!==null)){c.loading.end=Math.max(self.performance.now(),c.loading.first);var a,i;if(f?(a=T.response,i=a.byteLength):(a=T.responseText,i=a.length),c.loaded=c.total=i,!this.callbacks)return;var g=this.callbacks.onProgress;if(g&&g(c,_,a,T),!this.callbacks)return;var s={url:T.responseURL,data:a};this.callbacks.onSuccess(s,c,_,T)}else c.retry>=m.maxRetry||l>=400&&l<499?(F.logger.error(l+" while loading "+_.url),this.callbacks.onError({code:l,text:T.statusText},_,T)):(F.logger.warn(l+" while loading "+_.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,m.maxRetryDelay),c.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout)}},L.loadtimeout=function(){F.logger.warn("timeout while loading "+this.context.url);var _=this.callbacks;_&&(this.abortInternal(),_.onTimeout(this.stats,this.context,this.loader))},L.loadprogress=function(_){var T=this.stats;T.loaded=_.loaded,_.lengthComputable&&(T.total=_.total)},L.getCacheAge=function(){var _=null;if(this.loader&&b.test(this.loader.getAllResponseHeaders())){var T=this.loader.getResponseHeader("age");_=T?parseFloat(T):null}return _},P}();const k=I},"./node_modules/eventemitter3/index.js":V=>{var w=Object.prototype.hasOwnProperty,x="~";function F(){}Object.create&&(F.prototype=Object.create(null),new F().__proto__||(x=!1));function A(P,L,S){this.fn=P,this.context=L,this.once=S||!1}function b(P,L,S,_,T){if(typeof S!="function")throw new TypeError("The listener must be a function");var c=new A(S,_||P,T),y=x?x+L:L;return P._events[y]?P._events[y].fn?P._events[y]=[P._events[y],c]:P._events[y].push(c):(P._events[y]=c,P._eventsCount++),P}function I(P,L){--P._eventsCount===0?P._events=new F:delete P._events[L]}function k(){this._events=new F,this._eventsCount=0}k.prototype.eventNames=function(){var L=[],S,_;if(this._eventsCount===0)return L;for(_ in S=this._events)w.call(S,_)&&L.push(x?_.slice(1):_);return Object.getOwnPropertySymbols?L.concat(Object.getOwnPropertySymbols(S)):L},k.prototype.listeners=function(L){var S=x?x+L:L,_=this._events[S];if(!_)return[];if(_.fn)return[_.fn];for(var T=0,c=_.length,y=new Array(c);T<c;T++)y[T]=_[T].fn;return y},k.prototype.listenerCount=function(L){var S=x?x+L:L,_=this._events[S];return _?_.fn?1:_.length:0},k.prototype.emit=function(L,S,_,T,c,y){var m=x?x+L:L;if(!this._events[m])return!1;var l=this._events[m],f=arguments.length,a,i;if(l.fn){switch(l.once&&this.removeListener(L,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,S),!0;case 3:return l.fn.call(l.context,S,_),!0;case 4:return l.fn.call(l.context,S,_,T),!0;case 5:return l.fn.call(l.context,S,_,T,c),!0;case 6:return l.fn.call(l.context,S,_,T,c,y),!0}for(i=1,a=new Array(f-1);i<f;i++)a[i-1]=arguments[i];l.fn.apply(l.context,a)}else{var g=l.length,s;for(i=0;i<g;i++)switch(l[i].once&&this.removeListener(L,l[i].fn,void 0,!0),f){case 1:l[i].fn.call(l[i].context);break;case 2:l[i].fn.call(l[i].context,S);break;case 3:l[i].fn.call(l[i].context,S,_);break;case 4:l[i].fn.call(l[i].context,S,_,T);break;default:if(!a)for(s=1,a=new Array(f-1);s<f;s++)a[s-1]=arguments[s];l[i].fn.apply(l[i].context,a)}}return!0},k.prototype.on=function(L,S,_){return b(this,L,S,_,!1)},k.prototype.once=function(L,S,_){return b(this,L,S,_,!0)},k.prototype.removeListener=function(L,S,_,T){var c=x?x+L:L;if(!this._events[c])return this;if(!S)return I(this,c),this;var y=this._events[c];if(y.fn)y.fn===S&&(!T||y.once)&&(!_||y.context===_)&&I(this,c);else{for(var m=0,l=[],f=y.length;m<f;m++)(y[m].fn!==S||T&&!y[m].once||_&&y[m].context!==_)&&l.push(y[m]);l.length?this._events[c]=l.length===1?l[0]:l:I(this,c)}return this},k.prototype.removeAllListeners=function(L){var S;return L?(S=x?x+L:L,this._events[S]&&I(this,S)):(this._events=new F,this._eventsCount=0),this},k.prototype.off=k.prototype.removeListener,k.prototype.addListener=k.prototype.on,k.prefixed=x,k.EventEmitter=k,V.exports=k},"./node_modules/url-toolkit/src/url-toolkit.js":function(V){(function(w){var x=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,F=/^(?=([^\/?#]*))\1([^]*)$/,A=/(?:\/|^)\.(?=\/)/g,b=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,I={buildAbsoluteURL:function(k,P,L){if(L=L||{},k=k.trim(),P=P.trim(),!P){if(!L.alwaysNormalize)return k;var S=I.parseURL(k);if(!S)throw new Error("Error trying to parse base URL.");return S.path=I.normalizePath(S.path),I.buildURLFromParts(S)}var _=I.parseURL(P);if(!_)throw new Error("Error trying to parse relative URL.");if(_.scheme)return L.alwaysNormalize?(_.path=I.normalizePath(_.path),I.buildURLFromParts(_)):P;var T=I.parseURL(k);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var c=F.exec(T.path);T.netLoc=c[1],T.path=c[2]}T.netLoc&&!T.path&&(T.path="/");var y={scheme:T.scheme,netLoc:_.netLoc,path:null,params:_.params,query:_.query,fragment:_.fragment};if(!_.netLoc&&(y.netLoc=T.netLoc,_.path[0]!=="/"))if(!_.path)y.path=T.path,_.params||(y.params=T.params,_.query||(y.query=T.query));else{var m=T.path,l=m.substring(0,m.lastIndexOf("/")+1)+_.path;y.path=I.normalizePath(l)}return y.path===null&&(y.path=L.alwaysNormalize?I.normalizePath(_.path):_.path),I.buildURLFromParts(y)},parseURL:function(k){var P=x.exec(k);return P?{scheme:P[1]||"",netLoc:P[2]||"",path:P[3]||"",params:P[4]||"",query:P[5]||"",fragment:P[6]||""}:null},normalizePath:function(k){for(k=k.split("").reverse().join("").replace(A,"");k.length!==(k=k.replace(b,"")).length;);return k.split("").reverse().join("")},buildURLFromParts:function(k){return k.scheme+k.netLoc+k.path+k.params+k.query+k.fragment}};V.exports=I})()}},Le={};function ue(V){var w=Le[V];if(w!==void 0)return w.exports;var x=Le[V]={exports:{}};return Re[V].call(x.exports,x,x.exports,ue),x.exports}ue.m=Re,ue.n=V=>{var w=V&&V.__esModule?()=>V.default:()=>V;return ue.d(w,{a:w}),w},ue.d=(V,w)=>{for(var x in w)ue.o(w,x)&&!ue.o(V,x)&&Object.defineProperty(V,x,{enumerable:!0,get:w[x]})},ue.o=(V,w)=>Object.prototype.hasOwnProperty.call(V,w),ue.r=V=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(V,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(V,"__esModule",{value:!0})};var Ae=ue("./src/hls.ts");return Ae=Ae.default,Ae})())})(ht);const ct=dt(we),vt={key:0},gt=ut("video",{id:"player",controls:"",class:"w-full h-full"},null,-1),mt=[gt],Tt=it({__name:"EpisodeView",setup(xe){let Fe=Ce.currentRoute.value.params.episode,Re=Ce.currentRoute.value.params.id;const Le=nt();if(typeof Fe=="string"&&typeof Re=="string"){let ue=parseInt(Re),Ae=parseInt(Fe),V=qe[et.language].find(w=>w.id==ue);V?tt(V.url).then(w=>{let x=w.episodes.find(F=>F.episode==Ae);x?rt("https://neko-sama.fr"+x.url).then(F=>{F?Le.value={mp4:!1,uri:F.uri,available:!0,baseurl:F.baseurl}:(console.log("Video not found"),Ce.push("/"))}):(console.log("Episode not found"),Ce.push("/"))}):(console.log("Anime not found"),Ce.push("/"))}return at(()=>{if(Le.value&&Le.value.available){console.log(Le.value.uri);let ue=document.getElementById("player"),Ae=new ct;Ae.loadSource(Le.value.uri),Ae.attachMedia(ue)}}),(ue,Ae)=>Le.value?(lt(),st("div",vt,mt)):ot("",!0)}});export{Tt as default};
